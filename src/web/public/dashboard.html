<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wolni Farmerzy Bot - Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">ğŸŒ¾ Wolni Farmerzy Bot</div>
    <div class="nav-user">
      <span id="userName"></span>
      <button onclick="logout()" class="btn btn-small">Wyloguj</button>
    </div>
  </nav>
  
  <div class="container">
    <aside class="sidebar">
      <h3>Konta gry</h3>
      <div id="accountsList" class="accounts-list"></div>
      <button onclick="showAddAccountModal()" class="btn btn-secondary btn-full">+ Dodaj konto</button>
      
      <div class="sidebar-section">
        <h4>Status schedulera</h4>
        <div id="schedulerStatus" class="status-box">
          <span class="status-indicator"></span>
          <span class="status-text">Åadowanie...</span>
        </div>
      </div>
    </aside>
    
    <main class="main-content">
      <div id="welcomeScreen" class="welcome-screen">
        <h2>Witaj w panelu bota!</h2>
        <p>Wybierz konto z listy po lewej stronie lub dodaj nowe.</p>
      </div>
      
      <div id="accountDetails" class="account-details hidden">
        <div class="account-header">
          <h2 id="accountEmail">-</h2>
          <div class="account-actions">
            <button onclick="testLogin()" class="btn btn-secondary btn-small">Test logowania</button>
            <button onclick="refreshGameStatus()" class="btn btn-info btn-small">ğŸ”„ OdÅ›wieÅ¼ status</button>
          </div>
        </div>
        
        <!-- Przyciski akcji -->
        <div class="module-actions">
          <button onclick="runFarm()" class="btn btn-module btn-farm">ğŸŒ¾ Farma</button>
          <button onclick="runForestry()" class="btn btn-module btn-forestry">ğŸŒ² Tartak</button>
          <button onclick="runStalls()" class="btn btn-module btn-stalls">ğŸª Stragany</button>
          <button onclick="runCycle()" class="btn btn-module btn-cycle">ğŸ”„ PeÅ‚ny cykl</button>
        </div>
        
        <!-- Status wykonania -->
        <div id="moduleStatus" class="module-status hidden">
          <div class="status-icon">â³</div>
          <div class="status-text">Wykonywanie...</div>
        </div>
        
        <!-- LIVE STATUS GRY -->
        <div class="game-status-panel">
          <h3>ğŸ“Š Status gry <small id="statusFetchTime"></small></h3>
          
          <!-- Status straganÃ³w -->
          <div class="status-section">
            <h4>ğŸª Stragany</h4>
            <div id="stallsStatus" class="stalls-status-grid">
              <p class="no-data">Kliknij "OdÅ›wieÅ¼ status" aby pobraÄ‡ dane z gry</p>
            </div>
          </div>
          
          <!-- Status pÃ³l -->
          <div class="status-section">
            <h4>ğŸŒ¾ Pola (zbliÅ¼ajÄ…ce siÄ™ zbiory)</h4>
            <div id="fieldsStatus" class="fields-status-grid">
              <p class="no-data">Brak danych</p>
            </div>
          </div>
          
          <!-- Status tartaku -->
          <div class="status-section">
            <h4>ğŸªµ Tartak</h4>
            <div id="forestryStatus" class="forestry-status-grid">
              <p class="no-data">Brak danych</p>
            </div>
          </div>
        </div>
        
        <!-- KONFIGURACJA FARMY -->
        <div class="config-panel">
          <h3>ğŸŒ¾ Konfiguracja farmy</h3>
          <p class="config-info">Wybierz roÅ›linÄ™ do sadzenia na kaÅ¼dej farmie. Bot bÄ™dzie automatycznie sadziÄ‡ wybranÄ… roÅ›linÄ™ po zbiorze.</p>
          
          <div class="farm-config">
            <!-- Farma 1 -->
            <div class="farm-config-card">
              <h4>ğŸ  Farma 1</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm1_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
            
            <!-- Farma 2 -->
            <div class="farm-config-card">
              <h4>ğŸ¡ Farma 2</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm2_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
            
            <!-- Farma 3 -->
            <div class="farm-config-card">
              <h4>ğŸ˜ï¸ Farma 3</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm3_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
            
            <!-- Farma 4 -->
            <div class="farm-config-card">
              <h4>ğŸ° Farma 4</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm4_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
          </div>
          
          <button onclick="saveFarmConfig()" class="btn btn-primary">ğŸ’¾ Zapisz konfiguracjÄ™ farmy</button>
        </div>
        
        <!-- KONFIGURACJA STRAGANÃ“W -->
        <div class="config-panel">
          <h3>âš™ï¸ Konfiguracja straganÃ³w</h3>
          <p class="config-info">Wybierz produkt dla kaÅ¼dego slotu. W jednym straganie nie mogÄ… byÄ‡ dwa takie same produkty!</p>
          
          <div class="stalls-config">
            <!-- Stragan 1 -->
            <div class="stall-config-card">
              <h4>Stragan 1</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="stall1_slot1" onchange="validateStallProducts(1)">
                  <option value="">-- WyÅ‚Ä…czony --</option>
                </select>
              </div>
              <div class="slot-config">
                <label>Slot 2:</label>
                <select id="stall1_slot2" onchange="validateStallProducts(1)">
                  <option value="">-- WyÅ‚Ä…czony --</option>
                </select>
              </div>
            </div>
            
            <!-- Stragan 2 -->
            <div class="stall-config-card">
              <h4>Stragan 2</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="stall2_slot1" onchange="validateStallProducts(2)">
                  <option value="">-- WyÅ‚Ä…czony --</option>
                </select>
              </div>
            </div>
          </div>
          
          <button onclick="saveStallsConfig()" class="btn btn-primary">ğŸ’¾ Zapisz konfiguracjÄ™ straganÃ³w</button>
        </div>
        
        <!-- KONFIGURACJA TARTAKU -->
        <div class="config-panel">
          <h3>ğŸŒ² Konfiguracja tartaku</h3>
          <p class="config-info">Wybierz preferowane drzewo do sadzenia i produkty dla budynkÃ³w. Pozostaw puste aby bot sam wybraÅ‚ dostÄ™pny produkt.</p>
          
          <div class="forestry-config">
            <!-- WybÃ³r drzewa -->
            <div class="forestry-tree-select">
              <h4>ğŸŒ³ Sadzonka do sadzenia</h4>
              <div class="slot-config">
                <label>Typ drzewa:</label>
                <select id="forestryPreferredTree">
                  <option value="swierk">Åšwierk (10h)</option>
                  <option value="brzoza">Brzoza (16h)</option>
                  <option value="buk">Buk (36h)</option>
                  <option value="topola">Topola (8h)</option>
                  <option value="kasztan">Kasztan</option>
                  <option value="dab">DÄ…b</option>
                  <option value="jesion">Jesion</option>
                  <option value="klon">Klon</option>
                  <option value="wierzba">Wierzba</option>
                </select>
              </div>
            </div>
            
            <!-- Tartak (Budynek 1) -->
            <div class="forestry-building-card">
              <h4>ğŸ­ Tartak (Budynek 1)</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="building1_slot1">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
              <div class="slot-config">
                <label>Slot 2:</label>
                <select id="building1_slot2">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
            </div>
            
            <!-- Stolarnia (Budynek 2) -->
            <div class="forestry-building-card">
              <h4>ğŸªš Stolarnia (Budynek 2)</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="building2_slot1">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
              <div class="slot-config">
                <label>Slot 2:</label>
                <select id="building2_slot2">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
            </div>
          </div>
          
          <button onclick="saveForestryConfig()" class="btn btn-primary">ğŸ’¾ Zapisz konfiguracjÄ™ tartaku</button>
        </div>
        
        <!-- HARMONOGRAM -->
        <div class="config-panel">
          <h3>ğŸ“… Harmonogram automatyzacji</h3>
          <p class="config-info">Skonfiguruj kiedy i jak czÄ™sto bot ma wykonywaÄ‡ akcje.</p>
          
          <div class="scheduler-config">
            <!-- Tryb pracy -->
            <div class="scheduler-mode-select">
              <h4>âš™ï¸ Tryb pracy</h4>
              <div class="slot-config">
                <label>Tryb harmonogramu:</label>
                <select id="schedulerMode" onchange="updateSchedulerOptions()">
                  <option value="interval">InterwaÅ‚owy (co X minut)</option>
                  <option value="smart_refresh">Inteligentny (przed koÅ„cem czasu)</option>
                  <option value="window">Okno czasowe (np. 8:00-22:00)</option>
                  <option value="daily">Dzienny (raz dziennie)</option>
                </select>
              </div>
            </div>
            
            <!-- Opcje interwaÅ‚u -->
            <div id="intervalOptions" class="scheduler-options">
              <h4>â±ï¸ InterwaÅ‚</h4>
              <div class="slot-config">
                <label>Sprawdzaj co:</label>
                <div class="input-with-unit">
                  <input type="number" id="schedulerInterval" min="5" max="240" value="30">
                  <span>minut</span>
                </div>
              </div>
            </div>
            
            <!-- Opcje smart refresh -->
            <div id="smartRefreshOptions" class="scheduler-options hidden">
              <h4>ğŸ§  Inteligentne odÅ›wieÅ¼anie</h4>
              <p class="option-info">Bot automatycznie zaplanuje akcjÄ™ chwilÄ™ przed zakoÅ„czeniem wzrostu roÅ›liny/drzewa/produkcji.</p>
              <div class="slot-config">
                <label>Margines przed koÅ„cem:</label>
                <div class="input-with-unit">
                  <input type="number" id="refreshMargin" min="1" max="10" value="1">
                  <span>minut</span>
                </div>
              </div>
            </div>
            
            <!-- Opcje okna czasowego -->
            <div id="windowOptions" class="scheduler-options hidden">
              <h4>ğŸ• Okno czasowe</h4>
              <p class="option-info">Bot bÄ™dzie aktywny tylko w okreÅ›lonych godzinach.</p>
              <div class="slot-config">
                <label>Od godziny:</label>
                <input type="time" id="windowStart" value="08:00">
              </div>
              <div class="slot-config">
                <label>Do godziny:</label>
                <input type="time" id="windowEnd" value="22:00">
              </div>
              <div class="slot-config">
                <label>InterwaÅ‚ w oknie:</label>
                <div class="input-with-unit">
                  <input type="number" id="windowInterval" min="5" max="120" value="30">
                  <span>minut</span>
                </div>
              </div>
            </div>
            
            <!-- Opcje dzienne -->
            <div id="dailyOptions" class="scheduler-options hidden">
              <h4>ğŸ“† Zadanie dzienne</h4>
              <p class="option-info">Bot wykona peÅ‚ny cykl raz dziennie o okreÅ›lonej godzinie.</p>
              <div class="slot-config">
                <label>Godzina:</label>
                <input type="time" id="dailyTime" value="08:00">
              </div>
            </div>
            
            <!-- Status kolejki -->
            <div class="scheduler-queue-status">
              <h4>ğŸ“‹ Kolejka zadaÅ„</h4>
              <div id="taskQueueStatus" class="task-queue-list">
                <p class="no-data">Brak zaplanowanych zadaÅ„</p>
              </div>
            </div>
          </div>
          
          <div class="scheduler-actions">
            <button onclick="saveSchedulerConfig()" class="btn btn-primary">ğŸ’¾ Zapisz harmonogram</button>
            <button onclick="refreshTaskQueue()" class="btn btn-secondary">ğŸ”„ OdÅ›wieÅ¼ kolejkÄ™</button>
          </div>
        </div>
        
        <!-- USTAWIENIA MODUÅÃ“W -->
        <div class="config-panel">
          <h3>ğŸ”§ Ustawienia moduÅ‚Ã³w</h3>
          <form id="settingsForm" class="settings-form-compact">
            <div class="modules-grid">
              <!-- Farma -->
              <div class="module-config-card">
                <h4>ğŸŒ¾ Farma</h4>
                <label class="checkbox-label">
                  <input type="checkbox" id="farmEnabled" name="farm_enabled">
                  <span>WÅ‚Ä…czona</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="farmAutoHarvest" name="farm_auto_harvest">
                  <span>Auto zbiÃ³r</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="farmAutoPlant" name="farm_auto_plant">
                  <span>Auto sadzenie</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="farmAutoWater" name="farm_auto_water">
                  <span>Auto podlewanie</span>
                </label>
              </div>
              
              <!-- Stragany -->
              <div class="module-config-card">
                <h4>ğŸª Stragany</h4>
                <label class="checkbox-label">
                  <input type="checkbox" id="stallsEnabled" name="stalls_enabled">
                  <span>WÅ‚Ä…czone</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="stallsAutoRestock" name="stalls_auto_restock">
                  <span>Auto uzupeÅ‚nianie</span>
                </label>
              </div>
              
              <!-- Tartak -->
              <div class="module-config-card">
                <h4>ğŸŒ² Tartak</h4>
                <label class="checkbox-label">
                  <input type="checkbox" id="forestryEnabled" name="forestry_enabled">
                  <span>WÅ‚Ä…czony</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="forestryAutoHarvest" name="forestry_auto_harvest">
                  <span>Auto zbiÃ³r</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="forestryAutoPlant" name="forestry_auto_plant">
                  <span>Auto sadzenie</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" id="forestryAutoProduction" name="forestry_auto_production">
                  <span>Auto produkcja</span>
                </label>
              </div>
            </div>
            
            <button type="submit" class="btn btn-primary">ğŸ’¾ Zapisz ustawienia</button>
          </form>
        </div>
        
        <!-- LOGI -->
        <div class="config-panel">
          <h3>ğŸ“œ Ostatnie akcje</h3>
          <div id="logsList" class="logs-list-compact">
            <p class="no-data">Brak logÃ³w</p>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Modal dodawania konta -->
  <div id="addAccountModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Dodaj konto gry</h3>
        <button onclick="closeModal()" class="modal-close">&times;</button>
      </div>
      <form id="addAccountForm">
        <div class="form-group">
          <label for="gameEmail">Email / Login do gry</label>
          <input type="text" id="gameEmail" name="email" required>
        </div>
        <div class="form-group">
          <label for="gamePassword">HasÅ‚o do gry</label>
          <input type="password" id="gamePassword" name="password" required>
        </div>
        <div class="form-group">
          <label for="gameServer">Serwer</label>
          <select id="gameServer" name="server">
            <option value="1">Serwer 1</option>
            <option value="2">Serwer 2</option>
            <option value="3">Serwer 3</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeModal()" class="btn btn-secondary">Anuluj</button>
          <button type="submit" class="btn btn-primary">Dodaj konto</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Toast notifications -->
  <div id="toastContainer" class="toast-container"></div>
  
  <script src="/js/dashboard.js"></script>
</body>
</html>
