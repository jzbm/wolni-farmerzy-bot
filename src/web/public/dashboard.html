<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wolni Farmerzy Bot - Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">ğŸŒ¾ Wolni Farmerzy Bot</div>
    <div class="nav-user">
      <span id="userName"></span>
      <button onclick="logout()" class="btn btn-small">Wyloguj</button>
    </div>
  </nav>
  
  <div class="container">
    <aside class="sidebar">
      <h3>Konta gry</h3>
      <div id="accountsList" class="accounts-list"></div>
      <button onclick="showAddAccountModal()" class="btn btn-secondary btn-full">+ Dodaj konto</button>
      
      <div class="sidebar-section">
        <h4>Status schedulera</h4>
        <div id="schedulerStatus" class="status-box">
          <span class="status-indicator"></span>
          <span class="status-text">Åadowanie...</span>
        </div>
      </div>
      
      <div class="sidebar-section">
        <h4>âš™ï¸ Ustawienia</h4>
        <div class="settings-box">
          <label class="checkbox-label">
            <input type="checkbox" id="headlessModeToggle" onchange="toggleHeadlessMode()">
            <span>Tryb headless</span>
          </label>
          <p class="option-hint">Gdy wyÅ‚Ä…czony, przeglÄ…darka bÄ™dzie widoczna</p>
        </div>
      </div>
      
      <div class="sidebar-section">
        <h4>ğŸ“¢ Discord</h4>
        <div class="settings-box">
          <button onclick="openDiscordSettings()" class="btn btn-small btn-discord">
            âš™ï¸ Ustawienia Discord
          </button>
        </div>
      </div>
    </aside>
    
    <main class="main-content">
      <div id="welcomeScreen" class="welcome-screen">
        <h2>Witaj w panelu bota!</h2>
        <p>Wybierz konto z listy po lewej stronie lub dodaj nowe.</p>
      </div>
      
      <div id="accountDetails" class="account-details hidden">
        <div class="account-header">
          <h2 id="accountEmail">-</h2>
          <div class="account-actions">
            <button onclick="refreshGameStatusFromCache()" class="btn btn-secondary btn-small" title="Szybkie odÅ›wieÅ¼enie z lokalnego cache">ğŸ“‹ Z cache</button>
            <button onclick="refreshGameStatusLive()" class="btn btn-info btn-small" title="Wchodzi do gry i pobiera aktualny status">ğŸ”„ OdÅ›wieÅ¼ z gry</button>
            <button onclick="deleteAccount()" class="btn btn-danger btn-small">ğŸ—‘ï¸ UsuÅ„ konto</button>
          </div>
        </div>
        
        <!-- Przyciski akcji -->
        <div class="module-actions">
          <button onclick="runFarm()" class="btn btn-module btn-farm">ğŸŒ¾ Farma</button>
          <button onclick="runForestry()" class="btn btn-module btn-forestry">ğŸŒ² Tartak</button>
          <button onclick="runStalls()" class="btn btn-module btn-stalls">ğŸª Stragany</button>
        </div>
        
        <!-- Status wykonania -->
        <div id="moduleStatus" class="module-status hidden">
          <div class="status-icon">â³</div>
          <div class="status-text">Wykonywanie...</div>
        </div>
        
        <!-- LIVE STATUS GRY -->
        <div class="game-status-panel">
          <h3>ğŸ“Š Status gry <small id="statusFetchTime"></small></h3>
          
          <!-- Status straganÃ³w -->
          <div class="status-section" id="stallsStatusSection">
            <h4>ğŸª Stragany</h4>
            <div id="stallsStatus" class="stalls-status-grid">
              <p class="no-data">Kliknij "OdÅ›wieÅ¼ status" aby pobraÄ‡ dane z gry</p>
            </div>
          </div>
          
          <!-- Status pÃ³l -->
          <div class="status-section">
            <h4>ğŸŒ¾ Pola (zbliÅ¼ajÄ…ce siÄ™ zbiory)</h4>
            <div id="fieldsStatus" class="fields-status-grid">
              <p class="no-data">Brak danych</p>
            </div>
          </div>
          
          <!-- Status tartaku -->
          <div class="status-section" id="forestryStatusSection">
            <h4>ğŸªµ Tartak</h4>
            <div id="forestryStatus" class="forestry-status-grid">
              <p class="no-data">Brak danych</p>
            </div>
          </div>
        </div>
        
        <!-- KONFIGURACJA FARMY -->
        <div class="config-panel">
          <h3>ğŸŒ¾ Konfiguracja farmy</h3>
          <p class="config-info">Wybierz roÅ›linÄ™ do sadzenia na kaÅ¼dej farmie. Bot bÄ™dzie automatycznie sadziÄ‡ wybranÄ… roÅ›linÄ™ po zbiorze.</p>
          
          <div class="farm-config">
            <!-- Farma 1 -->
            <div class="farm-config-card" id="farm1_config">
              <h4>ğŸ  Farma 1</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm1_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
            
            <!-- Farma 2 -->
            <div class="farm-config-card" id="farm2_config">
              <h4>ğŸ¡ Farma 2</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm2_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
            
            <!-- Farma 3 -->
            <div class="farm-config-card" id="farm3_config">
              <h4>ğŸ˜ï¸ Farma 3</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm3_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
            
            <!-- Farma 4 -->
            <div class="farm-config-card" id="farm4_config">
              <h4>ğŸ° Farma 4</h4>
              <div class="slot-config">
                <label>RoÅ›lina:</label>
                <select id="farm4_crop">
                  <option value="zboze">ZboÅ¼e (10 min)</option>
                </select>
              </div>
            </div>
          </div>
          
          <button onclick="saveFarmConfig()" class="btn btn-primary">ğŸ’¾ Zapisz konfiguracjÄ™ farmy</button>
        </div>
        
        <!-- KONFIGURACJA STRAGANÃ“W -->
        <div class="config-panel" id="stallsConfigPanel">
          <h3>âš™ï¸ Konfiguracja straganÃ³w</h3>
          <p class="config-info">Wybierz produkt dla kaÅ¼dego slotu. W jednym straganie nie mogÄ… byÄ‡ dwa takie same produkty!</p>
          
          <div class="stalls-config">
            <!-- Stragan 1 -->
            <div class="stall-config-card">
              <h4>Stragan 1</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="stall1_slot1" onchange="validateStallProducts(1)">
                  <option value="">-- WyÅ‚Ä…czony --</option>
                </select>
              </div>
              <div class="slot-config">
                <label>Slot 2:</label>
                <select id="stall1_slot2" onchange="validateStallProducts(1)">
                  <option value="">-- WyÅ‚Ä…czony --</option>
                </select>
              </div>
            </div>
            
            <!-- Stragan 2 -->
            <div class="stall-config-card">
              <h4>Stragan 2</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="stall2_slot1" onchange="validateStallProducts(2)">
                  <option value="">-- WyÅ‚Ä…czony --</option>
                </select>
              </div>
              <div class="slot-config">
                <label>Slot 2:</label>
                <select id="stall2_slot2" onchange="validateStallProducts(2)">
                  <option value="">-- WyÅ‚Ä…czony --</option>
                </select>
              </div>
            </div>
          </div>
          
          <button onclick="saveStallsConfig()" class="btn btn-primary">ğŸ’¾ Zapisz konfiguracjÄ™ straganÃ³w</button>
        </div>
        
        <!-- KONFIGURACJA TARTAKU -->
        <div class="config-panel" id="forestryConfigPanel">
          <h3>ğŸŒ² Konfiguracja tartaku</h3>
          <p class="config-info">Wybierz preferowane drzewo do sadzenia i produkty dla budynkÃ³w. Pozostaw puste aby bot sam wybraÅ‚ dostÄ™pny produkt.</p>
          
          <div class="forestry-config">
            <!-- WybÃ³r drzewa -->
            <div class="forestry-tree-select">
              <h4>ğŸŒ³ Sadzonka do sadzenia</h4>
              <div class="slot-config">
                <label>Typ drzewa:</label>
                <select id="forestryPreferredTree">
                  <option value="swierk">Åšwierk (10h)</option>
                  <option value="brzoza">Brzoza (16h)</option>
                  <option value="buk">Buk (36h)</option>
                  <option value="topola">Topola (8h)</option>
                  <option value="kasztan">Kasztan</option>
                  <option value="dab">DÄ…b</option>
                  <option value="jesion">Jesion</option>
                  <option value="klon">Klon</option>
                  <option value="wierzba">Wierzba</option>
                </select>
              </div>
            </div>
            
            <!-- Tartak (Budynek 1) -->
            <div class="forestry-building-card">
              <h4>ğŸ­ Tartak (Budynek 1)</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="building1_slot1">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
              <div class="slot-config">
                <label>Slot 2:</label>
                <select id="building1_slot2">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
            </div>
            
            <!-- Stolarnia (Budynek 2) -->
            <div class="forestry-building-card">
              <h4>ğŸªš Stolarnia (Budynek 2)</h4>
              <div class="slot-config">
                <label>Slot 1:</label>
                <select id="building2_slot1">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
              <div class="slot-config">
                <label>Slot 2:</label>
                <select id="building2_slot2">
                  <option value="">-- Auto (dowolny) --</option>
                </select>
              </div>
            </div>
          </div>
          
          <button onclick="saveForestryConfig()" class="btn btn-primary">ğŸ’¾ Zapisz konfiguracjÄ™ tartaku</button>
        </div>
        
        <!-- HARMONOGRAM -->
        <div class="config-panel">
          <h3>ğŸ“… Harmonogram automatyzacji</h3>
          <p class="config-info">Ustaw interwaÅ‚ dla kaÅ¼dego moduÅ‚u. WartoÅ›Ä‡ 0 = moduÅ‚ wyÅ‚Ä…czony z harmonogramu.</p>
          
          <!-- ZakÅ‚adki -->
          <div class="scheduler-tabs">
            <button class="scheduler-tab active" onclick="showSchedulerTab('farm')">ğŸŒ¾ Farma</button>
            <button class="scheduler-tab" onclick="showSchedulerTab('forestry')">ğŸŒ² Tartak</button>
            <button class="scheduler-tab" onclick="showSchedulerTab('stalls')">ğŸª Stragany</button>
          </div>
          
          <!-- ZawartoÅ›Ä‡ zakÅ‚adek -->
          <div class="scheduler-tab-content">
            <!-- Farma -->
            <div id="schedulerTabFarm" class="scheduler-tab-panel active">
              <h4>ğŸŒ¾ ModuÅ‚ Farmy</h4>
              <p class="option-info">Zbiera plony, sadzi roÅ›liny i podlewa.</p>
              <div class="slot-config">
                <label>Uruchamiaj co:</label>
                <div class="input-with-unit">
                  <input type="number" id="farmInterval" min="0" max="240" value="0">
                  <span>minut (0 = wyÅ‚Ä…czony)</span>
                </div>
              </div>
              <div class="module-last-run">
                <span>Ostatnie uruchomienie: </span>
                <span id="farmLastRun">-</span>
              </div>
            </div>
            
            <!-- Tartak -->
            <div id="schedulerTabForestry" class="scheduler-tab-panel hidden">
              <h4>ğŸŒ² ModuÅ‚ Tartaku</h4>
              <p class="option-info">Zbiera drzewa, sadzi nowe i uruchamia produkcjÄ™.</p>
              <div class="slot-config">
                <label>Uruchamiaj co:</label>
                <div class="input-with-unit">
                  <input type="number" id="forestryInterval" min="0" max="240" value="0">
                  <span>minut (0 = wyÅ‚Ä…czony)</span>
                </div>
              </div>
              <div class="module-last-run">
                <span>Ostatnie uruchomienie: </span>
                <span id="forestryLastRun">-</span>
              </div>
            </div>
            
            <!-- Stragany -->
            <div id="schedulerTabStalls" class="scheduler-tab-panel hidden">
              <h4>ğŸª ModuÅ‚ StraganÃ³w</h4>
              <p class="option-info">UzupeÅ‚nia produkty na straganach.</p>
              <div class="slot-config">
                <label>Uruchamiaj co:</label>
                <div class="input-with-unit">
                  <input type="number" id="stallsInterval" min="0" max="240" value="0">
                  <span>minut (0 = wyÅ‚Ä…czony)</span>
                </div>
              </div>
              <div class="module-last-run">
                <span>Ostatnie uruchomienie: </span>
                <span id="stallsLastRun">-</span>
              </div>
            </div>
          </div>
          
          <!-- Tryb inteligentny -->
          <div class="smart-mode-box">
            <h4>ğŸ§  Tryb inteligentny</h4>
            <p class="option-info">Analizuje status gry i automatycznie uruchamia moduÅ‚y gdy coÅ› jest gotowe do zbioru (na podstawie cache statusu).</p>
            <label class="checkbox-label">
              <input type="checkbox" id="smartModeEnabled">
              <span>WÅ‚Ä…cz tryb inteligentny</span>
            </label>
            <div class="interval-setting cache-interval-setting" style="margin-top: 10px;">
              <span>â±ï¸ InterwaÅ‚ sprawdzania cache:</span>
              <div class="interval-input-group">
                <input type="number" id="cacheInterval" value="60" min="10" max="600" step="10">
                <span>sekund (10-600)</span>
              </div>
            </div>
          </div>
          
          <!-- Status harmonogramu -->
          <div class="scheduler-status-box">
            <h4>ğŸ“Š Status harmonogramu</h4>
            <div id="schedulerActiveStatus">
              <span class="status-indicator inactive"></span>
              <span>Nieaktywny</span>
            </div>
            <div id="schedulerQueueStatus" class="queue-info">
              <span>Kolejka: </span>
              <span id="queueCount">0</span>
              <span> zadaÅ„</span>
            </div>
            <div id="currentTaskInfo" class="current-task hidden">
              <span>â³ Aktualnie: </span>
              <span id="currentTaskName">-</span>
            </div>
          </div>
          
          <!-- Statystyki wykonaÅ„ -->
          <div class="scheduler-stats-box">
            <h4>ğŸ“ˆ Statystyki wykonaÅ„</h4>
            <div class="stats-grid">
              <div class="stat-item">
                <span class="stat-label">ğŸŒ¾ Farma:</span>
                <span class="stat-value" id="statFarm">âœ“0 / âœ—0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ğŸŒ² Tartak:</span>
                <span class="stat-value" id="statForestry">âœ“0 / âœ—0</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">ğŸª Stragany:</span>
                <span class="stat-value" id="statStalls">âœ“0 / âœ—0</span>
              </div>
            </div>
          </div>
          
          <div class="scheduler-actions">
            <button onclick="startScheduler()" class="btn btn-success">â–¶ï¸ Uruchom harmonogram</button>
            <button onclick="stopScheduler()" class="btn btn-danger">â¹ï¸ Zatrzymaj</button>
          </div>
        </div>
        
        <!-- LOGI -->
        <div class="config-panel">
          <h3>ğŸ“œ Ostatnie akcje</h3>
          <div id="logsList" class="logs-list-compact">
            <p class="no-data">Brak logÃ³w</p>
          </div>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Modal dodawania konta -->
  <div id="addAccountModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Dodaj konto gry</h3>
        <button onclick="closeModal()" class="modal-close">&times;</button>
      </div>
      <form id="addAccountForm">
        <div class="form-group">
          <label for="gameEmail">Email / Login do gry</label>
          <input type="text" id="gameEmail" name="email" required>
        </div>
        <div class="form-group">
          <label for="gamePassword">HasÅ‚o do gry</label>
          <input type="password" id="gamePassword" name="password" required>
        </div>
        <div class="form-group">
          <label for="gameServer">Serwer</label>
          <select id="gameServer" name="server">
            <option value="1">Serwer 1</option>
            <option value="2">Serwer 2</option>
            <option value="3">Serwer 3</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeModal()" class="btn btn-secondary">Anuluj</button>
          <button type="submit" class="btn btn-primary">Dodaj konto</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Modal ustawieÅ„ Discord -->
  <div id="discordModal" class="modal hidden">
    <div class="modal-content modal-wide">
      <h3>ğŸ“¢ Ustawienia Discord</h3>
      <form id="discordForm" onsubmit="saveDiscordSettings(event)">
        <div class="form-group">
          <label for="webhookUrl">URL Webhooka Discord:</label>
          <input type="url" id="webhookUrl" placeholder="https://discord.com/api/webhooks/...">
          <p class="option-hint">UtwÃ³rz webhook w ustawieniach kanaÅ‚u Discord i wklej tutaj URL</p>
        </div>
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="discordEnabled">
            <span>WÅ‚Ä…cz powiadomienia Discord</span>
          </label>
        </div>
        
        <h4>Rodzaje powiadomieÅ„:</h4>
        <div class="notification-options">
          <label class="checkbox-label">
            <input type="checkbox" id="notifyLevelUp" checked>
            <span>ğŸ‰ Awans na nowy poziom</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="notifyModuleComplete">
            <span>âœ… ZakoÅ„czenie moduÅ‚u</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="notifyModuleError" checked>
            <span>âŒ BÅ‚Ä…d moduÅ‚u</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="notifyHarvest">
            <span>ğŸŒ¾ Zebrane plony (szczegÃ³Å‚y)</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="notifyMoney">
            <span>ğŸ’° Znalezione pieniÄ…dze</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="notifySchedulerStart">
            <span>â–¶ï¸ Uruchomienie schedulera</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="notifySchedulerStop">
            <span>â¹ï¸ Zatrzymanie schedulera</span>
          </label>
        </div>
        
        <div class="form-actions">
          <button type="button" onclick="testDiscordWebhook()" class="btn btn-info">ğŸ§ª WyÅ›lij test</button>
          <button type="button" onclick="closeDiscordModal()" class="btn btn-secondary">Anuluj</button>
          <button type="submit" class="btn btn-primary">ğŸ’¾ Zapisz</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Toast notifications -->
  <div id="toastContainer" class="toast-container"></div>
  
  <script src="/js/dashboard.js"></script>
</body>
</html>