var battle=function(){this.data={};this.currentEnemy=0;this.currentAmmo=0;this.game=0;this.slider=0;this.direction=1;this.craftPacks=[1,10,50];this.barWidth=272;this.offset=0};battle.prototype.init=function(){this.action("battle_init")};battle.prototype.fire=function(a){this.action("battle_fire",{left:a,offset:this.offset,enemy:battle.currentEnemy,ammo:battle.currentAmmo})};battle.prototype.craft=function(b,a){this.action("battle_craft",{ammo:b,amount:a})};battle.prototype.buyMaterials=function(a){this.action("battle_buy_materials",{coins:a})};battle.prototype.action=function(a,b){ajaxAction("farm",a,b,battle.response)};battle.prototype.response=function(d,c,e){if(!d){return 1}battle.data=d;setTimer("battle");if(battle.data.login){battle.reward(battle.data.login)}if(c=="battle_init"){battle.currentEnemy=0;battle.currentAmmo=0}if(c=="battle_fire"&&battle.data.feedback){$("battle_weapon_img").removeClassName("prepare").addClassName("shot");hideDiv("battle_minigame_bar");hideDiv("battle_fire");setTimeout(function(){$("battle_weapon_ammo").addClassName("ammo"+battle.currentAmmo);if(battle.data.feedback.hit==1){$("battle_weapon_ammo").addClassName("move"+battle.currentEnemy)}else{$("battle_weapon_ammo").addClassName("move0")}},100);setTimeout(function(){$("battle_weapon_img").removeClassName("shot").addClassName("idle")},800);setTimeout(function(){if(battle.data.feedback.hit==1){$("battle_inner").addClassName("shake");setTimeout(function(){$("battle_inner").removeClassName("shake")},800)}$("battle_weapon_ammo").className="weapon_ammo";battle.buildEnemies();battle.buildAmmo();$("battle_enemy"+battle.currentEnemy).addClassName("select");if(battle.data.feedback.hit==1){$("battle_enemy"+battle.currentEnemy).insert('<div id="battle_confetti" class="confetti pos'+battle.currentEnemy+'"></div>');setTimeout(function(){$("battle_confetti").remove()},1000)}var h=battle.data.feedback.points;if(battle.data.config.season=="winter"){h="-"+h}$("battle_enemy_ufo"+battle.currentEnemy).insert('<div id="battle_enemy_flyer" class="idle pos'+battle.currentEnemy+" "+battle.data.config.season+'">'+h+"</div>");setTimeout(function(){$("battle_enemy_flyer").removeClassName("idle").addClassName("fly")},200);setTimeout(function(){$("battle_enemy_flyer").remove()},1200);if(battle.data.data.enemies&&battle.data.data.enemies[battle.currentEnemy]&&battle.data.data.enemies[battle.currentEnemy].hp<=0){battle.game=0}setTimeout(function(){battle.setStatus();if(battle.data.reward){var n='<div id="battle_reward_box">';n+='  <div style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";if(battle.data.reward.giftid){n+='<div><img src="'+imgpath+"gifts/"+battle.data.reward.giftid+'.gif"></div>'}if(battle.data.reward.products){n+='<div class="products">';for(var l in battle.data.reward.products){n+='<div class="line">'+htmlProductBody(l,battle.data.reward.products[l])+"</div>"}n+="</div>"}if(battle.data.reward.money){n+='<div class="money">'+formatPrice(battle.data.reward.money)+"</div>"}if(battle.data.reward.farmhouse){for(var m=0;m<battle.data.reward.farmhouse.length;m++){n+='<img src="'+imgpath+"farmhouse/previews/"+battle.data.reward.farmhouse[m]+'_1.jpg" style="width:50px; border-radius:5px; margin:0px 5px 5px 0px;">'}}if(battle.data.reward.powerup){n+='<div class="powerup">'+battle.data.reward.powerup+"%</div>"}n+='  <div class="button_yes link" onclick="hideDiv(\'globalbox\'); hideDiv(\'globaltransp\');" style="width:40px; height:40px; margin:0 auto; margin-bottom:-10px;"></div>';n+="</div>";globalcommitbox(t_farmersmarket_rewards,n,0,0,1)}},1200)},650)}else{battle.update()}if(battle.data.craft){battle.craftSelect();var b='<div id="battle_craft_flyer" class="idle">';for(var a in battle.data.craft){b+='  <div class="amountt">'+battle.data.craft[a]+"x</div>";b+='  <div class="ammoo ammo'+a+'"></div>';b+='  <div class="clear"></div>'}b+="</div>";$("battle_craft_select").insert(b);setTimeout(function(){$("battle_craft_flyer").removeClassName("idle").addClassName("fly")},200);setTimeout(function(){$("battle_craft_flyer").remove()},1200)}};battle.prototype.update=function(){var c=0;if(this.data.data.materials){c=this.data.data.materials}var b="";b+='<div id="battle_beam" class="beam"></div>';b+='<div id="battle_enemies" class="enemies"></div>';b+='<div class="materials">';b+='  <div class="amount">'+c+"</div>";b+='  <div class="add link" onclick="battle.buyMaterialSelect()" onmouseover="showDiv(\'battle_add_tt\')" onmouseout="hideDiv(\'battle_add_tt\')">+';b+='  <div id="battle_add_tt" class="ttbox">'+t_battle_buy_material_head+"</div>";b+="</div>";b+="</div>";b+='<div class="craft link" onclick="battle.craftSelect()" onmouseover="showDiv(\'battle_craft_tt\')" onmouseout="hideDiv(\'battle_craft_tt\')">';b+='  <div id="battle_craft_tt" class="ttbox">'+t_battle_craft_head+"</div>";b+="</div>";b+='<div id="battle_ammo" class="ammo"></div>';b+='<div class="weapon" id="battle_weapon_img">';b+='  <div id="battle_weapon_ammo" class="weapon_ammo"></div>';b+="</div>";b+='<div id="battle_minigame_bar" class="bar_cool">';b+='  <div id="battle_minigame_bar_medium" class="bar_medium">';b+='    <div id="battle_minigame_bar_hot" class="bar_hot"></div>';b+="  </div>";b+='  <div class="bar_front"></div>';b+='  <div id="battle_slider"></div>';b+="</div>";var a="transp";b+='<div id="battle_transp" class="'+a+'" onclick="battle.endMinigame()"></div>';b+='<div id="battle_start" class="button2 start" onclick="battle.startMinigame()">'+t_battle_start+"</div>";b+='<div id="battle_fire" class="button2 fire" onclick="battle.pressFire()">'+t_battle_fire+"</div>";b+=events.buildTimeline("battle");b+='<div class="help helpbutton_blue link" onclick="battle.help()"></div>';b+='<div class="mini_close link" onclick="hideDiv(\'battle\');"></div>';$("battle_inner").innerHTML=b;showDiv("battle");this.buildBeam();this.buildEnemies();this.buildAmmo();this.timerUpdate();$("battle_ammo").observe("click",function(d){d.preventDefault();d.stopPropagation();return 1})};battle.prototype.buildBeam=function(){if(this.data.config.season=="summer"){hideDiv("battle_beam");return 1}var b="";for(var a in this.data.config.enemies){if(this.data.config.enemies[a].boss&&this.data.data.rewards&&this.data.data.rewards[a]){hideDiv("battle_beam")}if(this.data.data.rewards&&this.data.data.rewards[a]){continue}if(!this.data.config.enemies[a].giftid){continue}b+='<div class="object object'+a+'">';b+='  <div class="img"></div>';b+="</div>"}$("battle_beam").innerHTML=b};battle.prototype.buildAmmo=function(){var c="";for(var b in this.data.config.ammo){var a=0;if(this.data.data.ammo&&this.data.data.ammo[b]){a=this.data.data.ammo[b]}var d="battle.setAmmo("+b+")";if(!a){d=""}if(!a&&b==this.currentAmmo){this.currentAmmo=0;this.game=1;this.setStatus()}c+='<div id="battle_ammo'+b+'" class="slot link" onclick="'+d+'" onmouseover="showDiv(\'battle_ammo'+b+"_tt')\" onmouseout=\"hideDiv('battle_ammo"+b+"_tt')\">";var e="";if(this.currentAmmo==b){e="select";c+='<div class="active"></div>'}c+='  <div class="img ammo'+b+" "+e+'"></div>';c+='  <div class="amount">'+a+"</div>";c+='  <div id="battle_ammo'+b+'_tt" class="ttbox">';c+='    <div class="name">'+this.data.config.ammo[b].name+"</div>";c+="    <div>"+t_battle_craft_points_per_hit.replace("%POINTS%",this.data.config.ammo[b].points_burningzone)+"</div>";c+="  </div>";c+="</div>"}c+='<div id="battle_ammo_info" class="info pulse"></div>';$("battle_ammo").innerHTML=c};battle.prototype.buildEnemies=function(a){var l="";var m=1;for(var e in this.data.config.enemies){if(this.data.config.enemies[e].boss){continue}if(!this.data.data.enemies||!this.data.data.enemies[e]||(this.data.data.enemies[e]&&this.data.data.enemies[e].hp>0)){m=0}}for(var e in this.data.config.enemies){if(a>0&&e!=a){continue}var t="battle.setEnemy("+e+")";var q=100;var s=this.data.config.enemies[e].hp;if(this.data.data.enemies&&this.data.data.enemies[e]){s=this.data.data.enemies[e].hp;q=(s*100)/this.data.config.enemies[e].hp}if((this.data.config.enemies[e].boss&&!m)||(s<=0)){t=""}var n=Math.max(0,s);var b="left";if(this.data.config.season=="summer"){if(in_array(e,[2,4])){b="right"}if(in_array(e,[3,5])){b+=" short"}q=(100-q);n=(this.data.config.enemies[e].hp-n)}if(this.data.config.season=="halloween"&&e>3){b="right"}if(e==6){b="bottom"}l+='<div id="battle_enemy'+e+'" class="enemy enemy'+e+' link" onmouseover="battle.hoverEnemy('+e+', 1)" onmouseout="battle.hoverEnemy('+e+', 0)" onclick="'+t+'">';l+='  <div id="battle_enemy_ufo'+e+'" class="img ufo'+e+'">';if(s<=0){l+='<div id="battle_enemy_ready'+e+'" class="ready"></div>'}l+='    <div id="battle_enemy_aiming_cross'+e+'" class="aiming_cross"></div>';if(s<=0){}else{if(e==6&&t==""){}else{l+='<div class="hpbar">';l+='  <div class="hpbar_inner" style="width:'+q+'%"></div>';l+='  <div class="hpbar_amount">'+n+"/"+this.data.config.enemies[e].hp+"</div>";l+="</div>";l+='<div class="symbol"></div>'}}l+="  </div>";l+='  <div id="battle_enemy_tt'+e+'" class="ttbox '+b+'">';var r=t_battle_get_reward;if(s<=0){r=t_specialoffer_message.replace(":","")}l+='    <div style="font-weight:bold; margin-bottom:5px;">'+r+"</div>";if(this.data.config.enemies[e].giftid){l+='<img src="'+imgpath+"gifts/"+this.data.config.enemies[e].giftid+'.gif">'}if(this.data.config.enemies[e].products){if(this.data.data.rewards&&this.data.data.rewards[e]&&this.data.data.rewards[e].products){l+='<div class="products">';for(var h in this.data.data.rewards[e].products){l+='<div class="line">';l+='  <div class="pid kp'+h+'"></div>';l+='  <div class="amount">'+formatNumber(this.data.data.rewards[e].products[h])+"x</div>";l+='  <div class="clear"></div>';l+="</div>"}l+="</div>"}else{l+='<div class="product_package size'+this.data.config.enemies[e].products+'"></div>'}}if(this.data.config.enemies[e].money){if(this.data.data.rewards&&this.data.data.rewards[e]&&this.data.data.rewards[e].money){l+="<div>"+formatPrice(this.data.data.rewards[e].money)+"</div>"}else{l+='<div class="money_package size'+this.data.config.enemies[e].money+'"></div>'}}if(this.data.config.enemies[e].farmhouse){var d=[];if(!Array.isArray(this.data.config.enemies[e].farmhouse)){d.push(this.data.config.enemies[e].farmhouse)}else{d=this.data.config.enemies[e].farmhouse}for(var c=0;c<d.length;c++){l+='<img src="'+imgpath+"farmhouse/previews/"+this.data.config.enemies[e].farmhouse[c]+'_1.jpg" style="margin-bottom:10px; border-radius:5px;">'}}if(this.data.config.enemies[e].powerup){l+='<div class="powerup">'+this.data.config.enemies[e].points+"%</div>"}l+='    <div class="clear"></div>';if(this.data.config.enemies[e].boss&&!m){l+='<div class="info">'+t_battle_enemies_boss+"</div>"}if(s<=0){l+='<div class="ready_tt"></div>'}l+="  </div>";l+="</div>"}$("battle_enemies").innerHTML=l};battle.prototype.setAmmo=function(a){if(a==this.currentAmmo){this.game=1;if(!this.currentEnemy){this.game=0}this.currentAmmo=0}else{this.currentAmmo=a}this.buildAmmo();this.setStatus()};battle.prototype.setEnemy=function(a){if(this.currentEnemy!=a){this.currentEnemy=a;this.game=1;this.setStatus()}};battle.prototype.hoverEnemy=function(b,a){if(!a){hideDiv("battle_enemy_aiming_cross"+b);hideDiv("battle_enemy_tt"+b)}else{if(this.data.data.enemies&&this.data.data.enemies[b]&&this.data.data.enemies[b].hp<=0){}else{showDiv("battle_enemy_aiming_cross"+b)}showDiv("battle_enemy_tt"+b)}};battle.prototype.buyMaterialSelect=function(){var c='<div id="battle_buy_material_select">';for(var a in this.data.config.buy){var b="";var d="battle.buyMaterialSelectCommit("+a+")";if(parseInt(a)>user_coins){d="";b="important"}var e=t_battle_buy_material_body.replace("%COINS%",a);c+='<div class="button_new link '+b+'" onclick="'+d+'">'+e.replace("%AMOUNT%",this.data.config.buy[a])+"</div>"}c+="</div>";globalcommitbox(t_battle_buy_material_head,c,0,0,1)};battle.prototype.buyMaterialSelectCommit=function(a){var d=t_battle_buy_material_body.replace("%COINS%",a);var b="<div>"+d.replace("%AMOUNT%",this.data.config.buy[a])+"</div>";var c="battle.buyMaterials("+a+")";globalcommitbox(t_battle_buy_material_head,b,c)};battle.prototype.craftSelect=function(){var a=0;if(this.data.data.materials>0){a=this.data.data.materials}var e='<div id="battle_craft_select" class="'+this.data.config.season+'">';for(var c in this.data.config.ammo){var l=this.data.config.ammo[c].materials;var m="";var q="";var h=checkFarmhouseBonus(this.data.config.token);if(h&&h.waterreduction){l=Math.ceil(l*(1-h.waterreduction));m="bonus";q="("+t_farmhouse_bonus_incl.replace("%PERCENT%",(h.waterreduction*100))+")"}e+='<div class="line">';e+='  <div class="img ammo'+c+'"></div>';e+='  <div class="stats">';e+='    <div class="name">'+this.data.config.ammo[c].name+"</div>";e+="    <div>"+t_battle_craft_points_per_hit.replace("%POINTS%",this.data.config.ammo[c].points_burningzone)+"</div>";e+="    <div>"+t_battle_craft_zone[this.data.config.ammo[c].zone]+"</div>";e+='    <div class="require">'+lotterylotsrequired+"</div>";e+='    <div class="'+m+'">'+l+"&nbsp;"+t_battle_craft_materials+"</div>";if(q!=""){e+='<div class="bonus bonus2">'+q+"</div>"}if(this.data.config.ammo[c].coins){e+="<div>"+this.data.config.ammo[c].coins+"&nbsp;"+t_coins+"</div>"}e+="  </div>";e+='  <div class="buttons">';for(var b=0;b<this.craftPacks.length;b++){var d=parseInt(this.craftPacks[b]);var n="battle.craftSelectCommit("+c+", "+this.craftPacks[b]+")";var m="";if((d*l)>a||(this.data.config.ammo[c].coins&&(this.data.config.ammo[c].coins*d)>user_coins)){m="important";n=""}e+='<div class="button_new link '+m+'" onclick="'+n+'">'+d+"x</div>"}e+='    <div class="clear"></div>';e+="  </div>";e+='  <div class="clear"></div>';e+="</div>"}e+="</div>";globalBoxFlex(t_battle_craft_head,e,0,0,1)};battle.prototype.craftSelectCommit=function(d,b){if(this.data.config.ammo[d].coins){var e=t_battle_craft_ask.replace("%COST%",(this.data.config.ammo[d].coins*b)+"&nbsp;"+t_coins);e=e.replace("%AMOUNT%",b);var a="<div>"+e.replace("%NAME%",this.data.config.ammo[d].name)+"</div>";var c="battle.craft("+d+", "+b+")";globalcommitbox(t_battle_craft_head,a,c)}else{battle.craft(d,b)}};battle.prototype.endMinigame=function(){this.game=0;this.setStatus()};battle.prototype.startMinigame=function(){this.game=2;this.setStatus()};battle.prototype.moveSlider=function(){var a=parseInt($("battle_slider").style.left);if(this.direction==1){a++}else{a--}$("battle_slider").style.left=a+"px";if(a>=this.barWidth){this.direction=0}if(a<=0){this.direction=1}};battle.prototype.pressFire=function(){clearInterval(this.slider);$("battle_fire").addClassName("off");var a=parseInt($("battle_slider").style.left);this.fire(a)};battle.prototype.buildBarMinigame=function(){var d=this.data.config.ammo[this.currentAmmo].hotzone_height;$("battle_minigame_bar_medium").style.width=d+"px";var e=(this.barWidth/2);var b=-e+20;if(d>e){var a=(-(d-e))-20}else{var a=(e-d)-20}var c=getRandom(b,a);this.offset=(e+c);$("battle_minigame_bar_medium").style.marginLeft=c+"px";d=this.data.config.ammo[this.currentAmmo].burningzone_height;$("battle_minigame_bar_hot").style.width=d+"px";$("battle_minigame_bar_hot").style.marginLeft=-(d/2)+"px"};battle.prototype.checkStartMinigame=function(){if(!this.game){return 1}$("battle_enemy"+this.currentEnemy).addClassName("select");hideDiv("battle_start");if(this.game==1){hideDiv("battle_fire");$("battle_weapon_img").removeClassName("prepare").addClassName("idle").removeClassName("select");hideDiv("battle_minigame_bar")}if(!this.currentAmmo){$("battle_ammo_info").innerHTML=t_battle_choose_ammo;showDiv("battle_ammo_info")}else{hideDiv("battle_ammo_info");if(this.game==1){showDiv("battle_start")}}};battle.prototype.setStatus=function(){if(!this.game){showDiv("event_timeline");hideDiv("battle_transp");hideDiv("battle_ammo_info");hideDiv("battle_start");hideDiv("battle_fire");hideDiv("battle_minigame_bar");this.game=0;this.currentEnemy=0;this.update()}else{hideDiv("event_timeline");showDiv("battle_transp");$("battle_enemy"+this.currentEnemy).addClassName("select");$("battle_weapon_img").removeClassName("prepare").removeClassName("select").addClassName("idle");showDiv("battle_enemy_aiming_cross"+this.currentEnemy);this.checkStartMinigame();if(this.currentAmmo>0){this.buildBarMinigame()}}if(this.game==1){this.hoverEnemy(this.currentEnemy,0);$("battle_ammo").addClassName("select");if(this.currentAmmo){this.game=2;this.setStatus()}}if(this.game==2){clearInterval(this.slider);$("battle_weapon_img").removeClassName("idle").addClassName("prepare").addClassName("select");hideDiv("battle_start");showDiv("battle_fire");showDiv("battle_minigame_bar");$("battle_slider").style.left="0px";this.slider=setInterval(function(){battle.moveSlider()},5)}};battle.prototype.timer=function(){this.data.data.remain--;this.data.data.remain_exchange--;if(this.data.data.remain_exchange<=0){hideDiv("battle");return 1}this.timerUpdate()};battle.prototype.timerUpdate=function(){events.timerTimeline("battle")};battle.prototype.help=function(){var a='<ul id="battle_help">';var c=t_battle_help1;var b=1;for(pid in this.data.config.products){c=c.replace("%PRODUCT"+b+"%",produkt_name[pid]);b++}a+="<li>"+c+"</li>";a+="<li>"+t_battle_help2+"</li>";a+="<li>"+t_battle_help3+"</li>";a+="<li>"+t_battle_help4+"</li>";a+="<li>"+t_battle_help5+"</li>";a+="<li>"+t_battle_help6+"</li>";a+="<li>"+t_battle_help7+"</li>";a+="</ul>";globalcommitbox(t_battle_name,a,0,0,1)};battle.prototype.reward=function(d){if(!d.materials&&!d.ammo){return 1}var b='<div id="battle_reward" class="'+this.data.config.season+'">';b+='<div style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";for(var c in d){if(c=="materials"){b+='<div class="flexit">';b+='  <div class="candy" style="float:left; margin-right:5px;"></div>';b+='  <div style="float:left; margin-top:12px;">'+d[c]+"x&nbsp;"+t_battle_craft_materials+"</div>";b+='  <div class="clear"></div>';b+="</div>"}if(c=="ammo"){for(var a in d[c]){b+='<div class="flexit">';b+='  <div class="ammo ammo'+a+'" style="float:left; margin-right:5px;"></div>';b+='  <div style="float:left; margin-top:12px;">'+d[c][a]+"x&nbsp;"+this.data.config.ammo[a].name+"</div>";b+='  <div class="clear"></div>';b+="</div>"}}}b+="</div>";globalcommitbox(t_collectevent_daily_head,b,"off")};battle.prototype.finder=function(b){var a='<div class="battle_drop_candy '+battle_season+'"></div><div>'+b+"x</div>";globalcommitbox(t_olympia_acai_berry,a,"off")};battle.prototype.flyer=function(){var a='<div id="minigame_flyer" class="idle">'+points+"</div>";$("minigame_enemy").insert(a);setTimeout(function(){$("minigame_flyer").removeClassName("idle").addClassName("fly")},200);setTimeout(function(){$("minigame_flyer").remove()},1200)};var bonuspack=function(){this.data={};this.currentPack=0};bonuspack.prototype.buy=function(){this.action("bonuspack_buy",{id:this.currentPack})};bonuspack.prototype.action=function(a,b){ajaxAction("farm",a,b,bonuspack.response)};bonuspack.prototype.response=function(b,a,c){bonuspack.data=b;if(a=="bonuspack_buy"){bonuspack.close()}};bonuspack.prototype.open=function(){var b=0;var e=0;for(var h in this.data.packs){if(!e){e=h}if(this.data.packs[h].remain>0){b++}}if(!this.data.packs||!b){this.close();return 0}var c=this.data.packs[e];var a="";a+=this.showPack(e);if(b>1){var d=1;a+="<div>"+d+" / "+b+"</div>"}a+='<div class="chest"></div>';a+='<div class="mini_close link" onclick="bonuspack.close();"></div>';$("bonuspack_inner").innerHTML=a;showDiv("bonuspack")};bonuspack.prototype.showPack=function(m){this.currentPack=m;var e=this.data.packs[m];var c="";if(e.head){c=e.head}var h="";if(e.desc){h=e.desc}var b="";b+='<div class="head">'+c+"</div>";b+='<div class="desc">'+h+"</div>";b+='<div class="rewards">';for(var d in e.rewards){if(in_array(d,["item"])){for(var a in e.rewards[d]){b+=this.showSlot(d,a)}}else{b+=this.showSlot(d)}}b+='  <div class="clear"></div>';b+="</div>";var l=0;if(e.discount){l=(e.discount*100)}if(e.value){l=(100-Math.ceil((e.coins*100)/e.value))}if(l>0){b+='<div class="discount bonus_star pulse">';b+='  <div class="amount">-'+l+"%</div>";b+="</div>"}if(e.value){b+='<div class="value">'+t_value_cost.replace("%COST%",e.value+"&nbsp;"+t_coins)+"</div>"}b+='<div class="link coinsbutton_flex" onclick="bonuspack.buyCommit()">'+str_replace("%COINS%",e.coins,t_buy_offer)+"</div>";b+='<div class="timer">'+t_offer_ends+'&nbsp;<span id="bonuspack_pack'+m+'_timer"></span></div>';return b};bonuspack.prototype.showSlot=function(e,b){var h=this.data.packs[this.currentPack].rewards[e];var d=h;var a="";var l="";if(in_array(e,["paymentcollectionpackage"])){a=this.data.paymentitem_type}if(e=="item"){d=h[b];a="tt"+b;l="<br>"+produkt_name[b]}if(e=="premium"){d=t_days.replace("%DAYS%",d)}else{d+="x"}var c="";c+='<div class="slot">';c+='  <div class="'+e+" "+a+'" onmouseover="showDiv(\'bonuspack_rewards_slot'+e+b+"')\" onmouseout=\"hideDiv('bonuspack_rewards_slot"+e+b+"')\">";c+='    <div id="bonuspack_rewards_slot'+e+b+'" class="ttbox">'+t_bonuspack_rewards[e]+l+"</div>";c+="  </div>";c+='  <div class="amount">'+d+"</div>";c+="</div>";return c};bonuspack.prototype.buyCommit=function(){var b=t_bonuspack_buy_head;if(this.data.packs[this.currentPack].head){b=this.data.packs[this.currentPack].head}var a=str_replace("%COST%",this.data.packs[this.currentPack].coins+"&nbsp;"+t_coins,t_bonuspack_buy_body);a=str_replace("%NAME%",this.data.packs[this.currentPack].head,a);globalcommitbox(b,a,"bonuspack.buy()")};bonuspack.prototype.close=function(){var a=0;for(var b in this.data.packs){if(this.data.packs[b].remain>0){a++}}if(!a){hideDiv("bonuspack_link")}hideDiv("bonuspack")};bonuspack.prototype.timer=function(){if(this.data.packs){for(var b in this.data.packs){this.data.packs[b].remain--;if(this.data.packs[b].remain<=0){this.close()}else{if($("bonuspack_pack"+b+"_timer")&&this.currentPack==b){$("bonuspack_pack"+b+"_timer").innerHTML=formatTime(this.data.packs[b].remain)}if($("bonuspack_link")){if(!$("bonuspack_link_timer")){var a='<div id="bonuspack_link_timer" class="timer"></div>';$("bonuspack_link").insert(a)}$("bonuspack_link_timer").innerHTML=formatTime(this.data.packs[b].remain)}}}}};var buildingdata=new Object;var building_runner_runtime=0;var building_runner=0;var building_show_feed=0;var building_animal_special_select=0;var ghost_visible=0;var building_ignore_elements=["globalbox","globaltransp","mayo_info","kaeserei_info","wollerei_info","update_crop_2","update_crop_3","update_crop_4","update_crop_5","update_crop_11_1","update_crop_11_2","update_crop_12","update_time_2","update_time_3","update_time_4","update_time_5","update_time_11_1","update_time_11_2","update_time_12","update_time_15","update_13_2","update_13_4","update_13_5","update_13_5_ani","update_14_2","update_14_4","update_14_5","update_14_5_1","update_14_5_2"];var building_feed_cache_timer=0;var building_feed_cache={};var building_feed_cache_guild=-1;function buildingInnerAction(q,a,m,l,s){var b="&mode=inner_"+q+"&farm="+a+"&position="+m;if(l){b+="&pid="+l}if(s){b+="&pos="+s;b+="&action="+building_animal_special_select}if(q=="init"||q=="crop"||q=="cancel"||q=="setspecial"){building_show_feed=0}if(q=="rename_animal"){if($("buildinginner_renameanimal").value=="Praise The King"&&farms_data.farms[a][m].buildingid==3){startMoo()}if($("buildinginner_renameanimal")&&$("buildinginner_renameanimal").value!=""){b+="&name="+encodeURIComponent($("buildinginner_renameanimal").value)}else{return false}}if(q=="feed"){var e=s;if(premium||(currentuserlevel>=teaserfeedpopupmin&&currentuserlevel<teaserfeedpopupmax)){var h=$("building_dialogbox_input").value}else{if(building_feed_cache){var r="";for(var d in building_feed_cache){r+=d+"_"+building_feed_cache[d]+"|"}b+="&c="+r;building_feed_cache_timer=0;building_feed_cache={}}var h=1}if(!h||h==0){return false}b+="&amount="+h;b+="&guildjob="+e}var n=createAjaxRequestObj();n.open("GET","ajax/farm.php?rid="+rid+b,true);n.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");n.onreadystatechange=function(){buildingInnerActionResponse(n,q,a,m)};n.send(null)}function buildingInnerActionResponse(d,l,a,h){var q=_chkRequest(d);if(q!=0){if(q[0]==0){var n=0;if(l=="crop"){n="hideDiv('globaltransp'); hideDiv('globalbox'); closeBuildingInner()"}var c={mode:l,farm:a,position:h,id:1};globalerrorbox(q[1],n,c)}else{buildingdata=q[1];var e=buildingdata[a][h];var b=q[2];closeBuildingInnerDialogBox();newBuildingInner(a,h);buildingInnerAnimalSpecialDeselect(a,h);if(l=="feed"){var m=getRandom(1,7);showFeedback("production_feedback",randfeedtext[m]);if(b.tutorial==9){showTutorial(16)}building_feed_cache_guild=-1}if(l=="setspecial"||l=="crop"||l=="cancel"||l=="rename_animal"||l=="buyanimal"){hideDiv("globaltransp");hideDiv("globalbox")}if(l=="crop"){if(q[3]&&q[3].level){levelupAlert(q[3].level,q[3].leveltitle)}if(q[2]){globalerrorbox(q[2])}var m=getRandom(1,3);showFeedback("production_feedback",randcroptext[m])}if(l=="crop"||l=="cancel"){if(run[h]){window.clearInterval(run[h]);temp_reachlimit[h]=0;run[h]=0}}if(b.tutorial==8){showTutorial(15,2)}if(q.guildjob_log){jobProductionInfoFlyer(a,h,q.guildjob_log)}}}}function newBuildingInner(a,l){if(buildingdata[a]&&buildingdata[a][l]){var d=buildingdata[a][l];setBuildingInnerInfo(a,l,d);var n="";if((d.buildingid==11&&d.level>=2)||(d.buildingid==15&&d.level>=4)){n="_2"}$("building_inner").className="building_inner_back"+d.buildingid+n;$("feed_line").className="feed_line"+d.buildingid;$("animal_talkbox").className="animal_talkbox"+d.buildingid;hideDiv("production_info_cancel");hideDiv("production_info_speedup");$("production_info_cancel").onclick=new Function("");if($("production_info_speedup")){$("production_info_speedup").onclick=new Function("")}hideDiv("feedtrough");if(d.remain>0){$("feedtrough").className="feedtrough"+d.buildingid;$("production_info_cancel").onclick=new Function("buildingInnerDialogBox('cancel',"+a+","+l+")");if($("production_info_speedup")){$("production_info_speedup").onclick=new Function("globalSpeedupBox('speedup_addon', "+l+", 1)")}}hideDiv("production_box");buildBuildingInnerProductionBox(a,l,d.buildingid);for(var c=1;c<=30;c++){if($("inner_special"+c)){if(d.buildingid==c){showDiv("inner_special"+c)}else{hideDiv("inner_special"+c)}}for(var e=1;e<=5;e++){if($("building_inner_update"+c+"_"+e)){if(c==d.buildingid&&e<=d.level){showDiv("building_inner_update"+c+"_"+e)}else{hideDiv("building_inner_update"+c+"_"+e)}}}}if(d.feed){rewriteBuildingInnerFeed(a,l)}var q=0;if(d.animals){q=rewriteBuildingInnerAnimals(a,l)}if(d.pid){$("production_info_name").innerHTML=produkt_name[d.pid];var n="";if(produkt_ernte_bonus[d.pid]&&d.animals.amount){n='&nbsp;<span class="rack_cropbonus">+'+((produkt_ernte_bonus[d.pid]*d.animals.amount)+q)+"</span>"}$("production_info_crop").innerHTML=d.crop+n;var b=d.time;if(d.remain){b=d.remain}$("production_info_time").innerHTML=formatTime(b)}else{$("animal_talkbox").innerHTML=infotext[d.buildingid][1]}hideDiv("animal_specials");if(d.specials){var h='<div class="animal_specials_flex">';for(var e=0;e<d.specials.length;e++){h+='<div id="animal_special_head'+d.buildingid+"_"+d.specials[e].action+'" class="link animal_special_head'+d.buildingid+"_"+d.specials[e].action+' animal_special_item" onmouseover="showDiv(\'animal_special_item'+e+"_tt')\" onmouseout=\"hideDiv('animal_special_item"+e+'_tt\')" onclick="buildingInnerAnimalSpecialSelect('+a+","+l+","+d.specials[e].action+')">';h+='  <div id="animal_special_item'+e+'_tt" class="animal_special_item_tt ttbox">';h+='    <div class="title">'+d.specials[e].title+"</div>";if(d.specials[e].cropbonus){h+="<div>"+str_replace("%BONUS%",d.specials[e].cropbonus,t_animal_special_cropbonus)+"</div>"}if(d.specials[e].productiontime){h+="<div>"+str_replace("%TIME%",formatTime(d.specials[e].productiontime),t_cropaction_productiontime)+"</div>"}h+='    <div class="bonusinfo">'+t_animal_special_howtouse+"</div>";h+="  </div>";h+="</div>"}h+="</div>";$("animal_specials").innerHTML=h;showDiv("animal_specials")}stopBuildingRunner();setBuildingInnerStatus(a,l);if(typeof d.remain!="undefined"){building_runner=window.setInterval("setBuildingInnerStatus("+a+","+l+")",1000)}else{var n="";if(d.timebonus){n="&nbsp;(-"+d.timebonus+"%)"}var h=str_replace("%TIME%",'<span class="red">'+formatTime(d.time)+n+"</span>",infotext[d.buildingid][1]);var m=checkInnerBuildingFood(a,l);if(m){h=m}$("animal_talkbox").innerHTML=h}showDiv("transp");showDiv("building_inner")}}function rewriteBuildingInnerAnimals(b,m){var t=0;var d=buildingdata[b][m];var r=d.animals.type;$("animal_line").className="animal_line"+r;var l="";var q=d.animals.amount;if(ghost_visible==1){q=d.animals.max}for(var e=1;e<=q;e++){var a=new Object;if(d.animals.pos&&d.animals.pos[e]){a=d.animals.pos[e]}var c="animal_"+b+"_"+m+"_"+e;var n="animal"+r;if(a.special){n+="_special"+a.special}var s="";var h="";if(ghost_visible==1&&e>d.animals.amount){s="_ghost";h="buildingInnerDialogBox('buyanimal', "+b+", "+m+")"}l+='<div id="'+c+'" class="link animal_item'+s+" animalbox animalbox"+r+'" ';if(a.name||(a.special_data&&a.special_data.title)){l+="onmouseover=\"showDiv('"+c+"_tt')\" onmouseout=\"hideDiv('"+c+"_tt')\""}if(h!=""){l+=' onclick="'+h+'"'}l+=" >";l+='  <div class="animalimg '+n+s+'"></div>';if(a.name||(a.special_data&&a.special_data.title)){l+='<div id="'+c+'_tt" class="ttbox animal_tt_'+r+'">';if(a.special_data&&a.special_data.title){l+='<div class="title">'+a.special_data.title+"</div>"}if(a.name){l+='<div class="bold">'+a.name+"</div>"}if(a.special_data){if(a.special_data.cropbonus){l+='<div class="bonusinfo">'+str_replace("%BONUS%",a.special_data.cropbonus,t_animal_special_cropbonus)+"</div>";t+=a.special_data.cropbonus}if(a.special_data.productiontime){l+='<div class="bonusinfo">'+str_replace("%TIME%",formatTime(a.special_data.productiontime),t_cropaction_productiontime)+"</div>"}}l+="</div>"}l+="</div>"}l+='<div class="clear"></div>';$("animal_line").innerHTML=l;return t}function buildingInnerRenameAnimal(a,b){buildingInnerDialogBox("rename_animal",farm,a,0,b)}function rewriteBuildingInnerFeed(e,a){var d=buildingdata[e][a];var c="";c+='<div id="building_inner_feedline_normal" style="float:left;">';for(var b in d.feed){if(checkRackItem(b,e)>0){c+=htmlBuildingInnerFeed(e,a,b,d,0)}}c+="</div>";if(checkIsValidGuildJobProduct()){var h="float:left; margin-left:50px;";if(d.buildingid==5){h=""}c+='<div id="building_inner_feedline_guild" style="'+h+'">';for(var b in building_inner_data.data.feed){if(job_data.guild_job_data.stock[b]){c+=htmlBuildingInnerFeed(e,a,b,d,1)}else{c+='<div style="float:left; position:relative; margin-top:5px; margin-right:5px; width:41px; height:55px;" onmouseover="showDiv(\'building_inner_feedline_guild'+b+"_tt');\" onmouseout=\"hideDiv('building_inner_feedline_guild"+b+"_tt')\">";c+='  <div class="guildjob_orderpoints" style="position:absolute; right:0px;"></div>';c+='  <div class="sack" style="opacity:0.5;">';c+='    <div class="e'+b+' img_sack"></div>';c+="  </div>";c+='  <div id="building_inner_feedline_guild'+b+'_tt" class="ttbox" style="width:100px;">'+str_replace("%PRODUCT%",produkt_name[b],t_guildjob_startproduction_need_products)+"</div>";c+="</div>"}}c+="</div>"}c+='<div class="clear"></div>';$("feed_line").innerHTML=c;showDiv("building_inner_feedline_guild");showDiv("building_inner_feedline_normal");if(farms_data.farms[e][a].production){if(farms_data.farms[e][a].production[0].guild==1){hideDiv("building_inner_feedline_normal")}else{hideDiv("building_inner_feedline_guild")}}}function htmlBuildingInnerFeed(h,a,b,e,d){var l="_normal";if(d==1){l="_guild"}var c="";c+='<div id="feed_item'+b+l+'" class="link feed_item">';if(d==1){c+='<div class="guildjob_orderpoints" style="position:absolute; z-index:10; right:-5px;"></div>'}c+='  <div style="position:relative; margin:5px 0 0 5px;" class="sack" onclick="buildingInnerDialogBox(\'feed\','+h+","+a+","+b+","+d+')" onmouseover="showDiv(\'feed_tt'+b+l+"')\" onmouseout=\"hideDiv('feed_tt"+b+l+"')\">";c+='    <div class="e'+b+' img_sack"></div>';c+='    <div id="feed_tt'+b+l+'" class="feed_tt'+e.buildingid+' ttbox">';c+='      <div><span class="bold">'+produkt_name[b]+"</span><br>"+t_inner_savetime+"<br>"+formatTime(e.feed[b].time)+'</div><div class="bonusinfo">'+t_inner_feedinfo+"</div>";if(d==1){c+='<div class="bonusinfo">'+t_guildjob_stock_info+"</div>"}c+="    </div>";c+="  </div>";c+="</div>";return c}function buildBuildingInnerProductionBox(c,a,d){var b="";if(d==2){b+='<div style="position:absolute; bottom:0px; right:0px; width:100px; height:138px;">';b+='  <div id="production_box_back" style="position:absolute; top:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'inner_egg_back.png)"></div>';b+='  <div id="production_box_inner" style="position:absolute; bottom:0px; left:0px; width:100%; height:0; background:url('+imgpath+'inner_egg_front.gif) bottom left;"></div>';b+="</div>"}if(d==3){b+='<div style="position:absolute; bottom:0px; right:0px; width:68px; height:160px;">';b+='  <div id="production_box_back" style="position:absolute; top:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'milkcan_back.png);"></div>';b+='  <div id="production_box_inner" style="position:absolute; bottom:20px; left:13px; width:42px; height:111px; background:url('+imgpath+'milkcan_milk.png) bottom left no-repeat;"></div>';b+='  <div id="production_box_front" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'milkcan_front.png) bottom left;"></div>';b+="</div>"}if(d==4){b+='<div style="position:absolute; bottom:0px; right:0px; width:96px; height:125px;">';b+='  <div id="production_box_back" style="position:absolute; top:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'sheep_back.png);"></div>';b+='  <div id="production_box_inner" style="position:absolute; top:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'sheep_wolle.png) top left no-repeat;"></div>';b+='  <div id="production_box_front" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'sheep_front.png) bottom left;"></div>';b+="</div>"}if(d==5){b+='<div style="position:absolute; bottom:0px; right:0px; width:95px; height:126px;">';b+='  <div id="production_box_inner" style="position:absolute; bottom:3px; left:0px; width:100%; height:105px; background:url('+imgpath+'honeyglass_honey.png) top left;"></div>';b+='  <div id="production_box_front" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'honeyglass_front.png) bottom left;"></div>';b+="</div>"}if(d==11){b+='<div style="position:absolute; bottom:0px; right:0px; width:99px; height:176px;">';b+='  <div id="production_box_back" style="position:absolute; top:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'fish_back2.png);"></div>';b+='  <div id="production_box_inner" style="position:absolute; bottom:30px; left:14px; width:70px; height:100px; background:url('+imgpath+'fish_inner2.gif) bottom left no-repeat;"></div>';b+='  <div id="production_box_front" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'fish_front2.png) bottom left;"></div>';b+="</div>"}if(d==12){b+='<div style="position:absolute; bottom:0px; right:0px; width:68px; height:160px;">';b+='  <div id="production_box_inner" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'goat_inner.png) bottom left;"></div>';b+='  <div id="production_box_front" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'goat_front.png) bottom left;"></div>';b+="</div>"}if(d==15){b+='<div style="position:absolute; bottom:0px; right:0px; width:115px; height:144px;">';b+='  <div id="production_box_back" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'angora_back.png) bottom left;"></div>';b+='  <div id="production_box_inner" style="position:absolute; bottom:0px; left:0px; width:100%; height:100%; background:url('+imgpath+'angora_front.png) bottom left;"></div>';b+="</div>"}if(farms_data.farms[c][a]&&farms_data.farms[c][a].production&&farms_data.farms[c][a].production[0].guild&&farms_data.farms[c][a].production[0].guild==1){b+='<div style="position:absolute; right:0px; bottom:115px;" class="guildjob_orderpoints"></div>'}$("production_box").innerHTML=b}function closeBuildingInner(){stopBuildingRunner();hideDiv("transp");hideDiv("building_inner");if($("innermaincontainer")){hideDiv("innermaincontainer")}if($("beaker_7_3")){hideDiv("beaker_7_3")}}function checkBuildingInnerFeed(e,a){var d=buildingdata[e][a];for(var b in d.feed){for(var c=1;c<=2;c++){if(c==1){var h=checkRackItem(b,e);if(!h||typeof h=="undefined"){hideDiv("feed_item"+b+"_normal")}else{showDiv("feed_item"+b+"_normal")}}else{if(c==2){if(job_data&&job_data.guild_job_data&&job_data.guild_job_data.stock[b]){showDiv("feed_item"+b+"_guild")}else{hideDiv("feed_item"+b+"_guild")}}}}}}function buildingInnerDeactiveFeedItem(a){for(var b=1;b<=2;b++){var c="_normal";if(b==2){c="_guild"}if($("feed_item"+a+c)){$("feed_item"+a+c).addClassName("transparent");$("feed_item"+a+c).onclick=new Function("");if($("feed_tt"+a+c)){$("feed_tt"+a+c).innerHTML='<div class="bonusinfo">'+error1006+"</div>"}}}}function buildingInnerAnimalSpecialSelect(e,a,d){if(building_animal_special_select==d){building_animal_special_select=0}else{building_animal_special_select=d}for(var b=0;b<buildingdata[e][a].specials.length;b++){var h="animal_special_head"+buildingdata[e][a].buildingid+"_"+buildingdata[e][a].specials[b].action;$(h).removeClassName(h+"_active");$(h).addClassName(h)}var h="animal_special_head"+buildingdata[e][a].buildingid+"_"+d;if(building_animal_special_select){$(h).removeClassName(h);$(h).addClassName(h+"_active")}else{$(h).removeClassName(h+"_active");$(h).addClassName(h)}var c=buildingdata[e][a];for(var b=1;b<=c.animals.amount;b++){var h="animal_"+e+"_"+a+"_"+b;if(building_animal_special_select){$(h).onclick=new Function("buildingInnerDialogBox('setspecial',"+e+","+a+",0,"+b+")")}}}function buildingInnerAnimalSpecialDeselect(d,a){building_animal_special_select=0;var c=buildingdata[d][a];for(var b=1;b<=c.animals.amount;b++){var e="animal_"+d+"_"+a+"_"+b;if(rename_animal_allowed==1){$(e).onclick=new Function("buildingInnerRenameAnimal("+a+", "+b+")")}else{$(e).onclick=new Function("")}}}function feedCache(b,a){if(!building_feed_cache[b]){building_feed_cache[b]=1}else{building_feed_cache[b]++}var c=1500;if(tutorial>0){c=100}if(!building_feed_cache_timer){building_feed_cache_timer=window.setTimeout("feedCacheFire("+b+", "+a+")",c)}}function feedCacheFire(b,a){buildingInnerAction("feed",farm,a,b,building_feed_cache_guild)}function buildingInnerDialogBox(m,e,v,n,d){var w=buildingdata[e][v];if(m=="buyanimal"){var h=t_inner_buyanimal_headline;var s=str_replace("%COST%",formatPrice(w.animals.next),t_inner_buyanimal_content);var q="buildingInnerAction('"+m+"','"+e+"','"+v+"')";globalcommitbox(h,s,q)}if(m=="feed"){var r=d;if(!calcBuildingInnerFeedRestTime(e,v,n)){return false}var h=infoinnerbuildingcropheadline;var s="";if(premium||(currentuserlevel>=teaserfeedpopupmin&&currentuserlevel<teaserfeedpopupmax)){if(r==1){var a=job_data.guild_job_data.stock[n]}else{var a=checkRackItem(n,e)}s+='<div class="building_dialogbox_line">';s+='  <div class="tt'+n+' float"></div>';s+='  <div class="float">';s+='    <div class="building_dialogbox_line bold">&nbsp;'+produkt_name[n]+"</div>";s+='    <div class="building_dialogbox_line">&nbsp;'+t_inner_savetime+"&nbsp;"+formatTime(w.feed[n].time)+"</div>";s+="  </div>";s+='  <div class="clear"></div>';s+="</div>";s+='<div class="building_dialogbox_line">'+infoinnerbuildingcropdesc+"</div>";s+='<div id="building_dialogbox_input_line" class="building_dialogbox_line">';s+='  <input type="number" id="building_dialogbox_input" value="1" maxlength="4" onkeyup="calcBuildingInnerInput(0,\''+m+"',"+e+","+v+","+n+","+r+')" onchange="calcBuildingInnerInput(0,\''+m+"',"+e+","+v+","+n+","+r+')">&nbsp;'+t_inner_stock+"&nbsp;"+a+'&nbsp;<button class="button_new link" id="building_dialogbox_submit" type="button" onclick="buildingInnerAction(\'feed\','+e+","+v+","+n+","+r+')">'+t_inner_feedsubmit+"</button></div>";if(r==1){s+='<div class="bonusinfo">'+t_guildjob_stock_info+"</div>"}s+='<div style="position:relative; text-decoration:underline" class="bonusinfo building_dialogbox_line" onmouseover="showDiv(\'building_resttime_tt\')" onmouseout="hideDiv(\'building_resttime_tt\')"><span style="">'+t_inner_feedresttime+'</span>&nbsp;<span id="building_dialogbox_resttime">'+formatTime(w.rest)+"</span>";s+='  <div id="building_resttime_tt" class="ttbox" style="position:absolute; top:20px; left:0px; font-style:normal;">'+t_inner_resttimedesc+"</div>";s+="</div>";s+='<div class="bonusinfo building_dialogbox_line">'+t_inner_feedrestproductiontime+'&nbsp;<span id="building_dialogbox_restproductiontime" class="bold">'+formatTime(w.time)+"</span></div>"}else{if(building_feed_cache_guild>-1&&building_feed_cache_guild!=r){return false}building_feed_cache_guild=r;feedCache(n,v);return true}}else{if(m=="cancel"){var h=t_inner_productioncancel;var s=t_inner_productioncancel_info;var q="buildingInnerAction('"+m+"','"+e+"','"+v+"')";globalcommitbox(h,s,q)}else{if(m=="crop"){var h=animalcropheadline;var s=infotext[w.buildingid][3];var q="buildingInnerAction('"+m+"',"+e+","+v+")";var l="hideDiv('globaltransp'); hideDiv('globalbox'); closeBuildingInner()";globalcommitbox(h,s,q,l)}else{if(m=="setspecial"){if(!building_animal_special_select){buildingInnerRenameAnimal(v,d)}else{var z="";for(var u=0;u<buildingdata[e][v].specials.length;u++){if(building_animal_special_select==buildingdata[e][v].specials[u].action){z=buildingdata[e][v].specials[u].title}}var h=t_animal_setspecial_head+" ("+z+")";var s=t_animal_setspecial_body;var q="buildingInnerAction('"+m+"',"+e+","+v+",0,"+d+")";if(buildingdata[e][v].animals&&buildingdata[e][v].animals.pos&&buildingdata[e][v].animals.pos[d]&&buildingdata[e][v].animals.pos[d].special){q="closeBuildingInnerDialogBox(); buildingInnerDialogBox('setspecial2',"+e+","+v+",0,"+d+")"}globalcommitbox(h,s,q)}}else{if(m=="setspecial2"){var b=buildingdata[e][v].animals.pos[d].special;var A="";for(var t in animal_special_config){if(animal_special_config[t][b]){A=animal_special_config[t][b].title}}var h=t_animal_setspecial_head;var s=t_animal_setspecial_body2.replace("%NAME%","<b>"+A+"</b>");var q="buildingInnerAction('setspecial',"+e+","+v+",0,"+d+")";globalcommitbox(h,s,q);return 1}else{if(m=="rename_animal"){var h=t_animal_rename;var s="";var c="";if(w.animals.pos[d]&&w.animals.pos[d].name){c=w.animals.pos[d].name}s+="<div>"+cityadcost;if(rename_animal_cost.money>0){s+=formatPrice(rename_animal_cost.money)}s+="</div>";s+='<input type="text" id="buildinginner_renameanimal" maxlength="15" value="'+c+'">';var q="buildingInnerAction('"+m+"',"+e+","+v+",0,"+d+")";globalcommitbox(h,s,q);$("buildinginner_renameanimal").focus()}}}}}}if(m=="crop"){$("building_dialogbox_close").onclick=new Function("closeBuildingInner()")}else{$("building_dialogbox_close").onclick=new Function("closeBuildingInnerDialogBox()")}if(m!="setspecial"&&m!="rename_animal"&&m!="crop"&&m!="cancel"&&m!="buyanimal"){$("building_dialogbox_headline").innerHTML=h;$("building_dialogbox_content").innerHTML=s;showDiv("building_dialogbox_transp");showDiv("building_dialogbox")}if(m=="feed"){if(premium){var r=d;calcBuildingInnerInput(1,m,e,v,n,r);$("building_dialogbox_input").focus();$("building_dialogbox_input").select()}}}function closeBuildingInnerDialogBox(){if($("building_dialogbox_input")){$("building_dialogbox_input").blur()}hideDiv("building_dialogbox_transp");hideDiv("building_dialogbox");building_show_feed=0}function calcBuildingInnerFeedRestTime(a,n,m){var e=buildingdata[a][n];if(m){building_show_feed=m;var h=new Object;h[m]={time:e.feed[m].time}}else{var h=e.feed}var d=0;for(var r in h){if(building_show_feed&&building_show_feed==r&&(e.feed[building_show_feed].time&&e.rest<e.feed[building_show_feed].time)){buildingInnerDeactiveFeedItem(building_show_feed);closeBuildingInnerDialogBox();break}if(e.rest>=e.feed[r].time){if($("building_dialogbox_resttime")){var q=0;var b=e.rest;if($("building_dialogbox_input")&&$("building_dialogbox_input").value&&building_show_feed){q=($("building_dialogbox_input").value*e.feed[building_show_feed].time);b=(b-q);if(b<0){var l=Math.floor(e.rest/e.feed[building_show_feed].time);$("building_dialogbox_input").value=l}}$("building_dialogbox_resttime").innerHTML=formatTime(b);var c=e.time;if(e.remain){c=e.remain}$("building_dialogbox_restproductiontime").innerHTML=formatTime(c-q)}d++}else{buildingInnerDeactiveFeedItem(r)}}if(d){return 1}if(m){closeBuildingInnerDialogBox()}return 0}function calcBuildingInnerInput(q,l,a,h,e,c){var b=buildingdata[a][h];if(l=="feed"){var n=Math.floor(b.rest/b.feed[e].time);if(c==1){var m=0;if(job_data.guild_job_data.stock&&job_data.guild_job_data.stock[e]){m=job_data.guild_job_data.stock[e]}}else{var m=checkRackItem(e,a)}if(m<n){n=m}if(q){var d=n}else{var d=$("building_dialogbox_input").value;if(d!=""){d=parseInt(d)}if(d>n){d=n}if(d!=""&&isNaN(d)){d=1}}$("building_dialogbox_input").value=d;calcBuildingInnerFeedRestTime(a,h,e)}}function checkInnerBuildingFood(a,l){var d=buildingdata[a][l];var e=infotext_nonefood;var m=0;var n=1;if(setarab){var b="right"}else{var b="left"}for(var h in d.feed){if(checkRackItem(h,a)>0){m++}var c='<div style="float:'+b+';" class="kp'+h+'"></div><div style="float:'+b+';">&nbsp;'+produkt_name[h]+'</div><div class="clear"></div>';e=str_replace("%PRODUCT"+n+"%",c,e);n++}if(!m){return e}else{return 0}}function setBuildingInnerStatus(a,m){building_runner_runtime++;var b=buildingdata[a][m];if(b.rest&&b.remain){b.rest--}if(b.remain){b.remain--}for(var c=1;c<=20;c++){if($("animal_feedanimation"+c)){hideDiv("animal_feedanimation"+c)}}var l="";if(b.rest>0){if(calcBuildingInnerFeedRestTime(a,m,0)){l=str_replace("%TIME%",'<span class="red">'+formatTime(b.time/2)+"</span>",infotext[b.buildingid][2])}else{b.rest=0}var q=checkInnerBuildingFood(a,m);if(q){l=q}}else{calcBuildingInnerFeedRestTime(a,m,0);l=infotext[b.buildingid][4]}var r={"3":111,"5":105,"11":100,"12":160};if(b.remain>0){$("production_info_time").innerHTML=formatTime(b.remain);$("feedtrough").className="feedtrough"+b.buildingid;showDiv("feedtrough");showDiv("production_info_cancel");showDiv("production_info_speedup");var n=(b.remain*100/b.time);if(r[b.buildingid]){var s=r[b.buildingid]}else{var s=$("production_box_back").getHeight()}var e=(s/100);$("production_box_inner").style.height=(s-(e*n))+"px";if($("animal_feedanimation"+b.buildingid)){showDiv("animal_feedanimation"+b.buildingid)}}else{if(typeof b.remain!="undefined"){if($("animal_feedanimation"+b.buildingid)){hideDiv("animal_feedanimation"+b.buildingid)}hideDiv("feedtrough");hideDiv("production_info_cancel");hideDiv("production_info_speedup");$("production_info_time").innerHTML=statusProductionComplete;l=infotext[b.buildingid][3];var d="100%";if(r[b.buildingid]){d=r[b.buildingid]+"px"}if($("production_box_inner")){$("production_box_inner").style.height=d}buildingInnerDialogBox("crop",a,m)}}checkBuildingInnerFeed(a,m);$("animal_talkbox").innerHTML=l;if(typeof b.remain!="undefined"){showDiv("production_info");showDiv("production_box")}else{hideDiv("production_box")}if(!(b.rest>0||b.remain>0)){stopBuildingRunner()}}function stopBuildingRunner(){building_runner_runtime=0;window.clearInterval(building_runner)}function ignoreBuildingElements(){for(var a=0;a<building_ignore_elements.length;a++){hideDiv(building_ignore_elements[a])}}var pony_position=0;var pony_sel_pony=0;var pony_sel_farmi=0;var pony_sel_farmi_pos=0;var pony_speedup_select=0;var pony_speedup_reduce=0;function ponyHelp(){showDiv("pony_help");showDiv("pony_help_transp")}function ponyHelpClose(){hideDiv("pony_help");hideDiv("pony_help_transp")}function ponyBuild(a,e){if(a){pony_position=a}ignoreBuildingElements();var c="";c+='<div id="pony_ponys">';for(var b=1;b<=3;b++){c+='<div class="pony_item pony_item'+b+'">';c+='  <div id="pony'+b+'" class="link"></div>';c+='  <div id="pony'+b+'_plate">';c+='    <div id="pony'+b+'_ride"></div>';c+='    <div id="pony'+b+'_farmi"></div>';c+='    <div id="pony'+b+'_speedup" class="pony_button2 pony_button_speedup link" onmouseover="showDiv(\'pony'+b+"_speedup_tt')\" onmouseout=\"hideDiv('pony"+b+"_speedup_tt')\">";c+='      <div id="pony'+b+'_speedup_tt" class="ttbox pony_speedup_tt">'+t_pony_speedup_tt+"</div>";c+="    </div>";c+='    <div id="pony'+b+'_crop" class="pony_button2 pony_button_crop link" onmouseover="showDiv(\'pony'+b+"_crop_tt')\" onmouseout=\"hideDiv('pony"+b+"_crop_tt')\">";c+='      <div id="pony'+b+'_crop_tt" class="ttbox pony_crop_tt">'+t_pony_crop_tt+"</div>";c+="    </div>";c+="  </div>";c+='  <div id="pony'+b+'_feed" class="pony_item_feed link" onmouseover="showDiv(\'pony'+b+"_feed_inner_tt')\" onmouseout=\"hideDiv('pony"+b+"_feed_inner_tt')\">";c+='    <div id="pony'+b+'_feed_inner" class="pony_item_feed_inner">';c+='      <div id="pony'+b+'_feed_preview" class="pony_item_feed_preview"></div>';c+="    </div>";c+='    <div id="pony'+b+'_feed_inner_tt" class="ttbox pony_item_feed_inner_tt"></div>';c+="  </div>";c+='  <div id="pony'+b+'_buy" class="pony_button pony_button_buy link" onmouseover="showDiv(\'pony'+b+"_buy_tt')\" onmouseout=\"hideDiv('pony"+b+"_buy_tt')\">";c+='     <div id="pony'+b+'_buy_tt" class="ttbox pony_buy_tt">'+t_pony_buy+"</div>";c+="   </div>";c+='  <div id="pony'+b+'_rent" class="pony_button pony_button_rent link" onmouseover="showDiv(\'pony'+b+"_rent_tt')\" onmouseout=\"hideDiv('pony"+b+"_rent_tt')\">";c+='    <div id="pony'+b+'_rent_tt" class="ttbox pony_rent_tt">'+t_pony_rent+"</div>";c+="  </div>";c+='  <div id="pony'+b+'_block" class="pony_block" onmouseover="showDiv(\'pony'+b+"_block_tt')\" onmouseout=\"hideDiv('pony"+b+"_block_tt')\">";c+='    <div id="pony'+b+'_block_tt" class="ttbox"></div>';c+="  </div>";c+='  <div id="pony'+b+'_reward" class="pony_reward pony'+b+'_reward"></div>';if(b==3){c+='<div id="pony3_slottimer" class="pony_item_slottimer" onmouseover="showDiv(\'pony3_slottimer_tt\')" onmouseout="hideDiv(\'pony3_slottimer_tt\')">';c+='  <div id="pony3_slottimer_tt" class="ttbox">'+t_pony_rentresttime+"</div>";c+='  <div id="pony3_slottimer_time"></div>';c+="</div>"}c+="</div>"}c+="</div>";c+='<div id="pony_farmis" class="pony_farmis_right">';for(var b=1;b<=3;b++){c+='<div id="pony_farmi'+b+'" class="link pony_farmi_item" onmouseover="ponyPreview('+b+"); showDiv('pony_farmi_static_tt');\" onmouseout=\"hideDiv('pony_farmi_static_tt'); ponyPreview(0);\"></div>"}c+='  <div id="pony_farmi_static_tt" class="ttbox"></div>';c+="</div>";c+='<div class="big_close link" onclick="closeBuildingInner()"></div>';c+='<div id="pony_help_button" class="link" onclick="ponyHelp()"></div>';c+='<div id="pony_help_transp" class="transp"></div>';c+='<div id="pony_help">';c+='  <div id="pony_help_inner">';c+='    <div class="headline">'+t_pony_help_head+"</div>";c+='    <div style="float:left; width:180px; margin-bottom:10px;">'+t_pony_help_step1+"</div>";c+='    <div style="float:left;"><img src="'+imgpath+'pony_help_img1.jpg"></div>';c+='    <div class="clear"></div>';c+='    <div style="float:left; width:180px; margin-bottom:10px;">'+t_pony_help_step2+"</div>";c+='    <div style="float:left; margin-bottom:25px;"><img src="'+imgpath+'pony_help_img2.jpg"></div>';c+='    <div class="clear"></div>';c+='    <div style="float:left; width:180px;">'+t_pony_help_step3+"</div>";c+='    <div style="float:left;"><img src="'+imgpath+'pony_help_img3.jpg"></div>';c+='    <div class="clear"></div>';c+="  </div>";c+='  <div class="link close" onclick="ponyHelpClose()"></div>';c+="</div>";$("innercontent").innerHTML=c;$("innermaincontainer").className="inner_back inner_back18";ponyBuildFarmis(e);ponyBuildPonys();if(pony_data.reward){showDiv("pony"+pony_data.reward.pos+"_reward");var c="<div>"+formatNumber(pony_data.reward.points)+"&nbsp;"+t_points+"</div>";c+="<div>"+formatPrice(pony_data.reward.bar)+"</div>";$("pony"+pony_data.reward.pos+"_reward").innerHTML=c;new Effect.Move("pony"+pony_data.reward.pos+"_reward",{x:0,y:-60,mode:"relative"});var d=new Effect.Opacity("pony"+pony_data.reward.pos+"_reward",{duration:5,transition:Effect.Transitions.linear,from:1,to:0});pony_data.reward=0}}function ponyBuildFarmis(b){var a=1;for(id in pony_data.farmis){var c=pony_data.farmis[id];if(c.status==0&&$("pony_farmi"+a)){if(pony_sel_farmi==id){$("pony_farmi"+a).addClassName("pony_farmi"+c.type+"_select")}else{$("pony_farmi"+a).removeClassName("pony_farmi"+c.type+"_select")}$("pony_farmi"+a).onclick=new Function("pony_sel_farmi_pos="+a+"; ponySelectFarmi("+id+")");$("pony_farmi"+a).addClassName("pony_farmi"+c.type);a++}}if(b=="pony_setfarmi"){if(!("transition" in $("pony_farmis").style)&&!("webkitTransition" in $("pony_farmis").style)){return false}$("pony_farmis").className="pony_farmis_off";setTimeout(ponyFarmiQueue1,500)}}function ponyFarmiQueue1(){var a=1;for(id in pony_data.farmis){var b=pony_data.farmis[id];if(b.status==0&&$("pony_farmi"+a)){$("pony_farmi"+a).addClassName("pony_farmi"+b.type+"_walk");a++}}$("pony_farmis").className="pony_farmis_right";setTimeout(ponyFarmiQueue2,2600)}function ponyFarmiQueue2(){var a=1;for(id in pony_data.farmis){var b=pony_data.farmis[id];if(b.status==0&&$("pony_farmi"+a)){$("pony_farmi"+a).removeClassName("pony_farmi"+b.type+"_walk");a++}}}function ponyPreview(m){if(!m&&pony_sel_farmi_pos>0){m=pony_sel_farmi_pos}for(var b=1;b<=3;b++){$("pony"+b+"_feed_preview").style.height="0px";$("pony"+b).removeClassName("pony"+b+"_inactive");var e=1;for(id in pony_data.farmis){var a=pony_data.farmis[id];if(a.status==0&&$("pony_farmi"+e)&&pony_data.ponys[b].data){var l=0;var n=a.data.energy;if(pony_data.ponys[b].data&&pony_data.ponys[b].data.feed>=0){if(n>pony_data.ponys[b].data.feed){l=1;n=pony_data.ponys[b].data.feed}}var h=(n*100/8);var d=(147/100);var q=(h*d);if(e==m){if(pony_data.ponys[b].data.feed>=0){if(l>0){$("pony"+b).addClassName("pony"+b+"_inactive");$("pony"+b+"_feed_preview").style.backgroundColor="#f00"}else{$("pony"+b+"_feed_preview").style.backgroundColor="#0f0"}$("pony"+b+"_feed_preview").style.height=q+"px"}var c="";c+='<div style="font-weight:bold;">'+t_pony_tt_need+"</div>";c+='<div style="float:left; width:50px;">'+t_pony_time+"</div>";c+='<div style="float:right">'+formatTime(a.data.time)+"</div>";c+='<div class="clear"></div>';c+='<div style="float:left; width:50px;">'+t_pony_energy_farmi+"</div>";c+='<div style="float:right">'+a.data.energy+"</div>";c+='<div class="clear"></div>';c+='<div style="font-weight:bold; margin-top:10px;">'+t_pony_tt_reward+"</div>";c+='<div style="float:left; width:50px;">'+t_pony_bar+"</div>";c+='<div style="float:right">'+formatPrice(a.data.money)+"</div>";c+='<div class="clear"></div>';c+='<div style="float:left; width:50px;">'+t_pony_points+"</div>";c+='<div style="float:right">'+formatNumber(a.data.points)+"</div>";c+='<div class="clear"></div>';$("pony_farmi_static_tt").innerHTML=c}e++}}}}function ponyBuildPonys(){$("pony3_slottimer_time").innerHTML="";var n=0;var h=0;var b={"1":0,"2":0,"3":0};for(i=1;i<=3;i++){var c=pony_data.ponys[i];if($("pony"+i+"_timer")){$("pony"+i+"_timer").innerHTML=""}if($("pony"+i)){if(pony_sel_pony==c.animalid){$("pony"+i).addClassName("pony"+i+"_over")}else{$("pony"+i).removeClassName("pony"+i+"_over")}$("pony"+i).onclick=new Function("ponySelectPony("+c.animalid+")");hideDiv("pony"+i+"_timer");hideDiv("pony"+i+"_slottimer");hideDiv("pony"+i+"_speedup");hideDiv("pony"+i+"_crop");hideDiv("pony"+i+"_buy");hideDiv("pony"+i+"_rent");hideDiv("pony"+i+"_block");showDiv("pony"+i+"_feed");hideDiv("pony"+i+"_plate");hideDiv("pony"+i+"_reward");$("pony"+i+"_feed").onclick=new Function("");if(c.data&&c.data.feed){if(c.data.feed==0){var m=0}else{var e=(147/100);var l=((c.data.feed*100)/8);var m=(l*e)}$("pony"+i+"_feed_inner").style.height=m+"px"}if(!c.block){$("pony"+i+"_feed").onclick=new Function("ponyDialog('feed', "+i+")")}if(c.data){$("pony"+i+"_feed_inner_tt").innerHTML=t_pony_energy+"&nbsp;"+c.data.feed+"/8";if(c.data.farmi){$("pony"+i).onclick=new Function("");$("pony"+i+"_feed").onclick=new Function("");var a=c.data.farmi;$("pony"+i+"_ride").className="";if(pony_data.farmis[a]&&pony_data.farmis[a].data){var d="";d+="<div>"+formatPrice(pony_data.farmis[a].data.money)+"</div>";d+="<div>"+formatNumber(pony_data.farmis[a].data.points)+"&nbsp;"+t_points+"</div>";d+='<div style="font-weight:bold;" id="pony'+i+'_timer"></div>';$("pony"+i+"_farmi").innerHTML=d;showDiv("pony"+i+"_plate");if(pony_data.farmis[a].data.remain>0){h++;if(!gametimer.ponytimer){gametimer.ponytimer={}}gametimer.ponytimer[i]=1;if(!pony_data.farmis[a].data.speedup||(pony_data.farmis[a].data.speedup&&pony_data.farmis[a].data.speedup<pony_data.farmis[a].data.maxspeedup)){showDiv("pony"+i+"_speedup");$("pony"+i+"_speedup").onclick=new Function("ponyDialog('speedup', "+i+")")}$("pony"+i+"_ride").addClassName("pony_ride pony"+pony_data.farmis[a].type+"_ride");if(!b[i]){$("pony"+i+"_feed_inner_tt").innerHTML+='<div class="bonusinfo important">'+t_pony_feed_farmi_waiting2+"</div>";b[i]++}}else{n++;hideDiv("pony"+i+"_timer");showDiv("pony"+i+"_crop");if(i==3&&c.block){$("pony"+i+"_crop_tt").innerHTML+='<div class="bonusinfo important">'+t_pony_get_reward_info+"</div>"}if(!c.block){$("pony"+i+"_crop").onclick=new Function("farmAction('pony_crop',"+farm+","+pony_position+", "+i+")")}$("pony"+i+"_ride").addClassName("pony_rideoff pony"+pony_data.farmis[a].type+"_rideoff");if(!b[i]){$("pony"+i+"_feed_inner_tt").innerHTML+='<div class="bonusinfo important">'+t_pony_feed_farmi_waiting+"</div>";b[i]++}}}}if(c.data.remain){if(c.data.remain>0){showDiv("pony3_slottimer");if(!gametimer.ponyslottimer){gametimer.ponyslottimer=1}}}}if(c.block==1){if(c.cost&&c.cost.money){showDiv("pony"+i+"_buy");$("pony"+i+"_buy").onclick=new Function("ponyDialog('buy', "+i+")");if(!b[i]){$("pony"+i+"_feed_inner_tt").innerHTML+='<div class="bonusinfo important">'+t_pony_feed_buy+"</div>";b[i]++}}if(c.cost&&c.cost.coins){hideDiv("pony3_speedup");showDiv("pony"+i+"_rent");$("pony"+i+"_rent").onclick=new Function("ponyDialog('buy', "+i+")");if(!b[i]){$("pony"+i+"_feed_inner_tt").innerHTML+='<div class="bonusinfo important">'+t_pony_feed_buy+"</div>";b[i]++}}if(currentuserlevel<c.cost.level&&i>1){$("pony"+i+"_block_tt").innerHTML=str_replace("%LEVEL%",c.cost.level,noupdate_lowlevel);if(c.cost&&c.cost.money){hideDiv("pony"+i+"_buy")}if(c.cost&&c.cost.coins){hideDiv("pony"+i+"_rent")}showDiv("pony"+i+"_block")}}if(!b[i]){$("pony"+i+"_feed_inner_tt").innerHTML+='<div class="bonusinfo">'+t_pony_feed_info_tt+"</div>"}if((c.block)||(c.data&&c.data.farmi&&pony_data.farmis[c.data.farmi]&&pony_data.farmis[c.data.farmi].data.remain)){}else{$("pony"+i).addClassName("pony"+i)}}}hideDiv("farm_pony_waiting_"+pony_position);hideDiv("farm_pony_running_"+pony_position);if(n>0){showDiv("farm_pony_waiting_"+pony_position)}else{if(h>0){showDiv("farm_pony_running_"+pony_position)}}}function ponyTimer(){var m=0;var b=0;if(gametimer.ponytimer){for(var d in gametimer.ponytimer){var l=pony_data.ponys[d].data.farmi;pony_data.farmis[l].data.remain--;var h=pony_data.farmis[l].data.remain;if($("pony"+d+"_timer")){if(h<0){m++;delete gametimer.ponytimer[d];hideDiv("pony"+d+"_timer");ponyBuildPonys()}else{if($("pony_speedup_resttime")&&$("globalbox").style.display=="block"&&pony_speedup_select==d){if(pony_speedup_reduce>0&&pony_speedup_select==d){var e=(h-pony_speedup_reduce);if(e<0){e=0}}else{e=h}var c=Math.ceil(h/pony_speedup_time);if(c<0){c=0}var a=pony_data.ponys[d];if($("pony_speedup_counter").innerHTML>c){$("pony_speedup_counter").innerHTML=c;pony_data.farmis[a.data.farmi].data.maxspeedup=c;calcPonySpeedup(d)}$("pony_speedup_resttime").innerHTML=formatTime(e)}$("pony"+d+"_timer").innerHTML=formatTime(h);showDiv("pony"+d+"_timer");b++}}}}if(gametimer.ponyslottimer){pony_data.ponys[3].data.remain--;var h=pony_data.ponys[3].data.remain;if(h<0){delete gametimer.ponyslottimer;pony_data.ponys[3].block=1;ponyBuildPonys()}else{if($("pony3_slottimer")){$("pony3_slottimer_time").innerHTML=formatTime(h)}}}}function ponyDialog(h,b,q){var r=0;var c=0;var m="";var l="";if(b){var d=pony_data.ponys[b];var a=0;if(d.data&&d.data.farmi){a=d.data.farmi}}if(h=="speedup"){pony_speedup_select=b;var m=t_pony_speedup_dialog_speedup_head;var n=checkRackItem(d.speedup_feed,farm);if(n){l+='<div style="margin-bottom:4px;">'+t_pony_speedup_dialog_speedup+"</div>";l+='<div id="pony_speedup_counter" style="margin-bottom:4px; height:25px; margin:0 auto; font-weight:bold; width:'+(pony_data.farmis[d.data.farmi].data.maxspeedup*22)+'px;"></div>';l+='<div style="background-color:#C3A75E; padding:5px; border-radius:5px; margin-bottom:4px;">';l+='  <input type="number" id="pony_speedup_amount" value="0" style="float:left; width:40px; font-weight:bold; padding:2px; border-radius:5px; border:1px solid #fff;" onchange="calcPonySpeedup('+b+')" onkeyup="calcPonySpeedup('+b+')">';l+='  <div style="float:left; margin:5px;">'+t_inner_stock+"&nbsp;"+n+"</div>";l+='  <button type="button" style="float:right;" class="button_new link" onclick="farmAction(\'pony_speedup\','+farm+","+pony_position+", "+b+')">'+t_inner_feedsubmit+"</button>";l+='  <div class="clear"></div>';l+="</div>";l+='<div style="margin-bottom:4px;">'+t_pony_speedup_dialog_speeduptime+'&nbsp;<span id="pony_speedup_time"></span></div>';l+='<div style="margin-bottom:4px;">'+t_pony_speedup_dialog_speedupresttime+'&nbsp;<span id="pony_speedup_resttime"></span></div>'}else{globalerrorbox(t_pony_speedup_info_popup);return false}}if(h=="feed"){var m=t_pony_feed;var e=checkRackItem(d.pid_feed,farm);if(d.data.feed>=8){globalerrorbox(t_pony_feed_stop_info_popup);return false}else{if(!e){globalerrorbox(t_pony_feed_info_popup);return false}else{l+='<div style="margin-bottom:4px;">'+t_pony_feed_desc+"</div>";l+='<div style="background-color:#C3A75E; padding:5px; border-radius:5px; margin-bottom:4px;">';l+='  <input type="number" id="pony_feed_amount" style="width:40px; float:left; font-weight:bold; padding:2px; border-radius:5px; border:1px solid #fff;" value="1" onchange="calcPonyFeed('+b+')" onkeyup="calcPonyFeed('+b+')">';l+='  <div style="float:left; margin:5px;">'+t_inner_stock+'&nbsp;<span id="pony_energy_stock"></span></div>';l+='  <button type="button" style="float:right;" class="button_new link" onclick="farmAction(\'pony_feed\','+farm+","+pony_position+", "+b+')">'+t_inner_feedsubmit+"</button>";l+='  <div class="clear"></div>';l+="</div>";l+="<div>"+t_pony_energy_current+'&nbsp;<span id="pony_energy_sum"></span>/8</div>'}}}if(h=="buy"){var e=checkRackItem(d.pid_feed,farm);if(d.cost.money>0){m=t_pony_buy;l="<div>"+str_replace("%MONEY%",formatPrice(d.cost.money),t_pony_buy_desc)+"</div>"}else{if(d.cost.coins>0){m=t_pony_rent;var l=str_replace("%COINS%",d.cost.coins,t_pony_rent_desc);l=str_replace("%TIME%",formatTime(d.cost.duration),l)}}var r="farmAction('pony_buy',"+farm+","+pony_position+", "+b+")";if(!q&&d.cost.coins>0&&!e){l+='<div style="margin-top:10px;">'+t_pony_not_enough_feed+"</div>"}}else{if(h=="setfarmi"){var m=t_pony_speedup_dialog_setfarmihead;var l=t_pony_speedup_dialog_setfarmibody;var r="farmAction('pony_setfarmi',"+farm+","+pony_position+")";c="hideDiv('globaltransp'); hideDiv('globalbox');"}}globalcommitbox(m,l,r,c);if(h=="speedup"){calcPonySpeedup(b)}if(h=="feed"){calcPonyFeed(b,1)}}function calcPonyFeed(m,h){var b=pony_data.ponys[m];var e=checkRackItem(b.pid_feed,farm);var c=$("pony_feed_amount").value;c=parseInt(c);if(c<1){c=1}if(c!=""&&isNaN(c)){c=1}if(c>e){c=e}var d=(8-b.data.feed);var a=(d/1);if(c>a){c=a}var l=0;if(e){l=e}$("pony_energy_stock").innerHTML=l;if(h==1){if(l>a){c=a}else{c=l}$("pony_feed_amount").value=c}else{$("pony_feed_amount").value=c}$("pony_energy_sum").innerHTML=b.data.feed}function calcPonySpeedup(h){if($("pony_speedup_amount")){var a=pony_data.ponys[h];var e=0;if(pony_data.farmis[a.data.farmi].data.speedup){e=pony_data.farmis[a.data.farmi].data.speedup}var b=$("pony_speedup_amount").value;b=parseInt(b);if(b<1){b=0}if(b!=""&&isNaN(b)){b=0}var d=checkRackItem(a.speedup_feed,farm);if(b>d){b=d}var c=(pony_data.farmis[a.data.farmi].data.maxspeedup-e);if(b>c){b=c}if(c<0){c=0}if(b<0){b=0}$("pony_speedup_amount").value=b;pony_speedup_reduce=(b*pony_speedup_time);$("pony_speedup_time").innerHTML=formatTime(pony_speedup_reduce);$("pony_speedup_counter").innerHTML=c}}function ponySelectPony(c){if(!pony_sel_farmi){return false}if(c==pony_sel_pony){pony_sel_pony=0}else{pony_sel_pony=c}ponyBuild();if(pony_sel_pony){var b=0;for(var a in pony_data.farmis){if(pony_data.farmis[a].id==pony_sel_farmi){b=pony_data.farmis[a].data.energy}}for(var a=1;a<=3;a++){if(pony_data.ponys[a].animalid==pony_sel_pony){if(pony_data.ponys[a].data.feed>=b){ponyDialog("setfarmi")}else{globalerrorbox(t_pony_needs_feed)}}}}}function ponySelectFarmi(a){if(a==pony_sel_farmi){pony_sel_farmi=0;pony_sel_farmi_pos=0;ponyPreview(0)}else{pony_sel_farmi=a}pony_sel_pony=0;ponyBuild()}var fuelstation_stats_select="points";var fuelstation_stats_cache={};var fuelstation_stats_cache_delay=60;function openFuelstationHelp(){showDiv("fuelstation_help_transp");showDiv("fuelstation_help");setFuelstationHelp(1)}function closeFuelstationHelp(){hideDiv("fuelstation_help_transp");hideDiv("fuelstation_help")}function setFuelstationHelp(a){$("fuelstation_help_navi_item1").removeClassName("white_tab_active");$("fuelstation_help_navi_item2").removeClassName("white_tab_active");hideDiv("fuelstation_help_inner1");hideDiv("fuelstation_help_inner2");$("fuelstation_help_navi_item"+a).addClassName("white_tab_active");showDiv("fuelstation_help_inner"+a)}function fuelstationStats(){if($("fuelstation_stats_select")){fuelstation_stats_select=$("fuelstation_stats_select").value}if(fuelstation_stats_cache_delay[fuelstation_stats_select]<=0||!fuelstation_stats_cache[fuelstation_stats_select]){farmAction("fuelstation_stats",1,1,fuelstation_stats_select)}else{dialogFuelstation("stats")}}function buildFuelstation(a){ignoreBuildingElements();var e=farms_data.farms[farm][a];var c="";c+='<div style="position:absolute; top:0px; left:0px; width:100%; height:75px; background:url('+imgpath+'wood_tile.jpg);"></div>';c+=htmlLevelBar("fuelstation",0,1);c+=htmlCountBar("fuelstation");c+='<div id="fuelstation_slots">';for(var b=1;b<=4;b++){c+='<div id="fuelstation_slot'+b+'" class="fuelstation_slot production_slot">';c+=htmlLevelBar("fuelstation",b);c+='  <div class="fuelstation_slot_back">';c+='    <div id="fuelstation_slot'+b+'_fill" class="fuelstation_slot_fill"></div>';c+='    <div id="fuelstation_slot'+b+'_block" class="fuelstation_slot_block"></div>';c+="  </div>";c+='  <div id="fuelstation_slot'+b+'_fill_text" class="fuelstation_slot_fill_text"></div>';c+='  <div id="fuelstation_slot'+b+'_click" class="fuelstation_slot_click link"></div>';c+='  <div id="fuelstation_slot'+b+'_speedup" class="speedupgardenbutton fuelstation_slot_speedup link" onclick="globalSpeedupBox(\'fuelstation_speedup\', '+a+", "+b+');"></div>';c+='  <div id="fuelstation_slot'+b+'_timer" style="left:-7px; top:133px;" class="fuelstation_slot_timer vet_production_slot_rent_timer"></div>';c+="</div>"}c+="</div>";c+='<div id="fuelstation_stats_button" class="link" onclick="fuelstationStats()"></div>';c+='<div id="fuelstation_help_button" class="helpbutton_blue link" onclick="openFuelstationHelp()"></div>';c+='<div class="big_close link" onclick="closeBuildingInner()"></div>';c+='<div id="fuelstation_help_transp" class="transp"></div>';c+='<div id="fuelstation_help">';c+='  <div id="fuelstation_help_navi">';c+='    <div id="fuelstation_help_navi_item1" class="white_tab fuelstation_help_navi_item link" onclick="setFuelstationHelp(1)"><div class="fuel_barrel_mini" style="margin:0 auto;"></div></div>';c+='    <div id="fuelstation_help_navi_item2" class="white_tab fuelstation_help_navi_item link" onclick="setFuelstationHelp(2)"><div class="littlestar" style="margin:0 auto;"></div></div>';c+='    <div class="clear"></div>';c+="  </div>";c+='  <div id="fuelstation_help_inner">';c+='    <div id="fuelstation_help_inner1">';c+='      <div class="headline">'+t_fuelstation_guide_head+"</div>";c+='      <div style="float:left; width:175px;">'+t_fuelstation_guide_body1+'<br><img src="'+imgpath+'fuelstation_help1.png"></div>';c+='      <div style="float:left; width:175px;">'+t_fuelstation_guide_body2+'<br><img src="'+imgpath+'fuelstation_help2.png"></div>';c+='      <div class="clear"></div>';c+='      <div style="float:left; width:175px; margin-top:10px;">'+t_fuelstation_guide_body3+'<br><img src="'+imgpath+'fuelstation_help3.png"></div>';c+='      <div class="clear"></div>';c+='      <div style="margin-top:10px;">'+t_fuelstation_guide_body4+"</div>";c+='      <div style="margin-top:10px;">'+t_fuelstation_guide_body5+"</div>";c+='      <div style="margin-top:10px;">'+t_fuelstation_guide_body6+"</div>";c+='      <div style="margin-top:10px; border-top:1px solid #000; padding-top:10px;">'+t_fuelstation_guide_body7+"</div>";c+="    </div>";c+='    <div id="fuelstation_help_inner2" style="margin-top:5px;">';c+='      <div class="headline">'+t_farmersmarket_rewards+"</div>";c+='      <div style="margin-bottom:10px;">'+t_farmersmarket_rewards_intro+"</div>";for(var b in e.data.constants.achievements){var d="";if(e.data.constants.achievements[b].production_count){d=str_replace("%AMOUNT%",formatNumber(e.data.constants.achievements[b].production_count),t_fuel_achievement_produce)}if(e.data.constants.achievements[b].vet_points){d=str_replace("%AMOUNT%",formatNumber(e.data.constants.achievements[b].vet_points),t_fuel_achievement_fuel)}if(e.data.constants.achievements[b].slot_level){d=t_fuel_achievement_slot}if(e.data.constants.achievements[b].level){d=t_fuel_achievement_level}c+='<div style="position:relative; float:left; width:170px; margin-right:10px; margin-bottom:10px;">';c+='  <div style="position:relative; float:left; width:50px;">';c+='    <img style="width:100%;" src="'+imgpath+"gifts/"+e.data.constants.achievements[b].giftid+'.gif">';if(e.data.constants.achievements[b].solved){c+='<div class="megafield_product_ready" style="width:70px; height:69px; position:absolute; top:-5px; left:0px; display:block;"></div>'}c+="  </div>";c+='  <div style="float:left; margin:5px 0 0 10px; width:110px;">'+d+"</div>";c+='  <div class="clear"></div>';c+="</div>"}c+="    </div>";c+="  </div>";c+='  <div class="mini_close link" onclick="closeFuelstationHelp()" style="top:10px; right:10px;"></div>';c+="</div>";c+='<div id="fuelstation_stats">';c+='  <div id="fuelstation_stats_inner"></div>';c+="</div>";$("innercontent").innerHTML=c;$("innermaincontainer").className="inner_back inner_back20";$("fuelstation_countbar_plus").onclick=new Function("dialogFuelstation('buy', "+a+")");$("fuelstation_countbar_inner").innerHTML='<div class="biofuelcoin" style="float:left; margin-right:5px; margin-top:-3px;"></div><div style="float:left;"></div>';$("fuelstation_countbar_plus_tt").innerHTML=t_fuelstation_buy_collectitem;updateFuelstation()}function updateFuelstationLevel(e,r){var q=farms_data.farms[farm][e];if($("fuelstation_levelbar_number")){$("fuelstation_levelbar_number").innerHTML=q.data.data.level;var h=(q.data.data.fuel_alltime-q.data.data.level_current);var d=(q.data.data.level_next-q.data.data.level_current);var m=Math.floor((h*100)/d);if(m>100){m=100}if(!q.data.data.level_next){var l=t_reached_maxlevel;m=100}else{var n=(q.data.data.level_next-q.data.data.fuel_alltime);var l=str_replace("%POINTS%",formatNumber(n),t_fuelstation_level_pointsleft)+'<div class="bonusinfo">'+t_fuelstation_bonus_buy_goodie+"</div>"}$("fuelstation_levelbar_inner").style.width=m+"%";$("fuelstation_levelbar_tt").innerHTML=l}if($("fuelstation_slot"+r)){$("fuelstation_"+r+"_levelbar_number").innerHTML=q.data.data.slots[r].level;if(q.data.data.slots[r].level_points_next){var h=(q.data.data.slots[r].count-q.data.data.slots[r].level_points);var d=(q.data.data.slots[r].level_points_next-q.data.data.slots[r].level_points);var m=Math.floor((h*100)/d);if(m>100){m=100}$("fuelstation_"+r+"_levelbar_inner").style.width=m+"%";var n=(q.data.data.slots[r].level_points_next-q.data.data.slots[r].count);if(n<=0){$("fuelstation_"+r+"_levelbar").onmouseover=new Function("");$("fuelstation_"+r+"_levelbar").onmouseout=new Function("");hideDiv("fuelstation_"+r+"_levelbar_plus")}else{$("fuelstation_"+r+"_levelbar_tt").innerHTML=str_replace("%POINTS%",formatNumber(n),t_fuelstation_slot_pointsleft)}}else{$("fuelstation_"+r+"_levelbar_inner").style.width="100%"}$("fuelstation_"+r+"_levelbar_plus").onclick=new Function("dialogFuelstation('add_level', "+e+", "+r+")");$("fuelstation_"+r+"_levelbar_plus_tt").innerHTML=t_fuelstation_slot_levelit}}function fuelstationTimer(){for(var a in farms_data.farms[farm]){if(farms_data.farms[farm][a].buildingid==20){var c=farms_data.farms[farm][a];for(var b=1;b<=4;b++){if(c.data.data.slots&&c.data.data.slots[b]){if(c.data.constants.slots[b].duration&&c.data.data.slots[b].remain>0){c.data.data.slots[b].remain--}}}break}}updateFuelstation()}function updateFuelstation(){for(var l in farms_data.farms[farm]){if(farms_data.farms[farm][l].buildingid==20){var e=farms_data.farms[farm][l];for(var t=1;t<=4;t++){var w="dialogFuelstation('product_select', "+l+", "+t+")";var r=0;var u="";var q=0;hideDiv("fuelstation_slot"+t+"_block");hideDiv("fuelstation_slot"+t+"_speedup");if(e.data.data.slots&&e.data.data.slots[t]){var b="";b+='<div style="float:left; margin-right:5px; margin-top:5px;">'+croptext+"</div>";b+='<div style="float:left; margin-right:0px;" class="fuel_barrel_mini"></div>';b+='<div style="float:left; margin-top:5px;">'+e.data.constants.slot_level[e.data.data.slots[t].level].output+"</div>";b+='<div style="float:left; margin-left:5px; margin-right:0px;" class="biofuelcoin"></div>';b+='<div style="float:left; margin-top:5px;">'+e.data.constants.slot_level[e.data.data.slots[t].level].fuel_points+"</div>";b+='<div class="clear"></div>';var a='<div style="margin-top:2px;">'+productionduration+" "+formatTime(e.data.constants.slot_level[e.data.data.slots[t].level].duration)+"</div>";fuel_fillage=e.data.constants.slot_level[e.data.data.slots[t].level].limit;if(e.data.data.slots[t].entries){for(var h in e.data.data.slots[t].entries){if(isNumeric(h)&&e.data.data.slots[t].products[h]){q+=(e.data.data.slots[t].products[h].points*e.data.data.slots[t].entries[h])}}u="<div>"+t_fuelstation_fillage+':</div><div class="littlestar" style="float:left; background-size:20px 20px; width:20px; height:20px;"></div><div style="float:left; margin-top:3px;">'+q+"/"+fuel_fillage+'</div><div class="clear"></div>'+a+b+'<div style="margin-top:5px;">'+t_xmasgame_button_entry+"</div>";r=((q*100)/fuel_fillage)}else{u="<div>"+t_fuelstation_fillage+':</div><div class="littlestar" style="float:left; background-size:20px 20px; width:20px; height:20px;"></div><div style="float:left; margin-top:3px;">'+0+"/"+fuel_fillage+'</div><div class="clear"></div>'+a+b+'<div style="margin-top:5px;">'+t_xmasgame_button_entry+"</div>";r=0}if(e.data.constants.slots[t].duration){if(e.data.data.slots[t].remain>0){if($("fuelstation_slot"+t+"_timer")){$("fuelstation_slot"+t+"_timer").innerHTML=formatTime(e.data.data.slots[t].remain);showDiv("fuelstation_slot"+t+"_timer")}}else{if($("fuelstation_slot"+t+"_timer")){hideDiv("fuelstation_slot"+t+"_timer")}e.data.data.slots[t].block=1}}if(e.data.data.production&&e.data.data.production[t]){r=100;var n=0;for(var c=0;c<farms_data.farms[farm][l].production.length;c++){if(farms_data.farms[farm][l].production[c].slot==t){n=farms_data.farms[farm][l].production[c].remain}}if(n>0){u="<div>"+t_building_time+"<br>"+formatTime(n)+"</div>"+b;w="";showDiv("fuelstation_slot"+t+"_speedup")}else{u="<div>"+t_building_time+"<br>"+statusProductionComplete+"<br>"+b+"</div><div>"+click4products+"</div>";w="farmAction('fuelstation_harvest', "+farm+", "+l+", "+t+")"}}if($("fuelstation_slots")&&e.data.data.slots[t].block){showDiv("fuelstation_slot"+t+"_block");if(e.data.data.slots[t].level){u="<div>"+str_replace("%LEVEL%",e.data.data.slots[t].level,error1005)+"</div>";w=""}if(e.data.data.slots[t].money&&!e.data.data.slots[t].buytime){u="<div>"+str_replace("%MONEY%",formatPrice(e.data.data.slots[t].money),t_buy_slot)+"</div>";w="dialogFuelstation('buyslot', "+l+", "+t+")"}if(e.data.data.slots[t].coins){if(e.data.data.slots[t].duration){u="<div>"+str_replace("%COINS%",e.data.data.slots[t].coins+"&nbsp;"+t_coins,t_rent_slot)+"</div>";u="<div>"+str_replace("%TIME%",formatTime(e.data.data.slots[t].duration),u)+"</div>";if(specialbonus){var s=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(s&&in_array("fuelstation",s.types)){u+='<div id="vet_productionslot'+t+'_bonus_star" class="fuelstation production_slot bonus_star pulse">';u+='  <div class="inner">';u+='    <div class="percent">'+(s.discount*100)+"%</div>";u+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";u+="  </div>";u+="</div>"}}}else{u="<div>"+str_replace("%MONEY%",e.data.data.slots[t].coins+"&nbsp;"+t_coins,t_buy_slot)+"</div>"}w="dialogFuelstation('buyslot', "+l+", "+t+")"}if(e.data.data.slots[t].fuel){var v="";if(e.data.data.slots[t].fuel<=e.data.data.count){w="dialogFuelstation('buyslot', "+l+", "+t+")"}else{var d=(e.data.data.slots[t].fuel-e.data.data.count);if(isNaN(d)){d=0}v='<div style="margin-top:10px;" class="important">'+str_replace("%AMOUNT%",d,t_fuelstation_need_more)+"</div>";w=""}u="<div>"+str_replace("%MONEY%",e.data.data.slots[t].fuel+"&nbsp;"+t_fuelstation_currency,t_buy_slot)+"</div>";u+=v}}}if($("fuelstation_slots")){$("fuelstation_countbar_inner").innerHTML='<div class="biofuelcoin" style="float:left; margin-right:5px; margin-top:-8px;"></div><div style="float:left;">'+formatNumber(e.data.data.count)+'</div><div class="clear"></div>';$("fuelstation_slot"+t+"_fill_text").innerHTML=u;$("fuelstation_slot"+t+"_fill").style.height=r+"px";$("fuelstation_slot"+t+"_click").onclick=new Function(w)}hideDiv("fuelstation_"+t+"_levelbar");if(!e.data.data.slots[t].block){showDiv("fuelstation_"+t+"_levelbar");updateFuelstationLevel(l,t)}}break}}}function fuelstationCheckLevelAdd(a,d){if(a>0&&d>0){var c=farms_data.farms[farm][a];var b=$("fuelstation_dialog_leveladd_insert").value;b=parseInt(b);if(isNaN(b)){b=0}if(b>farms_data.farms[farm][a].data.data.slots[d].points_left){b=farms_data.farms[farm][a].data.data.slots[d].points_left}if(b>c.data.data.count){b=c.data.data.count}$("fuelstation_dialog_leveladd_insert").value=b}}var fuelstation_block=0;function dialogFuelstation(q,B,d,t,A){if(q=="buyslot"){var a=farms_data.farms[farm][B];var e="";if(a.data.constants.slots[d].fuel){var l=str_replace("%MONEY%",a.data.constants.slots[d].fuel+"&nbsp;"+t_fuelstation_currency,slot_buy)}if(a.data.constants.slots[d].money){var l=str_replace("%MONEY%",formatPrice(a.data.constants.slots[d].money),slot_buy)}if(a.data.data.slots[d].coins){var l=str_replace("%MONEY%",a.data.constants.slots[d].coins+"&nbsp;"+t_coins,slot_buy);if(a.data.data.slots[d].duration){var l=str_replace("%COINS%",a.data.constants.slots[d].coins+"&nbsp;"+t_coins,slot_rent);l=str_replace("%TIME%",formatTime(a.data.constants.slots[d].duration),l)}}var C="farmAction('fuelstation_buyslot', "+farm+", "+B+", "+d+")";globalcommitbox(e,l,C)}if(q=="stats"){var m='<div id="fuelstation_stats_inner">';m+='  <div id="fuelstation_stats_select_line">';m+='   <select id="fuelstation_stats_select" onchange="fuelstationStats()">';var c=["points","fuel"];for(var z=0;z<c.length;z++){var s="";if(fuelstation_stats_select==c[z]){s="selected"}m+='<option value="'+c[z]+'" '+s+">"+t_fuelstation_stats[c[z]]+"</option>"}m+="   </select>";m+="  </div>";m+='  <div class="headline" style="margin-top:10px;">'+t_fuelstation_stats_headlines[fuelstation_stats_select]+"</div>";m+='  <div class="fuelstation_stats_ranking">';m+=htmlStatsContent(fuelstation_stats_cache[fuelstation_stats_select]);m+="</div>";m+="<div class=\"mini_close link\" onclick=\"hideDiv('fuelstation_stats'); hideDiv('fuelstation_help_transp');\"></div>";$("fuelstation_stats").innerHTML=m;showDiv("fuelstation_help_transp");showDiv("fuelstation_stats")}if(q=="add_level"){var e=t_fuelstation_level_plus_head;var l=htmlLevelAddDialog("fuelstation",B,d);globalcommitbox(e,l,C,0,b)}if(q=="buy"||q=="buy_confirm"){var a=farms_data.farms[farm][B];var b=0;if(q=="buy_confirm"){if(!fuelstation_block){fuelstation_block=1}else{return false}}var e=t_fuelstation_buy_collectitem;var r=str_replace("%COINS%",a.data.data.exchangecoins,t_fuelstation_buy_collectitem_coins);r=str_replace("%AMOUNT%",a.data.data.exchangeamount,r);if(q=="buy"){var l='<div id="megafruit_buy_button" class="link" onclick="dialogFuelstation(\'buy_confirm\', '+B+", "+d+')">'+r+"</div>";var C=0;b=1;fuelstation_block=0}else{var l=str_replace("%AMOUNT%",a.data.data.exchangeamount,t_fuelstation_buy_collectitem_coins_confirm);l=str_replace("%COINS%",a.data.data.exchangecoins,l);var C="farmAction('fuelstation_buy', "+farm+", "+B+")"}globalcommitbox(e,l,C,0,b)}if(q=="product_select"){if(!A){A="v"}var a=farms_data.farms[farm][B];var u=[];for(var t in a.data.data.slots[d].products){if(!in_array(produkt_category[t],u)){u.push(produkt_category[t])}}var e=t_fuelstation_insert_head;var l="";l+='<div id="fuelstation_product_select_inner">';l+='  <div id="fuelstation_product_select_tabs">';for(var z=0;z<u.length;z++){var n="";if(z==0){n="margin-left:10px;"}l+='<div class="brown_tab cmenue link" id="cmenue_'+u[z]+'" style="'+n+"\" onclick=\"dialogFuelstation('product_select', "+B+", "+d+", "+t+", '"+u[z]+"')\"></div>"}l+='    <div class="clear"></div>';l+="  </div>";l+='  <div class="fuelstation_product_select brown_tab_content">';for(var t in a.data.data.slots[d].products){var w=1;if(produkt_category[t]!=A){w=0}if(t>0&&w==1){var h=checkRackItem(t);if(a.data.data.slots[d].products[t].points>0){var v="";var n="opacity:0.5;";if(h>0){v="dialogFuelstation('product_select_pid', "+B+", "+d+", "+t+")";n=""}l+='<div class="fuelstation_product_select_item link" style="'+n+'" onclick="'+v+'" onmouseover="showDiv(\'fuelstation_product_select_item'+t+"_tt')\" onmouseout=\"hideDiv('fuelstation_product_select_item"+t+"_tt')\">";l+='  <div class="fuelstation_product_select_item_points">'+formatNumber(a.data.data.slots[d].products[t].points)+"</div>";l+='  <div class="fuelstation_product_select_item_img">';l+='    <div class="tt'+t+'"></div>';l+="  </div>";l+='  <div class="fuelstation_product_select_item_amount">'+formatNumber(h)+"</div>";l+='  <div id="fuelstation_product_select_item'+t+'_tt" class="ttbox fuelstation_product_select_item_tt">'+produkt_name[t]+"</div>";l+="</div>"}}}l+="  </div>";l+="</div>";globalBoxFlex(e,l,0,0,1);$("cmenue_"+A).addClassName("brown_tab_active")}if(q=="product_select_pid"){var a=farms_data.farms[farm][B];var e=t_fuelstation_insert_dialog;var l="";l+='<div style="width:205px;">';l+='  <div class="fuelstation_product_select_item" style="margin-left:55px;">';l+='    <div class="fuelstation_product_select_item_points">'+formatNumber(a.data.data.slots[d].products[t].points)+"</div>";l+='    <div class="fuelstation_product_select_item_img">';l+='      <div class="tt'+t+'"></div>';l+="    </div>";l+='    <div class="fuelstation_product_select_item_amount">'+formatNumber(checkRackItem(t))+"</div>";l+="  </div>";l+='  <div class="clear"></div>';l+='  <div class="dialog_input_line fuelstation">';l+='    <input id="fuelstation_product_select_input" style="float:left; width:100px; margin-right:15px;" class="dialog_input" onkeyup="calcPointsFuelstation('+B+", "+d+", "+t+')" onchange="calcPointsFuelstation('+B+", "+d+", "+t+')">';l+='    <button style="float:right;" class="button_new link" onclick="farmAction(\'fuelstation_entry\', '+farm+", "+B+", "+d+", "+t+')">'+t_inner_feedsubmit+"</button>";l+='    <div class="clear"></div>';l+="  </div>";l+='  <div style="margin-bottom:10px;">'+str_replace("%AMOUNT%","<span id='fuelstation_product_select_points'></span>",t_fuelstation_insert_dialog_info1)+"</div>";l+="  <div>"+str_replace("%AMOUNT%","<span id='fuelstation_product_select_left'></span>",t_fuelstation_insert_dialog_info2)+"</div>";l+="</div>";globalcommitbox(e,l,0,0,1);calcPointsFuelstation(B,d,t)}}function calcPointsFuelstation(h,n,e){var b=farms_data.farms[farm][h];var d=$("fuelstation_product_select_input").value;if(d<0){return false}d=parseInt(d);if(isNaN(d)){d=0}var m=0;if(b.data.data.slots&&b.data.data.slots[n]&&b.data.data.slots[n].entries){for(var c in b.data.data.slots[n].entries){if(isNumeric(c)){m+=(b.data.data.slots[n].products[c].points*b.data.data.slots[n].entries[c])}}}var l=parseInt(checkRackItem(e));if(d>l){d=l}var q=0;if(d>0){q=(d*b.data.data.slots[n].products[e].points)}var a=b.data.constants.slot_level[b.data.data.slots[n].level].limit;if(m>0){a-=m}if(q>a){d=Math.ceil(a/b.data.data.slots[n].products[e].points);q=(b.data.data.slots[n].products[e].points*d)}if(q>a){q=a}$("fuelstation_product_select_input").value=d;$("fuelstation_product_select_points").innerHTML=formatNumber(q);$("fuelstation_product_select_left").innerHTML=formatNumber(a)}function showFeedback(b,a){$(b).innerHTML=a;showDiv(b);window.setTimeout("Effect.Fade($('"+b+"'),{duration:1,from:0.7,to:0})",1000)}var butterfly=function(){this.data={};this.shopPage=1;this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.butterflySort=1;this.firstvisit=0};butterfly.prototype.stats=function(){if($("butterfly_stats_select")){butterfly.stats_select=$("butterfly_stats_select").value}if(butterfly.stats_cache_delay[butterfly.stats_select]<=0||!butterfly.stats_cache[this.stats_select]){butterfly.action("butterfly_stats",{type:butterfly.stats_select})}else{butterfly.showStats(butterfly.stats_select)}};butterfly.prototype.checkInvestment=function(){butterfly.action("butterfly_check_investments")};butterfly.prototype.deleteSlot=function(a){butterfly.action("butterfly_delete",{slot:a})};butterfly.prototype.questEntry=function(a){butterfly.action("butterfly_quest_entry",{pid:a,amount:parseInt($("dialog_entryline_number").value)})};butterfly.prototype.clickButterfly=function(a){butterfly.action("butterfly_click",{id:a})};butterfly.prototype.clickAllButterfly=function(a){butterfly.action("butterfly_click_all")};butterfly.prototype.finishCare=function(a){butterfly.action("butterfly_finish_care",{slot:a})};butterfly.prototype.addLevel=function(){butterfly.action("butterfly_add_level",{amount:$("butterfly_dialog_leveladd_insert").value})};butterfly.prototype.buyAddLevel=function(){butterfly.action("butterfly_buy_add_level")};butterfly.prototype.buySlot=function(a){butterfly.action("butterfly_buyslot",{slot:a})};butterfly.prototype.startBreed=function(b,a){butterfly.action("butterfly_startbreed",{slot:b,id:a})};butterfly.prototype.careBreed=function(a){butterfly.action("butterfly_carebreed",{slot:a})};butterfly.prototype.free=function(a){butterfly.action("butterfly_free",{slot:a})};butterfly.prototype.shopBuy=function(b,a){butterfly.action("butterfly_shopbuy",{slot:b,id:a})};butterfly.prototype.action=function(a,b){ajaxAction("farm",a,b,butterfly.response)};butterfly.prototype.response=function(c,b,d){if(in_array(b,["butterfly_quest_entry"])){butterfly.showQuest()}if(b=="butterfly_check_investments"&&$("farmersmarket_pos7_inner").style.display!="block"){return 1}butterfly.init();if(in_array(b,["butterfly_click","butterfly_click_all"])&&c.reward){butterfly.move(2);butterfly.buildHouse()}if(c.stats){butterfly.stats_cache_delay[butterfly.stats_select]=30;if(!butterfly.stats_cache[butterfly.stats_select]){butterfly.stats_cache[butterfly.stats_select]={}}butterfly.stats_cache[butterfly.stats_select]=c.stats;butterfly.showStats()}if(c.reward&&b=="butterfly_click_all"){var a="<div>"+t_specialoffer_message+"</div>";if(c.reward.points){a+='<div style="margin-top:10px;">'+c.reward.points+"&nbsp;"+t_points+"</div>"}a+='<div class="button_yes link" onclick="hideDiv(\'globalbox\'); hideDiv(\'globaltransp\');" style="position:relative; width:50px; height:50px; margin:0 auto; margin-top:10px;"></div>';globalcommitbox(t_vet_reward_head,a,0,0,1)}if(c.investment){butterfly.showInvestment(c.investment)}};butterfly.prototype.init=function(){var a='<div id="butterfly" class="pos1">';a+='  <div class="slots">'+this.buildSlots()+"</div>";a+='  <div id="butterfly_house" class="house">'+this.buildHouse()+"</div>";a+='  <div id="butterfly_scroller" class="scroller right link" onclick="butterfly.move(1)"></div>';a+='  <div id="butterfly_scroller" class="scroller left link" onclick="butterfly.move(-1)"></div>';a+="</div>";a+='<div class="mini_close link" onclick="butterfly.close()"></div>';a+='<div class="help helpbutton_blue link" onclick="butterfly.help()"></div>';a+=htmlLevelBar("butterfly");a+=htmlCountBar("butterfly");a+='<div id="butterfly_stats_link" class="link" onclick="butterfly.stats()"></div>';a+='<div id="butterfly_quests_link" class="link" onclick="butterfly.showQuest()"></div>';$("farmersmarket_pos7_inner").innerHTML=a;showDiv("transp");showDiv("farmersmarket_pos7_inner");$("butterfly_levelbar_number").innerHTML=this.data.data.level;$("butterfly_countbar_inner").innerHTML='<div class="blossoms_icon"></div><div>'+this.data.data.count+"</div><br>";$("butterfly_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var b=t_reached_maxlevel;hideDiv("butterfly_levelbar_plus")}else{var b=str_replace("%AMOUNT%",this.data.data.level_rest,t_butterfly_level_line);$("butterfly_levelbar_plus").onclick=new Function("butterfly.addLevelCommit()");$("butterfly_levelbar_plus_tt").innerHTML=t_butterfly_leveladd_tt}$("butterfly_levelbar_tt").innerHTML=b;$("butterfly_countbar_plus_tt").innerHTML=t_butterfly_levelitem_buy;$("butterfly_countbar_plus").onclick=new Function("butterfly.buyAddLevelCommit()");this.timerUpdate();if(this.data.visit&&this.data.visit==1&&!this.firstvisit){butterfly.help();this.firstvisit=1}};butterfly.prototype.showInvestment=function(b){var a="<div>"+t_butterfly_investment+"</div>";if(b.money){a+='<div style="margin-top:10px;">'+formatPrice(b.money)+"</div>"}a+='<div class="button_yes link" onclick="hideDiv(\'globalbox\'); hideDiv(\'globaltransp\');" style="position:relative; width:50px; height:50px; margin:0 auto; margin-top:10px;"></div>';globalcommitbox(t_vet_reward_head,a,0,0,1)};butterfly.prototype.addLevelCommit=function(){var b=t_butterfly_dialog_leveladd_head;var a=htmlLevelAddDialog("butterfly");globalcommitbox(b,a,0,0,1)};butterfly.prototype.addLevelCheck=function(){var a=$("butterfly_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>butterfly.data.data.count){a=butterfly.data.data.count}$("butterfly_dialog_leveladd_insert").value=a};butterfly.prototype.buyAddLevelCommit=function(c){var h=butterfly.data.data.exchangeamount;var m="";var e=specialbonus.findBonus({key1:"butterflies",key2:"buypoints"});if(e){m="color:green; font-weight:bold;";h=Math.ceil(h*(1+e.buypoints))}var d=t_butterfly_levelitem_buy;var b=str_replace("%COINS%",butterfly.data.data.exchangecoins,t_butterfly_levelitem_buy_dialog);b=str_replace("%AMOUNT%",'<span style="'+m+'">'+h+"</span>",b);if(!c){var a='<div class="link coinsbutton_flex" onclick="butterfly.buyAddLevelCommit(1)">'+b+"</div>";if(e){a+='<div style="margin-top:5px;">'+specialbonus.htmlBonusLine(e.buypoints)+"</div>"}globalcommitbox(d,a,0,0,1)}else{var a=b;if(e){a+='<div style="margin-top:5px;">'+specialbonus.htmlBonusLine(e.buypoints)+"</div>"}var l="butterfly.buyAddLevel()";globalcommitbox(d,a,l)}};butterfly.prototype.move=function(a){if($("butterfly").hasClassName("pos2")){$("butterfly").className="pos1"}else{$("butterfly").className="pos2"}};butterfly.prototype.buildSlots=function(){var s="";for(var e in this.data.config.slots){var a="";var D="";var z=0;if(e>1&&(!this.data.data.slots||!this.data.data.slots[e])){z=1;var c="unlocked";var r="butterfly.buySlotCommit("+e+")";if(this.data.config.slots[e].money||this.data.config.slots[e].coins){var u="";if(this.data.config.slots[e].money){var C=formatPrice(this.data.config.slots[e].money)}if(this.data.config.slots[e].coins){var C=this.data.config.slots[e].coins+"&nbsp;"+t_coins}if((this.data.config.slots[e].money&&this.data.config.slots[e].money>user_bar)||(this.data.config.slots[e].coins&&this.data.config.slots[e].coins>user_coins)){u="important";c="locked";r=""}a+='<div class="'+u+'">'+cityadcost+C+"</div>"}if(this.data.config.slots[e].questid&&this.data.config.slots[e].questid>this.data.data.last_questid){c="locked";r="";a+='<div class="important">'+t_butterfly_quest_block.replace("%QUEST%",this.data.config.slots[e].questid)+"</div>"}}if(this.data.data.breed[e]){var h=this.data.data.breed[e].butterfly;var n=0;if(this.data.data.breed[e]&&this.data.data.breed[e].care){n=this.data.data.breed[e].count}if(this.data.data.breed[e].breedend>0){D="butterfly";breed_name="butterfly"+h;var d=this.data.config.butterflies[h].products2}else{if(!n){D="egg";breed_name="egg"+this.data.config.butterflies[h].rarity;var d=this.data.config.butterflies[h].products1}else{D="caterpillar";breed_name="caterpillar"+this.data.config.butterflies[h].rarity;var d=this.data.config.butterflies[h].products1}}a+='<div class="name">'+this.data.config.butterflies[h].name+"</div>";a+='<div class="rarity">'+t_butterfly_rarity[this.data.config.butterflies[h].rarity]+"</div>";a+='<div class="head">'+t_pets_need_food+"</div>";var A=0;for(var v in d){var u="";if(checkRackItem(v)<d[v]){u="important";A=1}a+='<div class="'+u+'">'+htmlProductBody(v,d[v])+"</div>"}if(this.data.data.breed[e].breedend>0){var q=this.data.config.butterflies[h].reward;a+=this.showReward(q,e)}}if(!this.data.data.breed[e]&&!z){a+="<div>"+t_butterfly_empty_slot+"</div>"}var b="";if(e%3==0){b="right"}s+='<div id="butterfly_slot'+e+'" class="slot">';var l="plant plant"+getRandom(1,2);var E="top";if(this.data.data.breed[e]&&this.data.data.breed[e].deco>0){l="deco"+this.data.data.breed[e].deco+" type"+getRandom(1,2)}if(e>3){E="bottom"}s+='<div class="deco '+l+" "+E+'"></div>';if(this.data.data.breed[e]){if(this.data.data.breed[e].breedend==0){s+='<div id="butterfly_slot'+e+'_feed_progress" class="feed_progress off" onmouseover="butterfly.slotHover('+e+", 1); showDiv('butterfly_slot"+e+'_feed_progress_tt\')" onmouseout="butterfly.slotHover('+e+", 0); hideDiv('butterfly_slot"+e+"_feed_progress_tt')\">";var t=0;for(var B=1;B<=this.data.config.butterflies[h].care_count1;B++){var u="";if(B<=n){u="filled"}else{t++}s+='<div class="inner '+u+'"></div>'}s+='  <div id="butterfly_slot'+e+'_feed_progress_tt" class="ttbox">'+t_butterfly_time_to_wonderful.replace("%AMOUNT%",t)+"</div>";s+="</div>"}var l="";if(this.data.data.breed[e].breedend>0){l="solo"}s+='  <div id="butterfly_slot'+e+'_timer" class="timer off '+l+'" onmouseover="butterfly.slotHover('+e+', 1)" onmouseout="butterfly.slotHover('+e+', 0)"></div>';var w="medium";if(this.data.config.butterflies[h].size==1){w="small"}if(this.data.config.butterflies[h].size==3){w="big"}s+='  <div id="butterfly_slot'+e+'_type" class="'+D+" "+breed_name+" "+w+'" style="animation-duration:'+(getRandom(10,15)/10)+'s"></div>'}s+='<div id="butterfly_slot'+e+'_care_ready" class="care_ready"></div>';s+='  <div id="butterfly_slot'+e+'_buttons" class="buttons" onmouseover="butterfly.slotHover('+e+', 1)" onmouseout="butterfly.slotHover('+e+', 0)">';if(this.data.data.breed[e]){if(!A){s+='<div id="butterfly_slot'+e+'_button_care" class="care clicker link" onclick="butterfly.careBreedCommit('+e+')" onmouseover="showDiv(\'butterfly_slot'+e+"_care_tt')\" onmouseout=\"hideDiv('butterfly_slot"+e+"_care_tt')\">";s+='  <div id="butterfly_slot'+e+'_care_tt" class="ttbox '+b+'">'+t_butterfly_care+"</div>";s+="</div>"}if(this.data.data.breed[e].breedend>0){s+='<div class="free clicker link" onclick="butterfly.freeCommit('+e+')" onmouseover="showDiv(\'butterfly_slot'+e+"_free_tt')\" onmouseout=\"hideDiv('butterfly_slot"+e+"_free_tt')\">";s+='  <div id="butterfly_slot'+e+'_free_tt" class="ttbox '+b+'">'+t_butterfly_free+"</div>";s+="</div>"}else{s+='<div id="butterfly_slot'+e+'_button_delete" class="mini_close link" onclick="butterfly.deleteSlotCommit('+e+')" onmouseover="showDiv(\'butterfly_slot'+e+"_delete_tt')\" onmouseout=\"hideDiv('butterfly_slot"+e+"_delete_tt')\">";s+='  <div id="butterfly_slot'+e+'_delete_tt" class="ttbox '+b+'">'+t_butterfly_delete+"</div>";s+="</div>"}}var m="butterfly.startBreedSelect("+e+")";if(this.data.data.breed[e]){m="butterfly.shopSelect("+e+")"}s+='    <div class="shop clicker link" onclick="'+m+'" onmouseover="showDiv(\'butterfly_slot'+e+"_shop_tt')\" onmouseout=\"hideDiv('butterfly_slot"+e+"_shop_tt')\">";s+='      <div id="butterfly_slot'+e+'_shop_tt" class="ttbox '+b+'">'+t_butterfly_shop+"</div>";s+="    </div>";s+="  </div>";s+='  <div id="butterfly_slot'+e+'_click" class="click link" onmouseover="butterfly.slotHover('+e+', 1)" onmouseout="butterfly.slotHover('+e+', 0)"></div>';s+='  <div id="butterfly_slot'+e+'_tt" class="ttbox '+b+'">'+a+"</div>";if(z==1){s+='<div class="block '+c+'" onclick="'+r+'" onmouseover="butterfly.slotHover('+e+', 1, 1)" onmouseout="butterfly.slotHover('+e+', 0, 1)"></div>'}s+="</div>"}s+='<div class="clear"></div>';return s};butterfly.prototype.slotHover=function(c,b,a){if(b==1){showDiv("butterfly_slot"+c+"_tt");if(!a){showDiv("butterfly_slot"+c+"_buttons")}if($("butterfly_slot"+c+"_feed_progress")){$("butterfly_slot"+c+"_feed_progress").removeClassName("off")}if($("butterfly_slot"+c+"_timer")){$("butterfly_slot"+c+"_timer").removeClassName("off")}}else{hideDiv("butterfly_slot"+c+"_tt");if(!a){hideDiv("butterfly_slot"+c+"_buttons")}if($("butterfly_slot"+c+"_feed_progress")){$("butterfly_slot"+c+"_feed_progress").addClassName("off")}if($("butterfly_slot"+c+"_timer")){$("butterfly_slot"+c+"_timer").addClassName("off")}}};butterfly.prototype.buildHouse=function(m){if(m){this.butterflySort+=m}if(this.butterflySort<1){this.butterflySort=4}if(this.butterflySort>4){this.butterflySort=1}var d=0;var e=0;var c="";for(var b in this.data.config.butterflies){if(this.data.data.free&&this.data.data.free[b]&&(!this.data.data.free[b].last||this.data.data.free[b].last<this.data.data.today)){d++}if(this.butterflySort!=this.data.config.butterflies[b].rarity){continue}if(this.data.data.free&&this.data.data.free[b]){e++;var a=t_butterfly_daily_click;var l="butterfly.clickButterfly("+b+")";if(this.data.data.free[b].last&&this.data.data.free[b].last>this.data.data.today){l="";a=t_butterfly_daily_click_done}else{d++}var n="medium";if(this.data.config.butterflies[b].size==1){n="small"}if(this.data.config.butterflies[b].size==3){n="big"}c+='<div class="butterfly '+n+'" onmouseover="showDiv(\'butterfly_house'+b+"_tt')\" onmouseout=\"hideDiv('butterfly_house"+b+'_tt\')" onclick="'+l+'">';c+='  <div class="slot butterfly'+b+'" style="animation-duration:'+(getRandom(10,15)/10)+"s; top:"+getRandom(1,20)+'px;"></div>';var h="";if(e<=4){h="top"}c+='  <div id="butterfly_house'+b+'_tt" class="ttbox '+h+" "+n+'">';c+='    <div class="name">'+this.data.data.free[b].count+"x&nbsp;"+this.data.config.butterflies[b].name+"</div>";c+='    <div class="rarity">'+t_butterfly_rarity[this.data.config.butterflies[b].rarity]+"</div>";c+='    <div class="bonus">'+a+"</div>";c+="  </div>";c+="</div>"}else{c+='<div class="butterfly">';c+="</div>"}}if(d>0&&premium){c+='<div class="clickall link" onclick="butterfly.clickAllButterfly()" onmouseover="showDiv(\'butterfly_clickall_tt\')" onmouseout="hideDiv(\'butterfly_clickall_tt\')">';c+='  <div id="butterfly_clickall_tt" class="ttbox">'+t_butterfly_daily_click_all+"</div>";c+="</div>"}c+='<div class="scroller left link" onclick="butterfly.buildHouse(-1)"></div>';c+='<div id="butterfly_house_navi_name" class="navi name">'+t_butterfly_rarity[this.butterflySort]+"</div>";c+='<div class="scroller right link" onclick="butterfly.buildHouse(1)"></div>';if(m){$("butterfly_house").innerHTML=c}else{return c}};butterfly.prototype.deleteSlotCommit=function(a){globalcommitbox(t_butterfly_delete_head,t_butterfly_delete_body,"butterfly.deleteSlot("+a+")")};butterfly.prototype.freeCommit=function(c){var a=t_butterfly_free_body.replace("%NAME%",this.data.config.butterflies[this.data.data.breed[c].butterfly].name);a+='<div style="margin-top:10px;">'+t_butterfly_free_attention+"</div>";var b="butterfly.free("+c+")";globalcommitbox(t_butterfly_free_head,a,b)};butterfly.prototype.buySlotCommit=function(d){if(this.data.config.slots[d].money){var c=formatPrice(this.data.config.slots[d].money)}if(this.data.config.slots[d].coins){var c=this.data.config.slots[d].coins+"&nbsp;"+t_coins}var a=t_butterfly_buy_slot_body.replace("%COST%",c);var b="butterfly.buySlot("+d+")";globalcommitbox(t_butterfly_buy_slot_head,a,b)};butterfly.prototype.startBreedSelect=function(h){var e=specialbonus.findBonus({key1:"butterflies",key2:"buyegg"});var n="";var l="";if(e){n=specialbonus.htmlBonusLine(e.buyegg);l="bonus"}var c='<div id="butterfly_startbreed">';c+="  <div>"+t_butterfly_start_breed_body+"</div>";c+='  <div class="slots">';for(var b in this.data.config.eggs){var m="";var q="butterfly.startBreedCommit("+h+", "+b+")";if(this.data.config.eggs[b].money){var a=formatPrice(this.data.config.eggs[b].money);if(user_bar<this.data.config.eggs[b].coins){m="important";q=""}}if(this.data.config.eggs[b].coins){var s=this.data.config.eggs[b].coins;if(e){s=Math.ceil(s*(1-e.buyegg))}var a='<div class="'+l+'">'+s+" "+t_coins+"</div>";if(user_coins<this.data.config.eggs[b].coins){m="important";q=""}}if(this.data.config.eggs[b].blossoms){var a=this.data.config.eggs[b].blossoms+" "+t_butterfly_blossoms;if(this.data.data.count<this.data.config.eggs[b].blossoms){m="important";q=""}}var d="";if(b%3==0){d="right"}c+='<div class="slot" onmouseover="showDiv(\'butterfly_startbreed_egg'+b+"_tt')\" onmouseout=\"hideDiv('butterfly_startbreed_egg"+b+"_tt')\">";c+='  <div class="egg egg'+b+'"></div>';c+='  <div class="coinsbutton_flex link '+m+'" onclick="'+q+'">'+a+"</div>";c+='  <div id="butterfly_startbreed_egg'+b+'_tt" class="ttbox '+d+'">';c+='    <div class="intro">'+t_butterfly_chance+"</div>";for(var r in this.data.config.eggs[b].rarity){c+="<div>"+t_butterfly_rarity[r]+":&nbsp;"+(this.data.config.eggs[b].rarity[r]*100)+"%</div>"}c+="  </div>";c+="</div>"}c+='    <div class="clear"></div>';c+="  </div>";if(n!=""){c+=n}c+="</div>";globalBoxFlex(t_butterfly_start_breed_head,c,0,0,1)};butterfly.prototype.careBreedCommit=function(n){if(this.data.data.breed[n].remain&&this.data.data.breed[n].remain>0){return 1}var e=this.data.data.breed[n].butterfly;if(this.data.data.breed[n].breedend>0){var h=this.data.config.butterflies[e].products2}else{var h=this.data.config.butterflies[e].products1}var l=t_butterfly_care_breed_head.replace("%NAME%",this.data.config.butterflies[e].name);var d="";var b=0;var q="butterfly.careBreed("+n+")";for(var c in h){var m="";if(h[c]>checkRackItem(c)){m="important";b=1}d+='<div class="'+m+'" style="position:relative; width:140px; margin:0 auto;">'+htmlProductBody(c,h[c])+"</div>"}if(this.data.data.breed[n].breedend>0){var a=this.data.config.butterflies[e].reward;d+=this.showReward(a,n)}if(b){globalcommitbox(l,d,0,0,1)}else{globalcommitbox(l,d,q)}};butterfly.prototype.showReward=function(b,s){var d=this.data.data.breed[s];var l=parseInt(d.count);var c=parseInt(this.data.config.butterflies[d.butterfly].care_count1);var h=1;var a=(l-c);if(a>0){var m=((a*100)/this.data.config.butterflies[d.butterfly].care_count2);m=Math.max(0,(100-m));for(var t in this.data.config.decay){if(parseInt(m)>=parseInt(t)){h=this.data.config.decay[t]}}}var e="";e+='<div class="head bold" style="margin-top:5px;">'+t_butterfly_care_attention+"</div>";var q={};if(d.deco>0){q=this.data.config.deco[d.deco];if(this.data.config.butterflies[d.butterfly].rarity==this.data.config.deco[d.deco].bonus.rarity){q=this.data.config.deco[d.deco].bonus}}for(var t in b){var r=Math.ceil(b[t]*h);if(t=="money"){if(q.multi_money){r=Math.ceil(r*q.multi_money)}e+="<div>"+formatPrice(r)+"</div>"}if(t=="points"){if(q.multi_points){r=Math.ceil(r*q.multi_points)}var u="";if(specialbonus){var n=specialbonus.findBonus({key1:"butterflies",key2:"feedpoints"});if(n){u+='<br><span style="color:green;">('+t_incl+"&nbsp;"+(n.feedpoints*100)+"% "+t_specialbonus_vet_points_info+")</span>";r=Math.ceil(r*(1+n.feedpoints))}}e+="<div>"+formatNumber(r)+"&nbsp;"+t_points+" "+u+"</div>"}if(t=="blossoms"){if(q.multi_blossoms){r=Math.ceil(r*q.multi_blossoms)}e+="<div>"+formatNumber(r)+"&nbsp;"+t_butterfly_blossoms+"</div>"}}return e};butterfly.prototype.startBreedCommit=function(h,b){var m="";var d="";if(this.data.config.eggs[b].money){var a=formatPrice(this.data.config.eggs[b].money)}if(this.data.config.eggs[b].coins){var n=this.data.config.eggs[b].coins;var e=specialbonus.findBonus({key1:"butterflies",key2:"buyegg"});if(e){m=specialbonus.htmlBonusLine(e.buyegg);d="font-weight:bold; color:green;";n=Math.ceil(n*(1-e.buyegg))}var a='<div style="'+d+'">'+n+"&nbsp;"+t_coins+"</div>"}if(this.data.config.eggs[b].blossoms){var a=this.data.config.eggs[b].blossoms+"&nbsp;"+t_butterfly_blossoms}var c=t_butterfly_buy_egg_body.replace("%COST%",a);if(m!=""){c+='<div style="margin-top:5px;">'+m+"</div>"}var l="butterfly.startBreed("+h+", "+b+")";globalcommitbox(t_butterfly_buy_egg_head,c,l)};butterfly.prototype.shopSelect=function(b){var A=specialbonus.findBonus({key1:"butterflies",key2:"buydeco"});var w="";var s="";if(A){w="bonus";s=specialbonus.htmlBonusLine(A.buydeco,1)}var m='<div id="butterfly_shop">';var h=1;var r=1;if(this.shopPage>1){r=((this.shopPage-1)*4)+1}var t=(this.shopPage*4);for(var u in this.data.config.deco){if(h>=r&&h<=t){var v=0;var e={};if(this.data.config.deco[u].bonus){for(var c in this.data.config.deco[u].bonus){var l=this.data.config.deco[u].bonus[c];if(l>1&&this.data.config.deco[u][c]!=l){e[c]=l}}if(this.data.data.breed&&this.data.data.breed[b]){if(this.data.config.butterflies[this.data.data.breed[b].butterfly].rarity==this.data.config.deco[u].bonus.rarity){v=1}}}if(this.data.config.deco[u].coins){coins=this.data.config.deco[u].coins;if(A){coins=Math.ceil(coins*(1-A.buydeco))}}var a="";var q="butterfly.shopBuyCommit("+b+", "+u+")";var d="";var n="";if(this.data.config.deco[u].level>this.data.data.level||this.data.config.deco[u].quest>this.data.data.last_questid){q="";if(this.data.config.deco[u].level>this.data.data.level){n='<div class="block important">'+t_butterfly_require_level.replace("%LEVEL%",this.data.config.deco[u].level)+"</div>"}if(this.data.config.deco[u].quest>this.data.data.last_questid){n='<div class="block important">'+t_butterfly_quest_block.replace("%QUEST%",this.data.config.deco[u].quest)+"</div>"}}if((this.data.config.deco[u].money&&this.data.config.deco[u].money>user_bar)||(this.data.config.deco[u].coins&&coins>user_coins)||(this.data.data.count<this.data.config.deco[u].blossoms)){q="";d="important"}var z="";if(this.data.data.breed[b]&&this.data.data.breed[b].deco==u){q="";z="currently"}m+='<div class="slot link '+z+'" onclick="'+q+'">';if(v){m+='<div class="fav breedpoints_icon"></div>'}m+='  <div class="img deco'+u+'"></div>';m+='  <div class="info">';m+='    <div class="name">'+this.data.config.deco[u].name+"</div>";if(this.data.config.deco[u].level>this.data.data.level||this.data.config.deco[u].quest>this.data.data.last_questid){}else{if(this.data.config.deco[u].money){m+='<div class="'+d+'">'+formatPrice(this.data.config.deco[u].money)+"</div>"}if(this.data.config.deco[u].coins){m+='<div class="'+d+" "+w+'">'+coins+"&nbsp;"+t_coins+"</div>";if(s!=""){m+=s}}if(this.data.config.deco[u].blossoms){m+='<div class="'+d+'">'+this.data.config.deco[u].blossoms+"&nbsp;"+t_butterfly_blossoms+"</div>"}m+='<div class="head">'+t_butterfly_feed_reward+"</div>";if(this.data.config.deco[u].multi_money>1){m+="<div>"+t_butterfly_reward_bonus_money+"&nbsp;"+Math.round((this.data.config.deco[u].multi_money-1)*100)+"%</div>"}if(e.multi_money){m+='<div class="bonus">'+t_butterfly_reward_bonus_money+" "+Math.round((e.multi_money-1)*100)+"% ("+t_butterfly_rarity[this.data.config.deco[u].bonus.rarity]+")</div>"}if(this.data.config.deco[u].multi_points>1){m+="<div>"+t_butterfly_reward_bonus_points+"&nbsp;"+Math.round((this.data.config.deco[u].multi_points-1)*100)+"%</div>"}if(e.multi_points){m+='<div class="bonus">'+t_butterfly_reward_bonus_points+" "+Math.round((e.multi_points-1)*100)+"% ("+t_butterfly_rarity[this.data.config.deco[u].bonus.rarity]+")</div>"}if(this.data.config.deco[u].multi_blossoms>1){m+="<div>"+t_butterfly_reward_bonus_blossoms+"&nbsp;"+Math.round((this.data.config.deco[u].multi_blossoms-1)*100)+"%</div>"}if(e.multi_blossoms){m+='<div class="bonus">'+t_butterfly_reward_bonus_blossoms+" "+Math.round((e.multi_blossoms-1)*100)+"% ("+t_butterfly_rarity[this.data.config.deco[u].bonus.rarity]+")</div>"}if(this.data.config.deco[u].time_reduction){m+='<div class="reduction">'+t_butterfly_deco_time_reduction.replace("%PERCENT%",Math.ceil((1-this.data.config.deco[u].time_reduction)*100))+"</div>"}}m+="  </div>";m+='  <div class="clear"></div>';if(n!=""){m+=n}if(this.data.config.deco[u].level>this.data.data.level||this.data.config.deco[u].quest>this.data.data.last_questid){m+='<div class="locked"></div>'}m+="</div>"}h++}m+='  <div class="clear"></div>';var t=Math.ceil((h-1)/4);if(this.shopPage>1){m+='<div id="butterfly_shop_navi_up" class="up link" onclick="butterfly.shopPage--; butterfly.shopSelect('+b+')"></div>'}if(this.shopPage<t){m+='<div id="butterfly_shop_navi_down" class="down link" onclick="butterfly.shopPage++; butterfly.shopSelect('+b+')"></div>'}m+="</div>";globalBoxFlex(t_butterfly_shop,m,0,0,1);$("globalbox").style.top="50px"};butterfly.prototype.shopBuyCommit=function(h,a){var n="";var c="";var l=t_butterfly_shop_buy_body.replace("%NAME%",this.data.config.deco[a].name);if(this.data.config.deco[a].money){l=l.replace("%COST%",formatPrice(this.data.config.deco[a].money))}if(this.data.config.deco[a].coins){var q=this.data.config.deco[a].coins;var d=specialbonus.findBonus({key1:"butterflies",key2:"buydeco"});if(d){n=specialbonus.htmlBonusLine(d.buydeco,1);c="font-weight:bold; color:green;";q=Math.ceil(q*(1-d.buydeco))}l=l.replace("%COST%",'<div style="'+c+'">'+q+"&nbsp;"+t_coins+"</div>")}if(this.data.config.deco[a].blossoms){l=l.replace("%COST%",this.data.config.deco[a].blossoms+"&nbsp;"+t_butterfly_blossoms)}var b="<div>"+l+"</div>";if(!this.data.data.breed[h].deco){b+="<div>"+t_butterfly_shop_buy_info+"</div>"}if(n!=""){b+='<div style="margin-top:5px;">'+n+"</div>"}var m="butterfly.shopBuy("+h+", "+a+")";var e="butterfly.shopSelect("+h+")";globalcommitbox(t_butterfly_shop_buy_head,b,m,e)};butterfly.prototype.finishCareCommit=function(h){var b=Math.ceil(this.data.data.breed[h].remain/this.data.config.speedup_duration);var e="";var c=specialbonus.findBonus({key1:"butterflies",key2:"speedup"});if(c){e="color:green; font-weight:bold;";b=Math.ceil(b*(1-c.speedup))}var a=t_butterfly_finish_feedtime_body.replace("%AMOUNT%",'<span style="'+e+'">'+b+"</span>");if(c){a+=specialbonus.htmlBonusLine(c.speedup)}var d="butterfly.finishCare("+h+")";globalcommitbox(t_butterfly_finish_feedtime_head,a,d)};butterfly.prototype.showStats=function(){var a='<div id="butterfly_stats">';a+='  <div class="select_line">';a+='    <select id="butterfly_stats_select" onchange="butterfly.stats()">';var b=["points","feed","quests","rarity1","rarity2","rarity3","rarity4"];for(var c=0;c<b.length;c++){var d="";if(this.stats_select==b[c]){d="selected"}a+='<option value="'+b[c]+'" '+d+">"+t_butterfly_stats[b[c]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_butterfly_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select]);a+="</div>";globalBoxFlex("",a,0,0,1)};butterfly.prototype.showQuest=function(){htmlQuestBox("butterfly");this.timerUpdate()};butterfly.prototype.questEntryCommit=function(c){for(var h in this.data.quest.products){if(h==c){var d=this.data.quest.products[c];if(this.data.quest.data&&this.data.quest.data[c]){var d=(d-this.data.quest.data[c])}break}}var a=checkRackItem(c);var b="kp"+c;if(a>d){a=d}var e={pid:c};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(e),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("butterfly.checkQuestEntry("+c+", "+d+")");$("dialog_entryline_number").onkeyup=new Function("butterfly.checkQuestEntry("+c+", "+d+")");this.checkQuestEntry(c,d)};butterfly.prototype.checkQuestEntry=function(a,c){var e=checkRackItem(a);var b="product";var d={type:b,stockamount:e,rest:c,click:"butterfly.questEntry("+a+")"};checkEntryLine(d)};butterfly.prototype.timer=function(){if(this.data.data&&this.data.data.breed){for(var b in this.data.data.breed){this.data.data.breed[b].remain--}this.timerUpdate()}if(this.data.quest&&this.data.quest.remain){this.data.quest.remain--}for(var a in this.stats_cache_delay){this.stats_cache_delay[a]--}};butterfly.prototype.timerUpdate=function(){for(var d in this.data.config.slots){if(!$("butterfly_slot"+d+"_timer")){continue}hideDiv("butterfly_slot"+d+"_timer");showDiv("butterfly_slot"+d+"_button_care");showDiv("butterfly_slot"+d+"_care_ready");if(this.data.data.breed&&this.data.data.breed[d]){var c=this.data.data.breed[d].butterfly;if(this.data.data.breed[d].remain>0){var b='<div style="float:left;">'+formatTime(this.data.data.breed[d].remain)+"</div>";b+='<div class="link speedupgardenbutton" style="float:left;" onclick="butterfly.finishCareCommit('+d+')"></div>';b+='<div class="clear"></div>';$("butterfly_slot"+d+"_timer").innerHTML=b;showDiv("butterfly_slot"+d+"_timer");hideDiv("butterfly_slot"+d+"_button_care");hideDiv("butterfly_slot"+d+"_care_ready");if(this.data.data.breed[d].breedend>0&&this.data.config.butterflies[c].care_count1==this.data.data.breed[d].count){$("butterfly_slot"+d+"_type").className="cocon cocon"+this.data.config.butterflies[c].rarity}}else{if(this.data.data.breed[d].breedend>0&&this.data.config.butterflies[c].care_count1==this.data.data.breed[d].count){var a="medium";if(this.data.config.butterflies[c].size==1){a="small"}if(this.data.config.butterflies[c].size==3){a="big"}$("butterfly_slot"+d+"_type").className="butterfly butterfly"+c+" "+a}if(this.data.data.breed[d].breedend>0){$("butterfly_slot"+d+"_care_ready").addClassName("butterfly")}}}}if(this.data.quest&&!this.data.quest.end){if(this.data.quest.remain>0){showDiv("butterfly_quest_timer");hideDiv("butterfly_quest_data");if($("butterfly_quest_timer")){$("butterfly_quest_timer").innerHTML=formatTime(this.data.quest.remain)}}else{hideDiv("butterfly_quest_timer");showDiv("butterfly_quest_data")}}};butterfly.prototype.help=function(){openFarmersMarketHowTo("butterfly",1);this.helpNavi()};butterfly.prototype.helpNavi=function(a){if(!a){a="general"}$("butterfly_help_navi_tab_general").removeClassName("active");$("butterfly_help_navi_tab_list").removeClassName("active");hideDiv("butterfly_help_general");hideDiv("butterfly_help_list");$("butterfly_help_navi_tab_"+a).addClassName("active");showDiv("butterfly_help_"+a)};butterfly.prototype.close=function(){hideDiv("transp");hideDiv("farmersmarket_pos7_inner")};var calendar=function(){this.data={};this.all=0};calendar.prototype.openField=function(a){calendar.action("calendar_openfield",{field:a})};calendar.prototype.init=function(){calendar.action("calendar_init")};calendar.prototype.action=function(a,b){ajaxAction("farm",a,b,calendar.response)};calendar.prototype.response=function(b,a,c){calendar.data=b;setTimer("calendar");calendar.build();if(b.reward){calendar.showReward(b.reward)}};calendar.prototype.build=function(){var d="";var e=1;for(i in this.data.config.fields){var l="calendar.openFieldCommit("+i+")";var a=" closed";if(this.data.data.days[i]){a+=" opened";l=""}else{e=0}var h=0;if(i<this.data.day&&!this.data.data.days[i]){h=1}d+='<div id="calendar_field'+i+'" class="field '+a+'" onclick="'+l+'" onmouseover="calendar.fieldTT(1, '+i+')" onmouseout="calendar.fieldTT(0, '+i+')">';var a="";if(this.data.day==i){d+='<div id="calendar_current" class="current"></div>';a="white"}if(!this.data.data.days[i]){if(a==""&&this.data.config.season=="xmas"){d+='<div class="glow"></div>'}var b=i;if(this.data.config.showdate==1){b=this.data.config.fields[i].date}else{if(this.data.config.showdate==2){b=this.data.config.fields[i].shortdate}}d+='<div class="date '+a+'">'+b+"</div>"}var c="";var m=6;if(this.data.config.season=="summer"){m=8}if(i%m==0){c="right"}if(i>=19){c+=" bottom"}d+='  <div id="calendar_field'+i+'_tt" class="ttbox '+c+'"></div>';d+='  <div id="calendar_field'+i+'_hover" class="hover"></div>';d+="</div>"}$("calendar_fields").innerHTML=d;if(e==1){hideDiv("calendar_info");setTimeout(function(n){$("calendar_inner").removeClassName("front").addClassName("back")},1000);setTimeout(function(n){$("calendar_fields").insert('<div class="complete">'+t_calendar_all_done_congrat[calendar.data.config.season]+"</div>")},2000);hideDiv("calendar_current")}this.all=e;showDiv("calendar");$("calendar_inner").addClassName("bounce")};calendar.prototype.fieldTT=function(a,c){if(this.all){return 1}for(j in this.data.config.fields){hideDiv("calendar_field"+j+"_tt")}if(a==1&&this.data.data.days[c]){var b='<div class="intro" style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";b+="<div>"+this.rewardObject(this.data.data.days[c].reward)+"</div>";$("calendar_field"+c+"_tt").innerHTML=b;showDiv("calendar_field"+c+"_tt")}hideDiv("calendar_field"+c+"_hover");if(a==1&&!this.data.data.days[c]){showDiv("calendar_field"+c+"_hover")}};calendar.prototype.openFieldCommit=function(e){if(!in_array(e,this.data.config.free)&&e<this.data.day){var b=this.data.config.fields[e].date;var c=t_calendar_open_door_head.replace("%COUNT%",e);var a="<div>"+t_calendar_open_missed_door.replace("%AMOUNT%",this.data.config.missed_coins)+"<div>";a=a.replace("%DATE%",b,a);var d="calendar.openField("+e+")";globalcommitbox(c,a,d)}else{if(e<=this.data.day){this.openField(e)}}};calendar.prototype.close=function(){hideDiv("calendar")};calendar.prototype.showReward=function(c){var b=t_got_gift;var a='<div class="intro" style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";a+=this.rewardObject(c);a+='<div class="button_yes link" style="margin:0 auto; margin-top:10px; width:46px; height:37px;" onclick="hideDiv(\'globalbox\'); hideDiv(\'globaltransp\');"></div>';globalcommitbox(b,a,0,0,1);hideDiv("globalbox_footer")};calendar.prototype.rewardObject=function(e){var c="";for(var b in e){if(b=="present"){c+='<img src="'+imgpath+"gifts/"+e.present+'.gif">'}if(b=="money"){c+="<div>"+formatPrice(e.money)+"</div>"}if(b=="points"){c+="<div>"+formatNumber(e.points)+"&nbsp;"+t_points+"</div>"}if(b=="powerup"){if(windmillarray[e.powerup][5][0][1]){c+='<div class="powerup_birthday" style="margin:0 auto; margin-bottom:10px;"></div>';c+="<div><b>"+t_type_powerup+"</b></div>";c+="<div>"+powerup_bonustext1.replace("%AMOUNT%",windmillarray[e.powerup][5][0][1]).replace("%PRODUCT%",produkt_name[windmillarray[e.powerup][5][0][0]])+"</div>"}else{if(windmillarray[e.powerup][5][3]){c+='<div class="powerup_points" style="margin:0 auto; margin-bottom:10px;"></div>';c+="<div>"+t_payment_pointsboost_info2.replace("%PERCENT%",windmillarray[e.powerup][5][3])+"</div>"}}}if(b=="petspackage"){c+='<div class="petspackage pets_package'+e.petspackage+'"></div>'}if(b=="collect"){if(e.collect.type=="deliver"){var d="deliveryevent_collectitem"}else{if(e.collect.type=="olympia"){var d="olympia_chocolate_berry_mini"}else{var d="cityeasterevent_collectitem"}}c+='<div style="margin-top:10px;">';c+='  <div class="'+d+'" style="float:left;"></div>';c+='  <div style="float:left; margin-left:10px; margin-top:10px;">'+formatNumber(e.collect.amount)+"x</div>";c+='  <div class="clear"></div>';c+="</div>"}if(b=="products"){for(var a in e.products){c+=htmlProductBody(a,e.products[a])}}}return c};calendar.prototype.timer=function(){if(this.data.data.remain>0){this.data.data.remain--;if($("calendar_timer")){$("calendar_timer").innerHTML=t_event_resttime+":&nbsp;"+formatTime(this.data.data.remain)}}else{hideDiv("calendar_link");clearTimer("calendar");this.close()}};var cinema=function(){this.data={};this.go=0;this.turns=0};cinema.prototype.init=function(){cinema.action("cinema_init")};cinema.prototype.buyItem=function(a){cinema.action("cinema_buy_item",{itemid:a})};cinema.prototype.buyReel=function(a){cinema.action("cinema_buy_reel",{coins:a})};cinema.prototype.gambleItems=function(){cinema.action("cinema_gamble_items")};cinema.prototype.videoFinished=function(a){cinema.action("cinema_video_finished",{hash:a})};cinema.prototype.switchPartner=function(a){cinema.turns++;cinema.action("cinema_switch_partner",{})};cinema.prototype.action=function(a,b){ajaxAction("city",a,b,cinema.response)};cinema.prototype.response=function(b,a,c){cinema.data=b;cinema.update();if(in_array(a,["cinema_init"])){cinema.turns=0}if(in_array(a,["cinema_gamble_items","cinema_buy_item","cinema_buy_reel"])){cinema.shop()}setTimer("cinema")};cinema.prototype.update=function(){$("cinema_points").innerHTML=formatNumber(this.data.data.points);var a=0;if(this.data.data.today&&this.data.data.today.length){a=this.data.data.today.length}$("cinema_today").innerHTML=a+"/"+this.data.config.dailyvideos;showDiv("transp3");showDiv("cinema");hideDiv("cinema_adfailinfo");this.start()};cinema.prototype.start=function(){showDiv("cinema_start");showDiv("cinema_disclaimer");hideDiv("cinema_iframe");$("cinema_iframe").src="";hideDiv("cinema_cooldown");hideDiv("cinema_end");if(this.data.data.today&&this.data.data.today.length>=this.data.config.dailyvideos){showDiv("cinema_end");return 1}};cinema.prototype.startVideo=function(){hideDiv("cinema_start");showDiv("cinema_iframe");if(this.turns<2){hideDiv("cinema_disclaimer");$("cinema_iframe").src=this.data.config.partners[this.data.data.partner]}else{if(busAd.go==1){busAd.go=0;busAd.noad()}else{showDiv("cinema_adfailinfo")}}};cinema.prototype.timer=function(){this.data.data.video_remain--;if(this.data.data.video_remain>0){hideDiv("cinema_start");hideDiv("cinema_iframe");showDiv("cinema_cooldown");$("cinema_cooldown_timer").innerHTML=formatTime(this.data.data.video_remain)}else{if(this.data.data.video_remain==-1){this.start()}}this.data.data.selection_remain--;if($("cinema_shop_timer")){$("cinema_shop_timer").innerHTML=formatTime(this.data.data.selection_remain)}if($("cinema").style.display=="block"){if(this.data.data.selection_remain<=0){hideDiv("cinema");this.init()}if(this.data.data.video_remain<=0&&!this.go){hideDiv("cinema_cooldown");this.go=1}}};cinema.prototype.shop=function(){var e='<div id="cinema_shop">';e+='  <div id="cinema_shop_points" class="points">'+formatNumber(this.data.data.points)+'<div class="buyreel link" onclick="cinema.buyReelOptions()">+</div></div>';e+='  <div class="gamble link" onclick="cinema.gambleItemsCommit()">&circlearrowright;</div>';e+='  <div class="intro">'+t_cinema_shop_intro+"</div>";e+='  <div id="cinema_shop_items" class="items">';for(var d=0;d<this.data.data.selection.length;d++){var h="cinema.buyItemCommit("+this.data.data.selection[d].giftid+")";var b="";if(this.data.data.selection[d].points>this.data.data.points){var h="";var b="important"}e+='<div class="item link" onclick="'+h+'">';e+='  <img src="'+imgpath+"gifts/"+this.data.data.selection[d].giftid+'.gif">';e+='  <div class="amount '+b+'">'+formatNumber(this.data.data.selection[d].points)+"</div>";e+='  <div class="pan">'+this.data.data.selection[d].pan+"</div>";e+="</div>"}e+="  </div>";e+='  <div class="timer">'+t_cinema_change_items+'<span id="cinema_shop_timer"></span></div>';e+='  <div class="info" onmouseover="showDiv(\'cinema_shop_info_tt\')" onmouseout="hideDiv(\'cinema_shop_info_tt\')">';e+='    <div id="cinema_shop_info_tt" class="ttbox">';e+='      <div class="head">'+t_cinema_valid_items+"</div>";for(var a in this.data.config.items){var c=a;if(presents_hack[a]){c=presents_hack[a]}e+='<img src="'+imgpath+"gifts/"+c+'.gif">'}e+="    </div>";e+="  </div>";e+="</div>";globalBoxFlex(t_cinema_shop_head,e,0,0,1);$("globalbox").style.top="40px"};cinema.prototype.buyItemCommit=function(a){var h=0;for(var e=0;e<this.data.data.selection.length;e++){if(this.data.data.selection[e].giftid==a){h=this.data.data.selection[e].points}}var b=a;if(presents_hack[a]){b=presents_hack[a]}var d='<img src="'+imgpath+"gifts/"+b+'.gif">';d+='<div style="margin-top:10px;">'+t_cinema_buy_item.replace("%AMOUNT%",formatNumber(h))+"</div>";var l="cinema.buyItem("+a+")";var c="cinema.shop();";globalcommitbox(t_cinema_buy_item_head,d,l,c)};cinema.prototype.buyReelOptions=function(){var c='<div id="cinema_buy_reel">';for(var b in this.data.config.buyreel){var d=t_cinema_buy_reel_item.replace("%AMOUNT%",formatNumber(this.data.config.buyreel[b]));c+='<div class="link coinsbutton_flex" onclick="cinema.buyReelOptionsCommit('+b+')">'+d.replace("%COINS%",b)+"</div>"}c+="</div>";var a="cinema.shop();";globalcommitbox(t_cinema_buy_reel,c,0,a,1)};cinema.prototype.buyReelOptionsCommit=function(a){var d=t_cinema_buy_reel_item.replace("%AMOUNT%",formatNumber(this.data.config.buyreel[a]));html="<div>"+d.replace("%COINS%",a)+"</div>";var c="cinema.buyReel("+a+")";var b="cinema.buyReelOptions();";globalcommitbox(t_cinema_buy_reel,html,c,b)};cinema.prototype.gambleItemsCommit=function(){html="<div>"+t_cinema_gamble_items_body.replace("%COINS%",this.data.config.gamblecoins)+"</div>";globalcommitbox(t_cinema_gamble_items,html,"cinema.gambleItems()","cinema.shop()")};cinema.prototype.close=function(){hideDiv("transp3");hideDiv("cinema");$("cinema_iframe").src=""};var ganmedia={addEvent:function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent("on"+a,b)}}},onMessage:function(l){if(l.data=="BusPausieren"){if(mapTravelStop()){l.source.postMessage("pausiert",l.origin)}}else{if(l.data=="BusWeiterfahren"){mapTravelAd(0)}else{if(l.data=="PremiumHeute"){mapTravelAd(1,travelad_hash)}}}if(l.origin=="http://media.oadts.com"||l.origin=="https://media.oadts.com"){cinema.go=0;var b=l.data.trim();if(b=="videoStart"){hideDiv("cinema_disclaimer");cinema.go=1}else{if(b=="noVideo"||b=="NoVideo"){cinema.switchPartner()}else{if(b=="videoEnds"){}else{if(b.indexOf("videoEnds:")==0){cinema.go=0;hideDiv("cinema_iframe");$("cinema_iframe").src="";var a=b.replace("videoEnds:","");var d=a.indexOf(":");var c=a.substring(0,d);var h=a.substring(d+1);cinema.videoFinished(h)}else{}}}}}},init:function(){var a=this;this.addEvent(window,"message",function(b){a.onMessage(b)})}};ganmedia.init();var messageMethode=function(l){var c=l.origin||l.originalEvent.origin;if(c!=="https://player.adbility.media"){return}var h=(l.data);var d="~";var e=h.indexOf(d);if(e!=8){return}var b=h.split("~");var a=b[0];var m=b[1];if(in_array(a,["adstarted"])){hideDiv("cinema_disclaimer")}if(in_array(a,["noaddisp","noad","plyerror"])){if(busAd.go==1){busAd.noad()}else{cinema.switchPartner()}}if(in_array(a,["adcomplt","adcompl"])){if(busAd.go==1){busAd.go=0;busAd.watched()}else{cinema.go=0;cinema.data.data.video_remain=cinema.data.config.cooldown;hideDiv("cinema_iframe");$("cinema_iframe").src="";cinema.videoFinished(m)}}};window.addEventListener("message",messageMethode);var goto_merchant=0;function cityAction(m,u,t,s,q){var b=city;var c="";if(m=="animaldealer_buysuperanimal"){c+="&action="+u}if(m=="initcity"){b=u}if(m=="initcitynew"){b=u}if(m=="wm_buyballs"){if(wm_sheep_block==1){return false}c+="&coins="+u;wm_sheep_block=1}if(m=="wm_exchangeballs"){c+="&id="+u}if(m=="buypresent"){c+="&giftid="+u.giftid+"&name1="+encodeURIComponent(u.name1)+"&msg1="+encodeURIComponent(u.msg1)+"&name2="+encodeURIComponent(u.name2)+"&msg2="+encodeURIComponent(u.msg2)+"&server1="+u.server1+"&server2="+u.server2}if(m=="buypresentfriend"){c+="&giftid="+u+"&friend="+t+"&msg="+encodeURIComponent(s)}if(m=="cashlotteryprize"){c+="&prize="+u}if(m=="cancelad"){c+="&pass="+encodeURIComponent(u)}if(m=="buyad"){c+="&ad="+u}if(m=="writemarktschreier"){c+="&msg="+encodeURIComponent(u)}if(m=="delmarktschreier"){c+="&mid="+u}if(m=="delpresent"){c+="&id="+u}if(m=="giverpresent"){c+="&id="+u}if(m=="buybee"){c+="&param="+u}if(m=="buyfish"){c+="&param="+u}if(m=="sendcollectorsitem"){c+="&pid="+u+"&category="+t}if(m=="buyformula"){if(buyFormula_block==1){return false}buyFormula_block=1;c+="&formula="+u+"&amount="+t}if(m=="birthday_citysheep_swap"){c+="&sheep="+u}if(m=="birthday_citysheep_buy"){birthday_buy_block=1;c+="&cards="+u}if(m=="windmillstartproduction"){c+="&formula="+u+"&slot="+t}if(m=="windmillcrop"||m=="windmillcancel"){c+="&slot="+u}if(m=="animaldealerbuy"){if(!animaldealer_cart||!$("animaldealer_select"+animaldealer_cart)||animaldealer_block){return false}animaldealer_block=1;var a=$("animaldealer_select"+animaldealer_cart).value;var n=0;for(var e=1;e<=30;e++){if(!animaldealer_data[e]||animaldealer_cart!=animaldealer_data[e][0]){continue}for(var d in animaldealer_data[e].prices){if(animaldealer_data[e].prices[d].i<=a){n++}}}c+="&str="+animaldealer_cart+"_"+n}if(m=="setslotclothingdonation"){var h=$("clothingdonation_slotselect").value;var r=$("clothingdonation_slothidden").value;c+="&pid="+h+"&slot="+r}if(m=="telekomentry"){c+="&pid="+u}if(m=="exchangecoins"){if(!coinsblocker){coinsblocker=1;c+="&coins="+u}else{return false}}if(m=="buycoinspremium"){if(!coinsblocker){coinsblocker=1;c+="&month="+u}}showGlobalWait(m);var l=createAjaxRequestObj();l.open("GET","ajax/city.php?rid="+rid+"&city="+b+"&mode="+m+c,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.onreadystatechange=function(){cityActionResponse(l,m,u,t,s,q)};l.send(null)}function cityActionResponse(l,m,h,e,d,c){var b=_chkRequest(l,m);if(b!=0){hideGlobalWait();if(m=="animaldealerbuy"){animaldealer_block=0}if(m=="birthday_citysheep_buy"){birthday_buy_block=0}if(m=="buyformula"){buyFormula_block=0}collector_block=0;coinsblocker=0;if(b[0]==0){wm_sheep_block=0;globalerrorbox(b[1]);if(m=="initbeemaster"||m=="initfishpool"){hideDiv("transp3")}}else{var a=["buybee","buyformula","windmillinit","windmillbuyslot","windmillcrop","windmillstartproduction","windmillcancel","gambleclothingdonation","donateclothingdonation","setslotclothingdonation","sendcollectorsitem","randomformulas","delpresent","giverpresent","delmarktschreier","buyad","cancelad","buynewlot","cashlotteryprize","lotgetprize","buypresent","wm_buyballs","wm_exchangeballs","animaldealerinit","animaldealer_buysuperanimal","exchangecoins","buycoinspremium"];if(in_array(m,a)){hideDiv("globalbox");hideDiv("globaltransp")}if(m=="birthday_citysheep_init"||m=="birthday_citysheep_swap"||m=="birthday_citysheep_buy"){birthday_citysheep_data=b[1];birthdayCitySheepDialog("init")}if(m=="windmillinit"||m=="windmillbuyslot"||m=="windmillcrop"||m=="windmillstartproduction"||m=="windmillcancel"){windmill_stock=b[1];windmill_slots=b[2];windmill_slotremain=b[3];windmill_ready=b[4];windmill_first=b[5];if(xmastime==1){$("windmillinner").style.background="url("+imgpath+"city/windmill_inner2_xmas.jpg)"}else{$("windmillinner").style.background="url("+imgpath+"city/windmill_inner2.jpg)"}showDiv("windmillinner");if(m=="windmillcrop"){if(b[6]&&b[6].leveltitle){levelupAlert(b[6].level,b[6].leveltitle)}globalerrorbox(windmillcropinfo)}hideDiv("windmill_paper");closeWindmillFormulaSelect();windmill_page=1;windmillSlots();checkWindmillStatus()}if(m=="initclothingdonation"||m=="gambleclothingdonation"||m=="donateclothingdonation"||m=="setslotclothingdonation"){clothingdonation_data=b[1];showClothingDonation()}if(m=="animaldealerinit"||m=="animaldealerbuy"||m=="animaldealer_buysuperanimal"){animaldealer_data=b[1];buildAnimalDealer()}if(m=="animaldealerbuy"){animaldealer_cart="";showFeedback2("animaldealerfeedback",t_animaldealer_buysuccess)}if(m=="initcity"){getInitCityDataResponse(b,h,e,d)}if(m=="buyformula"){showFeedback2("formuladealerbubble",formuladealer_feedback,formuladealer_bubble);setFormulaDealerRack(b[2])}if(m=="initcollector"){initCollectorResponse(b)}if(m=="sendcollectorsitem"){initCollectorResponse(b,h,e)}if(m=="initformuladealer"){initFormulaDealerResponse(b)}if(m=="randomformulas"){windmillinfo=b[1];flipRandomFormulas();gamblelock=0}if(m=="buyfish"){buyFishResponse()}if(m=="initfishpool"){initFishPoolResponse(b)}if(m=="initbeemaster"){openBeemasterResponse(b)}if(m=="getpresents"){giftlist=b[1]}if(m=="delpresent"){hideDiv("pancontainer");showPan()}if(m=="giverpresent"){if(b[2].levelup&&b[2].levelup.level){levelupAlert(b[2].levelup.level,b[2].levelup.leveltitle)}pan_items=b[1];buildPanContent();panFlyer(h,b[3])}if(m=="initnewsboy"){initNewsboyResponse(b)}if(m=="initmarktschreier"||m=="writemarktschreier"||m=="delmarktschreier"){openMarktschreiberResponse(b)}if(m=="initadcolumn"){hideDiv("showtimeadcolumn");adinfo=b;fillAdColumn()}if(m=="buyad"){buyAdResponse(b)}if(m=="cancelad"){cancelAdResponse(b)}if(m=="initlottery"){initLotteryResponse(b)}if(m=="newlot"){dailyLotResponse(b)}if(m=="buynewlot"){buyNewLotResponse(b)}if(m=="cashlotteryprize"){cashLotteryPrizeResponse(b)}if(m=="lotgetprize"){lotGetPrizeResponse(b)}if(m=="buypresentfriend"){$("friendsinfo").innerHTML="<br><br>"+str_replace("%NAME%","<b>"+c+"</b>",friendlist_gift_success)}if(m=="buypresent"){clearPresenteeInfo();showDiv("giftshopsuccess")}if(m=="telekominit"||m=="telekomentry"){cityTelekomOpen(b[1])}if(m=="initcity"&&c==1){initCampaigns()}if(m=="exchangecoins"||m=="buycoinspremium"){closeCoinsBox()}if(m=="wm_init"||m=="wm_buyballs"||m=="wm_exchangeballs"){openWM(b[1])}if(goto_merchant==1){merchant.open();goto_merchant=0}}}}var clooney=0;function initCity(c,n,a,b){questbox=n;inguild=0;if(tutorial>0&&tutorial<4){return false}foodworld_quicknavi=0;train_quicknavi=0;getInitCityData(c,n,a,b);clearTimeout(letmytimerdone);killGardenTimeruns();closeForestry();if(typeof clearMarketTimer=="function"){clearMarketTimer()}if(cropactionrunner){window.clearInterval(cropactionrunner)}closeFoodcontest();hideDiv("globaltransp");hideDiv("globalbox");for(var e=1;e<=4;e++){for(var d=1;d<=100;d++){if(forestry_questdelay_run[e+"_"+d]){window.clearInterval(forestry_questdelay_run[e+"_"+d]);forestry_questdelay_run[e+"_"+d]=0;forestry_questdelay_time[e+"_"+d]=0}}}farm_checker_open=0;var m=["shop","adcolumn","animaldealer","formuladealer","fishpoolinner","windmillinner","marktschreierinner","giftshopinner","collectorscontainer","questboxtransp","questbox","transp3","popup_garden","tutorial","farmhousecontainer","farmhousetransp","createguildbox","friendscontainer","globaltransp","notepad","swanani","gooseani","butterflyani","fishani","fishani2","einkaufszettel","multiframe","wbwcontainer","lotterycontainer","newsboy","newsboystart","newsbox","minigameShipTransp","minigameShip","clothingdonation_transp","clothingdonation","farm_production_checker_icon","farm_production_checker","map_stall"];for(var e=0;e<m.length;e++){if($(m[e])){hideDiv(m[e])}}if(eventgarden&&$("eventgarden")){eventgarden.close()}if(greenhouse&&$("greenhouse")){greenhouse.close()}closeFoodworld();hideDiv("forestry_questlist_container");$("multiframe").src="";$("cityzones").innerHTML="";closeMarket();closeCropAction();if(c>1){hideDiv("showtimeadcolumn")}if(c==2){if(currentuserlevel>=37){showDiv("clothingdonation_link");if(currentuserlevel>=38){$("clothingdonation_link_tt").innerHTML=t_clothingdonation_citylink;$("clothingdonation_link").onclick=new Function("cityAction('initclothingdonation')")}else{$("clothingdonation_link_tt").innerHTML="<b>"+t_clothingdonation_headline+"</b><br><br>"+str_replace("%LEVEL%",38,noupdate_lowlevel);$("clothingdonation_link").onclick=new Function()}if(!stopanimation){showDiv("clothingdonation_link_sparrow")}else{hideDiv("clothingdonation_link_sparrow")}}else{hideDiv("clothingdonation_link")}}else{hideDiv("clothingdonation_link")}if($("em_fan")){if(c==1){showDiv("em_fan")}else{hideDiv("em_fan")}closeWM()}if($("cityeasterbunny")){if(c==1){showDiv("cityeasterbunny")}else{hideDiv("cityeasterbunny")}easterevent.close()}if($("xmasevent_city")){if(c==1){showDiv("xmasevent_city")}else{hideDiv("xmasevent_city")}closeCityXmasEvent()}if($("nutcracker_city_link")){if(c==1){showDiv("nutcracker_city_link")}else{hideDiv("nutcracker_city_link")}nutcracker.close()}if($("clooneyscreen")){if(c==1&&clooney==0){showDiv("clooneyscreen")}else{hideDiv("clooneyscreen")}closeClooney()}if($("fantaboy")){if(c==1){showDiv("fantaboy")}else{hideDiv("fantaboy")}closeFanta()}if($("city_telekom_banner")){if(c==1){showDiv("city_telekom_link");showDiv("city_telekom_banner");var h="";var l=getRandom(1000000,9999999);h+='<iframe style="height:1px; width:1px; border:0px;" src="http://media.gan-online.com/www/delivery/lg.php?zoneid=0&campaignid=4980&bannerid=13145&cb='+l+'"></iframe>';h+='<iframe style="height:1px; width:1px; border:0px;" src="http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=19&mc=imp&pli=8582109&PluID=0&ord='+l+'&rtu=-1"></iframe>';$("city_telekom_banner").innerHTML=h;$("city_telekom_banner").onclick=new Function("window.open('https://media.gan-online.com/www/delivery/ck.php?oaparams=2__bannerid=13144__zoneid=0__cb="+l+"')")}else{hideDiv("city_telekom_link");hideDiv("city_telekom_banner")}}if($("merchant_link")){if(c==1){}else{hideDiv("merchant_link")}}if($("jamexchange_link")){if(c==1){}else{hideDiv("jamexchange_link")}}if($("infinitequestline_link")){if(c==2){showDiv("infinitequestline_link")}else{hideDiv("infinitequestline_link")}}if($("reallocatebuilding_symbol")){hideDiv("reallocatebuilding_symbol")}if($("reallocateanimals_symbol")){hideDiv("reallocateanimals_symbol")}if($("farm_production_checker_icon")){hideDiv("farm_production_checker_icon")}}function getInitCityData(d,c,b,a){cityAction("initcity",d,c,b,a)}var cropactionman=0;var forestyquest_timeout=0;function getInitCityDataResponse(a,d,h,e){premium=a[1];var b=a[0];windmill_ready=a[3];if(a[5]==1){forestry_unlock=1}cropactionman=a[7];hideDiv("forestry_nextquest");if(d==2){if(a[6]>0){hideDiv("forestry_nextquest");if(!forestyquest_timeout){forestyquest_timeout=window.setTimeout("showDiv('forestry_nextquest'); forestyquest_timeout=0;",(a[6]*1000))}}else{if(a[6]<0){hideDiv("forestry_nextquest")}else{if(a[6]==0){showDiv("forestry_nextquest")}}}}windmill_coinsslot=a[8];cityzones=a;var c=1;if(d==city){c=0}city=d;if(premium==0&&c==1&&changecitydelay>0&&travelad==1&&!e){if(tutorial==5||tutorial==10||tutorial==11){cityArrived(h)}else{mapGo2Location("city",city)}}else{cityArrived(h)}}function cityArrived(d){var b=cityzones[0];clearTimeout(letmytimerdone);if(xmastime==1){if(city==1){$("citymaincontainer").style.backgroundImage="url("+imgpath+"city/cityview2_xmas.jpg)"}else{if(city==2){$("citymaincontainer").style.backgroundImage="url("+imgpath+"city/city2_back3_xmas.jpg)"}}}else{if(city==1){if(setarab||nopigs){var h="stadt1_tag_ir.jpg"}else{var h="stadt1_tag_all.jpg"}$("citymaincontainer").style.backgroundImage="url("+imgpath+"stadt/"+h+")"}else{if(city==2){$("citymaincontainer").style.backgroundImage="url("+imgpath+"city/city2_back3.jpg)"}}}for(var e=1;e<10;e++){if(!stopanimation){if($("peopleaniimg"+e)){if(city==1){$("peopleaniimg"+e).src=imgpath+"people_ani"+e+".gif"}else{$("peopleaniimg"+e).src=imgpath+"leer.gif"}}}}farm=0;speedLinks();showDiv("citymaincontainer");var m="";for(e in b){var r="close_page(); showDiv('transp3');";var q="";var l="";var n=b[e][3];var c=b[e][2];if(n=="s"){r="showDiv('shop'); shopAction('shopinit', "+b[e][4]+")"}else{if(n=="st"){if(new_city_stats_active==1&&statscacher){r+="statscacher.init()"}else{r+="statsOpen();"}}else{if(n=="w"){r+="showDiv('transp3'); showDiv('wbwcontainer'); setCityWBWContent(2);"}else{if(n=="m"){r+="marketAction('marketinit');"}else{if(n=="ad"){r+="showDiv('animaldealer'); initAnimalDealer();"}else{if(n=="l"){r+="initAdColumn();"}else{if(n=="b"){r="";if(currentuserlevel>=cityentry2){r+="openMap();"}}else{if(n=="b2"){r+="openMap();"}else{if(n=="ms"){r+="openMarktschreier();"}else{if(n=="bm"){r="openBeemaster();"}else{if(n=="p"){r+="giftshop.init();"}else{if(n=="muehle"){r+="initWindmill();"}else{if(n=="fd"){r+="initFormulaDealer();"}else{if(n=="zfd"){r+="initFishPool();"}else{if(n=="c"){r+="initCollector();"}else{if(n=="lottery"){r+="initLottery();"}else{if(n=="forestquest"){r+="initCampaigns();"}else{if(n=="nb"){r+="initNewsboy();"}else{if(n=="forest"){r+="mapGo2Location('forestry');";c=str_replace("%INFO%","",c);if(forestry_unlock==0){r="";c=str_replace("%INFO%","<div class='important'>"+unlock_info+"</div><br>",c)}}else{if(n=="fw"){r="";if(currentuserlevel>=11){r="mapGo2Location('picknick')"}else{c+="<br><br>"+str_replace("%LEVEL%",11,minlevel_feature)}}else{if(n=="h"){r="openMap();"}}}}}}}}}}}}}}}}}}}}}if(currentuserlevel<cityentry2&&n=="b"){c=str_replace("%LEVEL%",cityentry2,cityzone8_2)}if((tutorial<5&&tutorial>0)&&n=="s"){r=""}if((tutorial<6&&tutorial>0)&&(n=="m"||n=="w")){r=""}m+='<div id="cityzone_'+city+"_"+e+'" onclick="'+r+'" class="link" onmouseover="showDiv(\'cityzone_tt_'+city+"_"+e+"'); "+q+'" onmouseout="hideDiv(\'cityzone_tt_'+city+"_"+e+"'); "+l+'">';m+='  <div id="cityzone_tt_'+city+"_"+e+'" class="blackbox">'+c+"</div>";if(ad_action==1&&city==1&&e==7&&currentuserlevel>=5){m+='<div id="cityzone_ad_special">';m+='  <div id="cityzone_ad_special_inner">-'+ad_action_percent+"%</div>";m+="</div>"}if(hartmutaction==1&&city==1){m+='<div id="cityzone_hartmut_special">';m+='  <div id="cityzone_hartmut_special_inner">!</div>';m+="</div>"}m+="</div>"}var a=["fishdealerani","formuladealerani","formuladealerani_easter","pepeani","bunnyani"];for(var e=0;e<a.length;e++){hideDiv(a[e])}if(city==2&&!stopanimation){for(var e=0;e<a.length;e++){showDiv(a[e])}}if(cropactionman&&city==1){showDiv("cropactionman");$("cropactionman").addClassName("action"+cropactionman.action).addClassName("setanimal"+cropactionman.reward.animalid)}else{hideDiv("cropactionman")}$("cityzones").innerHTML=m;if(tutorial==4){increaseTutorialStep();tutorial=5}if(tutorial==9){increaseTutorialStep();tutorial=10;hideDiv("tutorial17");setBlockMain(2);showTutorial(18,1)}if(tutorial==5){hideDiv("tutorial7");showTutorial(8,1);setBlockMain(2)}if(tutorial==10){showTutorial(18,1)}if(tutorial==11){hideDiv("tutorialline");showTutorial(25)}if(tutorial==12){showTutorial(26)}if(city>1){hideDiv("showtimeadcolumn")}else{if(currentad!=0){if($("cityzone_1_7")){$("cityzone_1_7").onmouseover=function(s){showDiv("showtimeadcolumn")};$("cityzone_1_7").onmouseout=function(s){hideDiv("showtimeadcolumn")}}}}hideDiv("windmill_readyani");hideDiv("windmillani");checkWindmillStatus();if($("birthday_townsheep_4th")){if(city==1){showDiv("birthday_townsheep_4th")}else{hideDiv("birthday_townsheep_4th")}}if(xmastime==1&&city==1){$("cityzone_1_12").style.background="url("+imgpath+"city/xmas_giftshop.jpg)"}if($("cinema_link")){cinema.close()}if(city>1){hideDiv("cinema_link")}else{showDiv("cinema_link")}}var animaldealer_data=new Object;var animaldealer_cart=0;var animaldealer_block=0;function initAnimalDealer(){cityAction("animaldealerinit")}function buildAnimalDealer(){if(animaldealer_data){var h="";for(var e=1;e<=30;e++){if(!animaldealer_data[e]){continue}var b=animaldealer_data[e][0];h+='<div class="animaldealer_line">';h+='  <div class="animaldealer_line_back"></div>';h+='  <div class="animaldealer_line_animal animaldealer_line_animal'+b+'"></div>';if(animaldealer_data[e].free){h+='<button class="animaldealer_buybutton button_new link" onclick="animaldealer_cart=\''+b+"'; cityAction('animaldealerbuy');\" type=\"button\">"+str_replace("%COST%",'<span id="animaldealer_buybutton'+b+'"></span>',t_animaldealer_buy)+"</button>";if(animaldealer_data[e].free>1){h+='<select class="animaldealer_select" id="animaldealer_select'+b+'" onchange="calcAnimalDealer()">';for(var c=1;c<=animaldealer_data[e].free;c++){if(animaldealer_data[e].prices[c]){h+='<option value="'+animaldealer_data[e].prices[c].i+'">'+c+"</option>"}}h+="</select>"}else{if(animaldealer_data[e].prices&&animaldealer_data[e].prices[1]){h+='<input type="hidden" id="animaldealer_select'+b+'" value="'+animaldealer_data[e].prices[1].i+'">'}}}else{var n="";if(animaldealer_data[e].prices&&!animaldealer_data[e].block){if(animaldealer_data[e].count){if(animaldealer_data[e].freeproduction){n=t_animaldealer_isproduction}else{if(!animaldealer_data[e].free){n=t_animaldealer_nospace}}}if(!animaldealer_data[e].count&&!animaldealer_data[e].free){n=t_animaldealer_nobuilding}h+='<div class="animaldealer_notbuyable_info"><span class="bonusinfo">'+formatPrice(animaldealer_data[e].prices[1].p)+'</span><br><span class="important">'+n+"</span></div>"}else{h+='<div class="animaldealer_notbuyable_info"><span class="important">'+str_replace("%LEVEL%",animaldealer_data[e][4],minlevel_feature)+"</span></div>"}}h+="</div>"}$("animaldealercontent").innerHTML=h;calcAnimalDealer();if(tutorial==10){showTutorial(19,2);increaseTutorialStep();tutorial=11}if(animaldealer_data.superanimals){var d=animaldealer_data.superanimals;var a=0;for(var e=0;e<d.data.length;e++){if(d.data[e].action==d.current.action&&d.data[e].sum>=d.current.sum){a=1}}var h="";h+='<div style="position:absolute; top:58px; height:400px;">';h+='  <div class="base" style="margin-bottom:20px; text-align:center; color:#fff; font-weight:bold; opacity:0.5; border-top-left-radius:5px; border-top-right-radius:5px;"></div>';h+='  <div style="position:absolute; top:0px; left:0px; width:100%;">';h+='    <div style="padding:10px; font-size:14px; font-weight:bold;">'+t_animaldealer_superanimals_title+"</div>";h+='    <div style="margin-bottom:5px;">'+d.config.animal_special[d.current.reward.animalid][d.current.action].title+"</div>";if(d.config.animal_special[d.current.reward.animalid][d.current.action].cropbonus){var m=str_replace("%BONUS%",d.config.animal_special[d.current.reward.animalid][d.current.action].cropbonus,t_animal_special_cropbonus)}if(d.config.animal_special[d.current.reward.animalid][d.current.action].productiontime){var m=str_replace("%TIME%",formatTime(d.config.animal_special[d.current.reward.animalid][d.current.action].productiontime),t_cropaction_productiontime)}h+='  <div style="margin-bottom:5px;">'+m+"</div>";h+='    <div style="margin-bottom:5px; padding:10px 0px; background-color:#A27242;">'+t_offer_ends+'<br><span id="animaldealer_superanimal_timer">&nbsp;</span></div>';if(!d.current.bought){h+='<div class="link coinsbutton_flex link" style="font-size:14px; padding:5px; z-index:100;" onclick="buySuperAnimalAnimalDealer('+d.current.action+')">'+d.config.coins+"&nbsp;"+t_coins+"</div>"}else{h+='<div style="5px 0px 10px 0px;">'+t_animaldealer_superanimals_bought+"</div>"}h+="  </div>";h+='  <div style="position:absolute; bottom:-10px; width:170px; height:225px;">';var l="animaldealer_superanimal_minimize city_animal_special"+d.current.reward.animalid+"_"+d.current.reward.special;if(d.current.reward.animalid==12&&d.current.action==5){l="walking_goat"}h+='    <div class="'+l+'" style="position:absolute; background-position:50% bottom; background-repeat:no-repeat;"></div>';h+="  </div>";h+="</div>";$("animaldealer_superanimal").innerHTML=h;showDiv("animaldealer_superanimal");$("animaldealercontent").style.marginLeft="0px";setTimer("animaldealer")}else{hideDiv("animaldealer_superanimal");$("animaldealercontent").style.marginLeft="80px"}}}function buySuperAnimalAnimalDealer(e){var d=animaldealer_data.superanimals;var b=t_animaldealer_superanimals_dialog_head;var a=str_replace("%COINS%",d.config.coins,t_animaldealer_superanimals_intro);a=str_replace("%NAME%","<b>"+d.config.animal_special[d.current.reward.animalid][d.current.action].title+"</b>",a);var c="cityAction('animaldealer_buysuperanimal', "+e+")";globalcommitbox(b,a,c)}function timerAnimalDealer(){if(animaldealer_data.superanimals){animaldealer_data.superanimals.current.remain--;if(animaldealer_data.superanimals.current.remain>-1){if($("animaldealer_superanimal_timer")){$("animaldealer_superanimal_timer").innerHTML=formatTime(animaldealer_data.superanimals.current.remain)}}else{clearTimer("animaldealer");if(city==1){initAnimalDealer()}}}}function calcAnimalDealer(){for(var c=1;c<=30;c++){var d=0;if(!animaldealer_data[c]){continue}var a=animaldealer_data[c][0];if(!$("animaldealer_select"+a)){continue}var h=$("animaldealer_select"+a).value;if(h){var e=0;for(var b in animaldealer_data[c].prices){if(animaldealer_data[c].prices[b].i<=h){d+=animaldealer_data[c].prices[b].p}}}$("animaldealer_buybutton"+a).innerHTML=formatPrice(d)}}function closeAnimalDealer(){hideDiv("transp3");hideDiv("animaldealer")}function initAdColumn(){if(adrun){var b=str_replace("%WIMS%",currentad.bonus,cityadcancel);if(checkPartnerPortal()||isSteam()==1){var a="cancelAd();"}else{var a="cancelAdCommit();"}var c="hideDiv('globalbox'); hideDiv('globaltransp'); hideDiv('transp3');";globalcommitbox(cityadcancelheadline,b,a,c)}else{cityAction("initadcolumn")}}function cancelAdCommit(){var b=infodestructbuildingcommit2+'<br><input type="password" id="cancelad_pass" name="cancelad_pass">';var a="cancelAd();";var c="hideDiv('globalbox'); hideDiv('globaltransp'); hideDiv('transp3');";globalcommitbox(cityadcancelheadline,b,a,c)}function fillAdColumn(){var e="";var d=0;for(_obj in adinfo){d++}for(var b=1;b<=10;b++){if(adinfo[b]){var a=adinfo[b];var m="";var n="";var l="";var h=20;var c=15;if(a.kt>0){n="<div onmouseover=\"showDiv('adtttinfo"+b+"m');\" onmouseout=\"hideDiv('adtttinfo"+b+'m\');"><img src="'+imgpath+'money.gif" width="12" height="12">&nbsp;'+formatPrice(a.kt)+"</div>";l+='<div id="adtttinfo'+b+'m" class="blackbox" style="display:none; z-index:100; position:absolute; top:'+h+'px; left:0px; white-space:nowrap;">'+t_money+"</div>";h+=c}if(a.coins>0){n+="<div onmouseover=\"showDiv('adtttinfo"+b+"c');\" onmouseout=\"hideDiv('adtttinfo"+b+'c\');"><img src="'+imgpath+'menu/coins.gif" width="12" height="12">&nbsp;'+a.coins+"</div>";l+='<div id="adtttinfo'+b+'c" class="blackbox" style="display:none; z-index:100; position:absolute; top:'+h+'px; left:0px; white-space:nowrap;">'+t_coins+"</div>";h+=c}n+="<div onmouseover=\"showDiv('adtttinfo"+b+"t');\" onmouseout=\"hideDiv('adtttinfo"+b+'t\');"><img src="'+imgpath+'adtime.gif" width="12" height="12">&nbsp;'+formatTime(a.time)+"</div>";l+='<div id="adtttinfo'+b+'t" class="blackbox" style="display:none; z-index:100; position:absolute; top:'+h+'px; left:0px; white-space:nowrap;">'+cityadduration+"</div>";h+=c;n+="<div onmouseover=\"showDiv('adtttinfo"+b+"b');\" onmouseout=\"hideDiv('adtttinfo"+b+'b\');"><img src="'+imgpath+'adbonus.gif" width="12" height="12">&nbsp;'+a.bonus+"</div>";l+='<div id="adtttinfo'+b+'b" class="blackbox" style="display:none; z-index:100; position:absolute; top:'+h+'px; left:0px; white-space:nowrap;">'+str_replace("%WIMS%",a.bonus,cityadbonus)+"</div>";if(a.premium==1){if(premium==0){n+='<br><span class="important">'+inforequirepremium+"</span>"}}n+="</div>"+l;e+='<div class="link" id="adzone_'+city+"_"+b+'" ';e+="onmouseover=\"showDiv('adzonetooltip"+b+"'); showDiv('adzoneshowad_"+city+"_"+b+"');\" onmouseout=\"hideDiv('adzonetooltip"+b+"'); hideDiv('adzoneshowad_"+city+"_"+b+"');\" ";e+='onclick="buyadcommit('+b+');">';if(a.aktion==1){e+='<div style="position:absolute; z-index:100; top:7px; left:-2px; background:url('+imgpath+'topaktion_medium_ani.gif) top left no-repeat; height:30px; width:30px;">';e+='<div style="position:absolute; top:8px; width:30px; color:#fff; text-align:center;">-'+ad_action_percent+"%</div>";e+="</div>"}e+='<div id="adzoneshowad_'+city+"_"+b+'" onmouseover="showDiv(\'adzonetooltip'+b+"'); showDiv('adzoneshowad_"+city+"_"+b+"');\" onmouseout=\"hideDiv('adzonetooltip"+b+"'); hideDiv('adzoneshowad_"+city+"_"+b+"');\"></div>";e+='<div class="blackbox" id="adzonetooltip'+b+'" onmouseover="showDiv(\'adzonetooltip'+b+"');\" onmouseout=\"hideDiv('adzonetooltip"+b+"');\">"+n+"</div>";if(a[4]==1){e+='<div class="important" style="position:absolute; top:27px; right:-2px; z-index:38;"><img src="'+imgpath+'menu/premium_icon.gif"></div>'}e+="</div>"}}hideDiv("transp5");$("adcolumncontent").innerHTML=e;showDiv("adcolumn")}function cancelAd(){if(checkPartnerPortal()||isSteam()==1){var a="none"}else{if($("cancelad_pass").value!=""){if(upportaluser==1){var a=$("cancelad_pass").value}else{var a=$("cancelad_pass").value}}else{return false}}cityAction("cancelad",a)}function cancelAdResponse(a){window.clearInterval(adrun);adrun=0;adtime=0;adtimegesamt=0;hideDiv("showtimeadcolumn");currentad=0;hideDiv("transp3");if($("cityzone_1_7")){$("cityzone_1_7").onmouseout=function(b){$("cityzone_1_7").style.backgroundImage="url("+imgpath+"leer.gif)";hideDiv("cityzone_tt_1_7")};$("cityzone_1_7").onmouseover=function(b){$("cityzone_1_7").style.backgroundImage="url("+imgpath+"city/1_7_over.gif)";$("cityzone_1_7").style.backgroundPosition="6px 0px";showDiv("cityzone_tt_1_7")}}}function buyadcommit(c){var a="";a+='<div><img src="'+imgpath+'adtime.gif">&nbsp;'+formatTime(adinfo[c].time)+"</div>";a+='<div><img src="'+imgpath+'adbonus.gif">&nbsp;'+str_replace("%WIMS%",adinfo[c].bonus,cityadbonus)+"</div>";if(adinfo[c].kt>0){a+="<div>"+cityadcost+formatPrice(adinfo[c].kt)+"</div>"}if(adinfo[c].coins>0){a+="<div>"+cityadcost+adinfo[c].coins+"&nbsp;"+t_coins+"</div>"}a+='<div style="margin-top:10px;">'+cityadcommit+"</div>";var b="buyAd("+c+")";globalcommitbox(cityadbuyheadline,a,b)}function buyAd(a){cityAction("buyad",a)}function buyAdResponse(a){currentad=a[1];setAdCountDown(a[1]);hideDiv("adcolumn");hideDiv("transp3");hideDiv("transp5")}function checkAd(){if(currentad==0){hideDiv("showtimeadcolumn")}else{if(currentad){setAdCountDown(currentad)}}}function setAdCountDown(c){if(currentad.remain==1){var b=farmistatsadlineday}else{var b=farmistatsadlinedays}var a=adbegin+"<br><b>"+currentad.startad+"</b><br>";a+=adend+"<br><b>"+currentad.endad+"</b><br>";$("adcolumntimecounter").innerHTML=a;$("adcolumnfarmibonus").innerHTML="+<b>"+currentad.bonus+"</b>&nbsp;"+farmistatsadlineperday;if($("cityzone_1_7")){$("cityzone_1_7").onmouseover=function(d){showDiv("showtimeadcolumn")};$("cityzone_1_7").onmouseout=function(d){hideDiv("showtimeadcolumn")}}adrun=1}function runCountDownAd(c,b){var a=countdownAd(adtime,"showtimeadcolumn");adtime=a-1;if(adtime<1){window.clearInterval(adrun);hideDiv("showtimeadcolumn");currentad=0;adtime=0}}function countdownAd(l,m){var h=l;if(h<=0){h=0}else{var a=Math.floor(h/3600);var c=Math.floor((h%3600)/60);var e=Math.floor((h%3600)%60);if(a.toString().length==1){a="0"+a.toString()}if(c.toString().length==1){c="0"+c.toString()}if(e.toString().length==1){e="0"+e.toString()}var d=a+":"+c+":"+e+" h";var b="";if(currentad.premium==1){if(premium==0){b='<div class="important">'+inforequirepremium+"</div>"}}$("adcolumntimecounter").innerHTML=d;$("adcolumnfarmibonus").innerHTML=currentad.bonus;$("adcolumnpremiuminfo").innerHTML=b}return h}function initFishPool(){if(city==2){cityAction("initfishpool")}}function initFishPoolResponse(b){var h="";var a=0;var l=b[1];if(l.length==0){h+=fishpool_nofishtobuy}else{var c="";c='<option value="0">-</option>';for(var d=1;d<120;d++){if(l[d]){if(d==1){var m=formatPrice(l[d]["p"]);a=l[d]["p"]}else{a=a+l[d]["p"]}if(d==1){var e=formuladealer_fish_singular}else{var e=formuladealer_fish_plural}c+='<option value="'+d+'">'+d+" "+e+"</option>";h+='<input type="hidden" id="fishcalcprice'+d+'" value="'+a+'">'}}h+=beemasteramount+'&nbsp;<select name="selectfish" id="selectfish" onchange="calcfishcost();">'+c+"</select>";h+="<br><br>"+beemastercost+'&nbsp;<span id="fishcost" style="font-weight:bold;">'+formatPrice(0)+"</span>";$("fishpoolbuybutton").innerHTML='<span onclick="buyFish();"><img src="'+imgpath+'stadt/2button_kauf.gif" border="0"></span>'}$("fishpoolbubble").innerHTML=fishpool_intro;$("fishpoolcontent").innerHTML=h;if(xmastime==1){$("fishpoolinner").style.background="url("+imgpath+"city/fishpool_innen_xmas.jpg)"}else{$("fishpoolinner").style.background="url("+imgpath+"city/fishpool_innen.jpg)"}showDiv("transp3");showDiv("fishpoolinner")}function calcfishcost(){var a=$("selectfish").value;if($("fishcalcprice"+a)){$("fishcost").innerHTML=formatPrice($("fishcalcprice"+a).value)}else{$("fishcost").innerHTML=formatPrice(0)}if($("selectfish").value>0){showDiv("fishpoolbuybutton")}else{hideDiv("fishpoolbuybutton")}}function buyFish(){var a=$("selectfish").value;if(a>0){cityAction("buyfish","11_"+a)}else{return false}}function buyFishResponse(){$("selectfish").value=0;$("fishcost").innerHTML=formatPrice(0);hideDiv("fishpoolbuybutton");$("fishpoolbubble").innerHTML=fishpool_boughttext;$("fishpoolcontent").innerHTML="";window.setTimeout("reloadFishPool()",2000)}function reloadFishPool(){initFishPool()}function initFormulaDealer(){if(city==2){cityAction("initformuladealer")}}function initFormulaDealerResponse(a){windmillinfo=a[1];if(a[2]){setFormulaDealerRack(a[2])}setFormulaDealerFormulas();$("formuladealerbubble").innerHTML=formuladealer_bubble;if(eastertime==1){$("formuladealer").style.background="url("+imgpath+"city/formuladealer_inner_easter.jpg) top left no-repeat"}else{if(xmastime==1){$("formuladealer").style.background="url("+imgpath+"city/formuladealer_inner_xmas.jpg) top left no-repeat"}else{$("formuladealer").style.background="url("+imgpath+"city/formuladealer_inner.jpg) top left no-repeat"}}showDiv("formuladealer");showDiv("formuladealerrandom")}function setFormulaDealerRack(c){var b="";for(var a=0;a<c.length;a++){b+='<div style="height:25px; width:25px; position:relative; margin-bottom:7px; float:left; margin-left:10px;" ';b+="onmouseover=\"$('formuladealerproductinfo').innerHTML=showFormulaInfos("+c[a]["fid"]+"); showDiv('formuladealerproductinfo');\" ";b+="onmouseout=\"$('formuladealerproductinfo').innerHTML=''; hideDiv('formuladealerproductinfo');\" ";b+=">";b+='<div class="fmm'+c[a]["fid"]+'"></div>';b+='<div style="position:absolute; bottom:-2px; right:-2px; font-weight:normal; color:#fff;">'+c[a]["amount"]+"</div>";b+="</div>";if((a+1)%2==0){b+='<div style="clear:both;"></div>'}}$("formuladealerrackinner").innerHTML=b}function setFormulaDealerFormulas(){for(var b=0;b<windmillinfo.length;b++){if(windmillinfo[b]){$("formuladealerproduct"+(b+1)).innerHTML="";var a=windmillinfo[b][0];var d="";if(windmillinfo[b][6]>0){d+='<div style="text-align:center; color:#fff; font-weight:normal;">'+windmillinfo[b][6]+"&nbsp;"+gamecurrency+"</div>"}if(windmillinfo[b][7]>0){d+='<div style="text-align:center; color:#fff; font-weight:normal;">'+windmillinfo[b][7]+"&nbsp;"+t_coins+"</div>"}var c="";c+='<div style="margin-top:20px;" class="fm'+a+'" ';c+="onmouseover=\"$('formuladealerproductinfo').innerHTML=showFormulaInfos("+a+"); showDiv('formuladealerproductinfo');\" ";c+="onmouseout=\"$('formuladealerproductinfo').innerHTML=''; hideDiv('formuladealerproductinfo');\" ";c+='onclick="buyFormulaCommit('+a+');"></div>';c+="<div>"+d+"</div>";$("formuladealerproduct"+(b+1)).innerHTML=c}}}function buyFormulaCommit(n){var l=formulas[0][n][6];if(formulas[0][n][7]>0){l=formulas[0][n][7]}var d="";for(var a=0;a<windmill_discount.length;a++){if(formulas[0][n][6]>0){var e=windmill_discount[a].amount;var m=0;var h=Math.ceil(l*windmill_discount[a].discount);var b=(windmill_discount[a].amount*l)+"&nbsp;"+gamecurrency;var c=(windmill_discount[a].amount*h)+"&nbsp;"+gamecurrency}if(formulas[0][n][7]>0){var e=windmill_discount_coins[a].amount;var m=(l*windmill_discount_coins[a].amount);var h=Math.ceil(m*windmill_discount_coins[a].discount);var b=m+"&nbsp;"+t_coins;var c=h+"&nbsp;"+t_coins}d+='<div class="formula_discount_line link" onclick="buyFormulaCommit2('+n+","+e+')">';d+='  <div style="float:left; width:50px;">'+guildwbwrankingamount+"</div>";d+='  <div style="float:left; width:150px;">'+t_formula_price+"</div>";d+='  <div class="clear"></div>';d+='  <div style="float:left; font-weight:bold; width:50px; font-size:18px;">'+e+"</div>";d+='  <div style="float:left; width:150px;">';if(h<l||(h<m&&m>0)){d+='  <div style="text-decoration: line-through; color:#6C441D; font-weight:bold;">'+b+"</div>"}d+='    <div style="color:#6C441D; font-weight:bold; font-size:18px;">'+c+"</div>";d+="  </div>";d+='  <div class="clear"></div>';d+="</div>"}var q="";globalcommitbox(formuladealer_buy_headline,d,q)}var buyFormula_block=0;function buyFormulaCommit2(e,d){var c="";for(var b=0;b<windmillinfo.length;b++){if(windmillinfo[b]&&windmillinfo[b][0]==e){c+="<div>"+d+"x&nbsp;"+windmillinfo[b][2]+"</div>"}}var a="buyFormula("+e+","+d+")";globalcommitbox(formuladealer_buy_headline,c,a)}function buyFormula(b,a){if(city==2){cityAction("buyformula",b,a)}}function randomFormulasCommit(){var b='<img src="'+imgpath+'menu/coins.gif" border="0" width="12" height="12">&nbsp;'+randomformulacoins+"&nbsp;"+t_coins+"</div>";var d="<div>"+b+"</div><br>"+formuladealer_random_content;if(gamblelock==1){}else{var a="randomFormulas();"}var c="hideDiv('globaltransp'); hideDiv('globalbox');showDiv('transp3');";globalcommitbox(formuladealer_random_headline,d,a,c)}function randomFormulas(){if(city==2){gamblelock=1;cityAction("randomformulas")}}function flipRandomFormulas(){var a='<img src="'+imgpath+'city/flip_formuladealer.gif" border="0">';$("formuladealerproduct1").innerHTML=a;$("formuladealerproduct2").innerHTML=a;$("formuladealerproduct3").innerHTML=a;window.setTimeout("setFormulaDealerFormulas()",2000)}function showFormuladealerAni(a){if(a==1){showDiv("formuladealerface");$("formuladealerface").src=imgpath+"city/formuladealer_ani_1.gif"}else{$("formuladealerface").src=imgpath+"city/formuladealer_ani_2.gif"}}function initCollector(){if(city==2){cityAction("initcollector")}}function initCollectorResponse(w,n,c){hideDiv("collector_feedback_back");hideDiv("collector_feedback");if(n&&c&&w[1][c]&&w[1][c][n]){var d=w[1][c][n].giftid;if(w[1][c][n].number2){d=w[1][c][n].giftid2}var b=d;if(presents_hack[d]){b=presents_hack[d]}$("collector_feedback_img").src=imgpath+"gifts/"+b+".gif";showDiv("collector_feedback");showDiv("collector_feedback_back")}var m="";for(var c in w[1]){if(!in_array(c,["plant","tree"])){continue}if(!w[1][c]){continue}for(var n in w[1][c]){if(!w[1][c][n]){continue}var l=w[1][c][n];var v="";var u="sendCollectorItemsCommit("+n+","+l.amount+",'"+c+"')";var a=produkt_name[n];var q="kp";var t=0;var r=checkRackItem(n);if(!r){t=l.amount}if(r>0){t=(l.amount-r)}if(c=="tree"){a=produkt_name_forestry[n];q="f_m_symbol";if(l.stock&&l.stock<l.amount){t=(l.amount-l.stock)}else{t=0}if(!l.stock){t=l.amount}}var s="";if(t>0){s="important";u=""}var e=0;if(r>0){e=r}if(c=="tree"){e=l.stock}var h='<div style="margin-top:4px;" class="'+s+'">'+t_in_stock+"&nbsp;"+e+"</div>";var d=l.giftid;if(l.diamant){d=l.giftid2}m+='<div class="link collector_bar" onclick="'+u+'">';m+='  <div style="float:left; margin:15px 5px 0 15px;" class="'+q+n+'"></div>';m+='  <div style="float:left; margin-top:15px; width:170px;">'+l.amount+"x&nbsp;"+a+"<br>"+v+h+"</div>";var b=d;if(presents_hack[d]){b=presents_hack[d]}m+='  <div style="float:right; margin-top:5px; margin-right:2px;"><img height="50" src="'+imgpath+"gifts/"+b+'.gif"></div>';m+='  <div class="clear"></div>';m+="</div>"}}$("collectorscontent").innerHTML=m;if(w[1].pepeevent&&!$("pepeevent_pepe_link")){var m="";m+='<div id="pepeevent_pepe_link" class="link" onclick="pepeevent.init()">';m+='  <div class="line">';m+='    <div class="icon pepeevent pid'+pepeevent.data.config.pid+'"></div>';m+="    <div>"+t_pepeevent_name+"</div>";m+="  </div>";m+="</div>";$("collectorscontainer").insert(m)}if(xmastime==1){$("collectorscontainer").style.background="url("+imgpath+"city/collector_inner3_xmas.jpg)"}else{$("collectorscontainer").style.background="url("+imgpath+"city/collector_inner3.jpg)"}showDiv("collectorscontainer")}function sendCollectorItemsCommit(b,e,l){var d=produkt_name[b];var a="kp";if(l=="tree"){d=produkt_name_forestry[b];a="f_m_symbol"}var c="sendCollectorItems("+b+",'"+l+"');";var h='<div style="float:left;" class="'+a+b+'"></div>';h+='<div style="float:left;">&nbsp;'+e+"&nbsp;"+d+"</div>";h+='<div style="clear:both;"></div><br>';h+=collector_commitcontent;globalcommitbox(collector_commithead,h,c)}var collector_block=0;function sendCollectorItems(a,b){if(city==2&&!collector_block){collector_block=1;cityAction("sendcollectorsitem",a,b)}}function setCityWBWContent(a){if(a==1){hideDiv("wbwcontent2");showDiv("wbwcontent1");$("wbwnavi1").style.background="url("+imgpath+"city/wbw_navi1.jpg)";$("wbwnavi2").style.background="url("+imgpath+"leer.gif)";$("globalwbwranking").innerHTML="";guildWBWRanking(1)}else{if(a==2){hideDiv("wbwcontent1");showDiv("wbwcontent2");$("wbwnavi1").style.background="url("+imgpath+"leer.gif)";$("wbwnavi2").style.background="url("+imgpath+"city/wbw_navi2.jpg)";$("wbwcontent2ranking").innerHTML="";generalAction("initwbw")}}}function setCityWBWContentResponse(q){if(q[1]==0){hideDiv("localwbwdata");$("wbwcontent2ranking").innerHTML="<br><br><b>"+guildwbwnocurrentwbw+"</b>"}else{showDiv("localwbwdata");var n=q[1]["wettbewerb_produkt"];var e=0;var d="";d+='<div style="width:500px; margin-top:10px;">';d+='<div class="guildwbwrankingline_headrank">'+guildwbwrankingrank+"</div>";d+='<div class="guildwbwrankingline_headname">'+guildquestrankingname+"</div>";d+='<div class="guildwbwrankingline_headamount">'+guildwbwrankingamount+"</div>";d+='<div style="clear:both;"></div>';d+="</div>";if(q[1]==0){d+='<div style="margin-left:10px; text-align:center; padding-top:25px; font-weight:normal; width:500px;">'+guildwbwnocurrentwbw+"</div>"}else{var h=0;var b=1;for(var c=0;c<q[2].length;c++){if(h==0){h=q[2][c]["menge"];var m=b+"."}else{if(h==q[2][c]["menge"]){var m="&nbsp;"}else{b++;var m=b+".";h=q[2][c]["menge"]}}if(q[2][c]["self"]==1){e=1;add="color:#f00; font-weight:bold;"}else{add=""}if(c%2==0){var l="transparent"}else{var l="transparent"}d+='<div style="width:500px; padding-top:2px; padding-bottom:2px; background-color:'+l+'" id="guildwbwrankingline'+c+'" ';d+="onmouseover=\"this.style.backgroundColor='#D8B57D'\" onmouseout=\"this.style.backgroundColor='transparent'\"";d+=">";if(q[2][c]["self"]==1){d+='<a name="ownentry"></a>'}d+='<div class="guildwbwrankingline_rank" style="'+add+'">'+m+"</div>";d+='<div class="guildwbwrankingline_name" style="'+add+' overflow:hidden;">';d+='<div class="guildwbwrankingline_name_name">'+q[2][c]["uname"]+"&nbsp;";if(q[2][c]["tag"]){d+="["+q[2][c]["tag"]+"]"}d+="</div>";d+='<div class="guildwbwrankingline_name_awards">'+showAwards(c,q[2][c]["unr"],q[2][c]["gold"],q[2][c]["silber"],q[2][c]["bronze"])+"</div>";d+='<div style="clear:both;"></div>';d+="</div>";d+='<div class="guildwbwrankingline_sum" style="'+add+'">'+q[2][c]["menge"]+"</div>";d+='<div style="clear:both;"></div>';d+="</div>"}}$("wbwcontent2ranking").innerHTML=d;if(q[1]["open"]==1){$("localwbwproduct").innerHTML='<div class="kp'+n+'" style="position:absolute; width:15px; height:15px;"></div>';$("localwbwproductname").innerHTML=produkt_name[n]}else{$("localwbwproduct").innerHTML="";$("localwbwproductname").innerHTML=""}if(q[1]==0){$("localwbwstart").innerHTML="---";$("localwbwend").innerHTML="---"}else{$("localwbwstart").innerHTML=q[1]["wettbewerb_beginn"];$("localwbwend").innerHTML=q[1]["wettbewerb_ende"]}if(q[1]["open"]==1){var a="";a+="<div>";a+='<div style="float:left;">'+t_stadt_wettbewerb_produkt_anzahl+"</div>";a+='<div style="float:left; margin-left:5px;"><input type="text" onkeyup="correctWBWentry('+n+');" onchange="correctWBWentry('+n+');" id="wbwproductsamount" maxlength="7" size="10"></div>';a+='<div style="float:left; margin-left:5px;"><input type="submit" value="'+t_stadt_wettbewerb_einschicken+'" onclick="sendWBWProductsCommit('+n+')"></div>';if(e==1){a+='<div style="float:left; margin-left:5px;"><button type="button" onclick="location.hash=\'#ownentry\'">'+t_stadt_wettbewerb_wobinich+"</button></div>"}a+='<div style="clear:both;"></div>';a+="</div>";$("localwbwform").innerHTML=a}}}function correctWBWentry(b){var a=$("wbwproductsamount").value;if(!isNumeric(a)){a=1}var c=checkRackItem(b);if(parseInt(a)>parseInt(c)){a=c}$("wbwproductsamount").value=a}function sendWBWProductsCommit(e){var b=$("wbwproductsamount").value;if(b!=""){var d=t_stadt_wettbewerb_confirm_text;d=str_replace("[*menge*]",b,d);d=str_replace("[*produkt*]",produkt_name[e],d);var a="sendWBWproducts();";var c="<div>"+d+"</div>";globalcommitbox(t_stadt_gartenverein_title,c,a)}else{return false}}function sendWBWproducts(){var a=$("wbwproductsamount").value;if(a){if(!isNumeric(a)){a=1}a=parseInt(a);var b={amount:a};generalAction("sendwbwproduct",b)}else{return false}}function initLottery(){cityAction("initlottery")}function initLotteryResponse(a){lotrack=a[1];lotteryprizes=a[4];updateLotRack();updateLotteryPrizes();if(a[2]==0){showDiv("dailylotleft")}else{hideDiv("dailylotleft")}setLotteryDefaultBubble();showDiv("lotterycontainer")}function updateLotteryPrizes(z){var n="";var u=0;for(_obj in lotteryprizes){u++}if(!z||z<=11||z>u){var b=1;var h=11;z=11}else{var h=z;var b=((h-11)+1)}var q=(parseInt(z)+parseInt(1));var d=(parseInt(z)-parseInt(11));var v=0;var c=0;var t=1;for(var m=0;m<=100;m++){if(lotteryprizes[m]){if(t>=b&&t<=h){n+='<div id="lotteryprize'+m+"\" style=\"position:relative;\" onmouseover=\"$('prizeslot').style.border='solid red 2px';\" onmouseout=\"$('prizeslot').style.border='';\">";var w="";if(lotteryprizes[m][0][0]==1){w="farmhouse/thumbs/"+lotteryprizes[m][0][1]+".jpg";useimgbig="farmhouse/previews/"+lotteryprizes[m][0][1]+"_1.jpg"}n+="<div onmouseover=\"showDiv('prizeinfo"+m+"')\" onmouseout=\"hideDiv('prizeinfo"+m+"')\" ";n+='style="position:absolute; top:'+v+"px; left:"+c+"px; width:40px; height:40px; background:url("+imgpath+w+') top left no-repeat;">';n+='<div id="lotteryprize_forbidden'+m+'" style="position:absolute; top:0px; left:0px; display:none; background:url('+imgpath+'cursors/cursor_forbidden.gif) top left no-repeat; width:40px; height:40px;"></div>';n+="</div>";if(t>10){var a=(parseInt(c)-parseInt(155))}else{a=c}n+='<div style="display:none; width:188px; height:188px; position:absolute; top:'+(v+50)+"px; left:"+a+"px; background:url("+imgpath+useimgbig+') top left no-repeat;" id="prizeinfo'+m+'">';n+='<div style="position:absolute; bottom:5px; left:5px;">';for(o=0;o<lotteryprizes[m][1].length;o++){n+='<div style="position:relative; float:left; margin-right:5px;"><img src="'+imgpath+"city/"+lotteryprizes[m][1][o][0]+'.jpg" border="0" width="40">';n+='<div style="position:absolute; top:5px; right:5px; color:#000; font-weight:bold;">'+lotteryprizes[m][1][o][1]+"</div>";n+="</div>"}n+='<div style="clear:both;"></div>';n+="</div>";n+="</div>";c=c+50;n+="</div>"}t++}}n+='<div class="link" style="position:absolute; top:3px; right:46px; width:47px; height:36px; background:url('+imgpath+'farmhouse/right.png)" onclick="updateLotteryPrizes('+q+')"></div>';$("lotteryprizes").innerHTML=n;var s=1;for(var m=1;m<=100;m++){if(lotteryprizes[m]){if(s>=b&&s<=h){var e=0;for(o=0;o<lotteryprizes[m][1].length;o++){var r=lotteryprizes[m][1][o][0];var l=lotteryprizes[m][1][o][1];if(lotrack[r]){if(lotrack[r]<l){e=1}}else{e=1}}if(e==0){if(usetouch==1){$("lotteryprize"+m).onclick=new Function("setLotteryPrizeSlot(0,"+m+")")}else{new Draggable("lotteryprize"+m,{revert:true})}}else{showDiv("lotteryprize_forbidden"+m)}}s++}}if(!usetouch){Droppables.add("prizeslot",{onDrop:function(A){setLotteryPrizeSlot(A)},hoverclass:"hover"})}}function setLotteryPrizeSlot(b,d){if(b.id){var a=str_replace("lotteryprize","",b.id)}else{if(d>0){var a=d}}if(lotteryprizes[a]){$("prizeslotinner").innerHTML='<img src="'+imgpath+"farmhouse/thumbs/"+lotteryprizes[a][0][1]+'.jpg" border="0">';var c="";for(o=0;o<lotteryprizes[a][1].length;o++){c+='<div style="position:relative; float:left; width:40px; height:40px; background:url('+imgpath+"city/"+lotteryprizes[a][1][o][0]+'.jpg) top left no-repeat;">';c+='<div style="position:absolute; top:5px; right:5px; font-weight:bold; color:#000;">'+lotteryprizes[a][1][o][1]+"</div>";c+="</div>";if(o<(lotteryprizes[a][1].length-1)){c+='<div style="float:left; position:relative; margin-top:12px;">&nbsp+&nbsp;</div>'}}hideDiv("lotterybubbleinfo");showDiv("lotterybubbleprize");showDiv("prizeslotcommit");showDiv("prizeslotcancel");$("prizeslotcommit").onclick=function(){cashLotteryPrizeCommit(a)};$("prizeslotlots").innerHTML='<div style="float:left; position:relative; margin-top:12px;">&nbsp=&nbsp;</div>'+c+'<div style="clear:both;"></div>'}}function cleanLotteryPrizeSlot(){hideDiv("prizeslotcommit");hideDiv("prizeslotcancel");$("prizeslotcommit").onclick=function(){};$("prizeslotinner").innerHTML="";$("prizeslotlots").innerHTML="";hideDiv("lotterybubbleprize");showDiv("lotterybubbleinfo")}function cashLotteryPrizeCommit(c){var a="cashLotteryPrize("+c+");";var b="<div>"+lotterycommitbody+"</div>";globalcommitbox(lotterycommithead,b,a)}function cashLotteryPrize(a){cityAction("cashlotteryprize",a)}function cashLotteryPrizeResponse(a){cleanLotteryPrizeSlot();lotrack=a[1];lotteryprizes=a[4];updateLotRack();updateLotteryPrizes()}function updateLotRack(){var c="";var e=0;var d=0;var b=0;for(var a=0;a<100;a++){if(lotrack[a]){c+='<div style="position:absolute; bottom:'+e+"px; left:"+d+"px; width:60px; height:102px; background:url("+imgpath+"city/lot_"+a+'.png) top left no-repeat;">';c+='<div style="position:absolute; right:8px; bottom:5px; font-size:14px; font-weight:bold; color:#fff; padding:2px; background-color:#DE9008;">'+lotrack[a]+"</div>";c+="</div>";b++;d+=65}}$("lotsrack").innerHTML=c}function dailyLot(){cityAction("newlot")}function dailyLotResponse(a){lotrack=a[1];showLotDecision(a[3]);if(a[3]>0){$("showCurrentLot").style.backgroundImage="url("+imgpath+"city/"+a[3]+".jpg)"}}function showLotDecision(a){showDiv("lotterytransp");$("currentlot").style.backgroundImage="url("+imgpath+"city/lotback_"+a+".jpg)";showDiv("currentlot")}function hideLotDecision(){$("currentlotinner").innerHTML="";hideDiv("currentlot");hideDiv("lotterytransp")}function lotGetPrize(){cityAction("lotgetprize")}function lotGetPrizeResponse(b){hideLotDecision();lotrack=b[1];updateLotRack();if(b[5]){var e="";for(var c in b[5]){if(produkt_name[c]){e+='<div class="kp'+c+' lotteryprize_img"></div>';e+='<div class="lotteryprize_info">&nbsp;'+b[5][c]+"x&nbsp;"+produkt_name[c]+"</div>";e+='<div style="clear:both;"></div>'}}var a="<div>"+lotterygetlotprize+"</div><br>"+e;var d="hideDiv('lotterytransp'); hideDiv('productboxlottery'); hideDiv('commitboxgarden'); hideDiv('dailylotleft'); hideDiv('globalbox'); hideDiv('globaltransp');";if(b[6]&&b[6].msg){d+="globalerrorbox('"+b[6].msg+"')"}globalerrorbox(a,d)}}function buyNewLotCommit(){var a="buyNewLot();";var b='<div><img src="'+imgpath+'menu/coins.gif" height="12" width="12" border="0">&nbsp;'+lotterynewlotcoins+"&nbsp;"+t_coins+"</div>";b+="<br><div>"+lotterynewlotcommitbody+"</div>";globalcommitbox(lotterynewlotcommithead,b,a)}function buyNewLot(){cityAction("buynewlot")}function buyNewLotResponse(a){lotrack=a[1];updateLotRack();setLotteryGetLotBubble();if(a[3]>0){$("showCurrentLot").style.backgroundImage="url("+imgpath+"city/"+a[3]+".jpg)"}}function setLotteryGetLotBubble(){hideDiv("lotterybubbleinfo");showDiv("lotterybuybubble");window.setTimeout("setLotteryDefaultBubble()",5000)}function setLotteryDefaultBubble(){showDiv("lotterybubbleinfo");hideDiv("lotterybubbleprize");hideDiv("lotterybuybubble")}var windmill_stock={};var windmill_slots={};var windmill_slotremain=0;var windmill_ready=0;var windmill_first=0;var windmill_page=1;function initWindmill(){hideDiv("windmillformulainfo");hideDiv("windmilltransp");hideDiv("windmill_paper");hideDiv("globalbox");hideDiv("globaltransp");cityAction("windmillinit")}function windmillStock(){var h=1;var e=8;if(windmill_page>1){h=(((windmill_page-1)*8)+1);e=(windmill_page*8)}var c="";var d=1;if(windmill_stock){for(var b in windmill_stock){if(d>=h&&d<=e){c+='<div class="windmill_stock_item" onmouseover="showFormulaInfosWindmill('+b+');" onmouseout="hideDiv(\'windmillformulainfo\');">';c+='  <div class="fm'+b+'"></div>';c+='  <div id="windmill_stock_amount_'+b+'" class="windmill_stock_amount">'+windmill_stock[b].amount+"</div>";c+="</div>";if(d%4==0){c+='<div class="clear windmill_stock_newline"></div>'}}d++}}var a=Math.ceil(d/8);if(windmill_page>1){c+='<div class="link windmill_stock_navi_left" onclick="windmillNavi(-1)"></div>'}if(a>1&&windmill_page<a){c+='<div class="link windmill_stock_navi_right" onclick="windmillNavi(1)"></div>'}c+='<div class="clear"></div>';$("windmillformula").innerHTML=c}function windmillNavi(a){windmill_page=(windmill_page+a);windmillStock()}function windmillSlots(){for(var c=1;c<=2;c++){var b="";b+='<div id="windmill_slot'+c+'_img" class="windmill_slot_img"></div>';b+='<div id="windmill_slot'+c+'_remain" class="windmill_slot_remain"></div>';b+='<div id="windmill_slot'+c+'_cancel" class="windmill_slot_cancel mini_close" onclick="windmillDialog(\'windmillcancel\', '+c+')"></div>';b+='<div id="windmill_slot'+c+'_block" class="link windmill_slot_block"></div>';if(c==2){b+='<div id="windmill_slot_renttime_block" onmouseover="showDiv(\'windmill_slot_renttime_tt\')" onmouseout="hideDiv(\'windmill_slot_renttime_tt\')">';b+='  <div id="windmill_slot_renttime"></div>';b+='  <div id="windmill_slot_renttime_tt" class="blackbox">'+str_replace(":","",forestry_slot_time)+"</div>";b+="</div>"}$("windmill_slot"+c).innerHTML=b;$("windmill_slot"+c).onclick=new Function("");$("windmill_slot"+c).onmouseover=new Function("");$("windmill_slot"+c).onmouseout=new Function("");hideDiv("windmill_slot"+c+"_cancel");if(windmill_slots[c]){$("windmill_slot"+c+"_img").addClassName("fm"+windmill_slots[c].formula);$("windmill_slot"+c).onmouseover=new Function("showFormulaInfosWindmill("+windmill_slots[c].formula+")");$("windmill_slot"+c).onmouseout=new Function("hideDiv('windmillformulainfo')");if(windmill_slots[c].remain){if(windmill_slots[c].remain>0){showDiv("windmill_slot"+c+"_cancel");$("windmill_slot"+c+"_remain").innerHTML=formatTime(windmill_slots[c].remain);setTimer("windmilltimer")}else{hideDiv("windmill_slot"+c+"_cancel");$("windmill_slot"+c+"_remain").innerHTML=statusProductionComplete;$("windmill_slot"+c).onclick=new Function("cityAction('windmillcrop', "+c+")")}}}else{$("windmill_slot"+c).onclick=new Function("windmillDialog('windmillstartproduction', "+c+")")}if(c==2){if(windmill_slotremain<=0){hideDiv("windmill_slot_renttime_block");showDiv("windmill_slot"+c+"_block");$("windmill_slot"+c).onclick=new Function("");$("windmill_slot"+c+"_block").onclick=new Function("windmillDialog('windmillbuyslot', "+c+")");if(specialbonus){var a=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(a&&in_array("windmill",a.types)){var b="";b+='<div id="windmill_productionslot'+c+'_bonus_star" class="windmill production_slot bonus_star pulse">';b+='  <div class="inner">';b+='    <div class="percent">'+(a.discount*100)+"%</div>";b+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";b+="  </div>";b+="</div>";$("windmill_slot"+c+"_block").insert(b)}}}else{showDiv("windmill_slot_renttime_block");hideDiv("windmill_slot"+c+"_block");setTimer("windmilltimer")}}}}function windmillDialog(h,s,a){var r="";var l="";var t="";hideDiv("windmillformulainfo");if(h=="windmillcancel"){r=windmillcancelheadline;l=windmillcancelcontent;t="cityAction('windmillcancel', "+s+")"}if(h=="windmillstartproduction"){if(!s){r+='<div class="headline">'+t_windmill_formula_select_head2+"</div>";l+='<div style="margin-bottom:70px;">&nbsp;</div>'}else{r+='<div class="headline">'+t_windmill_formula_select_head+"</div>";l+='<div style="margin-bottom:50px;">'+t_windmill_formula_select_body+"</div>"}for(var d in windmill_stock){var c=1;if(formulas[0][d]&&formulas[0][d][3].length){var q=formulas[0][d][3];for(var b=0;b<q.length;b++){var n=checkRackItem(q[b][0]);if(n<q[b][1]){c=0}}if(c==1&&s>0){t="windmillDialog('windmillstartproductioncommit', "+s+", "+d+")"}else{t=""}l+='<div class="link windmill_formula_select_item" onclick="'+t+'" onmouseover="showFormulaInfosWindmill('+d+');" onmouseout="hideDiv(\'windmillformulainfo\');">';l+='  <div class="fm'+d+'"></div>';l+='  <div class="windmill_stock_amount">'+windmill_stock[d].amount+"</div>";l+="</div>"}}$("windmill_formula_select_inner").innerHTML=r+l;showDiv("windmilltransp");showDiv("windmill_formula_select");return false}if(h=="windmillstartproductioncommit"){showDiv("windmill_paper");var e="";if(windmill_stock[a]){e+='<div class="headline">'+formulas[0][a][2]+"</div>";e+='<div class="fm'+a+'" style="position:relative; left:155px;"></div>';$("windmill_paper_headline").innerHTML=e;if(formulas[0][a]&&formulas[0][a][3].length){var q=formulas[0][a][3];var m=1;for(var b=0;b<q.length;b++){var e="";e+='<div class="l'+q[b][0]+'">';e+='  <div class="windmill_paper_pos_amount">'+q[b][1]+"</div>";e+="</div>";$("windmill_paper_pos"+m).innerHTML=e;m++}}}$("windmill_paper_commit").onclick=new Function("cityAction('windmillstartproduction', "+a+", "+s+")");return false}if(h=="windmillbuyslot"){r=t_windmill_coinsslot_head;t_windmill_coinsslot_body=str_replace("%TIME%",formatTime(windmill_coinsslot.duration),t_windmill_coinsslot_body);t_windmill_coinsslot_body=str_replace("%COINS%",windmill_coinsslot.coins,t_windmill_coinsslot_body);l+=t_windmill_coinsslot_body;t="cityAction('windmillbuyslot')"}globalcommitbox(r,l,t)}function windmillTimer(){for(var a=1;a<=2;a++){if(windmill_slots[a]){windmill_slots[a].remain--;if(windmill_slots[a].remain<=0){$("windmill_slot"+a+"_remain").innerHTML=statusProductionComplete}else{$("windmill_slot"+a+"_remain").innerHTML=formatTime(windmill_slots[a].remain)}}}windmill_slotremain--;if(windmill_slotremain>0){$("windmill_slot_renttime").innerHTML=formatTime(windmill_slotremain)}else{if(windmill_slotremain==0){windmillSlots()}}}function closeWindmillFormulaSelect(){hideDiv("windmilltransp");hideDiv("windmill_formula_select")}function closeWindmill(){closeWindmillFormulaSelect();hideDiv("transp3");hideDiv("windmillinner")}function checkWindmillStatus(){if(city==2){hideDiv("windmill_readyani");hideDiv("windmillani");if(windmill_ready){if(windmill_ready.ready>0){showDiv("windmill_readyani")}if(windmill_ready.running>0){$("cityzone_2_1").onmouseover=new Function("showDiv('cityzone_tt_2_1'); hideDiv('windmillani')");$("cityzone_2_1").onmouseout=new Function("hideDiv('cityzone_tt_2_1'); showDiv('windmillani')");showDiv("windmillani")}else{$("cityzone_2_1").onmouseover=new Function("showDiv('cityzone_tt_2_1');");$("cityzone_2_1").onmouseout=new Function("hideDiv('cityzone_tt_2_1');")}}}}function showFormulaInfosWindmill(a){$("windmillformulainfo").innerHTML=showFormulaInfos(a);showDiv("windmillformulainfo")}function showFormulaInfos(l){if(formulas[0][l]){var d=formulas[0][l];var h="";h+='<div style="font-weight:bold;">'+d[2]+"</div>";if(d[5]){if(d[5][0]){var a="kp"+d[5][0][0];var n=str_replace("%PRODUCT%",produkt_name[d[5][0][0]],powerup_bonustext1);n=str_replace("%AMOUNT%",d[5][0][1],n)}if(d[5][1]){if(d[11]==1){var b=forestry_product[d[5][1][0]];var a="f_m_symbol"+d[5][1][0]}else{var b=produkt_name[d[5][1][0]];var a="kp"+d[5][1][0]}var n=str_replace("%PRODUCT%",b,powerup_bonustext2);n=str_replace("%TIME%",formatTime(d[5][1][2]),n);n=str_replace("%CROP%","+"+d[5][1][1],n)}if(d[5][2]){var a="kp"+d[5][2][0];var n=str_replace("%PRODUCT%",produkt_name[d[5][2][0]],powerup_bonustext3);n=str_replace("%TIME%",formatTime(d[5][2][2]),n);n=str_replace("%POINTS%","+"+d[5][2][1],n)}}h+="<div>"+windmill_bakeingtime+" "+formatTime(d[4])+"</div>";h+='<div style="margin-top:10px; margin-bottom:10px;"><div class="'+a+' recipedealer_infoimg"></div>';h+='<div class="recipedealer_infotxt">'+n+'</div><div style="clear:both;"></div></div>';h+="<div>"+windmill_zutaten+"</div>";for(var e=0;e<d[3].length;e++){if(d[3][e]){var q="";var c=d[3][e][1];var m=checkRackItem(d[3][e][0]);if(m){if(m<d[3][e][1]){q="important";c=m+"/"+d[3][e][1]}}else{q="important";c="0/"+d[3][e][1]}h+='<div style="margin-top:2px;">';h+='<div class="kp'+d[3][e][0]+' recipedealer_plistimg"></div>';h+='<div class="'+q+' recipedealer_plisttxt">'+c+"&nbsp;"+produkt_name[d[3][e][0]]+"</div>";h+='<div style="clear:both;"></div>';h+="</div>"}}if(d[10]>0){if(d.endremain<=0){h+="<br><b>"+formularterminationinfo+"</b>"}else{h+="<div><br>"+str_replace("%TIME%",'<span style="font-weight:bold;" id="formulaterminationtime'+e+'">'+d.end+"</span>",formulartermination)+"</div>"}}return h}}function showWindmillFormulaDropzone(){$("windmillformuladrop").style.border="2px solid #f00"}function hideWindmillFormulaDropzone(){$("windmillformuladrop").style.border="transparent"}function initNewsboy(){if(city==1){cityAction("initnewsboy")}}function initNewsboyResponse(a){var c=a[1];var d="";for(var b=0;b<c.length;b++){d+='<div class="newsboysubject">'+c[b]["subject"]+"</div>";d+='<div class="newsboybody">'+c[b]["body"]+"</div>"}$("newsboyinner").innerHTML=d;showDiv("newsboy")}function closeNewsboy(){hideDiv("transp3");hideDiv("newsboy")}var clothingdonation_data=new Object;function showClothingDonation(){var d=clothingdonation_data.data;if(clothingdonation_data.data.gambleremain){gametimer.clothingdonation_gambletimer=1}if(d.points<0){d.points=0}$("clothingdonation_levelpoints").innerHTML=d.points+"&nbsp;"+t_points;var c=0;var e="";if(setarab){var b="right"}else{var b="left"}for(var h in d.data["in"]){var l="";var m=checkRackItem(h);if(m<d.data["in"][h].amount){l="important";c=1}e+='<div style="margin-bottom:5px;">';e+='  <div class="l'+h+'" style="float:'+b+'; border-radius:5px"></div>';e+='  <div style="float:'+b+'; margin-top:13px;" class="'+l+'">&nbsp;'+d.data["in"][h].amount+"x&nbsp;"+produkt_name[h]+"</div>";e+='  <div class="clear"></div>';e+="</div>"}$("clothingdonation_inner_left_inner").innerHTML=e;var e="";for(var h in d.data.out){e+='<div style="margin-bottom:5px;">';e+='  <div class="l'+h+'" style="float:'+b+'; border-radius:5px"></div>';e+='  <div style="float:'+b+'; margin-top:13px;">&nbsp;'+d.data.out[h].amount+"x&nbsp;"+produkt_name[h]+"</div>";e+='  <div class="clear"></div>';e+="</div>"}$("clothingdonation_inner_right_inner").innerHTML=e;$("clothingdonation_wish1_product").className="";$("clothingdonation_wish2_product").className="";if(d.data.slots){for(var n in d.data.slots){if(d.data.slots[n].pid){$("clothingdonation_wish"+n+"_product").addClassName("l"+d.data.slots[n].pid)}}}$("clothingdonation_level").innerHTML=clothingdonation_data.data.level;$("clothingdonation_levelname").innerHTML=clothingdonation_data.data.levelname;if(setarab){$("clothingdonation_levelinner").style.right=-((200/100)*(100-clothingdonation_data.data.percent))+"px"}else{$("clothingdonation_levelinner").style.left=-((200/100)*(100-clothingdonation_data.data.percent))+"px"}if(c){$("clothingdonation_donatebutton").onclick=new Function()}else{$("clothingdonation_donatebutton").onclick=new Function("clothingDonationDialog('commit')")}showDiv("clothingdonation_transp");showDiv("clothingdonation");var a=$("clothingdonation").getWidth();$("clothingdonation").style.marginLeft=-((a+40)/2)+"px"}var gamblebox=0;function clothingDonationDialog(l,s){if(setarab){var a="right";var t="left"}else{var a="left";var t="right"}if(l=="gamble"){gamblebox=1;var q=t_clothingdonation_gambleheadline;var h=t_clothingdonation_gamblebody;if(clothingdonation_data.data.gambleremain>0){h+='<div style="margin-left:100px; margin-top:10px;">';h+='  <img border="0" src="'+imgpath+'menu/coins.gif" style="float:'+a+';">';h+='  <div style="float:'+a+'; margin-top:1px;">&nbsp;'+clothingdonation_data.data.gamblecoins+"&nbsp;"+t_coins+"</div>";h+='  <div class="clear"></div>';h+="</div>";h+='<div class="bonusinfo">'+str_replace("%TIME%","<span id=clothingdonation_gambletimer></span>",t_clothingdonation_gamblebody_add)+"</div>"}else{h+='<div style="margin-top:10px;">'+forfree+"</div>"}var u="cityAction('gambleclothingdonation'); gamblebox=0;";var r="hideDiv('globaltransp'); hideDiv('globalbox'); gamblebox=0;"}if(l=="commit"){var q=t_clothingdonation_commitheadline;var h=t_clothingdonation_commitbody;var u="cityAction('donateclothingdonation')";var r=0}if(l=="wish"){var b=0;var q=t_clothingdonation_wishslotheadline;var h="<div>"+t_clothingdonation_wishslotbody+"</div>";if(clothingdonation_data.data.data.slots[s].need.coins){h+='<div style="margin-left:75px; margin-top:10px; margin-bottom:10px;">';h+='  <div style="float:'+a+"; margin-"+t+':5px;">'+cityadcost+"</div>";h+='  <img border="0" src="'+imgpath+'menu/coins.gif" style="float:'+a+';">';h+='  <div style="float:'+a+'; margin-top:1px;">&nbsp;'+clothingdonation_data.data.data.slots[s].need.coins+"&nbsp;"+t_coins+"</div>";h+='  <div class="clear"></div>';h+="</div>"}if(clothingdonation_data.data.data.slots[s].need.pid){var e=clothingdonation_data.data.data.slots[s].need.pid;var d=clothingdonation_data.data.data.slots[s].need.amount;var m="";var n=checkRackItem(e);if(n<d){m="important";b=1}h+='<div style="margin-left:50px; margin-top:10px; margin-bottom:10px;">';h+='  <div style="float:'+a+"; margin-"+t+':5px;">'+cityadcost+"</div>";h+='  <div style="float:'+a+"; margin-"+t+':5px;" class="kp'+e+'"></div>';h+='  <div style="float:'+a+';" class="'+m+'">'+d+"x&nbsp;"+produkt_name[e]+"</div>";h+='  <div class="clear"></div>';h+="</div>"}h+='<select id="clothingdonation_slotselect">';for(var c=0;c<clothingdonation_data.products.length;c++){var e=clothingdonation_data.products[c];if(produkt_name[e]){if(clothingdonation_data.data.data.slots[1]&&clothingdonation_data.data.data.slots[1].pid==e||clothingdonation_data.data.data.slots[2]&&clothingdonation_data.data.data.slots[2].pid==e){}else{h+="<option value='"+e+"'>"+produkt_name[e]+"</option>"}}}h+="</select>";h+="<input type='hidden' id='clothingdonation_slothidden' value='"+s+"'>";if(!b){if(s==1){var u="cityAction('setslotclothingdonation')"}else{var u="clothingDonationDialog('wishcommit',"+s+")"}}else{u=0}var r=0}if(l=="wishcommit"){var e=$("clothingdonation_slotselect").value;var q=t_clothingdonation_wishslot_coins;var h="<div>"+str_replace("%PRODUCT%","<b>"+produkt_name[e]+"</b>",t_clothingdonation_wishslot_coins2)+"</div>";if(clothingdonation_data.data.data.slots[s].need.coins){h+='<div style="margin-left:75px; margin-top:10px; margin-bottom:10px;">';h+='  <div style="float:'+a+"; margin-"+t+':5px;">'+cityadcost+"</div>";h+='  <img border="0" src="'+imgpath+'menu/coins.gif" style="float:'+a+';">';h+='  <div style="float:'+a+'; margin-top:1px;">&nbsp;'+clothingdonation_data.data.data.slots[s].need.coins+"&nbsp;"+t_coins+"</div>";h+='  <div class="clear"></div>';h+="</div>"}h+="<input type='hidden' id='clothingdonation_slotselect' value='"+e+"'>";h+="<input type='hidden' id='clothingdonation_slothidden' value='"+s+"'>";if(!b){var u="cityAction('setslotclothingdonation')"}else{u=0}var r=0}globalcommitbox(q,h,u,r)}function gambleTimerClothingDonation(){if(clothingdonation_data.data.gambleremain&&$("clothingdonation_gambletimer")){clothingdonation_data.data.gambleremain--;$("clothingdonation_gambletimer").innerHTML=formatTime(clothingdonation_data.data.gambleremain)}if(!clothingdonation_data.data.gambleremain||clothingdonation_data.data.gambleremain<0){if(gamblebox==1){clothingDonationDialog("gamble")}clearTimer("clothingdonation_gambletimer")}}function closeClothingDonation(){hideDiv("clothingdonation_transp");hideDiv("clothingdonation")}var stats_page=1;var stats_type=1;function statsOpen(){showDiv("city_stats_transp");showDiv("city_stats");hideDiv("unknown_player");hideDiv("unknown_guild");hideDiv("stats_search_info");hideDiv("stats_search_info_inner_player");hideDiv("stats_search_info_inner_guild");statsAction(0,0,0)}function statsClose(){hideDiv("city_stats_transp");hideDiv("city_stats");hideDiv("transp3")}function statsAction(e,c,d){var h="stats";if(e){stats_page=1}if(e==0&&$("stats_type_select").value){e=$("stats_type_select").value}if(e){stats_type=e}if(!c){c=0}if(e=="statssearch"){var b=$("stats_search_field").value;if(b==""){return false}var a="ajax/city.php?rid="+rid+"&mode=statssearch&name="+encodeURIComponent(b)}else{var a="ajax/city.php?rid="+rid+"&mode="+h+"&type="+e+"&page="+stats_page+"&findme="+c}if(d>0){a="ajax/guild.php?rid="+rid+"&mode=publicinit&guildid="+d}var l=createAjaxRequestObj();l.open("GET",a,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.onreadystatechange=function(){statsActionResponse(l,e,d)};l.send(null)}var stats_data={};function statsActionResponse(request,type,guildid){var result=_chkRequest(request);if(result!=0){if(result[0]==0){globalerrorbox(result[1])}else{var without=["guilds","medals","stock","buildings","plants","animals","pets"];if(in_array(type,without)){hideDiv("stats_findme")}else{showDiv("stats_findme")}if(type=="baumies"||type=="quests"||type=="plants"){showDiv("stats_cache_info")}else{hideDiv("stats_cache_info")}if(guildid>0){var data=result[0][0];$("publicguildname").innerHTML=data[1]+"&nbsp;["+data[3]+"]";$("publicguildpts").innerHTML=data[6];$("publicguilddesc").innerHTML=data[2];$("publicguildjoin").innerHTML=data[13];$("publicguildmember").innerHTML=data[10];if(data[4]){var parts=data[4].split("_");$("publicguildbanner_back").style.backgroundImage="url("+imgpath+"guildbanner/backgrounds/back_"+parts[0]+".jpg)";$("publicguildbanner_border").style.backgroundImage="url("+imgpath+"guildbanner/borders/GeneriertesBild_"+parts[1]+"_"+parts[2]+".png)";$("publicguildbanner_head").style.backgroundImage="url("+imgpath+"guildbanner/heads/GeneriertesBild_"+parts[3]+"_"+parts[4]+".png)"}var backimg="inner_background6.jpg";var beauties="";if(result[0][4]){if(result[0][4].length>15){var start=15}else{if(result[0][4].length>6){var start=6}else{var start=0}}for(var i=start;i<result[0][4].length;i++){if(result[0][4][i]){beauties+='<div id="guildbeauty'+result[0][4][i]+'"></div>'}if(result[0][4][i]==6){backimg="guild/gh_update_1_complete.jpg"}else{if(result[0][4][i]==7){backimg="inner_background6_2.jpg"}else{if(result[0][4][i]==16){backimg="inner_background6_3.jpg"}}}}}if(result[0][4].length>=12&&result[0][4].length<=15){backimg="guild/gh_update_2_complete.jpg"}$("guildpublic").style.backgroundImage="url("+imgpath+backimg+")";$("publicguildbeauties").innerHTML=beauties;if(result[0].achievements){for(var i=1;i<=50;i++){if($("guildpublicachievement"+i)){if(result[0].achievements[i]){$("guildpublicachievement"+i).addClassName("gach"+i)}else{$("guildpublicachievement"+i).addClassName("gach"+i+"off")}}}}var test=eval(result[0]["trophies"]);buildGuildWBWtrophies(test);for(var s in result[0]["park"]){if($("publicguildpark"+s)){var add="jpg";if(s==1){var name="megacow"+result[0]["park"][s]}else{if(s==2){var name="megasheep"+result[0]["park"][s]}else{if(s==3){var name="megachicken"+result[0]["park"][s]}else{if(s==4){var name="megagoat"+result[0]["park"][s]}else{if(s==5){var name="megabunny"+result[0]["park"][s];add="png"}}}}}$("publicguildpark"+s).style.backgroundImage="url("+imgpath+"guild/"+name+"."+add+")"}}$("publicguildjoinbutton").onclick=new Function("joinGuild("+guildid+")");showDiv("guildpublictransp");showDiv("guildpublic")}else{if(type=="statssearch"){showDiv("stats_search_info");hideDiv("unknown_player");hideDiv("unknown_guild");hideDiv("stats_search_info_inner_player");hideDiv("stats_search_info_inner_guild");var html="";if(result[1].player){html+=result[1].player.uname+"&nbsp;";if(!isSteam()){html+='<img class="link" src="'+imgpath+'stadt/stats_sf_black.gif" onclick="window.open(\''+http_host+"schaugarten/index.php?mode=view&user="+result[1].player.unr+"')\">&nbsp;"}html+="(<b>"+result[1].player.unr+"</b>)";$("search_info_name").innerHTML=html;$("search_info_pkt").innerHTML=result[1].player.pkt;$("search_info_bar").innerHTML=formatPrice(result[1].player.bar);$("search_info_lvl").innerHTML=result[1].player.level;$("search_info_quests").innerHTML=result[1].player.quests;$("search_info_sells").innerHTML=result[1].player.sells;$("search_info_money").innerHTML=formatPrice(result[1].player.money);showDiv("stats_search_info_inner_player")}else{showDiv("unknown_player")}if(result[1].guild){var name=result[1].guild.guildname;if(result[1].guild["short"]){name+="&nbsp;["+result[1].guild["short"]+"]"}$("search_info_guildname").innerHTML=name;$("search_info_points").innerHTML=result[1].guild.guildpts;$("search_info_tax").innerHTML=formatPrice(result[1].guild.bar);$("search_info_members").innerHTML=result[1].guild.members;$("search_info_birth").innerHTML=result[1].guild.createguild;var desc="---";if(result[1].guild.guilddescription){desc=result[1].guild.guilddescription}$("search_info_desc").innerHTML=desc;$("search_guild_joinlink").onclick=new Function("statsAction(0, 0, "+result[1].guild.guildid+")");showDiv("stats_search_info_inner_guild")}else{showDiv("unknown_guild")}}else{var html="";if(in_array(type,["stock","buildings","animals","pets"])){stats_page=1;var highest=0;var rank=1;for(var i=0;i<result.length;i++){if(!result[i].name){continue}html+="<tr>";html+="  <td>"+rank+".</td>";html+='  <td class="stats_name">'+result[i].name+"</td>";html+='  <td class="stats_percent" style="width:300px;">';html+='    <div style="background:url('+imgpath+"stadt/percentbar.gif); width:"+result[i].percent+'%; height:15px;"></div>';html+="  </td>";html+='  <td class="stats_right stats_counter">'+formatNumber(result[i].value)+"</td>";html+="</tr>";rank++}}else{var sort=result[1].sort;var data=result[1].data;stats_data=data;stats_page=result[1].page;prev=0;if(stats_page>1){rank=((stats_page-1)*result[1].max)+1}else{rank=1}for(var i in data){if(type=="rating"&&!data[i].unr){continue}var compare=data[i][sort[(sort.length-1)]];var rank_str=rank+".";if(prev==compare){rank_str="&nbsp;"}var medals="&nbsp;";if(data[i].gold>0){medals+='<img class="link" src="'+imgpath+'medaillen/10er.gif" title="'+data[i].gold+'">'}if(data[i].silber>0){medals+='<img class="link" src="'+imgpath+'medaillen/5er.gif" title="'+data[i].silber+'">'}if(data[i].bronze>0){medals+='<img class="link" src="'+imgpath+'medaillen/1er.gif" title="'+data[i].bronze+'">'}var addclass="";var addstyle="";if(data[i].own){addclass="important"}if(data[i].giftid){addstyle="opacity:0.5; color:#333;"}html+="<tr>";html+='  <td class="'+addclass+'" style="'+addstyle+'">'+rank_str+"</td>";for(var j=0;j<sort.length;j++){if(j==(sort.length-1)){addclass+=" stats_right"}html+='<td class="'+addclass+" stats_"+sort[j]+'" style="'+addstyle+'">';if(sort[j]=="percent"){html+='<div style="background:url('+imgpath+"stadt/percentbar.gif); width:"+(data[i][sort[j]]*2)+'px; height:15px;"></div>'}else{if(sort[j]=="guildid"){html+='<button type="button" class="link" onclick="statsAction(0, 0, '+data[i][sort[j]]+')">'+t_guild_join+"</button>"}else{html+=data[i][sort[j]];if(sort[j]=="uname"){html+="&nbsp;";if(!isSteam()){html+='<img class="link" src="'+imgpath+'stadt/stats_sf_black.gif" onclick="window.open(\''+http_host+"schaugarten/index.php?mode=view&user="+data[i].unr+"')\">"}html+=medals}}}if(sort[j]=="counter"&&type=="medals"){html+="%"}html+="</td>"}html+="</tr>";rank++;prev=compare}}if($("stats_table")){$("stats_table").update(html)}hideDiv("stats_navi_left");hideDiv("stats_navi_right");if(stats_page>1){showDiv("stats_navi_left")}if(stats_page<result[1].maxpage){showDiv("stats_navi_right")}var without=["stock","buildings","plants","animals","pets","rating"];if(in_array(type,without)){hideDiv("statsNaviLine")}else{showDiv("statsNaviLine")}}}}}}function statsFindMe(){var b=0;for(var a in stats_data){if(stats_data[a].own==1){b=1;break}}if(!b){statsAction(0,1)}}function closeGuildPublic(){hideDiv("guildpublictransp");hideDiv("guildpublic");if(new_city_stats_active==1&&statscacher){statscacher.goBack()}}function joinGuild(b){var a="sendJoinMessage("+b+");";globalcommitbox(0,guildjoincommit,a)}function openBeemaster(){cityAction("initbeemaster")}function openBeemasterResponse(a){var c="";if(cityzones[2]==1&&a[1]){var d=0;c+='<div style="width:255px; margin-bottom:10px;">'+beemasterintro2+"</div>";c+='<div style="background-color:#C3A75E; padding:5px; border-radius:5px;">';c+='  <select id="selectbees" style="float:left; margin-right:5px; padding:2px; border-radius:5px; border:1px solid #ccc;">';for(var b in a[1]){d+=a[1][b].p;if(b>0){c+='<option value="'+b+'">'+b+"&nbsp;"+beemasteritemplural+"&nbsp;=&nbsp;"+formatPrice(d)+"</option>"}}c+="  </select>";c+='  <button class="button_new link" style="float:right;" onclick="buyBees()">'+t_architect_buy+"</button>";c+='  <div class="clear"></div>';c+="</div>"}else{c+='<div style="width:255px; margin-bottom:10px;">'+beemasterintro+"</div>"}globalcommitbox(t_beemaster,c,0,0,1)}function buyBees(){var a=$("selectbees").value;if(a>0){cityAction("buybee","5_"+a)}else{return false}}function openMarktschreier(){if(city==1){var a="";$("marktschreierinner").style.backgroundImage="url("+imgpath+"city/marktschreier_inner.jpg)";cityAction("initmarktschreier")}}function openMarktschreiberResponse(n){var b=n[1];var l="";var e="";for(var d=0;d<b.length;d++){var c="messagesOpen('"+b[d]["name"]+"');";e+='<div style="padding:5px; border-bottom:1px dashed #9697DA;" onmouseover="this.style.backgroundColor=\'#CACCE3\';" onmouseout="this.style.backgroundColor=\'transparent\';">';e+='<div style="float:left; width:75px; overflow:visible;">'+b[d]["date"]+"</div>";e+='<div style="float:left; position:relative; width:20px;">';e+='<img src="'+imgpath+'guild/mail.gif" onclick="'+c+'" onmouseover="showDiv(\'msentryinfo'+d+"');\" onmouseout=\"hideDiv('msentryinfo"+d+'\');" class="link">';e+='<br><img src="'+imgpath+"guild/contract.gif\" onclick=\"showPage('contracts', '"+b[d]["name"]+"');\" onmouseover=\"showDiv('msentry2info"+d+"');\" onmouseout=\"hideDiv('msentry2info"+d+'\');" class="link">';if(b[d]["self"]==1){e+='<img class="link" width="12" height="12" src="'+imgpath+'guild/cancel.gif" onclick="delMarktschreierCommit('+b[d]["msid"]+');">'}e+='<div id="msentryinfo'+d+'" style="display:none; position:absolute; top:10px; left:35px; white-space:nowrap;" class="blackbox">'+str_replace("%USER%",b[d]["name"],marktschreierwriteuser)+"</div>";e+='<div id="msentry2info'+d+'" style="display:none; position:absolute; top:30px; left:35px; white-space:nowrap;" class="blackbox">'+str_replace("%USER%",b[d]["name"],marktschreierwritecontract)+"</div>";e+="</div>";e+='<div style="float:left; width:270px; overflow:hidden;"><b>'+str_replace("%USER%",b[d]["name"],marktschreieruserwrote)+"</b><br>"+b[d]["message"]+"</div>";e+='<div style="clear:both;"></div>';e+="</div>"}var a=marktschreiermaxletters;l+='<textarea id="marktschreierentry" name="marktschreierentry" rows="2" cols="62" onkeyup="calcMarktschreierLength();" onChange="calcMarktschreierLength();"></textarea>';l+='<button class="link" type="button" id="marktschreiersend" name="marktschreiersend" onclick="writeMarktschreier();">'+marktschreiersubmit+"</button>&nbsp;";l+='<span style="font-size:10px;" id="marktschreierletterscounter">'+str_replace("%LETTERS%",a,marktschreierletters)+"</span>";l+='<div style="font-size:9px; color:#f00;">'+marktschreierwarnung+"</div>";var h='<span onmouseover="showDiv(\'infocoins\');" onmouseout="hideDiv(\'infocoins\');"><img src="'+imgpath+'menu/coins.gif" border="0" width="12" height="12">&nbsp;'+marktschreiercostcoins+"</span>";var m='<div class="blackbox" id="infocoins" style="display:none; z-index:100; position:absolute; top:50px; left:105px;">'+t_coins+"</div>";$("marktschreierinnerintro").innerHTML=marktschreierintro+"<br><br>"+str_replace("%COINS%",h,marktschreiercost);$("marktschreierinnerinput").innerHTML=l;$("marktschreierinnercontent").innerHTML=e;showDiv("transp3");showDiv("marktschreierinner")}function calcMarktschreierLength(){var a=$("marktschreierentry").value;if(a.length>marktschreiermaxletters){$("marktschreierentry").value=a.substring(0,marktschreiermaxletters);$("marktschreierentry").scrollTop=$("marktschreierentry").scrollHeight;var a=$("marktschreierentry").value;var b=a.length;$("marktschreierletterscounter").innerHTML=str_replace("%LETTERS%",b,marktschreierletters)}if(a.length>0){var b=parseInt(marktschreiermaxletters)-parseInt(a.length);$("marktschreierletterscounter").innerHTML=str_replace("%LETTERS%",b,marktschreierletters)}else{$("marktschreierletterscounter").innerHTML=str_replace("%LETTERS%",marktschreiermaxletters,marktschreierletters)}}function writeMarktschreier(){var a=$("marktschreierentry").value;if(a.length==0||a.length>marktschreiermaxletters){return false}else{cityAction("writemarktschreier",a)}}function delMarktschreierCommit(b){var c=marktschreierdelinfo;var a="delMarktschreier("+b+")";globalcommitbox(marktschreierdelheadline,c,a)}function delMarktschreier(a){cityAction("delmarktschreier",a)}var birthday_citysheep_data={};var birthday_buy_block=0;function birthdayCitySheepDialog(c,a){var e="";var d="";var l="";var h="";if(c=="init"){e=t_birthday_citysheep_head;d+='<div style="margin-top:-15px;">';d+='  <div style="float:left; margin-top:6px; margin-right:5px; margin-left:90px;">'+t_birthday_citysheep_stock+"</div>";d+='  <div style="position:relative; float:left;" id="birthdayCitySheepAmount">'+birthday_citysheep_data.cards;d+='    <div id="birthday_citysheep_flyer"></div>';d+="  </div>";d+='  <div class="clear"></div>';d+="</div>";if(birthday_suitcase_buytime==1){d+='<button type="button" class="link button_new" onclick="birthdayCitySheepDialog(\'buy\')">'+t_birthday_citysheep_buy+"</button>"}d+='<div id="birthday_citysheep_cards">';for(var b in birthday_citysheep_data.sheeps){var m="";var n="birthdayCitySheepDialog('swap', "+b+")";if(birthday_citysheep_data.sheeps[b].cards>birthday_citysheep_data.cards){m="important";n=""}if(birthday_citysheep_data.current&&in_array(b,birthday_citysheep_data.current)){n=""}d+='<div id="birthday_citysheep_card'+b+'" class="birthday_citysheep_card link" onclick="'+n+'">';d+='  <div class="birthday_citysheep_card_points '+m+'">'+birthday_citysheep_data.sheeps[b].cards+"</div>";if(birthday_citysheep_data.current&&in_array(b,birthday_citysheep_data.current)){d+='  <div class="birthday_citysheep_card_check"></div>'}d+="</div>"}d+='  <div class="clear"></div>';d+="</div>";globalcommitbox(e,d,l,h);$("globalbox_content").addClassName("birthday_townsheep_globalbox_content_mod");$("globalbox").addClassName("birthday_townsheep_globalbox_mod");if(birthday_citysheep_data.update){window.setTimeout(function(r){startCityFlyer("birthday_citysheep_flyer",birthday_citysheep_data.update,3000)})}}else{if(birthday_citysheep_data.update){birthday_citysheep_data.update=0}}if(c=="swap"){e=t_birthday_citysheep_invite;d=str_replace("%AMOUNT%",birthday_citysheep_data.sheeps[a].cards,t_birthday_citysheep_invite_body);l="cityAction('birthday_citysheep_swap', "+a+")";h="birthdayCitySheepDialog('init');";globalcommitbox(e,d,l,h)}if(c=="buy"){e=t_birthday_citysheep_buy;for(var b in birthday_citysheep_data.buy){var m="";var n="birthdayCitySheepDialog('buycommit', "+b+")";if(birthday_citysheep_data.buy[b]>birthday_citysheep_data.coins){m="important";n=""}var q=str_replace("%AMOUNT1%",birthday_citysheep_data.buy[b],t_birthday_citysheep_buy_line);q=str_replace("%AMOUNT2%",b,q);d+='<button type="button" class="birthday_townsheep_buy_button button_new link '+m+'" onclick="'+n+'">'+q+"</button><br><br>";l="";h="birthdayCitySheepDialog('init');";globalcommitbox(e,d,l,h,1)}}if(c=="buycommit"){e=t_birthday_citysheep_buy;d=str_replace("%AMOUNT1%",a,t_birthday_citysheep_buy_body);d=str_replace("%AMOUNT2%",birthday_citysheep_data.buy[a],d);l="cityAction('birthday_citysheep_buy', "+a+")";h="birthdayCitySheepDialog('init');";globalcommitbox(e,d,l,h)}}var easterevent=function(){this.data={}};easterevent.prototype.exchange=function(a){easterevent.action("easterevent_exchange",{cost:a})};easterevent.prototype.buy=function(a){easterevent.action("easterevent_buy",{coins:a})};easterevent.prototype.init=function(){easterevent.action("easterevent_init")};easterevent.prototype.action=function(a,b){ajaxAction("farm",a,b,easterevent.response)};easterevent.prototype.response=function(b,a,c){easterevent.data=b;easterevent.build()};easterevent.prototype.build=function(){var h=0;if(this.data.data.points){h=this.data.data.points}var l="";l+='<div class="head">'+t_easterevent_name+"</div>";l+='<div class="points">';l+='  <div class="amount">'+formatNumber(h)+"</div>";l+='  <div class="plus link" onclick="easterevent.buyCommit()" onmouseover="showDiv(\'cityeasterevent_points_plus_tt\')" onmouseout="hideDiv(\'cityeasterevent_points_plus_tt\')">';l+='    <div id="cityeasterevent_points_plus_tt" class="ttbox">'+t_tinkergame_buyitem_head.replace("%NAME%",t_easterevent_item)+"</div>";l+="  </div>";l+="</div>";l+='<div class="desc">'+t_easterevent_desc.replace("%ITEM%",t_easterevent_item)+"</div>";l+='<div class="rewards">';for(var d in this.data.config.reward){l+='<div class="slot">';for(var n in this.data.config.reward[d]){if(n=="colors"){continue}l+='<div class="items '+n+'">';var q=this.data.config.reward[d][n].length;for(var e=0;e<q;e++){var a="";if(n=="farmhouse"){a=t_farmhouse_item}var b=this.data.config.reward[d][n][e];l+='<div class="item '+n+b+'" style="background-image:url('+imgpath+"farmhouse/previews/"+b+'_1.jpg)" onmouseover="showDiv(\'cityeasterevent_item'+d+"_"+n+"_"+e+"')\" onmouseout=\"hideDiv('cityeasterevent_item"+d+"_"+n+"_"+e+"')\">";l+='  <div id="cityeasterevent_item'+d+"_"+n+"_"+e+'" class="ttbox">';l+="    <div>"+a+"</div>";if(n=="farmhouse"){l+='<div style="font-style:italic; text-align:center;">('+t_farmhouse_category[farmhouseitems_config[b][0]]+")</div>"}l+="  </div>";l+="</div>";if(e<(q-1)){l+='<div class="add">+</div>'}}l+='  <div class="clear"></div>';l+="</div>"}if(this.data.data.reward&&this.data.data.reward[d]){l+='<div class="ready"></div>'}else{var c=this.data.config.reward[d].colors;var s="easterevent.exchange("+d+")";var r="";if(c>h){s="";r="failed"}l+='<div class="button_new link cost '+r+'" onclick="'+s+'" onmouseover="showDiv(\'cityeasterevent_reward_slot'+d+"_cost_tt')\" onmouseout=\"hideDiv('cityeasterevent_reward_slot"+d+"_cost_tt')\">";l+="  <div>"+formatNumber(c)+"</div>";l+='  <div id="cityeasterevent_reward_slot'+d+'_cost_tt" class="ttbox">'+t_easterevent_get_reward.replace("%AMOUNT%",c).replace("%NAME%",t_easterevent_item)+"</div>";l+="</div>"}l+="</div>"}l+="</div>";l+='<div class="timer">'+t_event_resttime+':&nbsp;<span id="cityeasterevent_timer"></span></div>';l+='<div class="char"></div>';l+='<div class="helpbutton_blue link" onmouseover="showDiv(\'cityeasterevent_help_tt\')" onmouseout="hideDiv(\'cityeasterevent_help_tt\')">';l+='  <div id="cityeasterevent_help_tt" class="ttbox">';l+='    <div class="memory_pack"></div>';l+='    <div class="info">'+t_easterevent_help.replace("%NAME%",t_memory_name).replace("%NAME2%",t_easterevent_item).replace("%NAME2%",t_easterevent_item)+"</div>";l+='    <div class="clear"></div>';l+="  </div>";l+="</div>";l+='<div class="mini_close link" onclick="easterevent.close();"></div>';$("cityeasterevent_inner").innerHTML=l;showDiv("cityeasterevent");setTimer("easterevent");if(this.data.daily){var m='<div id="cityeasterevent_daily_commit">';m+="  <div>"+t_specialoffer_message+"</div>";m+='  <div class="img"></div>';m+='  <div class="amount">'+formatNumber(this.data.daily)+"x</div>";m+="  <div class=\"button_yes link\" onclick=\"hideDiv('globalbox'); hideDiv('globaltransp');\"></div>";m+="</div>";globalcommitbox("",m,0,0,1)}};easterevent.prototype.buyCommit=function(){var b=t_tinkergame_buyitem_head.replace("%NAME%",t_easterevent_item);var a=t_tinkergame_buyitem_line.replace("%NAME%",t_easterevent_item);events.buyCommit({name:"easterevent",buydata:this.data.config.buy,fn:"easterevent.buy",head:b,line:a})};easterevent.prototype.timer=function(){this.data.data.remain--;if($("cityeasterevent_timer")){$("cityeasterevent_timer").innerHTML=formatTime(this.data.data.remain)}};easterevent.prototype.close=function(){hideDiv("cityeasterevent")};var easterevent=new easterevent();function cityTelekomOpen(h){var e=getRandom(1000000,9999999);var d="Das Netz der Zukunft";var c="";c+='<div style="margin-bottom:-5px; margin-top:-25px;"><a href="https://media.gan-online.com/www/delivery/ck.php?oaparams=2__bannerid=13144__zoneid=0__cb='+e+'" target="_blank"><img src="http://gan.wavecdn.net/logo.png" height="70"></a></div>';c+='<div style="margin-bottom:5px;">Der Online-Shop in Klein Muhstein bentigt Waren von dir. Damit Du der gestiegenen Nachfrage gerecht werden kannst, schenkt dir die Telekom bis zum Jahresende den <b>zweiten Wachstumsbeschleuniger</b> einmal tglich <b>gratis</b> und ein tolles Setzkastenitem!';if(h.finished==1){c+='<div style="margin-botton:5px;"><br><span style="font-weight:bold;">Gratulation, du hast es geschafft!</span><br><br>Du kannst nun tglich bis zum 31.12.2013, 23:59:59 folgenden Beschleuniger bei einem Acker deiner Wahl benutzen:</div>';c+='<div style="margin:0px auto;" class="gardenspeedupbox_item">';c+='  <div class="gardenspeedupbox_item_coins">kostenlos</div>';c+='  <div class="gardenspeedupbox_item_time">00:30:00</div>';c+="</div>"}else{c+="<br><br>Beliefere dafr den Online-Shop bis zum "+h.end+" mit der Grundausstattung:</div>";c+='  <div style="float:left; margin-right:5px;"><img src="'+imgpath+"gifts/"+h.config.reward.giftid+'.gif"></div>';c+='  <div style="float:right;">';for(var b in h.config.need){var a="";var l=0;if(!checkRackItem(b)){a="important"}if(h.entries[b]){l=h.entries[b]}c+='<div class="city_telekom_entry_line">';c+='  <div class="kp'+b+' city_telekom_entry_line_img"></div>';c+='  <div class="city_telekom_entry_line_stats '+a+'">'+l+"/"+h.config.need[b]+"&nbsp;"+t_stk+"</div>";if(!h.entries[b]){if(a==""){c+='<button type="button" class="button_new link city_telekom_entry_line_button" onclick="cityAction(\'telekomentry\', '+b+')">'+t_inner_feedsubmit+"</button>"}}else{c+='<div class="city_telekom_entry_line_ok"></div>'}c+='  <div class="clear"></div>';c+="</div>"}c+="  </div>";c+='  <div class="clear"></div>'}c+='<iframe style="height:1px; width:1px; border:0px;" src="http://media.gan-online.com/www/delivery/lg.php?zoneid=0&campaignid=4980&bannerid=13145&cb='+e+'"></iframe>';c+='<iframe style="height:1px; width:1px; border:0px;" src="http://bs.serving-sys.com/BurstingPipe/adServer.bs?cn=tf&c=19&mc=imp&pli=8582109&PluID=0&ord='+e+'&rtu=-1"></iframe>';globalcommitbox(d,c,0)}var wm_sheep_block=0;var wm_sheep_config={};var wm_sheep_coins={};function openWM(c){wm_sheep_block=0;wm_sheep_config=c.config;wm_sheep_coins=c.coins;for(var b in c.config){if($("wmbox_sheep"+b)){var a="";if(c.sheeps[b]){showDiv("wmbox_sheep_active"+b)}else{if(!c.balls||c.balls<c.config[b][0]){$("wmbox_sheep_balls"+b).addClassName("important")}else{a="dialogWM('exchange', "+b+")";$("wmbox_sheep_balls"+b).removeClassName("important")}}$("wmbox_sheep"+b).onclick=new Function(a)}}$("wmbox_sheep_count").innerHTML=c.balls;showDiv("transp3");showDiv("wmbox")}function dialogWM(l,m){var h=0;if(l=="buy"){var e=t_wm_event_buy_head;var b="";for(var d in wm_sheep_coins){var a=str_replace("%AMOUNT%",wm_sheep_coins[d],t_wm_event_buy_body);a=str_replace("%COINS%",d,a);b+='<div class="wm_coins_button link" onclick="dialogWM(\'buy_commit\', '+d+')">'+a+"</div>"}h=1}if(l=="buy_commit"){var e=t_wm_event_buy_head;var a=str_replace("%AMOUNT%",wm_sheep_coins[m],t_wm_event_buy_body);var b=str_replace("%COINS%",m,a);var c="cityAction('wm_buyballs', "+m+")"}if(l=="exchange"){var e=t_wm_event_exchange_head;var b=str_replace("%NAME%",wm_sheep_config[m][1],t_wm_event_exchange_body);b=str_replace("%AMOUNT%",wm_sheep_config[m][0],b);var c="cityAction('wm_exchangeballs', "+m+")"}globalcommitbox(e,b,c,0,h)}function closeWM(){hideDiv("transp3");hideDiv("wmbox")}var cityFlyerId="";function startCityFlyer(c,b,a){cityFlyerId=c;if(!("transition" in $(c).style)&&!("webkitTransition" in $(c).style)){return false}$(c).innerHTML=b;$(c).addClassName(c);setTimeout(closeCityFlyer,a)}function closeCityFlyer(){$(cityFlyerId).innerHTML="";$(cityFlyerId).removeClassName(cityFlyerId)}var coinsevent=function(){this.data={}};coinsevent.prototype.init=function(){coinsevent.action("coinsevent_init")};coinsevent.prototype.action=function(a,b){ajaxAction("farm",a,b,coinsevent.response)};coinsevent.prototype.response=function(b,a,c){coinsevent.data=b;coinsevent.build();setTimer("coinsevent")};coinsevent.prototype.build=function(){var a=0;var e=0;var c=0;if(this.data.data.coins){a=this.data.data.coins;e=Math.floor(a/this.data.config.needcoins);c=a-(e*this.data.config.needcoins)}var d=((c*100)/this.data.config.needcoins);var b='<div id="coinsevent">';b+='  <div class="desc">'+t_coinsevent_desc.replace("%COINS%",this.data.config.needcoins).replace("%DAYS%",this.data.config.premiumdays)+"</div>";b+='  <div class="counter">'+c+"/"+this.data.config.needcoins+"</div>";b+='  <div class="bar">';b+='    <div class="back"></div>';b+='    <div class="inner" style="width:'+d+'%"></div>';b+='    <div class="front"></div>';b+='    <div class="explain">'+t_coinsevent_full_explain.replace("%DAYS%",this.data.config.premiumdays)+"</div>";b+="  </div>";b+='  <div class="progress">';b+='    <div class="head">'+t_coinsevent_progress+"</div>";b+='    <div class="days">';b+='      <div class="count">'+t_coinsevent_progress_days.replace("%DAYS%",e)+"</div>";b+='      <div class="img"></div>';b+="    </div>";b+='    <div class="info">'+t_coinsevent_progress_days_info+"</div>";b+="  </div>";b+='  <div class="timer">'+t_event_resttime+':&nbsp;<span id="coinsevent_timer">'+formatTime(this.data.data.remain)+"</span></span></sp></div>";b+="</div>";globalBoxFlex('<div style="font-size:20px">'+t_coinsevent_name+"</div>",b,0,0,1);$("globalbox").style.top="90px"};coinsevent.prototype.flyer=function(b){var a='<div style="display:flex; justify-content:left;">';a+='  <div class="icon_coins"></div>';a+="  <div>+"+b+"</div>";a+="</div>";events.flyer({id:"coinsevent_link",name:"coinsevent",html:a,idle:"idle",move:"up"})};coinsevent.prototype.timer=function(){this.data.data.remain--;if($("coinsevent_timer")){$("coinsevent_timer").innerHTML=formatTime(this.data.data.remain)}};var collectevent=function(){this.data={}};collectevent.prototype.buy=function(a){collectevent.action("collectevent_buy",{coins:a})};collectevent.prototype.action=function(a,b){ajaxAction("farm",a,b,collectevent.response)};collectevent.prototype.response=function(b,a,c){collectevent.data=b;collectevent.init()};collectevent.prototype.init=function(){this.update()};collectevent.prototype.update=function(){var b=0;if(this.data.data.points){b=this.data.data.points}var a='<div class="content">';a+='  <div class="head">'+t_collectevent_title+"</div>";a+='  <div class="desc">'+t_collectevent_intro.replace("%ITEM%","<b>"+t_collectevent_item+"</b>")+"</div>";a+='<div class="bar">';a+='  <div id="collectevent_steps" class="steps flex-center"></div>';a+='  <div class="points">';a+='    <div class="amount">'+formatNumber(b)+"</div>";if(b<this.data.config.max){a+='<div class="buy link" onclick="collectevent.buyCommit()" onmouseover="showDiv(\'collectevent_buy_tt\')" onmouseout="hideDiv(\'collectevent_buy_tt\')">';a+='  <div id="collectevent_buy_tt" class="ttbox">'+t_tinkergame_buyitem_head.replace("%NAME%",t_collectevent_item)+"</div>";a+="</div>"}a+="  </div>";a+="</div>";a+=events.buildTimeline("collectevent");a+='  <div class="mini_close link" onclick="collectevent.close()"></div>';a+='  <div class="deco_add" onclick="collectevent.sheepClick()"></div>';a+="</div>";$("collectevent_content").innerHTML=a;$("collectevent").style.display="flex";$("collectevent").addClassName(this.data.config.event);$("collectevent_content").addClassName("bounce");this.buildSteps()};collectevent.prototype.buildSteps=function(){var l=0;if(this.data.data.points){l=this.data.data.points}var n=this.data.config.rewards;var e="";e+='<div id="collectevent_steps_line" class="line flex-center">';for(var c in n){var m=0;if(parseInt(this.data.data.points)>=parseInt(n[c].points)){m=100}else{var b=0;if(n[(c-1)]){var b=parseInt(n[(c-1)].points)}var r=(parseInt(n[c].points)-b);var a=(parseInt(this.data.data.points)-b);if(a>0){m=((a*100)/r)}}e+='<div class="step">';e+='  <div class="bar_inner" style="width:'+m+'%"></div>';e+='  <div class="reward flex-center-all" onmouseover="showDiv(\'collectevent_reward'+c+"_tt')\" onmouseout=\"hideDiv('collectevent_reward"+c+"_tt')\">";var h="";if(n[c].rewards.products){e+='<div class="img product_package size'+n[c].rewards.products+'"></div>';h+="<div>"+t_productpackage_size[n[c].rewards.products]+"</div>";if(this.data.data.rewards&&this.data.data.rewards[c]&&this.data.data.rewards[c].products){h+='<div style="background-color:beige; padding:5px; margin:-4px; margin-top:5px; border-bottom-left-radius:5px; border-bottom-right-radius:5px;">';for(var d in this.data.data.rewards[c].products){h+='<div class="flex-center">'+htmlProductBody(d,this.data.data.rewards[c].products[d])+"</div>"}h+="</div>"}}if(n[c].rewards.giftid){e+='<div class="img giftid giftid'+n[c].rewards.giftid+'"></div>';h+="<div>"+t_pan_item+"</div>"}if(n[c].rewards.powerup){e+='<div class="img powerup"></div>';if(h!=""){h+="<div>+</div>"}h+="<div>"+formulas[0][n[c].rewards.powerup][5][3]+"% "+t_rainbowevent_reward_types.powerup+"</div>"}if(n[c].rewards.moneypackage){e+='<div class="img money_package size'+n[c].rewards.moneypackage+'"></div>';h+="<div>"+t_moneypackage_size[n[c].rewards.moneypackage]+"</div>";if(this.data.data.rewards&&this.data.data.rewards[c]&&this.data.data.rewards[c].money){h+=formatPrice(this.data.data.rewards[c].money)}}if(n[c].rewards.farmhouse){e+='<div class="img farmhouse" style="background-image:url('+imgpath+"farmhouse/thumbs/"+n[c].rewards.farmhouse+'.jpg);"></div>';h+="<div>"+t_farmhouse_item+"</div>";h+='<div style="font-style:italic;">('+t_farmhouse_category[farmhouseitems_config[n[c].rewards.farmhouse][0]]+")</div>"}if(m>=100){e+='<div class="ready"></div>'}var q="";if(c>=5){q="right"}e+='    <div id="collectevent_reward'+c+'_tt" class="ttbox '+q+'">'+h+"</div>";e+='    <div class="amount">'+formatNumber(n[c].points)+"</div>";e+="  </div>";e+="</div>"}e+="</div>";$("collectevent_steps").innerHTML=e;$("collectevent_steps_line").style.width="calc(var(--collectevent-step-width) * "+c+")"};collectevent.prototype.daily=function(b){var a='<div id="collectevent_daily" class="'+this.data.config.event+'">';a+='  <div class="line">';a+='    <div class="item birthday_collectitem '+this.data.config.event+'"></div>';a+='    <div class="amount">'+b+"&nbsp;"+t_collectevent_item+"</div>";a+='    <div class="clear"></div>';a+="  </div>";a+='  <div class="bonusinfo">'+str_replace("%POINTS%",b,t_collectevent_daily_intro)+"</div>";a+='  <div class="button_new link eventbutton" onclick="collectevent.init()">'+t_collectevent_daily_link+"</div>";a+='  <div id="collectevent_daily_confetti" class="confetti2"></div>';if(this.data.config.event=="china"){a+='<div class="topleft"></div>';a+='<div class="bottomright"></div>'}a+="</div>";globalcommitbox(t_collectevent_daily_head,a,0,0,1);if(this.data.config.event=="china"){hideDiv("globalbox_char");hideDiv("globalbox_footer")}else{$("globalbox_char").removeClassName("globalbox_sheep").addClassName("globalbox_birthdaysheep");showDiv("globalbox_char");showDiv("globalbox_footer")}hideDiv("globalbox_charani");setTimeout(function(){hideDiv("collectevent_daily_confetti")},1000)};collectevent.prototype.buyCommit=function(){var b=t_tinkergame_buyitem_head.replace("%NAME%",t_collectevent_item);var a=t_tinkergame_buyitem_line.replace("%NAME%",t_collectevent_item);events.buyCommit({name:"collectevent",buydata:this.data.config.buy,fn:"collectevent.buy",head:b,line:a})};collectevent.prototype.timer=function(){if(!this.data||!this.data.data){return 1}this.data.data.remain--;this.data.data.remain_exchange--;events.timerTimeline("collectevent");if(this.data.data.remain_exchange<=0){this.close()}};collectevent.prototype.flyer=function(b){var a='<div class="img birthday_collectitem '+this.data.config.event+'"></div>';a+='<div class="amount">'+b+"x</div>";a+='<div class="clear"></div>';events.flyer({id:"collectevent_link",name:"collectevent",html:a,idle:"idle",move:"up"})};collectevent.prototype.sheepClick=function(){var b=getRandom(-150,250);var a=getRandom(-250,300);$("collectevent").insert('<div id="collectevent_sheep_confetti" class="confetti2" style="top:'+b+"px; left:"+a+'px"></div>');setTimeout(function(){$("collectevent_sheep_confetti").remove()},1000)};collectevent.prototype.close=function(){hideDiv("collectevent")};var contracts_data={};var contracts_cart={};var contracts_category="v";function contractsInit(a){contractsNavi();var d=0;for(var b=0;b<contracts_data.overview["in"].length;b++){var e=contracts_data.overview["in"][b];if(e.read<1){d++}}$("contracts_navi_overview_in_count").innerHTML=d;showDiv("contracts_transp");showDiv("contracts_main");if(!a){contractsOverview("in")}else{contractsNew();$("contracts_new_cart_receiver").value=a}}function contractsNavi(a){if(!a){a="overview_in"}$("contracts_navi_new").removeClassName("contracts_navi_item_active");$("contracts_navi_overview_in").removeClassName("contracts_navi_item_active");$("contracts_navi_overview_out").removeClassName("contracts_navi_item_active");$("contracts_navi_"+a).addClassName("contracts_navi_item_active");hideDiv("contracts_navi_new_content");hideDiv("contracts_navi_overview_in_content");hideDiv("contracts_navi_overview_out_content");$("contracts_navi_overview_in_content").innerHTML="";$("contracts_navi_overview_out_content").innerHTML="";showDiv("contracts_navi_"+a+"_content")}function contractsNewNavi(c){contracts_category=c;contractsNewProducts();var b=["v","e","z","o","fw","fl","md","breed","cow","hr","c","ex","alpin","fish"];if(activate8farm==1){b.push("water")}if(activate10farm==1){b.push("spice")}if(scouts&&scouts.data&&scouts.data.data){b.push("scouts")}for(var a=0;a<b.length;a++){if(!$("cmenue_"+b[a])){continue}$("cmenue_"+b[a]).removeClassName("white_tab_active")}$("cmenue_"+contracts_category).addClassName("white_tab_active")}function contractsNew(a){if(!a){$("contracts_new_cart_receiver").value=""}else{$("contracts_new_cart_receiver").value=a}contractsNavi("new");contractsNewNavi(contracts_category);contractsNewCart()}function contractsNewProducts(){var e=[];var c="";for(var a in produkt_name){if(a==0){produkt_category[a]="c"}var d=produkt_category[a];if(d=="fla"){d="fl"}if(d=="tea"){d="alpin"}if(d=="sushi"){d="water"}if(d=="spicedried"){d="spice"}if(d=="spiceground"){d="spice"}if(contracts_category==d&&in_array(a,contracts_data.products)){if(a==0){var h=user_coins}else{var h=checkRackItem(a)}if(h>0){e.push(a);var l="";if(contracts_cart[a]){l="opacity:0.5;"}c+='<div class="link" style="position:relative; float:left; margin:5px;" onmouseover="showDiv(\'contracts_new_tt'+a+"')\" onmouseout=\"hideDiv('contracts_new_tt"+a+"')\" onclick=\"contractsDialog('select', "+a+')">';c+='  <div class="v'+a+'" style="'+l+'"></div>';c+='  <div id="contracts_new_tt'+a+'" class="ttbox">'+produkt_name[a]+"&nbsp;("+formatNumber(h)+")</div>";c+="</div>"}}}c+="</div>";c+='<div class="clear"></div>';$("contracts_new_category_products").innerHTML=c;$("contracts_new_category_products").removeClassName("overflow");if(e&&e.length>45){$("contracts_new_category_products").addClassName("overflow");for(var b=0;b<e.length;b++){if(b%8>=5){$("contracts_new_tt"+e[b]).addClassName("right")}if(b>=32){$("contracts_new_tt"+e[b]).addClassName("bottom")}}}}function contractsNewCart(){var e=1;for(var b=1;b<=8;b++){$("contracts_new_cart_item"+b).innerHTML=""}var c=0;e=1;for(var b in contracts_cart){var h="";if(b==0){h="width:100%; height:100%;"}var a="";a+='<div class="contracts_new_cart_item_img tt'+b+' link" style="'+h+"\" onclick=\"contractsDialog('select', "+b+')" onmouseover="showDiv(\'contracts_new_cart_item_tt'+b+"')\" onmouseout=\"hideDiv('contracts_new_cart_item_tt"+b+"')\">";if(b==0){a+='<div style="font-size:34px; font-weight:bold; text-align:center; color:#D1D04E;">C</div>'}a+='  <div id="contracts_new_cart_item_tt'+b+'" class="ttbox contracts_new_cart_item_tt">'+produkt_name[b]+"</div>";a+="</div>";var d=contracts_cart[b].price;if(b==0){d=contracts_cart[b].coin_price}a+='<div class="contracts_new_cart_item_price">'+formatPrice(d)+"</div>";a+='<div class="contracts_new_cart_item_amount">'+contracts_cart[b].amount+"x</div>";a+='<div class="contracts_new_cart_item_del link" onclick="contractsRemoveCartProduct('+b+')"></div>';$("contracts_new_cart_item"+e).innerHTML=a;c+=(d*contracts_cart[b].amount);e++}$("contracts_new_cart_sum").innerHTML=formatPrice(c);contractsCheckFireCart();var a="";if(contracts_data.templates){a+='<div style="font-weight:bold; margin:5px 0px 5px 5px; color:#6C441D;">'+t_contract_templates+"&nbsp;"+contracts_data.templates.length+"/"+contracts_data.constants.max_templates+"</div>";if(contracts_data.templates.length>0){for(var b=0;b<contracts_data.templates.length;b++){a+='<div style="border-radius:5px; background-color:#C3A75E; padding:4px; margin-bottom:3px;">';a+='  <div style="float:left; margin-top:2px; width:150px; margin-right:5px;">'+contracts_data.templates[b].name+"</div>";a+='  <div style="float:right; margin-left:5px;" class="contracts_list_cancel link" onclick="contractsDelTemplate('+contracts_data.templates[b].id+')"></div>';a+='  <button style="float:right;" onclick="contractsLoadTemplate('+b+')" class="link button_new">'+t_contract_templates_load+"</button>";a+='  <div class="clear"></div>';a+="</div>"}}}$("contracts_new_templates").innerHTML=a}function contractsLoadTemplate(e){var d=contracts_data.templates[e];$("contracts_new_cart_receiver").value=d.receiver;contracts_cart={};for(var c=0;c<d.cart.length;c++){var b=d.cart[c];contracts_cart[b.pid]={amount:b.amount,price:b.price,type:b.type,coin_price:b.coin_price}}$("contracts_new_cart_template_name").value=d.name;contractsNewCart();contractsNewProducts()}function contractsDelTemplate(b){var a={id:b};generalAction("contracts_deltemplate",a)}function contractsSaveTemplate(){var e="";var a=$("contracts_new_cart_template_name").value;var c=$("contracts_new_cart_receiver").value;for(var b in contracts_cart){e+=b+"_"+contracts_cart[b].amount+"_"+contracts_cart[b].price+"_"+contracts_cart[b].type+"_"+contracts_cart[b].coin_price+"|"}if(a!=""&&e!=""){var d={name:a,receiver:c,cart:e};generalAction("contracts_savetemplate",d)}}function contractsDialog(b,d){if(b=="select"){var q=t_contract_add_product;var h="";h+='<div style="position:relative; width:300px;">';if(d>0){h+='<div class="market_pframe" style="margin:0 auto;">';h+='  <div class="tt'+d+'" style="top:7px; left:7px;"></div>';h+="</div>"}h+='<div style="font-weight:bold; margin-bottom:5px;">'+produkt_name[d]+"</div>";h+='<div class="dialog_input_line">';var m=checkRackItem(d);if(d==0){m=user_coins}var s=1;var e=0;var n=0;if(contracts_cart[d]){s=contracts_cart[d].amount;e=contracts_cart[d].price;n=contracts_cart[d].type}else{var a=contractsCheckPrice(d);if(a.min>0){e=a.min}var l=0;for(var c in contracts_cart){l++}if(l>=8){return false}}h+='<div style="margin-bottom:5px;">';h+='  <div style="float:left; width:100px; text-align:right; margin-right:5px; margin-top:3px;">'+t_market_new_amount+"</div>";h+='  <input style="float:left; width:100px;" type="text" id="contracts_select_pid_input" value="'+s+'" maxlength="10" onkeyup="contractsProductSelectCheck('+d+')" onchange="contractsProductSelectCheck('+d+')">';h+='  <div class="clear"></div>';h+='  <div style="margin-left:105px; margin-top:3px; text-align:left;">'+t_inner_stock+"&nbsp;"+formatNumber(m)+"</div>";h+="</div>";h+='<div style="margin-bottom:5px;">';h+='  <div style="float:left; width:100px; text-align:right; margin-right:5px; margin-top:3px;">'+t_market_price+":</div>";h+='  <input style="float:left; width:100px;" type="text" id="contracts_select_price_input" value="'+e+'" maxlength="10" onkeyup="contractsProductSelectCheck('+d+')" onchange="contractsProductSelectCheck('+d+')">';h+='  <div class="clear"></div>';if(d==0){h+='<div style="margin:5px 0px 5px -5px; padding:5px 0px; width:300px; background:#E5D194;">';var r="";if(n==1){r="checked"}h+='  <div style="margin:2px 0px;">';h+='  <input id="contracts_coins_option1" name="contracts_coins_option" onclick="contractsProductSelectCheck('+d+')" type="radio" style="float:left; margin-top:2px;" value="1" '+r+">";h+='  <div style="float:left; margin-top:1px;">'+t_market_coins_option1+"</div>";h+='  <div class="clear"></div>';h+="  </div>";var r="";if(n==2){r="checked"}h+='  <div style="margin-bottom:2px;">';h+='  <input id="contracts_coins_option2" name="contracts_coins_option" onclick="contractsProductSelectCheck('+d+')" type="radio" style="float:left; margin-top:2px;" value="2" '+r+">";h+='  <div style="float:left; margin-top:1px;">'+t_market_coins_option2+"</div>";h+='  <div class="clear"></div>';h+="  </div>";h+='  <div style="border:1px solid #000: border-radius:5px;">';h+='    <div style="margin-bottom:2px;">'+t_market_coins_option1_desc+'&nbsp;<span id="constracts_coins_option_price1"></span></div>';h+='    <div style="margin:2px 0px;">'+t_market_coins_option2_desc+'&nbsp;<span id="constracts_coins_option_price2"></span></div>';h+="  </div>";h+="</div>"}h+="</div>";h+='<button class="button_new link" style="margin:0 auto;" id="contracts_button_add_cart" onclick="contractsProductInCart('+d+')">'+t_contract_add_product+"</button>";h+="</div>";var a=contractsCheckPrice(d);if(a.min>0){h+='<div style="float:left; margin-top:0px;" id="contracts_product_min_price" class="bonusinfo">'+t_market_new_price_coins_min+"&nbsp;"+formatPrice(a.min)+"</div>"}if(a.max>0){h+='<div style="float:right; margin-top:0px;" class="bonusinfo">'+t_highest_price+":&nbsp;"+formatPrice(a.max)+"</div>"}h+='<div class="clear"></div>';h+="</div>";globalcommitbox(q,h,0,0,1);$("contracts_select_pid_input").focus();contractsProductSelectCheck(d)}}function contractsCheckFireCart(){count=0;for(var a in contracts_cart){count++}if(count>0&&$("contracts_new_cart_receiver").value!=""){showDiv("contracts_new_cart_fire")}else{hideDiv("contracts_new_cart_fire")}}function contractsFireCart(){var a=$("contracts_new_cart_receiver").value;var d="";for(var b in contracts_cart){d+=b+"_"+contracts_cart[b].amount+"_"+contracts_cart[b].price+"_"+contracts_cart[b].type+"|"}var c={name:a,cart:d};generalAction("contracts_send",c,a)}function contractsRemoveCartProduct(a){delete contracts_cart[a];contractsNewProducts();contractsNewCart()}function contractsProductInCart(b){var e=$("contracts_select_pid_input").value;var d=$("contracts_select_price_input").value;d=str_replace(",",".",d);var a=0;if(b==0){if($("contracts_coins_option1").checked==true){var c=1}if($("contracts_coins_option2").checked==true){var c=2}a=contractsCalcPrice(1)}else{var c=0}if(e>0&&d>0){contracts_cart[b]={amount:e,price:d,type:c,coin_price:a};hideDiv("globaltransp");hideDiv("globalbox");contractsNewProducts();contractsNewCart()}}function contractsProductSelectCheck(b){var h=parseInt(checkRackItem(b));if(b==0){h=user_coins}var e=$("contracts_select_pid_input").value;var d=$("contracts_select_price_input").value;if(d==""){c=0}else{d=str_replace(",",".",d);e=parseInt(e);if(isNaN(e)){e=0}if(e>h){e=h}$("contracts_select_pid_input").value=e;var a=contractsCheckPrice(b);if(a.max>0&&d>a.max){d=a.max}hideDiv("contracts_button_add_cart");if(d===undefined||!(!isNaN(parseFloat(d))&&isFinite(d))){d=0}var c=1;if(d<=0||(a.min>0&&d<a.min)){c=0;if($("contracts_product_min_price")){$("contracts_product_min_price").addClassName("important")}}else{if($("contracts_product_min_price")){$("contracts_product_min_price").removeClassName("important")}}if(a.max>0&&d>a.max){c=0}}if(c==1){showDiv("contracts_button_add_cart")}$("contracts_select_price_input").value=d;if(b==0){contractsCalcPrice()}}function contractsOverview(n){contractsNavi("overview_"+n);var h="";for(var e=0;e<contracts_data.overview[n].length;e++){var m=contracts_data.overview[n][e];var q="";var a="";var l=0;var b=0;a+='<div class="contracts_list_detail_block">';for(var d=0;d<m.data.length;d++){l+=(m.data[d].anzahl*m.data[d].preis);var r="";if(m.data[d].level){r="important";b++}q+='<div style="float:left; margin-right:4px;">';if(m.data[d].produkt==0){q+='<img src="'+imgpath+'menu/coins.gif" style="float:left; width:14px; margin-right:2px;">'}else{q+='<div style="float:left; margin-right:2px;" class="kp'+m.data[d].produkt+'"></div>'}q+='  <div class="'+r+'" style="float:left;">'+m.data[d].anzahl+"&nbsp;</div>";q+='  <div class="clear"></div>';q+="</div>";a+='<div class="contracts_list_detail_line">';if(m.data[d].produkt==0){a+='<img src="'+imgpath+'menu/coins.gif" style="float:left; width:14px; margin-right:4px;">'}else{a+='<div style="float:left; margin-right:4px;" class="kp'+m.data[d].produkt+'"></div>'}a+='  <div class="'+r+'" style="float:left;">'+m.data[d].anzahl+"x&nbsp;</div>";a+='  <div class="'+r+'" style="float:left; width:200px;">'+produkt_name[m.data[d].produkt]+"</div>";a+='  <div class="'+r+'" style="float:right; text-align:right;">'+formatPrice(m.data[d].preis)+"</div>";a+='  <div class="clear"></div>';a+="</div>"}q+='<div class="clear"></div>';a+="</div>";if(n=="in"){a+='<div style="float:left; margin:5px 0px;">'+t_contracts_show_confirm+"</div>";if(!m.own){a+='<button type="button" style="float:right; margin-top:5px;" class="link button_new" onclick="contractsBlockContact(\''+m.uname+"')\">"+t_contracts_block+"</button>"}a+='<div class="clear"></div>';if(!b&&!m.block){a+='<button type="button" style="float:left; margin-right:10px;" class="link button_new" onclick="contractsAccept('+m.vnr+')">'+t_contracts_show_confirm_yes+"</button>"}a+='<button type="button" style="float:left; margin-right:5px; color:#f00;" class="link button_new" onclick="contractsDeny('+m.vnr+')">'+t_contracts_show_confirm_no+"</button>";a+='<div class="clear"></div>'}r="";if(m.read<1){r="contracts_list_item_unread"}addclass2="";if(m.block){addclass2="important"}h+='<div class="contracts_list_item">';h+='  <div class="contracts_list_time">'+m.time+"</div>";h+='  <div class="contracts_list_contact addcontact_icon link" onclick="contractsClose(); addMessagesContact(\''+m.uname+"');\"></div>";h+='  <div class="contracts_list_contact link '+r+'" onclick="contractsClose(); messagesOpen(\''+m.uname+'\')"><img src="'+imgpath+'guild/mail.gif"></div>';h+='  <div class="contracts_list_name link '+r+'" onclick="contractsToogleDetail('+m.vnr+", '"+n+"')\">"+m.uname+"</div>";h+='  <div class="contracts_list_products">'+q+"</div>";h+='  <div class="contracts_list_price '+addclass2+'">'+formatPrice(l)+"</div>";if(m.own&&n=="out"){h+='  <div class="contracts_list_cancel link" title="'+t_contracts_show_anull+'" onclick="contractsCancel('+m.vnr+')"></div>'}h+='  <div class="clear"></div>';h+='  <div id="contracts_list_detail'+m.vnr+'" class="contracts_list_detail">'+a+"</div>";h+="</div>"}$("contracts_navi_overview_"+n+"_content").innerHTML=h}function contractsBlockContact(a){hideDiv("contracts_transp");hideDiv("contracts_main");showDiv("messages_transp");showDiv("messages_main");messagesAction("contact");$("messages_contacts_inner_right_input").value=a}function contractsToogleDetail(d,b){if($("contracts_list_detail"+d)){if($("contracts_list_detail"+d).style.display=="block"){$("contracts_list_detail"+d).style.display="none"}else{$("contracts_list_detail"+d).style.display="block"}for(var a=0;a<contracts_data.overview[b].length;a++){var h=contracts_data.overview[b][a];var e={vnr:d};if(h.vnr==d&&h.read<1){generalAction("contracts_unread",e,d)}}}}function contractsCancel(b){for(var a=0;a<contracts_data.overview.out.length;a++){var e=contracts_data.overview.out[a];var d={vnr:b};if(e.vnr==b&&e.own==1){generalAction("contracts_cancel",d,b)}}}function contractsDeny(b){for(var a=0;a<contracts_data.overview["in"].length;a++){var e=contracts_data.overview["in"][a];var d={vnr:b};if(e.vnr==b){generalAction("contracts_deny",d,b)}}}function contractsAccept(b){for(var a=0;a<contracts_data.overview["in"].length;a++){var e=contracts_data.overview["in"][a];var d={vnr:b};if(e.vnr==b){generalAction("contracts_accept",d,b)}}}function contractsShowContactsList(){var b="";for(var a=0;a<contracts_data.contacts.length;a++){b+='<div class="messages_contacts_link_item link" onclick="contractsSetName(\''+contracts_data.contacts[a].uname+"')\">"+contracts_data.contacts[a].uname+"</div>"}$("contracts_new_cart_contactlist_inner").innerHTML=b;showDiv("contracts_new_cart_contactlist")}function contractsSetName(a){$("contracts_new_cart_receiver").value=a;hideDiv("contracts_new_cart_contactlist");contractsCheckFireCart()}function contractsCalcPrice(b){var d=$("contracts_select_price_input").value;var l=(d/100)*10;var c=0;if($("contracts_coins_option1").checked==true){c=1}if($("contracts_coins_option2").checked==true){c=2}if(!c){c=1;$("contracts_coins_option1").checked=true}if(c==2){if(!isNaN(d)&&d>=coinsexchange){var a=parseInt(d);if(a<18875){var h=a-(a*(a-coinsexchange)*0.00002)}else{var h=0.25*a+7125.31}l=(((a/110)*100)/100)*10;var e=d-h;if(l>e){h=d-l}if(b){return Math.round(h)}$("constracts_coins_option_price1").innerHTML=formatPrice(Math.round(h));$("constracts_coins_option_price2").innerHTML=formatPrice(Math.round(a))}else{$("constracts_coins_option_price1").innerHTML=formatPrice(0);$("constracts_coins_option_price2").innerHTML=formatPrice(0)}}else{if(!isNaN(d)&&d>=coinsexchange){var a=parseInt(d);if(a<11844){var h=25125-Math.pow(631265625-(a/0.00002),0.5)}else{var h=4*(a-7125.31)}var e=h-a;if(l>e){h=a+l}if(b){return Math.round(a)}$("constracts_coins_option_price1").innerHTML=formatPrice(Math.round(a));$("constracts_coins_option_price2").innerHTML=formatPrice(Math.round(h))}else{$("constracts_coins_option_price1").innerHTML=formatPrice(0);$("constracts_coins_option_price2").innerHTML=formatPrice(0)}}}function contractsCheckPrice(b){var d=["e","o","fw","fla","md","breed","cow"];if(scouts&&scouts.data&&scouts.data.data){d.push("scouts")}var a={min:0,max:0};if(b==0){a.min=coinsexchange}else{if(in_array(produkt_category[b],d)){var c=produkt_price[b];if(c){a.min=Math.ceil((c-((c/100)*98))*100)/100;a.max=Math.floor(((c/100)*300)*100)/100}}else{var c=produkt_price[b];if(c){if(in_array(b,produkt_coins)){a.min=Math.ceil((c*coinsexchange)/2);a.max=0}else{a.min=Math.ceil((c-((c/100)*80))*100)/100;a.max=Math.floor(((c/100)*300)*100)/100}}}}return a}function contractsResetCart(){$("contracts_new_cart_receiver").value="";$("contracts_new_cart_template_name").value="";contracts_cart={};contracts_category="v";contractsNewCart();contractsNewProducts()}function contractsClose(){hideDiv("contracts_transp");hideDiv("contracts_main")}var cowracing=function(){this.data={};this.currentCowSlot=1;this.productionSlot=1;this.productionSelectionPage=1;this.feedSelectionPage=1;this.raceBrokenData={};this.raceRewardData={};this.raceReplayData={};this.raceReplaySimData={};this.raceReplayTimer=0;this.raceReplayRuntime=0;this.raceReplayRank=1;this.raceRankingData={};this.raceObstacles={};this.stats_cache={};this.stats_cache_delay={};this.stats_select="racepoints";this.currentPvpRanking=0;this.currentReplayView=1;this.npc_cows={};this.pvphistoryview=1;this.pvpInfo={};this.bannerEdit={};this.teamsList={};this.teamChatRuntime=0;this.teamChatMessages=[];this.raceRankingDisplayOption="player";this.currentPage=2;this.teampointsCalculatorData={members:3};this.teammemberStats=[]};cowracing.prototype.buyTeamToken=function(){cowracing.action("cowracing_buyteamtoken")};cowracing.prototype.teamInit=function(a){cowracing.action("cowracing_teaminit")};cowracing.prototype.stopDeleteTeam=function(a){cowracing.action("cowracing_stopdeleteteam")};cowracing.prototype.deleteTeam=function(a){cowracing.action("cowracing_deleteteam")};cowracing.prototype.donateTeamUpgrade=function(b){var a=$("cowracing_team_donateuprade_input").value;if(!a){return 1}cowracing.action("cowracing_donateteamupgrade",{type:b,amount:a})};cowracing.prototype.sendTeamChat=function(){var a=$("cowracing_team_chat_input").value;if(a==""||$("cowracing_team_chat_send").hasClassName("off")){return 1}cowracing.action("cowracing_sendteamchat",{msg:a})};cowracing.prototype.deleteTeamChat=function(a){cowracing.action("cowracing_deleteteamchat",{id:a})};cowracing.prototype.getTeamChat=function(a){cowracing.action("cowracing_getteamchat",{silent:a})};cowracing.prototype.getTeamMembers=function(a){cowracing.action("cowracing_getteammembers")};cowracing.prototype.joinTeam=function(a){cowracing.action("cowracing_jointeam",{id:a})};cowracing.prototype.leaveMemberTeam=function(a){cowracing.action("cowracing_leavememberteam",{id:a})};cowracing.prototype.transferMemberTeam=function(a){cowracing.action("cowracing_transfermemberteam",{id:a})};cowracing.prototype.degradeMemberTeam=function(a){cowracing.action("cowracing_degradememberteam",{id:a})};cowracing.prototype.promoteMemberTeam=function(a){cowracing.action("cowracing_promotememberteam",{id:a})};cowracing.prototype.acceptMemberTeam=function(a){cowracing.action("cowracing_acceptmemberteam",{id:a})};cowracing.prototype.kickMemberTeam=function(a){cowracing.action("cowracing_kickmemberteam",{id:a})};cowracing.prototype.getTeams=function(){cowracing.action("cowracing_getteams")};cowracing.prototype.saveTeam=function(c,a,d,b){cowracing.action("cowracing_saveteam",{name:c,tag:a,desc:d,banner:b})};cowracing.prototype.stats=function(){if($("cowracing_stats_select")){cowracing.stats_select=$("cowracing_stats_select").value}if(cowracing.stats_cache_delay[cowracing.stats_select]<=0||!cowracing.stats_cache[this.stats_select]){cowracing.action("cowracing_stats",{type:cowracing.stats_select})}else{cowracing.showStats(cowracing.stats_select)}};cowracing.prototype.speedupSuspend=function(a){cowracing.action("cowracing_speeduppvpsuspend",{slot:a})};cowracing.prototype.racesReload=function(){cowracing.action("cowracing_racesreload")};cowracing.prototype.registerCowPvP=function(){cowracing.action("cowracing_registercowpvp",{slot:cowracing.currentCowSlot})};cowracing.prototype.finishEating=function(){cowracing.action("cowracing_finisheating",{slot:cowracing.currentCowSlot})};cowracing.prototype.getRaceRanking=function(a,b){cowracing.action("cowracing_getranking",{type:a,slot:cowracing.currentCowSlot,id:b,option:cowracing.raceRankingDisplayOption})};cowracing.prototype.getRaceReplay=function(c,e,d,b,a){slot=cowracing.currentCowSlot;if(!d){d=0}if(d>0){slot=0}if(!b){b=0}if(!a){a=0}cowracing.action("cowracing_racereplay",{type:c,slot:slot,id:e,raceid:d,raceonly:b,isranking:a})};cowracing.prototype.startRace=function(a){cowracing.action("cowracing_startrace",{type:a,slot:cowracing.currentCowSlot})};cowracing.prototype.feedSpeedup=function(b,a){cowracing.action("cowracing_feedSpeedup",{slot:b,coins:a})};cowracing.prototype.feedCow=function(a){cowracing.action("cowracing_feedCow",{pid:a,slot:cowracing.currentCowSlot})};cowracing.prototype.questEntry=function(a){cowracing.action("cowracing_questentry",{pid:a,amount:parseInt($("dialog_entryline_number").value)})};cowracing.prototype.harvestProduction=function(b,a){cowracing.action("cowracing_harvestproduction",{slot:b,position:a})};cowracing.prototype.speedupProduction=function(b,a){cowracing.action("cowracing_speedupproduction",{slot:b,coins:a})};cowracing.prototype.startProduction=function(a){cowracing.action("cowracing_startproduction",{slot:cowracing.productionSlot,pid:a})};cowracing.prototype.buyPharmacist=function(){cowracing.action("cowracing_buypharmacist")};cowracing.prototype.rememberPharmacist=function(){cowracing.action("cowracing_rememberpharmacist")};cowracing.prototype.buyProductionSlot=function(a){cowracing.action("cowracing_buyproductionslot",{slot:a})};cowracing.prototype.unequipItem=function(a){cowracing.action("cowracing_unequipitem",{type:a,slot:cowracing.currentCowSlot})};cowracing.prototype.equipItem=function(a){cowracing.action("cowracing_equipitem",{id:a,slot:cowracing.currentCowSlot})};cowracing.prototype.buyItem=function(a){cowracing.action("cowracing_buyitem",{id:a,slot:cowracing.currentCowSlot})};cowracing.prototype.shredder=function(){cowracing.action("cowracing_shredder",{slot:cowracing.currentCowSlot})};cowracing.prototype.buyCow=function(a){cowracing.action("cowracing_buycow",{cow:a,slot:cowracing.currentCowSlot})};cowracing.prototype.buyCowSlot=function(a){cowracing.action("cowracing_buycowslot",{slot:a})};cowracing.prototype.init=function(){cowracing.action("cowracing_init")};cowracing.prototype.action=function(a,b){ajaxAction("farm",a,b,cowracing.response)};cowracing.prototype.response=function(d,c,h){if(in_array(c,["cowracing_getteammembers"])&&d.memberstats){cowracing.teammemberStats=d.memberstats}if(in_array(c,["cowracing_rememberpharmacist"])){return 1}if(in_array(c,["cowracing_speedupproduction","cowracing_feedSpeedup"])){global_speedup_block=0}if(in_array(c,["cowracing_questentry"])){cowracing.showQuest()}if(d.stats){cowracing.stats_cache_delay[cowracing.stats_select]=30;if(!cowracing.stats_cache[cowracing.stats_select]){cowracing.stats_cache[cowracing.stats_select]={}}cowracing.stats_cache[cowracing.stats_select]=d.stats;cowracing.showStats();return 1}if((d.replay&&h.raceonly)||in_array(c,["cowracing_getteams","cowracing_saveteam","cowracing_kickmemberteam","cowracing_acceptmemberteam","cowracing_promotememberteam","cowracing_degradememberteam","cowracing_transfermemberteam","cowracing_jointeam","cowracing_getteammembers","cowracing_getteamchat","cowracing_sendteamchat","cowracing_deleteteamchat","cowracing_donateteamupgrade","cowracing_deleteteam","cowracing_stopdeleteteam","cowracing_buyteamtoken"])){}else{cowracing.build()}if(in_array(c,["cowracing_startproduction","cowracing_speedupproduction","cowracing_harvestproduction","cowracing_buypharmacist"])){cowracing.move(3);cowracing.buildProductionSlots()}if(c=="cowracing_buyitem"){var a=cowracing.data.config.items[h.id].type;cowracing.itemShop(a)}if(in_array(c,["cowracing_getteammembers","cowracing_kickmemberteam","cowracing_acceptmemberteam","cowracing_promotememberteam","cowracing_degradememberteam","cowracing_transfermemberteam"])){cowracing.buildTeamMembers()}if(in_array(c,["cowracing_saveteam","cowracing_jointeam","cowracing_donateteamupgrade","cowracing_deleteteam","cowracing_stopdeleteteam","cowracing_buyteamtoken"])){if(d.error){if(in_array("tag",d.error)){$("cowracing_team_edit_tag").focus();showDiv("cowracing_team_edit_tag_failed")}if(in_array("name",d.error)){$("cowracing_team_edit_name").focus();showDiv("cowracing_team_edit_name_failed")}}else{hideDiv("globaltransp");hideDiv("globalbox");cowracing.buildTeam()}}if(in_array(c,["cowracing_getteamchat","cowracing_sendteamchat","cowracing_deleteteamchat"])){if(cowracing.currentPage!=1){return 1}cowracing.teamChatMessages=d.list;if(!d.silent){cowracing.buildTeamChat()}else{if($("cowracing_team_chat_input")){var b=$("cowracing_team_chat_input").value;var e=$("cowracing_team_chat_list").scrollTop;cowracing.buildTeamChat();$("cowracing_team_chat_input").value=b;$("cowracing_team_chat_input").focus();$("cowracing_team_chat_list").scrollTop=e;cowracing.checkTeamChatInput()}}if(d.unread){cowracing.data.team.user.unread=d.unread;cowracing.updateTeamNotifications()}}if(d.replay){cowracing.raceReplayData={};cowracing.raceBrokenData={};cowracing.raceRewardData={};cowracing.raceReplayData=d.replay;if(d.reward){cowracing.raceRewardData=d.reward}if(d.broken){cowracing.raceBrokenData=d.broken}cowracing.raceReplay(h.raceonly,h.isranking)}if(d.ranking){cowracing.raceRankingData=d.ranking;cowracing.raceRanking()}if(c=="cowracing_getteams"){cowracing.teamsList=d;cowracing.listTeams()}if(c=="cowracing_racesreload"){cowracing.raceSelection()}if(c=="cowracing_registercowpvp"){cowracing.raceSelection()}if(c=="cowracing_buyproductionslot"){cowracing.move(3)}if(c=="cowracing_speeduppvpsuspend"){cowracing.raceSelection()}if(c=="cowracing_teaminit"){setTimeout(function(){cowracing.move(1);cowracing.startTeamCommit()},50);setTimeout(function(){if(d.teams_first&&d.teams_first==1){}},1000)}};cowracing.prototype.build=function(){var a="";if(this.data.config.addon==1){a="addon"}var b='<div id="cowracing" class="pos2 '+a+'">';b+='<div id="cowracing_teams" class="inner1"></div>';b+='<div class="inner2">';b+='  <div id="cowracing_cowslot"></div>';b+='  <div id="cowracing_cowslots_navi" class="cowslots_navi"></div>';b+="</div>";b+='<div class="inner3">';b+='  <div id="cowracing_pharmacist" class="link" onmouseover="showDiv(\'cowracing_pharmacist_tt\')" onmouseout="hideDiv(\'cowracing_pharmacist_tt\')">';b+='    <div id="cowracing_pharmacist_timer"></div>';b+='    <div id="cowracing_pharmacist_tt" class="ttbox">';b+="      <div>"+t_pharmacist_cowracing_buy_head+'</div><div class="bonusinfo">'+t_pharmacist_cowracing_info+"</div>";b+="    </div>";b+='    <div class="cowracing_pharmacist"></div>';b+='    <div id="cowracing_pharmacist_unlocked" class="unlocked"></div>';b+="  </div>";b+='  <div id="cowracing_slots"></div>';b+="</div>";if(this.data.config.addon){var a="";if(this.data.data.firstvisitteams&&this.data.data.firstvisitteams==-1){a="pulse"}b+='<div class="scroller right2 link" onclick="cowracing.move(2)" onmouseover="showDiv(\'cowracing_scroll_cows_tt\')" onmouseout="hideDiv(\'cowracing_scroll_cows_tt\')">';b+='  <div id="cowracing_scroll_cows_tt" class="ttbox">'+t_cowracing_scroll_arrow_cows+"</div>";b+="</div>";b+='<div class="scroller left2 link '+a+'" onclick="cowracing.teamInit();" onmouseover="showDiv(\'cowracing_scroll_teams_tt\')" onmouseout="hideDiv(\'cowracing_scroll_teams_tt\')">';if(a!=""){b+='<div class="attention">'+t_new+"</div>"}b+='  <div id="cowracing_scroll_teams_tt" class="ttbox">'+t_cowracing_scroll_arrow_teams+"</div>";b+="</div>"}b+='  <div class="scroller right link" onclick="cowracing.move(3)" onmouseover="showDiv(\'cowracing_scroll_productions_tt\')" onmouseout="hideDiv(\'cowracing_scroll_productions_tt\')">';b+='    <div id="cowracing_scroll_productions_tt" class="ttbox">'+t_cowracing_scroll_arrow_productions+"</div>";b+="  </div>";b+='  <div class="scroller left link" onclick="cowracing.move(2)" onmouseover="showDiv(\'cowracing_scroll_cows_tt2\')" onmouseout="hideDiv(\'cowracing_scroll_cows_tt2\')">';b+='    <div id="cowracing_scroll_cows_tt2" class="ttbox">'+t_cowracing_scroll_arrow_cows+"</div>";b+="  </div>";b+="</div>";b+='<div id="cowracing_stats_link" class="link" onclick="cowracing.stats()"></div>';b+='<div id="cowracing_quests_link" class="link" onclick="cowracing.showQuest()"></div>';b+='<div class="mini_close link" onclick="cowracing.close()"></div>';b+='<div class="help helpbutton_blue link" onclick="cowracing.help()"></div>';$("farmersmarket_pos8_inner").innerHTML=b;showDiv("transp");showDiv("farmersmarket_pos8_inner");this.buildTeam();this.buildCowSlots();this.buildProductionSlots()};cowracing.prototype.buildCowSlots=function(){var m=["head","body","foot"];var e="";if(this.data.config.activatepvp==1){e+='<div class="trophies">';var v=["gold","silver","bronze"];for(var A=0;A<v.length;A++){if(!this.data.data.stats||this.data.data.stats["pvp_"+v[A]]<=0){continue}e+='<div class="trophy '+v[A]+'" onmouseover="showDiv(\'cowracing_trophy_'+v[A]+"_tt')\" onmouseout=\"hideDiv('cowracing_trophy_"+v[A]+"_tt')\">";e+='  <div class="count">'+this.data.data.stats["pvp_"+v[A]]+"x</div>";e+='  <div id="cowracing_trophy_'+v[A]+'_tt" class="ttbox">'+t_cowracing_trophy_name[v[A]]+"</div>";e+="</div>"}e+='  <div class="clear"></div>';e+="</div>";if(this.data.history){e+='<div id="cowracing_pvphistory_link" class="link" onclick="cowracing.showPVPHistory()" onmouseover="showDiv(\'cowracing_pvphistory_link_tt\')" onmouseout="hideDiv(\'cowracing_pvphistory_link_tt\')">';e+='  <div id="cowracing_pvphistory_link_tt" class="ttbox">'+t_cowracing_pvphistory_head+"</div>";e+="</div>"}}if(this.data.data.cows[this.currentCowSlot]){e+='<div class="topboard"><div class="front"></div></div>';var h=this.data.data.cows[this.currentCowSlot].xp;var b=this.data.data.cows[this.currentCowSlot].type;var E=this.cowLevelData(h);e+='<div class="level" onmouseover="showDiv(\'cowracing_level_tt\')" onmouseout="hideDiv(\'cowracing_level_tt\')">';e+='  <div class="inner"><div class="bar" style="width:'+Math.min(E.percent,100)+'%"></div></div>';e+='  <div class="front"></div>';e+='  <div class="number">'+E.level+"</div>";e+='  <div id="cowracing_level_tt" class="ttbox">';e+='    <div class="name line">'+this.data.data.cows[this.currentCowSlot].name+"</div>";var B=this.data.config.level[E.level].speed;B+=this.data.config.cows[b].speed;e+='    <div class="line">'+t_cowracing_cowlevel+":&nbsp;"+E.level+"</div>";e+='    <div class="basicspeed line">'+t_cowracing_basicspeed+":&nbsp;"+Math.floor(B*100)+"</div>";e+='<div class="proscons line">';e+='  <div class="block">';e+="    <div>"+t_cowracing_lane_pro+"</div>";e+='    <div class="cow_weather cow_weather_'+this.data.config.cows[b].racetype_pro+'"></div>';e+="  </div>";e+='  <div class="block">';e+="    <div>"+t_cowracing_lane_con+"</div>";e+='    <div class="cow_weather cow_weather_'+this.data.config.cows[b].racetype_con+'"></div>';e+="  </div>";e+='  <div class="clear"></div>';e+="</div>";if(this.data.config.cows[b].money_bonus>0){e+='<div class="line">'+t_pets_multi.money+":&nbsp;"+(this.data.config.cows[b].money_bonus*100)+"%</div>"}if(this.data.config.cows[b].points_bonus>0){e+='<div class="line">'+t_pets_multi.points+":&nbsp;"+(this.data.config.cows[b].points_bonus*100)+"%</div>"}if(E.maxed){e+="<div>"+t_reached_maxlevel+"</div>"}else{if(E.xpleft){e+='<div class="xpleft">'+t_cowracing_xpleft_cow.replace("%AMOUNT%",formatNumber(E.xpleft))+"</div>"}}e+="  </div>";e+="</div>";var s="cowracing.feedSelection()";var q="";if(this.data.data.cows[this.currentCowSlot].ispvp==1){s="";q='<div class="important" style="margin-top:10px;">'+t_cowracing_dont_edit_cow+"</div>"}e+='<div id="cowracing_feedbutton" class="feed link" onclick="'+s+'" onmouseover="showDiv(\'cowracing_feedbutton_tt\')" onmouseout="hideDiv(\'cowracing_feedbutton_tt\')">';e+='  <div id="cowracing_feedbutton_timer" class="timer"></div>';e+='  <div id="cowracing_feedbutton_tt" class="ttbox">'+t_cowracing_feed_cow+q+"</div>";if(this.data.data.cows[this.currentCowSlot].ispvp==1){e+='<div class="locked"></div>'}e+="</div>";var c="";var s="cowracing.raceSelection()";var n=t_cowracing_start_race;if(this.data.data.cows[this.currentCowSlot].noleague&&this.data.data.cows[this.currentCowSlot].noleague==1){s="";n=t_cowracing_noleague}e+='<div id="cowracing_racebutton" class="race link '+c+'" onclick="'+s+'" onmouseover="showDiv(\'cowracing_racebutton_tt\')" onmouseout="hideDiv(\'cowracing_racebutton_tt\')">';e+='  <div id="cowracing_racebutton_timer" class="timer"></div>';e+='  <div id="cowracing_racebutton_tt" class="ttbox">'+n+"</div>";e+="</div>";var t=["startspeed","stamina","finalsprint","athletic","luck"];e+='<div class="attributs">';for(var A=0;A<t.length;A++){var h=this.data.data.cows[this.currentCowSlot][t[A]];var z=this.data.config.cows[b][t[A]];var E=this.cowLevelData(h,z);e+='<div class="attribut attribut_'+t[A]+'" onmouseover="showDiv(\'cowracing_attribut'+t[A]+"_tt')\" onmouseout=\"hideDiv('cowracing_attribut"+t[A]+"_tt')\">";e+='  <div class="bar">';e+='    <div class="back"></div>';e+='    <div class="inner inner'+E.level+'"></div>';e+='    <div class="progress" style="width:'+Math.min(E.percent,100)+'%"></div>';e+='    <div class="block block'+(10-this.data.config.cows[this.data.data.cows[this.currentCowSlot].type][t[A]])+'"></div>';e+='    <div class="front"></div>';e+="  </div>";e+='  <div class="symbol '+t[A]+'"></div>';var c="";if(A==(t.length-1)){c="bottom"}e+='  <div id="cowracing_attribut'+t[A]+'_tt" class="ttbox '+c+'">';e+='    <div class="name">'+t_cowracing_attributs[t[A]]+"</div>";e+='    <div class="lvl">'+t_help_new_level+":&nbsp;"+E.level+"</div>";if(E.xpleft){var n=t_cowracing_xpleft.replace("%AMOUNT%",formatNumber(E.xpleft));n=n.replace("%TYPE%",t_cowracing_attributs[t[A]]);e+='<div class="xpleft">'+n+"</div>";e+='<div class="xpleft">'+t_cowracing_attribut_max+" "+this.data.config.cows[this.data.data.cows[this.currentCowSlot].type][t[A]]+"</div>"}else{e+='<div class="xpleft">'+t_cowracing_attribut_max_reached+"</div>"}e+="  </div>";e+="</div>"}e+="</div>";e+='<div class="cow cow'+this.data.data.cows[this.currentCowSlot].type+'" onmouseover="showDiv(\'cowracing_cow'+this.currentCowSlot+"_shredder')\" onmouseout=\"hideDiv('cowracing_cow"+this.currentCowSlot+"_shredder')\"></div>";if(this.data.data.cows[this.currentCowSlot]&&this.data.data.cows[this.currentCowSlot].race_remain&&this.data.data.cows[this.currentCowSlot].race_remain>0){}else{var s="cowracing.shredderCommit()";var q="";if(this.data.data.cows[this.currentCowSlot].ispvp==1){s="";q='<div class="important" style="margin-top:10px;">'+t_cowracing_dont_edit_cow+"</div>"}e+='<div id="cowracing_cow'+this.currentCowSlot+'_shredder" class="shredder link" onclick="'+s+'" onmouseover="showDiv(\'cowracing_cow'+this.currentCowSlot+"_shredder'); showDiv('cowracing_cow"+this.currentCowSlot+"_shredder_tt')\" onmouseout=\"hideDiv('cowracing_cow"+this.currentCowSlot+"_shredder'); hideDiv('cowracing_cow"+this.currentCowSlot+"_shredder_tt')\">";if(this.data.data.cows[this.currentCowSlot].ispvp==1){e+='<div class="locked"></div>'}e+='  <div id="cowracing_cow'+this.currentCowSlot+'_shredder_tt" class="ttbox">'+t_cowracing_shredder_head+q+"</div>";e+="</div>"}e+='<div class="equipslots">';for(var A=0;A<m.length;A++){var D=m[A];var C=0;var q="";var s="cowracing.itemShop('"+D+"')";if(this.data.data.cows[this.currentCowSlot].level<this.data.config.itemscowlevel){C=1;s=""}if(this.data.data.cows[this.currentCowSlot]["ispvp"]==1){C+=1;s="";q+='<div class="important">'+t_cowracing_dont_edit_cow+"</div>"}var c=D;if(this.data.data.cows[this.currentCowSlot]["slot_"+D]>0){c+=" empty"}var r="onmouseover=\"showDiv('cowracing_equipslot"+D+"');\" onmouseout=\"hideDiv('cowracing_equipslot"+D+"')\"";if(this.data.data.cows[this.currentCowSlot]["slot_"+D]>0){var d=this.data.data.cows[this.currentCowSlot]["slot_"+D];r="onmouseover=\"showDiv('cowracing_stock"+d+"'); showDiv('cowracing_unequipslot"+D+"');\" onmouseout=\"hideDiv('cowracing_stock"+d+"'); hideDiv('cowracing_unequipslot"+D+"');\""}e+='<div class="slot '+c+' link" onclick="'+s+'" '+r+">";e+='  <div id="cowracing_equipslot'+D+'" class="ttbox">';e+='    <div class="name">'+t_cowracing_equipslot_tt_head+" <b>"+t_cowracing_equipslot[D]+"</b></div>";if(this.data.data.cows[this.currentCowSlot]["ispvp"]==1){e+=q}else{if(C==1){e+='<div class="important">'+t_cowracing_equipslots_unlock.replace("%LEVEL%",this.data.config.itemscowlevel)+"</div>"}else{e+="<div>"+t_cowracing_equipslot_tt_desc+"</div>"}}e+="  </div>";if(this.data.data.cows[this.currentCowSlot]["slot_"+D]>0){var d=this.data.data.cows[this.currentCowSlot]["slot_"+D];e+='<div class="item cowitem'+this.data.data.items[d].type+'">';e+='  <div class="durability">'+this.data.data.items[d].durability+"</div>";e+='  <div id="cowracing_stock'+d+'" class="ttbox">'+this.itemTT(this.data.data.items[d].type,d)+q+"</div>";e+="</div>";e+='<div id="cowracing_unequipslot'+D+'" class="unequip button_destruct link" onclick="cowracing.unequipItem(\''+D+"'); return 1;\"></div>"}if(C==1){e+='<div class="locked"></div>'}e+="</div>"}e+='  <div class="clear"></div>';e+="</div>"}else{e+='<div class="addcow link" onclick="cowracing.cowShop()" onmouseover="showDiv(\'cowracing_addcow\')" onmouseout="hideDiv(\'cowracing_addcow\')">';e+='  <div id="cowracing_addcow" class="ttbox">'+t_cowracing_cowshop_head+"</div>";e+="</div>"}$("cowracing_cowslot").innerHTML=e;var e="";for(var A in this.data.config.cowslots){if(A>1){e+='<div class="connect"></div>'}var s="cowracing.setCowSlot("+A+")";var C=0;var w=0;var a="";if(this.data.data.cowslots[A]){}else{if(this.data.config.cowslots[A].questid>0&&this.data.data.questid<this.data.config.cowslots[A].questid){a+='<div class="important" style="margin-bottom:10px;">'+t_cowracing_cowslot_unlock.replace("%NUMBER%",this.data.config.cowslots[A].questid)+"</div>";C=1;s=""}if(this.data.config.cowslots[A].money&&this.data.config.cowslots[A].money>0){var c="";if(this.data.config.cowslots[A].money>user_bar){c="important";s=""}a+='<div class="'+c+'">'+formatPrice(this.data.config.cowslots[A].money)+"</div>";if(!C){w=1;s="cowracing.buyCowSlotCommit("+A+")"}}if(this.data.config.cowslots[A].coins&&this.data.config.cowslots[A].coins>0){var u=this.data.config.cowslots[A].coins;var l="";var r="";var E=specialbonus.findBonus({key1:"cowracing",key2:"buycowslot"});if(E&&E.buycowslot){u=(u*(1-E.buycowslot));l="color:green; font-weight:bold;";r=specialbonus.htmlBonusLine(E.buycowslot,1)}var c="";if(u>user_coins){c="important";s=""}a+='<div class="'+c+'" style="'+l+'">'+u+"&nbsp;"+t_coins+"</div>";if(r!=""){a+=r}if(!C){w=1;s="cowracing.buyCowSlotCommit("+A+")"}}}if(this.data.data.cows[A]){a="<div>"+this.data.config.cows[this.data.data.cows[A].type].name+"&nbsp;<b>"+this.data.data.cows[A].name+"</b></div>";if(this.data.data.cows[A].ispvp==1){a+='<div class="" style="margin-top:10px; font-style:italic;">'+t_cowracing_icon_ispvp+"</div>"}if(this.data.data.cows[A].suspendpvp==1){a+='<div class="" style="margin-top:10px; font-style:italic;">'+t_cowracing_icon_suspendpvp+"</div>"}}var r="onmouseover=\"showDiv('cowracing_cowslots_slot"+A+"')\" onmouseout=\"hideDiv('cowracing_cowslots_slot"+A+"')\"";if(a==""){r=""}var c="";if(this.currentCowSlot==A){c="active"}e+='<div class="slot link '+c+'" onclick="'+s+'" '+r+">";if(this.data.data.cows[A]){e+='<div class="head cowhead'+this.data.data.cows[A].type+'"></div>'}if(C>0){e+='<div class="locked"></div>'}if(w>0){e+='<div class="unlocked"></div>'}var c="";if(A>8){c="right"}e+='  <div id="cowracing_cowslots_slot'+A+'" class="ttbox '+c+'">'+a+"</div>";if(this.data.data.cows[A]&&this.data.data.cows[A].ispvp&&this.data.data.cows[A].ispvp>0){e+='<div class="ispvp"></div>'}if(this.data.data.cows[A]&&this.data.data.cows[A].suspendpvp&&this.data.data.cows[A].suspendpvp>0){e+='<div class="suspendpvp"></div>'}e+="</div>"}e+='<div class="clear"></div>';$("cowracing_cowslots_navi").innerHTML=e;for(var A=0;A<m.length;A++){if($("cowracing_unequipslot"+m[A])){$("cowracing_unequipslot"+m[A]).observe("click",function(F){F.preventDefault();F.stopPropagation();return 1})}if($("cowracing_equipslot"+m[A])){$("cowracing_equipslot"+m[A]).observe("click",function(F){F.preventDefault();F.stopPropagation();return 1})}}};cowracing.prototype.setCowSlot=function(a){this.currentCowSlot=a;this.buildCowSlots()};cowracing.prototype.buyCowSlotCommit=function(m){var e="cowracing.buyCowSlot("+m+")";var c="";if(this.data.config.cowslots[m].money&&this.data.config.cowslots[m].money>0){if(parseInt(this.data.config.cowslots[m].money)>parseInt(user_bar)){c="important"}var b=t_cowracing_cowslot_buy_body.replace("%COST%",'<span class="'+c+'">'+formatPrice(this.data.config.cowslots[m].money)+"</span>")}if(this.data.config.cowslots[m].coins&&this.data.config.cowslots[m].coins>0){var a=this.data.config.cowslots[m].coins;var l="";var h="";var d=specialbonus.findBonus({key1:"cowracing",key2:"buycowslot"});if(d&&d.buycowslot){a=(a*(1-d.buycowslot));l="color:green; font-weight:bold;";h=specialbonus.htmlBonusLine(d.buycowslot)}if(parseInt(a)>parseInt(user_coins)){c="important"}var b=t_cowracing_cowslot_buy_body.replace("%COST%",'<span class="'+c+'" style="'+l+'">'+a+"&nbsp;"+t_coins+"</span>");if(h!=""){b+=h}e="cowracing.buyCowSlotCommitCommit("+m+")"}if(c!=""){e=""}click2="hideDiv('globaltransp'); hideDiv('globalbox');";globalcommitbox(t_cowracing_cowslot_buy_head,b,e,click2)};cowracing.prototype.buyCowSlotCommitCommit=function(l){var b=this.data.config.cowslots[l].coins;var h="";var e="";var c=specialbonus.findBonus({key1:"cowracing",key2:"buycowslot"});if(c&&c.buycowslot){b=(b*(1-c.buycowslot));h="color:green; font-weight:bold;";e=specialbonus.htmlBonusLine(c.buycowslot)}var a=t_cowracing_cowslot_buy_body2.replace("%COST%",'<span style="'+h+'">'+b+"&nbsp;"+t_coins+"</span>");if(e!=""){a+=e}var d="cowracing.buyCowSlot("+l+")";globalcommitbox(t_cowracing_cowslot_buy_head,a,d)};cowracing.prototype.speedupSuspendCommit=function(d){if(!this.data.config.speedup_suspend_coins){return 1}if(this.data.config.speedup_suspend_coins&&this.data.config.speedup_suspend_coins>0){var a=t_cowracing_cowslot_speedup_suspend_body.replace("%COST%","<b>"+this.data.config.speedup_suspend_coins+"&nbsp;"+t_coins+"</b>")}var c="cowracing.speedupSuspend("+d+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.raceSelection();";globalcommitbox(t_cowracing_cowslot_speedup_suspend_head,a,c,b)};cowracing.prototype.shredderCommit=function(){var a="<div>"+t_cowracing_shredder_body+"</div>";var b="cowracing.shredder()";globalcommitbox(t_cowracing_shredder_head,a,b)};cowracing.prototype.finishEatingCommit=function(){if(!this.data.data.cows[this.currentCowSlot].feed_remain||this.data.data.cows[this.currentCowSlot].feed_remain<=0){return 1}var b=Math.ceil(this.data.data.cows[this.currentCowSlot].feed_remain/this.data.config.secondspercoin);var a=t_cowracing_speedup_eating_body.replace("%COINS%",b);var c="cowracing.finishEating()";globalcommitbox(t_cowracing_speedup_eating_head,a,c)};cowracing.prototype.feedSelection=function(){if(this.data.data.cows[this.currentCowSlot].feed_start>0&&this.data.data.cows[this.currentCowSlot].feed_remain>0){return 1}var n=((this.feedSelectionPage-1)*8)+1;var q=(this.feedSelectionPage*8);var e=0;var d='<div id="cowracing_feed_selection">';for(var b in this.data.sorted){var c=b.replace("p","");e++;var m=checkRackItem(c);var l="";var r="cowracing.feedCow("+c+")";if(!m){l="opacity:0.5;";r=""}if(e>=n&&e<=q){d+='<div class="slot" style="'+l+'" onclick="'+r+'">';d+='  <div class="img tt'+c+'"></div>';d+='  <div class="info">';d+='    <div class="name line">'+produkt_name[c]+"</div>";var h=["startspeed","stamina","finalsprint","athletic","luck"];for(var a=0;a<h.length;a++){if(this.data.config.products[c]["xp_"+h[a]]){d+='<div class="block line">';d+='  <div class="minisymbol '+h[a]+'" onmouseover="showDiv(\'cowracing_feed_selection_'+c+"_"+h[a]+"_tt')\" onmouseout=\"hideDiv('cowracing_feed_selection_"+c+"_"+h[a]+"_tt')\">";d+='    <div id="cowracing_feed_selection_'+c+"_"+h[a]+'_tt" class="ttbox">'+t_cowracing_attributs[h[a]]+"</div>";d+="  </div>";d+='  <div class="attr">+'+this.data.config.products[c]["xp_"+h[a]]+"</div>";d+='  <div class="clear"></div>';d+="</div>"}}d+='    <div class="clear"></div>';d+="    <div>"+t_cowracing_feedduration.replace("%TIME%",formatTime(this.data.config.products[c].feeding_duration))+"</div>";d+="  </div>";d+='  <div class="amount">'+m+"</div>";d+="</div>"}}d+='  <div class="clear"></div>';d+='  <div id="cowracing_feed_selection_navi_up" onclick="cowracing.feedSelectionNavi(-1, '+e+')"></div>';d+='  <div id="cowracing_feed_selection_navi_down" onclick="cowracing.feedSelectionNavi(1, '+e+')"></div>';d+="</div>";globalBoxFlex(t_cowracing_feed_selection_head,d,0,0,1);$("globalbox").style.top="40px";this.feedSelectionNavi(0,e)};cowracing.prototype.feedSelectionNavi=function(b,c){var a=parseInt(Math.ceil(c/8));this.feedSelectionPage+=b;if(this.feedSelectionPage<1){this.feedSelectionPage=1}if(this.feedSelectionPage>a){this.feedSelectionPage=a}if(b){this.feedSelection()}hideDiv("cowracing_feed_selection_navi_up");hideDiv("cowracing_feed_selection_navi_down");if(this.feedSelectionPage>1){showDiv("cowracing_feed_selection_navi_up")}if(this.feedSelectionPage<a){showDiv("cowracing_feed_selection_navi_down")}};cowracing.prototype.buildProductionSlots=function(){var a="";for(var b=1;b<=4;b++){a+=production.buildSlot("cowracing",b)}$("cowracing_slots").innerHTML=a;this.timerUpdate()};cowracing.prototype.updateProductionSlot=function(b,a){production.updateSlot("cowracing",b,a,this.data)};cowracing.prototype.getCurrentProductionPosition=function(a){return production.currentQueueSlot("cowracing",a)};cowracing.prototype.buyProductionSlotCommit=function(a){production.buySlotCommit("cowracing",a,this.data.data.slots[a])};cowracing.prototype.buyPharmacistCommit=function(a){production.buyQueueCommit("cowracing",a)};cowracing.prototype.productionSelectionCommit=function(b){var d="cowracing.startProduction("+b+")";var c="cowracing.productionSelection()";var a='<div id="cowracing_production_selection_commit">';a+='  <div class="img tt'+b+'"></div>';a+='  <div class="name">'+produkt_name[b]+"</div>";if(this.data.config.products[b].money&&this.data.config.products[b].money>0){var e=formatPrice(this.data.config.products[b].money)}if(this.data.config.products[b].coins&&this.data.config.products[b].coins>0){var e=this.data.config.products[b].coins+"&nbsp;"+t_coins}a+="  <div>"+cityadcost+e+"</div>";a+="</div>";globalcommitbox(t_start_production,a,d,c)};cowracing.prototype.productionSelection=function(s){if(!s){s=this.productionSlot}else{this.productionSlot=s}var t=((this.productionSelectionPage-1)*4)+1;var u=(this.productionSelectionPage*4);var m=0;var l='<div id="cowracing_production_selection">';var q=0;if(specialbonus){q=specialbonus.findBonus({key1:"cowracing",key2:"harvest"})}for(var a in this.data.sorted){var h=a.replace("p","");m++;if(m>=t&&m<=u){var e=0;var w="cowracing.productionSelectionCommit("+h+")";if(this.data.config.products[h].quest&&this.data.config.products[h].quest>this.data.data.questid){w="";e=1}for(var c in this.data.config.products[h].needs){var d=checkRackItem(c);if(this.data.config.products[h].needs[c]>d){w=""}}l+='<div class="slot" onclick="'+w+'">';l+='  <div class="img tt'+h+'"></div>';l+='  <div class="info">';var d=this.data.config.products[h].amount;var v="";var r="";if(q&&q.harvest){d+=q.harvest;v='<div style="color:green; font-weight:normal;">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+q.harvest)+")</div>";r="specialbonus"}l+='    <div class="name line '+r+'">'+d+"x "+produkt_name[h]+v+"</div>";if(e){l+='<div class="important">'+t_cowracing_cowslot_unlock.replace("%NUMBER%",this.data.config.products[h].quest)+"</div>"}else{l+='<div class="line">'+t_points+":&nbsp;"+produkt_points[h]+"</div>";var n=["startspeed","stamina","finalsprint","athletic","luck"];for(var c=0;c<n.length;c++){if(this.data.config.products[h]["xp_"+n[c]]){l+='<div class="block">';l+='  <div class="minisymbol '+n[c]+'" onmouseover="showDiv(\'cowracing_production_selection_'+h+"_"+n[c]+"_tt')\" onmouseout=\"hideDiv('cowracing_production_selection_"+h+"_"+n[c]+"_tt')\">";l+='    <div id="cowracing_production_selection_'+h+"_"+n[c]+'_tt" class="ttbox">'+t_cowracing_attributs[n[c]]+"</div>";l+="  </div>";l+='  <div class="attr">+'+this.data.config.products[h]["xp_"+n[c]]+"</div>";l+='  <div class="clear"></div>';l+="</div>"}}l+="</div>";l+='<div class="clear"></div>'}if(!e){var r="";if(this.data.config.products[h].money&&this.data.config.products[h].money>0){if(this.data.config.products[h].money>user_bar){r="important";block=1}var b=formatPrice(this.data.config.products[h].money)}if(this.data.config.products[h].coins&&this.data.config.products[h].coins>0){if(this.data.config.products[h].coins>user_coins){r="important";block=1}var b=this.data.config.products[h].coins+"&nbsp;"+t_coins}l+='<div class="needs">';l+='  <div class="intro">'+t_needs+":</div>";l+='  <div class="intro_block">';l+="     <div>"+formatTime(produkt_zeit[h])+"</div>";l+='     <div class="cost '+r+'">'+b+"</div>";l+="  </div>";l+='  <div class="clear"></div>';for(var c in this.data.config.products[h].needs){var d=checkRackItem(c);var r="";if(this.data.config.products[h].needs[c]>d){r="important"}l+='<div class="product '+r+'" onmouseover="showDiv(\'cowracing_productionselection_pid'+h+"_"+c+"')\" onmouseout=\"hideDiv('cowracing_productionselection_pid"+h+"_"+c+"')\">";l+='  <div class="l'+c+'" style="border-radius:5px;"></div>';l+='  <div style="font-weight:bold;">'+this.data.config.products[h].needs[c]+"x</div>";l+='  <div id="cowracing_productionselection_pid'+h+"_"+c+'" class="ttbox">'+produkt_name[c]+"</div>";l+="</div>"}}l+="</div>";if(e){l+='<div class="locked"></div>'}l+="</div>"}}l+='  <div class="clear"></div>';l+='  <div id="cowracing_production_selection_navi_up" onclick="cowracing.productionSelectionNavi(-1, '+m+')"></div>';l+='  <div id="cowracing_production_selection_navi_down" onclick="cowracing.productionSelectionNavi(1, '+m+')"></div>';l+="</div>";globalBoxFlex(t_choose_to_produce,l,0,0,1);$("globalbox").style.top="40px";this.productionSelectionNavi(0,m)};cowracing.prototype.productionSelectionNavi=function(b,c){var a=parseInt(Math.ceil(c/4));this.productionSelectionPage+=b;if(this.productionSelectionPage<1){this.productionSelectionPage=1}if(this.productionSelectionPage>a){this.productionSelectionPage=a}if(b){this.productionSelection()}hideDiv("cowracing_production_selection_navi_up");hideDiv("cowracing_production_selection_navi_down");if(this.productionSelectionPage>1){showDiv("cowracing_production_selection_navi_up")}if(this.productionSelectionPage<a){showDiv("cowracing_production_selection_navi_down")}};cowracing.prototype.cowShop=function(){var e='<div id="cowracing_cowshop">';var h=1;for(var n in this.data.config.cows){var c=0;var r="cowracing.cowShopBuyCommit("+n+")";if(this.data.config.cows[n].unlock){var l=0;if(this.data.data.champions){for(var b=0;b<this.data.config.cows[n].unlock.length;b++){if(this.data.data.champions[this.data.config.cows[n].unlock[b]]){l=1}}}if(!l){c=1;r=""}}var q="";if(h>10){q="bottom"}e+='<div class="slot link '+q+'" onclick="'+r+'" onmouseover="showDiv(\'cowracing_cowshop_cow'+n+"_tt')\" onmouseout=\"hideDiv('cowracing_cowshop_cow"+n+"_tt')\">";e+='  <div class="head cowhead'+n+'"></div>';if(c){e+='<div class="locked"></div>'}var q="";if(n%5==0){q="right"}e+='  <div id="cowracing_cowshop_cow'+n+'_tt" class="ttbox '+q+'">';e+='    <div class="name line">'+this.data.config.cows[n].name+"</div>";e+='    <div class="speed line">'+t_cowracing_attributs.speed+":&nbsp;"+Math.floor(this.data.config.cows[n].speed*100)+"</div>";var m=["startspeed","stamina","finalsprint","athletic","luck"];for(var b=0;b<m.length;b++){e+='<div class="line">';e+='  <div class="category">'+t_cowracing_attributs[m[b]]+":</div>";for(var a=1;a<=10;a++){var q="";if(this.data.config.cows[n][m[b]]<a){q="block"}e+='<div class="point '+q+'"></div>'}e+='  <div class="clear"></div>';e+="</div>"}e+='<div class="proscons">';e+='  <div class="block">';e+="    <div>"+t_cowracing_lane_pro+"</div>";e+='    <div class="cow_weather cow_weather_'+this.data.config.cows[n].racetype_pro+'"></div>';e+="  </div>";e+='  <div class="block">';e+="    <div>"+t_cowracing_lane_con+"</div>";e+='    <div class="cow_weather cow_weather_'+this.data.config.cows[n].racetype_con+'"></div>';e+="  </div>";e+='  <div class="clear"></div>';e+="</div>";if(this.data.config.cows[n].money_bonus>0){e+='<div class="line">'+t_pets_multi.money+":&nbsp;"+(this.data.config.cows[n].money_bonus*100)+"%</div>"}if(this.data.config.cows[n].points_bonus>0){e+='<div class="line">'+t_pets_multi.points+":&nbsp;"+(this.data.config.cows[n].points_bonus*100)+"%</div>"}if(c){var d="";for(var b=0;b<this.data.config.cows[n].unlock.length;b++){if(b>0){d+=", "}d+=this.data.config.cows[this.data.config.cows[n].unlock[b]].name}e+='<div class="important" style="margin-top:10px;">'+t_cowracing_cowshop_unlock.replace("%COW%",d)+"</div>"}e+='    <div style="margin-top:10px;">'+formatPrice(this.data.config.cows[n].money)+"</div>";e+="  </div>";e+="</div>";h++}e+='<div class="clear"></div>';globalBoxFlex(t_cowracing_cowshop_head,e,0,0,1)};cowracing.prototype.cowShopBuyCommit=function(b){var a='<div id="cowracing_cowshop_commit">';a+='<div class="slot">';a+='  <div class="head cowhead'+b+'"></div>';a+="</div>";a+='<div class="name">'+this.data.config.cows[b].name+"</div>";a+="<div>"+t_cowracing_cowshop_body.replace("%COST%",formatPrice(this.data.config.cows[b].money))+"</div>";var c="cowracing.buyCow("+b+")";globalcommitbox(t_cowracing_cowshop_head,a,c,"cowracing.cowShop()")};cowracing.prototype.itemShop=function(m){var c='<div id="cowracing_itemshop">';c+='  <div class="stock">';c+='    <div class="head">'+t_cowracing_itemshop_head_stock+"</div>";c+='    <div class="desc">'+t_cowracing_itemshop_head_stock_desc+"</div>";c+='    <div class="slots">';var d=1;if(!this.data.data.items){}else{for(var b in this.data.data.items){var h=this.data.config.items[this.data.data.items[b].type].type;if(h!=m||this.data.data.items[b].stock==0){continue}var r="cowracing.equipItem("+b+")";c+='<div class="slot link" onclick="'+r+'" onmouseover="showDiv(\'cowracing_itemshop_stockitem'+b+"_tt')\" onmouseout=\"hideDiv('cowracing_itemshop_stockitem"+b+"_tt')\">";c+='  <div class="item cowitem'+this.data.data.items[b].type+'"></div>';c+='  <div class="durability">'+this.data.data.items[b].durability+"</div>";var n="";if(d%3==0){n="right"}c+='  <div id="cowracing_itemshop_stockitem'+b+'_tt" class="ttbox '+n+'">'+t_cowracing_equipslot_item_tt_desc+"</div>";c+="</div>";if(d==3){d=0}d++}}c+='      <div class="clear"></div>';c+="    </div>";c+="  </div>";c+='  <div class="shop">';c+='    <div class="head">'+t_cowracing_itemshop_head_shop+"</div>";c+='    <div class="desc">'+t_cowracing_itemshop_head_shop_desc+"</div>";var d=1;for(var b in this.data.config.items){if(this.data.config.items[b].type!=m){continue}var r="cowracing.itemShopBuyCommit("+b+")";var n="";var a="";if(this.data.config.items[b].money&&this.data.config.items[b].money>0){if(parseInt(this.data.config.items[b].money)>parseInt(user_bar)){n="important";r=""}a+='<span class="'+n+'">'+formatPrice(this.data.config.items[b].money)+"</span>"}if(this.data.config.items[b].coins&&this.data.config.items[b].coins>0){var s=this.data.config.items[b].coins;var e="";var q="";var l=specialbonus.findBonus({key1:"cowracing",key2:"buyshopitem"});if(l&&l.buyshopitem){s=Math.ceil(s*(1-l.buyshopitem));e="color:green; font-weight:bold;"}if(parseInt(s)>parseInt(user_coins)){n="important";r=""}a+='<span class="'+n+'" style="'+e+'">'+s+"&nbsp;"+t_coins+"</span>";if(q!=""){a+=q}}var n="right";c+='<div class="slot link" onclick="'+r+'" onmouseover="showDiv(\'cowracing_itemshop_item'+b+"_tt')\" onmouseout=\"hideDiv('cowracing_itemshop_item"+b+"_tt')\">";c+='  <div class="price">'+a+"</div>";c+='  <div class="item cowitem'+b+'"></div>';c+='  <div id="cowracing_itemshop_item'+b+'_tt" class="ttbox '+n+'">'+this.itemTT(b)+"</div>";c+="</div>";d++}c+="  </div>";c+='  <div class="clear"></div>';c+="</div>";globalBoxFlex("",c,0,0,1);$("globalbox").style.top="40px"};cowracing.prototype.itemShopBuyCommit=function(d){var b='<div id="cowracing_itemshop_commit">';b+='<div class="slot">';b+='  <div class="item cowitem'+d+'"></div>';b+="</div>";b+='<div class="name">'+this.data.config.items[d].name+"</div>";if(this.data.config.items[d].money&&this.data.config.items[d].money>0){b+="<div>"+t_cowracing_itemshop_buy_body.replace("%COST%",formatPrice(this.data.config.items[d].money))+"</div>"}if(this.data.config.items[d].coins&&this.data.config.items[d].coins>0){var a=this.data.config.items[d].coins;var l="color:green; font-weight:bold;";var h="";var c=specialbonus.findBonus({key1:"cowracing",key2:"buyshopitem"});if(c&&c.buyshopitem){a=Math.ceil(a*(1-c.buyshopitem));l="color:green; font-weight:bold;";h=specialbonus.htmlBonusLine(c.buyshopitem)}b+="<div>"+t_cowracing_itemshop_buy_body.replace("%COST%",'<span style="'+l+'">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";if(h!=""){b+=h}}var e="cowracing.buyItem("+d+")";globalcommitbox(t_cowracing_itemshop_buy_head,b,e,"cowracing.itemShop('"+this.data.config.items[d].type+"')")};cowracing.prototype.showQuest=function(){htmlQuestBox("cowracing");this.timerUpdate()};cowracing.prototype.questEntryCommit=function(c){for(var h in this.data.quest.products){if(h==c){var d=this.data.quest.products[c];if(this.data.quest.data&&this.data.quest.data[c]){var d=(d-this.data.quest.data[c])}break}}var a=checkRackItem(c);var b="kp"+c;if(a>d){a=d}var e={pid:c};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(e),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("cowracing.checkQuestEntry("+c+", "+d+")");$("dialog_entryline_number").onkeyup=new Function("cowracing.checkQuestEntry("+c+", "+d+")");this.checkQuestEntry(c,d)};cowracing.prototype.checkQuestEntry=function(a,c){var e=checkRackItem(a);var b="product";var d={type:b,stockamount:e,rest:c,click:"cowracing.questEntry("+a+")"};checkEntryLine(d)};cowracing.prototype.timer=function(){this.teamChatRuntime++;if(this.data){if(this.data.team){if(this.data.config&&this.data.config.addon==1&&$("farmersmarket_pos8_inner").style.display=="block"&&this.teamChatRuntime%this.data.config.constants.chatinterval==0){}if(this.data.team.closedate>0){this.data.team.closeremain--;if($("cowracing_team_close_timer")){$("cowracing_team_close_timer").innerHTML=formatTime(this.data.team.closeremain)}if(this.data.team.closeremain<=0){this.data.team=0;this.init()}}}if(this.data.data){if(this.data.data.team_leave_cooldown){this.data.data.team_leave_cooldown--;if($("cowracing_team_start_commit_leavecooldown")){$("cowracing_team_start_commit_leavecooldown").innerHTML=formatTime(this.data.data.team_leave_cooldown);if(this.data.data.team_leave_cooldown==0){this.startTeamCommit()}}}if(this.data.data.queue_remain){this.data.data.queue_remain--;if($("cowracing_pharmacist")){showDiv("cowracing_pharmacist");var a="cowracing.buyPharmacistCommit()";if(this.data.data.queue_remain>0){$("cowracing_pharmacist_timer").innerHTML=formatTime(this.data.data.queue_remain);showDiv("cowracing_pharmacist_timer");a=""}else{hideDiv("cowracing_pharmacist_timer")}var c=0;for(var d=1;d<=4;d++){var m=0;var l=0;for(var b=1;b<=3;b++){if(this.data.production[d]&&this.data.production[d][b]){l++}}if(this.data.data.queue_remain<=0&&(!l||l<=1)){hideDiv("cowracing_pharmacist_slots"+d)}else{c++;showDiv("cowracing_pharmacist_slots"+d)}for(var b=1;b<=3;b++){if(this.data.production[d]&&this.data.production[d][b]){var s=this.getCurrentProductionPosition(d);m+=parseInt(this.data.production[d][b].duration);var e="harvest";t="cowracing.harvestProduction("+d+", "+b+")";if(this.data.production[d]["gone"]<m){e="next";var t=""}if(s==b&&this.data.production[d]["gone"]<m){e="running";var t=""}$("cowracing_pharmacist_slot_img"+d+"_"+b).className="cowracing_pharmacist_slot_img tt"+this.data.production[d][b].pid;$("cowracing_pharmacist_slot_status"+d+"_"+b).className="cowracing_pharmacist_slot_status "+e;var n=produkt_name[this.data.production[d][b].pid]}else{if(this.data.data.queue_remain>0){var t="cowracing.productionSelection("+d+")";var n=t_pharmacist_free_slot}else{var t="";var n=t_pharmacist_cowracing_free_slot_block}}$("cowracing_pharmacist_slot_tt"+d+"_"+b).innerHTML=n;$("cowracing_pharmacist_slot"+d+"_"+b).onclick=new Function(t)}}if(c>0){$("cowracing_slots").className="cowracing_production_slots_spacer";for(var h=1;h<=4;h++){$("cowracing_productionslot"+h).className="slot cowracing_production_slot_spacer"}}else{$("cowracing_slots").className="cowracing_production_slots_normal"}$("cowracing_pharmacist").onclick=new Function(a)}}for(var r=1;r<=4;r++){var q=this.getCurrentProductionPosition(r);if(this.data.production[r]){this.data.production[r]["gone"]++;if(this.data.production[r][q]){this.data.production[r][q].remain--}}if(this.data.data.slots&&this.data.data.slots[r]&&this.data.data.slots[r].rent_remain){this.data.data.slots[r].rent_remain--;if(!this.data.data.slots[r].rent_remain){this.data.data.slots[r].rent_remain--}}}for(var r in this.data.data.cows){if(this.data.data.cows[r].feed_start>0){this.data.data.cows[r].feed_remain--;if($("cowracing_feedbutton")&&r==this.currentCowSlot){if(this.data.data.cows[r].feed_remain<=0){$("cowracing_feedbutton_timer").innerHTML="";hideDiv("cowracing_feedbutton_timer")}else{$("cowracing_feedbutton_timer").innerHTML=formatTime(this.data.data.cows[r].feed_remain);showDiv("cowracing_feedbutton_timer")}}}if(this.data.data.cows[r].race_remain){this.data.data.cows[r].race_remain--;if($("cowracing_racebutton")&&r==this.currentCowSlot){if(this.data.data.cows[r].race_remain<=0){$("cowracing_racebutton_timer").innerHTML="";hideDiv("cowracing_racebutton_timer")}else{$("cowracing_racebutton_timer").innerHTML=formatTime(this.data.data.cows[r].race_remain);showDiv("cowracing_racebutton_timer")}}if($("cowracing_raceselection_startrace")&&r==this.currentCowSlot){if(this.data.data.cows[r].race_remain<=0){$("cowracing_raceselection_startrace_timer").innerHTML="";hideDiv("cowracing_raceselection_startrace_timer");hideDiv("cowracing_raceselection_startrace_locked");if(this.data.data.cows[r].ispvp==1){showDiv("cowracing_raceselection_startrace_locked")}else{$("cowracing_raceselection_startrace").removeClassName("grayscale");$("cowracing_raceselection_startrace").onclick=new Function("cowracing.startRace('pve')")}}else{$("cowracing_raceselection_startrace_timer").innerHTML=formatTime(this.data.data.cows[r].race_remain);showDiv("cowracing_raceselection_startrace_timer");showDiv("cowracing_raceselection_startrace_locked");$("cowracing_raceselection_startrace").onclick=new Function("")}}}}if(this.data.quest&&this.data.quest.remain){this.data.quest.remain--}for(var h in this.stats_cache_delay){this.stats_cache_delay[h]--}}if(this.data.pvp){if(this.data.pvp.racedayremain){this.data.pvp.racedayremain--}else{if(this.data.pvp.racedayremain==0){this.data.pvp.racedayremain--;if($("cowracing_raceselection")&&$("farmersmarket_pos8_inner").style.display=="block"){cowracing.raceSelection()}}}if(this.data.pvp.startremain){this.data.pvp.startremain--}else{if(this.data.pvp.startremain==0){this.data.pvp.startremain--;if($("cowracing_raceselection")&&$("farmersmarket_pos8_inner").style.display=="block"){cowracing.raceSelection()}}}}this.timerUpdate()}};cowracing.prototype.timerUpdate=function(){production.buildOuterProductionLine("cowracing");if($("cowracing")){for(var b=1;b<=4;b++){var a=this.getCurrentProductionPosition(b);this.updateProductionSlot(b,a)}if(this.data.quest&&!this.data.quest.end){if(this.data.quest.remain>0){showDiv("cowracing_quest_timer");hideDiv("cowracing_quest_data");if($("cowracing_quest_timer")){$("cowracing_quest_timer").innerHTML=formatTime(this.data.quest.remain)}}else{hideDiv("cowracing_quest_timer");showDiv("cowracing_quest_data")}}if(this.data.pvp){if($("cowracing_pvp_timer")&&this.data.pvp.startremain&&this.data.pvp.startremain>0){$("cowracing_pvp_timer").innerHTML=formatTime(this.data.pvp.startremain)}if($("cowracing_pvp_racetimer")&&this.data.pvp.racedayremain&&this.data.pvp.racedayremain>0){$("cowracing_pvp_racetimer").innerHTML=formatTime(this.data.pvp.racedayremain)}}}this.checkRememberPVP()};cowracing.prototype.checkRememberPVP=function(){var c=0;if(this.data&&this.data.data&&this.data.data.cows){for(var h in this.data.data.cows){if(this.data.data.cows[h]&&this.data.data.cows[h].type){c++}}}if(!c){return 1}if(this.data&&this.data.data&&this.data.data.remember_pvp){if($("cowracing_remember_pvp_marker")){$("cowracing_remember_pvp_marker").remove()}if($("cowracing_racebutton")){$("cowracing_racebutton").removeClassName("pvpmarker");if($("cowracing_racebutton_tt_remember_pvp")){$("cowracing_racebutton_tt_remember_pvp").remove()}}if($("cowracing_startrace_pvp")){$("cowracing_startrace_pvp").removeClassName("pvpmarker");if($("cowracing_startrace_tt_pvp_remember_pvp")){$("cowracing_startrace_tt_pvp_remember_pvp").remove()}}if(this.data.pvp&&this.data.pvp.is_pvp){var e=0;var d=[];for(var h in this.data.data.cows){if(this.data.data.cows[h].ispvp>0){e++}if(this.data.data.cows[h].suspendpvp>0){continue}if(this.data.data.cows[h].leaguepoints>=this.npc_cows["npc_cows_"+this.data.data.cows[h].type]["1"].points){d.push(h)}}if(!e&&d.length>0){e=0;if(this.data.pvp.competitors.length){for(var b=0;b<this.data.pvp.competitors.length;b++){if(this.data.pvp.competitors[b]&&this.data.pvp.competitors[b].self){e++}}}if(e>0){if($("farmersmarket_pos8")&&!$("cowracing_remember_pvp_marker")){var a='<div id="cowracing_remember_pvp_marker" onmouseover="showDiv(\'cowracing_remember_pvp_marker_tt\')" onmouseout="hideDiv(\'cowracing_remember_pvp_marker_tt\')">';a+='  <div id="cowracing_remember_pvp_marker_tt" class="ttbox">'+t_cowracing_remember_pvp+"</div>";a+="</div>";$("farmersmarket_pos8").insert(a)}if($("cowracing_racebutton")){$("cowracing_racebutton").addClassName("pvpmarker");var a='<div id="cowracing_racebutton_tt_remember_pvp" style="margin-top:10px;">'+t_cowracing_remember_pvp+"</div>";$("cowracing_racebutton_tt").insert(a)}if(in_array(this.currentCowSlot,d)&&$("cowracing_startrace_pvp")){$("cowracing_startrace_pvp").addClassName("pvpmarker");var a='<div id="cowracing_startrace_tt_pvp_remember_pvp" style="margin-top:10px;">'+t_cowracing_remember_pvp+"</div>";$("cowracing_startrace_tt_pvp").insert(a)}}}}}};cowracing.prototype.raceSelection=function(){var c='<div id="cowracing_raceselection">';c+='  <div class="inner pve">';c+='    <div class="headline">'+t_cowracing_pve_head+"</div>";c+='    <div class="desc">'+t_cowracing_pve_desc+"</div>";c+="    <div>"+t_cowracing_league_current_rank+"</div>";c+='    <div class="rank">'+this.data.data.cows[this.currentCowSlot].ladder.rank+"</div>";c+="    <div>"+t_cowracing_league_next_race+"</div>";var a=this.data.data.cows[this.currentCowSlot].ladder.lanestatus;var d=this.data.data.cows[this.currentCowSlot].ladder.obstacle_count;if(this.data.data.cows[this.currentCowSlot].lanestatus!=""){a=this.data.data.cows[this.currentCowSlot].lanestatus;d=this.data.data.cows[this.currentCowSlot].obstacle_count}c+='    <div class="nextrace_info">';c+='      <div class="cow_weather cow_weather_'+a+'"></div>';c+='      <div class="cow_obstacle"><div class="amount">'+d+"x</div></div>";c+='      <div class="clear"></div>';c+="    </div>";var t="cowracing.getRaceReplay('pve', "+this.currentCowSlot+")";var s="";if(!this.data.data.cows[this.currentCowSlot].lastraceid){t=""}var l="";var n="cowracing.startRace('pve')";var r="";if(this.data.data.cows[this.currentCowSlot].ispvp==1){n="";l='<div style="margin-top:10px;" class="important">'+t_cowracing_dont_edit_cow+"</div>"}c+='    <div id="cowracing_raceselection_startrace" class="start '+r+'" onclick="'+n+'" onmouseover="showDiv(\'cowracing_startrace_tt\')" onmouseout="hideDiv(\'cowracing_startrace_tt\')">';c+='      <div id="cowracing_startrace_tt" class="ttbox">'+t_cowracing_race_start+l+"</div>";c+='      <div id="cowracing_raceselection_startrace_timer" class="timer"></div>';c+='      <div id="cowracing_raceselection_startrace_locked" class="locked"></div>';c+="    </div>";c+='    <div class="ranking" onclick="cowracing.getRaceRanking(\'pve\')" onmouseover="showDiv(\'cowracing_startrace_ranking_tt\')" onmouseout="hideDiv(\'cowracing_startrace_ranking_tt\')">';c+='      <div id="cowracing_startrace_ranking_tt" class="ttbox">'+t_cowracing_race_ranking+"</div>";c+="    </div>";c+='    <div class="replay '+s+'" onclick="'+t+'" onmouseover="showDiv(\'cowracing_replay_ranking_tt\')" onmouseout="hideDiv(\'cowracing_replay_ranking_tt\')">';c+='      <div id="cowracing_replay_ranking_tt" class="ttbox">'+t_cowracing_last_race_replay+"</div>";c+="    </div>";c+='    <div class="clear"></div>';c+='    <div class="imgblock"><div class="img pve"></div></div>';c+="  </div>";c+='  <div class="inner pvp">';c+='    <div class="headline">'+t_cowracing_pvp_head+"</div>";c+='    <div class="desc">'+t_cowracing_pvp_desc+"</div>";if(this.data.config.activatepvp==1){if(this.data.pvp.startremain&&this.data.pvp.startremain>0){c+="<div>"+t_cowracing_pvp_startremain+"</div>";c+='<div id="cowracing_pvp_timer"></div>'}else{c+="<div>"+t_cowracing_league_current_rank+"</div>";var b="-";if(this.data.pvp.rank&&this.data.pvp.rank>0){b=this.data.pvp.rank}c+='<div class="rank">'+b+"</div>";if(this.npc_cows["npc_cows_"+this.data.data.cows[this.currentCowSlot].type]["1"].points>this.data.data.cows[this.currentCowSlot].leaguepoints){c+='<div class="important" style="margin:25px 0px;">'+t_cowracing_pvp_register_cow_blocked+"</div>"}else{var h="<b>("+this.data.pvp.day+"/"+this.data.config.pvp_days+")</b>";c+='<div class="raceday">'+t_cowracing_pvp_nextrace.replace("%CURRENT%",h)+"</div>";var a=this.data.pvp.lanestatus;var d=this.data.pvp.obstacle_count;c+='<div class="nextrace_info">';c+='  <div class="cow_weather cow_weather_'+a+'"></div>';c+='  <div class="cow_obstacle"><div class="amount">'+d+"x</div></div>";c+='  <div class="clear"></div>';c+="</div>";if(this.data.pvp.racedayremain>0){u=0;for(var q in this.data.data.cows){if(this.data.data.cows[q].ispvp==1){u=q}}var s="";var t="cowracing.registerCowPvPCommit()";var e=t_cowracing_pvp_register_cow.replace("%NAME%",this.data.data.cows[this.currentCowSlot].name);if(u>0){s="slot";e="<div>"+t_cowracing_pvp_register_registered.replace("%NAME%","<b>"+this.data.data.cows[u].name+"</b>")+"</div>";if(u!=this.currentCowSlot){e+='<div style="margin-top:10px;">'+t_cowracing_pvp_register_change.replace("%NAME%","<b>"+this.data.data.cows[this.currentCowSlot].name+"</b>")+"</div>"}else{t=""}}if(this.data.data.cows[this.currentCowSlot].suspendpvp>0){e='<div class="important" style="margin:25px 0px;">'+t_cowracing_pvp_register_cow_blocked2+"</div>";t=""}c+='    <div id="cowracing_startrace_pvp" class="start '+s+'" onclick="'+t+'" onmouseover="showDiv(\'cowracing_startrace_tt_pvp\')" onmouseout="hideDiv(\'cowracing_startrace_tt_pvp\')">';if(u>0){c+='<div class="cowhead cowhead'+this.data.data.cows[u].type+'"></div>'}c+='      <div id="cowracing_startrace_tt_pvp" class="ttbox">'+e+"</div>";c+='      <div id="cowracing_raceselection_startrace_pvp_locked" class="locked"></div>';c+="    </div>";if(this.data.data.cows[this.currentCowSlot].suspendpvp>0){c+='<div class="link suspendpvp" onclick="cowracing.speedupSuspendCommit('+this.currentCowSlot+')" onmouseover="showDiv(\'cowracing_raceselection_suspendpvp_tt\')" onmouseout="hideDiv(\'cowracing_raceselection_suspendpvp_tt\')">';c+='  <div id="cowracing_raceselection_suspendpvp_tt" class="ttbox">'+t_cowracing_cowslot_speedup_suspend_head+"</div>";c+="</div>"}c+='    <div class="ranking" onclick="cowracing.getRaceRanking(\'pvp\', 0)" onmouseover="showDiv(\'cowracing_startrace_ranking_tt_pvp\')" onmouseout="hideDiv(\'cowracing_startrace_ranking_tt_pvp\')">';c+='      <div id="cowracing_startrace_ranking_tt_pvp" class="ttbox">'+t_cowracing_race_ranking+"</div>";c+="    </div>";var s="";var t="cowracing.getRaceReplay('pvp')";if(this.data.pvp.lastrace<=0){t=""}c+='    <div class="replay '+s+'" onclick="'+t+'" onmouseover="showDiv(\'cowracing_replay_ranking_tt_pvp\')" onmouseout="hideDiv(\'cowracing_replay_ranking_tt_pvp\')">';c+='      <div id="cowracing_replay_ranking_tt_pvp" class="ttbox">'+t_cowracing_last_race_replay+"</div>";c+="    </div>";c+='    <div class="clear"></div>'}if(this.data.pvp.racedayremain>0){if(u==this.currentCowSlot){c+='<div class="registered">'+t_cowracing_pvp_register_registered.replace("%NAME%","<b>"+this.data.data.cows[this.currentCowSlot].name+"</b>")+"</div>"}c+='<div class="racetimer">'+t_cowracing_pvp_racedayremain+"</div>";c+='<div id="cowracing_pvp_racetimer"></div>'}else{c+='<div class="running">'+t_cowracing_pvp_race_is_running+"</div>";var m=1;var u=0;for(var q in this.data.data.cows){if(this.data.data.cows[q].ispvp==1){u=q}}if(u>0){m=this.data.data.cows[u].type}c+='<div class="loading cowhead'+m+'"></div>'}}}c+="<div class=\"help helpbutton_blue link\" onclick=\"hideDiv('globaltransp'); hideDiv('globalbox'); cowracing.help('cowracing_raceselection'); cowracing.helpNavi('pvp');\"></div>";c+='<div class="reloadbutton link" onclick="cowracing.racesReload()" onmouseover="showDiv(\'cowracing_reloadbutton_tt\')" onmouseout="hideDiv(\'cowracing_reloadbutton_tt\')">';c+='  <div class="reloadimg"></div>';c+='  <div id="cowracing_reloadbutton_tt" class="ttbox">'+t_cowracing_reload+"</div>";c+="</div>"}else{c+='<div class="soon">'+t_coming_soon+"</div>"}c+='    <div class="imgblock"><div class="img pvp"></div></div>';c+="  </div>";c+='  <div class="clear"></div>';c+='  <div class="slot">';c+='    <div class="cowhead cowhead'+this.data.data.cows[this.currentCowSlot].type+'"></div>';c+="  </div>";c+="</div>";globalBoxFlex("",c,0,0,1);$("globalbox").style.top="40px";hideDiv("cowracing_raceselection_startrace_locked");hideDiv("cowracing_raceselection_startrace_pvp_locked");if(this.data.data.cows[this.currentCowSlot].ispvp==1){showDiv("cowracing_raceselection_startrace_locked")}if(this.data.data.cows[this.currentCowSlot].suspendpvp>0){showDiv("cowracing_raceselection_startrace_pvp_locked")}};cowracing.prototype.registerCowPvPCommit=function(){var a='<div id="cowracing_pvp_registercow">';a+="  <div>"+t_cowracing_pvp_register_cow_body.replace("%NAME%","<b>"+this.data.data.cows[this.currentCowSlot].name+"</b>")+"</div>";var e=0;if(this.data.pvp.competitors.length){for(var c=0;c<this.data.pvp.competitors.length;c++){if(this.data.pvp.competitors[c]&&this.data.pvp.competitors[c].self){e++}}}if(!e){a+='<div class="fee">'+t_cowracing_pvp_register_fee.replace("%MONEY%","<b>"+formatPrice(this.data.config.pvp_fee_money)+"</b>")+"</div>"}else{e=0;for(var h in this.data.data.cows){if(this.data.data.cows[h].ispvp==1){e=h}}if(e>0&&e!=this.currentCowSlot){a+='<div style="margin-top:10px;">';a+='  <div style="float:left; width:50%;">';a+="    <div>"+t_cowracing_pvp_registered_current+"</div>";a+='    <div class="slot"><div class="cowhead cowhead'+this.data.data.cows[e].type+'"></div></div>';a+='    <div style="font-weight:bold">'+this.data.data.cows[e].name+"</div>";a+="  </div>";a+='  <div style="float:right; width:50%;">';a+="    <div>"+t_cowracing_pvp_registered_replace+"</div>";a+='    <div class="slot"><div class="cowhead cowhead'+this.data.data.cows[this.currentCowSlot].type+'"></div></div>';a+='    <div style="font-weight:bold">'+this.data.data.cows[this.currentCowSlot].name+"</div>";a+="  </div>";a+='  <div class="clear"></div>';a+="</div>";a+='<div class="fee">'+t_cowracing_pvp_register_changefee.replace("%COINS%","<b>"+this.data.config.pvp_changefee_coins+"&nbsp;"+t_coins+"</b>")+"</div>"}}a+='  <div style="margin-top:10px;">'+t_cowracing_pvp_register_cow_info.replace("%NAME%","<b>"+this.data.data.cows[this.currentCowSlot].name+"</b>")+"</div>";a+="</div>";var d="cowracing.registerCowPvP()";var b="hideDiv('globaltransp'); hideDiv('globalbox'); cowracing.raceSelection();";globalcommitbox(t_cowracing_pvp_register_cow_head,a,d,b)};cowracing.prototype.raceReplay=function(n,s){var d='<div id="cowracing_racereplay">';if(this.raceReplayData.isdone){d+='<div class="isdone">'+t_cowracing_isdone+"</div>"}d+='  <div class="desc">'+t_cowracing_racereplay_body+"</div>";d+='  <div class="cow_weather cow_weather_'+this.raceReplayData.lanestatus+'"></div>';d+='  <div class="lane_box">';if(this.raceReplayData.type=="pve"){this.currentReplayView=1}d+='    <div id="cowracing_racereplay_lanes" class="lanes">';var e=0;for(var b in this.raceReplayData.competitors){if(this.raceReplayData.type=="pvp"&&this.raceReplayData.unr==this.raceReplayData.competitors[b].unr&&b>1){var l=this.raceReplayData.competitors[1];this.raceReplayData.competitors[1]=this.raceReplayData.competitors[b];this.raceReplayData.competitors[b]=l}e++}var h=e;for(var b in this.raceReplayData.competitors){var r="normal";if(this.raceReplayData.lanestatus){r=this.raceReplayData.lanestatus}d+='<div class="lane '+r+'" style="z-index:'+h+'">';d+='  <div class="start '+r+'"></div>';d+='  <div class="end '+r+'"></div>';for(var c=1;c<=this.raceReplayData.obstacle_count;c++){d+='<div id="cowracing_obstacle'+b+"_"+c+'" class="obstacle obstacle'+c+'"></div>'}d+='  <div id="cowracing_replay_cow'+b+'" class="cow" onmouseover="showDiv(\'cowracing_replay_cow'+b+"_tt')\" onmouseout=\"hideDiv('cowracing_replay_cow"+b+"_tt')\">";if(!this.raceReplayData.type&&this.raceReplayData.competitors[b].unr){d+='<div class="glow"></div>'}if(this.raceReplayData.type=="pve"&&this.raceReplayData.competitors[b].unr){d+='<div class="glow"></div>'}if(this.raceReplayData.type=="pvp"&&this.raceReplayData.unr==this.raceReplayData.competitors[b].unr){d+='<div class="glow"></div>'}d+='    <div class="img cowhead'+this.raceReplayData.competitors[b].cow+'"></div>';if(this.raceReplayData.type=="pvp"){var a=this.raceReplayData.competitors[b].uname;if(this.raceReplayData.competitors[b].teamtag){a+='<div class="tag">['+this.raceReplayData.competitors[b].teamtag+"]</div>"}d+='<div class="username">'+a+"</div>"}var q="";if(this.raceReplayData.type=="pve"&&this.raceReplayData.competitors[b].unr){q="player"}if(this.raceReplayData.type=="pvp"&&this.raceReplayData.unr==this.raceReplayData.competitors[b].unr){q="player"}d+='    <div id="cowracing_replay_cow'+b+'_rank" class="rank '+q+'"></div>';d+='    <div id="cowracing_replay_cow'+b+'_tt" class="ttbox">';if(this.raceReplayData.type=="pve"&&this.raceReplayData.competitors[b].unr){d+='<div class="name">'+this.raceReplayData.competitors[b].name+"</div>"}if(this.raceReplayData.type=="pvp"&&this.raceReplayData.unr==this.raceReplayData.competitors[b].unr){d+='<div class="name">'+this.raceReplayData.competitors[b].name+"</div>"}if(this.data.config.cows[this.raceReplayData.competitors[b].cow]&&this.data.config.cows[this.raceReplayData.competitors[b].cow].name){d+="<div>"+this.data.config.cows[this.raceReplayData.competitors[b].cow].name+"</div>"}d+='      <div class="level">'+t_help_new_level+":&nbsp;"+this.raceReplayData.competitors[b].level+"</div>";d+="      <div>"+t_cowracing_attributs.startspeed+":&nbsp;"+this.raceReplayData.competitors[b].startspeed+"</div>";d+="      <div>"+t_cowracing_attributs.stamina+":&nbsp;"+this.raceReplayData.competitors[b].stamina+"</div>";d+="      <div>"+t_cowracing_attributs.finalsprint+":&nbsp;"+this.raceReplayData.competitors[b].finalsprint+"</div>";d+="      <div>"+t_cowracing_attributs.athletic+":&nbsp;"+this.raceReplayData.competitors[b].athletic+"</div>";d+="      <div>"+t_cowracing_attributs.luck+":&nbsp;"+this.raceReplayData.competitors[b].luck+"</div>";d+="    </div>";d+="  </div>";d+='  <div class="finishline"></div>';d+="</div>";h--}d+="    </div>";if(this.raceReplayData.type=="pvp"){d+='<div id="cowracing_racereplay_lanes_mini" class="mini">';for(var b in this.raceReplayData.competitors){var r="";if(this.raceReplayData.unr==this.raceReplayData.competitors[b].unr){r="self"}d+='<div class="lane '+r+'">';for(var c=1;c<=this.raceReplayData.obstacle_count;c++){d+='<div class="obstacle obstacle'+c+'"></div>'}var a=this.raceReplayData.competitors[b].uname;if(this.raceReplayData.competitors[b].teamtag){a+="&nbsp;["+this.raceReplayData.competitors[b].teamtag+"]"}d+='  <div id="cowracing_replay_cow'+b+'_mini" class="runner">';d+='    <div class="name">'+a+"</div>";d+="  </div>";d+="</div>";d+='<div id="cowracing_replay_cow'+b+'_rank_mini" class="rank"></div>';d+='<div class="clear"></div>'}d+="</div>"}d+="  </div>";d+='  <div class="refresh link" onclick="cowracing.raceReplay('+n+')"></div>';if(this.raceReplayData.type=="pvp"&&this.data.config.min_view==1){d+='<div id="cowracing_racereplay_minimize" class="minimize high link" onclick="cowracing.raceReplayMinimize()" onmouseover="showDiv(\'cowracing_racereplay_minimize_tt\')" onmouseout="hideDiv(\'cowracing_racereplay_minimize_tt\')">';d+='  <div id="cowracing_racereplay_minimize_tt" class="ttbox">'+t_cowracing_racereplay_minimize_low+"</div>";d+="</div>"}d+="</div>";var m="cowracing.raceSelection();";if(this.raceRewardData&&this.raceRewardData.position){m="cowracing.raceReward();"}if(n==1){m="hideDiv('globaltransp'); hideDiv('globalbox');"}if(s==1){m="cowracing.getRaceRanking('pvp', "+this.raceReplayData.leagueid+");"}globalBoxFlex(t_cowracing_racereplay_head,d,0,m,1);$("globalbox").style.top="40px";this.raceReplaySimData=JSON.parse(JSON.stringify(this.raceReplayData));this.raceReplayRuntime=0;this.raceReplayRank=1;window.clearInterval(cowracing.raceReplayTimer);this.raceReplayTimer=0;this.raceObstacles={};this.raceReplayTimer=window.setInterval(cowracing.raceSimulate,100)};cowracing.prototype.raceReplayMinimize=function(){if(this.currentReplayView==1){this.currentReplayView=2;$("cowracing_racereplay_lanes").style.display="none";$("cowracing_racereplay_lanes_mini").style.display="block";$("cowracing_racereplay_minimize").removeClassName("high").addClassName("low");$("cowracing_racereplay_minimize_tt").innerHTML=t_cowracing_racereplay_minimize_high}else{this.currentReplayView=1;$("cowracing_racereplay_lanes").style.display="block";$("cowracing_racereplay_lanes_mini").style.display="none";$("cowracing_racereplay_minimize").removeClassName("low").addClassName("high");$("cowracing_racereplay_minimize_tt").innerHTML=t_cowracing_racereplay_minimize_low}};cowracing.prototype.raceSimulate=function(){cowracing.raceReplayRuntime++;if(!$("cowracing_racereplay")){window.clearInterval(cowracing.raceReplayTimer);return 1}for(var b in cowracing.raceReplaySimData.competitors){if(cowracing.raceReplaySimData.competitors[b].sim_distance>=1000){continue}if(!cowracing.raceReplaySimData.competitors[b].sim_distance){cowracing.raceReplaySimData.competitors[b].sim_distance=0}if(!cowracing.raceObstacles[b]){cowracing.raceObstacles[b]={}}var e=0;if(cowracing.raceReplaySimData.competitors[b].sim_distance<250){e=(cowracing.raceReplaySimData.competitors[b].calc_speed*cowracing.raceReplaySimData.competitors[b].calc_startspeed)}else{if(cowracing.raceReplaySimData.competitors[b].sim_distance>750){e=(cowracing.raceReplaySimData.competitors[b].calc_speed*cowracing.raceReplaySimData.competitors[b].calc_finalsprint)}else{e=(cowracing.raceReplaySimData.competitors[b].calc_speed*cowracing.raceReplaySimData.competitors[b].calc_stamina)}}var a=cowracing.raceReplaySimData.obstacle_count;var l={1:200,2:450,3:700};for(var c=1;c<=a;c++){if(!cowracing.raceReplaySimData.competitors[b].obstacles[c]){continue}if(cowracing.raceReplaySimData.competitors[b].sim_distance>=l[c]&&(!cowracing.raceObstacles[b][c]||cowracing.raceObstacles[b][c]<cowracing.raceReplaySimData.competitors[b].obstacles[c])){if(!cowracing.raceObstacles[b][c]){cowracing.raceObstacles[b][c]=0}cowracing.raceObstacles[b][c]++;e=0;var h=0;if(cowracing.raceReplaySimData.competitors[b].obstacles[c]==1){h=1}if(cowracing.raceObstacles[b][c]==1){cowracing.raceObstacleFlyer(b,c,h)}}}cowracing.raceReplaySimData.competitors[b].sim_distance+=e;var d=((cowracing.raceReplaySimData.competitors[b].sim_distance*100)/1000);if(d>=100){$("cowracing_replay_cow"+b+"_rank").innerHTML=cowracing.raceReplaySimData.competitors[b].rank;if($("cowracing_replay_cow"+b+"_rank_mini")){$("cowracing_replay_cow"+b+"_rank_mini").innerHTML=cowracing.raceReplaySimData.competitors[b].rank}cowracing.raceReplayRank++;d=100}$("cowracing_replay_cow"+b).style.left=d+"%";if($("cowracing_replay_cow"+b+"_mini")){$("cowracing_replay_cow"+b+"_mini").style.left=d+"%"}}if(cowracing.raceReplayRuntime>=1000){window.clearInterval(cowracing.raceReplayTimer)}};cowracing.prototype.raceObstacleFlyer=function(a,d,l){var h=t_cowracing_obstacle_failed;var b="failed";if(l==1){h=t_cowracing_obstacle_success;b=""}var e=getRandom(1000,100000);var m="cowracing_obstacle_flyer"+e;var c='<div id="'+m+'" class="flyer idle '+b+'">'+h+"</div>";$("cowracing_obstacle"+a+"_"+d).insert(c);setTimeout(function(){if($(m)){$(m).removeClassName("idle").addClassName("fly")}},200);setTimeout(function(){if($(m)){$(m).remove()}},1200)};cowracing.prototype.raceRanking=function(){var e='<div id="cowracing_raceranking" class="'+this.raceRankingData.type+'">';if(this.raceRankingData.type=="pve"){e+='  <div class="league">'+t_cowracing_pve_head+"&nbsp;"+this.data.config.cows[this.data.data.cows[this.currentCowSlot].type].name+"</div>";e+='  <div class="line head">';e+='    <div class="cell rank">&nbsp;</div>';e+='    <div class="cell cow">&nbsp;</div>';e+='    <div class="cell level">'+t_cowracing_cowlevel+"</div>";e+='    <div class="cell startspeed">'+t_cowracing_attributs.startspeed+"</div>";e+='    <div class="cell stamina">'+t_cowracing_attributs.stamina+"</div>";e+='    <div class="cell finalsprint">'+t_cowracing_attributs.finalsprint+"</div>";e+='    <div class="cell athletic">'+t_cowracing_attributs.athletic+"</div>";e+='    <div class="cell luck">'+t_cowracing_attributs.luck+"</div>";e+='    <div class="cell points">'+t_cowracing_leaguepoints+"</div>";e+='    <div class="clear"></div>';e+="  </div>";e+='  <div class="list">';for(var c in this.raceRankingData.list){var r="";if(this.raceRankingData.list[c].self){r="self"}e+='<div class="line '+r+'">';e+='  <div class="cell rank">'+c+".</div>";e+='  <div class="cell cow cowhead'+this.raceRankingData.list[c].cow+'"></div>';e+='  <div class="cell level">'+this.raceRankingData.list[c].level+"</div>";e+='  <div class="cell startspeed">'+this.raceRankingData.list[c].startspeed+"</div>";e+='  <div class="cell stamina">'+this.raceRankingData.list[c].stamina+"</div>";e+='  <div class="cell finalsprint">'+this.raceRankingData.list[c].finalsprint+"</div>";e+='  <div class="cell athletic">'+this.raceRankingData.list[c].athletic+"</div>";e+='  <div class="cell luck">'+this.raceRankingData.list[c].luck+"</div>";e+='  <div class="cell points">'+this.raceRankingData.list[c].points+"</div>";e+='  <div class="clear"></div>';e+="</div>"}e+="  </div>"}if(!this.currentPvpRanking){this.currentPvpRanking=this.data.pvp.leagues[0].id}if(this.raceRankingData.type=="pvp"){if(this.raceRankingData.list&&this.raceRankingData.list[0]){this.currentPvpRanking=this.raceRankingData.list[0].leagueid}e+='  <div class="league">'+t_cowracing_pvp_ranking_head+"</div>";e+='  <select id="cowracing_raceranking_pvp_select" onchange="cowracing.getPvPRanking();">';var t=0;if(this.data.pvp.leagues){var l=this.data.pvp.leagues.length;for(var d=0;d<this.data.pvp.leagues.length;d++){text=t_cowracing_ranking_past.replace("%COUNT%",l);if(this.data.pvp.leagues[d].finishdate==0){text=t_cowracing_ranking_current}var s="";if(this.currentPvpRanking==this.data.pvp.leagues[d].id){s="selected";t=this.data.pvp.leagues[d].lastrace}e+="<option "+s+' value="'+this.data.pvp.leagues[d].id+'">'+text+"</option>";l--}}e+="  </select>";if(this.data.config.addon==1){e+='<div class="display_options">';e+='  <input id="racerankingdisplayoption_player" type="radio" value="player" onclick="cowracing.setRaceRankingDisplayOption(\'player\')">';e+='  <div class="desc2">'+t_cowracing_ranking_show_player+"</div>";e+='  <input id="racerankingdisplayoption_team" type="radio" value="team" onclick="cowracing.setRaceRankingDisplayOption(\'team\')">';e+='  <div class="desc2">'+t_cowracing_ranking_show_team+"</div>";e+='  <div class="clear"></div>';e+="</div>"}if(this.currentPvpRanking>0&&t>0){e+='<div class="replay" onclick="cowracing.getRaceReplay(\'pvp\', '+this.currentPvpRanking+', 0, 0, 1)" onmouseover="showDiv(\'cowracing_raceranking_pvp_replay_tt\')" onmouseout="hideDiv(\'cowracing_raceranking_pvp_replay_tt\')">';e+='  <div id="cowracing_raceranking_pvp_replay_tt" class="ttbox">'+t_cowracing_show_last_league_race+"</div>";e+="</div>"}var m=(this.data.pvp.day-1);if(this.data.pvp.leagues&&this.currentPvpRanking>0&&this.currentPvpRanking!=this.data.pvp.leagues[0].id){m=this.data.config.pvp_days}var h=t_cowracing_pvp_ranking_days.replace("%CURRENT%",m);e+='  <div class="intro">'+h.replace("%MAX%",this.data.config.pvp_days)+"</div>";var q=t_cowracing_pvp_points;if(this.raceRankingDisplayOption=="team"){q=t_cowracing_team_points}e+='  <div class="list">';e+='    <div class="line head topic">'+t_guildjob_take_part+"</div>";e+='    <div class="line head topic" style="text-align:right;">'+q+"</div>";e+='    <div class="clear"></div>';var c=1;var b=c+".";var a=0;for(var d=0;d<this.raceRankingData.list.length;d++){var r="";if(this.raceRankingData.list[d].self){r="self"}if(a>0&&a!=this.raceRankingData.list[d].points){c++;b=c+"."}if(a==this.raceRankingData.list[d].points){b="&nbsp;"}a=this.raceRankingData.list[d].points;e+='<div class="line '+r+'">';e+='  <div class="cell rank">'+b+"</div>";e+='  <div class="cell name">'+this.raceRankingData.list[d].uname+"</div>";e+='  <div class="cell points">'+this.raceRankingData.list[d].points+"</div>";e+='  <div class="clear"></div>';e+="</div>"}e+="  </div>"}e+="</div>";var n="cowracing.raceSelection()";globalBoxFlex(t_cowracing_race_ranking,e,0,n,1);if(this.raceRankingData.type=="pvp"){this.setRaceRankingDisplayOption();$("globalbox").style.top="50px"}};cowracing.prototype.setRaceRankingDisplayOption=function(a){if(!a){a=this.raceRankingDisplayOption}else{var b=this.raceRankingDisplayOption;this.raceRankingDisplayOption=a;if(b!=a){cowracing.getPvPRanking()}}$("racerankingdisplayoption_player").checked=false;$("racerankingdisplayoption_team").checked=false;$("racerankingdisplayoption_"+a).checked=true};cowracing.prototype.getPvPRanking=function(){var a=$("cowracing_raceranking_pvp_select").value;this.currentPvpRanking=a;cowracing.getRaceRanking("pvp",a)};cowracing.prototype.raceReward=function(){var a='<div id="cowracing_reward">';a+='<div class="position">'+t_cowracing_reward_position.replace("%POSITION%",this.raceRewardData.position)+"</div>";if(this.raceRewardData.newrank){a+='<div class="newrank_intro">'+t_cowracing_reward_new_rank+"</div>";a+='<div class="newrank">'+this.raceRewardData.newrank+"</div>"}for(var d in this.raceRewardData){a+='<div class="line">';var c=this.raceRewardData[d];if(c<=0){continue}if(d=="leaguepoints"){a+='<div class="cowracepoints_icon left"></div><div class="left2">'+c+"&nbsp;"+t_cowracing_leaguepoints+"</div><br>"}if(d=="money"){a+='<div class="megafield_money_icon left"></div><div class="left2">'+formatPrice(c)+"</div><br>"}if(d=="points"){a+='<div class="megafield_points_icon left"></div><div class="left2">'+formatNumber(c)+"&nbsp;"+t_points+"</div><br>"}if(d=="xp"){a+='<div class="cowpoints_icon left"></div><div class="left2">'+formatNumber(c)+"&nbsp;"+t_cowracing_cowpoints+"</div><br>"}a+='  <div class="clear"></div>';a+="</div>"}a+="</div>";var e=0;var b=0;if(this.raceRewardData.newcowlevel){e="cowracing.raceNewCowlevel();";b=e}else{if(this.raceBrokenData&&this.raceBrokenData.length){e="cowracing.raceBroken();";b=e}}globalBox(t_vet_reward_head,a,e,b,1);hideDiv("globalbox_button2")};cowracing.prototype.raceNewCowlevel=function(){var a='<div id="cowracing_reward">';a+='<div class="newrank_intro">'+t_cowracing_newcowlevel+"</div>";a+='<div class="newrank">'+this.raceRewardData.newcowlevel+"</div>";var c=0;var b=0;if(this.raceBrokenData&&this.raceBrokenData.length){c="cowracing.raceBroken();";b=c}globalBox(t_vet_reward_head,a,c,b,1);hideDiv("globalbox_button2")};cowracing.prototype.raceBroken=function(){var a='<div id="cowracing_broken">';a+="  <div>"+t_cowracing_broken_body+"</div>";for(var b=0;b<this.raceBrokenData.length;b++){a+='<div class="slot">';a+='  <div class="img cowitem'+this.raceBrokenData[b]+'"></div>';a+="</div>"}a+="</div>";globalBox(t_cowracing_broken_head,a);hideDiv("globalbox_button2")};cowracing.prototype.buildTeam=function(){if(!this.data.config.addon){return 1}var m="";if(this.data.team&&this.data.team.id){m+='<div class="teaminfo" onmouseover="showDiv(\'cowracing_team_info_tt\')" onmouseout="hideDiv(\'cowracing_team_info_tt\')">';m+='  <div class="banner">';m+=this.showBanner(this.data.team.banner);m+='    <div id="cowracing_team_info_tt" class="ttbox">';m+='      <div class="name">'+this.data.team.name+"</div>";m+="      <div>"+this.data.team.info+"</div>";m+="    </div>";if(this.data.config.team_banner_unlocks&&in_array(this.data.team.user.status,this.data.config.team_rights.showbannerunlocks)){m+='<div class="banner_unlocks link" onclick="cowracing.showTeamBannerUnlocks();" onmouseover="showDiv(\'cowracing_team_banner_unlocks_tt\')" onmouseout="hideDiv(\'cowracing_team_banner_unlocks_tt\')">';m+='  <div id="cowracing_team_banner_unlocks_tt" class="ttbox">'+t_cowracing_team_banner_unlocks+"</div>";m+="</div>"}m+="  </div>";m+='  <div class="infoblock">';m+='    <div class="name"><b>'+this.data.team.name+"</b> ["+this.data.team.tag+"]</div>";if(in_array(this.data.team.user.status,this.data.config.team_rights.edit)){m+='<div class="edit link" onclick="cowracing.editTeam()" onmouseover="showDiv(\'cowracing_team_edit_tt\')" onmouseout="hideDiv(\'cowracing_team_edit_tt\')">';m+='  <div id="cowracing_team_edit_tt" class="ttbox">'+t_cowracing_team_edit+"</div>";m+="</div>"}m+='    <div class="points">'+t_cowracing_team_points+": "+formatNumber(this.data.team.points)+"</div>";m+="    <div>"+t_cowracing_team_members+": "+this.data.team.currentmembers+"/"+this.data.team.maxmembers+"</div>";if(this.data.team.closeremain>0){m+='<div class="close_timer">';m+="  <div>"+t_cowracing_team_close_timer+"</div>";m+='  <div id="cowracing_team_close_timer" class="timer">'+formatTime(this.data.team.closeremain)+"</div>";if(in_array(this.data.team.user.status,this.data.config.team_rights.stopcloseteam)){m+='<div class="button_new link" onclick="cowracing.cancelDeleteTeamCommit()">'+t_cowracing_team_close_button+"</div>"}m+="</div>"}m+="  </div>";m+='  <div class="clear"></div>';m+="</div>";m+='<div class="member_link link" onclick="cowracing.getTeamMembers()" onmouseover="showDiv(\'cowracing_team_member_link_tt\')" onmouseout="hideDiv(\'cowracing_team_member_link_tt\')">';m+='  <div id="cowracing_team_member_link_tt" class="ttbox">'+t_cowracing_team_members+"</div>";m+='  <div id="cowracing_team_memberlist_newbies_notification" class="newbies" onmouseover="showDiv(\'cowracing_team_memberlist_newbies_notification_amount_tt\')" onmouseout="hideDiv(\'cowracing_team_memberlist_newbies_notification_amount_tt\')">';m+='    <div id="cowracing_team_memberlist_newbies_notification_amount" class="amount"></div>';m+='    <div id="cowracing_team_memberlist_newbies_notification_amount_tt" class="ttbox"></div>';m+="  </div>";m+="</div>";if(in_array(this.data.team.user.status,this.data.config.team_rights.showchat)){m+='<div class="chat_link link" onclick="cowracing.getTeamChat()" onmouseover="showDiv(\'cowracing_team_chat_link_tt\')" onmouseout="hideDiv(\'cowracing_team_chat_link_tt\')">';m+='  <div id="cowracing_team_chat_link_tt" class="ttbox">'+t_cowracing_team_chat+"</div>";m+='  <div id="cowracing_team_chat_unread_notification" class="unread" onmouseover="showDiv(\'cowracing_team_chat_unread_notification_amount_tt\')" onmouseout="hideDiv(\'cowracing_team_chat_unread_notification_amount_tt\')">';m+='    <div id="cowracing_team_chat_unread_notification_amount" class="amount"></div>';m+='    <div id="cowracing_team_chat_unread_notification_amount_tt" class="ttbox"></div>';m+="  </div>";m+="</div>"}if(in_array(this.data.team.user.status,this.data.config.team_rights.showtoken)){m+='<div class="tokens" onmouseover="showDiv(\'cowracing_team_token_tt\')" onmouseout="hideDiv(\'cowracing_team_token_tt\')">';m+='  <div class="amount">'+formatNumber(this.data.team.user.tokens)+"</div>";m+='  <div class="team_token"></div>';m+='  <div id="cowracing_team_token_tt" class="ttbox">';m+='    <div style="font-weight:bold; margin-bottom:5px;">'+t_cowracing_team_token_yours+"</div>";m+="    <div>"+t_cowracing_team_token_desc+"</div>";m+="  </div>";m+='  <div class="pluss link" onclick="cowracing.buyTeamTokenCommit();"></div>';m+="</div>"}if(in_array(this.data.team.user.status,this.data.config.team_rights.showtrophies)){var v=["bronze","gold","silver"];m+='<div class="team_trophies">';for(var h=0;h<v.length;h++){var w="";if(this.data.team[v[h]]>0){w=v[h]}m+='<div class="trophy '+w+'" onmouseover="showDiv(\'cowracing_team_trophies_'+v[h]+"_tt')\" onmouseout=\"hideDiv('cowracing_team_trophies_"+v[h]+"_tt')\">";if(w!=""){m+='<div class="count">'+this.data.team[v[h]]+"x</div>";m+='<div id="cowracing_team_trophies_'+v[h]+'_tt" class="ttbox">'+t_cowracing_team_trophy[v[h]]+"</div>"}m+="</div>"}m+="</div>"}if(in_array(this.data.team.user.status,this.data.config.team_rights.donatetoken)){m+='<div class="team_upgrades">';for(var s in this.data.config.team_upgrades[0]){if(s=="points"){continue}var a=0;var r=0;if(this.data.team.upgrades&&this.data.team.upgrades[s]){a=this.data.team.upgrades[s].level;r=this.data.config.team_upgrades[a][s]}if(s!="maxmembers"){r=r*100;r=Math.round(r*100)/100+"%"}var d=(a+1);var q=0;var n="<div>"+t_cowracing_team_upgrade_level_current+" <b>"+r+"</b></div>";var e=0;if(!this.data.config.team_upgrades[d]){q=100;n+='<div style="margin-top:5px;">'+t_reached_maxlevel+"</div>";e=1}else{var t=this.data.config.team_upgrades[d].points;var b=this.data.config.team_upgrades[a].points;var r=0;if(this.data.team.upgrades&&this.data.team.upgrades[s]&&this.data.team.upgrades[s].points){r=this.data.team.upgrades[s].points}var u=(t-b);var c=(r-b);q=((c*100)/u);var l=this.data.config.team_upgrades[d][s];if(s!="maxmembers"){l=l*100;l=Math.round(l*100)/100+"%"}n+="<div>"+t_cowracing_team_upgrade_level_next+" "+l+"</div>";n+='<div style="margin-top:5px;">'+t_cowracing_team_token_donate_info.replace("%AMOUNT%",(u-c))+"</div>"}m+='<div class="line" onmouseover="showDiv(\'cowracing_team_upgrades_'+s+"_tt')\" onmouseout=\"hideDiv('cowracing_team_upgrades_"+s+"_tt')\">";m+='  <div class="bar">';m+='    <div class="inner"><div class="fill" style="width:'+q+'%;"></div></div>';m+='    <div class="front"></div>';m+="  </div>";m+='  <div class="icon '+s+'"></div>';m+='  <div class="level">'+a+"</div>";if(!e){m+='<div class="button_plus link" onclick="cowracing.donateTeamUpgradeCommit(\''+s+"')\" ></div>"}m+='  <div id="cowracing_team_upgrades_'+s+'_tt" class="ttbox">';m+='    <div style="font-weight:bold; margin-bottom:5px;">'+t_cowracing_team_upgrade_type[s]+"</div>";m+="    <div>"+n+"</div>";m+="  </div>";m+="</div>"}m+="</div>"}if(this.data.team.user.status=="newbie"){m+='<div class="newbie_info">';m+="  <div>"+t_cowracing_team_newbie_info+"<div>";m+='  <button class="button_new" onclick="cowracing.leaveMemberTeamCommit('+this.data.team.user.id+')">'+t_cowracing_team_member_leave+"</button>";m+="</div>"}}else{}$("cowracing_teams").innerHTML=m;this.updateTeamNotifications()};cowracing.prototype.showTeamBannerUnlocks=function(){var c='<div id="cowracing_team_banner_unlocks">';if(in_array(this.data.team.user.status,this.data.config.team_rights.edit)){c+='<div class="edit link" onclick="cowracing.editTeam()" onmouseover="showDiv(\'cowracing_team_edit2_tt\')" onmouseout="hideDiv(\'cowracing_team_edit2_tt\')">';c+='  <div id="cowracing_team_edit2_tt" class="ttbox">'+t_cowracing_team_edit+"</div>";c+="</div>"}c+='<div class="desc">'+t_cowracing_team_banner_unlocks_desc+"</div>";c+='  <div class="list">';for(var d in this.data.config.constants.teambanner_max){c+='<div class="head">'+t_cowracing_team_banner_parts[d]+"</div>";for(var b=1;b<=this.data.config.constants.teambanner_max[d];b++){var e="&nbsp;";var h=1;if(this.data.config.team_banner_unlocks[d]&&this.data.config.team_banner_unlocks[d][b]){for(var a in this.data.config.team_banner_unlocks[d][b]){e=t_cowracing_team_banner_unlocks_info[a].replace("%AMOUNT%",formatNumber(this.data.config.team_banner_unlocks[d][b][a]))}h=0;if(this.data.team.banner_unlocks&&this.data.team.banner_unlocks[d]&&this.data.team.banner_unlocks[d][b]){h=1}}c+='<div class="line">';c+='  <div class="part '+d+" "+d+b+'"></div>';c+='  <div class="info">'+e+"</div>";if(h==1){c+='<div class="ready megafield_product_ready"></div>'}else{c+='<div class="locked"></div>'}c+='  <div class="clear"></div>';c+="</div>"}}c+="  </div>";c+="</div>";globalBoxFlex(t_cowracing_team_banner_unlocks,c,0,0,1);$("globalbox").style.top="40px"};cowracing.prototype.buyTeamTokenCommit=function(){var c=t_cowracing_team_buy_tokens;var b=t_cowracing_team_buy_tokens_body.replace("%COINS%",this.data.team.user.exchangecoins).replace("%AMOUNT%",this.data.team.user.exchangeamount);var a='<div class="link coinsbutton_flex" onclick="cowracing.buyTeamTokenCommitCommit()">'+b+"</div>";globalcommitbox(c,a,0,0,1)};cowracing.prototype.buyTeamTokenCommitCommit=function(){var b=t_cowracing_team_buy_tokens;var a="<div>"+t_cowracing_team_buy_tokens_body.replace("%COINS%",this.data.team.user.exchangecoins).replace("%AMOUNT%",this.data.team.user.exchangeamount)+"</div>";var c="cowracing.buyTeamToken()";globalcommitbox(b,a,c)};cowracing.prototype.updateTeamNotifications=function(){if(!this.data.team||!this.data.team.user){return 1}hideDiv("cowracing_team_chat_unread_notification");hideDiv("cowracing_team_memberlist_newbies_notification");var c=this.data.team.user.unread;if(c>0&&in_array(this.data.team.user.status,this.data.config.team_rights.showchat)){showDiv("cowracing_team_chat_unread_notification");$("cowracing_team_chat_unread_notification_amount").innerHTML=c;$("cowracing_team_chat_unread_notification_amount_tt").innerHTML=t_cowracing_team_unread_messages+c}var b=0;for(var a=0;a<this.data.team.members.length;a++){if(this.data.team.members[a].status=="newbie"){b++}}if(b>0&&in_array(this.data.team.user.status,this.data.config.team_rights.accept)){showDiv("cowracing_team_memberlist_newbies_notification");$("cowracing_team_memberlist_newbies_notification_amount").innerHTML=b;$("cowracing_team_memberlist_newbies_notification_amount_tt").innerHTML=t_cowracing_team_count_newbies+b}};cowracing.prototype.startTeamCommit=function(){if(this.data.team&&this.data.team.id){return 1}var a='<div id="cowracing_team_start_commit" style="min-width:300px;">';if(this.data.data.team_leave_cooldown&&this.data.data.team_leave_cooldown>0){a+="<div>"+t_cowracing_ranking_leave_cooldown_info.replace("%TIME%",'<span style="font-weight:bold;" id="cowracing_team_start_commit_leavecooldown"></span>')+"</div>"}else{a+='  <div class="desc">'+t_cowracing_team_start_desc+"</div>";a+='<div class="button_new link" onclick="cowracing.getTeams()">'+t_cowracing_team_join+"</div>";a+='<div class="button_new link" onclick="cowracing.editTeam()">'+t_cowracing_team_create+"</div>"}a+="</div>";a+="<div class=\"helpbutton_blue link\" style=\"position:absolute; top:-5px; right:-35px; z-index:20;\" onclick=\"hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.help('cowracing_startteam'); cowracing.helpNavi('teams');\"></div>";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.move(2);";globalcommitbox(t_cowracing_team_start,a,0,b,1)};cowracing.prototype.editTeam=function(){var c=1;this.bannerEdit={shape:1,color:1,object:1};var b="";var n="";var e="";if(this.data.team&&this.data.team.id){c=0;this.bannerEdit=this.data.team.banner;b=this.data.team.name;n=this.data.team.tag;e=this.data.team.info}var d='<div id="cowracing_team_edit">';d+="  <div>"+t_cowracing_team_name+"</div>";d+='  <input type="text" id="cowracing_team_edit_name" value="'+b+'" class="name" maxlength="'+this.data.config.constants.maxlength.name+'">';d+='  <div id="cowracing_team_edit_name_failed" class="failed">'+t_cowracing_team_name_failed+"</div>";d+="  <div>"+t_cowracing_team_tag+"</div>";d+='  <input type="text" id="cowracing_team_edit_tag" value="'+n+'" class="tag" maxlength="'+this.data.config.constants.maxlength.tag+'">';d+='  <div id="cowracing_team_edit_tag_failed" class="failed">'+t_cowracing_team_tag_failed+"</div>";d+="  <div>"+t_cowracing_team_desc+"</div>";d+='  <textarea id="cowracing_team_edit_desc" class="desc" maxlength="'+this.data.config.constants.maxlength.info+'">'+e+"</textarea>";d+="  <div>"+t_cowracing_team_banner+"</div>";d+='  <div id="cowracing_team_edit_banner" class="banner"></div>';var m="cowracing.saveTeamCheck()";if(c==1){var a=this.data.config.constants.team_create_money;var l="";if(user_bar<a){l="off";m=""}d+='<div class="cost">'+cityadcost+' <span class="'+l+'" style="font-weight:bold;">'+formatPrice(a)+"</span></div>"}d+='  <div class="button_new link '+l+'" onclick="'+m+'">'+t_cowracing_team_edit_save+"</div>";if(!c&&in_array(this.data.team.user.status,this.data.config.team_rights.closeteam)){d+='<div class="button_new delete link '+l+'" onclick="cowracing.deleteTeamCommit();">'+t_cowracing_team_delete+"</div>"}d+="</div>";var h="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.startTeamCommit();";globalBoxFlex(t_cowracing_team_edit,d,0,h,1);hideDiv("globalbox_footer");$("globalbox").style.top="40px";this.buildBanner()};cowracing.prototype.deleteTeamCommit=function(){var a='<div style="min-width:300px;">'+t_cowracing_team_delete_info.replace("%TIME%",formatTime(this.data.config.constants.team_close_cooldown))+"</div>";var b="cowracing.deleteTeam()";globalcommitbox(t_cowracing_team_delete,a,b)};cowracing.prototype.cancelDeleteTeamCommit=function(){var a='<div style="min-width:300px;">'+t_cowracing_team_cancel_delete_info+"</div>";var b="cowracing.stopDeleteTeam()";globalcommitbox(t_cowracing_team_close_button,a,b)};cowracing.prototype.showBanner=function(a){var b="";b+='<div class="color color'+a.color+'"></div>';b+='<div class="shape shape'+a.shape+'"></div>';b+='<div class="object object'+a.object+'"></div>';return b};cowracing.prototype.buildBanner=function(){var a="";a+=this.showBanner(this.bannerEdit);a+='<div class="left">';a+='  <div class="arrow link" onclick="cowracing.editBanner(\'shape\', -1)"></div>';a+='  <div class="arrow link" onclick="cowracing.editBanner(\'color\', -1)"></div>';a+='  <div class="arrow link" onclick="cowracing.editBanner(\'object\', -1)"></div>';a+="</div>";a+='<div class="right">';a+='  <div class="arrow link" onclick="cowracing.editBanner(\'shape\', 1)"></div>';a+='  <div class="arrow link" onclick="cowracing.editBanner(\'color\', 1)"></div>';a+='  <div class="arrow link" onclick="cowracing.editBanner(\'object\', 1)"></div>';a+="</div>";$("cowracing_team_edit_banner").innerHTML=a};cowracing.prototype.editBanner=function(a,b){this.editBannerCheckUnlock(a,b);if(this.bannerEdit[a]<1){this.bannerEdit[a]=this.data.config.constants.teambanner_max[a]}if(this.bannerEdit[a]>this.data.config.constants.teambanner_max[a]){this.bannerEdit[a]=1}this.buildBanner()};cowracing.prototype.editBannerCheckUnlock=function(a,b){this.bannerEdit[a]+=b;if(this.bannerEdit[a]<1||this.bannerEdit[a]>this.data.config.constants.teambanner_max[a]){return 1}if(this.data.config.team_banner_unlocks&&this.data.config.team_banner_unlocks[a]&&this.data.config.team_banner_unlocks[a][this.bannerEdit[a]]){if(this.data.team.banner_unlocks&&this.data.team.banner_unlocks[a]&&this.data.team.banner_unlocks[a][this.bannerEdit[a]]){}else{this.editBannerCheckUnlock(a,b)}}return 1};cowracing.prototype.saveTeamCheck=function(){var c=$("cowracing_team_edit_name").value;var a=$("cowracing_team_edit_tag").value;var d=$("cowracing_team_edit_desc").value;var b=JSON.stringify(this.bannerEdit);if(c==""){$("cowracing_team_edit_name").focus();return 1}if(a==""){$("cowracing_team_edit_tag").focus();return 1}if(d==""){$("cowracing_team_edit_desc").focus();return 1}this.saveTeam(c,a,d,b)};cowracing.prototype.listTeams=function(){var d=cowracing.teamsList;var c='<div id="cowracing_team_teamlist">';c+='  <div class="list">';for(var b=0;b<d.length;b++){c+='<div class="line">';c+='  <div class="banner">'+this.showBanner(d[b].banner)+"</div>";c+='  <div class="info">';c+='    <div class="name"><b>'+d[b].name+"</b> ["+d[b].tag+"]</div>";c+='    <div class="desc">'+d[b].info+"</div>";c+='    <div class="members">'+t_cowracing_team_members+": "+d[b].currentmembers+"/"+d[b].maxmembers+"</div>";c+='    <div class="points">'+t_cowracing_team_points+": "+formatNumber(d[b].points)+"</div>";c+='    <div class="button_new link" onclick="cowracing.joinTeamCommit('+d[b].id+')">'+t_cowracing_team_list_join+"</div>";c+="  </div>";c+='  <div class="clear"></div>';c+="</div>"}c+="  <div>";c+="<div>";var a="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.startTeamCommit();";globalBoxFlex(t_cowracing_team_list,c,0,a,1);hideDiv("globalbox_footer");$("globalbox").style.top="40px"};cowracing.prototype.joinTeamCommit=function(h){var c="";for(var d=0;d<this.teamsList.length;d++){if(this.teamsList[d].id==h){c=this.teamsList[d].name}}var a='<div style="min-width:300px;">'+t_cowracing_team_list_join_desc.replace("%NAME%",c)+"</div>";var e="cowracing.joinTeam("+h+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.listTeams();";globalcommitbox(t_cowracing_team_list_join_head,a,e,b)};cowracing.prototype.teamMemberStats=function(){var a={};for(var d=0;d<this.data.team.members.length;d++){a[this.data.team.members[d].unr]=this.data.team.members[d]}var m=t_cowracing_team_stats_spend_token;var e='<div id="cowracing_team_memberlist_stats">';e+='  <div class="list">';var c=1;for(var d=0;d<this.teammemberStats.length;d++){var b=this.teammemberStats[d].unr;var n=this.teammemberStats[d].tokens_spend;if(!a[b]){continue}e+='<div class="line" onmouseover="showDiv(\'cowracing_teammemberstats'+b+"_tt')\" onmouseout=\"hideDiv('cowracing_teammemberstats"+b+"_tt')\">";e+='  <div class="rank">'+c+".</div>";e+='  <div class="name">'+a[b].uname+"</div>";e+='  <div class="token">'+formatNumber(n)+"</div>";var q="";if(c>=7){q="bottom"}var h=[];for(j in a[b].tokens_spend_data){h.push({name:t_cowracing_team_upgrade_type[j],value:a[b].tokens_spend_data[j]})}h=h.sort(function(s,r){return r.value-s.value});e+='  <div id="cowracing_teammemberstats'+b+'_tt" class="ttbox '+q+'">';for(j=0;j<h.length;j++){e+='<div class="line2">';e+='  <div class="type">'+h[j].name+"</div>";e+='  <div class="value">'+formatNumber(h[j].value)+"</div>";e+='  <div class="clear"></div>';e+="</div>"}e+="  </div>";e+='  <div class="clear"></div>';e+="</div>";c++}e+="  </div>";e+="</div>";var l="cowracing.buildTeamMembers()";globalBoxFlex(m,e,0,l,1);hideDiv("globalbox_footer");$("globalbox").style.top="65px"};cowracing.prototype.buildTeamMembers=function(){var a=["boss","general","member","newbie"];var h={};for(var c=0;c<this.data.team.members.length;c++){var d=this.data.team.members[c].status;if(!h[d]){h[d]=[]}h[d].push(this.data.team.members[c])}var m='<div id="cowracing_team_memberlist">';if(this.data.config.constants.show_member_stats==1){m+='<div class="statslink link" onclick="cowracing.teamMemberStats()" onmouseover="showDiv(\'statslink_tt\')" onmouseout="hideDiv(\'statslink_tt\')">';m+='  <div id="statslink_tt" class="ttbox">'+t_cowracing_team_stats_spend_token+"</div>";m+="</div>"}m+='  <div class="list">';for(var c=0;c<a.length;c++){m+='<div class="head">'+t_cowracing_team_member_roles[a[c]]+"</div>";if(!h[a[c]]){continue}for(var l=0;l<h[a[c]].length;l++){var e=h[a[c]][l];m+='<div class="line">';m+='  <div class="name">'+e.uname+"</div>";m+='  <div class="token">';m+='    <div class="icon team_token"></div>';m+="    <div>"+e.tokens+"</div>";m+=" </div>";if(in_array(this.data.team.user.status,this.data.config.team_rights.kick)&&this.data.team.user.id!=e.id){var b=1;if(this.data.team.user.status=="general"&&in_array(e.status,["boss","general"])){b=0}if(b==1){m+='<div class="mbutton link kick" onclick="cowracing.kickMemberTeamCommit('+e.id+')" onmouseover="showDiv(\'cowracing_team_members_button_kick'+e.id+"_tt')\" onmouseout=\"hideDiv('cowracing_team_members_button_kick"+e.id+"_tt')\">";m+='  <div id="cowracing_team_members_button_kick'+e.id+'_tt" class="ttbox">'+t_cowracing_team_member_kick+"</div>";m+="</div>"}}if(a[c]=="newbie"&&in_array(this.data.team.user.status,this.data.config.team_rights.accept)){m+='<div class="mbutton link accept" onclick="cowracing.acceptMemberTeamCommit('+e.id+')" onmouseover="showDiv(\'cowracing_team_members_button_accept'+e.id+"_tt')\" onmouseout=\"hideDiv('cowracing_team_members_button_accept"+e.id+"_tt')\">";m+='  <div id="cowracing_team_members_button_accept'+e.id+'_tt" class="ttbox">'+t_cowracing_team_member_accept+"</div>";m+="</div>"}if(a[c]=="member"&&in_array(this.data.team.user.status,this.data.config.team_rights.promote)){m+='<div class="mbutton link promote" onclick="cowracing.promoteMemberTeamCommit('+e.id+')" onmouseover="showDiv(\'cowracing_team_members_button_promote'+e.id+"_tt')\" onmouseout=\"hideDiv('cowracing_team_members_button_promote"+e.id+"_tt')\">";m+='  <div id="cowracing_team_members_button_promote'+e.id+'_tt" class="ttbox">'+t_cowracing_team_member_promote+"</div>";m+="</div>"}if(a[c]=="general"&&in_array(this.data.team.user.status,this.data.config.team_rights.degrade)){m+='<div class="mbutton link degrade" onclick="cowracing.degradeMemberTeamCommit('+e.id+')" onmouseover="showDiv(\'cowracing_team_members_button_degrade'+e.id+"_tt')\" onmouseout=\"hideDiv('cowracing_team_members_button_degrade"+e.id+"_tt')\">";m+='  <div id="cowracing_team_members_button_degrade'+e.id+'_tt" class="ttbox">'+t_cowracing_team_member_degrade+"</div>";m+="</div>"}if(a[c]!="boss"&&this.data.team.user.id==e.id){m+='<div class="mbutton link leave" onclick="cowracing.leaveMemberTeamCommit('+e.id+')" onmouseover="showDiv(\'cowracing_team_members_button_leave'+e.id+"_tt')\" onmouseout=\"hideDiv('cowracing_team_members_button_leave"+e.id+"_tt')\">";m+='  <div id="cowracing_team_members_button_leave'+e.id+'_tt" class="ttbox">'+t_cowracing_team_member_leave+"</div>";m+="</div>"}if(a[c]=="general"&&in_array(this.data.team.user.status,this.data.config.team_rights.transfer)){m+='<div class="mbutton link transfer" onclick="cowracing.transferMemberTeamCommit('+e.id+')" onmouseover="showDiv(\'cowracing_team_members_button_transfer'+e.id+"_tt')\" onmouseout=\"hideDiv('cowracing_team_members_button_transfer"+e.id+"_tt')\">";m+='  <div id="cowracing_team_members_button_transfer'+e.id+'_tt" class="ttbox">'+t_cowracing_team_member_transfer+"</div>";m+="</div>"}m+='  <div class="clear"></div>';m+="</div>"}}m+="  </div>";m+="</div>";var n=t_cowracing_team_members+" ("+this.data.team.currentmembers+"/"+this.data.team.maxmembers+")";globalBoxFlex(n,m,0,0,1);hideDiv("globalbox_footer");$("globalbox").style.top="40px"};cowracing.prototype.transferMemberTeamCommit=function(h){var c="";for(var d=0;d<this.data.team.members.length;d++){if(this.data.team.members[d].id==h){c=this.data.team.members[d].uname}}var a='<div style="min-width:300px;">'+t_cowracing_team_member_transfer_body.replace("%NAME%",c)+"</div>";a+='<div style="margin-top:10px;">'+t_cowracing_team_member_transfer_body2.replace("%NAME%",c)+"</div>";var e="cowracing.transferMemberTeam("+h+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamMembers();";globalcommitbox(t_cowracing_team_member_transfer_head,a,e,b)};cowracing.prototype.acceptMemberTeamCommit=function(h){if(this.data.team.currentmembers>=this.data.team.maxmembers){var e="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamMembers();";var a='<div style="min-width:300px;">';a+='  <div style="margin-bottom:10px; font-weight:bold;">'+t_cowracing_team_members+": "+this.data.team.currentmembers+"/"+this.data.team.maxmembers+"</div>";a+="  <div>"+t_cowracing_team_max_members_info+"</div>";a+='  <button id="globalbox_button1" class="button_yes link" style="margin-top:10px;" onclick="'+e+'"></button>';a+="</div>";globalcommitbox(t_cowracing_team_member_accept_head,a,0,e,1);hideDiv("globalbox_footer");return 1}var c="";for(var d=0;d<this.data.team.members.length;d++){if(this.data.team.members[d].id==h){c=this.data.team.members[d].uname}}var a='<div style="min-width:300px;">'+t_cowracing_team_member_accept_body.replace("%NAME%",c)+"</div>";var e="cowracing.acceptMemberTeam("+h+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamMembers();";globalcommitbox(t_cowracing_team_member_accept_head,a,e,b)};cowracing.prototype.promoteMemberTeamCommit=function(h){var c="";for(var d=0;d<this.data.team.members.length;d++){if(this.data.team.members[d].id==h){c=this.data.team.members[d].uname}}var a='<div style="min-width:300px;">'+t_cowracing_team_member_promote_body.replace("%NAME%",c)+"</div>";var e="cowracing.promoteMemberTeam("+h+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamMembers();";globalcommitbox(t_cowracing_team_member_promote_head,a,e,b)};cowracing.prototype.degradeMemberTeamCommit=function(h){var c="";for(var d=0;d<this.data.team.members.length;d++){if(this.data.team.members[d].id==h){c=this.data.team.members[d].uname}}var a='<div style="min-width:300px;">'+t_cowracing_team_member_degrade_body.replace("%NAME%",c)+"</div>";var e="cowracing.degradeMemberTeam("+h+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamMembers();";globalcommitbox(t_cowracing_team_member_degrade_head,a,e,b)};cowracing.prototype.kickMemberTeamCommit=function(h){var c="";for(var d=0;d<this.data.team.members.length;d++){if(this.data.team.members[d].id==h){c=this.data.team.members[d].uname}}var a='<div style="min-width:300px;">'+t_cowracing_team_member_kick_body.replace("%NAME%",c)+"</div>";a+='<div style="margin-top:10px;">'+t_cowracing_team_member_kick_body2+"</div>";var e="cowracing.kickMemberTeam("+h+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamMembers();";globalcommitbox(t_cowracing_team_member_kick_head,a,e,b)};cowracing.prototype.leaveMemberTeamCommit=function(h){var c="";for(var d=0;d<this.data.team.members.length;d++){if(this.data.team.members[d].id==h){c=this.data.team.members[d].uname}}var a='<div style="min-width:300px;">'+t_cowracing_team_member_leave_body.replace("%NAME%",c)+"</div>";a+='<div style="margin-top:10px;">'+t_cowracing_team_member_leave_body2+"</div>";var e="cowracing.leaveMemberTeam("+h+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamMembers();";globalcommitbox(t_cowracing_team_member_leave_head,a,e,b)};cowracing.prototype.donateTeamUpgradeCommit=function(d){var c=0;var h=0;var b=0;if(this.data.team.upgrades&&this.data.team.upgrades[d]){h=this.data.team.upgrades[d].level;b=this.data.team.upgrades[d].points}if(this.data.config.team_upgrades[(h+1)]){c=(this.data.config.team_upgrades[(h+1)].points-b)}var a='<div id="cowracing_team_donate_tokens_commit">';a+='  <div style="font-weight:bold;">'+t_cowracing_team_upgrade_type[d]+"</div>";a+='  <div style="margin-top:10px;">'+t_cowracing_team_token_donate_input+"</div>";a+='  <div style="position:relative;">';a+='    <input id="cowracing_team_donateuprade_input" type="text" maxlength="5" onchange="cowracing.donateTeamUpgradeCheck(\''+d+"')\" onkeyup=\"cowracing.donateTeamUpgradeCheck('"+d+"')\">";a+='    <div class="team_token"></div>';a+="  </div>";a+='  <div class="missed" style="margin-top:5px;">'+t_cowracing_team_token_donate_info.replace("%AMOUNT%",c)+"</div>";a+='  <div class="available">'+t_cowracing_team_token_donate_available.replace("%AMOUNT%",formatNumber(this.data.team.user.tokens))+"</div>";a+="</div>";var e="cowracing.donateTeamUpgrade('"+d+"')";globalcommitbox(t_cowracing_team_upgrade_type_head,a,e);$("cowracing_team_donateuprade_input").focus()};cowracing.prototype.donateTeamUpgradeCheck=function(a){var b=$("cowracing_team_donateuprade_input").value;if(isNaN(b)){$("cowracing_team_donateuprade_input").value=0}else{b=parseInt(b);if(b>this.data.team.user.tokens){$("cowracing_team_donateuprade_input").value=this.data.team.user.tokens}}};cowracing.prototype.buildTeamChat=function(){if(!this.data.team){return 1}if(!in_array(this.data.team.user.status,this.data.config.team_rights.showchat)){return 1}var b={};for(var d=0;d<this.data.team.members.length;d++){b[this.data.team.members[d].unr]=this.data.team.members[d].uname}var c='<div id="cowracing_team_chat">';c+='  <div id="cowracing_team_chat_list" class="list">';var h=this.teamChatMessages;if(h){for(var d=(h.length-1);d>=0;d--){var a="";if(h[d].unr>0){a="user"}if(h[d].unr==this.data.team.user.unr){a="own"}c+='<div class="line '+a+'">';c+=this.buildTeamChatTemplate(h[d],b);var e=0;if(h[d].unr==this.data.team.user.unr){e=1}else{if(in_array(this.data.team.user.status,this.data.config.team_rights.delchatmsg)){e=1}}if(h[d].params){e=0}if(e==1){c+='<div class="delete link" onclick="cowracing.deleteTeamChatCommit('+h[d].id+')">X</div>'}if(youthprotection_active==1&&h[d].unr>0&&h[d].message!=""){c+='<div class="youthprotection_icon cowracing link" onclick="youthprotection.report(\'teams\', '+h[d].id+')" onmouseover="showDiv(\'cowracing_team_chat_youthprotection_'+d+"_tt')\" onmouseout=\"hideDiv('cowracing_team_chat_youthprotection_"+d+"_tt')\">";c+="  <div>!</div>";c+='  <div id="cowracing_team_chat_youthprotection_'+d+'_tt" class="ttbox">'+t_youthprotection_report+"</div>";c+="</div>"}c+="</div>"}}c+="  </div>";c+='  <textarea id="cowracing_team_chat_input" class="write" autocomplete="off" maxlength="'+this.data.config.constants.chatmsgmaxlength+'" onchange="cowracing.checkTeamChatInput()" onkeyup="cowracing.checkTeamChatInput()"></textarea>';c+='  <div id="cowracing_team_chat_send" class="button_new link" onclick="cowracing.sendTeamChat()">'+t_cowracing_team_chat_send+"</div>";c+='  <div class="clear"></div>';c+="</div>";globalBoxFlex(t_cowracing_team_chat,c,0,0,1);hideDiv("globalbox_footer");$("globalbox").style.top="40px";this.checkTeamChatInput();$("cowracing_team_chat_input").focus();$("cowracing_team_chat_list").scrollTop=$("cowracing_team_chat_list").scrollHeight};cowracing.prototype.deleteTeamChatCommit=function(d){var a='<div style="min-width:300px;">'+t_cowracing_team_chat_delete_message_body+"</div>";var c="cowracing.deleteTeamChat("+d+")";var b="hideDiv('globalbox'); hideDiv('globaltransp'); cowracing.buildTeamChat();";globalcommitbox(t_cowracing_team_chat_delete_message,a,c,b)};cowracing.prototype.checkTeamChatInput=function(){$("cowracing_team_chat_send").removeClassName("off");var a=$("cowracing_team_chat_input").value;if(a==""){$("cowracing_team_chat_send").addClassName("off")}};cowracing.prototype.buildTeamChatTemplate=function(q,n){var c="";var w="";if(q.unr>0){c="***";if(n[q.unr]){c=n[q.unr]}w=q.message;var a=w.split(" ");for(var r=0;r<a.length;r++){var b=a[r];var t=b.length;if(t>=60){var v=Math.ceil(t/2);var l=b.substring(0,v);var e=b.substring(v,t);var d=l+" "+e;w=w.replace(b,d)}}}else{if(q.params&&t_cowracing_team_chat_template[q.params.template]){w=t_cowracing_team_chat_template[q.params.template];if(q.params.name){w=w.replace("%NAME%","<b>"+q.params.name+"</b>")}if(q.params.name1){w=w.replace("%NAME1%","<b>"+q.params.name1+"</b>")}if(q.params.name2){w=w.replace("%NAME2%","<b>"+q.params.name2+"</b>")}if(q.params.day){w=w.replace("%DAY%",q.params.day)}if(q.params.season){w=w.replace("%SEASON%",q.params.season)}if(q.params.points){w=w.replace("%POINTS%","<b>"+q.params.points+"</b>")}if(q.params.rank){w=w.replace("%RANK%","<b>"+q.params.rank+"</b>")}if(q.params.ranking){w+='<div class="ranking">';for(var r=0;r<q.params.ranking.length;r++){var h="***";for(var m=0;m<this.data.team.members.length;m++){if(this.data.team.members[m].unr!=q.params.ranking[r].unr){continue}h=this.data.team.members[m].uname;break}w+="<div>"+t_cowracing_team_chat_template_raceday_add.replace("%NAME%","<b>"+h+"</b>").replace("%RANK%",q.params.ranking[r].rank)+"</div>"}w+="</div>"}if(q.params.unlocks){w+='<div class="unlocks">';for(var u in q.params.unlocks){for(var r=0;r<q.params.unlocks[u].length;r++){w+='<div class="item '+u+" "+u+q.params.unlocks[u][r]+'"></div>'}}w+='  <div class="clear"></div>';w+="</div>"}}}var s="";s+='<div class="head">';if(c!=""){s+='<span class="name">'+c+"</span>"}s+='  <span class="date">'+q.date+"</span>";s+="</div>";s+='<div class="message">'+w+"</div>";return s};cowracing.prototype.itemTT=function(d,e){var c='<div id="cowitem_info">';c+='  <div class="name">'+this.data.config.items[d].name+"</div>";if(this.data.config.items[d].money_bonus){c+="<div>"+t_pets_multi.money+":&nbsp;"+(this.data.config.items[d].money_bonus*100)+"%</div>"}if(this.data.config.items[d].points_bonus){c+="<div>"+t_specialbonus_vet_points_info+":&nbsp;"+(this.data.config.items[d].points_bonus*100)+"%</div>"}if(this.data.config.items[d].teamtoken_bonus){c+="<div>"+t_cowracing_team_teamtoken_bonus+":&nbsp;"+(this.data.config.items[d].teamtoken_bonus*100)+"%</div>"}c+='<div class="proscons">';c+="  <div>"+t_cowracing_lane_pro+"</div>";var b=["normal","rain","mud","cold","heat"];for(var a=0;a<b.length;a++){if(!this.data.config.items[d][b[a]]){continue}c+='<div class="block">';c+='  <div class="icon cow_weather cow_weather_'+b[a]+'"></div>';c+='  <div class="percent">'+(this.data.config.items[d][b[a]]*100)+"%</div>";c+="</div>"}c+='  <div class="clear"></div>';c+="</div>";if(!e){c+='<div class="dur">'+t_cowracing_item_tt_durability.replace("%COUNT%",this.data.config.items[d].durability)+"</div>";if(this.data.config.items[d].money&&this.data.config.items[d].money>0){c+="<div>"+formatPrice(this.data.config.items[d].money)+"</div>"}if(this.data.config.items[d].coins&&this.data.config.items[d].coins>0){c+="<div>"+this.data.config.items[d].coins+"&nbsp;"+t_coins+"</div>"}}else{c+='<div class="dur">'+t_cowracing_item_tt_durability.replace("%COUNT%",this.data.data.items[e].durability+"/"+this.data.config.items[d].durability)+"</div>"}c+="</div>";return c};cowracing.prototype.cowLevelData=function(e,a){var b=this.data.config.level;if(a){var b=this.data.config.attrlevel;var a=b[a].points}var c={};for(var l in b){if(isNaN(l)){break}l=parseInt(l);if(e<b[l].points){break}c.level=l;c.percent=100;if(a>0&&a==b[l].points){break}if(b[(l+1)]){c.xpleft=(b[(l+1)].points-e);var h=(b[(l+1)].points-b[l].points);var d=(e-b[l].points);c.percent=((d*100)/h)}}if(e>=b[l].points){c.maxed=1}return c};cowracing.prototype.move=function(b){var a="";if(this.data.config.addon){a="addon"}$("cowracing").className="pos"+b+" "+a;this.currentPage=b;if(b==3&&this.data.data.queue_remain&&this.data.data.queue_remain<0&&this.data.data.pharmacist_remember_box){this.buyPharmacistCommit(1)}};cowracing.prototype.help=function(a){openFarmersMarketHowTo("cowracing",1,a);this.helpNavi();this.teampointsCalculator()};cowracing.prototype.helpNavi=function(c){if(!c){c="general"}var b=["general","equipment","food","cows","pvp","teams"];for(var a=0;a<b.length;a++){$("cowracing_help_navi_tab_"+b[a]).removeClassName("active");hideDiv("cowracing_help_"+b[a])}$("cowracing_help_navi_tab_"+c).addClassName("active");showDiv("cowracing_help_"+c)};cowracing.prototype.showStats=function(){var a='<div id="cowracing_stats">';a+='  <div class="select_line">';a+='    <select id="cowracing_stats_select" onchange="cowracing.stats()">';var b=["racepoints","pve_races","food","items_bought","quests","pvp","pvp_points"];if(this.data.config.addon==1){b.push("team_trophies");b.push("team_points")}for(var c=0;c<b.length;c++){var d="";if(this.stats_select==b[c]){d="selected"}a+='<option value="'+b[c]+'" '+d+">"+t_cowracing_stats[b[c]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_cowracing_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';if(in_array(this.stats_select,["pvp","team_trophies"])){a+='  <div style="margin-left:330px;">';a+='    <div class="trophy gold '+this.stats_select+'"></div>';a+='    <div class="trophy silver '+this.stats_select+'"></div>';a+='    <div class="trophy bronze '+this.stats_select+'"></div>';a+='    <div class="clear"></div>';a+="  </div>"}a+=htmlStatsContent(this.stats_cache[this.stats_select]);a+="</div>";globalBoxFlex("",a,0,0,1)};cowracing.prototype.showPVPHistory=function(){var h=0;var r=0;for(var q in this.data.history){if(this.data.history[q].count>r){r=this.data.history[q].count}h++}var e='<div id="cowracing_pvphistory">';e+='  <div class="desc">'+t_cowracing_pvphistory_desc+"</div>";e+='  <div class="main">';e+='    <div id="cowracing_pvphistory_barbox" class="barbox" style="width:'+(24*h)+'px;">';var w="";var u=250;var c=12;var a=0;var s=1;for(var q in this.data.history){var t="absolute";if(this.pvphistoryview==2){t="relative"}e+='<div class="bar '+t+'" onmouseover="showDiv(\'cowracing_pvphistory_bar'+s+"_tt')\" onmouseout=\"hideDiv('cowracing_pvphistory_bar"+s+"_tt')\">";if(!this.data.history[q].pos){e+='<div class="empty">';e+='  <div class="text">'+t_no_participation+"</div>";e+="</div>";a=0;var d=a}else{if(this.pvphistoryview==1){var n=100-(((this.data.history[q].pos-1)*100)/r);var b=100-((this.data.history[q].count*100)/r);a=u*(n/100);var d=a;var m="height"}else{var n=100-(((this.data.history[q].pos-1)*100)/this.data.history[q].count);var b=0;a=0;var d=((u/100)*n);var m="bottom"}e+='<div class="pos" style="'+m+":"+n+'%;">';if(this.pvphistoryview==1){var v=(((100-b)*(u/100))/this.data.history[q].count);e+='<div class="posblock" style="height:'+v+'px;"></div>'}e+="</div>";e+='<div class="blocked" style="height:'+b+'%;"></div>';e+='<div class="postext">'+this.data.history[q].pos+".</div>";var l="";if(this.data.history[q].pos==3){l="bronze"}if(this.data.history[q].pos==2){l="silver"}if(this.data.history[q].pos==1){l="gold"}e+='<div class="trophy '+l+'"></div>';var t="";if(h>10&&s>(h-10)){t="right"}e+='<div id="cowracing_pvphistory_bar'+s+'_tt" class="ttbox '+t+'">';e+='  <div style="font-weight:bold;">'+t_cowracing_ranking_past.replace("%COUNT%",s)+"</div>";e+="  <div>"+t_cowracing_pvphistory_tt_position+" "+this.data.history[q].pos+"</div>";e+="  <div>"+t_cowracing_pvphistory_tt_competitors+" "+this.data.history[q].count+"</div>";e+="</div>"}e+="</div>";w+='<div id="cowracing_pvphistory_barfix'+s+'" class="barfix" style="bottom:'+d+"px; left:"+c+'px;"></div>';c+=24;s++}e+='      <div class="clear"></div>';e+='      <div id="cowracing_pvphistory_barbox_lines" class="lines"></div>';e+="    </div>";e+="  </div>";e+='  <div class="xaxis">'+t_cowracing_pvphistory_xaxis+"</div>";e+='  <div class="options">';e+='    <input id="cowracing_pvphistory_barbox_lines_checkbox" type="checkbox" onclick="cowracing.tooglePVPHistoryLines()" style="float:left;">';e+='    <div style="float:left; margin-top:4px;">'+t_cowracing_pvphistory_show_lines+"</div>";e+='    <input id="cowracing_pvphistory_barbox_viewabsolute_checkbox" type="checkbox" onclick="cowracing.changeViewPVPHistory(1)" style="float:left; margin-left:10px;">';e+='    <div style="float:left; margin-top:4px;">'+t_cowracing_pvphistory_absolute+"</div>";e+='    <input id="cowracing_pvphistory_barbox_viewrelative_checkbox" type="checkbox" onclick="cowracing.changeViewPVPHistory(2)" style="float:left; margin-left:10px;">';e+='    <div style="float:left; margin-top:4px;">'+t_cowracing_pvphistory_relative+"</div>";e+='    <div class="clear"></div>';e+="  </div>";e+="</div>";globalBoxFlex(t_cowracing_pvphistory_head,e,0,0,1);$("globalbox").style.top="40px";$("cowracing_pvphistory_barbox_lines").insert(w);$("cowracing_pvphistory_barbox_lines_checkbox").checked=false;if(this.pvphistoryview==1){$("cowracing_pvphistory_barbox_viewabsolute_checkbox").checked=true;$("cowracing_pvphistory_barbox_viewrelative_checkbox").checked=false}else{$("cowracing_pvphistory_barbox_viewrelative_checkbox").checked=false;$("cowracing_pvphistory_barbox_viewrelative_checkbox").checked=true}};cowracing.prototype.drawLinesPVPHistory=function(){if($("cowracing_pvphistory_barfix1_angel")){return 1}var l=1;for(var h in this.data.history){if(!$("cowracing_pvphistory_barfix"+(l+1))){continue}var e=parseInt($("cowracing_pvphistory_barfix"+l).getStyle("left"))-1;var c=parseInt($("cowracing_pvphistory_barfix"+l).getStyle("bottom"));var n=parseInt($("cowracing_pvphistory_barfix"+(l+1)).getStyle("left"))-2;var m=parseInt($("cowracing_pvphistory_barfix"+(l+1)).getStyle("bottom"));var a=(Math.sqrt(Math.pow(n-e,2)+Math.pow(m-c,2)));var b=(Math.atan2((c-m),(n-e))*180/Math.PI);var d='<div id="cowracing_pvphistory_barfix'+l+'_angel" class="angel" style="transform:rotate('+b+'deg);">';d+='  <div id="" class="line" style="width:'+a+'px;"></div>';d+="</div>";$("cowracing_pvphistory_barfix"+l).insert(d);l++}};cowracing.prototype.changeViewPVPHistory=function(a){if(a==1){$("cowracing_pvphistory_barbox_viewabsolute_checkbox").checked=true;$("cowracing_pvphistory_barbox_viewrelative_checkbox").checked=false;this.pvphistoryview=a}else{$("cowracing_pvphistory_barbox_viewabsolute_checkbox").checked=false;$("cowracing_pvphistory_barbox_viewrelative_checkbox").checked=true;this.pvphistoryview=2}this.showPVPHistory()};cowracing.prototype.tooglePVPHistoryLines=function(){if($("cowracing_pvphistory_barbox_lines").style.display=="block"){$("cowracing_pvphistory_barbox_lines").style.display="none";$("cowracing_pvphistory_barbox_lines_checkbox").checked=false}else{this.drawLinesPVPHistory();$("cowracing_pvphistory_barbox_lines").style.display="block";$("cowracing_pvphistory_barbox_lines_checkbox").checked=true}};cowracing.prototype.teampointsCalculator=function(){var b="";b+='<div class="header">';b+='  <div class="col1">'+t_cowracing_team_members+": </div>";b+='  <input type="number" min="3" id="cowracing_help_teams_points_calculator_members" class="col2" autocomplete="off" value="'+this.teampointsCalculatorData.members+'">';b+='  <div class="col3 button_new link" onclick="cowracing.teampointsCalculatorSetMembers()">ok</div>';b+='  <div class="clear"></div>';b+="</div>";b+='<div class="ranks">';if(this.teampointsCalculatorData.members){for(var a=1;a<=this.teampointsCalculatorData.members;a++){var c=0;if(this.teampointsCalculatorData.result&&this.teampointsCalculatorData.result[a]){c=this.teampointsCalculatorData.result[a].rank}b+='<div class="slot">';b+='  <div class="col1">'+t_cowracing_help_teampoints_calculator_rank+"&nbsp;"+t_cowracing_team_member_roles.member+"&nbsp;"+a+":</div>";b+='  <input type="number" min="0" id="cowracing_help_teams_points_calculator_input'+a+'" autocomplete="off" value="'+c+'">';if(this.teampointsCalculatorData.result&&this.teampointsCalculatorData.result[a]){b+='<div class="col3">'+this.teampointsCalculatorData.result[a].points+"&nbsp;"+t_cowracing_pvp_points+"</div>"}b+='  <div class="clear"></div>';b+="</div>"}}b+="</div>";b+="<div>";b+='  <div class="button_new link calc" onclick="cowracing.teampointsCalculatorExecute()">'+t_cowracing_help_teampoints_calculator_button+"</div>";if(this.teampointsCalculatorData.result&&this.teampointsCalculatorData.result.all){b+='<div class="result">';b+='  <div class="col1">'+t_cowracing_stats.team_points+":</div>";b+='  <div class="col3">'+this.teampointsCalculatorData.result.all+"</div>";b+='  <div class="clear"></div>';b+="</div>"}b+="</div>";$("cowracing_help_teams_points_calculator").innerHTML=b};cowracing.prototype.teampointsCalculatorSetMembers=function(){var a=$("cowracing_help_teams_points_calculator_members").value;if(isNaN(a)||a<3){a=3;$("cowracing_help_teams_points_calculator_members").value=a}this.teampointsCalculatorData.members=a;this.teampointsCalculator()};cowracing.prototype.teampointsCalculatorExecute=function(){this.teampointsCalculatorData.result={};var c=parseInt(this.teampointsCalculatorData.members);var l=0;for(var d=1;d<=c;d++){var m=$("cowracing_help_teams_points_calculator_input"+d).value;if(isNaN(m)||m<1){m=0;$("cowracing_help_teams_points_calculator_input"+d).value=0;this.teampointsCalculatorData.result[d]={rank:0,points:0};continue}var h=Math.round(Math.pow(m,-0.2)*68-18);this.teampointsCalculatorData.result[d]={rank:m,points:h};l+=h}var a=Math.pow(c,0.6)+1.1;a=a.toFixed(2);var e=Math.round(l/a);this.teampointsCalculatorData.result.all=e;this.teampointsCalculator()};cowracing.prototype.close=function(){hideDiv("transp");hideDiv("farmersmarket_pos8_inner")};var cropaction=function(){this.data={}};cropaction.prototype.buyPoints=function(a){cropaction.action("cropaction_buy_points",{coins:a})};cropaction.prototype.init=function(){cropaction.action("cropaction_init")};cropaction.prototype.action=function(a,b){ajaxAction("farm",a,b,cropaction.response)};cropaction.prototype.response=function(c,b,d){cropaction.data=c;cropaction.build();if(c.first){var a='<div id="cropaction_commit">';a+="  <div>"+t_specialoffer_message+"</div>";a+='  <div style="display:flex; justify-content:center; align-items:center; margin-top:10px;">';a+='    <div class="icon eventitem itemcropaction_points" style="width:40px; height:40px; background-size:100%;"></div>';a+='    <div style="font-weight:bold; font-size:14px; margin-left:5px;">'+cropaction.data.config.daily_points+"</div>";a+="  </div>";a+="</div>";globalcommitbox("",a,0,0,1)}};cropaction.prototype.build=function(){var l=0;if(this.data.data.sum){l=this.data.data.sum}var a=this.data.config.sum;var h=Math.min(100,((l*100)/a));var m=animal_special_config[this.data.config.reward.animalid][this.data.config.action];var e="";e+='<div class="border"></div>';e+='<div class="effects">';e+='  <div class="back"></div>';for(var d=1;d<=3;d++){e+='<div class="flower_flight set set'+d+'">';for(var c=1;c<=3;c++){for(var b=1;b<=3;b++){e+='<div class="flower'+b+'"></div>'}}e+="  </div>"}e+="</div>";e+='<div class="header">';e+='  <div class="headline">'+t_cropaction_name+"</div>";e+='  <div class="desc">';e+="    <div>"+t_cropaction_desc.replace("%ITEM%",t_cropaction_points)+"</div>";e+='    <div class="name">'+m.title+"</div>";e+="  </div>";e+="</div>";e+='<div class="animal animal'+this.data.config.action+'">';e+='  <div class="bonus_star">';if(m.cropbonus){e+='<div class="content">'+t_cropaction_reward_cropbonus.replace("%BONUS%",m.cropbonus).replace("<b>",'<span class="big">').replace("</b>","</span>")+"</div>"}if(m.productiontime){e+='<div class="content">'+t_cropaction_reward_timebonus.replace("%TIME%",'<span class="big">'+formatTime(m.productiontime)+"</span>").replace("<b>",'<span class="big">').replace("</b>","</span>")+"</div>"}e+="  </div>";e+="</div>";e+='<div class="bar rotate">';e+='  <div class="bar_inner" style="height:'+h+'%;"></div>';e+='  <div class="progress">';e+='    <div class="icon eventitem itemcropaction_points"></div>';e+='    <div class="amount"><span class="current">'+formatNumber(l)+"</span>/"+formatNumber(a)+"</div>";if(parseInt(l)<parseInt(a)){e+='<button class="button_new link" onclick="cropaction.buyPointsCommit()">'+t_cropaction_buy_points.replace("%NAME%",t_cropaction_points)+"</button>"}else{e+='<div class="ready"></div>'}e+="  </div>";e+="</div>";e+='<div class="mini_close link" onclick="cropaction.close()"></div>';e+='<div class="helpbutton_blue link" onclick="helpAction(\'animals\')" onmouseover="showDiv(\'cropactionbox_helpbutton_blue_tt\')" onmouseout="hideDiv(\'cropactionbox_helpbutton_blue_tt\')">';e+='  <div id="cropactionbox_helpbutton_blue_tt" class="ttbox">';e+='    <div class="line">';e+='      <div class="eventgarden_icon"></div>';e+='      <div class="bla">'+t_cropaction_help1.replace("%ITEM%",t_cropaction_points)+"</div>";e+="    </div>";e+='    <div class="line">';e+='      <div class="animalhead animal_special_head'+this.data.config.reward.animalid+"_"+this.data.config.action+'"></div>';e+='      <div class="bla">'+t_cropaction_help2.replace("%ITEM%",t_cropaction_points)+"</div>";e+="    </div>";e+="  </div>";e+="</div>";e+=events.buildTimeline("cropaction");$("cropactionbox_content").innerHTML=e;$("cropactionbox").style.display="flex";setTimer("cropaction");this.timerUpdate()};cropaction.prototype.buyPointsCommit=function(){var d=t_cropaction_buy_points.replace("%NAME%",t_cropaction_points);var c='<div id="cropaction_commit">';for(var a in this.data.config.buy){var b="";if(parseInt(a)>parseInt(user_coins)){b="off"}c+='<div class="link coinsbutton_flex '+b+'" onclick="cropaction.buyPointsCommitCommit('+a+')">'+t_cropaction_buy_points_button.replace("%COUNT%",formatNumber(this.data.config.buy[a])).replace("%NAME%",t_cropaction_points).replace("%AMOUNT%",a)+"</div>"}c+="</div>";globalcommitbox(d,c,0,0,1)};cropaction.prototype.buyPointsCommitCommit=function(a){var c=t_cropaction_buy_points.replace("%NAME%",t_cropaction_points);var b='<div id="cropaction_commit">';b+="  <div>"+t_cropaction_buy_points_commit.replace("%COUNT%",formatNumber(this.data.config.buy[a])).replace("%NAME%",t_cropaction_points).replace("%AMOUNT%",a)+"</div>";b+="</div>";var d="cropaction.buyPoints("+a+")";globalcommitbox(c,b,d)};cropaction.prototype.timer=function(){this.data.data.remain--;this.data.data.remain_exchange--;this.timerUpdate();if(this.data.data.remain_exchange<=0){this.close()}};cropaction.prototype.timerUpdate=function(){events.timerTimeline("cropaction")};cropaction.prototype.close=function(){hideDiv("cropactionbox")};var deliveryevent=function(){this.data={};this.click=0;this.clickBlock=0;this.stats_cache=0;this.stats_cache_delay=0};deliveryevent.prototype.stats=function(){if(deliveryevent.stats_cache_delay<=0||!deliveryevent.stats_cache){this.action("deliveryevent_stats")}else{deliveryevent.showStats()}};deliveryevent.prototype.speedup=function(){this.action("deliveryevent_speedup")};deliveryevent.prototype.startTour=function(a){this.action("deliveryevent_starttour",{spot:a})};deliveryevent.prototype.buyItem=function(a){this.action("deliveryevent_buyitem",{coins:a})};deliveryevent.prototype.init=function(){this.action("deliveryevent_init")};deliveryevent.prototype.action=function(a,b){ajaxAction("farm",a,b,deliveryevent.response)};deliveryevent.prototype.response=function(b,a,c){deliveryevent.data=b;setTimer("deliveryevent");deliveryevent.update();if(a=="deliveryevent_stats"){deliveryevent.stats_cache_delay=60;deliveryevent.stats_cache=b.stats;deliveryevent.showStats()}if(deliveryevent.data.login){deliveryevent.login()}};deliveryevent.prototype.login=function(){var a='<div id="deliveryevent_dialog">';a+="  <div>"+t_deliveryevent_daily_login.replace("%AMOUNT%",this.data.config.dailypoints)+"</div>";a+='  <div class="button_yes link" onclick="deliveryevent.update();"></div>';a+="</div>";var b="deliveryevent.update()";globalcommitbox(t_deliveryevent_head,a,0,b,1)};deliveryevent.prototype.update=function(){var l=0;var b=0;if(this.data.data.points){l=this.data.data.points}if(this.data.data.saved){b=Math.min(100,(this.data.data.saved*100)/this.data.config.maxpoints)}var m='<div id="deliveryevent">';m+='  <div class="map '+this.data.config.season+'">';m+='    <div class="routes">';for(var t in this.data.config.spots){m+='<div id="deliveryevent_route_'+t+'" class="route '+t+'"></div>'}m+="    </div>";m+='    <div class="spots">';var n=0;var s=checkFarmhouseBonus(this.data.config.token);if(s&&s.cooldown){n=s.cooldown}for(var t in this.data.config.spots){var u="";var d=this.data.config.spots[t].duration;if(n){d=Math.ceil(d*(1-n));u="bonus"}m+='<div class="spot '+t+' link" onclick="deliveryevent.startTourCheckCommit(\''+t+"')\" onmouseover=\"deliveryevent.spotOver('"+t+"')\" onmouseout=\"deliveryevent.spotOut('"+t+"')\">";var v="";if(t=="bath"||t=="football"){v="right"}m+='  <div id="deliveryevent_spot_'+t+'" class="ttbox '+v+'">';m+='    <div class="name">'+this.data.config.spots[t].name+"</div>";var v="important";if(this.data.config.spots[t].points<=this.data.data.points){v=""}m+='  	 <div class="'+v+'">'+t_deliveryevent_ice_amount+formatNumber(this.data.config.spots[t].points)+"</div>";m+="  	 <div>"+t_deliveryevent_ice_duration+'<span class="'+u+'">'+formatTime(d)+"</span></div>";if(n){m+='<div class="bonus bonus2">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(n*100))+")</div>"}m+="  </div>";m+="</div>"}m+="    </div>";m+='    <div class="van '+this.data.config.season+' link"><img id="deliveryevent_van_img" src="'+imgpath+'leer.gif"><div id="deliveryevent_van_bubble"></div><div class="click" onclick="deliveryevent.clickIt()"></div></div>';m+="  </div>";m+='  <div id="deliveryevent_tour" class="tour">';m+='    <div class="block transp"></div>';m+='    <div id="deliveryevent_tour_timer" class="timer '+this.data.config.season+'"></div>';m+='    <div class="speedup link" onclick="deliveryevent.speedupCommit()"></div>';m+="  </div>";m+='  <div class="stats '+this.data.config.season+'" onmouseover="showDiv(\'deliveryevent_stats_tt\')" onmouseout="hideDiv(\'deliveryevent_stats_tt\')">';m+='    <div class="amount">'+formatNumber(l)+"</div>";m+='    <div class="add link" onclick="deliveryevent.buyItemCommit()"></div>';m+='    <div id="deliveryevent_stats_tt" class="ttbox">'+t_deliveryevent_eventgarden_info+"</div>";m+="  </div>";var r=0;if(this.data.data.saved){r=this.data.data.saved}m+='  <div class="headline">'+t_deliveryevent_delivered_head+"&nbsp;"+formatNumber(r)+"/"+formatNumber(this.data.config.maxpoints)+"</div>";m+='  <div class="bar">';m+='    <div class="inner '+this.data.config.season+'" style="width:'+b+'%"></div>';m+='    <div class="front"></div>';m+='    <div class="rewards">';for(var e in this.data.config.rewards){var q='<div style="margin-bottom:10px;">'+t_deliveryevent_delivered_need.replace("%AMOUNT%",formatNumber(this.data.config.rewards[e].points))+"</div>";q+='<div style="margin-bottom:10px;">'+t_help_new_reward+":</div>";var u="";if(e>=5){u="right"}var c=((this.data.config.rewards[e].points*100)/this.data.config.maxpoints);m+='<div class="reward" style="left:'+c+'%" onmouseover="showDiv(\'deliveryevent_reward'+e+"_tt')\" onmouseout=\"hideDiv('deliveryevent_reward"+e+"_tt')\">";if(this.data.config.rewards[e].powerup){q+='<div style="margin-bottom:10px;"><b>'+t_pointsboost_unit+"</b><br>"+t_pointsboost.replace("%PERCENT%",this.data.config.rewards[e].percent)+"</div>";m+='<div class="powerup"></div>'}if(this.data.config.rewards[e].products){q+="<div><b>"+t_productpackage_size[this.data.config.rewards[e].products]+"</b></div>";if(this.data.data.rewards&&this.data.data.rewards[e]){q+='<div style="margin-bottom:10px;"></div>';for(var h in this.data.data.rewards[e].products){q+='<div style="display:flex; justify-content:center; margin-bottom:2px;">'+htmlProductBody(h,this.data.data.rewards[e].products[h])+"</div>"}}m+='<div class="bubble">';m+='  <div class="product_package size'+this.data.config.rewards[e].products+'"></div>';m+="</div>"}if(this.data.config.rewards[e].giftid){q+="<div><b>"+t_pan_item+"</b></div>";var a=this.data.config.rewards[e].giftid;if(presents_hack[a]){a=presents_hack[a]}m+='<div class="bubble"><img src="'+imgpath+"gifts/"+a+'.gif"></div>'}if(this.data.config.rewards[e].moneypackage){q+="<div><b>"+t_moneypackage_size[this.data.config.rewards[e].moneypackage]+"</b></div>";if(this.data.data.rewards&&this.data.data.rewards[e]){q+='<div style="margin-bottom:10px;">'+formatPrice(this.data.data.rewards[e].moneypackage)+"</div>"}m+='<div class="bubble">';m+='  <div class="money_package size'+this.data.config.rewards[e].moneypackage+'"></div>';m+="</div>"}if(this.data.data.rewards&&this.data.data.rewards[e]){m+='<div id="deliveryevent_reward'+e+'_ready" class="megafield_product_ready ready"></div>'}m+='  <div id="deliveryevent_reward'+e+'_tt" class="ttbox '+u+'">'+q+"</div>";m+="</div>"}m+="    </div>";m+="  </div>";m+=events.buildTimeline("deliveryevent");m+='  <div class="help helpbutton_blue link" onclick="deliveryevent.help()"></div>';m+='  <div class="stats_link link" onclick="deliveryevent.stats()"></div>';m+="</div>";globalBoxFlex(t_deliveryevent_head,m,0,0,1);this.timerUpdate();$("globalbox").style.top="35px"};deliveryevent.prototype.spotOver=function(a){showDiv("deliveryevent_spot_"+a);showDiv("deliveryevent_route_"+a)};deliveryevent.prototype.spotOut=function(a){hideDiv("deliveryevent_spot_"+a);hideDiv("deliveryevent_route_"+a)};deliveryevent.prototype.startTourCheckCommit=function(h){var b="";var e=0;var d=checkFarmhouseBonus(this.data.config.token);if(d&&d.cooldown){e=d.cooldown;b="bonus"}var m=this.data.config.spots[h].duration;if(e){m=(m*(1-e))}if(this.data.config.spots[h].points>this.data.data.points){return 1}var a='<div id="deliveryevent_commit">';a+="<div>"+t_deliveryevent_start_tour_body.replace("%AMOUNT%",formatNumber(this.data.config.spots[h].points)).replace("%TIME%",'<span class="'+b+'">'+formatTime(m)+"</span>")+"</div>";if(e){a+='<div class="bonus bonus2">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(e*100))+")</div>"}var l="deliveryevent.startTour('"+h+"')";var c="deliveryevent.update()";globalcommitbox(t_deliveryevent_start_tour_head,a,l,c)};deliveryevent.prototype.speedupCommit=function(){if(this.data.data.tour&&this.data.data.tour.remain>0){var b=Math.ceil(this.data.data.tour.remain/this.data.config.coinduration);var a='<div id="deliveryevent_commit">'+t_deliveryevent_speedup_body.replace("%AMOUNT%",b)+"</div>";var d="deliveryevent.speedup()";var c="deliveryevent.update()";globalcommitbox(t_deliveryevent_speedup_head,a,d,c)}};deliveryevent.prototype.buyItemCommit=function(){events.buyCommit({name:"deliveryevent",buydata:this.data.config.buyitem,fn:"deliveryevent.buyItem",fnn:"deliveryevent.update()",head:t_deliveryevent_buy_item_head,line:t_deliveryevent_buy_item})};deliveryevent.prototype.timer=function(){this.data.data.remain--;this.data.data.remain_exchange--;if(this.data.data.tour){this.data.data.tour.remain--}this.timerUpdate();if(this.data.data.remain_exchange<=0){this.close()}deliveryevent.stats_cache_delay--};deliveryevent.prototype.timerUpdate=function(){if($("deliveryevent_timer")){$("deliveryevent_timer").innerHTML=formatTime(this.data.data.remain)}if(this.data.data.tour){if(this.data.data.tour.remain>0){if($("deliveryevent_tour_timer")){$("deliveryevent_tour_timer").innerHTML=formatTime(this.data.data.tour.remain)}showDiv("deliveryevent_tour")}else{hideDiv("deliveryevent_tour")}}events.timerTimeline("deliveryevent")};deliveryevent.prototype.flyer=function(b){var a='<div class="img deliveryevent_collectitem '+this.data.config.season+'"></div>';a+='<div class="amount">'+b+"x</div>";a+='<div class="clear"></div>';events.flyer({id:"deliveryevent_link",name:"deliveryevent",html:a,idle:"idle",move:"up"})};deliveryevent.prototype.close=function(){hideDiv("deliveryevent_link");if($("deliveryevent")){hideDiv("globaltransp");hideDiv("globalbox")}clearTimer("deliveryevent");this.data={}};deliveryevent.prototype.clickIt=function(){this.click++;if(this.click%2==0){this.clickStartOffer()}};deliveryevent.prototype.clickStartOffer=function(){if(this.clickBlock==1){return 1}this.clickReset();this.clickBlock=1;if(deliveryevent_van_order&&deliveryevent_van_order[this.data.config.season]){var c="";for(var a=1;a<=3;a++){var d="";if(a>1){d=", "}if(a==3&&this.data.config.season=="winter"){d=" "}var b=getRandom(1,deliveryevent_van_order[this.data.config.season][a].length);c+=d+deliveryevent_van_order[this.data.config.season][a][(b-1)]}}if(this.data.config.season=="summer"){$("deliveryevent_van_img").src=imgpath+"IcecreamDelivery_Map_TruckAni_00.gif"}else{$("deliveryevent_van_img").src=imgpath+"Present_Delivery_Map_SantaAni_01.gif"}if(deliveryevent_van_order&&deliveryevent_van_order[this.data.config.season]){setTimeout(function(){$("deliveryevent_van_bubble").innerHTML="Einmal ein "+c+", bitte.";showDiv("deliveryevent_van_bubble")},4500);setTimeout(function(){hideDiv("deliveryevent_van_bubble")},8000)}setTimeout(function(){deliveryevent.clickReset()},12000)};deliveryevent.prototype.clickReset=function(){if($("deliveryevent_van_img")){hideDiv("deliveryevent_van_bubble");$("deliveryevent_van_img").src=imgpath+"leer.gif";this.clickBlock=0}};deliveryevent.prototype.showStats=function(){var a='<div id="deliveryevent_stats">';a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache);a+="</div>";var b="deliveryevent.update()";globalBoxFlex(t_deliveryevent_stats_head,a,0,b,1)};deliveryevent.prototype.help=function(){var a='<div id="deliveryevent_help">';a+="  <ul>";a+="    <li>"+t_deliveryevent_help1+"</li>";a+="    <li>"+t_deliveryevent_help2+"</li>";a+="    <li>"+t_deliveryevent_help3+"</li>";a+="    <li>"+t_deliveryevent_help4+"</li>";a+="  </ul>";a+='  <div class="hint">'+t_deliveryevent_daily_login.replace("%AMOUNT%",deliveryevent.data.config.dailypoints)+"</div>";a+="</div>";var b="deliveryevent.update()";globalcommitbox(t_deliveryevent_head,a,0,b,1)};var eventcountdown=function(){this.data={}};eventcountdown.prototype.timer=function(){hideDiv("eventcountdown");var e="";var m=0;var h=0;for(var d in this.data){h++}var c=1;for(var d in this.data){if(!this.data[d]){continue}this.data[d].remain--;var b="";if(this.data[d].name){b=this.data[d].name;if(b.indexOf("specialbonus")>-1&&specialbonus){b=t_eventweek}}var l="";if(this.data[d].free){l="*";m++}var a="";if(h==c){a="last"}e+='<div class="line '+a+'">';e+='  <div class="col1">'+b+'<span class="star">'+l+"</span></div>";e+='  <div class="col2">'+formatTime(this.data[d].remain)+"</div>";e+='  <div class="clear"></div>';e+="</div>";c++}if(e!=""){e='<div class="header">'+t_eventcountdown_info+"</div>"+e;if(m>0){e+='<div class="footer">'+t_eventcountdown_info_garden+"</div>"}$("eventcountdown_tt").innerHTML=e;showDiv("eventcountdown")}};var eventgarden=function(){this.data={};this.mode="plant";this.currentPid="";this.hoverCheck=0;this.currentHoverTile=0;this.cache={};this.cacheClicks=4;this.cacheTime=2;this.cacheTimeRunner=0;this.currentAutoplantPid="";this.blocked={};this.toogleDivs=["regal_main_buttons","rackInfo","rackItems","rackBottom"];this.toogleDivsTmp=[];this.tutorialStep=1;this.effectsOn=1;this.warningBlock=0;this.shopPos=1};eventgarden.prototype.disableWarning=function(){eventgarden.action("eventgarden_disable_warning")};eventgarden.prototype.buyShop=function(a,b){eventgarden.action("eventgarden_buy_shop",{name:a,amount:b})};eventgarden.prototype.speedup=function(a){eventgarden.action("eventgarden_speedup",{coins:a})};eventgarden.prototype.autoplant=function(){eventgarden.action("eventgarden_autoplant",{plant:eventgarden.currentAutoplantPid});eventgarden.currentAutoplantPid=""};eventgarden.prototype.harvestAll=function(){eventgarden.action("eventgarden_harvest_all")};eventgarden.prototype.harvest=function(a){eventgarden.action("eventgarden_harvest",{cache:JSON.stringify(eventgarden.cache),demolition:a});eventgarden.cache={};eventgarden.cacheTimeRunner=0};eventgarden.prototype.plant=function(){eventgarden.action("eventgarden_plant",{cache:JSON.stringify(eventgarden.cache)});eventgarden.cache={};eventgarden.cacheTimeRunner=0};eventgarden.prototype.init=function(){eventgarden.action("eventgarden_init")};eventgarden.prototype.action=function(a,b){ajaxAction("farm",a,b,eventgarden.response)};eventgarden.prototype.response=function(b,a,c){eventgarden.data=b;if(a=="eventgarden_init"){mapGo2Location("farm",1);eventgarden.build();if(pentecostevent){pentecostevent.close()}if(!eventgarden.data.firstvisit){eventgarden.stockWarning()}}else{eventgarden.buildGarden()}if(a=="eventgarden_buy_shop"){eventgarden.openShop()}if(a=="eventgarden_harvest_all"&&eventgarden.data.drop){eventgarden.showDrop(eventgarden.data.drop)}if(b.daily){eventgarden.showDaily(b.daily)}};eventgarden.prototype.build=function(){var h=this.data.config.events[this.data.data.event].theme;var d="";d+='<div id="eventgarden_garden" class="garden"></div>';d+='<div id="eventgarden_modes" class="modes"></div>';d+='<div id="eventgarden_stock" class="stock"></div>';d+='<div class="frontdeco '+this.data.data.event+'"></div>';d+='<div class="anis">';for(var c=1;c<=4;c++){var e=getRandom(20,35);if(h=="summer"){e=getRandom(40,70)}d+='<div class="path path'+c+'" style="top:'+getRandom(50,500)+"px; animation-delay:"+(getRandom(1,30)/10)+"s; animation-duration:"+e+'s;">';d+='  <div class="ani ani'+c+'"></div>';d+="</div>"}d+="  </div>";d+='<div class="front"></div>';if(this.effectsOn==1){d+='<div class="effects">';for(var c=1;c<=3;c++){d+='<div class="flower_flight set set'+c+'">';for(var b=1;b<=3;b++){for(var a=1;a<=3;a++){d+='<div class="flower'+a+'"></div>'}}d+="  </div>"}if(this.data.data.event=="invasion"){d+='<div class="ufo"></div>'}if(this.data.data.event=="rainbowevent"){d+='<div class="irishsheep1"></div>';d+='<div class="irishsheep2"></div>'}d+="</div>"}d+='<div class="eventgarden_close link" onclick="eventgarden.close()" onmouseover="showDiv(\'eventgarden_close_tt\')" onmouseout="hideDiv(\'eventgarden_close_tt\')">';d+='  <div id="eventgarden_close_tt" class="ttbox">'+t_back_to_farm+"</div>";d+="</div>";d+='<div class="eventgarden_info link" onmouseover="showDiv(\'eventgarden_info_tt\')" onmouseout="hideDiv(\'eventgarden_info_tt\')">';d+='  <div id="eventgarden_info_tt" class="ttbox">';d+="    <div>"+t_eventgarden_help_text1+"</div>";d+='    <div class="name">'+this.data.config.name+"</div>";d+='    <div style="font-weight:bold;">'+t_eventgarden_help_text2+"</div>";d+="    <ul>";d+="      <li>"+t_eventgarden_help_text3+"</li>";d+="      <li>"+t_eventgarden_help_text4+"</li>";d+="      <li>"+t_eventgarden_help_text5+"</li>";d+="    </ul>";d+="  </div>";d+="</div>";d+='<div class="eventtimer">'+t_event_resttime+':&nbsp;<span id="eventgarden_eventtimer"></span></div>';d+='<div id="eventgarden_transp" class="transp"></div>';d+='<div id="eventgarden_tutorial" class="tutorial">';d+='  <div id="eventgarden_tutorial_char" class="char"></div>';d+='  <div id="eventgarden_tutorial_bubble" class="bubble"></div>';d+="</div>";d+='<div id="eventgarden_garden_easteregg"></div>';d+='<div id="eventgarden_garden_easteregg_tricker" class="link" ondblclick="eventgarden.eastereggClick()"></div>';$("eventgarden_container").innerHTML=d;$("eventgarden").className=h+" event_"+this.data.data.event;this.buildGarden();setTimer("eventgarden");showDiv("eventgarden");this.timerUpdate();this.easteregg()};eventgarden.prototype.buildModes=function(){var e=["plant","autoplant","harvest","harvest_all","speedup"];var c="";for(var b=0;b<e.length;b++){var h=t_eventgarden_mode[e[b]].replace("?","");var a="";if(this.mode==e[b]){a="active"}var d="eventgarden.setMode('"+e[b]+"')";c+='<div class="mode '+e[b]+" "+a+' link" onclick="'+d+'" onmouseover="showDiv(\'eventgarden_modes_'+e[b]+"_tt')\" onmouseout=\"hideDiv('eventgarden_modes_"+e[b]+"_tt')\">";c+='  <div id="eventgarden_modes_'+e[b]+'_tt" class="ttbox">';c+="    <div>"+h.charAt(0).toUpperCase()+h.slice(1)+"</div>";c+="  </div>";c+="</div>"}$("eventgarden_modes").innerHTML=c};eventgarden.prototype.setMode=function(c){var b=0;for(var a in this.cache){b++}if(this.mode=="plant"&&b>0){this.plant()}if(this.mode=="harvest"&&b>0){this.harvest()}if(c=="harvest_all"){this.harvestAll();return 1}if(c=="autoplant"){this.autoplantCommit();return 1}if(c=="speedup"){this.speedupCommit();return 1}this.mode=c;this.buildGarden();this.timerUpdate()};eventgarden.prototype.buildGarden=function(){this.blocked={};for(var d in this.data.data.tiles){if(!this.data.data.tiles[d].pid){continue}this.setTiles(this.data.data.tiles[d],d)}var c="";var h=this.data.config.events[this.data.data.event].x;var e=this.data.config.events[this.data.data.event].y;var m=this.data.config.events[this.data.data.event].ignore;var d=1;for(var l=1;l<=e;l++){for(var a=1;a<=h;a++){var b="";if(in_array(d,m)){b="ignore"}c+='<div id="eventgarden_tile'+d+'" class="tile link '+b+'" onclick="eventgarden.clickTile('+d+')">';c+='  <div id="eventgarden_tile'+d+'_pid" class="pid">';if(!in_array(d,m)){c+='<div class="back"></div>'}if(this.blocked&&this.blocked[d]){if(this.blocked[d].preview){b="";if(this.blocked[d]&&this.blocked[d].preview&&this.blocked[d].preview==1){b="plant_pulse"}c+='<div class="loading '+b+'"></div>';if(this.data.data.tiles[d]&&this.data.data.tiles[d].preview){this.data.data.tiles[d].preview++}}else{if(!this.blocked[d].parent){c+='<div id="eventgarden_tile'+d+'_pid_img" class="img '+this.blocked[d].pid+" phase"+this.blocked[d].phase+" dim"+(this.data.config.products[this.blocked[d].pid].x*this.data.config.products[this.blocked[d].pid].y)+'"></div>'}}}c+="  </div>";c+='  <div id="eventgarden_tile'+d+'_hover" class="hover" onmouseover="eventgarden.hoverTile('+d+', 1)" onmouseout="eventgarden.hoverTile('+d+', 0)"></div>';c+="</div>";d++}c+='<div class="clear"></div>'}c+="</div>";$("eventgarden_garden").innerHTML=c;this.buildModes();this.buildStock()};eventgarden.prototype.buildBorder=function(){var c=this.data.config.events[this.data.data.event].x;var b=this.data.config.events[this.data.data.event].y;var r=this.data.config.events[this.data.data.event].ignore;var m=1;var n=(c*b);for(var t=1;t<=b;t++){var l=(Math.floor(m/c)*c)+1;var e=Math.ceil(m/c)*c;for(var u=1;u<=c;u++){if(!in_array(m,r)){var d=(parseInt(m)-1);var v=(parseInt(m)+1);var s=(parseInt(m)-c);var a=(parseInt(m)+c);var h="";var q=[];if(in_array(d,r)||d<l){q.push("left")}if(in_array(v,r)||v>e){q.push("right")}if(in_array(s,r)||s<=0){q.push("top")}if(in_array(a,r)||a>(c*b)){q.push("bottom")}if(in_array("left",q)&&in_array("top",q)){q.push("top-left")}if(in_array("right",q)&&in_array("top",q)){q.push("top-right")}if(in_array("left",q)&&in_array("bottom",q)){q.push("bottom-left")}if(in_array("right",q)&&in_array("bottom",q)){q.push("bottom-right")}if((d>=l)&&in_array(d,r)){if((s>0&&!in_array(s,r))&&((s-1)>0&&!in_array((s-1),r))){q.push("corner-top-left")}if((a<=n&&!in_array(a,r))&&((a-1)<=n&&!in_array((a-1),r))){q.push("corner-bottom-left")}}if((v<=e)&&in_array(v,r)){if((s>0&&!in_array(s,r))&&((s+1)>0&&!in_array((s+1),r))){q.push("corner-top-right")}if((a<=n&&!in_array(a,r))&&((a+1)<=n&&!in_array((a+1),r))){q.push("corner-bottom-right")}}if(in_array("corner-top-left",q)){h+='<div class="border-part corner-top-left"></div>'}if(in_array("corner-bottom-left",q)){h+='<div class="border-part corner-bottom-left"></div>'}if(in_array("corner-top-right",q)){h+='<div class="border-part corner-top-right"></div>'}if(in_array("corner-bottom-right",q)){h+='<div class="border-part corner-bottom-right"></div>'}if(in_array("top-left",q)){h+='<div class="border-part border-top-left"></div>'}if(in_array("top-right",q)){h+='<div class="border-part border-top-right"></div>'}if(in_array("bottom-left",q)){h+='<div class="border-part border-bottom-left"></div>'}if(in_array("bottom-right",q)){h+='<div class="border-part border-bottom-right"></div>'}if(in_array("left",q)&&(!in_array("corner-top-left",q)&&!in_array("corner-bottom-left",q))){h+='<div class="border-part border-left"></div>'}if(in_array("right",q)&&(!in_array("corner-top-right",q)&&!in_array("corner-bottom-right",q))){h+='<div class="border-part border-right"></div>'}if(in_array("top",q)){if(s<=0){h+='<div class="border-part border-top"></div>'}else{if(in_array(s,r)){if(((s-1)<(l-c)||(s+1)>(e-c))){h+='<div class="border-part aa border-top"></div>'}else{if(!in_array((s-1),r)||!in_array((s+1),r)){}else{h+='<div class="border-part border-top"></div>'}}}}}if(in_array("bottom",q)){if(a>(c*b)){h+='<div class="border-part border-bottom"></div>'}else{if(in_array(a,r)){if(((a-1)<(l+c)||(a+1)>(e+c))){h+='<div class="border-part aa border-bottom"></div>'}else{if(!in_array((a-1),r)||!in_array((a+1),r)){}else{h+='<div class="border-part border-bottom"></div>'}}}}}if(h!=""&&!$("eventgarden_tile"+m+"_border")){h='<div id="eventgarden_tile'+m+'_border" class="border">'+h+"</div>";$("eventgarden_tile"+m).insert(h)}}m++}}};eventgarden.prototype.setTiles=function(d,c){var l=this.data.config.events[this.data.data.event].x;var h=c;for(var m=1;m<=this.data.config.products[d.pid].y;m++){for(var a=1;a<=this.data.config.products[d.pid].x;a++){var b="."+m+"."+a;if((this.data.config.products[d.pid].x*this.data.config.products[d.pid].y)==1){b=""}this.blocked[h]={pid:d.pid,part:b};if(c!=h){this.blocked[h].parent=c}var e=0;if(d.preview){e=d.preview}this.blocked[h].preview=e;this.blocked[h].phase=this.pidPhase(d.remain,this.data.config.products[d.pid].duration);h++}h=(parseInt(c)+parseInt(l))}};eventgarden.prototype.clickTile=function(e){var d=this.data.config.events[this.data.data.event].start;if(!this.hoverCheck||(this.mode=="plant"&&this.currentPid=="")){return 1}if(this.mode=="plant"){if(!d[this.currentPid]){return 1}var a=this.currentPid;if(!this.data.data.tiles){this.data.data.tiles={}}this.data.data.tiles[e]={pid:a,preview:1};this.cache[e]=a}if(this.mode=="harvest"){var h=e;if(this.blocked[e].parent){h=this.blocked[e].parent}var a=this.data.data.tiles[h].pid;if(this.data.data.tiles[h].remain>0){this.demolitionTileCommit(h);return 1}this.data.data.tiles[h].preview=1;this.cache[h]=a}this.buildGarden();var c=0;for(var b in this.cache){c++}if(c>=this.cacheClicks){if(this.mode=="plant"){this.plant()}if(this.mode=="harvest"){this.harvest()}}if(this.mode=="plant"&&c>=this.data.data.stock[a]){this.currentPid=""}};eventgarden.prototype.hoverTile=function(s,h){this.currentHoverTile=s;this.hoverCheck=0;var d=this.data.config.events[this.data.data.event].x;var b=this.data.config.events[this.data.data.event].y;var t=this.data.config.events[this.data.data.event].ignore;var a=this.data.config.events[this.data.data.event].start;if(h==1){var n=0;if(this.mode=="plant"){if(in_array(s,t)){return 1}var m=this.currentPid;if(m&&a[m]){var z=[];var r=s;for(var v=1;v<=this.data.config.products[m].y;v++){var e=Math.ceil(r/d)*d;for(var w=1;w<=this.data.config.products[m].x;w++){if(!$("eventgarden_tile"+r+"_hover")||r>e||(this.blocked&&this.blocked[r])||in_array(r,t)){n++}if($("eventgarden_tile"+r+"_hover")&&r<=e&&!in_array(r,t)){var u=(this.data.config.products[m].x*this.data.config.products[m].y);$("eventgarden_tile"+r+"_hover").addClassName(this.mode+u+"_"+v+"_"+w);z.push(r)}r++}r=(parseInt(s)+parseInt(d))}if(n>0){for(var l=0;l<z.length;l++){$("eventgarden_tile"+z[l]+"_hover").className="hover failed"}}}}if(this.mode=="harvest"){if(!this.blocked||!this.blocked[s]){n++}else{var c=s;if(this.blocked[s].parent){c=this.blocked[s].parent}var r=c;var m=this.blocked[r].pid;if(this.data.data.tiles[c]&&this.data.data.tiles[c].remain&&this.data.data.tiles[c].remain>0){}else{for(var v=1;v<=this.data.config.products[m].y;v++){for(var w=1;w<=this.data.config.products[m].x;w++){if(!this.blocked[r]){n++}else{var u=(this.data.config.products[m].x*this.data.config.products[m].y);$("eventgarden_tile"+r+"_hover").addClassName(this.mode+u+"_"+v+"_"+w)}r++}r=(parseInt(c)+parseInt(d))}}}}if(!n>0){this.hoverCheck=1}}else{var q=(b*d);for(var l=1;l<=q;l++){if(!$("eventgarden_tile"+l+"_hover")){continue}$("eventgarden_tile"+l+"_hover").className="hover"}}this.tileTT(h)};eventgarden.prototype.demolitionTileCommit=function(c){var a='<div id="eventgarden_commit">'+t_eventgarden_demolition_question+"</div>";var b="eventgarden.prepareDemolitionTile("+c+")";globalcommitbox(errorheadline,a,b)};eventgarden.prototype.prepareDemolitionTile=function(a){this.cache={};this.cache[a]=this.data.data.tiles[a].pid;this.harvest(1)};eventgarden.prototype.speedupCommit=function(){var c='<div id="eventgarden_commit">';for(var a in this.data.config.speedup){var e=a+"&nbsp;"+t_coins;var d="eventgarden.speedupCommitCommit("+a+")";var b="";if(parseInt(user_coins)<parseInt(a)){d="";b="important"}c+='<div class="coinsbutton_flex link '+b+'" onclick="'+d+'">'+t_eventgarden_speedup_button.replace("%TIME%",formatTime(this.data.config.speedup[a])).replace("%COST%",e)+"</div>"}c+="<div>";globalcommitbox(gardenspeedup_head,c,0,0,1)};eventgarden.prototype.speedupCommitCommit=function(a){var c='<div id="eventgarden_commit">';c+="  <div>"+cityadcost+"</div>";c+='  <div style="font-weight:bold;">'+a+"&nbsp;"+t_coins+"</div>";c+='  <div style="margin-top:10px;">'+gardenspeedup_body.replace("%TIME%",formatTime(this.data.config.speedup[a]))+"</div>";c+="<div>";var d="eventgarden.speedup("+a+")";var b="eventgarden.speedupCommit()";globalcommitbox(gardenspeedup_head,c,d,b)};eventgarden.prototype.pidPhase=function(d,c){var a=1;var b=((d*100)/c);if(b<66){a=2}if(b<33){a=3}if(b<0){a=4}return a};eventgarden.prototype.autoplantCommit=function(){var h="";var e={};for(var a in this.data.data.stock){if(this.data.data.stock[a]<=0){continue}if(!h){h=a}e[a]=this.data.config.products[a]}if(this.currentAutoplantPid==""&&h!=""){this.currentAutoplantPid=h}if(this.currentAutoplantPid&&this.data.data.stock[this.currentAutoplantPid]){h=this.currentAutoplantPid}var c='<div id="eventgarden_commit">';c+="  <div>"+autoplant_select+"</div>";if(h==""){c+='<div class="important" style="margin-top:15px;">'+t_eventgarden_autoplant_no_product+"</div>"}else{c+='<div class="select">';c+='  <div class="line first" onmouseover="eventgarden.autoplantTT(\''+h+"', 1)\" onmouseout=\"eventgarden.autoplantTT('"+h+"', 0)\">";c+='    <div class="col1 eventgarden_product '+h+'"></div>';c+='    <div class="col2">'+this.data.config.products[h].name+"</div>";c+='    <div class="clear"></div>';c+="  </div>";c+='  <div id="eventgarden_autoplant_selector" class="selector isopen link" onclick="eventgarden.autoplantClickSelector()"></div>';c+='  <div class="clear"></div>';c+='  <div id="eventgarden_autoplant_list" class="list">';for(var a in e){c+='<div class="line link" onclick="eventgarden.setAutoplantPid(\''+a+"')\" onmouseover=\"eventgarden.autoplantTT('"+a+"', 1)\" onmouseout=\"eventgarden.autoplantTT('"+a+"', 0)\">";c+='  <div class="col1 eventgarden_product '+a+'"></div>';c+='  <div class="col2">'+this.data.config.products[a].name+"</div>";c+='  <div class="clear"></div>';c+="</div>"}c+="  </div>";c+="</div>";c+='<div id="eventgarden_autoplant_pid_tt" class="ttbox"></div>'}c+="</div>";var d="eventgarden.autoplant()";if(!h){d=""}var b="hideDiv('globaltransp'); hideDiv('globalbox')";globalcommitbox(autoplant_headline,c,d,b)};eventgarden.prototype.autoplantTT=function(b,a){if(a==1){var c=this.itemTT(b);$("eventgarden_autoplant_pid_tt").innerHTML=c;showDiv("eventgarden_autoplant_pid_tt")}else{hideDiv("eventgarden_autoplant_pid_tt")}};eventgarden.prototype.setAutoplantPid=function(a){this.currentAutoplantPid=a;this.autoplantCommit()};eventgarden.prototype.autoplantClickSelector=function(){if($("eventgarden_autoplant_list").style.display=="block"){hideDiv("eventgarden_autoplant_list");$("eventgarden_autoplant_selector").removeClassName("isclose").addClassName("isopen")}else{showDiv("eventgarden_autoplant_list");$("eventgarden_autoplant_selector").removeClassName("isopen").addClassName("isclose")}};eventgarden.prototype.buildStock=function(){var a=this.data.config.events[this.data.data.event];var b=[];if(a.sorting){b=a.sorting}else{for(var h in this.data.data.stock){b.push(h)}}var d="";d+='<div id="eventgarden_stock_items" class="items">';if(this.data.data.stock){for(var c=0;c<b.length;c++){var h=b[c];var l="";var n="eventgarden.setPid('"+h+"')";var e=0;if(this.data.data.stock[h]){e=this.data.data.stock[h]}if(e<=0){l="off";n=""}d+='<div id="eventgarden_item_'+h+'" class="item link '+l+'" onclick="'+n+'" onmouseover="showDiv(\'eventgarden_stock_'+h+"_tt')\" onmouseout=\"hideDiv('eventgarden_stock_"+h+"_tt')\">";d+='  <div class="back"></div>';d+='  <div class="label">';d+='    <div class="eventgarden_product '+h+'"></div>';d+="  </div>";d+='  <div class="amount">'+e+"</div>";d+='  <div id="eventgarden_stock_'+h+'_tt" class="ttbox">'+this.itemTT(h,"stock")+"</div>";d+="</div>"}d+='<div class="clear"></div>'}d+="</div>";var m=t_eventgarden_mode[this.mode];d+='<div class="selected_pid">';d+='  <div id="eventgarden_stock_mode" class="header">'+m.charAt(0).toUpperCase()+m.slice(1)+"</div>";if(this.mode=="plant"){if(this.currentPid!=""){d+='<div class="eventgarden_product '+this.currentPid+'"></div>';d+="<div>"+this.data.config.products[this.currentPid].name+"</div>"}else{d+="<div>"+t_eventgarden_no_plant_selected+"</div>"}}d+="</div>";d+='<div id="eventgarden_stock_checkout" class="checkout link" onclick="eventgarden.openShop()" onmouseover="showDiv(\'eventgarden_checkout_tt\')" onmouseout="hideDiv(\'eventgarden_checkout_tt\')">';d+='  <div id="eventgarden_checkout_tt" class="ttbox">';d+='    <div class="head">'+t_eventgarden_checkout_name+"</div>";d+="    <div>"+t_eventgarden_checkout_desc+"</div>";d+="  </div>";d+="</div>";$("eventgarden_stock").innerHTML=d};eventgarden.prototype.stockWarning=function(){if(this.data.data.warnings>0){return 1}var b=[];if(this.data.data.stock){for(var a in this.data.data.stock){var d=this.data.data.stock[a];if(d<=0){b.push(a)}}}if(b.length>0&&!$("eventgarden_warning")){var c='<div id="eventgarden_warning" onmouseover="eventgarden.hoverStockWarning()">';c+='  <div class="char"></div>';c+='  <div class="bubble">';c+="    <div>"+t_eventgarden_stock_warning+"</div>";c+='    <div class="footer">';c+='      <div class="flexit">';c+='        <input id="eventgarden_warning_checkbox" type="checkbox">';c+='        <div class="checker">'+t_eventgarden_stock_warning_cancel+"</div>";c+="      </div>";c+='      <button class="button_new link" onclick="eventgarden.closeStockWarning()">'+t_vineyard_tutorial_text_finish+"</button>";c+="    </div>";c+="  </div>";c+="</div>";$("eventgarden_stock").insert(c);this.hoverStockWarning()}};eventgarden.prototype.hoverStockWarning=function(){if(this.warningBlock==1){return 1}this.warningBlock=1;var b=[];if(this.data.data.stock){for(var a in this.data.data.stock){var d=this.data.data.stock[a];if(d<=0){b.push(a)}}}$("eventgarden_stock_checkout").addClassName("pulse");setTimeout(function(){if($("eventgarden_stock_checkout")){$("eventgarden_stock_checkout").removeClassName("pulse")}eventgarden.warningBlock=0},2000);for(var c=0;c<b.length;c++){$("eventgarden_item_"+b[c]).addClassName("pulse");eventgarden.resetPulse(b[c])}};eventgarden.prototype.closeStockWarning=function(){if($("eventgarden_warning_checkbox").checked==true){this.disableWarning()}$("eventgarden_warning").remove()};eventgarden.prototype.resetPulse=function(a){setTimeout(function(){if($("eventgarden_item_"+a)){$("eventgarden_item_"+a).removeClassName("pulse")}},2000)};eventgarden.prototype.setPid=function(a){this.currentPid=a;this.setMode("plant")};eventgarden.prototype.openShop=function(){var c=this.data.config.events[this.data.data.event];var a=[];if(c.sorting){a=c.sorting}else{for(var d in c.start){a.push(d)}}var l='<div id="eventgarden_shop">';l+='  <div class="desc">'+t_eventgarden_checkout_desc+"</div>";l+='  <div class="slots">';var m=1;for(var h=0;h<a.length;h++){var d=a[h];var e=0;if(this.data.data.stock[d]){e=this.data.data.stock[d]}var b="";if(m>=5){b="right"}l+='<div class="slot link '+b+'" onclick="eventgarden.detailShop(\''+d+"')\" onmouseover=\"showDiv('eventgarden_shop_"+d+"_tt')\" onmouseout=\"hideDiv('eventgarden_shop_"+d+"_tt')\">";l+='  <div class="eventgarden_product '+d+'">';l+='    <div id="eventgarden_shop_'+d+'_tt" class="ttbox">'+eventgarden.itemTT(d)+"</div>";l+='    <div class="amount">'+e+"</div>";l+="  </div>";l+="</div>";m++}l+="  </div>";l+="</div>";globalBoxFlex(t_eventgarden_checkout_name,l,0,0,1)};eventgarden.prototype.detailShop=function(m){var a=this.data.config.events[this.data.data.event];var c=[];if(a.sorting){c=a.sorting}else{for(var e in a.start){c.push(e)}}if(this.data.config.products[m].money){var n=this.data.config.products[m].money}if(this.data.config.products[m].coins){var n=this.data.config.products[m].coins}var r=0;for(var d=0;d<c.length;d++){r++;if(c[d]==m){this.shopPos=r}}var l='<div id="eventgarden_shop">';l+='  <div class="detail">';l+='    <div class="eventgarden_product '+m+'"></div>';l+='    <div class="name">'+this.data.config.products[m].name+"</div>";for(var h in n){var t="eventgarden.buyShop('"+m+"', "+h+")";var s="";if(this.data.config.products[m].money){var b=formatPrice(n[h]);if(parseFloat(user_bar)<parseFloat(n[h])){t="";s="off"}}else{if(this.data.config.products[m].coins){var b=n[h]+"&nbsp;"+t_coins;if(parseInt(user_coins)<parseInt(n[h])){t="";s="off"}}}l+='<div class="coinsbutton_flex link '+s+'" onclick="'+t+'">'+t_eventgarden_shop_buy_button.replace("%AMOUNT%",h).replace("%COST%",b)+"</div>"}l+="  </div>";if(this.shopPos>1){l+='<div class="navi left link" onclick="eventgarden.naviDetailShop(-1, \''+m+"')\"></div>"}if(this.shopPos<r){l+='<div class="navi right link" onclick="eventgarden.naviDetailShop(1, \''+m+"')\"></div>"}l+="</div>";var t="";var q="eventgarden.openShop()";globalBoxFlex(t_eventgarden_checkout_name,l,t,q)};eventgarden.prototype.naviDetailShop=function(h,d){var c=this.data.config.events[this.data.data.event];var b=[];if(c.sorting){b=c.sorting}else{for(var d in c.start){b.push(d)}}var a=0;var l={};for(var e=0;e<b.length;e++){a++;l[a]=b[e]}this.shopPos+=h;if(this.shopPos<1){this.shopPos=1}if(this.shopPos>a){this.shopPos=a}this.detailShop(l[this.shopPos])};eventgarden.prototype.itemTT=function(d,m){var n="";if(!this.data.config.products[d].harvest){n="important"}var l="";var e=0;var h=checkFarmhouseBonus(this.data.data.event_token);if(h&&h.harvest){e=h.harvest;l="bonus"}var b=0;if(this.data.data.stock[d]){b=this.data.data.stock[d]}var c='<div id="eventgarden_item">';c+='  <div class="headline">'+this.data.config.products[d].name+"</div>";c+='  <div class="img eventgarden_product '+d+'"></div>';c+='  <div class="line">'+t_market_new_instock+"&nbsp;"+b+"</div>";c+='  <div class="line">'+t_felder+"&nbsp;"+(this.data.config.products[d].x*this.data.config.products[d].y)+"</div>";c+='  <div class="line duration">';c+='    <div class="col1"></div>';c+='    <div class="col2">=&nbsp;'+formatTime(this.data.config.products[d].duration)+"</div>";c+="  </div>";c+='  <div class="line harvest">';c+='    <div class="col1"></div>';c+='    <div class="col2">=&nbsp;<span class="'+n+'">'+this.data.config.products[d].harvest+"</span></div>";c+="  </div>";if(n!=""){c+='<div class="warning">'+t_eventgarden_harvest_none_info+"</div>"}c+='  <div class="drops">';c+='    <div class="line" style="font-weight:bold;">'+t_eventgarden_iteminfo_drops+"</div>";for(var a in this.data.config.products[d].drop){var b=this.data.config.products[d].drop[a];if(e){b=Math.ceil(b*(1+e))}c+='<div class="line">';c+='  <div class="col1 eventitem '+this.data.data.event+" item"+a+'"></div>';c+='  <div class="col2"><span class="'+l+'">'+b+"x</span>&nbsp;"+t_eventgarden_eventitem[a]+"</div>";c+="</div>";if(e){c+='<div class="bonus bonus2">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(e*100))+")</div>"}}c+="  </div>";if(m=="stock"){c+='  <div class="buyit link" onclick="eventgarden.detailShop(\''+d+"')\">"+t_eventgarden_item_buyit+"</div>"}c+="</div>";return c};eventgarden.prototype.tileTT=function(c){var b=this.data.config.events[this.data.data.event];var l=this.currentHoverTile;if(this.blocked[l]&&this.blocked[l].parent){l=this.blocked[l].parent}if(c==1){if(this.blocked[l]&&!$("eventgarden_tile_tt")){var a="";if(l<=b.x){a="bottom"}var d=this.blocked[l].pid;var e='<div id="eventgarden_tile_tt" class="'+a+'">';e+='  <div class="name">'+this.data.config.products[d].name+"</div>";if(this.data.data.tiles[l].remain){var h=formatTime(this.data.data.tiles[l].remain);if(this.data.data.tiles[l].remain<=0){h=statusProductionComplete}e+='<div class="timer" id="eventgarden_tile_tt_timer">'+h+"</div>"}e+="</div>";if($("eventgarden_tile"+l)){$("eventgarden_tile"+l).insert(e)}}}else{if($("eventgarden_tile_tt")){$("eventgarden_tile_tt").remove()}}};eventgarden.prototype.timer=function(){this.data.data.remain--;if(this.data.data.remain<=0){if($("eventgarden").style.display=="block"){eventgarden.close()}return 1}if(this.data.data.tiles){if(!missingproductionsData){missingproductionsData={}}if(!missingproductionsData.eventgarden){missingproductionsData.eventgarden={}}missingproductionsData.eventgarden[1]=[];for(var d in this.data.data.tiles){this.data.data.tiles[d].remain--;var b={pid:this.data.data.tiles[d].pid,remain:this.data.data.tiles[d].remain};missingproductionsData.eventgarden[1].push(b)}}var c=0;for(var a in this.cache){c++}if(c>0){this.cacheTimeRunner++;if(this.cacheTimeRunner>=this.cacheTime){if(this.mode=="plant"){this.plant()}if(this.mode=="harvest"){this.harvest()}}}this.timerUpdate()};eventgarden.prototype.timerUpdate=function(){if($("eventgarden_eventtimer")){$("eventgarden_eventtimer").innerHTML=formatTime(this.data.data.remain)}if($("eventgarden_tile_tt")){var m=this.currentHoverTile;if(this.blocked[this.currentHoverTile].parent){m=this.blocked[this.currentHoverTile].parent}if(this.data.data.tiles[m]&&this.data.data.tiles[m].remain){var h=formatTime(this.data.data.tiles[m].remain);if(this.data.data.tiles[m].remain<=0){h=statusProductionComplete}if($("eventgarden_tile_tt_timer")){$("eventgarden_tile_tt_timer").innerHTML=h}}}if(this.data.data.tiles){var l=this.data.config.events[this.data.data.event].x;var e=this.data.config.events[this.data.data.event].y;var a=(l*e);for(var d=1;d<=a;d++){if(!this.blocked[d]||!$("eventgarden_tile"+d+"_pid")||this.blocked[d].parent){continue}var b=this.pidPhase(this.data.data.tiles[d].remain,this.data.config.products[this.blocked[d].pid].duration);if(b!=this.blocked[d].phase){this.blocked[d].phase=b;$("eventgarden_tile"+d+"_pid_img").className="img "+this.blocked[d].pid+" phase"+this.blocked[d].phase+" dim"+(this.data.config.products[this.blocked[d].pid].x*this.data.config.products[this.blocked[d].pid].y)}}}if($("eventgarden").style.display=="block"){for(var c=0;c<this.toogleDivs.length;c++){if(!$(this.toogleDivs[c])||!$(this.toogleDivs[c]).style.display=="block"){continue}hideDiv(this.toogleDivs[c]);this.toogleDivsTmp.push(this.toogleDivs[c])}}};eventgarden.prototype.showDrop=function(b){var a='<div id="eventgarden_commit">';a+="  <div>"+t_cropaction_found+"</div>";a+='  <div class="items">';for(var c in b){a+='<div class="item">';a+='  <div class="eventitem '+this.data.data.event+" item"+c+'"></div>';a+='  <div class="amount">'+b[c]+"x</div>";a+="</div>"}a+="  </div>";a+="</div>";var d="hideDiv('globaltransp'); hideDiv('globalbox')";globalcommitbox("",a,d);hideDiv("globalbox_button2")};eventgarden.prototype.showDaily=function(h){var c='<div id="eventgarden_commit">';c+="  <div>"+t_specialoffer_message+"</div>";var e=0;for(var a in h){if(!this.data.config.products[a]){continue}c+='<div class="line2">';c+='  <div style="margin-right:5px;">'+h[a]+"x</div>";c+='  <div class="eventgarden_product '+a+'"></div>';c+='  <div style="margin-left:5px;">'+this.data.config.products[a].name+"</div>";c+="</div>";e++}c+="</div>";var d="";if(this.data.firstvisit){if(!e){eventgarden.showTutorial();return 1}d="hideDiv('globaltransp'); hideDiv('globalbox'); eventgarden.showTutorial();"}if(!e){return 1}var b=d;globalcommitbox("",c,d,b);hideDiv("globalbox_button2");this.data.daily=0};eventgarden.prototype.showTutorial=function(){$("eventgarden_modes").removeClassName("highlight").removeClassName("disable").removeClassName("pulse");$("eventgarden_stock_items").removeClassName("highlight").removeClassName("disable").removeClassName("pulse");$("eventgarden_stock_checkout").removeClassName("highlight").removeClassName("disable").removeClassName("pulse");if(!t_eventgarden_tutorial_text[this.tutorialStep]){this.closeTutorial();return 1}showDiv("eventgarden_transp");showDiv("eventgarden_tutorial");var b=t_continue;if(!t_eventgarden_tutorial_text[(this.tutorialStep+1)]){b=t_vineyard_tutorial_text_finish}var a=t_eventgarden_tutorial_text[this.tutorialStep].replace("%NAME%","<b>"+username+"</b>");a+='<div class="footer">';a+='  <button class="button_new link" onclick="eventgarden.nextTutorialStep()">'+b+"</button>";a+="</div>";var c="";if(this.tutorialStep==2){c="eventgarden_stock_items"}if(this.tutorialStep==3){c="eventgarden_modes"}if(this.tutorialStep==4){c="eventgarden_stock_checkout"}if(c!=""){$(c).addClassName("highlight").addClassName("disable").addClassName("pulse");setTimeout(function(){if($(c)){$(c).removeClassName("pulse")}},1000)}$("eventgarden_tutorial_bubble").innerHTML=a};eventgarden.prototype.nextTutorialStep=function(){this.tutorialStep++;this.showTutorial()};eventgarden.prototype.closeTutorial=function(){hideDiv("eventgarden_transp");hideDiv("eventgarden_tutorial")};eventgarden.prototype.close=function(){for(var a=0;a<this.toogleDivsTmp.length;a++){showDiv(this.toogleDivsTmp[a])}hideDiv("eventgarden")};eventgarden.prototype.eastereggClick=function(){$("eventgarden_garden_easteregg_btiles").addClassName("move");setTimeout(function(){if($("eventgarden_garden_easteregg_btiles")){$("eventgarden_garden_easteregg_btiles").removeClassName("move")}},8500)};eventgarden.prototype.easteregg=function(){var b=[1,2,3,4,6,9,11,12,13,16,17,18,21,22,23,24,26,27,28,29,31,34,36,37,39,41,44,46,49,51,56,59,61,62,63,64,66,68,69,71,74,76,77,78,81,82,83,86,87,88,89,91,94,96,99,101,104,106,109,111,116,119,121,124,126,129,131,132,133,136,139,141,142,143,144,146,149];var e='<div id="eventgarden_garden_easteregg_btiles" class="btiles">';var h=1;for(var d=1;d<=20;d++){for(var c=1;c<=30;c++){e+='<div class="btile">';if(in_array(h,b)){e+='<div class="full'+getRandom(1,3)+'"></div>'}e+="</div>";h++}e+='<div class="clear"><div>'}e+='  <div class="clear"><div>';e+="<div>";$("eventgarden_garden_easteregg").innerHTML=e};var events=function(){this.data={}};events.prototype.speedlinks=function(){var e=0;var b=0;var d="";for(var c=0;c<this.data.length;c++){var a=this.data[c].name;if(a=="merchant_event"){b=1;continue}var m=a;if(this.data[c].event){if(a=="cropaction"){m+=" action"+this.data[c].event}else{m+=" "+this.data[c].event}}var h=a;if(a=="calendar"){h=t_events_speedlink_calendar_name[this.data[c].event]}else{if(t_events_speedlink_name[a]){h=t_events_speedlink_name[a]}}if(a=="specialoffer"&&t_specialoffer_head[this.data[c].event]){h=t_specialoffer_head[this.data[c].event]}var n=".init()";var l=a+n;if(this.data[c].fn){l=this.data[c].fn}d+='<div id="'+a+'_link" class="link '+m+'" onclick="'+l+'" onmouseover="showDiv(\'event_speedlink_'+a+"_tt')\" onmouseout=\"hideDiv('event_speedlink_"+a+"_tt')\">";d+='  <div class="back"></div>';d+='  <div id="event_speedlink_'+a+'_tt" class="ttbox">'+h+"</div>";d+="</div>";e++}$("event_speedlinks").innerHTML=d;hideDiv("event_speedlinks");$("event_speedlinks").removeClassName("eventsline");$("teaser_links").removeClassName("right");if(e>0&&parseInt(currentuserlevel)>=2){if(eventsline_active==1&&e>=eventsline_count){$("event_speedlinks").addClassName("eventsline");$("event_speedlinks").style.display="flex";$("teaser_links").addClassName("right")}else{showDiv("event_speedlinks")}}hideDiv("merchant_event_link");if(b==1){showDiv("merchant_event_link")}};events.prototype.buyCommit=function(e){var c='<div class="event_buy_commit '+e.name+'">';for(var a in e.buydata){var b=e.buydata[a];c+='<div class="coinsbutton_flex link" onclick="'+e.fn+"("+a+')">';c+="  <div>"+e.line.replace("%AMOUNT%",formatNumber(b)).replace("%COUNT%",formatNumber(b)).replace("%COINS%",a)+"</div>";c+="</div>"}c+="</div>";var d=0;if(e.fnn){d=e.fnn}globalcommitbox(e.head,c,0,d,1)};events.prototype.flyer=function(d){var e="event_flyer"+getRandom(100000,999999);var c="idle";var a="up";if(d.idle){c=d.idle}if(d.move){a=d.move}var b='<div id="'+e+'" class="event_flyer '+d.name+" "+c+'">'+d.html+"</div>";setTimeout(function(){$(d.id).insert(b)},50);setTimeout(function(){if($(e)){$(e).removeClassName(c).addClassName(a)}},250);setTimeout(function(){if($(e)){$(e).remove()}},1250)};events.prototype.buildTimeline=function(l){var b={};if(pentecostevent&&pentecostevent.data){b.pentecostevent={start:pentecostevent.data.config.start,end:pentecostevent.data.config.end,exchange_end:pentecostevent.data.config.exchange_end,exchange_remain:pentecostevent.data.data.remain_exchange}}if(battle&&battle.data){b.battle={start:battle.data.config.start,end:battle.data.config.end,exchange_end:battle.data.config.exchange_end,exchange_remain:battle.data.data.remain_exchange}}if(deliveryevent&&deliveryevent.data){b.deliveryevent={start:deliveryevent.data.config.start,end:deliveryevent.data.config.end,exchange_end:deliveryevent.data.config.exchange_end,exchange_remain:deliveryevent.data.data.remain_exchange}}if(tinkergame&&tinkergame.data){b.tinkergame={start:tinkergame.data.config.start,end:tinkergame.data.config.end,exchange_end:tinkergame.data.config.exchange_end,exchange_remain:tinkergame.data.data.remain_exchange}}if(olympia&&olympia.data&&olympia.data.config){b.olympia={start:olympia.data.config.start,end:olympia.data.config.end,exchange_end:olympia.data.config.exchange_end,exchange_remain:olympia.data.data.remain_exchange}}if(cropaction&&cropaction.data&&cropaction.data.config){b.cropaction={start:cropaction.data.config.start,end:cropaction.data.config.end,exchange_end:cropaction.data.config.exchange_end,exchange_remain:cropaction.data.data.remain_exchange}}if(rainbowevent&&rainbowevent.data&&rainbowevent.data.config){b.rainbowevent={start:rainbowevent.data.config.start,end:rainbowevent.data.config.end,exchange_end:rainbowevent.data.config.exchange_end,exchange_remain:rainbowevent.data.data.remain_exchange}}if(collectevent&&collectevent.data&&collectevent.data.config){b.collectevent={start:collectevent.data.config.start,end:collectevent.data.config.end,exchange_end:collectevent.data.config.exchange_end,exchange_remain:collectevent.data.data.remain_exchange}}if(!b[l]){return""}var e=(b[l].exchange_end-b[l].start);var d=(b[l].end-b[l].start);var h=((d*100)/e);var m=(((e-b[l].exchange_remain)*100)/e);var c="";c+='<div id="event_timeline" class="is_'+l+" only"+eventgarden.data.config.timeline+'">';if(eventgarden.data.config.timeline=="text"){c+='<div class="textbox">';c+='  <div id="events_timeline_part1_line" class="line">';c+='    <div class="icon"></div>';c+="    <div>"+t_events_timeline_event+':&nbsp;<span id="events_timeline_event_remain_tt" class="bold"></span></div>';c+="  </div>";c+='  <div id="events_timeline_part2_line" class="line"></div>';c+="</div>"}else{if(eventgarden.data.config.timeline=="mix"){c+='<div class="tlcols">';c+='  <div class="tlline">';c+='    <div class="tlcol tlcol1 combi">';c+='      <div class="icon" style="margin-right:2px;"></div>';c+='      <div class="">'+t_events_timeline_mix_eventgarden_col_info+"</div>";c+="    </div>";c+='    <div class="tlcol tlcol2">';c+='      <div class="tlbar">';c+='        <div id="events_timeline_bar_inner1" class="tlcol2_inner"></div>';c+="      </div>";c+='      <div id="events_timeline_event_remain_tt" class="tttimer"></div>';c+="    </div>";c+="  </div>";c+='  <div class="tlline">';c+='    <div class="tlcol tlcol1">'+t_events_timeline_mix_exchange_col_info+"</div>";c+='    <div class="tlcol tlcol2">';c+='      <div class="tlbar">';c+='        <div id="events_timeline_bar_inner2" class="tlcol2_inner"></div>';c+="      </div>";c+='      <div id="events_timeline_timer" class="tttimer"></div>';c+="    </div>";c+="  </div>";c+="</div>"}else{c+='<div id="event_timeline_part_eventgarden" class="part event" style="width:'+h+'%;" onmouseover="showDiv(\'events_timeline_event_tt\')" onmouseout="hideDiv(\'events_timeline_event_tt\')">';c+='  <div class="icon"></div>';c+='  <div id="events_timeline_event_tt" class="tt">';c+='    <div class="icon"></div>';c+="    <div>"+t_events_timeline_event+"</div>";c+='    <div id="events_timeline_event_remain_tt" class="tttimer"></div>';c+="  </div>";c+="</div>";c+='<div class="part exchange" style="width:'+(100-h)+'%;" onmouseover="showDiv(\'events_timeline_exchange_tt\')" onmouseout="hideDiv(\'events_timeline_exchange_tt\')">';c+='  <div id="events_timeline_exchange_tt" class="tt">';c+="    <div>"+t_events_timeline_exchange+"</div>";c+='    <div style="margin-top:5px; font-style:italic;">'+t_events_timeline_exchange_add+"</div>";c+="  </div>";c+="</div>";c+='<div class="marker" style="width:'+m+'%;">';var a="";if(m>50){a="right"}c+='  <div class="timer '+a+'">';c+="    <div>"+t_event_resttime+':&nbsp;<span id="events_timeline_timer"></span></div>';c+="  </div>";c+="</div>"}}c+="</div>";c+='<div id="event_eventgarden_link" class="is_'+l+'" onclick="eventgarden.init()" onmouseover="showDiv(\'event_eventgarden_link_tt\')" onmouseout="hideDiv(\'event_eventgarden_link_tt\')">';c+='  <div id="event_eventgarden_link_tt" class="ttbox">'+t_events_goto_eventgarden+"</div>";c+="</div>";return c};events.prototype.timerTimeline=function(d){var b={};if(pentecostevent&&pentecostevent.data&&pentecostevent.data.data){b.pentecostevent={remain:pentecostevent.data.data.remain,remain_exchange:pentecostevent.data.data.remain_exchange}}if(battle&&battle.data&&battle.data.data){b.battle={remain:battle.data.data.remain,remain_exchange:battle.data.data.remain_exchange}}if(deliveryevent&&deliveryevent.data&&deliveryevent.data.data){b.deliveryevent={remain:deliveryevent.data.data.remain,remain_exchange:deliveryevent.data.data.remain_exchange}}if(tinkergame&&tinkergame.data&&tinkergame.data.data){b.tinkergame={remain:tinkergame.data.data.remain,remain_exchange:tinkergame.data.data.remain_exchange}}if(olympia&&olympia.data&&olympia.data.data){b.olympia={remain:olympia.data.remain,remain_exchange:olympia.data.data.remain_exchange}}if(cropaction&&cropaction.data&&cropaction.data.data){b.cropaction={remain:cropaction.data.data.remain,remain_exchange:cropaction.data.data.remain_exchange,exchange_end:cropaction.data.config.exchange_end,start:cropaction.data.config.start,end:cropaction.data.config.end}}if(rainbowevent&&rainbowevent.data&&rainbowevent.data.data){b.rainbowevent={remain:rainbowevent.data.data.remain,remain_exchange:rainbowevent.data.data.remain_exchange,exchange_end:rainbowevent.data.config.exchange_end,start:rainbowevent.data.config.start,end:rainbowevent.data.config.end}}if(collectevent&&collectevent.data&&collectevent.data.data){b.collectevent={remain:collectevent.data.data.remain,remain_exchange:collectevent.data.data.remain_exchange,exchange_end:collectevent.data.config.exchange_end,start:collectevent.data.config.start,end:collectevent.data.config.end}}if(!b[d]){return""}if($("event_timeline")){var h=t_events_timeline_timer_expired;var c=formatTime(b[d].remain_exchange);if(b[d].remain>0){h=formatTime(b[d].remain);var e=(b[d].exchange_end-b[d].end);if(eventgarden.data.config.timeline!="bars"){c=t_events_timeline_exchange_info2.replace("%TIME%",formatTime(e))}}if(eventgarden.data.config.timeline=="text"){$("events_timeline_part1_line").removeClassName("highlight");$("events_timeline_part2_line").removeClassName("highlight");if(b[d].remain>0){var e=(b[d].exchange_end-b[d].end);$("events_timeline_part1_line").addClassName("highlight");$("events_timeline_part2_line").innerHTML=t_events_timeline_exchange_info.replace("%TIME%",formatTime(e))}else{$("events_timeline_part2_line").addClassName("highlight");$("events_timeline_part2_line").innerHTML=t_events_timeline_exchange_remain+':&nbsp;<span id="events_timeline_timer" class="bold"></span>'}}else{if(eventgarden.data.config.timeline=="mix"){if(b[d].remain>0){var e=(b[d].end-b[d].start);var a=Math.min(100,(100-((b[d].remain*100)/e)));$("events_timeline_bar_inner1").style.width=a+"%";$("events_timeline_bar_inner2").style.width="0%"}else{if(b[d].remain_exchange>0){var e=(b[d].exchange_end-b[d].end);percent2=Math.min(100,(100-((b[d].remain_exchange*100)/e)));$("events_timeline_bar_inner1").style.width="100%";$("events_timeline_bar_inner2").style.width=percent2+"%"}}}else{$("event_timeline_part_eventgarden").removeClassName("link").onclick=new Function();if(b[d].remain>0){$("event_timeline_part_eventgarden").addClassName("link").onclick=new Function("eventgarden.init()")}}}if($("events_timeline_event_remain_tt")){$("events_timeline_event_remain_tt").innerHTML=h}if($("events_timeline_timer")){$("events_timeline_timer").innerHTML=c}}if($("event_eventgarden_link")){$("event_eventgarden_link").addClassName("off").removeClassName("link").onclick=new Function();if(b[d].remain>0){$("event_eventgarden_link").removeClassName("off").addClassName("link").onclick=new Function("eventgarden.init()")}else{if(!$("event_eventgarden_link_tt_expired")){$("event_eventgarden_link_tt").insert('<div id="event_eventgarden_link_tt_expired" class="expired">'+t_events_timeline_timer_expired+"</div>")}}}};var factory=function(){this.data={};this.currentPosition=0;this.currentSlot=0;this.type=""};factory.prototype.start=function(e,d,h,m,l){factory.action("start",{farm:farm,position:this.currentPosition,slot:this.currentSlot,item:h,guildjob:l})};factory.prototype.speedup=function(b,a){factory.action("speedup",{farm:farm,position:this.currentPosition,slot:b,coins:a})};factory.prototype.buy=function(a){factory.action("buy",{farm:farm,position:this.currentPosition,slot:a})};factory.prototype.action=function(a,b){ajaxAction("farm",a,b,factory.response)};factory.prototype.response=function(b,a,c){global_speedup_block=0;factory.data=b[1];locationinfo=b[1];factory.inner(c.position)};factory.prototype.inner=function(a){if(this.data.slots){for(var d=1;d<=3;d++){if(!this.data.slots[d]||this.data.slots[d].pid){continue}if(this.data.slots[d].slotremain){if(gametimer.farm_productions&&gametimer.farm_productions[farm]&&gametimer.farm_productions[farm][a]){}else{if(!gametimer.farm_productions){gametimer.farm_productions={}}if(!gametimer.farm_productions[farm]){gametimer.farm_productions[farm]={}}gametimer.farm_productions[farm][a]=1}}}}this.currentPosition=a;if(in_array(this.data.buildingid,[7,8,9,10,25])){this.type="factory"}if(in_array(this.data.buildingid,[13,14])){this.type="oil"}if(this.data.buildingid==16){this.type="strickerei"}if(this.data.buildingid==21){this.type="tea"}var c="";c+='<div class="slots">';for(var d=1;d<=3;d++){if(d>1&&(!this.data.slots||!this.data.slots[d]||!this.data.slots[d].cost)){continue}c+=htmlProductionSlot(farm,a,d)}c+="</div>";for(var b=2;b<=this.data.level;b++){showDiv("update_"+this.data.buildingid+"_"+b);showDiv("update_"+this.data.buildingid+"_"+b+"_ani");if(this.data.buildingid==14&&b==5){showDiv("update_14_5_1");showDiv("update_14_5_2")}if(stopanimation==1){c+='<div id="buildingani_'+this.data.buildingid+"_"+b+'_static"></div>'}else{c+='<div id="buildingani_'+this.data.buildingid+"_"+b+'"></div>'}}$("innercontent").innerHTML=c;if(this.data.buildingid==9&&this.data.level==5){$("innermaincontainer").className="inner_back inner_back9_5"}else{$("innermaincontainer").className="inner_back inner_back"+this.data.buildingid}updateProductionSlot(farm,a)};factory.prototype.speedupCommit=function(a,b){globalSpeedupBox(this.type,a,b)};factory.prototype.buyCommit=function(d){var b="";if(factory.data.slots[d].cost[1]){var a=slot_buy.replace("%MONEY%",factory.data.slots[d].cost[1]+"&nbsp;"+gamecurrency)}if(factory.data.slots[d].cost[2]){var a=slot_rent.replace("%COINS%",factory.data.slots[d].cost[2][0]+"&nbsp;"+t_coins);a=a.replace("%TIME%",formatTime(factory.data.slots[d].cost[2][1]))}var c="factory.buy("+d+")";globalcommitbox(b,a,c)};factory.prototype.selection=function(l){this.currentSlot=l;var h=t_factory_produce_head;var b='<div id="product_slot_selection">';for(var e in this.data.products){var d=0;if(this.data.cropbonus){d=this.data.cropbonus}var a=0;if(specialbonus){var c=specialbonus.findBonus({key1:"production",key2:"harvest"});if(c&&in_array(this.data.buildingid,c.buildings)){a=c.harvest}}b+=htmlProductSlotSelection(this.type,e,this.data.products[e],0,this.currentPosition,this.currentSlot,d,a)}b+='<div class="clear"></div>';if(in_array(this.type,["strickerei","factory"])&&checkIsValidGuildJobProduct()){b+='<div class="factory_selection_guild_head">'+t_select_product_guild+"</div>";for(var e in this.data.products){if(job_data.guild_job_data.data.products[this.data.products[e][2][0]]){b+=htmlProductSlotSelection(this.type,e,this.data.products[e],1,this.currentPosition,this.currentSlot,0)}}b+='<div class="clear"></div>'}b+="</div>";globalBoxFlex(h,b,0,0,1)};var factory=new factory();var farm_move=1;var farm_number=1;var farms_data={farms:{},count:0,freegardenspeedup:0,freegardenspeedup2:0};var farm_checker=[];var farm_checker_open=0;var farm_water_checker=0;var farmersmarket_data=0;var farmersmarket_firstvisit=1;var farmersmarket_firstvisit_session=0;function farmBuyOption(c){var a={block:0,tt:0};if(farms_data.blocked[c]){var b="";if(farms_data.blocked[c].questblock||farms_data.blocked[c].questblock2||farms_data.blocked[c].levelblock||farms_data.blocked[c].block||farms_data.blocked[c].premiumblock){if(farms_data.blocked[c].questblock){b=str_replace("%FARM%",c,t_getnextfarmquest);b=str_replace("%QUEST%",farms_data.blocked[c].questblock,b)}if(farms_data.blocked[c].questblock2){b=str_replace("%FARM%",c,t_getnextfarmquest2);b=str_replace("%QUEST%",farms_data.blocked[c].questblock2,b)}if(farms_data.blocked[c].levelblock){b=str_replace("%FARM%",c,t_getnextfarmlevel);b=str_replace("%LEVEL%",farms_data.blocked[c][0],b)}if(farms_data.blocked[c].premiumblock){b+=t_premium_only}if(farms_data.blocked[c].block){b=t_coming_soon}a.block=1;a.tt=b}else{if(c>=5){if(farms_data.count<4){a.block=1;a.tt=str_replace("%FARM%",4,t_map_previous_farm_required)}}else{if(c>(parseInt(farms_data.count)+1)){a.block=1;a.tt=str_replace("%FARM%",(parseInt(farms_data.count)+1),t_map_previous_farm_required)}else{a.tt=str_replace("%FARM%",c,t_map_farm_buy);a.tt=str_replace("%MONEY%",formatPrice(farms_data.blocked[c][1]),a.tt)}}}}return a}function farmBuild(){var h="";for(var d=1;d<=const_maxfarms;d++){var r="";if(xmastime==1){r="_xmas"}var m="farm_back"+d+r;h+='<div class="farm_back '+m+'">';if(farmdeco&&farm_farmdeco_active==1){h+='<div id="farm_farmdeco'+d+'" class="farm_farmdeco"></div>'}h+='  <div id="farm_positions'+d+'" class="farm_positions"></div>';if(d>1&&d<=4){h+='<div class="farm_scroller farm_scroller_l link" onclick="farmMove('+(d-1)+')" onmouseover="showDiv(\'farm_scroller_l'+(d-1)+"')\" onmouseout=\"hideDiv('farm_scroller_l"+(d-1)+"')\">";h+='  <div id="farm_scroller_l'+(d-1)+'" class="ttbox farm_scroller_tt_l link">'+farmname+(d-1)+"</div>";h+="</div>"}if(d<4&&farms_data.farms[d]){var a=0;if(farms_data.farms[(d+1)]){var s="farmMove("+(d+1)+")";var b=farmname+(d+1);var c=""}if(farms_data.blocked[(d+1)]){var e=farmBuyOption((d+1));if(e.tt!=""){var b=e.tt}if(e.block){a=1;var c="max-width:550px"}else{s="openMap(); mapDialog('buy_farm', "+(d+1)+")"}}h+='<div class="farm_scroller farm_scroller_r link" onclick="'+s+'" onmouseover="showDiv(\'farm_scroller_r'+(d+1)+"')\" onmouseout=\"hideDiv('farm_scroller_r"+(d+1)+"')\">";if(a==1){h+='<div style="top:5px;" class="rack_lock maketransp"></div>'}h+='  <div id="farm_scroller_r'+(d+1)+'" class="ttbox farm_scroller_tt_r link" style="'+c+'">'+b+"</div>";h+="</div>"}h+="</div>"}h+='<div class="clear"></div>';var q=str_replace("%LEVEL%",farmersmarket_access_level,error1005);var s="";if(farmersmarket_data){h+=buildFarmersMarket();q=t_farmers_market;s="farmMove(99)"}h+='<div id="farm_inner_new_area_teaser" class="link" onmouseover="showDiv(\'farm_inner_new_area_teaser_tt\')" onmouseout="hideDiv(\'farm_inner_new_area_teaser_tt\')" onclick="'+s+'">';h+='  <div id="farm_inner_new_area_teaser_tt" class="ttbox">'+q+"</div>";h+="</div>";if(farmersmarket_firstvisit==1){h+='<div id="farmersmarket_teaser" class="link" onmouseover="showDiv(\'farm_inner_new_area_teaser_tt\')" onmouseout="hideDiv(\'farm_inner_new_area_teaser_tt\')" onclick="'+s+'">';h+='  <div id="farmersmarket_teaser_tt" class="ttbox">';h+=t_farmersmarket_teaser;h+='    <div id="farmersmarket_teaser_tt_arrow"></div>';h+="  </div>";h+="</div>"}h+='<div id="farm_inner_headquarter" class="link" onclick="initFarmhouse();" onmouseover="showDiv(\'farm_inner_headquarter_tt\')" onmouseout="hideDiv(\'farm_inner_headquarter_tt\')">';h+='  <div id="hq_upgrade6_ani"></div>';h+='  <div id="hq_upgrade7_ani1"></div>';h+='  <div id="hq_upgrade7_ani2"></div>';h+='  <div id="hq_upgrade7_ani3"></div>';h+='  <div id="hq_upgrade8_ani"></div>';h+='  <div id="hq_upgrade9_ani"></div>';h+='  <div id="hq_upgrade10_ani1"></div>';h+='  <div id="hq_upgrade10_ani2"></div>';h+='  <div id="hq_upgrade11_ani"></div>';h+='  <div id="hq_upgrade1"></div>';h+='  <div id="hq_upgrade2"></div>';h+='  <div id="hq_upgrade3"></div>';h+='  <div id="hq_upgrade16_ani"></div>';h+='  <div id="hq_upgrade22_ani"></div>';h+='  <div id="hq_upgrade23_ani1"></div>';h+='  <div id="hq_upgrade23_ani2"></div>';h+='  <div id="hq_upgrade24_ani1"></div>';h+='  <div id="hq_upgrade24_ani2"></div>';h+='  <div id="hq_upgrade30_ani1"></div>';h+='  <div id="hq_upgrade31_ani1"></div>';h+='  <div id="hq_upgrade36_ani1"></div>';h+='  <div id="hq_upgrade37_ani1"></div>';h+='  <div id="hq_upgrade37_ani2"></div>';h+='  <div id="hq_upgrade38_ani1"></div>';h+='  <div id="hq_upgrade39_ani1"></div>';for(var d in farmhouse_style_config){if(d<40){continue}h+='<div id="hq_upgrade'+d+'_ani1"></div>'}h+='  <div id="farm_inner_headquarter_tt" class="ttbox">'+t_building_headquarter+"</div>";h+="</div>";if(player_guild>0&&player_guildmemberstatus>1){var l="farm_inner_guildlink";if(guildquestrun==1){l+=" pulse"}h+='<div id="farm_inner_guildlink" class="'+l+' link" onclick="initGuild();" onmouseover="showDiv(\'farm_inner_guildlink_tt\');" onmouseout="hideDiv(\'farm_inner_guildlink_tt\')">';h+='  <div id="farm_inner_guildlink_tt" class="ttbox">'+t_guildlink_name+"</div>";h+="</div>"}if(greenhouse_active==1){var n="";if(xmastime){n="xmas"}h+='<div id="greenhouse_link" class="link '+n+'" onclick="greenhouse.init()" onmouseover="showDiv(\'greenhouse_link_tt\')" onmouseout="hideDiv(\'greenhouse_link_tt\')">';h+='  <div id="greenhouse_link_tt" class="ttbox">'+t_greenhouse_name+"</div>";h+="</div>"}if(!tutorial&&currentuserlevel>=dog_minlevel){h+='<div id="farm_dog" class="farm_dog link" onclick="showFarmDog()" onmouseover="showDiv(\'farm_dog_tt\');" onmouseout="hideDiv(\'farm_dog_tt\')">';h+='  <div id="farm_dog_tt" class="ttbox">'+t_farmdog_name+"</div>";h+="</div>"}if(!tutorial&&currentuserlevel>=5){h+='<div id="farm_actionsheep_transp" class="transp"></div>';h+='<div id="farm_actionsheep_bubble">';h+='  <div id="farm_actionsheep_bubble_inner"></div>';h+='  <div class="mini_close link" onclick="closeActionSheep()"></div>';h+="</div>";h+='<div id="farm_actionsheep" class="link" onclick="clickActionSheep()" onmouseover="showDiv(\'farm_actionsheep_tt\');" onmouseout="hideDiv(\'farm_actionsheep_tt\')">';h+='  <div id="farm_actionsheep_tt" class="ttbox"></div>';h+='  <div id="farm_actionsheep_flyer" class="panflyer"></div>';h+="</div>"}if(!tutorial&&currentuserlevel>=farmhouse_designer_level){h+='<div id="farm_inner_architect" class="link" onclick="farmAction(\'initarchitect\', 1, 1);" onmouseover="showDiv(\'farm_inner_architect_tt\');" onmouseout="hideDiv(\'farm_inner_architect_tt\')">';h+='  <div id="farm_inner_architect_tt" class="ttbox">'+t_architect_name+"</div>";if(!architect_farmhousebonus_info&&farmhouse_style_config[39]){h+='<div class="info pulse">!</div>'}h+="</div>"}if(!tutorial&&currentuserlevel>=donkey_cropbonus_level){var n="farm_inner_waltraud";if(donkey_isset==1){n="farm_inner_waltraud_active"}h+='<div id="farm_inner_waltraud" class="'+n+' link" onclick="farmAction(\'dailydonkey\', 1, 1);" onmouseover="showDiv(\'farm_inner_waltraud_tt\');" onmouseout="hideDiv(\'farm_inner_waltraud_tt\')">';h+='  <div id="farm_inner_waltraud_tt" class="ttbox">'+t_donkey_name+"</div>";h+="</div>";h+='<div id="farm_inner_48hbonus" class="link" onclick="showCropBonusBox();" onmouseover="showDiv(\'farm_inner_48hbonus_tt\');" onmouseout="hideDiv(\'farm_inner_48hbonus_tt\')">';h+='  <div id="farm_inner_48hbonus_tt" class="ttbox">'+t_cropbonus_name+"</div>";if(blackfriday_action==1){h+='<div id="cropbonus_blackfriday_out" class="blackfriday_mini"></div>'}h+="</div>"}if(timeline){h+='<div id="timeline_link" class="link" onclick="whyWhyOpen()" onmouseover="showDiv(\'timeline_link_tt\')" onmouseout="hideDiv(\'timeline_link_tt\')">';h+='  <div id="timeline_link_tt" class="ttbox">'+t_timeline_name+"</div>";h+="</div>"}h+='<div id="customerstats"></div>';h+='<div id="customerstatsinfo" class="ttbox"></div>';h+='<div id="customerline"></div>';h+='<div id="customerline2"></div>';if(!stopanimation&&(("animation" in $("farm_inner").style)||("-webkit-animation" in $("farm_inner").style))){h+='<div id="farm_ani1"></div>';h+='<div id="farm_ani2"></div>'}$("farm_inner").innerHTML=h;$("farm_inner").style.width=(const_maxfarms*730)+"px";farmBuildPositions();setFarmis();if(farmersmarket_data){setFarmersMarket()}}function farmBuildPositions(){for(var C in farms_data.farms){var n="";for(var B in farms_data.farms[C]){var e=farms_data.farms[C][B];n+='<div id="farm'+C+"_pos"+B+'" class="farm_pos">';if(e.buildingid){n+='  <div id="farm'+C+"_pos"+B+'_back" class="bm'+e.buildingid+' farm_pos_back link"></div>';if(!stopanimation){var D={2:2,4:2,5:1,12:2,15:2,18:1};if(D[e.buildingid]){for(var l=1;l<=D[e.buildingid];l++){n+='<div class="farm_pos_ani'+e.buildingid+"_"+l+' farm_pos_ani"></div>'}}}}if(e.bulldoze){n+='<div id="farm'+C+"_pos"+B+'_back" class="bmb'+e.bulldoze.id+' farm_pos_back"></div>'}n+='  <div id="farm'+C+"_pos"+B+'_click" class="farm_pos_click link"></div>';var m=0;var a="";if(e.special_unlock){for(var c in e.special_unlock){if(e.special_unlock[c].level){var q=0;if(e.special_unlock[c].compare_level){q=e.special_unlock[c].compare_level}else{if(c=="megafield"&&farms_data.megafield_level){q=farms_data.megafield_level}else{if(c=="hillwalk"&&farms_data.hillwalk_level){q=farms_data.hillwalk_level}else{if(farmersmarket_data&&farmersmarket_data[c]){if(farmersmarket_data[c].level){q=farmersmarket_data[c].level}else{if(farmersmarket_data[c].data&&farmersmarket_data[c].data.level){q=farmersmarket_data[c].data.level}else{if(farmersmarket_data[c].info&&farmersmarket_data[c].info.level){q=farmersmarket_data[c].info.level}}}}else{if(farms_data.unlocklevels&&farms_data.unlocklevels[c]){q=farms_data.unlocklevels[c]}}}}}if(e.special_unlock[c].level>q){var G={megafield:t_megafield,megafruit:t_megafruit_name,butterfly:t_butterflyhouse_name,vet:t_vet_name,pets:t_pets_name,hillwalk:t_hillwalk_name};a+="<div>"+t_farm_position_special_unlock_level.replace("%LEVEL%",e.special_unlock[c].level).replace("%TYPE%",G[c])+"</div>";var b=0;if(q>0){b=Math.min(100,((q*100)/e.special_unlock[c].level))}a+='<div style="margin-top:10px; padding-top:10px; border-top:1px dashed #ccc;">';a+='  <div style="position:relative; width:100px; height:10px; background-color:black; margin:0 auto; border-radius:2px; overflow:hidden;">';a+='    <div style="position:absolute; top:0px; left:0px; height:100%; width:'+b+'%; background-color:green;"></div>';a+="  </div>";a+="  <div>"+q+"/"+e.special_unlock[c].level+"</div>";a+="</div>";m=1}}}}if(e.bulldoze&&(e.bulldoze.questblock||e.bulldoze.levelblock||m==1)){n+='<div class="farm_pos_lock" onmouseover="showDiv(\'farm_pos_lock'+C+"_"+B+"')\" onmouseout=\"hideDiv('farm_pos_lock"+C+"_"+B+"')\">";var F="";if(e.bulldoze.questblock){F=str_replace("%QUEST%",e.bulldoze.quest[1],t_needs_quest);F='<div style="margin:5px;">'+str_replace("%CAMPAIGN%",e.bulldoze.quest[0],F)+"</div>"}if(a!=""){F+='<div style="margin:5px;">'+a+"</div>"}if(e.bulldoze.levelblock){F+='<div style="margin:5px;">'+str_replace("%LEVEL%",e.bulldoze.level,noupdate_lowlevel)+"</div>"}n+='  <div id="farm_pos_lock'+C+"_"+B+'" class="ttbox farm_pos_lock_tt">'+F+"</div>";n+="</div>"}n+='  <div id="farm'+C+"_pos"+B+'_tt" class="ttbox farm_pos_tt">';if(e.bulldoze){n+="<div>"+infobulldozegroundheadline+"<br>"+formatPrice(e.bulldoze.cost)+"</div>"}if(e.name){var r="";if(C==5&&e.buildingid==1){r='<div class="bonusinfo" style="font-size:10px;">'+t_building_buy_exotic_info+"</div>"}if(C==6&&e.buildingid==1){r='<div class="bonusinfo" style="font-size:10px;">'+t_building_buy_alpine_info+"</div>"}n+='<div class="farm_pos_tt_name">'+e.name+"</div>"+r}if(e.premiumblock){n+='<div class="bonusinfo important">'+inforequirepremium+"</div>"}n+="  </div>";if(e.level){n+='<div class="farm_pos_level">';for(var l=1;l<=e.level;l++){n+='<div class="icon_star farm_pos_level_item"></div>'}n+='  <div class="clear"></div>';n+="</div>"}if(e.premiumblock){}else{n+='<div id="farm_buttons'+C+"_"+B+'" class="farm_buttons">';if(e.upgrade){n+='<div id="farm_button_upgrade'+C+"_"+B+'" class="farm_button_upgrade button_upgrade link" onmouseover="showDiv(\'farm_upgrade_tt'+C+"_"+B+"')\" onmouseout=\"hideDiv('farm_upgrade_tt"+C+"_"+B+"')\">";n+='  <div id="farm_upgrade_tt'+C+"_"+B+'" class="ttbox farm_button_tt">';n+="    <div>"+infoupdatebuilding+"</div>";if(e.upgrade.cost){var r=formatPrice(e.upgrade.cost)}if(e.upgrade.coins){var r=e.upgrade.coins+"&nbsp;"+t_coins}n+="    <div>"+r+"</div>";if(e.upgrade.block){n+='<div class="bonusinfo important">'+str_replace("%LEVEL%",e.upgrade.level,error1005)+"</div>"}n+="  </div>";n+="</div>"}if(e.destruct){n+='<div id="farm_button_destruct'+C+"_"+B+'" class="farm_button_destruct button_destruct link" onmouseover="showDiv(\'farm_destruct_tt'+C+"_"+B+"')\" onmouseout=\"hideDiv('farm_destruct_tt"+C+"_"+B+"')\">";n+='  <div id="farm_destruct_tt'+C+"_"+B+'" class="ttbox farm_button_tt">'+infodestructbuilding+"</div>";n+="</div>"}if(const_speedup_addon==1&&e.speedup){n+='<div id="farm_button_speedup'+C+"_"+B+'" class="farm_button_speedup button_speedup link" onmouseover="showDiv(\'farm_speedup_tt'+C+"_"+B+"')\" onmouseout=\"hideDiv('farm_speedup_tt"+C+"_"+B+"')\">";n+='  <div id="farm_speedup_tt'+C+"_"+B+'" class="ttbox farm_button_tt">'+building_speeduptext+"</div>";n+="</div>"}if(e.infinitequestlinebonus&&infinitequestline.data&&infinitequestline.data.data){var w=1;if(infinitequestline.data.data.current<1&&!infinitequestline.data.data.bonus){w=0}if(w==1){n+='<div id="farm_button_infinitequestlinebonus'+C+"_"+B+'" class="farm_button_infinitequestlinebonus button_infinitequestlinebonus link" onmouseover="showDiv(\'farm_infinitequestlinebonus_tt'+C+"_"+B+"')\" onmouseout=\"hideDiv('farm_infinitequestlinebonus_tt"+C+"_"+B+"')\">";n+='  <div id="farm_infinitequestlinebonus_tt'+C+"_"+B+'" class="ttbox farm_button_tt">';n+="    <div><b>"+t_infinitequestline_name+"</b></div>";n+='    <div id="farm_infinitequestlinebonus_tt'+C+"_"+B+'_bonus" style="margin-top:5px;">'+t_infinitequestline_bonus_set_active_tt+"</div>";n+="  </div>";n+="</div>"}}if(e.buildingid&&e.buildingid==1){if(currentuserlevel>=autoplant_level&&(premium>0||(!premium&&autoplant_allow_loads==1))){n+='<div id="farm_button_autoplant'+C+"_"+B+'" class="farm_button_autoplant button_autoplant link" onmouseover="showDiv(\'farm_autoplant_tt'+C+"_"+B+"')\" onmouseout=\"hideDiv('farm_autoplant_tt"+C+"_"+B+"')\">";n+='  <div id="farm_autoplant_tt'+C+"_"+B+'" class="ttbox farm_button_tt">'+autoplant_info+"</div>";n+="</div>"}if(!tutorial||tutorial>=4){var r="";if(farms_data.freegardenspeedup||farms_data.freegardenspeedup2){r="_free"}n+='<div id="farm_button_gardenspeedup'+C+"_"+B+'" class="farm_button_gardenspeedup speedupgardenbutton'+r+' link" onmouseover="showDiv(\'farm_speedup_tt'+C+"_"+B+"')\" onmouseout=\"hideDiv('farm_speedup_tt"+C+"_"+B+"')\">";n+='  <div id="farm_speedup_tt'+C+"_"+B+'" class="ttbox farm_button_tt">'+gardenspeedup_head+"</div>";n+="</div>"}}n+="</div>";if(e.product){n+='<div id="farm_gardenproduct'+C+"_"+B+'" class="stt'+e.product+' farm_gardenproduct link" onmouseover="showDiv(\'farm_gardenproduct'+C+"_"+B+"_tt')\" onmouseout=\"hideDiv('farm_gardenproduct"+C+"_"+B+"_tt')\">";n+='  <div id="farm_gardenproduct'+C+"_"+B+'_tt" class="ttbox" style="left:0px; top:25px;">'+produkt_name[e.product]+"</div>";n+="</div>"}n+='<div id="farm_garden_water_timer'+C+"_"+B+'" class="farm_garden_water_timer"></div>';if(e.production){var s=e.production[0].pid;var t=e.production[0].remain;for(var A=1;A<e.production.length;A++){if(e.production[A].remain<t){s=e.production[A].pid}}var d="";if(xmastime){d="xmas"}n+='<div id="farm_production_timer'+C+"_"+B+'" class="farm_production_timer '+d+'"></div>';n+='<div class="farm_pos_production is_bld'+e.buildingid+'">';n+='  <div id="farm_production_running'+C+"_"+B+'">';if(in_array(e.buildingid,[2,15])){n+='<div class="farm_production_back'+e.buildingid+'"></div>';n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_front'+e.buildingid+'"></div>'}if(in_array(e.buildingid,[3,4,5,11,12,25])){if(in_array(e.buildingid,[3,4])){n+='<div class="farm_production_back2_'+e.buildingid+'"></div>'}n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_back'+e.buildingid+'"></div>';n+='<div class="farm_production_front'+e.buildingid+'"></div>'}if(e.buildingid==7){n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_back'+e.buildingid+"_"+s+'"></div>';n+='<div class="farm_production_front'+e.buildingid+"_"+s+'"></div>'}if(e.buildingid==8){if(s==27){n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_cheese1 farm_production_front'+e.buildingid+"_"+s+'"></div>'}else{n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_back'+e.buildingid+"_"+s+'"></div>';n+='<div class="farm_production_front'+e.buildingid+"_"+s+'"></div>'}}if(e.buildingid==9){n+='<div class="farm_production_back'+e.buildingid+"_"+s+'"></div>';n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_front'+e.buildingid+"_"+s+'"></div>'}if(e.buildingid==10){n+='<div class="farm_production_back'+e.buildingid+'"></div>';n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_front'+e.buildingid+'"></div>'}if(in_array(e.buildingid,[13,14,16,17,18,20,21,23])){n+='<div id="farm_production_mover'+C+"_"+B+'" class="farm_production_front'+e.buildingid+'"></div>'}n+="  </div>";if(in_array(e.buildingid,[7,8,9])){n+='<div id="farm_production_ready'+C+"_"+B+'" class="farm_production_ready'+e.buildingid+"_"+s+'"></div>'}else{n+='<div id="farm_production_ready'+C+"_"+B+'" class="farm_production_ready'+e.buildingid+'"></div>'}n+="</div>"}}if(e.premium){n+='<div class="icon_premium farm_pos_premium"></div>'}n+="</div>"}if($("farm_positions"+C)){$("farm_positions"+C).innerHTML=n}}farm_checker=[];delete gametimer.farm_productions;delete gametimer.farm_water;for(var C in farms_data.farms){if(C>farms_data.count){break}for(var B=1;B<=6;B++){if($("farm"+C+"_pos"+B+"_click")){$("farm"+C+"_pos"+B+"_click").onmouseover=new Function("");$("farm"+C+"_pos"+B+"_click").onmouseout=new Function("")}}}for(var C in farms_data.farms){for(var B in farms_data.farms[C]){var e=farms_data.farms[C][B];if(e.buildingid>0||e.bulldoze){var h="showDiv('farm_buttons"+C+"_"+B+"');";var v="hideDiv('farm_buttons"+C+"_"+B+"');";if(usetouch==1||!$("farm_buttons"+C+"_"+B)){var h="";var v="";showDiv("farm_buttons"+C+"_"+B)}$("farm"+C+"_pos"+B+"_click").onmouseover=new Function("farmHoverPosition(1, "+C+", "+B+"); "+h);$("farm"+C+"_pos"+B+"_click").onmouseout=new Function("farmHoverPosition(0, "+C+", "+B+"); "+v);$("farm"+C+"_pos"+B+"_tt").onmouseover=new Function("farmHoverPosition(1, "+C+", "+B+"); "+h);$("farm"+C+"_pos"+B+"_tt").onmouseout=new Function("farmHoverPosition(0, "+C+", "+B+"); "+v);if(!usetouch&&$("farm_buttons"+C+"_"+B)){$("farm_buttons"+C+"_"+B).onmouseover=new Function("farmHoverPosition(1, "+C+", "+B+"); "+h);$("farm_buttons"+C+"_"+B).onmouseout=new Function("farmHoverPosition(0, "+C+", "+B+"); "+v)}}var u="";if(e.premiumblock){u="globalerrorbox('"+inforequirepremium+"')"}else{if(e.buildingid&&e.buildingid==6){u="showMain(); initGuild();"}else{if(e.buildingid&&e.buildingid==19){u="showMain(); buildMegafield();"}else{if(e.buildingid&&e.buildingid==1){u="specialZoneFieldHandler("+B+");"}else{if(e.bulldoze){u="bulldozeZone("+B+");"}else{if(e.buildingid==0&&e.status==1){u="fillBuildBox("+B+");"}else{if(e.buildingid&&e.buildingid==22){u="hillwalk.init();"}else{if(e.buildingid&&e.buildingid==23){u="sushibar.init();"}else{if(e.buildingid&&e.buildingid==24){u="spicehouse.init();"}else{u="initLocation("+B+")"}}}}}}}}if(e.upgrade){var E="";if(!e.upgrade.block){E="fillBuildBox("+B+");"}$("farm_button_upgrade"+C+"_"+B).onclick=new Function(E)}if(e.destruct){$("farm_button_destruct"+C+"_"+B).onclick=new Function("destructBuildingInit("+B+", "+e.buildingid+");")}if(e.speedup){$("farm_button_speedup"+C+"_"+B).onclick=new Function("globalSpeedupBox('speedup_addon', "+B+", 1);")}if(e.infinitequestlinebonus&&$("farm_button_infinitequestlinebonus"+C+"_"+B)){$("farm_button_infinitequestlinebonus"+C+"_"+B).onclick=new Function("infinitequestline.setbonusCommit("+C+", "+B+");")}if(e.buildingid&&e.buildingid==1){if($("farm_button_autoplant"+C+"_"+B)){$("farm_button_autoplant"+C+"_"+B).onclick=new Function("autoPlantCommit("+B+", 1);")}if($("farm_button_gardenspeedup"+C+"_"+B)){$("farm_button_gardenspeedup"+C+"_"+B).onclick=new Function("initGardenSpeedup("+B+");")}if(e.product){$("farm_gardenproduct"+C+"_"+B).onclick=new Function("changeGardenSpecial("+B+", "+e.product+")")}}if(e.production){if(!gametimer.farm_productions){gametimer.farm_productions={}}if(!gametimer.farm_productions[C]){gametimer.farm_productions[C]={}}gametimer.farm_productions[C][B]=1}if(e.water){if(!gametimer.farm_water){gametimer.farm_water={}}if(!gametimer.farm_water[C]){gametimer.farm_water[C]={}}gametimer.farm_water[C][B]=1}}if($("farm"+C+"_pos"+B+"_click")){$("farm"+C+"_pos"+B+"_click").onclick=new Function(u)}if(infinitequestline.data.data&&infinitequestline.data.data.bonus){if(infinitequestline.data.data.bonus.farm==C&&infinitequestline.data.data.bonus.position==B&&$("farm_button_infinitequestlinebonus"+C+"_"+B)){$("farm_button_infinitequestlinebonus"+C+"_"+B).addClassName("active")}}}}}function farmHoverPosition(a,b,c){if(a==1){showDiv("farm"+b+"_pos"+c+"_tt");if($("farm_production_timer"+b+"_"+c)){$("farm_production_timer"+b+"_"+c).addClassName("farm_production_timer_hover")}if($("farm_production_timer"+b+"_"+c)){$("farm_garden_water_timer"+b+"_"+c).addClassName("farm_garden_water_timer_hover")}if($("farm_production_display"+b+"_"+c+"_timer")){$("farm_production_display"+b+"_"+c+"_timer").addClassName("farm_production_timer_hover")}}else{hideDiv("farm"+b+"_pos"+c+"_tt");if($("farm_production_timer"+b+"_"+c)){$("farm_production_timer"+b+"_"+c).removeClassName("farm_production_timer_hover")}if($("farm_production_timer"+b+"_"+c)){$("farm_garden_water_timer"+b+"_"+c).removeClassName("farm_garden_water_timer_hover")}if($("farm_production_display"+b+"_"+c+"_timer")){$("farm_production_display"+b+"_"+c+"_timer").removeClassName("farm_production_timer_hover")}}}function farmProductions(){for(var B in farms_data.farms){for(var A in farms_data.farms[B]){hideDiv("farm_button_speedup"+B+"_"+A)}}for(var B in gametimer.farm_productions){for(var A in gametimer.farm_productions[B]){if(farms_data.farms[B][A].production){var n="";var d=farms_data.farms[B][A].production[0].time;var t=farms_data.farms[B][A].production[0].pid;if(farms_data.farms[B][A].buildingid==17){}if(farms_data.farms[B][A].buildingid==18){farms_data.farms[B][A].production[0].remain--;var v=farms_data.farms[B][A].production[0].remain}else{if(gametimer.farm_productions[B][A]){var w=farms_data.farms[B][A].production[0].remain;var m=0;for(var e in farms_data.farms[B][A].production){if(farms_data.farms[B][A].production[e]){if(w>farms_data.farms[B][A].production[e].remain){w=farms_data.farms[B][A].production[e].remain;m=e}farms_data.farms[B][A].production[e].remain--}}}var v=farms_data.farms[B][A].production[m].remain;t=farms_data.farms[B][A].production[m].pid}if(v>0){if($("advancedproduction"+B+"_"+A)){$("advancedproduction"+B+"_"+A).innerHTML=formatTime(v)}showDiv("farm_production_running"+B+"_"+A);hideDiv("farm_production_ready"+B+"_"+A);var q=formatTime(v);var a=Math.ceil((v*100)/d);var s={2:80,3:60,4:50,5:60,10:47,11:54,12:80,15:74,25:100};if(s[farms_data.farms[B][A].buildingid]){var u=((s[farms_data.farms[B][A].buildingid]/100)*(100-a));$("farm_production_mover"+B+"_"+A).style.height=u+"px"}if(farms_data.farms[B][A].buildingid==8){if(t==27){var z=(100/8);var c=(8-Math.ceil(a/z));if(!c){c=1}$("farm_production_mover"+B+"_"+A).className="farm_production_cheese"+c+" farm_production_front8_27"}else{if(t==111){var u=((66/100)*(100-a));$("farm_production_mover"+B+"_"+A).style.height=u+"px"}}}if(farms_data.farms[B][A].buildingid==7){var C=57;if(t==144){var C=110}var u=((C/100)*(100-a));$("farm_production_mover"+B+"_"+A).style.height=u+"px"}if(farms_data.farms[B][A].buildingid==9){var C=81;if(t==152){var C=82}var u=((81/100)*(100-a));$("farm_production_mover"+B+"_"+A).style.height=u+"px"}showDiv("farm_button_speedup"+B+"_"+A)}else{if($("advancedproduction"+B+"_"+A)){$("advancedproduction"+B+"_"+A).innerHTML=statusProductionComplete;setCompleteProductionAdvanced(A)}hideDiv("farm_production_running"+B+"_"+A);showDiv("farm_production_ready"+B+"_"+A);var q=statusProductionComplete;if(t>0){var r=0;for(var E=0;E<farm_checker.length;E++){if(farm_checker[E].farm==B&&farm_checker[E].position==A){r++}}var D={pid:t,farm:B,position:A};if(!r){farm_checker.push(D)}}}}updateProductionSlot(B,A);if(t>0){n+='<div class="kp'+t+'" style="float:left; margin:5px;"></div>'}n+='<div style="float:left; margin-top:5px;">'+q+"</div>";n+='<div class="clear"></div>';if($("farm_production_timer"+B+"_"+A)){$("farm_production_timer"+B+"_"+A).innerHTML=n}}}if(farm_checker.length>0&&currentuserlevel>=3&&(farm>0||forestry_quicknavi==1||foodworld_quicknavi==1||train_quicknavi==1)&&premium){var l=0;for(var B=0;B<farm_checker.length;B++){if(!farm_checker[B].pid){continue}l++}if(l>0){showDiv("farm_production_checker_icon")}farmChecker()}else{hideDiv("farm_production_checker_icon")}}function farmWater(){if(farm_water_checker==1){for(var c in gametimer.farm_water){for(var b in gametimer.farm_water[c]){if(farms_data.farms[c][b].water){var d=0;for(var a=0;a<farms_data.farms[c][b].water.length;a++){if(farms_data.farms[c][b].water[a].waterremain<=0){if(farms_data.farms[c][b].water[a].remain>0){d++}}if(d>0){break}}if(d>0){showDiv("farm_garden_water_timer"+c+"_"+b)}else{hideDiv("farm_garden_water_timer"+c+"_"+b)}}}}}}function farmCheckerOpen(){showDiv("farm_production_checker");if(farm_checker_open==1){farm_checker_open=0;$("farm_production_checker").removeClassName("farm_production_checker_on");$("farm_production_checker").addClassName("farm_production_checker_off")}else{farm_checker_open=1;$("farm_production_checker").addClassName("farm_production_checker_on");$("farm_production_checker").removeClassName("farm_production_checker_off");farmChecker()}}function farmChecker(){if(!farm_checker_open){return false}html="";html2="";for(var h=0;h<farm_checker.length;h++){var l=farm_checker[h];var b="kp"+l.pid;var d=produkt_name[l.pid];if(l.pid){var a="farmMove("+l.farm+");";if(l.farm=="forestry"){a="mapGo2Location('forestry')";b="f_m_symbol"+l.pid;d=produkt_name_forestry[l.pid]}if(l.farm=="foodworld"){a="mapGo2Location('picknick')"}if(l.farm=="eventgarden"){a="eventgarden.init()";b="eventgarden_product "+l.pid;d=products_eventgarden[l.pid].name}var e="";e+='<div class="link farm_checker_line" onclick="farmCheckerOpen(); showMain(); '+a+'">';if(l.type&&in_array(l.type,["hillwalk"])){if(l.type=="hillwalk"){e+='<div style="padding:5px;">';e+='  <div style="font-weight:bold;">'+t_hillwalk_name+"</div>";e+="  <div>"+t_hillwalk_farmchecker_finished+"</div>";e+="</div>"}}else{e+='  <div class="'+b+'" style="float:left; margin:5px; width:15px;"></div>';e+='  <div style="float:left; margin-top:5px; width:100px;">'+d+"</div>";e+='  <div class="clear"></div>'}e+="</div>";if(l.type&&in_array(l.type,["hillwalk"])){html2+=e}else{html+=e}}}if(html2!=""){html2='<div style="width:143px; margin:10px 0px; border-top:1px solid black;"></div>'+html2}$("farm_production_checker_inner").innerHTML=html+html2}function farmMove(b){if(b!=farm_number){if(city>0||foodworld_quicknavi>0||forestry_quicknavi>0||train_quicknavi>0){for(var a=1;a<=farms_data.count;a++){if(a==b){showDiv("farm_positions"+a)}else{hideDiv("farm_positions"+a)}}$("farm_inner").className="farm_move"+b+"_set"}else{if(farm_move==1&&(("transition" in $("farm_inner").style)||("webkitTransition" in $("farm_inner").style))&&((farm_number<=4||farm_number==99||farm_number==100)&&(b<=4||b==99||b==100))){showDiv("farm_positions"+b);if(farm_number==99){if(b===100){$("farm_inner").className="farm_move_go_down";setTimeout("$('farm_inner').className = 'farm_move100_set';",400)}else{$("farm_inner").className="farm_move_go_up";setTimeout("$('farm_inner').className = 'farm_move"+b+"';",400)}}else{if(farm_number==100){if(b==99){$("farm_inner").className="farm_move_go_up2";setTimeout("$('farm_inner').className = 'farm_move99_set';",400)}else{$("farm_inner").className="farm_move_go_up";setTimeout("$('farm_inner').className = 'farm_move"+b+"';",400)}}else{if(b==99){$("farm_inner").addClassName("farm_move99");setTimeout("$('farm_inner').className = 'farm_move99_set'",800)}else{if(b==100){$("farm_inner").addClassName("farm_move100");setTimeout("$('farm_inner').className = 'farm_move100_set'",800)}else{$("farm_inner").className="farm_move"+b}}}}}else{for(var a=1;a<=farms_data.count;a++){if(a==b){showDiv("farm_positions"+a)}else{hideDiv("farm_positions"+a)}}$("farm_inner").className="farm_move"+b+"_set"}}}farm_number=b;farm=farm_number;if(farm==1&&powerupactive){showDiv("powerupcontainer")}else{hideDiv("powerupcontainer")}if(player_guild>0&&player_guildmemberstatus>1){showDiv("farm_inner_guildlink")}else{hideDiv("farm_inner_guildlink")}closeFoodcontest();if(city>0){showMain()}hideDiv("transp");hideDiv("building_inner");hideDiv("innermaincontainer");city=0;inguild=0;foodworld_quicknavi=0;forestry_quicknavi=0;train_quicknavi=0;speedLinks();initActionSheep();if((b!=99&&b!=100)&&$("reallocatebuilding_symbol")&&reallocatebuilding_status==1){showDiv("reallocatebuilding_symbol")}if((b!=99&&b!=100)&&$("reallocateanimals_symbol")&&reallocateanimals_status==1){showDiv("reallocateanimals_symbol")}if(b==99||b==100){if($("box_button")){$("box_button").style.top="356px"}hideDiv("reallocatebuilding_symbol");hideDiv("reallocateanimals_symbol")}else{if($("box_button")){$("box_button").style.top="210px"}}setTutorialLine();if(tutorial==5||tutorial==10||tutorial==11){initCity(1)}if(tutorial==3){specialZoneFieldHandler(1)}if(farm==99&&farmersmarket_firstvisit==1&&!farmersmarket_firstvisit_session){openFarmersMarketHowTo()}if(farm>4&&(farm!=99&&farm!=100)){$("lager_info_button_tt").innerHTML=str_replace("%FARM%",farm,t_map_rack_transfer_info_button);showDiv("lager_info_button")}else{hideDiv("lager_info_button")}}function showFarmDog(){showDiv("transp");showDiv("farm_dog_box");var a='<div class="headline">'+t_farmdog_name+"</div>";if(farmdog_isset){if(farmdog_harvest==1){a+=t_farmdog_info3}else{a+=t_farmdog_info2;a+='<div id="farm_dog_button"><button type="button" id="farm_dog_button_link" class="coinsbutton_small link" onclick="farmAction(\'dogbonus\', '+farm+', 0)">'+t_farmdog_button2+"</button></div>"}}else{a+=t_farmdog_info1;a+='<div id="farm_dog_button"><a href="'+PAYMENTLINK+'" target="_blank"><button type="button" class="coinsbutton_small link">'+t_farmdog_button1+"</button></a></div>"}$("farm_dog_box_inner").innerHTML=a}function closeFarmDog(){hideDiv("transp");hideDiv("farm_dog_box")}function buildFarmersMarket(){var c=farmersmarket_data;var b="";var d="";if(xmastime==1){d="_xmas"}b+='<div class="farm_back farm_back99'+d+'">';for(var a=1;a<=6;a++){b+=buildFarmersMarketPosition(a)}b+='  <div id="farmersmarket_howto_link" class="link" onclick="openFarmersMarketHowTo()" onmouseover="showDiv(\'farmersmarket_howto_link_tt\')" onmouseout="hideDiv(\'farmersmarket_howto_link_tt\')">';b+='    <div id="farmersmarket_howto_link_tt" class="ttbox">';b+="      <div>"+t_farmersmarket_helper+"</div>";b+='      <div id="farmersmarket_howto_link_tt_arrow"></div>';b+="    </div>";b+="  </div>";b+='  <div id="farm99_scroller" class="link" onclick="farmMove(2);" onmouseover="showDiv(\'farm99_scroller_tt\')" onmouseout="hideDiv(\'farm99_scroller_tt\')">';b+='    <div id="farm99_scroller_tt" class="ttbox">'+t_farm99_scroller_tt+"</div>";b+="  </div>";if(farmersmarket_addon==1){b+='  <div class="scroller bottom link" onclick="farmMove(100);" onmouseover="showDiv(\'farm99_bottom_scroller_tt\')" onmouseout="hideDiv(\'farm99_bottom_scroller_tt\')">';b+='    <div id="farm99_bottom_scroller_tt" class="ttbox">'+t_farmers_market+"&nbsp;2</div>";b+="  </div>"}b+="</div>";b+='<div class="clear"></div>';if(farmersmarket_addon==1){var d="";if(xmastime==1){d="_xmas"}b+='<div class="farm_back farm_back100'+d+'">';for(var a=7;a<=12;a++){b+=buildFarmersMarketPosition(a)}b+='  <div id="farmersmarket_howto2_link" class="link" onclick="openFarmersMarketHowTo()" onmouseover="showDiv(\'farmersmarket_howto2_link_tt\')" onmouseout="hideDiv(\'farmersmarket_howto2_link_tt\')">';b+='    <div id="farmersmarket_howto2_link_tt" class="ttbox">';b+="      <div>"+t_farmersmarket_helper+"</div>";b+='      <div id="farmersmarket_howto2_link_tt_arrow"></div>';b+="    </div>";b+="  </div>";b+='  <div class="scroller top link" onclick="farmMove(99);" onmouseover="showDiv(\'farm100_top_scroller_tt\')" onmouseout="hideDiv(\'farm100_top_scroller_tt\')">';b+='    <div id="farm100_top_scroller_tt" class="ttbox">'+t_farmers_market+"&nbsp;1</div>";b+="  </div>";b+="</div>"}setTimer("flowergardener");setTimer("flowerslots");setTimer("nursery");setTimer("flowerarea");setTimer("megafruit");setTimer("foodcontest");setTimer("vet");setTimer("pets");setTimer("cowracing");setTimer("butterfly");setTimer("fishing");setTimer("vineyard");setTimer("scouts");return b}function buildFarmersMarketPosition(d){var e="bottom";if(d>3){e="top"}var c="";c+='<div id="farmersmarket_pos'+d+'" class="farmersmarket_pos link">';c+='  <div id="farmersmarket_pos'+d+'_tt" class="ttbox farmersmarket_pos_tt_'+e+'"></div>';if(d==1&&!stopanimation){c+='<div id="farmersmarket_pos1_ani1"></div>';c+='<div id="farmersmarket_pos1_ani2"></div>'}if(d==7){c+='<div id="farmersmarket_pos7_ani1"></div>'}var a="";if(xmastime){a="xmas"}c+='  <div id="farmersmarket_pos'+d+'_block" class="farmersmarket_pos_block"></div>';c+='  <div id="farmersmarket_pos'+d+'_timer" class="farmersmarket_pos_timer '+a+'"></div>';c+='  <div id="farmersmarket_pos'+d+'_progress" class="farmersmarket_pos_progress"></div>';c+='  <div id="farmersmarket_pos'+d+'_click"></div>';c+='  <div id="farmersmarket_buttons_'+d+'">';c+='    <div id="farmersmarket_button_upgrade_'+d+'" class="farm_button_upgrade button_upgrade link" onmouseover="showDiv(\'farmersmarket_button_upgrade_'+d+"_tt')\" onmouseout=\"hideDiv('farmersmarket_button_upgrade_"+d+"_tt')\">";c+='      <div id="farmersmarket_button_upgrade_'+d+'_tt" class="farmersmarket_button_upgrade_tt ttbox"></div>';c+="    </div>";c+="  </div>";c+="</div>";c+='<div id="farmersmarket_pos'+d+'_inner"></div>';if(d==1){c+='<div id="flowers_gardener" class="flowers_gardener_idle link" onclick="flowersGardener()" onmouseover="showDiv(\'flowers_gardener_tt\')" onmouseout="hideDiv(\'flowers_gardener_tt\')">';c+='  <div id="flowers_gardener_hello" class="ttbox">';c+=t_gardener_hello;c+='    <div id="flowers_gardener_hello_arrow"></div>';c+="  </div>";c+='  <div id="flowers_gardener_tt" class="ttbox">'+t_gardener+"</div>";c+="</div>";c+='<div id="flowers_gardener_box"></div>';for(var b=1;b<=17;b++){if(b==1){c+='<div id="farmersmarket_deco_row1">'}c+='  <div id="farmersmarket_deco'+b+'" class="farmersmarket_deco_item link">';c+='    <div id="farmersmarket_deco'+b+'_pid"></div>';c+='    <div id="farmersmarket_deco'+b+'_water" class="flowerslots_water"></div>';c+='    <div id="farmersmarket_deco'+b+'_plant_cursor" class="flowerslots_plant_cursor"></div>';c+='    <div id="farmersmarket_deco'+b+'_water_cursor" class="flowerslots_water_cursor"></div>';c+='    <div id="farmersmarket_deco'+b+'_remove_cursor" class="flowerslots_remove_cursor"></div>';c+='    <div id="farmersmarket_deco'+b+'_nowater_cursor" class="flowerslots_nowater_cursor"></div>';c+='    <div id="farmersmarket_deco'+b+'_status"></div>';c+='    <div id="farmersmarket_deco'+b+'_points" class="flowerslots_points"></div>';c+='    <div id="farmersmarket_deco'+b+'_tt" class="ttbox" style="display:none; left:auto; right:10px; top:50px; min-width:150px;"></div>';c+="  </div>";if(b==7){c+="</div>";c+='<div id="farmersmarket_deco_row2">'}}c+="</div>";c+='<div id="flowerfarmi_cart">';c+='  <div id="flowerfarmi_cart_head"></div>';c+='  <div id="flowerfarmi_cart_content"></div>';c+='  <div id="flowerfarmi_cart_submit"></div>';c+="</div>";c+='<div id="farmersmarket_deco_bar_opener" onmouseover="showDiv(\'farmersmarket_deco_bar_box\')" onmouseout="hideDiv(\'farmersmarket_deco_bar_box\')"></div>';c+='<div id="farmersmarket_deco_bar_box">';c+='  <div style="margin-bottom:5px;">'+str_replace("%POINTS%",formatNumber(flowerfarmis_createlimit),t_flowerfarmi_bar_info)+"</div>";c+='  <div id="farmersmarket_deco_bar">';c+='    <div id="farmersmarket_deco_bar_inner"></div>';c+='    <div id="farmersmarket_deco_bar_front"></div>';c+='    <div id="farmersmarket_deco_points"></div>';c+="  </div>";c+="</div>";c+='<div id="farm_flowerfarmis_line"></div>'}return c}function openFarmersMarketHowTo(b,e,d){showDiv("transp");showDiv("farmersmarket_howto");farmersmarket_firstvisit_session=1;var c=["flowers","rewards","megafruit","foodcontest","vet","pets","butterfly","cowracing","fishing","vineyard","scouts"];for(var a=0;a<c.length;a++){hideDiv("farmersmarket_howto_navi_item_"+c[a]);if($("farmersmarket_howto_inner_"+c[a])&&$("farmersmarket_howto_navi_item_"+c[a])){hideDiv("farmersmarket_howto_inner_"+c[a]);$("farmersmarket_howto_navi_item_"+c[a]).removeClassName("farmersmarket_howto_navi_item_"+c[a]+"_active");$("farmersmarket_howto_navi_item_"+c[a]).onclick=new Function("openFarmersMarketHowTo('"+c[a]+"', "+e+")")}}hideDiv("farmersmarket_howto_inner_rewards1");hideDiv("farmersmarket_howto_inner_rewards2");if(farm==100){var h=["rewards","butterfly","cowracing","fishing","vineyard","scouts"];showDiv("farmersmarket_howto_inner_rewards2")}else{var h=["flowers","rewards","megafruit","foodcontest","vet","pets"];showDiv("farmersmarket_howto_inner_rewards1")}for(var a=0;a<h.length;a++){showDiv("farmersmarket_howto_navi_item_"+h[a])}if(!b&&farm==100){b="butterfly"}else{if(!b){b="flowers"}}showDiv("farmersmarket_howto_inner_"+b);$("farmersmarket_howto_navi_item_"+b).addClassName("farmersmarket_howto_navi_item_"+b+"_active");$("farmersmarket_howto_close").onclick=new Function("closeFarmersMarketHowTo("+e+", '"+d+"')");if(e==1){$("transp").style.zIndex=25}if(b=="vet"){handleVetHelp(1)}}function closeFarmersMarketHowTo(b,a){if(b>0){$("transp").style.zIndex=20}else{hideDiv("transp")}hideDiv("farmersmarket_howto");if(a=="cowracing_raceselection"){cowracing.raceSelection()}if(a=="cowracing_startteam"){cowracing.startTeamCommit()}}function setFarmersMarket(){var l=farmersmarket_data;if(l){var a=6;if(farmersmarket_addon==1){a=12}for(var e=1;e<=a;e++){if(l.pos&&l.pos[e]){if(e==1){var b="initFlowerArea()"}if(e==2){var b="initNursery()"}if(e==3){var b="initMegaFruit()"}if(e==4){var b="pets.init()"}if(e==5){var b="initVet()"}if(e==6){var b="initFoodcontest()"}if(e==7){var b="butterfly.init()"}if(e==8){var b="cowracing.build()"}if(e==9){var b="fishing.init()"}if(e==10){var b="vineyard.init()"}if(e==11){var b="scouts.build()"}$("farmersmarket_pos"+e+"_tt").innerHTML=l.pos[e].name;if(l.pos[e].cost){$("farmersmarket_pos"+e+"_tt").innerHTML+="<div>"+formatPrice(l.pos[e].cost)+"</div>"}if(l.pos[e].update){var d="<div>"+infoupdatebuilding+"</div>";if(l.pos[e].cost){d+=formatPrice(l.pos[e].cost)}$("farmersmarket_button_upgrade_"+e+"_tt").innerHTML=d;showDiv("farmersmarket_button_upgrade_"+e)}else{hideDiv("farmersmarket_button_upgrade_"+e)}hideDiv("farmersmarket_pos"+e+"_block");if(l.pos[e].block){if(l.pos[e].cost){if(l.pos[e].costblock){b=""}else{b="buyFarmersMarketBuilding("+e+")"}}else{b=""}showDiv("farmersmarket_pos"+e+"_block");if(l.pos[e].costblock){$("farmersmarket_pos"+e+"_tt").innerHTML+='<br><div class="important">'+str_replace("%COST%",formatPrice(l.pos[e].cost),error1001)+"</div>"}if(l.pos[e].level){$("farmersmarket_pos"+e+"_tt").innerHTML+='<br><br><div class="important">'+str_replace("%LEVEL%",l.pos[e].level,error1005)+"</div>"}}$("farmersmarket_pos"+e+"_click").onclick=new Function(b);var b="";if(l.pos[e].update&&l.pos[e].cost){b="buyFarmersMarketBuilding("+e+")"}else{b=""}$("farmersmarket_button_upgrade_"+e).onclick=new Function(b);var c="showDiv('farmersmarket_buttons_"+e+"');";var h="hideDiv('farmersmarket_buttons_"+e+"');";if(usetouch==1||!$("farmersmarket_buttons_"+e)){var c="";var h="";showDiv("farmersmarket_buttons_"+e)}$("farmersmarket_pos"+e).onmouseover=new Function("showDiv('farmersmarket_pos"+e+"_tt'); $('farmersmarket_pos"+e+"_timer').removeClassName('farmersmarket_pos_timer_off');  $('farmersmarket_pos"+e+"_timer').addClassName('farmersmarket_pos_timer_on'); "+c);$("farmersmarket_pos"+e).onmouseout=new Function("hideDiv('farmersmarket_pos"+e+"_tt'); $('farmersmarket_pos"+e+"_timer').removeClassName('farmersmarket_pos_timer_on');  $('farmersmarket_pos"+e+"_timer').addClassName('farmersmarket_pos_timer_off'); "+h)}}updateFarmersMarketFarmis();setFlowerSlots();setFlowerFarmis(-1);timerNursery();timerFlowerArea();timerMegaFruit();if(farmersmarket_firstvisit==1){showDiv("farmersmarket_teaser")}else{hideDiv("farmersmarket_teaser")}}}function updateFarmersMarketFarmis(){var b="";var c=0;for(var a=0;a<farmersmarket_data.farmis.length;a++){var d=farmersmarket_data.farmis[a];if(!$("flowerfarmi"+d.id)){b+='<div id="flowerfarmi'+d.id+'" class="link flowerfarmis_item flowerfarmi'+d.img+"_idle flowerfarmis_pos"+(a+1)+'" onclick="showCart('+d.id+', 1)" onmouseover="setFlowerFarmiBubble('+d.id+');" onmouseout="hideDiv(\'flowerfarmi'+d.id+"_tt')\">";b+='  <div id="flowerfarmi'+d.id+'_emotion" class="flowerfarmi_emotion"></div>';b+='  <div id="flowerfarmi'+d.id+'_tt" class="flowerfarmi_tt">';b+='    <div class="flowerfarmi_bubble">';b+='      <div id="flowerfarmi_bubble'+d.id+'"></div>';b+="    </div>";b+='    <div class="flowerfarmi_bubblearrow"></div>';b+="  </div>";b+="</div>";c++}}if(c>0){$("farm_flowerfarmis_line").innerHTML+=b}}function buyFarmersMarketBuilding(b){var c="farmAction('buyfarmersmarketbuilding', 1, 1, "+b+")";var d=str_replace("%BUILDING%",farmersmarket_data.pos[b].name,t_buybuilding_head);var l=str_replace("%BUILDING%",farmersmarket_data.pos[b].name,t_buybuilding_body);var a='<div style="width:350px;">';var h="";var e="";if(carpentry_bonus>0){h="*";e='<div class="bonusinfo">'+str_replace("%BONUS%",carpentry_bonus,t_price_add_carpentry)+"</div>"}a+=str_replace("%COST%",formatPrice(farmersmarket_data.pos[b].cost)+h,l)+e;a+="</div>";globalBox(d,a,c)}var actionsheep={};function initActionSheep(){if($("farm_actionsheep")){hideDiv("farm_actionsheep");if(actionsheep.remain>0){showDiv("farm_actionsheep");var a=t_actionsheep_head;if(actionsheep.giver>0){a+='<div class="bonusinfo">'+str_replace("%POINTS%",actionsheep.giver,t_giverinfo)+"</div>"}$("farm_actionsheep_tt").innerHTML=a}}}function clickActionSheep(){if(actionsheep.giver>0){farmAction("actionsheep_click",1,1);$("farm_actionsheep_flyer").innerHTML="+"+actionsheep.giver;$("farm_actionsheep_flyer").addClassName("panflyer_ani");setTimeout(function(){hideDiv("farm_actionsheep_flyer")},1000)}showDiv("farm_actionsheep_transp");showDiv("farm_actionsheep_bubble");var a="";a+='<div class="headline" style="font-size:16px; margin-top:10px; margin-bottom:20px;">'+t_actionsheep_head+"</div>";a+='<div style="font-size:16px; margin-bottom:20px; font-weight:bold;">'+str_replace("%BONUS%",actionsheep.bonus,t_actionsheep_info)+"</div>";a+='<div style="font-size:16px; margin-bottom:20px;">'+str_replace("%TIME%","<b>"+actionsheep.end+"</b>",t_actionsheep_time)+"</div>";a+='<a href="'+paymentlink+'" target="_blank" style="text-decoration:none;"><div id="farm_actionsheep_coinsbutton" class="coins_button">'+t_coins_buy_menu+"</div></a>";$("farm_actionsheep_bubble_inner").innerHTML=a}function closeActionSheep(){if($("farm_actionsheep")){hideDiv("farm_actionsheep_transp");hideDiv("farm_actionsheep_bubble")}}var global_speedup_block=0;function globalSpeedupBox(l,e,r){var m=0;if(l=="garden"){var d=speedupgarden[0]}else{if(l=="nursery"&&farmersmarket_data.nursery&&farmersmarket_data.nursery.speedup){var d=farmersmarket_data.nursery.speedup;m=specialbonus.findBonus({key1:"flowers",key2:"productionspeedup"})}else{if(l=="flowerarea"){var d=farmersmarket_data.flowerarea_speedup;m=specialbonus.findBonus({key1:"flowers",key2:"fertilize"})}else{if(l=="foodworld"){var d=foodworldspeedup[e];m=specialbonus.findBonus({key1:"foodworld",key2:"productionspeedup"})}else{if(l=="forestry_speedup"){var d=forestry_bld_fertilize;m=specialbonus.findBonus({key1:"forestry",key2:"productionspeedup"})}else{if(l=="forestry_fertilize"){var d=forestry_fertilize;m=specialbonus.findBonus({key1:"forestry",key2:"fertilize"})}else{if(l=="vet_disease_speedup"){var d=vet_data.disease_speedup;m=specialbonus.findBonus({key1:"vet",key2:"treatmentspeedup"})}else{if(l=="vet_production_slot_speedup"){var d=vet_data.production_speedup;m=specialbonus.findBonus({key1:"vet",key2:"productionspeedup"})}else{if(l=="pets_production_slot_speedup"&&pets&&pets.data&&pets.data.config){var d=pets.data.config.speedup;m=specialbonus.findBonus({key1:"pets",key2:"productionspeedup"})}else{if(l=="fishing_production_slot_speedup"&&fishing&&fishing.data&&fishing.data.config){var d=fishing.data.config.production_speedup}else{if(l=="scouts_production_slot_speedup"&&scouts&&scouts.data&&scouts.data.config){var d=scouts.data.config.production_speedup;m=specialbonus.findBonus({key1:"scouts",key2:"productionspeedup"})}else{if(l=="sushibar_production_slot_speedup"&&sushibar&&sushibar.data&&sushibar.data.config){var d=sushibar.data.config.production_speedup;m=specialbonus.findBonus({key1:"sushibar",key2:"productionspeedup"})}else{if(in_array(l,["cowracing_production_slot_speedup","cowracing_feed_speedup"])&&cowracing&&cowracing.data&&cowracing.data.config){var d=cowracing.data.config.speedup;if(l=="cowracing_production_slot_speedup"){m=specialbonus.findBonus({key1:"cowracing",key2:"productionspeedup"})}}else{if(l=="fuelstation_speedup"){var d=farms_data.farms[farm][e].data.constants.speedup}else{if(l=="map_tour"){var d=farms_data.map.config.speedup}else{if(in_array(l,["oil","tea","strickerei"])){var d=factory.data.speedup}else{if(in_array(l,["speedup_addon"])){var t=farms_data.farms[farm][e].buildingid;if(!speedup_addon[t]){return 1}var d=speedup_addon[t]}}}}}}}}}}}}}}}}}var b=0;if(l=="forestry_speedup"&&forestry_coinsaction==1){b=1}var n=building_speeduptext;if(l=="garden"||l=="forestry_fertilize"){n=gardenspeedup_head}if(l=="vet_disease_speedup"){n=t_vet_disease_speedup_head}if(l=="map_tour"){n=t_speedup_dialog_routetime_head}var u="";var h='<div class="headline">'+n+"</div>";for(var c in d){var a=d[c];var q="";if(m&&m.fertilize){a=Math.ceil(a*(1+m.fertilize));u=specialbonus.htmlBonusLine(m.fertilize);q="specialbonus_bonus_value"}if(m&&m.productionspeedup){a=Math.ceil(a*(1+m.productionspeedup));u=specialbonus.htmlBonusLine(m.productionspeedup);q="specialbonus_bonus_value"}if(m&&m.treatmentspeedup){a=Math.ceil(a*(1+m.treatmentspeedup));u=specialbonus.htmlBonusLine(m.treatmentspeedup);q="specialbonus_bonus_value"}var s=c+"&nbsp;"+t_coins;if(l=="garden"){if(freegardenspeedup&&c==1){s=forfree}else{if(freegardenspeedup2&&c==2){s=forfree}}}h+='<div class="link speedupbox_item" onclick="globalSpeedupCommit(\''+l+"', "+e+", "+r+", "+c+');">';h+='  <div class="speedupbox_item_coins">'+s+"</div>";h+='  <div class="speedupbox_item_time '+q+'">'+formatTime(a)+"</div>";if(b==1){h+='<div class="speedup_coinsaction"></div>'}h+="</div>"}if(u!=""){h+='<div style="position:absolute; top:390px; left:50%; width:200px; margin-left:-100px; border-bottom-left-radius:5px; border-bottom-right-radius:5px; background-color:white; padding:5px;">'+u+"</div>"}showDiv("speedupbox_ani");if(l=="garden"){$("speedupbox").className="speedupbox_back1";hideDiv("speedupbox_ani")}else{$("speedupbox").className="speedupbox_back2"}$("speedupbox_inner").innerHTML=h;showDiv("globaltransp");showDiv("speedupbox")}function globalSpeedupCommit(m,h,t,w){var c={};c.garden={data:speedupgarden[0],click:"useGardenSpeedup("+h+","+w+")"};if(farmersmarket_data.nursery&&farmersmarket_data.nursery.speedup){c.nursery={data:farmersmarket_data.nursery.speedup,click:"farmAction('nursery_speedup', 1, 1, "+t+", "+w+")"}}c.flowerarea={data:farmersmarket_data.flowerarea_speedup,click:"farmAction('flowerarea_speedup', 1, 1, "+t+", "+w+")"};c.foodworld={data:foodworldspeedup[h],click:"foodworldAction('speedup', 0, 0, 0, "+h+", "+t+", "+w+")"};c.forestry_speedup={data:forestry_bld_fertilize,click:"forestryAjaxAction('speedup', "+h+", 0, "+t+", 0, "+w+")"};c.forestry_fertilize={data:forestry_fertilize,click:"forestryAjaxAction('fertilize', "+h+", 0, "+t+", 0, "+w+")"};c.vet_disease_speedup={data:vet_data.disease_speedup,click:"farmAction('vet_speeduptreatment', 1, 1, "+t+", "+w+")"};c.vet_production_slot_speedup={data:vet_data.production_speedup,click:"farmAction('vet_speedupproduction', 1, 1, "+t+", "+w+")"};if(pets&&pets.data&&pets.data.config){c.pets_production_slot_speedup={data:pets.data.config.speedup,click:"pets.speedupProduction("+t+", "+w+")"}}if(fishing&&fishing.data&&fishing.data.config){c.fishing_production_slot_speedup={data:fishing.data.config.production_speedup,click:"fishing.speedupProduction("+t+", "+w+")"}}if(scouts&&scouts.data&&scouts.data.config){c.scouts_production_slot_speedup={data:scouts.data.config.production_speedup,click:"scouts.speedupProduction("+t+", "+w+")"}}if(sushibar&&sushibar.data&&sushibar.data.config){c.sushibar_production_slot_speedup={data:sushibar.data.config.production_speedup,click:"sushibar.speedupProduction("+t+", "+w+")"}}if(cowracing&&cowracing.data&&cowracing.data.config){c.cowracing_production_slot_speedup={data:cowracing.data.config.speedup,click:"cowracing.speedupProduction("+t+", "+w+")"};c.cowracing_feed_speedup={data:cowracing.data.config.speedup,click:"cowracing.feedSpeedup("+t+", "+w+")"}}if(farms_data.farms[farm]&&farms_data.farms[farm][h]&&farms_data.farms[farm][h].data&&farms_data.farms[farm][h].data.constants){c.fuelstation_speedup={data:farms_data.farms[farm][h].data.constants.speedup,click:"farmAction('fuelstation_speedup', "+farm+", "+h+", "+t+", "+w+")"}}c.map_tour={data:farms_data.map.config.speedup,click:"farmAction('map_speedup', 1, 1, "+t+", "+w+")"};c.tea={data:factory.data.speedup,click:"factory.speedup("+t+", "+w+")"};c.strickerei={data:factory.data.speedup,click:"factory.speedup("+t+", "+w+")"};c.oil={data:factory.data.speedup,click:"factory.speedup("+t+", "+w+")"};if(in_array(m,["speedup_addon"])){var u=farms_data.farms[farm][h].buildingid;c[m]={data:speedup_addon[u],click:"farmAction('"+m+"', "+farm+", "+h+", "+w+", "+t+")"}}if(t>0&&w>0&&!global_speedup_block&&c[m]){global_speedup_block=1;var r=c[m].data[w];var v="";var s="";if(in_array(m,["foodworld","forestry_speedup","vet_production_slot_speedup","cowracing_production_slot_speedup","scouts_production_slot_speedup","nursery","flowerarea","sushibar_production_slot_speedup"])){if(m=="flowerarea"){bonus=specialbonus.findBonus({key1:"flowers",key2:"fertilize"})}if(m=="nursery"){bonus=specialbonus.findBonus({key1:"flowers",key2:"productionspeedup"})}if(m=="foodworld"){bonus=specialbonus.findBonus({key1:"foodworld",key2:"productionspeedup"})}if(m=="forestry_speedup"){bonus=specialbonus.findBonus({key1:"forestry",key2:"productionspeedup"})}if(m=="vet_production_slot_speedup"){bonus=specialbonus.findBonus({key1:"vet",key2:"productionspeedup"})}if(m=="cowracing_production_slot_speedup"){bonus=specialbonus.findBonus({key1:"cowracing",key2:"productionspeedup"})}if(m=="scouts_production_slot_speedup"){bonus=specialbonus.findBonus({key1:"scouts",key2:"productionspeedup"})}if(m=="sushibar_production_slot_speedup"){bonus=specialbonus.findBonus({key1:"sushibar",key2:"productionspeedup"})}if(bonus&&(bonus.productionspeedup||bonus.fertilize)){var q=0;if(bonus.fertilize){q=bonus.fertilize}if(bonus.productionspeedup){q=bonus.productionspeedup}r=Math.ceil(r*(1+q));v=specialbonus.htmlBonusLine(q);s="specialbonus_bonus_value"}}if(m=="forestry_fertilize"){bonus=specialbonus.findBonus({key1:"forestry",key2:"fertilize"});if(bonus&&bonus.fertilize){r=Math.ceil(r*(1+bonus.fertilize));v=specialbonus.htmlBonusLine(bonus.fertilize);s="specialbonus_bonus_value"}}var n=building_speeduptext;var a=t_speedup_dialog_productiontime;if(m=="garden"||m=="forestry_fertilize"){n=gardenspeedup_head;a=gardenspeedup_body}if(m=="vet_disease_speedup"){bonus=specialbonus.findBonus({key1:"vet",key2:"treatmentspeedup"});if(bonus&&bonus.treatmentspeedup){r=Math.ceil(r*(1+bonus.treatmentspeedup));v=specialbonus.htmlBonusLine(bonus.treatmentspeedup);s="specialbonus_bonus_value"}n=t_vet_disease_speedup_head;a=t_vet_disease_speedup_body}if(m=="map_tour"){n=t_speedup_dialog_routetime_head;a=t_speedup_dialog_routetime}var d=w+"&nbsp;"+t_coins;if(m=="garden"){if(freegardenspeedup&&w==1){d=forfree}else{if(freegardenspeedup2&&w==2){d=forfree}}}var l='<div style="margin-bottom:10px;"><img src="'+imgpath+'menu/coins.gif" width="10" height="10">&nbsp;'+d+"</div>";l+=str_replace("%TIME%",'<span class="'+s+'">'+formatTime(r)+"</span>",a);if(v!=""){l+='<div style="margin-top:5px;">'+v+"</div>"}var e="hideDiv('globalbox'); global_speedup_block=0;";globalcommitbox(n,l,"hideDiv('speedupbox'); "+c[m].click,e)}}var farmdeco=function(){this.data={};this.lastSave={};this.edit=0;this.currentItem="";this.currentRotation=1;this.currentMirrored=0;this.boardItemsCount=9;this.currentBoardNaviPos=1;this.currentBoardFilter="";this.list={};this.max=0;this.categories=[]};farmdeco.prototype.buyProductPackage=function(a){farmdeco.action("farmdeco_buyproductpackage",{item:a})};farmdeco.prototype.buyItem=function(b){var a=$("farm_farmdeco_shop_dialog_number").value;farmdeco.action("farmdeco_buyitem",{item:b,amount:a})};farmdeco.prototype.save=function(){if(!this.checkSaveData()){return 1}farmdeco.action("farmdeco_save",{save:JSON.stringify(this.data.deco)})};farmdeco.prototype.action=function(a,b){ajaxAction("farm",a,b,farmdeco.response)};farmdeco.prototype.response=function(b,a,c){farmdeco.init(b);if(b.friends){friends.data=b.friends}if(a=="farmdeco_buyitem"||a=="farmdeco_buyproductpackage"){farmdeco.buildFarmDecoBoard()}if(b.products){farmdeco.showProducts(b.products)}};farmdeco.prototype.init=function(a){this.data=a;this.lastSave=JSON.parse(JSON.stringify(a));this.buildFarmdecoSlotsAll()};farmdeco.prototype.buildFarmdecoSlotsAll=function(){for(var a=1;a<=const_maxfarms;a++){if(!farms_data.farms[a]||!in_array(a,farm_farmdeco_config.constants.valid_farms)){continue}this.buildFarmdecoSlots(a)}};farmdeco.prototype.buildFarmdecoSlots=function(h,q){var l=this.data.deco;if(q==1){l=visitor.data.data.farmdeco}var e="";for(var d=1;d<=4;d++){var n="top";if(d>2){n="bottom"}e+='<div class="slots slots'+d+" "+n+'">';for(var b=1;b<=6;b++){var r="farmdeco.clickFarmdeco("+d+", "+b+")";if(q==1){r=""}var c="";var a="";var m="";if(l&&l[h]&&l[h][d]&&l[h][d][b]){c="farmdeco_"+l[h][d][b].item;a="farmdeco_rotate"+l[h][d][b].rotate;m="farmdeco_mirrored"+l[h][d][b].mirrored}e+='<div class="slot slot'+b+' link" onclick="'+r+'" onmouseover="farmdeco.hoverFarmdeco('+d+", "+b+', 1)" onmouseout="farmdeco.hoverFarmdeco('+d+", "+b+', 0)">';e+='  <div class="back"></div>';e+='  <div id="farm_farmdeco_slot'+h+"_"+d+"_"+b+'_hover" class="hover"></div>';e+='  <div id="farm_farmdeco_slot'+h+"_"+d+"_"+b+'_img_effect" class="img_effect">';e+='    <div class="img '+c+" "+a+" "+m+'"></div>';e+="  </div>";if(farm_farmdeco_config.water_tiles[h]&&farm_farmdeco_config.water_tiles[h][d]&&in_array(b,farm_farmdeco_config.water_tiles[h][d])){e+='<div class="farmdeco_icon_water"></div>'}e+="</div>"}e+="</div>"}if(q==1){$("vfarm_farmdeco"+h).innerHTML=e}else{$("farm_farmdeco"+h).innerHTML=e}};farmdeco.prototype.hoverFarmdeco=function(c,b,a){if(!$("farm_farmdeco_slot"+farm_number+"_"+c+"_"+b+"_hover")){return 1}$("farm_farmdeco_slot"+farm_number+"_"+c+"_"+b+"_hover").className="hover";if(a==1){if(this.currentItem==""||!this.edit){return 1}if(!this.checkSpecial(c,b)){$("farm_farmdeco_slot"+farm_number+"_"+c+"_"+b+"_hover").addClassName("failed")}else{$("farm_farmdeco_slot"+farm_number+"_"+c+"_"+b+"_hover").addClassName("farmdeco_"+this.currentItem).addClassName("farmdeco_rotate"+this.currentRotation).addClassName("farmdeco_mirrored"+this.currentMirrored)}}};farmdeco.prototype.checkSpecial=function(d,c){if(this.currentItem==""){return 1}var b=0;if(farm_farmdeco_config.water_tiles[farm_number]&&farm_farmdeco_config.water_tiles[farm_number][d]&&in_array(c,farm_farmdeco_config.water_tiles[farm_number][d])){b=1}var a=0;if(farm_farmdeco_config.items[this.currentItem].category=="water"&&!b){return 0}if(farm_farmdeco_config.items[this.currentItem].category!="water"&&b){return 0}return 1};farmdeco.prototype.clickFarmdeco=function(b,a){if(!this.edit){return 1}if(this.data.deco&&this.data.deco[farm_number]&&this.data.deco[farm_number][b]&&this.data.deco[farm_number][b][a]){if(!this.checkSpecial(b,a)){return 1}var c=this.data.deco[farm_number][b][a].item;if(!this.data.stock[c]){this.data.stock[c]=0}this.data.stock[c]++;if(this.currentItem!=""){this.data.deco[farm_number][b][a]={item:this.currentItem,rotate:this.currentRotation,mirrored:this.currentMirrored};this.data.stock[this.currentItem]--}else{delete this.data.deco[farm_number][b][a]}}else{if(this.currentItem==""){return 1}if(!this.checkSpecial(b,a)){return 1}if(!this.data.deco){this.data.deco={}}if(!this.data.deco[farm_number]){this.data.deco[farm_number]={}}if(!this.data.deco[farm_number][b]){this.data.deco[farm_number][b]={}}this.data.deco[farm_number][b][a]={item:this.currentItem,rotate:this.currentRotation,mirrored:this.currentMirrored};this.data.stock[this.currentItem]--}this.buildFarmdecoSlots(farm_number);$("farm_farmdeco_slot"+farm_number+"_"+b+"_"+a+"_img_effect").addClassName("plant_pulse");if(this.currentItem!=""&&!this.data.stock[this.currentItem]){this.currentItem=""}this.buildFarmDecoBoard();this.save()};farmdeco.prototype.setEdit=function(){if(!this.edit){this.edit=1;for(var a=1;a<=const_maxfarms;a++){if(!farms_data.farms[a]||!in_array(a,farm_farmdeco_config.constants.valid_farms)){continue}$("farm_farmdeco"+a).addClassName("edit");$("farmdeco_builder").addClassName("edit")}$("farm_farmdeco_board").removeClassName("off").addClassName("on").removeClassName("issmall");showDiv("farm_farmdeco_board_filters");showDiv("farm_farmdeco_board_points");this.buildFarmDecoBoard()}else{this.closeFarmdeco()}};farmdeco.prototype.closeFarmdeco=function(){this.edit=0;for(var a=1;a<=const_maxfarms;a++){if(!farms_data.farms[a]||!in_array(a,farm_farmdeco_config.constants.valid_farms)){continue}if($("farm_farmdeco"+a)){$("farm_farmdeco"+a).removeClassName("edit")}if($("farmdeco_builder")){$("farmdeco_builder").removeClassName("edit")}}if($("farm_farmdeco_board")){$("farm_farmdeco_board").removeClassName("on").addClassName("off")}hideDiv("farm_farmdeco_board_filters");hideDiv("farm_farmdeco_board_points");this.closeFarmDecoShop();this.currentItem="";this.currentRotation=1;this.currentMirrored=0;this.currentBoardNaviPos=1};farmdeco.prototype.createFarmdecoList=function(){this.list={};this.categories=["all"];var h=[];for(var c in farm_farmdeco_config.items){if(farm_farmdeco_config.items[c].category&&!in_array(farm_farmdeco_config.items[c].category,this.categories)){this.categories.push(farm_farmdeco_config.items[c].category)}var b={id:c,cost:farm_farmdeco_config.items[c].cost};if(this.currentBoardFilter!=""){if(farm_farmdeco_config.items[c].category&&farm_farmdeco_config.items[c].category==this.currentBoardFilter){h.push(b)}}else{h.push(b)}}if(farm_farmdeco_config.products){this.categories.push("productpackage")}h.sort(function(m,l){return m.cost-l.cost});var e={};var d={};for(var c=0;c<h.length;c++){if(this.data.stock&&this.data.stock[h[c].id]){e[h[c].id]=1}else{d[h[c].id]=1}}var h={};for(var c in e){h[c]=1}for(var c in d){if(h[c]){continue}h[c]=1}this.max=0;for(var c in h){this.max++}this.list=h};farmdeco.prototype.buildFarmDecoBoard=function(){this.createFarmdecoList();var c=this.categories;var e=this.list;var l=this.max;var q=this.currentBoardNaviPos;var r=(this.currentBoardNaviPos+this.boardItemsCount);var b="";b+='<div id="farmdeco_board_small_button" class="smallbtn link" onclick="farmdeco.makeItSmall()">';b+='  <div class="arrow"></div>';b+="</div>";if(c.length>0){b+='<div id="farm_farmdeco_board_filters" class="filters">';b+='  <div class="tabs">';for(var a=0;a<c.length;a++){var s="";if(this.currentBoardFilter==""&&c[a]=="all"){s="active"}else{if(c[a]==this.currentBoardFilter){s="active"}}var u="farmdeco.setFarmDecoBoardFilter('"+c[a]+"')";if(c[a]=="productpackage"){u="farmdeco.productPackageSelect()"}b+='<div class="filter link '+s+" is_"+c[a]+'" onclick="'+u+'">'+t_farmdeco_navi_tab[c[a]]+"</div>"}b+='    <div class="clear"></div>';b+="  </div>";b+="</div>"}var t=0;if(friends&&friends.data&&friends.data.data&&friends.data.data.points){t=friends.data.data.points}b+='<div id="farm_farmdeco_board_points" class="points">';b+="  <div>"+formatNumber(t)+"</div>";b+='  <div class="friendpoints"></div>';b+="</div>";b+='<div class="inner">';b+='  <div class="list">';var d=1;for(var a in e){if(parseInt(d)>=parseInt(q)&&parseInt(d)<parseInt(r)){var s="";var n="";var m="standard";if(this.currentItem==a){s="active";n="farmdeco_rotate"+this.currentRotation+" farmdeco_mirrored"+this.currentMirrored}var u="farmdeco.clickFarmDecoBoardItem('"+a+"')";var h="farmdeco.openFarmDecoShop('"+a+"', "+d+", "+l+")";if(!this.data.stock||!this.data.stock[a]){s+=" off";u=h}b+='<div class="slot link '+s+'">';b+='  <div id="farm_farmdeco_board_'+a+'_back" class="back"></div>';b+='  <div class="img farmdeco_'+a+" "+n+'" onclick="'+u+'" onmouseover="farmdeco.hoverFarmDecoBoardItem(\''+a+"', 1)\" onmouseout=\"farmdeco.hoverFarmDecoBoardItem('"+a+"', 0)\"></div>";if(this.data.stock&&this.data.stock[a]){m="bought";b+='<div class="amount">'+this.data.stock[a]+"</div>";if(this.currentItem==a){b+='<div class="rotate" onclick="farmdeco.rotateFarmDecoBoardItem(\''+a+"')\">&#8635;</div>";b+='<div class="mirrored" onclick="farmdeco.mirrorFarmDecoBoardItem(\''+a+"')\">M</div>";m=""}}if(farm_farmdeco_config.items[a].notbuyable){m=""}if(m!=""){b+='<div class="cart '+m+'" onclick="'+h+'">&#128722;</div>'}if(farm_farmdeco_config.items[a].category=="water"){b+='<div class="farmdeco_icon_water"></div>'}b+="</div>"}d++}b+="  </div>";b+='  <div class="overview_button link" onclick="farmdeco.productsOverview()" onmouseover="showDiv(\'farmdeco_board_overview_button_tt\')" onmouseout="hideDiv(\'farmdeco_board_overview_button_tt\')">';b+='    <div id="farmdeco_board_overview_button_tt" class="ttbox">'+t_farmdeco_overview_button+"</div>";b+="  </div>";b+='  <div id="farm_farmdeco_board_navi_left" class="navi left link" onclick="farmdeco.buildFarmDecoBoardNavi(-1, '+l+')"></div>';b+='  <div id="farm_farmdeco_board_navi_right" class="navi right link" onclick="farmdeco.buildFarmDecoBoardNavi(1, '+l+')"></div>';b+="</div>";$("farm_farmdeco_board").innerHTML=b;this.buildFarmDecoBoardNavi(0,l);this.closeFarmDecoShop();hideDiv("globaltransp");hideDiv("globalbox");this.checkFarmSpace()};farmdeco.prototype.checkFarmSpace=function(){if($("farm_farmdeco_board").hasClassName("issmall")){$("farm_farmdeco_board").addClassName("issmall");$("farmdeco_board_small_button").addClassName("upper")}else{$("farm_farmdeco_board").removeClassName("issmall");$("farmdeco_board_small_button").removeClassName("upper")}};farmdeco.prototype.makeItSmall=function(){if($("farm_farmdeco_board").hasClassName("issmall")){$("farm_farmdeco_board").removeClassName("issmall");$("farmdeco_board_small_button").removeClassName("upper")}else{$("farm_farmdeco_board").addClassName("issmall");$("farmdeco_board_small_button").addClassName("upper")}};farmdeco.prototype.productsOverviewNavi=function(a){this.setFarmDecoBoardFilter(a);this.productsOverview()};farmdeco.prototype.productsOverview=function(){var d='<div id="farmdeco_overview">';d+='  <div class="tabs">';for(var c=0;c<this.categories.length;c++){if(this.categories[c]=="productpackage"){continue}var a="";if(this.currentBoardFilter==""&&this.categories[c]=="all"){a="active"}else{if(this.categories[c]==this.currentBoardFilter){a="active"}}d+='<div class="tab '+a+' link" onclick="farmdeco.productsOverviewNavi(\''+this.categories[c]+"')\">"+t_farmdeco_navi_tab[this.categories[c]]+"</div>"}d+="  </div>";d+='  <div class="slots">';var e=1;for(var c in this.list){var b=0;var a="off";if(this.data.stock&&this.data.stock[c]){b=this.data.stock[c];a=""}d+='<div class="slot link '+a+'" onclick="farmdeco.clickOverviewProduct(\''+c+"', "+e+')">';d+='  <div class="back"></div>';d+='  <div class="img farmdeco_'+c+'"></div>';if(b>0){d+='<div class="amount">'+b+"</div>"}d+="</div>";e++}d+='    <div class="clear"></div>';d+="  </div>";d+="</div>";globalBoxFlex(t_farmdeco_overview_button,d,0,0,1)};farmdeco.prototype.clickOverviewProduct=function(a,b){hideDiv("globaltransp");hideDiv("globalbox");this.currentBoardNaviPos=Math.min(b,(this.max-(this.boardItemsCount-1)));this.buildFarmDecoBoard();if(this.data.stock&&this.data.stock[a]){this.clickFarmDecoBoardItem(a)}else{this.openFarmDecoShop(a,b,this.max)}};farmdeco.prototype.productPackageSelect=function(){var h=0;if(friends&&friends.data&&friends.data.data&&friends.data.data.points){h=friends.data.data.points}var e='<div id="farmdeco_commit" class="selection">';e+='  <div class="desc">'+t_productpackage_selection+"</div>";e+='  <div class="slots">';for(var d in farm_farmdeco_config.products){var c=farm_farmdeco_config.products[d];var a="";var b="";var l="farmdeco.productPackageCommit("+d+")";if(c>h){a="important";b="off";l=""}e+='<div class="slot link" onclick="'+l+'" onmouseover="showDiv(\'farmdeco_productpackage'+d+"_tt')\" onmouseout=\"hideDiv('farmdeco_productpackage"+d+"_tt')\">";e+='  <div class="product_package size'+d+" "+b+'"></div>';e+='  <div class="amount '+a+'">';e+="    <div>"+c+"</div>";e+='    <div class="friendpoints"></div>';e+="  </div>";e+='  <div id="farmdeco_productpackage'+d+'_tt" class="ttbox">'+t_productpackage_size[d]+"</div>";e+="</div>"}e+="  </div>";e+="</div>";globalcommitbox(t_farmdeco_shop_head,e,0,0,1);hideDiv("globalbox_char")};farmdeco.prototype.productPackageCommit=function(b){var a='<div id="farmdeco_commit">';a+='  <div class="product_package size'+b+'"></div>';a+='  <div class="incost">';a+="    <div>"+cityadcost+"</div>";a+='    <div class="friendpoints"></div>';a+="    <div>"+farm_farmdeco_config.products[b]+"</div>";a+="  </div>";a+="  <div>"+t_farmdeco_shop_buy_item.replace("%NAME%","<b>"+t_productpackage_size[b]+"</b>")+"</div>";a+="</div>";var c="farmdeco.buyProductPackage("+b+")";globalcommitbox(t_farmdeco_shop_head,a,c)};farmdeco.prototype.setFarmDecoBoardFilter=function(a){if(a=="all"){this.currentBoardFilter=""}else{this.currentBoardFilter=a}this.currentItem="";this.currentRotation=1;this.currentMirrored=0;this.currentBoardNaviPos=1;this.buildFarmDecoBoard()};farmdeco.prototype.hoverFarmDecoBoardItem=function(b,a){if(a==1){$("farm_farmdeco_board_"+b+"_back").addClassName("hover")}else{$("farm_farmdeco_board_"+b+"_back").removeClassName("hover")}};farmdeco.prototype.clickFarmDecoBoardItem=function(a){if(!this.data.stock||!this.data.stock[a]){return 1}if(this.currentItem==a){this.currentItem=""}else{this.currentItem=a}this.currentRotation=1;this.currentMirrored=0;this.buildFarmDecoBoard(1)};farmdeco.prototype.rotateFarmDecoBoardItem=function(a){this.currentRotation++;if(this.currentRotation>4){this.currentRotation=1}this.buildFarmDecoBoard()};farmdeco.prototype.mirrorFarmDecoBoardItem=function(a){if(this.currentMirrored==1){this.currentMirrored=0}else{this.currentMirrored=1}this.buildFarmDecoBoard()};farmdeco.prototype.buildFarmDecoBoardNavi=function(b,a){if(b!=0){this.currentBoardNaviPos+=b}hideDiv("farm_farmdeco_board_navi_left");hideDiv("farm_farmdeco_board_navi_right");if(this.currentBoardNaviPos>1){showDiv("farm_farmdeco_board_navi_left")}if((this.currentBoardNaviPos+this.boardItemsCount)<=a){showDiv("farm_farmdeco_board_navi_right")}if(b!=0){this.buildFarmDecoBoard()}};farmdeco.prototype.openFarmDecoShop=function(c){this.currentItem="";this.currentRotation=1;this.currentMirrored=0;showDiv("farm_farmdeco_board_transp");var b="farmdeco.buyItem('"+c+"')";var a='<div id="farm_farmdeco_shop_dialog">';a+='  <div class="head">'+t_farmdeco_shop_head+"</div>";a+='  <div class="img farmdeco_'+c+'"></div>';if(farm_farmdeco_config.items[c].notbuyable){a+='<div class="notbuyable">'+t_farmdeco_shop_notbuyable+"</div>"}else{a+='<div class="amount_controller">';a+='  <div id="farm_farmdeco_shop_dialog_arrow_left" class="arrow left link" onclick="farmdeco.calcFarmDecoShop(\''+c+"', -1)\"></div>";a+='  <input id="farm_farmdeco_shop_dialog_number" type="number" value="1" onchange="farmdeco.calcFarmDecoShop(\''+c+"', 0)\" onkeyup=\"farmdeco.calcFarmDecoShop('"+c+"', 0)\">";a+='  <div id="farm_farmdeco_shop_dialog_arrow_right" class="arrow right link" onclick="farmdeco.calcFarmDecoShop(\''+c+"', 1)\"></div>";a+="</div>";a+='<div class="content">';a+="  <div>"+cityadcost+"</div>";a+='  <div class="cost">';a+='    <div class="friendpoints"></div>';a+='    <div id="farm_farmdeco_shop_dialog_amount" class="amount">'+formatNumber(farm_farmdeco_config.items[c].cost)+"</div>";a+="  </div>";a+="</div>";a+='<div id="farm_farmdeco_shop_dialog_button" class="button_new link" onclick="'+b+'">'+t_farmdeco_shop_button+"</div>"}a+='  <div id="farmdeco_shop_navi_left" class="link navi2 left" onclick="farmdeco.naviFarmDecoShop(\''+c+"', -1)\"></div>";a+='  <div id="farmdeco_shop_navi_right" class="link navi2 right" onclick="farmdeco.naviFarmDecoShop(\''+c+"', 1)\"></div>";a+='  <div class="mini_close link" onclick="farmdeco.closeFarmDecoShop()"></div>';a+="</div>";if($("farm_farmdeco_shop_dialog")){$("farm_farmdeco_shop_dialog").remove()}$("farm_farmdeco_board").insert(a);this.naviFarmDecoShop(c,0);if(!farm_farmdeco_config.items[c].notbuyable){this.calcFarmDecoShop(c,0)}};farmdeco.prototype.calcFarmDecoShop=function(d,b){var a=$("farm_farmdeco_shop_dialog_number").value;if(a==""||isNaN(a)){a=1}a=parseInt(a);if(b!=0){a+=parseInt(b)}if(a<=0){a=1}var e=(a*farm_farmdeco_config.items[d].cost);var c=0;if(friends&&friends.data&&friends.data.data&&friends.data.data.points){c=friends.data.data.points}$("farm_farmdeco_shop_dialog_arrow_left").removeClassName("off");if(a==1){$("farm_farmdeco_shop_dialog_arrow_left").addClassName("off")}$("farm_farmdeco_shop_dialog_amount").removeClassName("important");$("farm_farmdeco_shop_dialog_button").removeClassName("off");if(c<e){$("farm_farmdeco_shop_dialog_amount").addClassName("important");$("farm_farmdeco_shop_dialog_button").addClassName("off")}$("farm_farmdeco_shop_dialog_amount").innerHTML=e;$("farm_farmdeco_shop_dialog_number").value=a;$("farm_farmdeco_shop_dialog_number").focus()};farmdeco.prototype.naviFarmDecoShop=function(b,a){var c=this.getItemPosDataShop(b);if(a!=0){c.current+=a}if(c.current<1){c.current=1}if(c.current>c.max){c.current=max}hideDiv("farmdeco_shop_navi_left");hideDiv("farmdeco_shop_navi_right");if(c.current>1){showDiv("farmdeco_shop_navi_left")}if(c.current<c.max){showDiv("farmdeco_shop_navi_right")}if(a!=0){if((a>0&&c.current>this.boardItemsCount)||(a<0&&c.current>=this.boardItemsCount)){farmdeco.buildFarmDecoBoardNavi(a,c.max)}this.openFarmDecoShop(c.items[c.current])}};farmdeco.prototype.getItemPosDataShop=function(d){var e=this.list;var b={};var h=0;var a=0;for(var c in e){a++;if(!h&&d==c){h=a}b[a]=c}return{current:h,max:a,items:b}};farmdeco.prototype.closeFarmDecoShop=function(){if($("farm_farmdeco_shop_dialog")){$("farm_farmdeco_shop_dialog").remove()}hideDiv("farm_farmdeco_board_transp")};farmdeco.prototype.checkSaveData=function(){var d=this.data.deco;var b=this.lastSave.deco;var h=0;for(var c in b){if(!isNumeric(c)){continue}for(var a in b[c]){for(var e in b[c][a]){if(!d||!d[c]||!d[c][a]||!d[c][a][e]||!(d[c][a][e].item==b[c][a][e].item&&d[c][a][e].rotate==b[c][a][e].rotate)){h++}}}}for(var c in d){if(!isNumeric(c)){continue}for(var a in d[c]){for(var e in d[c][a]){if(!b||!b[c]||!b[c][a]||!b[c][a][e]||!(b[c][a][e].item==d[c][a][e].item&&b[c][a][e].rotate==d[c][a][e].rotate)){h++}}}}if(h>0){return 1}return 0};farmdeco.prototype.showProducts=function(c){var b='<div class="farmdeco_commit">';b+='  <div class="intro" style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";for(var a in c){b+='<div style="display:flex; justify-content:center; margin-bottom:2px;">'+htmlProductBody(a,c[a])+"</div>"}b+="</div>";globalcommitbox(t_vet_reward_head,b,0,0,1)};var fhelp=function(){this.data={};this.currentPage="";this.globalboxRemember=0;this.flexRemember=""};fhelp.prototype.init=function(a){this.data=a;if($(this.data.type+"_fhelp")){$(this.data.type+"_fhelp").remove()}this.build()};fhelp.prototype.build=function(){var b='<div id="fhelp_'+this.data.type+'" class="fhelp_box '+this.data.type+'">';b+='  <div class="transp"></div>';b+='  <div class="bubble">';b+='    <div id="fhelp_navi_'+this.data.type+'" class="navi"></div>';for(var a=0;a<this.data.navi.length;a++){if(this.currentPage==""){this.currentPage=this.data.navi[a]}b+='<div id="fhelp_page_'+this.data.navi[a]+"_"+this.data.type+'" class="page page-'+this.data.navi[a]+'">';if(t_fhelp_head[this.data.type]&&t_fhelp_head[this.data.type][this.data.navi[a]]){b+='<div class="headline">'+t_fhelp_head[this.data.type][this.data.navi[a]]+"</div>"}b+='  <div class="content">'+this.addPage(this.data.navi[a])+"</div>";b+="</div>"}b+='    <div class="mini_close link" onclick="fhelp.close()"></div>';b+="  </div>";b+='  <div class="char"></div>';b+="</div>";$(this.data.insert).insert(b);this.buildNavi()};fhelp.prototype.buildAchievements=function(c,h){var e="";for(var d in c){for(var b in c[d]){var a=c[d][b];if(presents_hack[c[d][b]]){a=presents_hack[c[d][b]]}e+='<div class="item">';e+='  <div class="img" style="background-image:url('+imgpath+"gifts/"+a+'.gif);"></div>';if(in_array(c[d][b],h)){e+='<div class="megafield_product_ready ready"></div>'}e+='  <div class="info">'+t_fhelp_achievements[this.data.type][d].replace("%COUNT%",formatNumber(b))+"</div>";e+="</div>"}}e+='<div class="clear"></div>';return e};fhelp.prototype.addPage=function(name){var fn=this.data.type+".helpPage";return eval(fn+"('"+name+"')")};fhelp.prototype.buildNavi=function(){if(!in_array(this.currentPage,this.data.navi)){this.currentPage=this.data.navi[0]}var c="";for(var b=0;b<this.data.navi.length;b++){var a="";if(this.data.navi[b]==this.currentPage){a="active"}c+='<div class="tab is-'+this.data.navi[b]+" "+a+' link" onclick="fhelp.clickNavi(\''+this.data.navi[b]+"')\"></div>";hideDiv("fhelp_page_"+this.data.navi[b]+"_"+this.data.type)}$("fhelp_navi_"+this.data.type).innerHTML=c;showDiv("fhelp_page_"+this.currentPage+"_"+this.data.type)};fhelp.prototype.clickNavi=function(a){this.currentPage=a;this.buildNavi()};fhelp.prototype.open=function(a){if($("globalbox").style.display=="block"){if(!in_array(this.data.type,["jamexchange"])){hideDiv("globaltransp");hideDiv("globalbox");this.globalboxRemember=1}}if(in_array(a,this.data.navi)){this.clickNavi(a)}if(this.data.flex){$("fhelp_"+this.data.type).style.display="flex"}else{showDiv("fhelp_"+this.data.type)}};fhelp.prototype.close=function(){hideDiv("fhelp_"+this.data.type);if(this.globalboxRemember==1){showDiv("globaltransp");showDiv("globalbox");this.globalboxRemember=0}};var fishing=function(){this.data={};this.currentView="";this.fishingSlot=0;this.fishingSlotSelection={};this.productionSlot=0;this.productionSelectionPage=1;this.productionSelectionFilter="none";this.stats_options=[];this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.currentBookPage=1;this.finishData={};this.tutorialType="";this.tutorialStep=1;this.contestData={}};fishing.prototype.stats=function(){if($("fishing_stats_select")){if($("fishing_stats_select").value==0){return 1}fishing.stats_select=$("fishing_stats_select").value}if(fishing.stats_cache_delay[fishing.stats_select]<=0||!fishing.stats_cache[this.stats_select]){fishing.action("fishing_stats",{type:fishing.stats_select})}else{fishing.showStats(fishing.stats_select)}};fishing.prototype.registerContest=function(){fishing.action("fishing_contest_register")};fishing.prototype.initContest=function(a){fishing.action("fishing_contest_init",{name:a})};fishing.prototype.setTutorial=function(){fishing.action("fishing_settutorial",{type:fishing.tutorialType})};fishing.prototype.buyStarterpack=function(){fishing.action("fishing_buystarterpack")};fishing.prototype.buyFishingSlot=function(a){fishing.action("fishing_buyfishingslot",{slot:a})};fishing.prototype.speedupFishing=function(a){fishing.action("fishing_speedup_fishing",{slot:a})};fishing.prototype.finishFishing=function(a){fishing.action("fishing_finish_fishing",{slot:a})};fishing.prototype.startFishing=function(){fishing.action("fishing_start_fishing",{slot:fishing.fishingSlot,selection:JSON.stringify(fishing.fishingSlotSelection)})};fishing.prototype.questEntry=function(a){fishing.action("fishing_quest_entry",{pid:a,amount:parseInt($("dialog_entryline_number").value)})};fishing.prototype.buyStock=function(b,a){fishing.action("fishing_stock_buy",{id:b,coins:a})};fishing.prototype.startProduction=function(a){fishing.action("fishing_startproduction",{slot:fishing.productionSlot,pid:a})};fishing.prototype.speedupProduction=function(b,a){fishing.action("fishing_speedupproduction",{slot:b,coins:a})};fishing.prototype.harvestProduction=function(b,a){fishing.action("fishing_harvestproduction",{slot:b,position:a})};fishing.prototype.buyProductionSlot=function(a){fishing.action("fishing_buyproductionslot",{slot:a})};fishing.prototype.shopBuy=function(a){fishing.action("fishing_shop_buy",{id:a})};fishing.prototype.buyAddLevel=function(){fishing.action("fishing_buy_add_level")};fishing.prototype.addLevel=function(){fishing.action("fishing_add_level",{amount:$("fishing_dialog_leveladd_insert").value})};fishing.prototype.buyPharmacist=function(){fishing.action("fishing_buypharmacist")};fishing.prototype.rememberPharmacist=function(){fishing.action("fishing_rememberpharmacist")};fishing.prototype.init=function(){fishing.action("fishing_init")};fishing.prototype.action=function(a,b){ajaxAction("farm",a,b,fishing.response)};fishing.prototype.response=function(b,a,c){if(in_array(a,["fishing_rememberpharmacist","fishing_settutorial"])){return 1}if(in_array(a,["fishing_quest_entry"])){fishing.showQuest()}if(in_array(a,["fishing_speedupproduction"])){global_speedup_block=0}if(in_array(a,["fishing_start_fishing"])){fishing.fishingSlot=0}fishing.init();if(in_array(a,["fishing_shop_buy"])){fishing.buildShop()}if(in_array(a,["fishing_stock_buy"])){fishing.buildStock()}if(a=="fishing_finish_fishing"&&b.fish){fishing.finishData=b;fishing.showReward()}if(b.stats){fishing.stats_cache_delay[fishing.stats_select]=30;if(!fishing.stats_cache[fishing.stats_select]){fishing.stats_cache[fishing.stats_select]={}}fishing.stats_cache[fishing.stats_select]=b.stats;fishing.showStats()}if(in_array(a,["fishing_contest_init","fishing_contest_register"])){fishing.contestData=b;fishing.buildContest()}};fishing.prototype.init=function(){var b='<div id="fishing">';b+='  <div id="fishing_view" class="view"></div>';b+='  <div id="fishing_book"></div>';b+=htmlLevelBar("fishing");b+=htmlCountBar("fishing");b+='  <div id="fishing_stats_link" class="link" onclick="fishing.stats()"></div>';b+='  <div id="fishing_quests_link" class="link" onclick="fishing.showQuest()"></div>';b+='  <div id="fishing_book_link" class="link" onclick="fishing.buildBook()" onmouseover="showDiv(\'fishing_book_link_tt\')" onmouseout="hideDiv(\'fishing_book_link_tt\')">';b+='    <div id="fishing_book_link_tt" class="ttbox">'+t_fishing_book_name+"</div>";b+="  </div>";b+='  <div class="buttons">';b+='    <div id="fishing_shop_link" class="link bbutton" onclick="fishing.buildShop()" onmouseover="showDiv(\'fishing_shop_link_tt\')" onmouseout="hideDiv(\'fishing_shop_link_tt\')">';b+='      <div id="fishing_shop_link_tt" class="ttbox">'+t_fishing_shop_name+"</div>";b+="    </div>";b+='    <div id="fishing_stock_link" class="link bbutton" onclick="fishing.buildStock()" onmouseover="showDiv(\'fishing_stock_link_tt\')" onmouseout="hideDiv(\'fishing_stock_link_tt\')">';b+='      <div id="fishing_stock_link_tt" class="ttbox">'+t_fishing_stock_name+"</div>";b+="    </div>";if(this.data.contest){b+='<div id="fishing_contest_link" class="link bbutton" onclick="fishing.initContest()" onmouseover="showDiv(\'fishing_contest_link_tt\')" onmouseout="hideDiv(\'fishing_contest_link_tt\')">';b+='  <div id="fishing_contest_link_tt" class="ttbox">'+t_fishing_contest_name+"</div>";b+="</div>"}b+='    <div id="fishing_starterpack_link" class="link bbutton" onclick="fishing.buildStartepack()" onmouseover="showDiv(\'fishing_starterpack_link_tt\')" onmouseout="hideDiv(\'fishing_starterpack_link_tt\')">';b+='      <div id="fishing_starterpack_link_timer" class="timer">'+formatTime(this.data.config.starterpack.remain)+"</div>";b+='      <div id="fishing_starterpack_link_tt" class="ttbox">'+t_fishing_starterpack_name+"</div>";b+="    </div>";b+='     <div class="clear"></div>';b+="  </div>";b+='  <div class="mini_close link" onclick="fishing.close()"></div>';b+='  <div class="help helpbutton_blue link" onclick="fishing.help()"></div>';b+="</div>";$("farmersmarket_pos9_inner").innerHTML=b;showDiv("transp");showDiv("farmersmarket_pos9_inner");if(this.currentView==""){this.setView("production")}else{this.setView(this.currentView)}$("fishing_levelbar_number").innerHTML=this.data.data.level;$("fishing_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var c=t_reached_maxlevel;hideDiv("fishing_levelbar_plus")}else{var c=str_replace("%AMOUNT%",this.data.data.level_rest,t_fishing_level_line);$("fishing_levelbar_plus").onclick=new Function("fishing.addLevelCommit()");$("fishing_levelbar_plus_tt").innerHTML=t_fishing_leveladd_tt}$("fishing_levelbar_tt").innerHTML=c;$("fishing_countbar_inner").innerHTML='<div class="fishing_points"></div><div>'+formatNumber(this.data.data.count)+"</div><br>";$("fishing_countbar_plus_tt").innerHTML=t_fishing_levelitem_buy;$("fishing_countbar_plus").onclick=new Function("fishing.buyAddLevelCommit()");this.timerUpdate();if(this.data.data.queue&&this.data.data.queue.start&&this.data.data.queue_remain<0&&this.data.data.queue_remember){this.buyPharmacistCommit(1)}this.startTutorial("start");$("farmersmarket_pos9_inner").addEventListener("click",fishingClickwatching);$("globalbox").addEventListener("click",fishingClickwatching);this.stats_options=["points","items","food","quests","","countall","category1","category2","category3","category4","category5","category6"];if(this.data.contest==1){this.stats_options=["points","items","food","quests","contest","contest_joined","","countall","category1","category2","category3","category4","category5","category6"]}if(this.data.addon==1){this.stats_options.push("category12")}this.stats_options.push("");for(var a in this.data.config.fish){if(a==39){continue}this.stats_options.push("fish"+a);if(a==4){this.stats_options.push("fish39")}}};fishing.prototype.setView=function(a){this.currentView=a;if(a=="production"){this.buildProduction()}if(a=="pier"){this.buildPier()}this.timerUpdate()};fishing.prototype.addLevelCommit=function(){var b=t_fishing_dialog_leveladd_head;var a=htmlLevelAddDialog("fishing");globalcommitbox(b,a,0,0,1);$("fishing_dialog_leveladd_insert").focus()};fishing.prototype.addLevelCheck=function(){var a=$("fishing_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>fishing.data.data.count){a=fishing.data.data.count}$("fishing_dialog_leveladd_insert").value=a};fishing.prototype.buyAddLevelCommit=function(a){var c=fishing.data.data.exchangeamount;var l="";var e=0;var n="";if(specialbonus){e=specialbonus.findBonus({key1:"fishing",key2:"buyfishingpoints"})}if(e){c=Math.ceil(c*(1+e.buyfishingpoints));l="bonus";n='<div class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(e.buyfishingpoints*100))+")</div>"}var h=t_fishing_levelitem_buy;var b=t_fishing_levelitem_buy_dialog.replace("%COINS%",fishing.data.data.exchangecoins).replace("%AMOUNT%",'<span class="'+l+'">'+c+"</span>");if(!a){var d='<div id="fishing_commit">';d+='  <div class="link coinsbutton_flex" onclick="fishing.buyAddLevelCommit(1)" style="width:350px;">'+b+"</div>";if(n!=""){d+='<div class="bonus">'+n+"</div>"}d+="</div>";globalcommitbox(h,d,0,0,1)}else{var d='<div id="fishing_commit">';d+='  <div class="line">'+b+"</div>";if(n!=""){d+='<div class="bonus">'+n+"</div>"}d+="</div>";var m="fishing.buyAddLevel()";globalcommitbox(h,d,m)}};fishing.prototype.buildStartepack=function(){var e=t_fishing_starterpack_name;var d='<div id="fishing_starterpack">';d+='<div class="desc">'+t_fishing_starterpack_desc+"</div>";d+='<div class="content">';for(var h in this.data.config.starterpack.content){if(h=="pharmacist"){d+='<div class="slot" onmouseover="showDiv(\'fishing_starterpack_content_pharmacist_tt\')" onmouseout="hideDiv(\'fishing_starterpack_content_pharmacist_tt\')">';d+='  <div class="pharmacist"></div>';d+='  <div class="amount pharma">'+t_days.replace("%DAYS%",Math.round(this.data.config.constants.queue_duration/86400))+"</div>";d+='  <div id="fishing_starterpack_content_pharmacist_tt" class="ttbox">'+t_fishing_pharmacist_info+"</div>";d+="</div>"}if(h=="items"){for(var m in this.data.config.starterpack.content.items){var c=this.data.config.starterpack.content.items[m];d+='<div class="slot" onmouseover="showDiv(\'fishing_starterpack_content_item'+m+"_tt')\" onmouseout=\"hideDiv('fishing_starterpack_content_item"+m+"_tt')\">";d+='  <div class="product fishing_item'+m+'"></div>';d+='  <div class="amount">'+c+"x</div>";d+='  <div id="fishing_starterpack_content_item'+m+'_tt" class="ttbox">'+this.data.config.items[m].name+"</div>";d+="</div>"}}if(h=="products"){for(var b in this.data.config.starterpack.content.products){var c=this.data.config.starterpack.content.products[b];d+='<div class="slot" onmouseover="showDiv(\'fishing_starterpack_content_product'+b+"_tt')\" onmouseout=\"hideDiv('fishing_starterpack_content_product"+b+"_tt')\">";d+='  <div class="product fishing_item'+b+'"></div>';d+='  <div class="amount">'+c+"x</div>";d+='  <div id="fishing_starterpack_content_product'+b+'_tt" class="ttbox">'+produkt_name[b]+"</div>";d+="</div>"}}}d+='  <div class="clear"></div>';d+="</div>";var a=this.data.config.starterpack.coins;d+='  <div class="link coinsbutton_flex" onclick="fishing.buyStarterpackCommit();">'+t_fishing_starterpack_buybutton.replace("%COINS%",a)+"</div>";var l=this.data.config.starterpack.discount;d+='  <div class="discount bonus_star pulse">';d+='    <div class="amount">'+l+'% <span class="add">'+t_specialbonus_rentslots_discount_info+"</span></div>";d+="  </div>";d+='  <div class="timer">'+t_fishing_starterpack_timer+'&nbsp;<span id="fishing_starterpack_timer">'+formatTime(this.data.config.starterpack.remain)+"</span></div>";d+='  <div class="chest"></div>';d+="</div>";globalBoxFlex(e,d,0,0,1);$("globalbox").style.top="100px"};fishing.prototype.buyStarterpackCommit=function(){var b=t_fishing_starterpack_name;var a='<div style="width:350px;">'+t_fishing_starterpack_commit_body.replace("%NAME%",t_fishing_starterpack_name).replace("%COINS%",this.data.config.starterpack.coins)+"</div>";var c="fishing.buyStarterpack()";globalcommitbox(b,a,c);$("globalbox").style.top="170px";$("globalbox").style.marginLeft="-230px"};fishing.prototype.startTutorial=function(b){if(this.data.data.tutorial&&this.data.data.tutorial[b]){return 1}if(!$("fishing_tutorial")){var a='<div id="fishing_tutorial"></div>';$("garten_komplett").insert(a)}this.tutorialType=b;this.tutorialStep=1;setTimeout(function(){fishing.showTutorial(1);fishing.setTutorialVisited()},250)};fishing.prototype.nextTutorialStep=function(){this.tutorialStep++;this.showTutorial()};fishing.prototype.setTutorialVisited=function(){if(this.data.data.tutorial&&this.data.data.tutorial[this.tutorialType]){return 1}this.setTutorial()};fishing.prototype.showTutorial=function(h){var c=this.tutorialType+"_"+this.tutorialStep;if(!t_fishing_tutorial_text[c]){this.closeTutorial();return 1}var e=t_fishing_tutorial_text[c];e=e.replace("%PLAYERNAME%","<b>"+username+"</b>");var d=0;if(t_fishing_tutorial_text[this.tutorialType+"_"+(this.tutorialStep+1)]){d=1}var a="on";if(h==1){a="off"}var b="";b+='<div id="fishing_tutorial_transp" class="transp"></div>';b+='<div id="fishing_tutorial_fisher" class="fisher '+a+'">';b+='  <div class="bubble">';b+='    <div class="text">'+e+"</div>";if(d==1){b+='<div class="next button_new link" onclick="fishing.nextTutorialStep()">'+t_continue+"</div>"}else{b+='<div class="button_yes link" onclick="fishing.closeTutorial()"></div>'}b+="  </div>";b+="</div>";$("fishing_tutorial").innerHTML=b;$("fishing_tutorial").className=this.tutorialType;showDiv("fishing_tutorial");if(h==1){setTimeout(function(){if($("fishing_tutorial_fisher")){$("fishing_tutorial_fisher").removeClassName("off").addClassName("on")}},200)}};fishing.prototype.closeTutorial=function(){if(!$("fishing_tutorial")){return 1}if($("fishing_tutorial_fisher")){$("fishing_tutorial_fisher").removeClassName("on").addClassName("off")}setTimeout(function(){hideDiv("fishing_tutorial")},200)};fishing.prototype.showReward=function(){var e='<div id="fishing_reward">';e+='  <div id="fishing_reward_fisher" class="fisher">';var b="small";if(in_array(this.data.config.fish[this.finishData.fish.type].size,[3,4,7])){b="medium"}if(in_array(this.data.config.fish[this.finishData.fish.type].size,[5,8])){b="big"}e+='    <div class="body '+b+'"></div>';var d=70+(30*this.finishData.fish.percent);e+='    <div class="fish size'+this.data.config.fish[this.finishData.fish.type].size+'">';e+='      <div class="img fishing_fish'+this.finishData.fish.type+'" style="width:'+d+"%; height:"+d+"%; margin-left:-"+(d/2)+"%; margin-top:-"+(d/2)+'%;">';e+="      </div>";e+="    </div>";e+='    <div class="hand '+b+'"></div>';e+="  </div>";e+='  <div class="info">';e+='    <div class="name">'+t_fishing_reward_head.replace("%NAME%",this.data.config.fish[this.finishData.fish.type].name)+"</div>";e+='    <div class="type">'+t_fishing_fish_type+": "+t_fishing_category[this.data.config.fish[this.finishData.fish.type].category]+"</div>";e+='    <div class="type">'+t_fishing_fish_rarity+": "+t_fishing_rarity[this.data.config.fish[this.finishData.fish.type].rarity]+"</div>";e+='    <div class="size">'+t_fishing_fishsize+": "+this.showFishSize(this.finishData.fish.size)+"</div>";e+='    <div class="stars" onmouseover="showDiv(\'fishing_reward_stars_tt\')" onmouseout="hideDiv(\'fishing_reward_stars_tt\')">';for(var c=1;c<=5;c++){e+='<div id="fishing_reward_star'+c+'" class="star off"></div>'}e+='      <div class="clear"></div>';e+='      <div id="fishing_reward_stars_tt" class="ttbox">'+t_fishing_size_max+this.showFishSize((this.data.config.fish[this.finishData.fish.type].size_max*1000))+"</div>";e+="    </div>";e+='    <div class="reward">';e+='      <div class="head line">'+t_farmersmarket_rewards+":</div>";var h=this.finishData.selection.item;if(this.finishData.reward.fishingpoints){var m=0;if(this.data.questbonus&&this.data.questbonus.bonus_fishingpoints){m+=this.data.questbonus.bonus_fishingpoints}if(this.data.config.items[h]&&this.data.config.items[h].bonus.bonus_fishingpoints){m+=this.data.config.items[h].bonus.bonus_fishingpoints}e+='<div class="line">'+this.finishData.reward.fishingpoints+" "+t_fishing_stats.points+"</div>";if(m>0){e+='<div style="font-style:italic; margin-top:-5px; margin-bottom:5px; color:green;">'+t_fishing_fishingpoints_bonus.replace("%PERCENT%",Math.round(m*100))+"</div>"}}if(this.finishData.reward.points){var m=0;if(this.data.config.items[h]&&this.data.config.items[h].bonus.bonus_points){m+=this.data.config.items[h].bonus.bonus_points}e+='<div class="line">'+formatNumber(this.finishData.reward.points)+" "+t_points+"</div>";if(m>0){e+='<div style="font-style:italic; margin-top:-5px; margin-bottom:5px; color:green;">'+t_fishing_points_bonus.replace("%PERCENT%",Math.round(m*100))+"</div>"}}if(this.finishData.reward.money){var m=0;if(this.data.config.items[h]&&this.data.config.items[h].bonus.bonus_money){m+=this.data.config.items[h].bonus.bonus_money}e+='<div class="line">'+formatPrice(this.finishData.reward.money)+"</div>";if(m>0){e+='<div style="font-style:italic; margin-top:-5px; margin-bottom:5px; color:green;">'+t_fishing_money_bonus.replace("%PERCENT%",Math.round(m*100))+"</div>"}}if(this.finishData.reward.trove){for(var c in this.finishData.reward.trove){e+='<div class="trove fishing_trove'+c+'" onmouseover="showDiv(\'fishing_reward_trove'+c+"_tt')\" onmouseout=\"hideDiv('fishing_reward_trove"+c+"_tt')\">";e+='  <div class="amount">'+this.finishData.reward.trove[c]+"x</div>";e+='  <div id="fishing_reward_trove'+c+'_tt" class="ttbox">'+this.data.config.trove[c].name+"</div>";e+="</div>"}}e+='  	   <div class="clear"></div>';e+="    </div>";if(this.finishData.expired){e+='<div class="expired">';e+='  <div class="head">'+t_fishing_expired_head+"</div>";e+='  <div class="item fishing_item'+this.finishData.expired+'" onmouseover="showDiv(\'fishing_reward_expired_tt\')" onmouseout="hideDiv(\'fishing_reward_expired_tt\')">';e+='    <div id="fishing_reward_expired_tt" class="ttbox">'+this.itemTT(this.finishData.expired)+"</div>";e+="  </div>";e+="</div>"}e+="  </div>";e+='  <div class="clear"></div>';e+='  <div class="button_yes link" onclick="fishing.goodbyeFish()"></div>';e+="</div>";globalBoxFlex("",e,0,0,1);$("globalbox").style.top="50px";var a=this.getFishSizeStars(this.finishData.fish.type,this.finishData.fish.size);var l=1000;for(var c=1;c<=a;c++){fishing.showRewardStar(c,l);fishing.clearRewardStar(c,l);l+=250}};fishing.prototype.getFishSizeStars=function(e,d){var b=(this.data.config.fish[e].size_max*1000);var c=(this.data.config.fish[e].size_min*1000);var h=(((d-c)*100)/(b-c));var a=1;if(h>=20){a=2}if(h>=45){a=3}if(h>=70){a=4}if(h>=95){a=5}return a};fishing.prototype.showFishSize=function(b){var a=formatNumber(b)+"&nbsp;"+t_fishing_size_unit;if(b>=1000){a=(b/1000);a=a.toFixed(3).replace(".",",")+"&nbsp;"+t_fishing_size_unit2}return a};fishing.prototype.showRewardStar=function(a,b){setTimeout(function(){if($("fishing_reward_star"+a)){$("fishing_reward_star"+a).removeClassName("off").addClassName("active")}},b)};fishing.prototype.clearRewardStar=function(a,b){setTimeout(function(){if($("fishing_reward_star"+a)){$("fishing_reward_star"+a).removeClassName("active")}},(b+500))};fishing.prototype.goodbyeFish=function(){var c=0;for(var b in t_fishing_release_bubble){c++}var d=t_fishing_release_bubble[getRandom(1,c)];var a='<div id="fishing_goodbye">';a+='  <div class="hiddenbox">';a+='    <div class="fisher"></div>';a+='    <div id="fishing_goodbye_fish" class="fish fishing_fish'+this.finishData.fish.type+" size"+this.data.config.fish[this.finishData.fish.type].size+'"></div>';a+='    <div class="bubble">'+d+"</div>";a+="    <div class=\"button_yes link\" onclick=\"hideDiv('globaltransp'); hideDiv('globalbox');\"></div>";a+="  </div>";a+="</div>";globalBoxFlex("",a,0,0,1);$("globalbox").style.top="50px";setTimeout(function(){if($("fishing_goodbye_fish")){$("fishing_goodbye_fish").addClassName("move")}},200);setTimeout(function(){if($("fishing_goodbye")){hideDiv("globalbox");hideDiv("globaltransp")}},2500)};fishing.prototype.buildPier=function(){var a="";for(var b=1;b<=4;b++){a+='<div id="fishing_rod'+b+'" class="rod rod'+b+'"></div>'}a+='<div class="fishingslots">';for(var b=1;b<=4;b++){a+=this.buildFishingSlot(b)}a+="</div>";a+='<div class="goto production link" onclick="fishing.setView(\'production\')" onmouseover="showDiv(\'fishing_goto_house_tt\')" onmouseout="hideDiv(\'fishing_goto_house_tt\')"></div>';a+='<div id="fishing_goto_house_tt" class="gotott production ttbox">'+t_fishing_goto_house+"</div>";a+='<div class="easteregg link" ondblclick="fishing.easteregg()"></div>';$("fishing_view").innerHTML=a;$("fishing").removeClassName("production").addClassName("pier");for(var b=1;b<=4;b++){this.updateFishingSlot(b)}this.startTutorial("pier")};fishing.prototype.buildFishingSlot=function(l){var e="";e+='<div id="fishing_fishingslot'+l+'" class="slot link slot'+l+'" onmouseover="showDiv(\'fishing_fishingslot'+l+"_tt')\" onmouseout=\"hideDiv('fishing_fishingslot"+l+"_tt')\">";e+='  <div id="fishing_fishingslot'+l+'_block" class="block"></div>';e+='  <div id="fishing_fishingslot'+l+'_block2" class="block2"></div>';e+='  <div id="fishing_fishingslot'+l+'_timer" class="timer"><div id="fishing_fishingslot'+l+'_timer_time" class="time"></div></div>';e+='  <div id="fishing_fishingslot'+l+'_rent_timer" class="rent_timer"></div>';e+='  <div id="fishing_fishingslot'+l+'_tt" class="ttbox"></div>';if(this.data.data.fishingslots[l]&&this.data.data.fishingslots[l].selection){e+='<div class="selection">';var c=["category","rarity","item"];for(var d=0;d<c.length;d++){var h=this.data.data.fishingslots[l].selection[c[d]];if(c[d]=="item"){h=this.data.data.items[this.data.data.fishingslots[l].selection.item].type}var b="";if(l>2){b="right"}e+='<div class="square_slot" onmouseover="showDiv(\'fishing_fishingslot'+l+"_selection_"+c[d]+"_tt')\" onmouseout=\"hideDiv('fishing_fishingslot"+l+"_selection_"+c[d]+"_tt')\">";e+='  <div class="item fishing_item'+h+'"></div>';e+='  <div id="fishing_fishingslot'+l+"_selection_"+c[d]+'_tt" class="ttbox '+b+'">'+this.itemTT(h)+"</div>";e+="</div>"}e+='  <div class="clear"></div>';e+="</div>";if(devserver==1){e+='<div class="speedup link" onclick="fishing.speedupFishing('+l+')"></div>'}}e+="</div>";return e};fishing.prototype.updateFishingSlot=function(m){if(!$("fishing_fishingslot"+m)){return 1}hideDiv("fishing_fishingslot"+m+"_block");hideDiv("fishing_fishingslot"+m+"_block2");hideDiv("fishing_fishingslot"+m+"_timer");hideDiv("fishing_fishingslot"+m+"_rent_timer");if($("fishing_rod"+m)){$("fishing_rod"+m).addClassName("sitting").removeClassName("active")}var d=0;if(specialbonus){d=specialbonus.findBonus({key1:"fishing",key2:"buyfishingslot"})}var e="fishing.fishingSlotSelection={}; fishing.startFishingSelection("+m+")";var c=t_fishing_start_fishing_slot_start;var l=0;var h=0;if(this.data.data.fishingslots[m]){if(this.data.data.fishingslots[m].selection){showDiv("fishing_fishingslot"+m+"_timer");if(this.data.data.fishingslots[m].remain>0){$("fishing_fishingslot"+m+"_timer_time").innerHTML=formatTime(this.data.data.fishingslots[m].remain);c=t_fishing_fishing_currently;e="";if($("fishing_rod"+m)){$("fishing_rod"+m).addClassName("active")}}else{$("fishing_fishingslot"+m+"_timer_time").innerHTML=statusProductionComplete;c=t_fishing_fishing_finished;e="fishing.finishFishing("+m+");"}}if(this.data.data.fishingslots[m].rent_duration){if(this.data.data.fishingslots[m].rent_remain>0){$("fishing_fishingslot"+m+"_rent_timer").innerHTML=formatTime(this.data.data.fishingslots[m].rent_remain);showDiv("fishing_fishingslot"+m+"_rent_timer")}else{this.data.data.fishingslots[m].block=1}}if(this.data.data.fishingslots[m].block){if(this.data.data.fishingslots[m].rent_duration&&this.data.config.fishing_slots[m].rent_remain&&this.data.config.fishing_slots[m].rent_remain>0){}else{var b="";if(this.data.data.fishingslots[m].coins){var a=this.data.data.fishingslots[m].coins;if(d&&d.buyfishingslot){a=Math.ceil(a*(1-d.buyfishingslot));b="bonus"}}e="fishing.buyFishingSlotCommit("+m+")";l=1;if(this.data.data.fishingslots[m].rent_duration){c=t_fishing_start_fishing_slot_rent.replace("%COST%",'<span class="'+b+'">'+a+" "+t_coins+"</span>").replace("%TIME%",formatTime(this.data.data.fishingslots[m].rent_duration))}else{if(this.data.data.fishingslots[m].money){c=t_fishing_start_fishing_slot_buy.replace("%COST%",formatPrice(this.data.data.fishingslots[m].money))}if(this.data.data.fishingslots[m].coins){c=t_fishing_start_fishing_slot_buy.replace("%COST%",'<span class="'+b+'">'+a+" "+t_coins+"</span>")}}}}if(this.data.config.fishing_slots[m]&&this.data.config.fishing_slots[m].quest&&this.data.config.fishing_slots[m].quest>this.data.highestquest){e="";h=1;c+='<div class="important" style="margin-top:5px;">'+t_fishing_requires_quest.replace("%COUNT%",this.data.config.fishing_slots[m].quest)+"</div>"}}if(h){showDiv("fishing_fishingslot"+m+"_block2")}else{if(l){showDiv("fishing_fishingslot"+m+"_block")}}if(l||h){if($("fishing_rod"+m)){$("fishing_rod"+m).removeClassName("sitting")}}$("fishing_fishingslot"+m).onclick=new Function(e);$("fishing_fishingslot"+m+"_tt").innerHTML=c;if(m>2){$("fishing_fishingslot"+m+"_tt").addClassName("right")}};fishing.prototype.buyFishingSlotCommit=function(h){var c=0;if(specialbonus){c=specialbonus.findBonus({key1:"fishing",key2:"buyfishingslot"})}var a=this.data.config.fishing_slots[h];var e=t_fishing_start_fishing_slot_buy_head;if(a.rent_duration){e=t_fishing_start_fishing_slot_rent_head}var n="fishing.buyFishingSlot("+h+")";var b="";var l="";var m="";if(a.coins){var q=a.coins;if(c&&c.buyfishingslot){q=Math.ceil(q*(1-c.buyfishingslot));l="bonus";m='<div class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(c.buyfishingslot*100))+")</div>"}}if(a.rent_duration){if(parseInt(q)>parseInt(user_coins)){l+=" important";n=""}info=str_replace("%TIME%",formatTime(a.rent_duration),t_fishing_start_fishing_slot_rent);info=str_replace("%COST%",'<span class="cost '+l+'">'+q+"&nbsp;"+t_coins+"</span>",info)}else{if(a.money){if(parseInt(a.money)>parseInt(user_bar)){l="important";n=""}info=str_replace("%COST%",'<span class="'+l+'">'+formatPrice(a.money)+"</span>",t_fishing_start_fishing_slot_buy)}if(a.coins){if(parseInt(q)>parseInt(user_coins)){l+=" important";n=""}info=str_replace("%COST%",'<span class="cost '+l+'">'+q+"&nbsp;"+t_coins+"</span>",t_fishing_start_fishing_slot_buy)}}b='<div id="fishing_commit" class="ready">'+info+m+"</div>";var d="hideDiv('globaltransp'); hideDiv('globalbox')";globalcommitbox(e,b,n,d)};fishing.prototype.startFishingSelection=function(r){if(!r){r=this.fishingSlot}else{this.fishingSlot=r}var d='<div id="fishing_start_selection">';d+='  <div class="desc">'+t_fishing_start_fishing_desc+"</div>";d+='  <div class="slots">';var e=0;var w=["category","rarity","item"];for(var c=0;c<w.length;c++){var t="";if(!this.fishingSlotSelection[w[c]]){t="empty";var l=t_fishing_start_fishing_selection_slot[w[c]]}else{var a=this.fishingSlotSelection[w[c]];if(w[c]=="item"){a=this.data.data.items[this.fishingSlotSelection[w[c]]].type}t="fishing_item"+a;var l=this.itemTT(a);e++}d+='<div class="slot '+w[c]+' square_slot link" onclick="fishing.startFishingClickSelection(\''+w[c]+"')\" onmouseover=\"showDiv('fishing_start_selection_slot_"+w[c]+"_tt')\" onmouseout=\"hideDiv('fishing_start_selection_slot_"+w[c]+"_tt')\">";d+='  <div class="img '+t+'"></div>';d+='  <div id="fishing_start_selection_slot_'+w[c]+'_tt" class="ttbox">'+l+"</div>";d+="</div>"}d+='    <div class="clear"></div>';d+="  </div>";var b=this.data.config.constants.fishingtime;var q=0;if(this.fishingSlotSelection.item){var m=this.data.data.items[this.fishingSlotSelection.item].type;if(this.data.config.items[m].bonus.bonus_time&&this.data.config.items[m].bonus.bonus_time>0){q+=this.data.config.items[m].bonus.bonus_time}}if(this.data.questbonus&&this.data.questbonus.bonus_fishingtime&&this.data.questbonus.bonus_fishingtime>0){q+=this.data.questbonus.bonus_fishingtime}var v="";var h="";if(q>0){v='<div style="color:green; margin-top:5px;">'+t_fishing_fishingtime_bonus.replace("%PERCENT%",Math.round(q*100))+"</div>";b=Math.ceil(b*(1-q))}d+='  <div class="duration">'+t_fishing_fishingtime+': <span style="font-weight:bold;">'+formatTime(b)+"</span>"+v+"</div>";var u="fishing.startFishing()";var t="";if(e!=3){t="off";u=""}d+='  <div class="link button_new '+t+'" onclick="'+u+'">'+t_fishing_start_fishing_button+"</div>";d+="</div>";var n="fishing.fishingSlot=0;hideDiv('globaltransp');hideDiv('globalbox');";globalBoxFlex(t_fishing_start_fishing_head,d,0,n,1);this.startTutorial("sel")};fishing.prototype.startFishingClickSelection=function(q){if(q=="item"){this.buildShop();return 1}var n={};var b={};var z=0;var w=0;if(this.fishingSlotSelection){if(this.fishingSlotSelection.category&&this.fishingSlotSelection.category>0){z++;if(in_array(this.fishingSlotSelection.category,this.data.config.forced_products)){w=1}}if(this.fishingSlotSelection.rarity&&this.fishingSlotSelection.rarity>0){z++;if(in_array(this.fishingSlotSelection.rarity,this.data.config.forced_products)){w=1}}}if(q=="item"){for(var d in this.data.data.items){if(this.data.data.items[d].stock==0){continue}n[d]=this.data.data.items[d]}}else{for(var d in this.data.config.products){if(q=="category"&&this.data.config.products[d].category!=1){continue}if(q=="rarity"&&this.data.config.products[d].category!=2){continue}var e=checkRackItem(d);if(e>0){b[d]=e;n[d]=this.data.config.products[d]}}}var h='<div id="fishing_start_selection_selection">';var l=0;for(var d in n){if(n[d]&&(n[d].durability||n[d].category)){l++}}if(!l){h+="<div>"+t_fishing_selection_no_items+"</div>";if(q=="item"){h+='<div class="shop_link link" onclick="fishing.buildShop()" onmouseover="showDiv(\'fishing_start_selection_selection_shop_link_tt\')" onmouseout="hideDiv(\'fishing_start_selection_selection_shop_link_tt\')">';h+='  <div id="fishing_start_selection_selection_shop_link_tt" class="ttbox">'+t_fishing_shop_name+"</div>";h+="</div>"}}else{h+='<div class="slots">';var l=1;for(var d in n){var a=d;if(q=="item"){a=n[d].type}var m=this.itemTT(a);var t="";if(l%5==0){t="right"}if(l>10){t+=" bottom"}var v="fishing.setFishingClickSelection('"+q+"', "+d+")";var s="";if(w==1&&!in_array(d,this.data.config.forced_products)){if(this.fishingSlotSelection[q]&&this.fishingSlotSelection[q]>0){}else{s="off";v=""}}if(!w&&z>0&&in_array(d,this.data.config.forced_products)){if(this.fishingSlotSelection[q]&&this.fishingSlotSelection[q]>0){}else{s="off";v=""}}h+='<div class="slot link" onclick="'+v+'" onmouseover="showDiv(\'fishing_start_selection_selection'+d+"_tt')\" onmouseout=\"hideDiv('fishing_start_selection_selection"+d+"_tt')\">";h+='  <div class="img fishing_item'+a+" "+s+'"></div>';if(b[a]){h+='<div class="amount">'+b[a]+"</div>"}if(q=="item"&&n[d].amount){h+='<div class="amount">'+n[d].amount+"</div>"}if(n[d].durability){h+='<div class="durability">'+n[d].durability+"</div>"}h+='  <div id="fishing_start_selection_selection'+d+'_tt" class="ttbox '+t+'">'+m+"</div>";h+="</div>";l++}h+='  <div class="clear"></div>';h+="</div>"}if(q!="item"&&w==1){var u=t_fishing_fantasy_food_info;for(var c=0;c<this.data.config.forced_products.length;c++){u=u.replace("%FOOD"+(c+1)+"%",produkt_name[this.data.config.forced_products[c]])}h+='<div style="margin-top:10px;">'+u+"</div>"}h+="</div>";var r="fishing.startFishingSelection()";globalBoxFlex(t_fishing_start_fishing_selection_slot[q],h,0,r,1);this.startTutorial("sel_"+q)};fishing.prototype.setFishingClickSelection=function(b,a){if(b!="items"){if(in_array(a,this.data.config.forced_products)){if(b=="category"&&this.fishingSlotSelection.rarity&&!in_array(this.fishingSlotSelection.rarity,this.data.config.forced_products)){this.fishingSlotSelection.rarity=0}if(b=="rarity"&&this.fishingSlotSelection.category&&!in_array(this.fishingSlotSelection.category,this.data.config.forced_products)){this.fishingSlotSelection.category=0}}else{if(b=="category"&&this.fishingSlotSelection.rarity&&in_array(this.fishingSlotSelection.rarity,this.data.config.forced_products)){this.fishingSlotSelection.rarity=0}if(b=="rarity"&&this.fishingSlotSelection.category&&in_array(this.fishingSlotSelection.category,this.data.config.forced_products)){this.fishingSlotSelection.category=0}}}this.fishingSlotSelection[b]=a;this.startFishingSelection()};fishing.prototype.buildProduction=function(){var a="";a+='  <div id="fishing_pharmacist" class="link" onmouseover="showDiv(\'fishing_pharmacist_tt\')" onmouseout="hideDiv(\'fishing_pharmacist_tt\')">';a+='    <div id="fishing_pharmacist_timer"></div>';a+='    <div id="fishing_pharmacist_tt" class="ttbox">';a+="      <div>"+t_fishing_pharmacist_buy_head+'</div><div class="bonusinfo">'+t_fishing_pharmacist_info+"</div>";a+="    </div>";a+='    <div class="fishing_pharmacist"></div>';a+='    <div id="fishing_pharmacist_unlocked" class="unlocked"></div>';a+="  </div>";a+='<div id="fishing_slots" class="slots">';for(var b=1;b<=4;b++){a+=production.buildSlot("fishing",b)}a+='  <div class="clear"></div>';a+="</div>";a+='<div class="goto pier link" onclick="fishing.setView(\'pier\')" onmouseover="showDiv(\'fishing_goto_pier_tt\')" onmouseout="hideDiv(\'fishing_goto_pier_tt\')"></div>';a+='<div id="fishing_goto_pier_tt" class="gotott pier ttbox">'+t_fishing_goto_pier+"</div>";$("fishing_view").innerHTML=a;$("fishing").removeClassName("pier").addClassName("production")};fishing.prototype.updateProductionSlot=function(b,a){production.updateSlot("fishing",b,a,this.data)};fishing.prototype.buyProductionSlotCommit=function(a){production.buySlotCommit("fishing",a,this.data.data.slots[a])};fishing.prototype.getCurrentProductionPosition=function(a){return production.currentQueueSlot("fishing",a)};fishing.prototype.buyPharmacistCommit=function(a){production.buyQueueCommit("fishing",a)};fishing.prototype.productionSelectionCommit=function(b){var d="fishing.startProduction("+b+")";var c="fishing.productionSelection()";var a='<div id="fishing_production_selection_commit">';a+='  <div class="img tt'+b+'"></div>';a+='  <div class="name">'+produkt_name[b]+"</div>";if(this.data.config.products[b].money&&this.data.config.products[b].money>0){var e=formatPrice(this.data.config.products[b].money)}if(this.data.config.products[b].coins&&this.data.config.products[b].coins>0){var e=this.data.config.products[b].coins+"&nbsp;"+t_coins}if(this.data.config.products[b].fishingpoints&&this.data.config.products[b].fishingpoints>0){var e=formatNumber(this.data.config.products[b].fishingpoints)+"&nbsp;"+t_fishing_stats.points}a+="  <div>"+cityadcost+e+"</div>";a+="</div>";globalcommitbox(t_start_production,a,d,c)};fishing.prototype.setProductionSelectionFilter=function(a){this.productionSelectionFilter=a;this.productionSelectionPage=1;this.productionSelection()};fishing.prototype.productionSelection=function(c){if(!c){c=this.productionSlot}else{this.productionSlot=c}var w=((this.productionSelectionPage-1)*4)+1;var b=(this.productionSelectionPage*4);var e=0;var m='<div id="fishing_production_selection">';var n=["category","rarity","none"];m+='<div class="filters">';for(var A=0;A<n.length;A++){var d="";if(this.productionSelectionFilter==n[A]){d="active"}m+='<div class="filter link '+d+'" onclick="fishing.setProductionSelectionFilter(\''+n[A]+"')\" onmouseover=\"showDiv('fishing_production_selection_filter_"+n[A]+"_tt')\" onmouseout=\"hideDiv('fishing_production_selection_filter_"+n[A]+"_tt')\">";m+='  <div class="img '+n[A]+'"></div>';if(n[A]=="none"){m+='<div class="none category"></div>';m+='<div class="none rarity"></div>'}m+='  <div id="fishing_production_selection_filter_'+n[A]+'_tt" class="ttbox">'+t_fishing_production_selection_filter[n[A]]+"</div>";m+="</div>"}m+="</div>";var l=0;if(specialbonus){l=specialbonus.findBonus({key1:"fishing",key2:"harvest"})}for(var t in this.data.data.sorted){var r=t.replace("p","");if(this.productionSelectionFilter=="category"&&this.data.config.products[r].category!=1){continue}if(this.productionSelectionFilter=="rarity"&&this.data.config.products[r].category!=2){continue}e++;if(e>=w&&e<=b){var s=0;var v="fishing.productionSelectionCommit("+r+")";if(this.data.config.products[r].level&&this.data.config.products[r].level>this.data.data.level){v="";s=1}if(this.data.config.products[r].needs.products){for(var A in this.data.config.products[r].needs.products){var h=checkRackItem(A);if(this.data.config.products[r].needs.products[A]>h){v=""}}}if(this.data.config.products[r].needs.items){for(var A in this.data.config.products[r].needs.items){var h=0;if(this.data.data.stock&&this.data.data.stock[A]){h=parseInt(this.data.data.stock[A])}if(this.data.config.products[r].needs.items[A]>h){v=""}}}if(this.data.config.products[r].needs.fishingpoints){var h=this.data.data.count;if(this.data.config.products[r].needs.fishingpoints>h){v=""}}var C="";var B="";if(this.data.config.products[r].money&&this.data.config.products[r].money>0){if(this.data.config.products[r].money>user_bar){C="important";v=""}B=formatPrice(this.data.config.products[r].money)}if(this.data.config.products[r].coins&&this.data.config.products[r].coins>0){if(this.data.config.products[r].coins>user_coins){C="important";v=""}B=this.data.config.products[r].coins+"&nbsp;"+t_coins}if(this.data.config.products[r].fishingpoints&&this.data.config.products[r].fishingpoints>0){if(parseInt(this.data.config.products[r].fishingpoints)>parseInt(this.data.data.count)){C="important";v=""}B=formatNumber(this.data.config.products[r].fishingpoints)+"&nbsp;"+t_fishing_stats.points}m+='<div class="slot" onclick="'+v+'">';m+='  <div class="img tt'+r+'"></div>';m+='  <div class="info">';var h=this.data.config.products[r].amount;var q="";var d="";if(l&&l.harvest){h+=l.harvest;q='<div style="color:green; font-weight:normal;">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+l.harvest)+")</div>";d="specialbonus"}m+='    <div class="name line '+d+'">'+h+"x "+produkt_name[r]+q+"</div>";if(this.data.config.products[r].category_chances){m+='<div class="type">'+t_fishing_category_name+"</div>"}if(this.data.config.products[r].rarity_chances){m+='<div class="type">'+t_fishing_rarity_name+"</div>"}if(s){m+='<div class="important">'+t_fishing_requires_level.replace("%COUNT%",this.data.config.products[r].level)+"</div>"}else{if(this.data.config.products[r].category_chances){for(var z in this.data.config.products[r].category_chances){var u=this.data.config.products[r].category_chances[z];if(u>0){m+="<div>"+t_fishing_category[z]+": "+(u*100)+"%</div>"}}}if(this.data.config.products[r].rarity_chances){for(var z in this.data.config.products[r].rarity_chances){var u=this.data.config.products[r].rarity_chances[z];if(u>0){m+="<div>"+t_fishing_rarity[z]+": "+(u*100)+"%</div>"}}}m+="</div>";m+='<div class="clear"></div>'}if(!s){var a=this.data.config.products[r].duration;var q="";if(this.data.questbonus&&this.data.questbonus.bonus_productiontime&&this.data.questbonus.bonus_productiontime>0){a=Math.ceil(a*(1-this.data.questbonus.bonus_productiontime));q='<span style="color:green">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(this.data.questbonus.bonus_productiontime*100))+")</span>"}m+='<div class="needs">';m+='  <div class="intro">'+t_needs+":</div>";m+='  <div class="intro_block">';m+="     <div>"+formatTime(a)+" "+q+"</div>";m+='     <div class="cost '+C+'">'+B+"</div>";m+="  </div>";m+='  <div class="clear"></div>';for(var A in this.data.config.products[r].needs){if(A=="products"){for(var z in this.data.config.products[r].needs[A]){var h=checkRackItem(z);var d="";if(this.data.config.products[r].needs[A][z]>h){d="important"}m+='<div class="product '+d+'" onmouseover="showDiv(\'fishing_productionselection_pid'+r+"_"+z+"')\" onmouseout=\"hideDiv('fishing_productionselection_pid"+r+"_"+z+"')\">";m+='  <div class="l'+z+'" style="border-radius:5px;"></div>';m+='  <div style="font-weight:bold;">'+this.data.config.products[r].needs[A][z]+"x</div>";m+='  <div id="fishing_productionselection_pid'+r+"_"+z+'" class="ttbox">'+produkt_name[z]+"</div>";m+="</div>"}}if(A=="items"){for(var z in this.data.config.products[r].needs[A]){var d="";var h=0;if(this.data.data.stock&&this.data.data.stock[z]){h=parseInt(this.data.data.stock[z])}if(this.data.config.products[r].needs[A][z]>h){d="important"}m+='<div class="item '+d+'" onmouseover="showDiv(\'fishing_productionselection_item'+r+"_"+z+"')\" onmouseout=\"hideDiv('fishing_productionselection_item"+r+"_"+z+"')\">";m+='  <div class="itemimg fishing_trove'+z+'" style="border-radius:5px;"></div>';m+='  <div style="font-weight:bold;">'+this.data.config.products[r].needs[A][z]+"x</div>";m+='  <div id="fishing_productionselection_item'+r+"_"+z+'" class="ttbox">'+this.data.config.trove[z].name+"</div>";m+="</div>"}}if(A=="fishingpoints"){var d="";var h=this.data.data.count;if(this.data.config.products[r].needs[A]>h){d="important"}m+='<div class="item '+d+'" onmouseover="showDiv(\'fishing_productionselection_item_points\')" onmouseout="hideDiv(\'fishing_productionselection_item_points\')">';m+='  <div class="itemimg fishing_points" style="border-radius:5px;"></div>';m+='  <div style="font-weight:bold;">'+this.data.config.products[r].needs[A]+"x</div>";m+='  <div id="fishing_productionselection_item_points" class="ttbox">'+t_fishing_stats.points+"</div>";m+="</div>"}}}m+="</div>";if(s){m+='<div class="locked"></div>'}m+="</div>"}}m+='  <div class="clear"></div>';m+='  <div id="fishing_production_selection_navi_up" onclick="fishing.productionSelectionNavi(-1, '+e+')"></div>';m+='  <div id="fishing_production_selection_navi_down" onclick="fishing.productionSelectionNavi(1, '+e+')"></div>';m+="</div>";globalBoxFlex(t_choose_to_produce,m,0,0,1);$("globalbox").style.top="40px";this.productionSelectionNavi(0,e)};fishing.prototype.productionSelectionNavi=function(b,c){var a=parseInt(Math.ceil(c/4));this.productionSelectionPage+=b;if(this.productionSelectionPage<1){this.productionSelectionPage=1}if(this.productionSelectionPage>a){this.productionSelectionPage=a}if(b){this.productionSelection()}hideDiv("fishing_production_selection_navi_up");hideDiv("fishing_production_selection_navi_down");if(this.productionSelectionPage>1){showDiv("fishing_production_selection_navi_up")}if(this.productionSelectionPage<a){showDiv("fishing_production_selection_navi_down")}};fishing.prototype.buildBook=function(){var a="";a+='<div class="transp"></div>';a+='<div class="book">';a+='  <div id="fishing_book_side_left" class="page left"></div>';a+='  <div id="fishing_book_side_right" class="page right"></div>';a+='  <div id="fishing_book_navi_left" class="navi left link" onclick="fishing.setBookPage(-2)"></div>';a+='  <div id="fishing_book_navi_right" class="navi right link" onclick="fishing.setBookPage(+2)"></div>';a+='  <div class="mini_close link" onclick="fishing.closeBook()"></div>';a+="</div>";$("fishing_book").innerHTML=a;showDiv("fishing_book");this.setBookPage()};fishing.prototype.getBookMaxPages=function(){var a=0;for(var b in this.data.config.fish){a++}return Math.ceil(a/2)};fishing.prototype.setBookPage=function(b){if(b){this.currentBookPage+=b}if(this.currentBookPage<1){this.currentBookPage=1}var a=this.getBookMaxPages();if(this.currentBookPage>=a){this.currentBookPage=(a-1)}showDiv("fishing_book_navi_left");showDiv("fishing_book_navi_right");if(this.currentBookPage==1){hideDiv("fishing_book_navi_left")}if(this.currentBookPage==(a-1)){hideDiv("fishing_book_navi_right")}this.buildBookPage("left",this.currentBookPage);this.buildBookPage("right",(this.currentBookPage+1))};fishing.prototype.buildBookPage=function(t,s){var r={};for(var d in this.data.config.fish){if(!r[this.data.config.fish[d].category]){r[this.data.config.fish[d].category]={}}r[this.data.config.fish[d].category][d]=this.data.config.fish[d]}var l="";var w=(s+(s-1));var z=(w+1);var n=0;var q=1;for(var c in r){for(var d in r[c]){n++;if(n>=w&&n<=z){var b=0;var a=this.data.config.fish[d].name;if(!this.data.stats||!this.data.stats["fish"+d+"_size"]){b=1;a=t_fishing_unknown_fish}var v="";if(q==1){v="spacer"}l+='<div class="line '+v+'">';l+='  <div class="name">'+a+"</div>";l+='  <div class="type">';l+="    <div>"+t_fishing_category[this.data.config.fish[d].category]+"</div>";l+="    <div>"+t_fishing_rarity[this.data.config.fish[d].rarity]+"</div>";l+="  </div>";if(!b&&this.data.data.fishingtypelog&&this.data.data.fishingtypelog[d]){l+='<div class="info" onmouseover="showDiv(\'fishing_book_fish'+d+"_info')\" onmouseout=\"hideDiv('fishing_book_fish"+d+"_info')\">i";l+='  <div id="fishing_book_fish'+d+'_info" class="ttbox">';l+='    <div class="count">'+t_fishing_count_fishing+this.data.stats["fish"+d+"_count"]+"</div>";l+="    <div><b>"+t_fishing_last_fishing+"</b></div>";var m=0;for(var h=this.data.data.fishingtypelog[d].length;h>0;h--){var e=(h-1);l+='<div class="line">';l+='  <div class="size">'+this.showFishSize(this.data.data.fishingtypelog[d][e])+"</div>";l+=this.buildFishingBookStars(d,this.data.data.fishingtypelog[d][e],h);l+='  <div class="clear"></div>';l+="</div>";m++;if(m>=5){break}}l+="  </div>";l+="</div>"}if(b){l+='<div class="unknown">?</div>'}else{l+='<div class="img fishing_fish'+d+'"></div>';l+=this.buildFishingBookStars(d,this.data.stats["fish"+d+"_size"])}if(!b){l+='<div class="size">'+t_fishing_best_size+"<b>"+this.showFishSize(this.data.stats["fish"+d+"_size"])+"</b></div>"}l+="</div>";q++}}}var u=this.getBookMaxPages();if(s<=u){l+='<div class="pager">'+s+"/"+u+"</div>"}$("fishing_book_side_"+t).innerHTML=l};fishing.prototype.buildFishingBookStars=function(m,h,e){var a=this.getFishSizeStars(m,h);var l=m;if(e){l+="_"+e}var d="";d+='<div class="stars" onmouseover="showDiv(\'fishing_book_fish'+l+"_max_size')\" onmouseout=\"hideDiv('fishing_book_fish"+l+"_max_size')\">";for(var c=1;c<=5;c++){var b="";if(c>a){b="off"}d+='<div class="star '+b+'"></div>'}d+='  <div class="clear"></div>';d+='  <div id="fishing_book_fish'+l+'_max_size" class="ttbox">'+t_fishing_size_max+this.showFishSize(this.data.config.fish[m].size_max*1000)+"</div>";d+="</div>";return d};fishing.prototype.closeBook=function(){hideDiv("fishing_book")};fishing.prototype.buildStock=function(){var e='<div id="fishing_stock">';e+='<div class="head">'+t_fishing_stock_head+"</div>";e+='<div class="desc">'+t_fishing_stock_desc+"</div>";e+='<div class="slots">';for(var d in this.data.config.trove){var b=0;if(this.data.data.level<this.data.config.trove[d].level){b=1}var c=0;var a="";if(this.data.data.stock&&this.data.data.stock[d]){c=this.data.data.stock[d];a=""}e+='<div class="slot '+a+'" onmouseover="showDiv(\'fishing_stock_slot'+d+"_tt')\" onmouseout=\"hideDiv('fishing_stock_slot"+d+"_tt')\">";e+='  <div class="img fishing_trove'+d+'"></div>';if(c>0||!b){e+='<div class="amount">'+c+"</div>"}var a="off";var l="";var h="onmouseover=\"showDiv('fishing_stock_slot"+d+"_buy_tt')\" onmouseout=\"hideDiv('fishing_stock_slot"+d+"_buy_tt')\"";if(!b){h="";a="";l="fishing.buyStockCommit("+d+")"}e+='  <div class="buy link '+a+'" onclick="'+l+'" '+h+">+</div>";e+='  <div id="fishing_stock_slot'+d+'_buy_tt" class="buytt ttbox">'+t_fishing_requires_level.replace("%COUNT%",this.data.config.trove[d].level)+"</div>";e+='  <div id="fishing_stock_slot'+d+'_tt" class="ttbox">'+this.data.config.trove[d].name+"</div>";e+="</div>"}e+='  <div class="clear"></div>';e+="</div>";globalBoxFlex("",e,0,0,1);this.startTutorial("trove")};fishing.prototype.buyStockCommit=function(b){var h=0;if(specialbonus){h=specialbonus.findBonus({key1:"fishing",key2:"buystockitem"})}var a=this.data.config.trove[b].name;var l="fishing.buildStock()";var d='<div id="fishing_stock_commit">';d+='  <div class="img fishing_trove'+b+'"></div>';d+='  <div class="name">'+a+"</div>";var e=1;for(var s in this.data.config.trove[b].buy){var c=this.data.config.trove[b].buy[s];var n="";if(h&&e>1){c=Math.ceil(c*(1+h.buystockitem));n="bonus"}var r="fishing.buyStockCommitCommit("+b+", "+s+")";var m="";if(parseInt(s)>parseInt(user_coins)){m="off";r=""}var q=fishing_stock_buy_line2.replace("%AMOUNT%",'<span class="'+n+'">'+c+"x</span>").replace("%NAME%","").replace("%COST%",formatNumber(s)+"&nbsp;"+t_coins).replace("?","");d+='<div class="buy coinsbutton_flex link '+m+'" onclick="'+r+'">'+q+"</div>";e++}if(h&&h.buystockitem){d+='<div class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(h.buystockitem*100))+")</div>"}d+="</div>";globalBoxFlex(fishing_stock_buy_head.replace("%NAME%",a),d,0,l,1)};fishing.prototype.buyStockCommitCommit=function(h,b){var d=this.data.config.trove[h].name;var e=this.data.config.trove[h].buy[b];var l="fishing.buyStock("+h+", "+b+")";var c="fishing.buyStockCommit("+h+")";var a='<div id="fishing_stock_commit">';a+="  <div>"+fishing_stock_buy_line.replace("%AMOUNT%",e).replace("%NAME%",d).replace("%COST%","<b>"+formatNumber(b)+"&nbsp;"+t_coins+"</b>");a+="</div>";globalcommitbox(fishing_stock_buy_head.replace("%NAME%",d),a,l,c)};fishing.prototype.buildShop=function(){var m=0;if(specialbonus){m=specialbonus.findBonus({key1:"fishing",key2:"buyshopitem"})}var d='<div id="fishing_shop">';d+='  <div class="side stock">';d+='    <div class="head">'+t_fishing_shop_stock+"</div>";d+='    <div class="desc">'+t_fishing_shop_stock_desc+"</div>";d+='    <div class="slots">';if(this.data.data.items){for(var b in this.data.data.items){var q="";var h="";var r="";if(this.fishingSlot>0&&this.currentView=="pier"){r="fishing.setFishingClickSelection('item', "+b+")"}if(this.data.data.items[b].stock==0){q="off";h="onmouseover=\"showDiv('fishing_shop_item"+b+"_stock_tt')\" onmouseout=\"hideDiv('fishing_shop_item"+b+"_stock_tt')\"";r=""}d+='<div class="slot link" '+h+' onclick="'+r+'">';d+='  <div class="img fishing_item'+this.data.data.items[b].type+" "+q+'"></div>';d+='  <div class="durability">'+this.data.data.items[b].durability+"</div>";d+='  <div id="fishing_shop_item'+b+'_stock_tt" class="ttbox notavailable">'+t_fishing_shop_not_available+"</div>";d+="</div>"}}d+="    </div>";d+="  </div>";d+='  <div class="side merchant">';d+='    <div class="head">'+t_fishing_shop_merchant+"</div>";d+='    <div class="desc">'+t_fishing_shop_merchant_desc+"</div>";d+='    <div class="slots">';var e=1;for(var b in this.data.config.items){var s=this.data.config.items[b];var l=this.itemTT(b);var c=0;if(s.quest&&s.quest>0&&s.quest>this.data.highestquest){c=1;l+='<div class="warning">'+t_fishing_requires_quest.replace("%COUNT%",s.quest)+"</div>"}var r="fishing.shopBuyCommit("+b+")";if(c>0){r=""}var q="";if(e>4){q="bottom"}var n="";if(s.money){if(parseInt(s.money)>parseInt(user_bar)){n="important";r=""}var a=formatPrice(s.money)}if(s.coins){var t=s.coins;if(m&&m.buyshopitem){t=Math.ceil(t*(1-m.buyshopitem));n+="bonus"}if(parseInt(t)>parseInt(user_coins)){n+=" important";r=""}var a=t+"&nbsp;"+t_coins}d+='<div class="slot link" onclick="'+r+'" onmouseover="fishing.shopHoverItem(1, '+b+')" onmouseout="fishing.shopHoverItem(0, '+b+')">';d+='  <div id="fishing_itemshop_item'+b+'_img" class="img fishing_item'+b+'"></div>';d+='  <div id="fishing_shop_item'+b+'_tt" class="ttbox '+q+'">'+l+"</div>";d+='  <div class="price '+n+'">'+a+"</div>";if(c>0){d+='<div class="locked"></div>'}d+="</div>";e++}d+='      <div class="clear"></div>';d+="    </div>";d+="  </div>";d+='  <div class="clear"></div>';if(m&&m.buyshopitem){d+='<div class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(m.buyshopitem*100))+")</div>"}d+="</div>";globalBoxFlex("",d,0,0,1);$("globalbox").style.top="40px";this.startTutorial("sel_item")};fishing.prototype.shopBuyCommit=function(d){var h=0;if(specialbonus){h=specialbonus.findBonus({key1:"fishing",key2:"buyshopitem"})}var c="";var b='<div id="fishing_itemshop_commit">';b+='<div class="slot">';b+='  <div class="img fishing_item'+d+'"></div>';b+="</div>";b+='<div class="name">'+this.data.config.items[d].name+"</div>";if(this.data.config.items[d].money&&this.data.config.items[d].money>0){b+="<div>"+t_fishing_shop_buy_body.replace("%COST%",formatPrice(this.data.config.items[d].money))+"</div>"}if(this.data.config.items[d].coins&&this.data.config.items[d].coins>0){var a=this.data.config.items[d].coins;if(h&&h.buyshopitem){a=Math.ceil(a*(1-h.buyshopitem));c+="bonus"}b+='<div class="cost">'+t_fishing_shop_buy_body.replace("%COST%",'<span class="'+c+'">'+a+"&nbsp;"+t_coins+"</span>")+"</div>"}if(h&&h.buyshopitem){b+='<div class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(h.buyshopitem*100))+")</div>"}var e="fishing.shopBuy("+d+")";globalcommitbox(t_fishing_shop_buy_head,b,e,"fishing.buildShop()")};fishing.prototype.shopHoverItem=function(a,b){if(a==1){$("fishing_itemshop_item"+b+"_img").addClassName("hover");showDiv("fishing_shop_item"+b+"_tt")}else{$("fishing_itemshop_item"+b+"_img").removeClassName("hover");hideDiv("fishing_shop_item"+b+"_tt")}};fishing.prototype.itemTT=function(c){var b="";if(this.data.config.items[c]){var e=this.data.config.items[c]}else{if(produkt_name[c]){var e=this.data.config.products[c];e.name=produkt_name[c]}else{return b}}b+='<div class="iteminfo">';b+='  <div class="name">'+e.name+"</div>";var d="";if(e.category_chances){d=t_fishing_category_name}if(e.rarity_chances){d=t_fishing_rarity_name}if(d!=""){b+='<div class="type">'+d+"</div>"}if(e.bonus){for(var c in e.bonus){if(t_fishing_item_bonus[c]&&e.bonus[c]>0){b+="<div>"+t_fishing_item_bonus[c]+": "+(e.bonus[c]*100)+"%</div>"}}}if(e.category_chances){for(var a in e.category_chances){if(e.category_chances[a]>0){b+="<div>"+t_fishing_category[a]+": "+(e.category_chances[a]*100)+"%</div>"}}}if(e.rarity_chances){for(var a in e.rarity_chances){if(e.rarity_chances[a]>0){b+="<div>"+t_fishing_rarity[a]+": "+(e.rarity_chances[a]*100)+"%</div>"}}}if(e.durability){b+='<div class="line dur">'+t_megafield_vehicle_durability+e.durability+"</div>"}b+="</div>";return b};fishing.prototype.buildContest=function(){var h='<div id="fishing_contest">';h+='<div class="head">'+t_fishing_contest_name+"</div>";h+='<div class="info">';h+='<select id="fishing_contest_select" onchange="fishing.selectContest()">';h+='  <option value="current">'+t_fishing_contest_select_current+"</option>";if(this.contestData.history){var m=this.contestData.history.length;for(var e=0;e<this.contestData.history.length;e++){var a=this.contestData.history[e];var s="";if(this.contestData.old&&this.contestData.old==a){s="selected"}h+='<option value="'+a+'" '+s+">"+t_fishing_contest_select_older.replace("%COUNT%",m)+"</option>";m--}}h+="</select>";var b=this.contestData.category;h+="  <div>"+t_fishing_contest_category.replace("%CATEGORY%",'<span class="category" onmouseover="showDiv(\'fishing_contest_info_category_tt\')" onmouseout="hideDiv(\'fishing_contest_info_category_tt\')">'+t_fishing_category[b]+"</span>")+"</div>";h+='  <div id="fishing_contest_info_category_tt" class="ttbox">';h+='    <div class="desc">'+t_fishing_contest_category_valid+"</div>";for(var e in this.data.config.fish){var n=this.data.config.fish[e];if(!n||parseInt(n.category)!=parseInt(b)){continue}h+='<div class="line">';h+='  <div class="name">'+n.name+"</div>";h+='  <div class="fish fishing_fish'+e+'"></div>';h+="</div>"}h+='    <div class="clear"></div>';h+="  </div>";h+='  <div id="fishing_contest_timer" class="timer">'+t_fishing_contest_timer.replace("%TIME%",formatTime(this.contestData.remain))+"</div>";h+='  <div id="fishing_contest_blocked" class="blocked">';h+='    <div class="passed">'+t_fishing_contest_passed+"</div>";if(!this.contestData.old){h+='<div class="waiting">'+t_fishing_contest_waiting+"</div>"}h+="  </div>";if(this.data.config.constants.contest_minlevel>this.data.data.level){h+='<div class="minlevel">'+t_fishing_contest_minlevel.replace("%LEVEL%",this.data.config.constants.contest_minlevel)+"</div>"}else{if(!this.contestData.registered){h+='<div id="fishing_contest_register" class="button_new link" onclick="fishing.registerContestCommit()">'+t_fishing_contest_register_head+"</div>"}}h+="</div>";var l=this.contestData.entries;if(l){h+='<div class="list">';var d=0;var c=0;for(var e=0;e<l.length;e++){var r=l[e];if(!c||r.size!=c){d++;var t=d+"."}else{var t="&nbsp;"}var q="";if(player_unr==r.unr){q="self"}h+='<div class="line">';h+='  <div class="rank">'+t+"</div>";h+='  <div class="name '+q+'">'+r.name+"</div>";h+='  <div class="fish fishing_fish'+r.type+'"></div>';h+='  <div class="fish_name">'+this.data.config.fish[r.type].name+"</div>";h+='  <div class="value">'+this.showFishSize(r.size)+"</div>";h+='  <div class="clear"></div>';h+="</div>";c=r.size}h+="</div>"}h+="</div>";globalBoxFlex("",h,0,0,1);$("globalbox").style.top="40px";this.startTutorial("contest")};fishing.prototype.selectContest=function(){var a=$("fishing_contest_select").value;this.initContest(a)};fishing.prototype.registerContestCommit=function(){var c=t_fishing_contest_register_head;var a='<div id="fishing_contest_commit">'+t_fishing_contest_register_desc.replace("%COST%","<b>"+formatPrice(this.data.config.constants.contest_fee)+"</b>")+"</div>";var d="fishing.registerContest()";var b="fishing.buildContest()";globalcommitbox(c,a,d,b)};fishing.prototype.timer=function(){if(this.data){if(this.data.data&&this.data.data.queue_remain){this.data.data.queue_remain--}if(this.data.config&&this.data.config.starterpack&&this.data.config.starterpack.remain){this.data.config.starterpack.remain--}for(var c=1;c<=4;c++){if(this.data.data&&this.data.data.fishingslots&&this.data.data.fishingslots[c]&&this.data.data.fishingslots[c].selection){this.data.data.fishingslots[c].remain--}if(this.data.data&&this.data.data.fishingslots&&this.data.data.fishingslots[c]&&this.data.data.fishingslots[c].rent_duration){this.data.data.fishingslots[c].rent_remain--}if($("fishing")){this.updateFishingSlot(c);var b=this.getCurrentProductionPosition(c);this.updateProductionSlot(c,b)}}if(this.data.quest&&this.data.quest.remain){this.data.quest.remain--}for(var a in this.stats_cache_delay){this.stats_cache_delay[a]--}if(this.contestData){this.contestData.remain--}this.timerUpdate()}};fishing.prototype.timerUpdate=function(){production.buildOuterProductionLine("fishing");production.updateQueue("fishing");for(var c=1;c<=4;c++){if($("fishing_pharmacist_slots"+c)){$("fishing_pharmacist_slots"+c).removeClassName("right")}var b=this.getCurrentProductionPosition(c);if(this.data&&this.data.production&&this.data.production[c]){this.data.production[c]["gone"]++;if(this.data.production[c][b]){this.data.production[c][b].remain--}}if(this.data&&this.data.data&&this.data.data.slots&&this.data.data.slots[c]&&this.data.data.slots[c].rent_remain){this.data.data.slots[c].rent_remain--;if(!this.data.data.slots[c].rent_remain){this.data.data.slots[c].rent_remain--}if(this.data.data.slots[c].rent_remain>0&&$("fishing_pharmacist_slots"+c)){$("fishing_pharmacist_slots"+c).addClassName("right")}}}if(this.data.quest&&!this.data.quest.end){if(this.data.quest.remain>0){showDiv("fishing_quest_timer");hideDiv("fishing_quest_data");if($("fishing_quest_timer")){$("fishing_quest_timer").innerHTML=formatTime(this.data.quest.remain)}}else{hideDiv("fishing_quest_timer");showDiv("fishing_quest_data")}}hideDiv("fishing_starterpack_link");if(this.data.config&&this.data.config.starterpack&&this.data.config.starterpack.remain){if(this.data.config.starterpack.remain>0){if($("fishing_starterpack_timer")){$("fishing_starterpack_timer").innerHTML=formatTime(this.data.config.starterpack.remain)}if($("fishing_starterpack_link")){$("fishing_starterpack_link_timer").innerHTML=formatTime(this.data.config.starterpack.remain)}showDiv("fishing_starterpack_link")}}if(this.contestData&&$("fishing_contest_timer")){var a=$("fishing_contest_select").value;if(this.contestData.remain>0&&a=="current"){hideDiv("fishing_contest_blocked");$("fishing_contest_timer").innerHTML=t_fishing_contest_timer.replace("%TIME%",formatTime(this.contestData.remain));showDiv("fishing_contest_register");showDiv("fishing_contest_timer")}else{showDiv("fishing_contest_blocked");hideDiv("fishing_contest_register");hideDiv("fishing_contest_timer")}}};fishing.prototype.showStats=function(){var a='<div id="fishing_stats">';a+='  <div class="select_line">';a+='    <select id="fishing_stats_select" onchange="fishing.stats()">';for(var b=0;b<this.stats_options.length;b++){if(this.stats_options[b]==""){a+='<option value="0">---</option>';continue}var c="";if(this.stats_select==this.stats_options[b]){c="selected"}a+='<option value="'+this.stats_options[b]+'" '+c+">"+t_fishing_stats[this.stats_options[b]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_fishing_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';if(in_array(this.stats_select,["contest"])){a+='  <div style="margin-left:330px;">';a+='    <div class="trophy gold '+this.stats_select+'"></div>';a+='    <div class="trophy silver '+this.stats_select+'"></div>';a+='    <div class="trophy bronze '+this.stats_select+'"></div>';a+='    <div class="clear"></div>';a+="  </div>"}a+=htmlStatsContent(this.stats_cache[this.stats_select],this.stats_select);a+="</div>";globalBoxFlex("",a,0,0,1)};fishing.prototype.showQuest=function(){htmlQuestBox("fishing");this.timerUpdate()};fishing.prototype.questEntryCommit=function(c){for(var h in this.data.quest.products){if(h==c){var d=this.data.quest.products[c];if(this.data.quest.data&&this.data.quest.data[c]){var d=(d-this.data.quest.data[c])}break}}var a=checkRackItem(c);var b="kp"+c;if(a>d){a=d}var e={pid:c};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(e),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("fishing.checkQuestEntry("+c+", "+d+")");$("dialog_entryline_number").onkeyup=new Function("fishing.checkQuestEntry("+c+", "+d+")");this.checkQuestEntry(c,d)};fishing.prototype.checkQuestEntry=function(a,c){var e=checkRackItem(a);var b="product";var d={type:b,stockamount:e,rest:c,click:"fishing.questEntry("+a+")"};checkEntryLine(d)};fishing.prototype.help=function(){openFarmersMarketHowTo("fishing",1);this.helpNavi()};fishing.prototype.helpNavi=function(c){var b=["general","fish"];if(!c){c="general"}for(var a=0;a<b.length;a++){$("fishing_help_navi_tab_"+b[a]).removeClassName("active");hideDiv("fishing_help_"+b[a])}$("fishing_help_navi_tab_"+c).addClassName("active");showDiv("fishing_help_"+c)};fishing.prototype.close=function(){if($("farmersmarket_pos9_inner")){$("farmersmarket_pos9_inner").removeEventListener("click",fishingClickwatching)}if($("globalbox")){$("globalbox").removeEventListener("click",fishingClickwatching)}fishing.closeTutorial();hideDiv("transp");hideDiv("farmersmarket_pos9_inner")};fishing.prototype.easteregg=function(){var a="DAVID";var d='<div id="easteregg_fishline" class="fishline">';for(var c=1;c<=5;c++){var b=getRandom(1,40);d+='<div id="easteregg_fish_'+c+"_"+b+'" class="fish fishing_fish'+b+'">';d+='  <div id="easteregg_fish_'+c+"_"+b+'_letter" class="letter">'+a[(c-1)]+"</div>";d+="</div>";var e=getRandom(10,500);fishing.eastereggFishJumping(c,b,e)}d+='  <div class="clear"></div>';d+="</div>";$("fishing_view").insert(d);setTimeout(function(){$("easteregg_fishline").addClassName("off");setTimeout(function(){$("easteregg_fishline").remove()},1000)},3500)};fishing.prototype.eastereggFishJumping=function(b,a,c){setTimeout(function(){$("easteregg_fish_"+b+"_"+a).addClassName("jump");$("easteregg_fish_"+b+"_"+a+"_letter").addClassName("visible")},c)};function fishingClickwatching(){fishing.closeTutorial()}var flowerarea_cache={};var flowerarea_cache_run=0;var flowerarea_modus="";var flowerarea_autoplant_select=0;var flowerarea_changebonus_select=0;var flowerslots_cache={};var flowerslots_cache_run=0;var flowerslots_modus="";var flowerslots_ready_cache=0;var flowerslots_countpoints={};var flowerarea_unique_drops={};var flowerslots_need_water=0;var megafruit_block=0;var megafruit_stats={};var megafruit_stats_delay=0;var megafruit_stats_select=99;var megafruit_stats_cache={};var foodcontest_block=0;var foodcontest_merch_slot_select=0;var foodcontest_pincache=[];var foodcontest_cache_run=0;var foodcontest_feedback={};var foodcontest_stats=[];var foodcontest_stats_select="fighter";var foodcontest_merch_category=1;var foodcontest_merch_categories_count={"1":0,"2":0,"3":0};var foodcontest_merch_categories_page=1;var in_foodcontest=0;var nursery_startproduction_block=0;var flowerareaStopSpam=0;function initFlowerArea(){flowerareaStopSpam=0;var e="";e+='<div id="flowerarea_plantarea">';for(var d=1;d<=36;d++){e+='<div id="flowerarea_tile'+d+'" class="flowerarea_tile" onmouseover="checkFlowerAreaTile('+d+', 1);" onmouseout="checkFlowerAreaTile('+d+', 0);">';e+='  <div id="flowerarea_tile'+d+'_status" class="flowerarea_tile_status"></div>';e+='  <div id="flowerarea_tile'+d+'_water" class="flowerarea_tile_water"></div>';e+='  <div id="flowerarea_tile'+d+'_pid" class="flowerarea_tile_pid"></div>';e+='  <div id="flowerarea_tile'+d+'_tt" class="flowerarea_tile_tt ttbox"></div>';e+="</div>";if(d%6==0){e+='<div class="clear"></div>'}}e+="</div>";e+='<div id="flowerarea_buttons">';e+='  <div class="flowerarea_modus_plant link flowerarea_buttons" onclick="flowerarea_modus=\'plant\';" onmouseover="showDiv(\'flowerarea_button_tt_plant\')" onmouseout="hideDiv(\'flowerarea_button_tt_plant\')">';e+='    <div id="flowerarea_button_tt_plant" class="ttbox flowerarea_button_tt">'+t_anpflanzen+"</div>";e+="  </div>";e+='  <div class="flowerarea_modus_water link flowerarea_buttons" onclick="flowerarea_modus=\'water\';" onmouseover="showDiv(\'flowerarea_button_tt_water\')" onmouseout="hideDiv(\'flowerarea_button_tt_water\')">';e+='    <div id="flowerarea_button_tt_water" class="ttbox flowerarea_button_tt">'+lng_t_giessen+'<div class="bonusinfo">'+str_replace("%BONUS%",flowerarea_water_percent,garden_waterbonus)+"</div></div>";e+="  </div>";var c="show_page('coins',0);";var a="show_page('coins',0);";var b="show_page('coins',0);";var h="";if(premium){c="farmAction('flowerarea_water_all', 1, 1);";a="farmAction('flowerarea_harvest_all', 1, 1);";b="dialogFlowerArea('autoplant')"}else{h='<div class="bonusinfo important">'+inforequirepremium+"</div>"}e+='  <div class="flowerarea_modus_water_all link flowerarea_buttons" onclick="'+c+'" onmouseover="showDiv(\'flowerarea_button_tt_water_all\')" onmouseout="hideDiv(\'flowerarea_button_tt_water_all\')">';e+='    <div id="flowerarea_button_tt_water_all" class="ttbox flowerarea_button_tt">'+water_all_tttext+h+"</div>";e+="  </div>";e+='  <div class="flowerarea_modus_harvest_all link flowerarea_buttons" onclick="'+a+'" onmouseover="showDiv(\'flowerarea_button_tt_harvest_all\')" onmouseout="hideDiv(\'flowerarea_button_tt_harvest_all\')">';e+='    <div id="flowerarea_button_tt_harvest_all" class="ttbox flowerarea_button_tt">'+crop_all_tttext+h+"</div>";e+="  </div>";e+='  <div class="clear"></div>';e+="</div>";e+='  <div class="flowerarea_button_autoplant button_autoplant link" onclick="'+b+'" onmouseover="showDiv(\'flowerarea_button_autoplant_tt\')" onmouseout="hideDiv(\'flowerarea_button_autoplant_tt\')">';e+='    <div id="flowerarea_button_autoplant_tt" class="ttbox">'+autoplant_info+h+"</div>";e+="  </div>";e+='  <div class="flowerarea_button_speedup speedupgardenbutton link" onclick="dialogFlowerArea(\'speedup\')" onmouseover="showDiv(\'flowerarea_button_speedup_tt\')" onmouseout="hideDiv(\'flowerarea_button_speedup_tt\')">';e+='    <div id="flowerarea_button_speedup_tt" class="ttbox">'+gardenspeedup_head+"</div>";e+="  </div>";e+='  <div class="flowerarea_button_bonus link" onclick="dialogFlowerArea(\'changebonus\')" onmouseover="showDiv(\'flowerarea_button_bonus_tt\')" onmouseout="hideDiv(\'flowerarea_button_bonus_tt\')">';e+='    <div id="flowerarea_button_bonus_txt">'+t_flowerarea_growth_bonus+"</div>";e+='    <div id="flowerarea_button_bonus_img"></div>';e+='    <div id="flowerarea_button_bonus_tt" class="ttbox"></div>';e+="  </div>";e+='<div class="big_close link" onclick="closeFlowerArea()"></div>';$("farmersmarket_pos1_inner").innerHTML=e;showDiv("transp");showDiv("farmersmarket_pos1_inner");buildFlowerArea()}function buildFlowerArea(){var b=farmersmarket_data.flower_area;for(var a=1;a<=36;a++){if(b[a]){drawFlowerAreaTile(a)}else{$("flowerarea_tile"+a+"_pid").className="";hideDiv("flowerarea_tile"+a+"_water")}}}function timerFlowerArea(){var d=0;var b=0;var h={pid:0,remain:0,pos:0};var a=0;for(var l in farmersmarket_data.flower_area){if(farmersmarket_data.flower_area[l].pid){farmersmarket_data.flower_area[l].remain--;farmersmarket_data.flower_area[l].water_remain--;var e=farmersmarket_data.flower_area[l];if($("flowerarea_tile"+l)){if(e.remain<0){$("flowerarea_tile"+l+"_tt").innerHTML=produkt_name[e.pid]+"<br>"+statusProductionComplete}else{drawFlowerAreaTile(l);$("flowerarea_tile"+l+"_tt").innerHTML=produkt_name[e.pid]+"<br>"+formatTime(e.remain)}if(e.water_remain>0&&e.remain>0){showDiv("flowerarea_tile"+l+"_water")}else{hideDiv("flowerarea_tile"+l+"_water")}}if(e.remain<0){d++;a=e.pid}else{b++;if(!h.pid||h.remain>e.remain){h={pid:e.pid,remain:e.remain,pos:l}}}}}if(d>0){showFarmersmarketPosTimer(1,a,statusProductionComplete)}else{if(b>0){showFarmersmarketPosTimer(1,h.pid,formatTime(h.remain))}else{showFarmersmarketPosTimer(1,0)}}insertFarmChecker();if(farmersmarket_data.flower_bonus){farmersmarket_data.flower_bonus.remain--;if(farmersmarket_data.flower_bonus.remain<=0){if(flowerareaStopSpam==1){return 1}flowerareaStopSpam=1;farmAction("farmersmarket_update",1,1)}else{if($("flowerarea_button_bonus_img")){$("flowerarea_button_bonus_img").className="tt"+farmersmarket_data.flower_bonus.pid;var c=produkt_name[farmersmarket_data.flower_bonus.pid];c+="<div>"+formatTime(farmersmarket_data.flower_bonus.remain)+"</div>";c+='<div class="bonusinfo">'+str_replace("%PERCENT%",flowerarea_dailybonus_percent,t_flowerarea_growth_bonus_info)+"</div>";$("flowerarea_button_bonus_tt").innerHTML=c}if($("flowerarea_changebonus_dialog_inner")){$("flowerarea_changebonus_dialog_timer").innerHTML=formatTime(farmersmarket_data.flower_bonus.remain)}}}}function drawFlowerAreaTile(d){if($("flowerarea_tile"+d+"_pid")){var b=farmersmarket_data.flower_area[d];var a=Math.ceil((b.remain*100)/b.duration);var c="fl_0";if(a<=90){c="fl"+b.pid+"_2"}if(a<=20||a>100){c="fl"+b.pid+"_3"}$("flowerarea_tile"+d+"_pid").className="fl_blank "+c}}function checkFlowerAreaTile(b,a){if(a==1){if(farmersmarket_data.flower_area[b]){showDiv("flowerarea_tile"+b+"_tt");if(farmersmarket_data.flower_area[b].remain<0){$("flowerarea_tile"+b+"_status").addClassName("flowerarea_tile_status_harvest");$("flowerarea_tile"+b).onclick=new Function("cacheFlowerArea('harvest', "+b+","+farmersmarket_data.flower_area[b].pid+");")}else{if(farmersmarket_data.flower_area[b].water_remain<0){$("flowerarea_tile"+b+"_status").addClassName("flowerarea_tile_status_water");$("flowerarea_tile"+b).onclick=new Function("cacheFlowerArea('water', "+b+","+farmersmarket_data.flower_area[b].pid+");")}}}else{if(selected>0){if(produkt_category[selected]&&produkt_category[selected]==flowerarea_product_category&&!in_array(selected,flowerarea_dropitems)){if(checkRackItem(selected)>0&&flowerarea_modus=="plant"){$("flowerarea_tile"+b+"_status").addClassName("flowerarea_tile_status_plant");$("flowerarea_tile"+b).onclick=new Function("cacheFlowerArea('plant', "+b+", "+selected+");")}else{}}else{$("flowerarea_tile"+b+"_status").addClassName("flowerarea_tile_status_block")}}}}else{hideDiv("flowerarea_tile"+b+"_tt");$("flowerarea_tile"+b).onclick=new Function("");$("flowerarea_tile"+b+"_status").removeClassName("flowerarea_tile_status_harvest");$("flowerarea_tile"+b+"_status").removeClassName("flowerarea_tile_status_block");$("flowerarea_tile"+b+"_status").removeClassName("flowerarea_tile_status_plant");$("flowerarea_tile"+b+"_status").removeClassName("flowerarea_tile_status_water")}}function cacheFlowerArea(b,d,a){if(!flowerarea_cache[d]&&(b=="harvest"||b=="plant"||b=="water")){if(flowerarea_modus!=""&&flowerarea_modus!=b){fireFlowerAreaCache()}flowerarea_modus=b;$("flowerarea_tile"+d+"_status").addClassName("flowerarea_tile_wait");flowerarea_cache[d]=a;var c=checkRackItem(selected);if(b=="plant"&&c){c--;setRackItem(selected,c)}if(!flowerarea_cache_run){flowerarea_cache_run=setTimeout("fireFlowerAreaCache()",1000)}}}function fireFlowerAreaCache(){if(flowerarea_modus=="plant"){farmAction("flowerarea_plant",1,1)}else{if(flowerarea_modus=="harvest"){farmAction("flowerarea_harvest",1,1)}else{if(flowerarea_modus=="water"){farmAction("flowerarea_water",1,1)}}}clearTimeout(flowerarea_cache_run);flowerarea_cache_run=0;flowerarea_cache={}}function dialogFlowerArea(l,n){var b=0;if(l=="autoplant"){var m=autoplant_headline;var e="<div>"+autoplant_select+"</div><br>";var d=0;var s="";s+='<div id="flowerarea_autoplantselectbox">';for(var c=0;c<250;c++){if(produkt_category[c]==flowerarea_product_category&&checkRackItem(c)>0&&!in_array(c,flowerarea_dropitems)){if(!d){d=c}s+='<div class="link flowerarea_autoplant_item" onclick="flowerarea_autoplant_select='+c+"; dialogFlowerArea('autoplant')\">";s+='  <div class="kp'+c+'" style="float:left; margin-right:5px; width:15px;"></div>';s+='  <div style="float:left;">'+produkt_name[c]+"</div>";s+='  <div class="clear"></div>';s+="</div>"}}s+="</div>";if(!d){return false}if(!flowerarea_autoplant_select>0){flowerarea_autoplant_select=d}e+='<div style="position:relative; width:204px; margin:0 auto;">';e+='  <div class="link" onclick="autoplantControlFlowerArea()">';e+='    <div style="float:left; padding:2px; height:15px; text-align:left; width:185px; border-bottom:1px solid #000; background-color:#fff; color:#000;">';e+='      <div class="kp'+flowerarea_autoplant_select+'" style="float:left; margin-right:5px; width:15px;"></div>';e+='      <div style="float:left;">'+produkt_name[flowerarea_autoplant_select]+"</div>";e+='      <div class="clear"></div>';e+="    </div>";e+='    <div class="link" id="flowerarea_autoplantselector" style="background:url('+imgpath+'market/sel_open.gif); background-color:#000;"></div>';e+='    <div class="clear"></div>';e+="  </div>";e+=s;e+="</div>";var r="farmAction('flowerarea_autoplant', 1, 1);"}if(l=="speedup"){globalSpeedupBox("flowerarea",1,1);return false}if(l=="changebonus"){var m=t_flowerarea_growth_bonus_head;var q=str_replace("%COINS%",flowerarea_dailybonus_coins,t_flowerarea_growth_bonus_body);q=str_replace("%PERCENT%",flowerarea_dailybonus_percent,q);q=str_replace("%TIME%",formatTime(flowerarea_dailybonus_duration),q);var e="<div>"+q+"</div>";e+='<div id="flowerarea_changebonus_dialog_inner" style="position:relative; width:420px; height:215px; margin-top:10px;">';var h=0;for(var c=1;c<=250;c++){if(produkt_category[c]==flowerarea_product_category&&currentuserlevel>=produkt_level[c]&&!in_array(c,flowerarea_dropitems)&&c!=farmersmarket_data.flower_bonus.pid){var a="left";if(h>=3){a="right"}e+='<div class="link flowerarea_changebonus_item" onclick="flowerarea_changebonus_select='+c+"; dialogFlowerArea('changebonus')\" onmouseover=\"showDiv('flowerarea_changebonus_tt"+c+"')\" onmouseout=\"hideDiv('flowerarea_changebonus_tt"+c+"')\">";if(flowerarea_changebonus_select==c){e+='  <div class="flowerarea_changebonus_select"></div>'}e+='  <div class="flowerarea_changebonus_item_img tt'+c+'"></div>';e+='  <div id="flowerarea_changebonus_tt'+c+'" class="flowerarea_changebonus_tt_'+a+' ttbox">'+produkt_name[c]+"</div>";e+="</div>";h++;if(h==6){h=0}}}e+='  <div class="clear"></div>';e+="</div>";e+='<div style="background-color:#C3A75E; padding:5px; border-radius:5px;">';e+='  <div style="float:left; margin-right:5px;">'+t_flowerarea_growth_bonus_current+"</div>";e+='  <div class="kp'+farmersmarket_data.flower_bonus.pid+'" style="float:left; margin-right:5px;"></div>';e+='  <div style="float:left;">'+produkt_name[farmersmarket_data.flower_bonus.pid]+"</div>";e+='  <div style="float:right;" id="flowerarea_changebonus_dialog_timer">'+formatTime(farmersmarket_data.flower_bonus.remain)+"</div>";e+='  <div class="clear"></div>';e+="</div>";var r=0;if(flowerarea_changebonus_select>0){r="dialogFlowerArea('changebonus_commit')"}}if(l=="changebonus_commit"){var m=t_flowerarea_growth_bonus_head;var q=str_replace("%NAME%","<b>"+produkt_name[flowerarea_changebonus_select]+"</b>",t_flowerarea_growth_bonus_info2);q=str_replace("%PERCENT%",flowerarea_dailybonus_percent,q);var e='<div style="margin-bottom:10px;"><img src="'+imgpath+'menu/coins.gif" width="10" height="10">&nbsp;'+flowerarea_dailybonus_coins+"&nbsp;"+t_coins+"</div>";e+='<div class="flowerarea_changebonus_item">';e+='  <div style="position:absolute; top:7px; left:8px;" class="tt'+flowerarea_changebonus_select+'"></div>';e+="</div>";e+='<div style="float:left; width:150px; text-align:left; top:3px; position:relative;">'+q+"</div>";e+='<div class="clear"></div>';var r="farmAction('flowerarea_changebonus', 1, 1)"}if(n==1){$("globalbox_content").innerHTML=e;return false}globalcommitbox(m,e,r,b);if(l=="changebonus"){$("globalbox_content").addClassName("globalbox_content_big");$("globalbox").style.marginLeft="-265px"}if(l=="autoplant"){$("globalbox_content").style.overflow="visible"}}function autoplantControlFlowerArea(){if($("flowerarea_autoplantselectbox").style.display=="block"){hideDiv("flowerarea_autoplantselectbox");$("flowerarea_autoplantselector").style.backgroundImage="url("+imgpath+"market/sel_open.gif)"}else{showDiv("flowerarea_autoplantselectbox");$("flowerarea_autoplantselector").style.backgroundImage="url("+imgpath+"market/sel_close.gif)"}}function uniqueFoundFlowerArea(){var c=t_flowerarea_uniquefound;var a="";for(var b in flowerarea_unique_drops){a+='<div style="position:relative; margin:0 auto;" class="fl'+b+'"></div>';a+='<div style="position:relative; margin:0 auto;">'+flowerarea_unique_drops[b]+"x&nbsp;"+produkt_name[b]+"</div>"}globalBox(c,a,0,0,1);flowerarea_unique_drops={}}function closeFlowerArea(){hideDiv("transp");hideDiv("farmersmarket_pos1_inner")}function setFlowerSlots(){flowerslots_countpoints={};for(var b=1;b<=17;b++){var a="";if(farmersmarket_data.flower_slots.slots[b]){var c=farmersmarket_data.flower_slots.slots[b];flowerslots_countpoints[b]=c.nextpoints;$("farmersmarket_deco"+b+"_pid").addClassName("fla"+c.pid);$("farmersmarket_deco"+b+"_points").innerHTML="+"+c.points}else{$("farmersmarket_deco"+b+"_pid").className="";a="plantFlowerSlot("+b+")";$("farmersmarket_deco"+b).onmouseover=new Function("canPlantFlowerSlot("+b+")");$("farmersmarket_deco"+b).onmouseout=new Function("hideDiv('farmersmarket_deco"+b+"_plant_cursor'); hideDiv('farmersmarket_deco"+b+"_tt');")}$("farmersmarket_deco"+b).onclick=new Function(a)}setFlowerFarmiBar()}function timerFlowerSlots(){flowerslots_need_water=0;for(var m in farmersmarket_data.flower_slots.slots){farmersmarket_data.flower_slots.slots[m].remain--;farmersmarket_data.flower_slots.slots[m].waterremain--;var e=farmersmarket_data.flower_slots.slots[m];if($("farmersmarket_deco"+m+"_tt")){var a="";var l="";if(e.remain>0){if(e.waterremain>0){hideDiv("farmersmarket_deco"+m+"_water")}else{showDiv("farmersmarket_deco"+m+"_water")}if(parseInt(e.waterremain)<parseInt(e.remain)){$("farmersmarket_deco"+m).onclick=new Function("cacheFlowerSlots('water', "+m+", 1)");a+="showDiv('farmersmarket_deco"+m+"_water_cursor'); ";l+="hideDiv('farmersmarket_deco"+m+"_water_cursor'); "}else{a+="showDiv('farmersmarket_deco"+m+"_nowater_cursor'); ";l+="hideDiv('farmersmarket_deco"+m+"_nowater_cursor'); "}flowerslots_countpoints[m]++;if(parseInt(flowerslots_countpoints[m])%parseInt(flower_generatepoints_cycle)==0&&e.waterremain>0){animateFlowerSlot(m)}var d='<div style="font-weight:bold;">'+produkt_name[e.pid]+"</div>";d+="<div>"+t_fla_farmipoints+formatNumber((farmersmarket_data.nursery.products[e.pid].farmipoints*12))+"</div>";d+='<div style="margin-top:5px;">'+t_flowerslots_planttime+"</div>";d+="<div>";var b=(50/100);var h=((e.remain*100)/farmersmarket_data.nursery.products[e.pid].lifetime);var c=(h*b);d+='  <div style="float:left; top:2px; position:relative; width:50px; height:10px; background-color:#C18F74; border-radius:2px; overflow:hidden; margin-right:5px;">';d+='    <div style="position:absolute; top:0px; left:0px; width:'+c+'px; height:10px; background-color:#0f0;"></div>';d+="  </div>";d+='  <div style="float:left;">'+formatTime(e.remain)+"</div>";d+='  <div class="clear"></div>';d+="</div>";if(parseInt(e.waterremain)<parseInt(e.remain)){if(e.waterremain>0){d+="<div>"+t_flowerslots_watertime+"</div>";d+="<div>";var b=(50/100);var h=((e.waterremain*100)/farmersmarket_data.nursery.products[e.pid].watertime);var c=(h*b);d+='  <div style="float:left; top:2px; position:relative; width:50px; height:10px; background-color:#C18F74; border-radius:2px; overflow:hidden; margin-right:5px;">';d+='    <div style="position:absolute; top:0px; left:0px; width:'+c+'px; height:10px; background-color:#00f;"></div>';d+="  </div>";d+='  <div style="float:left;">'+formatTime(e.waterremain)+"</div>";d+='  <div class="clear">';d+="</div>"}else{flowerslots_need_water++}if(e.remain>e.waterremain){d+='<div class="bonusinfo">'+t_flowerslots_water_info+"</div>"}}if(parseInt(e.waterremain)>=parseInt(e.remain)){d+='<div class="bonusinfo">'+t_flowerslots_needsnowater+"</div>"}$("farmersmarket_deco"+m+"_tt").innerHTML=d;a+="showDiv('farmersmarket_deco"+m+"_tt')";l+="hideDiv('farmersmarket_deco"+m+"_tt')"}else{if(e.pid){$("farmersmarket_deco"+m+"_pid").addClassName("fla_wither");$("farmersmarket_deco"+m).onclick=new Function("removeFlowerSlot("+m+")");$("farmersmarket_deco"+m+"_tt").innerHTML='<div style="font-weight:bold;">'+produkt_name[e.pid]+"</div>"+t_flowerslots_withered+'<div class="bonusinfo">'+t_flowerslots_remove+"</div>";a+="showDiv('farmersmarket_deco"+m+"_tt'); showDiv('farmersmarket_deco"+m+"_remove_cursor');";l+="hideDiv('farmersmarket_deco"+m+"_tt'); hideDiv('farmersmarket_deco"+m+"_remove_cursor');";hideDiv("farmersmarket_deco"+m+"_water")}else{$("farmersmarket_deco"+m+"_pid").className="";a="canPlantFlowerSlot("+m+");";l="hideDiv('farmersmarket_deco"+m+"_plant_cursor'); hideDiv('farmersmarket_deco"+m+"_tt');";$("farmersmarket_deco"+m).onclick=new Function("plantFlowerSlot("+m+")");hideDiv("farmersmarket_deco"+m+"_water")}}$("farmersmarket_deco"+m).onmouseover=new Function(a);$("farmersmarket_deco"+m).onmouseout=new Function(l)}}}function canPlantFlowerSlot(a){if(a>0&&selected>0&&produkt_category[selected]==flowerslot_product_category&&!(farmersmarket_data.flower_slots&&farmersmarket_data.flower_slots[a])){showDiv("farmersmarket_deco"+a+"_plant_cursor")}else{$("farmersmarket_deco"+a+"_tt").innerHTML=t_flowerslot_empty_info;showDiv("farmersmarket_deco"+a+"_tt")}}function plantFlowerSlot(a){if(a>0&&selected>0&&produkt_category[selected]==flowerslot_product_category){if(!(farmersmarket_data.flower_slots&&farmersmarket_data.flower_slots[a])&&checkRackItem(selected)>0){cacheFlowerSlots("plant",a,selected)}}}function removeFlowerSlot(a){if(a>0&&farmersmarket_data.flower_slots&&farmersmarket_data.flower_slots.slots[a]&&farmersmarket_data.flower_slots.slots[a].remain<0){cacheFlowerSlots("remove",a,1)}}function animateFlowerSlot(a){$("farmersmarket_deco"+a+"_points").style.opacity=1;showDiv("farmersmarket_deco"+a+"_points");Effect.Puff("farmersmarket_deco"+a+"_points",{duration:2,afterFinish:function(c){var b=farmersmarket_data.flower_slots.slots[a];farmersmarket_data.flower_slots.points=(parseInt(farmersmarket_data.flower_slots.points)+parseInt(b.points));setFlowerFarmiBar();if(parseInt(farmersmarket_data.flower_slots.points)>=parseInt(flowerfarmis_createlimit)){if(!flowerslots_ready_cache){setTimeout("fireFlowerSlotsReadyCache()",2500)}flowerslots_ready_cache++}}});flowerslots_countpoints[a]=0}function setFlowerFarmiBar(){var a=(233/100);var b=(farmersmarket_data.flower_slots.points*100/flowerfarmis_createlimit);if(b>100){b=100}$("farmersmarket_deco_bar_inner").style.width=Math.ceil(b*a)+"px";$("farmersmarket_deco_points").innerHTML=formatNumber(farmersmarket_data.flower_slots.points)+"/"+formatNumber(flowerfarmis_createlimit)}function fireFlowerSlotsReadyCache(){farmAction("createflowerfarmi",1,1);flowerslots_ready_cache=0}function cacheFlowerSlots(d,l,c){if(!flowerslots_cache[l]&&(d=="plant"||d=="water"||d=="remove")){var e=0;for(var a in flowerslots_cache){e++}if(e>0&&flowerslots_modus!=""&&flowerslots_modus!=d){fireFlowerSlotsCache()}flowerslots_modus=d;if($("farmersmarket_deco"+l+"_status")){$("farmersmarket_deco"+l+"_status").addClassName("flowerslots_wait")}flowerslots_cache[l]=c;var h=checkRackItem(selected);if(d=="plant"&&h){h--;setRackItem(selected,h)}if(!flowerslots_cache_run){flowerslots_cache_run=setTimeout("fireFlowerSlotsCache()",1000)}}}function fireFlowerSlotsCache(){if(flowerslots_modus=="plant"){farmAction("flowerslot_plant",1,1)}else{if(flowerslots_modus=="water"){farmAction("flowerslot_water",1,1)}else{if(flowerslots_modus=="remove"){farmAction("flowerslot_remove",1,1)}}}clearTimeout(flowerslots_cache_run);flowerslots_cache_run=0;flowerslots_cache={}}var flowerfarmi_ignore=[];function handleFlowerFarmi(b,a){farmAction("handleflowerfarmi",1,1,b,a)}function setFlowerFarmis(h,n,c){if(h>-1){if($("flowerfarmi"+h)){var b=$("flowerfarmi"+h).className;var m=b.indexOf("_idle");var e=b.substring((m-1),m);flowerfarmi_ignore.push(h);if(c==1){$("flowerfarmi"+h+"_emotion").addClassName("farmi_sun")}else{$("flowerfarmi"+h+"_emotion").addClassName("farmi_cloud")}showDiv("flowerfarmi"+h+"_emotion");$("flowerfarmi"+h).addClassName("flowerfarmi_go_top").removeClassName("flowerfarmi"+e+"_walkleft").addClassName("flowerfarmi"+e+"_walkdown");window.setTimeout(function(q){$("flowerfarmi"+h).removeClassName("flowerfarmi_go_top").removeClassName("flowerfarmi"+e+"_walkdown").addClassName("flowerfarmi_go_left").addClassName("flowerfarmi"+e+"_walkleft")},1000);window.setTimeout(function(q){$("flowerfarmi"+h).removeClassName("flowerfarmi_go_left").removeClassName("flowerfarmi"+e+"_walkleft").addClassName("flowerfarmi_go_away").addClassName("flowerfarmi"+e+"_walkdown")},3000)}for(var d=0;d<farmersmarket_data.farmis.length;d++){var a=farmersmarket_data.farmis[d];if(a.id>h&&!in_array(a.id,flowerfarmi_ignore)){var b=$("flowerfarmi"+a.id).className;var l=b.indexOf("flowerfarmis_pos");var m=b.substring((l+16),(l+18));if(a.id>h){$("flowerfarmi"+a.id).className="link flowerfarmis_item flowerfarmi"+a.img+"_walkleft flowerfarmis_pos"+(parseInt(m)-1)}window.setTimeout(function(q){correctFlowerFarmi()},1000)}}}}function correctFlowerFarmi(){for(var a=0;a<farmersmarket_data.farmis.length;a++){var c=farmersmarket_data.farmis[a];var b=$("flowerfarmi"+c.id).className;if(b.indexOf("_walkleft")>-1){$("flowerfarmi"+c.id).removeClassName("flowerfarmi"+c.img+"_walkleft").addClassName("flowerfarmi"+c.img+"_idle")}}}function setFlowerFarmiBubble(a){for(var c=0;c<farmersmarket_data.farmis.length;c++){if(farmersmarket_data.farmis[c].id==a){var d="";for(var b=0;b<farmersmarket_data.farmis[c].cart.length;b++){var h=farmersmarket_data.farmis[c].cart[b].pid;var e=farmersmarket_data.farmis[c].cart[b].amount;if(checkRackItem(h)>=e){var n=""}else{var n="important"}d+='<div style="margin-bottom:2px;">';d+='  <div class="kp'+h+'" style="float:left; margin-right:5px; width:15px;"></div>';d+='  <div style="float:left; width:130px;" class="'+n+'">'+e+"x&nbsp;"+produkt_name[h]+"</div>";d+='  <div class="clear"></div>';d+="</div>"}d+='<div style="font-weight:bold; border-top:1px solid #000; padding-top:5px; margin-top:5px;">'+formatNumber(farmersmarket_data.farmis[c].points)+"&nbsp;"+t_points+"</div>";var l=farmersmarket_data.farmis[c].price;var q="";if(specialbonus){var m=specialbonus.findBonus({key1:"consumer",key2:"money"});if(m&&in_array("flowers",m.types)){q='<div style="font-size:11px; color:green;">('+t_specialbonus_farmis_money_info.replace("%BONUS%",(m.money*100))+")</div>";l=Math.ceil(l*(1+m.money))}}d+='<div style="font-weight:bold; margin-top:4px;">'+formatPrice(l)+"</div>";if(q!=""){d+=q}$("flowerfarmi_bubble"+farmersmarket_data.farmis[c].id).innerHTML=d;showDiv("flowerfarmi"+farmersmarket_data.farmis[c].id+"_tt")}}}function flowersGardener(){var b="";b+='<div id="flowers_gardener_head" class="headline">'+t_gardener+"</div>";b+='<div id="flowers_gardener_body">';if(farmersmarket_data.flower_gardener>0){b+=t_gardener_stillrunning+'<div id="flowers_gardener_box_time"></div>'}else{b+=t_gardener_waiting;for(var a in farmersmarket_data.flower_gardener_prices){var c=str_replace("%DAYS%",farmersmarket_data.flower_gardener_prices[a],t_gardener_price);c=str_replace("%COINS%",a,c);b+='<br><button style="font-size:12px; padding:5px; margin-top:10px;" type="button" class="button_new link" onclick="flowersGardenerCommit('+a+')">'+c+"</button>"}}b+="</div>";b+="<div class=\"link mini_close\" onclick=\"hideDiv('transp'); hideDiv('flowers_gardener_box');\"></div>";$("flowers_gardener_box").innerHTML=b;showDiv("transp");showDiv("flowers_gardener_box")}function flowersGardenerCommit(c){var a=str_replace("%COINS%",c,t_gardener_price_commit);a=str_replace("%DAYS%",farmersmarket_data.flower_gardener_prices[c],a);var b="farmAction('buyflowergardener', 1, 1, "+c+")";globalBox(t_gardener,a,b)}function timerFlowerGardener(){farmersmarket_data.flower_gardener--;if(farmersmarket_data.flower_gardener>0){if($("flowers_gardener_box_time")){$("flowers_gardener_box_time").innerHTML=formatTime(farmersmarket_data.flower_gardener)}$("flowers_gardener").removeClassName("flowers_gardener_idle");$("flowers_gardener").addClassName("flowers_gardener_active")}else{$("flowers_gardener").removeClassName("flowers_gardener_active");$("flowers_gardener").addClassName("flowers_gardener_idle")}}function initNursery(){html="";for(var a=1;a<=3;a++){html+='<div id="nursery_slot_item'+a+'" class="link nursery_slot_item">';html+='  <div id="nursery_slot_item_img'+a+'" class="nursery_slot_item_img"></div>';html+='  <div class="nursery_slot_item_info">';html+='    <div class="nursery_slot_item_info_name" id="nursery_slot_item_info_name'+a+'"></div>';html+='    <div id="nursery_slot_item_info_time'+a+'"></div>';html+="  </div>";html+='  <div id="nursery_button_speedup'+a+'" class="nursery_button_speedup speedupgardenbutton link" onclick="dialogNursery(\'speedup\', '+a+')" onmouseover="showDiv(\'nursery_button_speedup'+a+"_tt')\" onmouseout=\"hideDiv('nursery_button_speedup"+a+"_tt')\">";html+='    <div id="nursery_button_speedup'+a+'_tt" class="ttbox nursery_button_speedup_tt">'+building_speeduptext+"</div>";html+="  </div>";html+='  <div id="nursery_slot_item_status'+a+'" class="nursery_slot_item_status"></div>';if(a>1){html+='<div id="nursery_slot_block'+a+'" class="nursery_slot_block"></div>'}if(a==3){html+='<div id="nursery_slot_remain" class="nursery_slot_remain">';html+='  <div id="nursery_slot_remain_time"></div>';html+="</div>"}html+="</div>"}html+='<div class="big_close link" onclick="closeNursery()"></div>';html+='<div id="nursery_production_box_transp" class="transp"></div>';html+='<div id="nursery_production_box">';html+='  <div class="globalbox_scale globalbox_scale_t">';html+='    <div class="globalbox_scale globalbox_scale_l">';html+='      <div class="globalbox_scale globalbox_scale_r">';html+='        <div class="globalbox_scale globalbox_scale_b">';html+='          <div id="nursery_production_box_inner"></div>';html+="        </div>";html+="      </div>";html+="    </div>";html+="  </div>";html+='  <div class="globalbox_edge globalbox_edge_tl"></div>';html+='  <div class="globalbox_edge globalbox_edge_tr"></div>';html+='  <div class="globalbox_edge globalbox_edge_bl"></div>';html+='  <div class="globalbox_edge globalbox_edge_br"></div>';html+="  <div class=\"mini_close link\" onclick=\"hideDiv('nursery_production_box'); hideDiv('nursery_production_box_transp')\"></div>";html+="</div>";$("farmersmarket_pos2_inner").innerHTML=html;showDiv("transp");showDiv("farmersmarket_pos2_inner")}function timerNursery(){if(farmersmarket_data.nursery){var q=0;var l=0;var r={pid:0,remain:0};var b=0;for(var h=1;h<=3;h++){if($("nursery_slot_item"+h)){$("nursery_slot_item_status"+h).innerHTML="";$("nursery_slot_item_img"+h).innerHTML="";hideDiv("nursery_button_speedup"+h);hideDiv("nursery_slot_block"+h);var u="dialogNursery('production', "+h+")";var c=t_start_production}if(farmersmarket_data.nursery.slots&&farmersmarket_data.nursery.slots[h]){if(farmersmarket_data.nursery.slots[h].pid){var t="";if(produkt_ernte_bonus[farmersmarket_data.nursery.slots[h].pid]){t='&nbsp;<span class="rack_cropbonus">+'+(produkt_ernte_bonus[farmersmarket_data.nursery.slots[h].pid])+"</span>"}var a=croptext+farmersmarket_data.nursery.products[farmersmarket_data.nursery.slots[h].pid].crop+t+"<br>";farmersmarket_data.nursery.slots[h].remain--;var w=farmersmarket_data.nursery.slots[h];c=t_get_products;u="farmAction('nursery_harvest', 1, 1, "+h+")";if(w.remain>0){if($("nursery_button_speedup"+h)){showDiv("nursery_button_speedup"+h)}a+=formatTime(w.remain);u="";c="";l++;if(!r.pid||r.remain>w.remain){r={pid:w.pid,remain:w.remain}}}else{a+=statusProductionComplete;q++;b=w.pid}if($("nursery_slot_item"+h)){$("nursery_slot_item_info_name"+h).innerHTML=produkt_name[w.pid];$("nursery_slot_item_info_time"+h).innerHTML=a;var e='<div class="flab'+w.pid+'"></div>';$("nursery_slot_item_img"+h).innerHTML=e}}if(h==3){farmersmarket_data.nursery.slots[h].slotremain--;if(farmersmarket_data.nursery.slots[h].slotremain>0){if($("nursery_slot_remain")){showDiv("nursery_slot_remain")}if($("nursery_slot_remain_time")){$("nursery_slot_remain_time").innerHTML=formatTime(farmersmarket_data.nursery.slots[h].slotremain)}}else{if($("nursery_slot_remain")){hideDiv("nursery_slot_remain")}farmersmarket_data.nursery.slots[h]["block"]=1}}if(farmersmarket_data.nursery.slots[h].block){u="dialogNursery('buy', "+h+")";if(farmersmarket_data.nursery.slots[h].coins){var v=farmersmarket_data.nursery.slots[h].coins;var m="";var t="";if(specialbonus){var n=specialbonus.findBonus({key1:"flowers",key2:"rentslot"});if(n&&n.rentslot){v=(v*(1-n.rentslot));m="color:green; font-weight:bold;";t=specialbonus.htmlBonusLine(n.rentslot,1)}}var d=str_replace("%COINS%",'<span style="'+m+'">'+v+"&nbsp"+t_coins+"</span>",t_rent_slot);if(t!=""){d+=t}c=str_replace("%TIME%",formatTime(farmersmarket_data.nursery.slots[h].duration),d);if(specialbonus){var n=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(n&&in_array("nursery",n.types)){c+='<div id="nursery_productionslot'+h+'_bonus_star" class="nursery production_slot bonus_star pulse">';c+='  <div class="inner">';c+='    <div class="percent">'+(n.discount*100)+"%</div>";c+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";c+="  </div>";c+="</div>"}}}else{if(farmersmarket_data.nursery.slots[h].cost){c=str_replace("%MONEY%",formatPrice(farmersmarket_data.nursery.slots[h].cost),t_buy_slot)}}if($("nursery_slot_block"+h)){showDiv("nursery_slot_block"+h)}}}if($("nursery_slot_item_status"+h)){$("nursery_slot_item_status"+h).innerHTML=c}if($("nursery_slot_item"+h)){$("nursery_slot_item"+h).onclick=new Function(u)}}if(q>0){showDiv("farmersmarket_pos2_progress");$("farmersmarket_pos2_progress").removeClassName("farmersmarket_pos_progress_active");$("farmersmarket_pos2_progress").addClassName("farmersmarket_pos_progress_ready");showFarmersmarketPosTimer(2,b,statusProductionComplete)}else{if(l>0){showDiv("farmersmarket_pos2_progress");$("farmersmarket_pos2_progress").addClassName("farmersmarket_pos_progress_active");$("farmersmarket_pos2_progress").removeClassName("farmersmarket_pos_progress_ready");showFarmersmarketPosTimer(2,r.pid,formatTime(r.remain))}else{hideDiv("farmersmarket_pos2_progress");showFarmersmarketPosTimer(2,0)}}}insertFarmChecker()}function dialogNursery(u,c,z,l){var H=0;if(u=="buy"){var v=farmersmarket_data.nursery.slots[c];var n="";if(v.coins){var r="";var w="";if(specialbonus){var L=specialbonus.findBonus({key1:"flowers",key2:"rentslot"});if(L&&L.rentslot){v.coins=(v.coins*(1-L.rentslot));r="color:green; font-weight:bold;";w=specialbonus.htmlBonusLine(L.rentslot,1)}}var h="";var t=str_replace("%COINS%",'<span class="'+r+'">'+v.coins+"&nbsp;"+t_coins+"</span>",foodworld_rentslot_body);n+=str_replace("%TIME%",formatTime(v.duration),t);if(w!=""){n+=w}}if(v.cost){var h="";n+=str_replace("%MONEY%",formatPrice(v.cost),foodworld_buyslot_body)}var K="farmAction('nursery_buyslot', 1, 1, "+c+")"}if(u=="production"){var q="";q+='<div style="position:relative; width:100%; height:480px;">';q+='  <div class="headline">'+t_nursery_production_start_head+"</div>";q+='  <div style="margin-bottom:10px;">'+t_nursery_production_start+"</div>";var m=1;var G=8;if(!l){l=1}var E=0;if(l>1){E=((l-1)*G)}var b=(l*G);for(var F in farmersmarket_data.nursery.products){if(m>E&&m<=b){var A=farmersmarket_data.nursery.products[F];var B="left";var C="dialogNursery('production_commit', "+c+", "+F+");";var a='<div style="font-weight:bold; margin-bottom:5px;">'+produkt_name[F]+"</div>";if(A.cost){a+='<div style="margin-bottom:10px;">'+cityadcost+formatPrice(A.cost)+"</div>"}if(A.coins){a+='<div style="margin-bottom:10px;">'+cityadcost+A.coins+"&nbsp;"+t_coins+"</div>"}var J=0;for(var D in A.products){if(checkRackItem(D)>=A.products[D]){var e=""}else{J++;var e="important"}a+='<div style="margin-bottom:2px;">';a+='  <div style="float:left; width:15px; margin-right:5px;" class="kp'+D+'"></div>';a+='  <div class="'+e+'" style="float:left;">'+A.products[D]+"x "+produkt_name[D]+"</div>";a+='  <div class="clear"></div>';a+="</div>"}a+='<div style="margin-top:10px; margin-bottom:2px;">'+t_production_time+"&nbsp;"+formatTime(A.duration)+"</div>";a+="<div>"+croptext+A.crop+"</div>";if(J>0){C=""}e="";if(J>0||A.block==1){e="important"}var e="";if(A.block==1){e="nursery_production_select_item_block"}var I="";I+='<div class="nursery_production_select_item link '+e+'" onclick="'+C+'" onmouseover="showDiv(\'nursery_production_select_tt'+F+"')\" onmouseout=\"hideDiv('nursery_production_select_tt"+F+"')\">";I+='  <div class="nursery_production_select_img fla'+F+'"></div>';I+='  <div style="float:left; width:190px;">';I+='    <div class="'+e+'" style="font-weight:bold; margin-bottom:2px;">'+produkt_name[F]+"</div>";if(A.block==1){I+='<div class="important">'+str_replace("%LEVEL%",A.level,t_nursery_needlevel)+"</div>"}else{I+='    <div style="margin-bottom:2px;">'+t_fla_lifetime+formatTime(A.lifetime)+"</div>";var d=t_none;if(A.watertime>0){d=formatTime(A.watertime)}I+='    <div style="margin-bottom:2px;">'+t_fla_watertime+d+"</div>";I+='    <div style="margin-bottom:2px;">'+t_fla_farmipoints+(A.farmipoints*12)+"</div>"}I+="  </div>";I+='  <div class="clear"></div>';I+='  <div id="nursery_production_select_tt'+F+'" class="nursery_production_select_tt nursery_production_select_tt_'+B+' ttbox">'+a+"</div>";I+="</div>";q+=I}m++}q+='  <div class="clear"></div>';q+='  <div id="nursery_production_navi">';if((l-1)>0){q+='<div class="link nursery_production_navi_prev" style="position:absolute; left:200px;" onclick="dialogNursery(\'production\', '+c+", 0, "+(l-1)+')"></div>'}q+='<div style="position:absolute; left:252px; font-size:12px; font-weight:bold; top:8px;">'+l+"/"+Math.ceil(m/G)+"</div>";if((l+1)<=Math.ceil(m/G)){q+='<div class="link nursery_production_navi_next" style="position:absolute; right:205px;" onclick="dialogNursery(\'production\', '+c+", 0, "+(l+1)+')"></div>'}q+="  </div>";q+="</div>";$("nursery_production_box_inner").innerHTML=q;showDiv("nursery_production_box_transp");showDiv("nursery_production_box");return false}if(u=="production_commit"){var A=farmersmarket_data.nursery.products[z];var h=t_nursery_production_start_head;var n="";n+='<div style="font-weight:bold; margin-bottom:5px;">'+produkt_name[z]+"</div>";n+='<div style="left:70px;" class="nursery_production_select">';n+='  <div class="nursery_production_select_img tt'+z+'"></div>';n+="</div>";n+='<div class="clear"></div>';var t=t_nursery_production_start_commit;if(A.cost){t=str_replace("%COST%",formatPrice(A.cost),t)}if(A.coins){t=str_replace("%COST%",A.coins+"&nbsp;"+t_coins,t)}n+="<div>"+t+"</div>";var K="farmAction('nursery_startproduction', 1, 1, "+z+", "+c+");"}if(u=="speedup"){globalSpeedupBox("nursery",1,c);return false}globalcommitbox(h,n,K,H);if(u=="production"){$("globalbox_content").addClassName("globalbox_content_big")}}function closeNursery(){hideDiv("transp");hideDiv("farmersmarket_pos2_inner")}function initMegaFruit(){var h="";h+=htmlLevelBar("megafruit");h+=htmlCountBar("megafruit");h+='<div id="megafruit_incubator">';h+='  <img id="megafruit_incubator_fruit" border="0">';h+="</div>";h+='<div id="megafruit_select">';var m=3;if(const_megafruit_addon==1){m=5}for(var d=0;d<farmersmarket_data.megafruit.fruits.length;d++){var e=t_megafruit_fruit_useable;var n="";if(farmersmarket_data.megafruit.fruits[d].locked){e=str_replace("%LEVEL%",farmersmarket_data.megafruit.fruits[d].level,t_megafruit_fruit_locked);n="important"}var l='<div style="font-weight:bold;" class="'+n+'">'+str_replace("%PRODUCT%",produkt_name[farmersmarket_data.megafruit.fruits[d].pid],t_megafruit_start_head)+"</div>";l+='<div class="bonusinfo">'+e+"</div>";var r="dialogMegaFruit('start', "+d+")";if(farmersmarket_data.megafruit.fruits[d].locked){r=""}n="";if(d>0&&(d+1)%m==0){n+="right"}h+='<div id="megafruit_select_item'+d+'" class="link megafruit_select_item '+n+'" onclick="'+r+'" onmouseover="showDiv(\'megafruit_select_item_tt'+d+"')\" onmouseout=\"hideDiv('megafruit_select_item_tt"+d+"')\">";h+='  <img src="'+imgpath+"monsterfruit_"+farmersmarket_data.megafruit.fruits[d].pid+'.png" style="position:absolute; width:115px; top:11px; left:-7px;">';var n="megafruit_select_item_tt";if(d>=(m*2)){n="megafruit_select_item_tt2"}h+='  <div id="megafruit_select_item_tt'+d+'" class="'+n+' ttbox">'+l+"</div>";if(farmersmarket_data.megafruit.fruits[d].locked){h+='<div class="megafruit_select_lock"></div>'}h+="</div>";if((d+1)%m==0&&d>0){h+='<div class="clear"></div>'}}h+="</div>";h+='<div id="megafruit_timer">';h+='  <div id="megafruit_timer_inner"></div>';h+='  <div id="megafruit_timer_count"></div>';h+="</div>";h+='<div id="megafruit_info_board"></div>';h+='<div id="megafruit_harvest_button" class="link" onclick="farmAction(\'megafruit_harvest\', 1, 1)" onmouseover="showDiv(\'megafruit_harvest_button_tt\')" onmouseout="hideDiv(\'megafruit_harvest_button_tt\')">';h+='  <div id="megafruit_harvest_button_tt" class="ttbox">'+t_megafruit_harvest+"</div>";h+="</div>";h+='<div id="megafruit_need_transp" class="transp link" onclick="showNeedsMegaFruit(0)"></div>';h+='<div id="megafruit_needs">';h+='  <div class="link megafruit_need" onmouseover="showDiv(\'megafruit_need_water_tt\')" onmouseout="hideDiv(\'megafruit_need_water_tt\')">';h+='    <div id="megafruit_need_water"></div>';h+='    <div id="megafruit_need_water_tt" class="ttbox megafruit_need_tt">'+t_megafruit_need_water+'<span id="megafruit_need_water_timer"></span></div>';h+="  </div>";h+='  <div class="link megafruit_need" onmouseover="showDiv(\'megafruit_need_light_tt\')" onmouseout="hideDiv(\'megafruit_need_light_tt\')">';h+='    <div id="megafruit_need_light"></div>';h+='    <div id="megafruit_need_light_tt" class="ttbox megafruit_need_tt">'+t_megafruit_need_light+'<span id="megafruit_need_light_timer"></span></div>';h+="  </div>";h+='  <div class="link megafruit_need" onmouseover="showDiv(\'megafruit_need_fertilize_tt\')" onmouseout="hideDiv(\'megafruit_need_fertilize_tt\')">';h+='    <div id="megafruit_need_fertilize"></div>';h+='    <div id="megafruit_need_fertilize_tt" class="ttbox megafruit_need_tt">'+t_megafruit_need_fertilize+'<span id="megafruit_need_fertilize_timer"></span></div>';h+="  </div>";h+="</div>";h+='<div class="mini_close link" onclick="closeMegaFruit()"></div>';h+='<div class="link" id="megafruit_stats_button" onclick="openStatsMegaFruit()" onmouseover="showDiv(\'megafruit_stats_button_tt\')" onmouseout="hideDiv(\'megafruit_stats_button_tt\')">';h+='  <div id="megafruit_stats_button_tt" class="ttbox">'+t_megafruit_stats_button+"</div>";h+="</div>";h+='<div id="megafruit_stats_transp" class="transp"></div>';h+='<div id="megafruit_stats"></div>';h+='<div class="help_button link" style="z-index:30; position:absolute; top:5px; left:5px; background:url('+imgpath+'kaeserei_info.png); width:25px; height:25px;" onclick="openFarmersMarketHowTo(\'megafruit\', 1);"></div>';if(farmersmarket_data.megafruit.stock){h+='<div id="megafruit_stock" class="link" onclick="dialogMegaFruit(\'stock\')" onmouseover="showDiv(\'megafruit_stock_tt\')" onmouseout="hideDiv(\'megafruit_stock_tt\')">';h+='  <img src="'+imgpath+'monsterfruit_26.png" style="height:25px;">';h+='  <div id="megafruit_stock_tt" class="ttbox">'+t_foodcontest_stock_button+"</div>";h+="</div>"}$("farmersmarket_pos3_inner").innerHTML=h;if(farmersmarket_data.megafruit.count>0){$("megafruit_levelbar_plus_tt").innerHTML=t_megafruit_level_tt;showDiv("megafruit_levelbar_plus");$("megafruit_levelbar_plus").onclick=new Function("dialogMegaFruit('level')")}else{hideDiv("megafruit_levelbar_plus")}$("megafruit_levelbar_inner").style.width=farmersmarket_data.megafruit.percent+"%";$("megafruit_levelbar_number").innerHTML=farmersmarket_data.megafruit.level;$("megafruit_levelbar_tt").innerHTML=str_replace("%AMOUNT%",farmersmarket_data.megafruit.pointsleft,t_megafruit_level_line);$("megafruit_countbar").onclick=new Function("dialogMegaFruit('buy')");$("megafruit_countbar_inner").innerHTML='<div class="megafruit_seed" style="float:left; margin-right:5px; margin-top:-3px;"></div><div style="float:left;">'+farmersmarket_data.megafruit.count+"</div>";$("megafruit_countbar_plus_tt").innerHTML=t_megafruit_buy_head;if(farmersmarket_data.megafruit.current){$("megafruit_incubator_fruit").src=imgpath+"monsterfruit_"+farmersmarket_data.megafruit.current.pid+".png";if(farmersmarket_data.megafruit.current.percent<5){farmersmarket_data.megafruit.current.percent=5}var a=(farmersmarket_data.megafruit.current.percent);$("megafruit_incubator_fruit").style.width=a+"%";$("megafruit_incubator_fruit").style.marginLeft=-(((470/100)*a)/2)+"px";$("farmersmarket_pos3_inner").className="megafruit_inner_back_current"}else{$("farmersmarket_pos3_inner").className="megafruit_inner_back"}var b=["water","light","fertilize"];for(var d=0;d<b.length;d++){if(farmersmarket_data.megafruit.objects[b[d]]){var q=farmersmarket_data.megafruit.objects[b[d]];var h='<div id="megafruit_need_'+b[d]+'_img" class="megafruit_need_img megafruit_need_'+b[d]+'" onclick="showNeedsMegaFruit(\'megafruit_need_item_bar_'+b[d]+"');\"></div>";h+='<div id="megafruit_need_item_bar_'+b[d]+'" class="megafruit_need_item_bar">';for(var c=0;c<q.length;c++){h+='<div id="megafruit_need_item'+q[c]["oid"]+'" class="megafruit_need_item megafruit_need_item'+q[c]["oid"]+'" onmouseover="showDiv(\'megafruit_need_item'+q[c]["oid"]+"_tt')\" onmouseout=\"hideDiv('megafruit_need_item"+q[c]["oid"]+"_tt')\">";var n="megafruit_need_item_tt";if(in_array(c,[4,5,6,11])){n="megafruit_need_item_tt2"}h+='  <div id="megafruit_need_item'+q[c]["oid"]+'_tt" class="'+n+' ttbox"></div>';if(q[c]["locked"]){h+='<div class="megafruit_object_lock"></div>'}else{if(q[c]["buyable"]){h+='<div class="megafruit_object_lock2"></div>'}}h+="</div>"}h+='  <div class="clear"></div>';h+="</div>";h+='<div id="megafruit_need_'+b[d]+'_timer_box" class="link megafruit_need_timer">';h+='  <div id="megafruit_need_'+b[d]+'_timer_inner"></div>';h+="</div>";$("megafruit_need_"+b[d]).innerHTML=h}}setObjectsMegaFruit();if(farmersmarket_data.megafruit.levelend){hideDiv("megafruit_levelbar_updatelevel");hideDiv("megafruit_levelbar_plus");$("megafruit_levelbar").onmouseover=new Function("");$("megafruit_levelbar").onmouseout=new Function("")}hideDiv("megafruit_timer");hideDiv("megafruit_harvest_button");hideDiv("megafruit_info_board");showDiv("transp");showDiv("farmersmarket_pos3_inner");if(farmersmarket_data.megafruit.firstvisit==1){openFarmersMarketHowTo("megafruit",1)}}function showNeedsMegaFruit(d){if($(d)){if($(d).style.display=="block"){$(d).style.display="none";var c=0;var b=["water","light","fertilize"];for(var a=0;a<b.length;a++){if($("megafruit_need_item_bar_"+b[a]).style.display=="block"){c++}}if(!c){$("megafruit_need_transp").style.display="none"}}else{var b=["water","light","fertilize"];for(var a=0;a<b.length;a++){hideDiv("megafruit_need_item_bar_"+b[a])}$(d).style.display="block";$("megafruit_need_transp").style.display="block"}}else{var b=["water","light","fertilize"];for(var a=0;a<b.length;a++){hideDiv("megafruit_need_item_bar_"+b[a])}$("megafruit_need_transp").style.display="none"}}function setObjectsMegaFruit(){var e=0;if(farmersmarket_data.megafruit.current){e=1}var a=["water","light","fertilize"];for(var c=0;c<a.length;c++){if(farmersmarket_data.megafruit.objects[a[c]]){var s=farmersmarket_data.megafruit.objects[a[c]];for(var b=0;b<s.length;b++){var t="dialogMegaFruit('need', "+s[b]["oid"]+")";if(s[b]["buyable"]){t="dialogMegaFruit('unlock', "+s[b]["oid"]+")"}$("megafruit_need_item"+s[b]["oid"]).onclick=new Function(t);var d=t_megafruit_object_useable;if(!e||(farmersmarket_data.megafruit.current&&farmersmarket_data.megafruit.current.remain<=0)){d=str_replace("%OBJECT%",s[b].name,t_megafruit_object_idle)}if(e&&(farmersmarket_data.megafruit.current&&farmersmarket_data.megafruit.current.data[a[c]]&&farmersmarket_data.megafruit.current.data[a[c]].remain>0)){d=str_replace("%OBJECT%",s[b].name,t_megafruit_object_idle2)}if(s[b]["buyable"]){if(s[b]["unlock"]>farmersmarket_data.megafruit.count){d='<div class="important" style="margin-bottom:10px;">'+str_replace("%AMOUNT%",s[b]["unlock"],t_megafruit_unlock_body)+"</div>"}else{d=""}d+=str_replace("%COUNT%",s[b]["unlock"],t_megafruit_object_buyable)}if(s[b]["locked"]){d='<div class="important">'+str_replace("%LEVEL%",s[b]["level"],t_megafruit_object_locked)+"</div><br>"+str_replace("%COST%",s[b]["unlock"],t_megafruit_unlock_cost)}var l="";l+='<div style="font-weight:bold;">'+s[b]["name"]+"</div>";l+="<div>"+str_replace("%TIME%",formatTime(s[b]["duration"]),t_megafruit_object_duration)+"</div>";var r="";var q=s[b]["points"];var h="";if(specialbonus){var m=specialbonus.findBonus({key1:"megafruit",key2:"points"});if(m){q=Math.ceil(q*(1+m.points));h="color:green; font-weight:bold;";r='<br><span style="'+h+'">'+t_specialbonus_megafruit_points_info+"</span>"}}l+="<div>"+str_replace("%AMOUNT%",'<span style="'+h+'">'+formatNumber(q)+"</span>",t_megafruit_object_points)+r+"</div>";if(s[b]["coins"]){var u=s[b]["coins"];var r="";var n="";var m=specialbonus.findBonus({key1:"megafruit",key2:"buyobject"});if(+u>1&&m){r=specialbonus.htmlBonusLine(m.buyobject,1);n="specialbonus_bonus_value";u=Math.ceil(u*(1-m.buyobject))}l+='<div><span class="'+n+'">'+cityadcost+u+"</span>&nbsp;"+t_coins+"</div>";if(r!=""){l+=r}}if(s[b]["money"]){l+="<div>"+cityadcost+formatPrice(s[b]["money"])+"</div>"}if(s[b]["fruits"]){l+="<div>"+cityadcost+s[b]["fruits"]+"&nbsp;"+t_megafruit_fruit_name+"<br>"+r+"</div>"}l+='<div class="bonusinfo">'+d+"</div>";if($("megafruit_need_item"+s[b]["oid"]+"_tt")){$("megafruit_need_item"+s[b]["oid"]+"_tt").innerHTML=l}}}}}function openStatsMegaFruit(){var a=99;if($("megafruit_stats_select")){a=$("megafruit_stats_select").value}megafruit_stats_select=a;if(megafruit_stats_cache[a]){megafruit_stats=megafruit_stats_cache[a]}if(megafruit_stats_delay<=0||!megafruit_stats_cache[a]){farmAction("megafruit_stats",1,1,a)}else{dialogMegaFruit("stats")}}function dialogMegaFruit(r,v){var C=0;var b=0;if(r=="stock"){var d=t_foodcontest_stock_button;var n="<div style='position:relative; display:flex; justify-content:left; flex-wrap:wrap; gap:10px;'>";b=1;var e=1;for(var B in farmersmarket_data.megafruit.stock){n+='<div style="position:relative; margin-bottom:15px;">';n+='  <img src="'+imgpath+"megafruitparts"+B+'.png" style="width:75px;">';n+='  <div style="position:absolute; background-color:#fff; width:60px; height:20px; padding-top:3px; border-radius:5px; width:100%; box-sizing:border-box;">'+farmersmarket_data.megafruit.stock[B]+"</div>";n+="</div>";e++}n+="</div>"}if(r=="buy"||r=="buy_confirm"){if(r=="buy_confirm"){if(!megafruit_block){megafruit_block=1}else{return false}}var h=(const_megafruit_exchange_fruits*farmersmarket_data.megafruit.level);var t="";var c="";var E=specialbonus.findBonus({key1:"megafruit",key2:"buypoints"});if(E){t=specialbonus.htmlBonusLine(E.buypoints);c="specialbonus_bonus_value";h=Math.ceil(h*(1+E.buypoints))}var d=t_megafruit_buy_head;var s=str_replace("%COINS%",farmersmarket_data.megafruit.exchangecoins,t_megafruit_buy_body);s=str_replace("%AMOUNT%",'<span class="'+c+'">'+h+"</span>",s);if(r=="buy"){var n='<div id="megafruit_buy_button" class="link" onclick="dialogMegaFruit(\'buy_confirm\')">'+s+"</div>";if(t!=""){n+='<div style="margin-top:5px;">'+t+"</div>"}var D=0;b=1;megafruit_block=0}else{var n=str_replace("%AMOUNT%",'<span class="'+c+'">'+h+"</span>",t_megafruit_buy_confirm);n=str_replace("%COINS%",farmersmarket_data.megafruit.exchangecoins,n);if(t!=""){n+='<div style="margin-top:5px;">'+t+"</div>"}var D="farmAction('megafruit_buy', 1, 1)"}}if(r=="level"){var d=t_megafruit_level_head;var n=htmlLevelAddDialog("megafruit");var D=""}if(r=="start"){var u=farmersmarket_data.megafruit.fruits[v].pid;var h=farmersmarket_data.megafruit.fruits[v].amount;var l=1;if(checkRackItem(u)>=h){l=0}var c="";if(l==1){c="important"}var d=str_replace("%PRODUCT%",produkt_name[u],t_megafruit_start_head);var n='<div style="background-color:#C3A75E; padding:5px; border-radius:5px; margin-top:10px;">';n+='  <div style="float:left; margin-top:6px; margin-right:5px;">'+lotterylotsrequired+"</div>";n+='  <div class="kp'+u+'" style="float:left; margin-top:6px; margin-right:5px;"></div>';n+='  <div class="'+c+'" style="float:left; margin-top:6px; margin-right:30px;">'+formatNumber(h)+"&nbsp;"+produkt_name[u]+"</div>";if(!l){n+='  <button type="button" class="button_new link" style="float:right;" onclick="farmAction(\'megafruit_start\', 1, 1, '+u+')">'+t_megafruit_start_button+"</button>"}n+='  <div class="clear"></div>';n+="</div>";var D=""}if(r=="need"){if(farmersmarket_data.megafruit.current&&farmersmarket_data.megafruit.current.remain>0){for(var B in farmersmarket_data.megafruit.objects){for(var z=0;z<farmersmarket_data.megafruit.objects[B].length;z++){if(farmersmarket_data.megafruit.objects[B][z].oid==v&&!farmersmarket_data.megafruit.objects[B][z].locked){if(!farmersmarket_data.megafruit.current.data[B]||(farmersmarket_data.megafruit.current.data[B]&&farmersmarket_data.megafruit.current.data[B].remain<=0)){var d=str_replace("%PRODUCT%",produkt_name[farmersmarket_data.megafruit.current.pid],t_megafruit_need_head[B]);var n="";if(farmersmarket_data.megafruit.objects[B][z].coins){var w=farmersmarket_data.megafruit.objects[B][z].coins;var t="";var c="";var E=specialbonus.findBonus({key1:"megafruit",key2:"buyobject"});if(+w>1&&E){t=specialbonus.htmlBonusLine(E.buyobject);c="specialbonus_bonus_value";w=Math.ceil(w*(1-E.buyobject))}n+="<div>"+cityadcost+'<span class="'+c+'">'+w+"</span>&nbsp;"+t_coins+"</div>";if(t!=""){n+=t}}if(farmersmarket_data.megafruit.objects[B][z].money){n+="<div>"+cityadcost+formatPrice(farmersmarket_data.megafruit.objects[B][z].money)+"</div>"}if(farmersmarket_data.megafruit.objects[B][z].fruits){n+="<div>"+cityadcost+farmersmarket_data.megafruit.objects[B][z].fruits+"&nbsp;"+t_megafruit_fruit_name+"</div>"}n+='<div style="margin-top:4px;">'+str_replace("%TIME%",formatTime(farmersmarket_data.megafruit.objects[B][z].duration),t_megafruit_object_duration)+"</div>";var t="";var A=farmersmarket_data.megafruit.objects[B][z].points;var q="";if(specialbonus){var E=specialbonus.findBonus({key1:"megafruit",key2:"points"});if(E){A=Math.ceil(A*(1+E.points));q="color:green; font-weight:bold;";t='<br><span style="'+q+'">'+t_specialbonus_megafruit_points_info+"</span>"}}n+='<div style="margin-top:4px;">'+str_replace("%AMOUNT%",'<span style="'+q+'">'+formatNumber(A)+"</span>",t_megafruit_object_points)+t+"</div>";var D="farmAction('megafruit_buyobject', 1, 1, "+v+")"}else{return false}break}}}}}if(r=="unlock"){for(var B in farmersmarket_data.megafruit.objects){for(var z=0;z<farmersmarket_data.megafruit.objects[B].length;z++){if(farmersmarket_data.megafruit.objects[B][z].oid==v&&farmersmarket_data.megafruit.objects[B][z].buyable){if(farmersmarket_data.megafruit.count>=farmersmarket_data.megafruit.objects[B][z].unlock){var d=str_replace("%OBJECT%",farmersmarket_data.megafruit.objects[B][z].name,t_megafruit_unlock_head);var n='<div style="padding:10px; background-color:#C3A75E; border-radius:4px;">'+str_replace("%AMOUNT%",farmersmarket_data.megafruit.objects[B][z].unlock,t_megafruit_unlock_body)+"</div>";var D="farmAction('megafruit_unlockobject', 1, 1, "+v+")"}}}}}if(r=="stats"){var a="";var m='<div id="megafruit_stats_inner">';m+='  <div id="megafruit_stats_select_line">';m+='    <select id="megafruit_stats_select" onchange="openStatsMegaFruit()">';var t="";if(megafruit_stats_select==99){t="selected"}m+='    <option value="99">'+t_megafruit_stats_sum_fruits+"</option>";for(var B=0;B<farmersmarket_data.megafruit.fruits.length;B++){var t="";if(megafruit_stats_select==B){t="selected";a=produkt_name[farmersmarket_data.megafruit.fruits[B].pid]}m+='<option value="'+B+'" '+t+">"+str_replace("%PRODUCT%",produkt_name[farmersmarket_data.megafruit.fruits[B].pid],t_megafruit_stats_option)+"</option>"}m+="    </select>";m+="  </div>";var s=str_replace("%PRODUCT%",a,t_megafruit_best_player);if(megafruit_stats_select==99){s=t_megafruit_best_player2}s=str_replace("%BEST%",const_megafruit_stats_entries,s);m+='  <div class="headline" style="margin-top:10px; margin-bottom:10px;">'+s+"</div>";m+='  <div id="megafruit_stats_ranking">';m+=htmlStatsContent(megafruit_stats.ranking);if(megafruit_stats.self){m+='<div style="margin-top:10px;">'+str_replace("%COUNT%","<b>"+megafruit_stats.self.counter+"</b>",t_megafruit_best_result)+"</div>"}m+="</div>";m+="<div class=\"mini_close link\" onclick=\"hideDiv('megafruit_stats_transp'); hideDiv('megafruit_stats');\"></div>";$("megafruit_stats").innerHTML=m;showDiv("megafruit_stats");showDiv("megafruit_stats_transp");return false}globalcommitbox(d,n,D,C,b);if(r=="level"&&$("megafruit_level_insert")){$("megafruit_level_insert").focus()}}function megafruitCheckLevelAdd(){var a=$("megafruit_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>farmersmarket_data.megafruit.count){a=farmersmarket_data.megafruit.count}$("megafruit_dialog_leveladd_insert").value=a}function timerMegaFruit(){if(farmersmarket_data.megafruit&&farmersmarket_data.megafruit.current){if(farmersmarket_data.megafruit.current.remain>0){farmersmarket_data.megafruit.current.remain--;showFarmersmarketPosTimer(3,-1,formatTime(farmersmarket_data.megafruit.current.remain))}else{showFarmersmarketPosTimer(3,-1,statusProductionComplete)}}if($("megafruit_timer")){if(farmersmarket_data.megafruit&&farmersmarket_data.megafruit.current){hideDiv("megafruit_select");if(farmersmarket_data.megafruit.current.remain>0){var l=farmersmarket_data.megafruit.current.remain;var a=str_replace("%SIZE%","<b>"+farmersmarket_data.megafruit.current.points+"</b>",t_megafruit_timer_add);a=str_replace("%TIME%","<b>"+formatTime(l)+"</b>",a);$("megafruit_timer_count").innerHTML=a;showDiv("megafruit_timer");showDiv("megafruit_info_board");hideDiv("megafruit_harvest_button");var e=(100-((farmersmarket_data.megafruit.current.remain*100)/farmersmarket_data.megafruit.current.time));$("megafruit_timer_inner").style.width=e+"%";for(var d in farmersmarket_data.megafruit.current.data){if(!isNaN(farmersmarket_data.megafruit.current.data[d].remain)){farmersmarket_data.megafruit.current.data[d].remain--;var h=farmersmarket_data.megafruit.current.data[d].remain;if(farmersmarket_data.megafruit.current.data[d].remain>=0){showDiv("megafruit_need_"+d+"_timer_box");var c=farmersmarket_data.megafruit.current.data[d].duration;var e=Math.ceil((h*100)/c);$("megafruit_need_"+d+"_timer_inner").style.width=(e*(52/100))+"px";$("megafruit_need_"+d+"_timer").innerHTML="&nbsp;"+formatTime(h);$("megafruit_need_"+d+"_img").removeClassName("megafruit_need_"+d);$("megafruit_need_"+d+"_img").addClassName("megafruit_need_item"+farmersmarket_data.megafruit.current.data[d].oid)}else{hideDiv("megafruit_need_"+d+"_timer_box");$("megafruit_need_"+d+"_timer").innerHTML="";if($("megafruit_need_"+d+"_img")){$("megafruit_need_"+d+"_img").className="megafruit_need_img megafruit_need_"+d}setObjectsMegaFruit()}}}}else{hideDiv("megafruit_timer");showDiv("megafruit_info_board");showDiv("megafruit_harvest_button");for(var d in farmersmarket_data.megafruit.current.data){hideDiv("megafruit_need_"+d+"_timer_box");if($("megafruit_need_"+d+"_img")){$("megafruit_need_"+d+"_img").className="megafruit_need_img megafruit_need_"+d}}setObjectsMegaFruit()}var b="";b+='<div style="font-weight:bold;">'+t_megafruit_fruit_size+"&nbsp;"+formatNumber(farmersmarket_data.megafruit.current.points)+"</div>";if(farmersmarket_data.megafruit.current.rewards.money>0){b+='<div style="margin-top:5px;">'+formatPrice(farmersmarket_data.megafruit.current.rewards.money)+"</div>"}if(farmersmarket_data.megafruit.current.rewards.points>0){b+='<div style="margin-top:5px;">'+formatNumber(farmersmarket_data.megafruit.current.rewards.points)+"&nbsp;"+t_points+"</div>"}b+='<div style="margin-top:5px;">';if(farmersmarket_data.megafruit.current.rewards.fruits>0){b+='<div class="megafruit_seed" style="float:left; margin-right:5px;"></div><div style="float:left;">'+formatNumber(farmersmarket_data.megafruit.current.rewards.fruits)+"</div>"}if(farmersmarket_data.megafruit.current.rewards.parts>0){b+='<div style="float:left; margin-left:15px;"><img src="'+imgpath+"megafruitparts"+farmersmarket_data.megafruit.current.pid+'.png" style="width:20px; margin-right:5px;"></div><div style="float:left;">'+formatNumber(farmersmarket_data.megafruit.current.rewards.parts)+"</div>"}b+='  <div class="clear"></div>';b+="</div>";$("megafruit_info_board").innerHTML=b}else{hideDiv("megafruit_timer");hideDiv("megafruit_harvest_button");hideDiv("megafruit_info_board");showDiv("megafruit_select")}}}function closeMegaFruit(){hideDiv("transp");hideDiv("farmersmarket_pos3_inner")}function initFoodcontest(){in_foodcontest=1;var h=farmersmarket_data.foodcontest;var d="<div>";d+='  <div id="foodcontest_select_transp" class="transp"></div>';d+='  <div id="foodcontest_select">';d+='    <div id="foodcontest_select_list">';var l=1;for(var b=0;b<h.fruits.length;b++){if(h.fruits[b].pid){var n="";if(l%3==0){n+=" right"}var e=0;if(farmersmarket_data.foodcontest.config.stock&&farmersmarket_data.foodcontest.config.stock.fruits&&farmersmarket_data.foodcontest.config.stock.fruits[h.fruits[b].pid]){e=farmersmarket_data.foodcontest.config.stock.fruits[h.fruits[b].pid]}d+='<div class="link megafruit_select_item" onclick="dialogFoodcontest(\'start\', '+h.fruits[b].pid+","+e+')" onmouseover="showDiv(\'foodcontest_select_item_tt'+h.fruits[b].pid+"')\" onmouseout=\"hideDiv('foodcontest_select_item_tt"+h.fruits[b].pid+"')\">";d+='  <img src="'+imgpath+"megafruitparts"+h.fruits[b].pid+'.png" class="fruit_image_select">';d+='  <div id="foodcontest_select_item_amount'+h.fruits[b].pid+'" class="foodcontest_select_item_amount">'+e+"</div>";d+='  <div id="foodcontest_select_item_tt'+h.fruits[b].pid+'" class="foodcontest_select_item_tt ttbox '+n+'"><div style="font-weight:bold;">'+t_foodcontest_start_bold+'</div><div style="margin-top:5px;">'+t_foodcontest_bonus+h.fruits[b].bonus+'%</div><div class="bonusinfo">'+str_replace("%PRODUCT%",produkt_name[h.fruits[b].pid],t_foodcontest_start)+"</div></div>";d+="</div>";l++}}d+="    </div>";d+='    <div id="foodcontest_select_fighter">';var c=str_replace("%AMOUNT%",(h.config.fighter_need*Math.floor(h.constants.duration/h.constants.feed_duration)),t_foodcontest_fighter_bubble);d+='      <div id="foodcontest_select_fighter_need">'+c+"</div>";d+='      <div id="foodcontest_select_fighter_levelbar" onmouseover="showDiv(\'foodcontest_select_fighter_level_tt\')" onmouseout="hideDiv(\'foodcontest_select_fighter_level_tt\')">';d+='        <div id="foodcontest_select_fighter_levelbar_inner">';d+='          <div id="foodcontest_select_fighter_levelbar_inner_line" style="width:'+h.config.fighter_levelpercent+'%"></div>';d+='          <div id="foodcontest_select_fighter_levelbar_front"></div>';d+='          <div id="foodcontest_select_fighter_level">'+h.config.fighter_level+"</div>";var m=formatNumber(h.config.fighter_points);if(h.config.fighter_next_level_points){m+="&nbsp;/&nbsp;"+formatNumber(h.config.fighter_next_level_points)}d+='          <div id="foodcontest_select_fighter_level_tt" class="ttbox" style="top:35px;">'+m+"</div>";d+="        </div>";d+="      </div>";d+="    </div>";d+="  </div>";d+='  <div id="foodcontest_current">';d+='    <div id="foodcontest_stage">';d+='      <div id="foodcontest_stage_opponent1" class="foodcontest_stage_opponent1_idle"></div>';d+='      <div id="foodcontest_stage_fighter" class="foodcontest_stage_fighter_idle" onmouseover="showDiv(\'foodcontest_fighter_level_tt\')" onmouseout="hideDiv(\'foodcontest_fighter_level_tt\')">';d+='        <div id="foodcontest_fighter_level_tt" onmouseover="showDiv(\'foodcontest_fighter_level_tt_level_tt\')" onmouseout="hideDiv(\'foodcontest_fighter_level_tt_level_tt\')">';d+='          <div id="foodcontest_fighter_level_tt_inner">';d+='            <div id="foodcontest_fighter_level_tt_inner_line" style="width:'+h.config.fighter_levelpercent+'%"></div>';d+='            <div id="foodcontest_fighter_level_tt_levelbar_front"></div>';d+='            <div id="foodcontest_fighter_level_tt_fighter_level">'+h.config.fighter_level+"</div>";var m=formatNumber(h.config.fighter_points);if(h.config.fighter_next_level_points){m+="&nbsp;/&nbsp;"+formatNumber(h.config.fighter_next_level_points)}d+='            <div id="foodcontest_fighter_level_tt_level_tt" class="ttbox" style="top:35px;">'+m+"</div>";d+="          </div>";d+="        </div>";d+='        <div id="foodcontest_stage_fighter_bubble" class="foodcontest_stage_fighter_bubble_feed link" onmouseover="showDiv(\'foodcontest_stage_fighter_bubble_tt\')" onmouseout="hideDiv(\'foodcontest_stage_fighter_bubble_tt\')">';d+='          <div id="foodcontest_stage_fighter_bubble_tt" class="ttbox" style="width:150px;">';d+='			 <div style="margin-bottom:10px;">'+t_foodcontest_feed_head+"</div>";if(farmersmarket_data.foodcontest.current.pid){d+='<img style="float:left; margin-right:5px; width:25px; height:25px;" src="'+imgpath+"megafruitparts"+farmersmarket_data.foodcontest.current.pid+'.png">'}d+='            <div style="float:left; width:100px;">'+farmersmarket_data.foodcontest.config.fighter_need+" "+str_replace("%NAME%",produkt_name[farmersmarket_data.foodcontest.current.pid],t_foodcontest_fruit_name)+"</div>";d+='            <div class="clear"></div>';d+="		   </div>";d+="        </div>";d+='        <div id="foodcontest_stage_fighter_timer"></div>';d+="      </div>";d+='      <div id="foodcontest_stage_opponent2" class="foodcontest_stage_opponent2_idle"></div>';d+='      <div id="foodcontest_feedback"></div>';d+="    </div>";if(h.firsttime){d+='<div id="foodcontest_firsttime" class="firsttime_arrow"></div>'}d+="    <div id=\"foodcontest_happymeter\" onmouseover=\"showDiv('foodcontest_happymeter_percent1'); showDiv('foodcontest_happymeter_percent2'); showDiv('foodcontest_happymeter_percent3');\" onmouseout=\"hideDiv('foodcontest_happymeter_percent1'); hideDiv('foodcontest_happymeter_percent2'); hideDiv('foodcontest_happymeter_percent3');\">";d+='      <div id="foodcontest_happymeter_inner1"><div class="ttbox foodcontest_happymeter_percent" id="foodcontest_happymeter_percent1"></div></div>';d+='      <div id="foodcontest_happymeter_inner2"><div class="ttbox foodcontest_happymeter_percent" id="foodcontest_happymeter_percent2"></div></div>';d+='      <div id="foodcontest_happymeter_inner3"><div class="ttbox foodcontest_happymeter_percent" id="foodcontest_happymeter_percent3"></div></div>';d+='	   <div id="foodcontest_happymeter_front"></div>';d+="    </div>";d+='    <div id="foodcontest_merch" class="link" onclick="dialogFoodcontest(\'merch_slots\')" onmouseover="showDiv(\'foodcontest_merch_box_tt\')" onmouseout="hideDiv(\'foodcontest_merch_box_tt\')">';d+='      <div id="foodcontest_merch_box_tt" class="ttbox">'+t_foodcontest_merch_box+"</div>";d+="    </div>";d+='    <div id="foodcontest_merch_bubble" class="link" onclick="dialogFoodcontest(\'merch_cash\')" onmouseover="showDiv(\'foodcontest_merch_bubble_tt\')" onmouseout="hideDiv(\'foodcontest_merch_bubble_tt\')">';d+='      <div id="foodcontest_merch_bubble_tt" style="top:60px;" class="ttbox">'+t_foodcontest_merch_cash+"</div>";d+="    </div>";d+='    <div id="foodcontest_blocks">';for(var b=1;b<=4;b++){d+='<div id="foodcontest_block'+b+'" class="foodcontest_block link">';d+='  <div id="foodcontest_block_crowd'+b+'"></div>';if(b>1){d+='<div id="foodcontest_block_crowd'+b+'_block" class="foodcontest_block_block"></div>'}d+='  <div id="foodcontest_block_crowd'+b+'_pin_money" class="foodcontest_block_pin"></div>';d+='  <div id="foodcontest_block_crowd'+b+'_pin_points" class="foodcontest_block_pin"></div>';d+='  <div id="foodcontest_block_crowd'+b+'_pin_fame" class="foodcontest_block_pin"></div>';d+='  <div id="foodcontest_block_crowd'+b+'_pin_products" class="foodcontest_block_pin"></div>';var q=t_foodcontest_rent_block_head;if(farmersmarket_data.foodcontest.blocks[b]&&farmersmarket_data.foodcontest.blocks[b].money){q=t_foodcontest_buy_block_head}d+='  <div id="foodcontest_block_crowd'+b+'_tt" class="ttbox foodcontest_block_crowd_tt">'+q+"</div>";d+="</div>"}d+="    </div>";d+='    <div id="foodcontest_timer">';d+='      <div id="foodcontest_timer_inner"></div>';d+='      <div id="foodcontest_timer_count"></div>';d+="    </div>";d+="  </div>";d+='  <div class="foodcontest_stats_button link" onclick="getStatsFoodcontest()" onmouseover="showDiv(\'foodcontest_stats_button_tt\')" onmouseout="hideDiv(\'foodcontest_stats_button_tt\')">';d+='    <div id="foodcontest_stats_button_tt" class="ttbox">'+t_foodcontest_stats_button+"</div>";d+="  </div>";d+='  <div class="foodcontest_stock_button link" onclick="dialogFoodcontest(\'stock\')" onmouseover="showDiv(\'foodcontest_stock_button_tt\')" onmouseout="hideDiv(\'foodcontest_stock_button_tt\')">';d+='    <div id="foodcontest_stock_button_tt" class="ttbox">'+t_foodcontest_stock_button+"</div>";d+="  </div>";d+='  <div id="foodcontest_collection_button" class="foodcontest_collection_button link" onclick="dialogFoodcontest(\'collection\')" onmouseover="showDiv(\'foodcontest_collection_button_tt\')" onmouseout="hideDiv(\'foodcontest_collection_button_tt\')">';d+='    <div id="foodcontest_collection_button_tt" class="ttbox">'+t_foodcontest_collection_button+"</div>";d+="  </div>";d+='  <div id="foodcontest_collection_flyer"></div>';d+='  <div id="foodcontest_help_button" class="foodcontest_help_button link" onclick="openFarmersMarketHowTo(\'foodcontest\', 1)"></div>';d+='  <div class="mini_close link" onclick="closeFoodcontest()"></div>';d+='  <div id="foodcontest_transp" style="z-index:5" class="transp"></div>';d+='  <div id="foodcontest_merch_box" style="z-index:10">';d+='    <div id="foodcontest_merch_box_header"></div>';d+='    <div id="foodcontest_merch_box_inner"></div>';d+='    <div id="foodcontest_merch_box_footer"></div>';d+="    <div id=\"foodcontest_merch_box_close\" class=\"mini_close link\" onclick=\"hideDiv('foodcontest_box_merch'); hideDiv('foodcontest_transp'); dialogFoodcontest('merch_slots');\"></div>";d+='    <div class="globalbox_edge globalbox_edge_tl" style="z-index:2"></div>';d+='    <div class="globalbox_edge globalbox_edge_tr" style="z-index:2"></div>';d+='    <div class="globalbox_edge globalbox_edge_bl" style="z-index:2"></div>';d+='    <div class="globalbox_edge globalbox_edge_br" style="z-index:2"></div>';d+="  </div>";d+='  <div id="foodcontest_stock" style="z-index:10">';d+='    <div id="foodcontest_stock_header"></div>';d+='    <div id="foodcontest_stock_inner"></div>';d+='    <div id="foodcontest_stock_footer"></div>';d+='    <div id="foodcontest_stock_close" class="mini_close link" onclick="hideDiv(\'foodcontest_stock\'); hideDiv(\'foodcontest_transp\')"></div>';d+='    <div class="globalbox_edge globalbox_edge_tl" style="z-index:2"></div>';d+='    <div class="globalbox_edge globalbox_edge_tr" style="z-index:2"></div>';d+='    <div class="globalbox_edge globalbox_edge_bl" style="z-index:2"></div>';d+='    <div class="globalbox_edge globalbox_edge_br" style="z-index:2"></div>';d+="  </div>";d+='  <div id="foodcontest_stats" style="z-index:10">';d+='    <div id="foodcontest_stats_inner">';d+='      <div id="foodcontest_stats_select_line">';d+='        <select id="foodcontest_stats_select" onchange="getStatsFoodcontest()">';var a={fighter:{opt:t_foodcontest_stats_fighter,head:t_foodcontest_stats_fighter_head},winner:{opt:t_foodcontest_stats_winner,head:t_foodcontest_stats_winner_head},winsinrow:{opt:t_foodcontest_stats_winsinrow,head:t_foodcontest_stats_winsinrow_head}};for(var b in a){var r="";if(foodcontest_stats_select==b){r="selected"}d+='<option value="'+b+'" '+r+">"+a[b].opt+"</option>"}d+="        </select>";d+="      </div>";d+='      <div class="headline" style="margin-top:10px; margin-bottom:10px;">'+a[foodcontest_stats_select].head+"</div>";d+='      <div id="foodcontest_stats_ranking"></div>';d+="    </div>";d+='    <div id="foodcontest_stats_close" class="mini_close link" onclick="hideDiv(\'foodcontest_stats\'); hideDiv(\'foodcontest_transp\')"></div>';d+="  </div>";d+="</div>";$("farmersmarket_pos6_inner").innerHTML=d;hideDiv("foodcontest_timer");hideDiv("foodcontest_stage_fighter_timer");hideDiv("foodcontest_stage_fighter_bubble");if(h.current){hideDiv("foodcontest_select_transp");hideDiv("foodcontest_select");showDiv("foodcontest_current");for(var b=1;b<=4;b++){if(stopanimation==1){$("foodcontest_block_crowd"+b).className="foodcontest_block_crowd"+b+"_static"}else{if(h.blocks[b]&&!h.blocks[b].block){$("foodcontest_block_crowd"+b).className="foodcontest_block_crowd"+b+"_ani"}else{$("foodcontest_block_crowd"+b).className=""}}}if(h.current.data&&h.current.data.collect){showDiv("foodcontest_collection_button")}else{hideDiv("foodcontest_collection_button")}}else{hideDiv("foodcontest_collection_button");showDiv("foodcontest_select_transp");showDiv("foodcontest_select");hideDiv("foodcontest_current");for(var b=1;b<=4;b++){$("foodcontest_block_crowd"+b).className=""}}showDiv("transp");showDiv("farmersmarket_pos6_inner");setContentFoodcontest()}function getStatsFoodcontest(a){if(!a){if($("foodcontest_stats_select")){a=$("foodcontest_stats_select").value}else{a="fighter"}}foodcontest_stats_select=a;farmAction("foodcontest_stats",1,1,a)}function openStatsFoodcontest(){var a="";a+=htmlStatsContent(foodcontest_stats.ranking);$("foodcontest_stats_ranking").innerHTML=a;showDiv("foodcontest_transp");showDiv("foodcontest_stats")}function cachePinFoodcontest(d,c){if(!foodcontest_pincache.length){foodcontest_cache_run=setTimeout("cacheFireFoodcontest()",2000)}var e=0;for(var b=0;b<foodcontest_pincache.length;b++){if(foodcontest_pincache[b].block==d&&foodcontest_pincache[b].type==c){e=1}}if(!e){var a={block:d,type:c};foodcontest_pincache.push(a);hideDiv("foodcontest_block_crowd"+d+"_pin_"+c);delete farmersmarket_data.foodcontest.blocks[d].pin[c]}}function cacheFireFoodcontest(){var b="";for(var a=0;a<foodcontest_pincache.length;a++){b+=foodcontest_pincache[a].block+"_"+foodcontest_pincache[a].type+","}clearTimeout(foodcontest_cache_run);foodcontest_cache_run=0;foodcontest_pincache=[];farmAction("foodcontest_pincache",1,1,b)}function timerFoodcontest(){if(farmersmarket_data.foodcontest){if(farmersmarket_data.foodcontest.current){farmersmarket_data.foodcontest.current.remain--;farmersmarket_data.foodcontest.current.feedremain--;if(farmersmarket_data.foodcontest.current.remain>0){for(var a=1;a<=2;a++){if(farmersmarket_data.foodcontest.current.data["opponent"+a].remain){farmersmarket_data.foodcontest.current.data["opponent"+a].remain--}}showFarmersmarketPosTimer(6,-1,formatTime(farmersmarket_data.foodcontest.current.remain))}else{showFarmersmarketPosTimer(6,-1,statusProductionComplete)}}if(farmersmarket_data.foodcontest.current.data&&farmersmarket_data.foodcontest.current.data.merchpin_remain){farmersmarket_data.foodcontest.current.data.merchpin_remain--}if(farmersmarket_data.foodcontest.blocks){for(var b=1;b<=4;b++){if(farmersmarket_data.foodcontest.blocks[b]&&farmersmarket_data.foodcontest.blocks[b].pin){for(var c in farmersmarket_data.foodcontest.blocks[b].pin){if(!farmersmarket_data.foodcontest.blocks[b].block){farmersmarket_data.foodcontest.blocks[b].pin[c].remain--}}}}}setContentFoodcontest()}}var foodcontest_last_update=0;function setContentFoodcontest(){if(!in_foodcontest){return false}var F=farmersmarket_data.foodcontest;if(F.current&&$("foodcontest_timer")){if(F.current.remain>=0){foodcontest_last_update++;var u=(F.constants.duration-F.current.remain);if(u>0&&u%F.constants.feed_duration==0&&foodcontest_last_update>=5){farmAction("foodcontest_update",1,1);foodcontest_last_update=0}}if($("firsttime")){if(F.firsttime){showDiv("foodcontest_firsttime")}else{hideDiv("foodcontest_firsttime")}}$("foodcontest_stage_fighter").className="";$("foodcontest_stage_opponent1").className="";$("foodcontest_stage_opponent2").className="";$("foodcontest_stage_fighter_bubble").onclick=new Function();var q=F.constants.duration;var E=0;var c={"1":F.constants.duration,"2":F.constants.duration};var e={"1":0,"2":0};if(F.current.remain>0){var G=(F.constants.duration-F.current.remain);var t='<img style="position:relative; float:left; width:20px; margin-right:5px; margin-top:-5px;" src="'+imgpath+"megafruitparts"+F.current.pid+'.png">';t+='<div style="position:relative; float:left;">'+t_foodcontest_resttime+'&nbsp;<span style="font-weight:bold;">'+formatTime(F.current.remain)+"</span></div>";t+='<div class="clear"></div>';$("foodcontest_timer_count").innerHTML=t;$("foodcontest_timer_inner").style.width=(((F.constants.duration-F.current.remain)*100)/F.constants.duration)+"%";showDiv("foodcontest_timer");if(F.current.feedremain>0){E=(F.constants.feed_duration-F.current.feedremain);if(F.current.data.feed&&F.current.data.feed.length>0){E=(E+((F.current.data.feed.length-1)*F.constants.feed_duration))}$("foodcontest_stage_fighter_timer").innerHTML=formatTime(F.current.feedremain);showDiv("foodcontest_stage_fighter_timer");hideDiv("foodcontest_stage_fighter_bubble");$("foodcontest_stage_fighter").addClassName("foodcontest_stage_fighter_eat")}else{if(F.current.data.feed&&F.current.data.feed.length>0){E=(F.current.data.feed.length*F.constants.feed_duration)}hideDiv("foodcontest_stage_fighter_timer");showDiv("foodcontest_stage_fighter_bubble");var w="dialogFoodcontest('need_more')";if(F.config.stock&&F.config.stock.fruits&&F.config.stock.fruits[F.current.pid]&&F.config.stock.fruits[F.current.pid]>=F.config.fighter_need){w="dialogFoodcontest('feed')"}$("foodcontest_stage_fighter_bubble").onclick=new Function(w);$("foodcontest_stage_fighter").addClassName("foodcontest_stage_fighter_idle")}for(var A=1;A<=2;A++){var B=(F.constants.duration/F.constants.feed_duration);var l=Math.ceil(F.current.remain/F.constants.feed_duration);var s=(B-l);if(F.current.data["opponent"+A].set[s]){$("foodcontest_stage_opponent"+A).addClassName("foodcontest_stage_opponent"+A+"_eat")}else{$("foodcontest_stage_opponent"+A).addClassName("foodcontest_stage_opponent"+A+"_idle")}}}else{farmAction("foodcontest_finish",1,1)}var b=((E*100)/G);for(var C=0;C<F.fruits.length;C++){if(F.fruits[C].pid==F.current.pid){b+=F.fruits[C].bonus}if(b>100){b=100}}var D=((125/100)*b);$("foodcontest_happymeter_inner2").style.height=D+"px";$("foodcontest_happymeter_percent2").innerHTML=Math.ceil(b)+"%";for(var z=1;z<=2;z++){var l=Math.ceil((F.constants.duration-F.current.remain)/F.constants.feed_duration);var n=0;for(var C=0;C<l;C++){if(F.current.data["opponent"+z].set[C]==1){n++}}var b=((n*100)/l);if(isNaN(b)){b=0}var D=0;if(b>0){D=((125/100)*b)}var m=1;if(z>1){m=3}$("foodcontest_happymeter_inner"+m).style.height=D+"px";$("foodcontest_happymeter_percent"+m).innerHTML=Math.ceil(b)+"%"}}if(F.merch_slots){for(var C in F.merch_slots){var a=t_foodcontest_set_merch;if($("foodcontest_merch_slot"+C)){if(F.merch_slots[C].pid){for(var A=0;A<F.merch.length;A++){if(F.merch[A].id==F.merch_slots[C].pid){a=F.merch[A].name;break}}}if(F.merch_slots[C].block){if(F.merch_slots[C].money){a=str_replace("%MONEY%",formatPrice(F.merch_slots[C].money),t_foodcontest_merch_slot_buy_body)}if(F.merch_slots[C].coins){a=str_replace("%COINS%",F.merch_slots[C].coins,t_foodcontest_merch_slot_rent_body)}if(F.merch_slots[C].level&&F.merch_slots[C].level>F.config.fighter_level){a+='<div style="margin-top:10px; font-style:italic; color:#f00;">'+str_replace("%LEVEL%",F.merch_slots[C].level,t_foodcontest_merch_require_level)+"</div>";showDiv("foodcontest_merch_slot_lock"+C)}else{$("foodcontest_merch_slot"+C).onclick=new Function("dialogFoodcontest('buy_merch_slot', "+C+")");showDiv("foodcontest_merch_slot_unlock"+C)}}else{$("foodcontest_merch_slot"+C).onclick=new Function("dialogFoodcontest('set_merch_slot', "+C+")");hideDiv("foodcontest_merch_slot_lock"+C);hideDiv("foodcontest_merch_slot_unlock"+C)}$("foodcontest_merch_slot_tt"+C).innerHTML=a}}}if(F.current.data&&F.current.data.merchpin_remain){if(F.current.data.merchpin_remain<=0){showDiv("foodcontest_merch_bubble")}else{hideDiv("foodcontest_merch_bubble")}}if(F.blocks){for(var C=1;C<=4;C++){if($("foodcontest_block"+C)&&F.blocks[C]){if(C>1){$("foodcontest_block"+C).onmouseover=new Function("");$("foodcontest_block"+C).onmouseout=new Function("");$("foodcontest_block"+C).onclick=new Function("");if(!F.blocks[C].block){hideDiv("foodcontest_block_crowd"+C+"_block");if(stopanimation==1){$("foodcontest_block_crowd"+C).className="foodcontest_block_crowd"+C+"_static"}else{$("foodcontest_block_crowd"+C).className="foodcontest_block_crowd"+C+"_ani"}}else{showDiv("foodcontest_block_crowd"+C+"_block");var d="rent_block";if(F.blocks[C].money){d="buy_block"}$("foodcontest_block"+C).onclick=new Function("dialogFoodcontest('"+d+"', "+C+")");$("foodcontest_block_crowd"+C).className="";$("foodcontest_block"+C).onmouseover=new Function("showDiv('foodcontest_block_crowd"+C+"_tt')");$("foodcontest_block"+C).onmouseout=new Function("hideDiv('foodcontest_block_crowd"+C+"_tt')")}}if(F.blocks[C].pin){for(var d in F.blocks[C].pin){if($("foodcontest_block_crowd"+C+"_pin_"+d)){if(!F.blocks[C].block){$("foodcontest_block_crowd"+C+"_pin_"+d).onclick=new Function("");hideDiv("foodcontest_block_crowd"+C+"_pin_"+d);var v=F.blocks[C].pin[d];if(v.remain<=0&&F.current.remain>0){showDiv("foodcontest_block_crowd"+C+"_pin_"+d);$("foodcontest_block_crowd"+C+"_pin_"+d).className="foodcontest_block_pin foodcontest_block_pin_"+d;$("foodcontest_block_crowd"+C+"_pin_"+d).onclick=new Function("cachePinFoodcontest("+C+", '"+d+"')")}}else{hideDiv("foodcontest_block_crowd"+C+"_pin_"+d)}}}for(var z=0;z<foodcontest_pincache.length;z++){var r=foodcontest_pincache[z].block;var d=foodcontest_pincache[z].type;if($("foodcontest_block_crowd"+r+"_pin_"+d)){hideDiv("foodcontest_block_crowd"+r+"_pin_"+d)}}}}}}}function dialogFoodcontest(r,u,b,a){hideDiv("foodcontest_merch_box");hideDiv("foodcontest_transp");var A=farmersmarket_data.foodcontest;var c=0;var n=0;if(r=="merch_cash"){var h=0;for(var z in A.merch_slots){if(A.merch_slots[z].pid){h++}}if(h>0){farmAction("foodcontest_merchpin",1,1);return false}else{var e=t_foodcontest_merch_cash;var m=t_foodcontest_nomerch_to_cash;var v="farmAction('foodcontest_merchpin', 1, 1)"}}if(r=="buy_block"){var e=t_foodcontest_buy_block_head;var m=str_replace("%COST%",formatPrice(A.blocks[u].money),t_foodcontest_buy_block_body);var v="farmAction('foodcontest_buy_block', 1, 1, "+u+")"}if(r=="rent_block"){var e=t_foodcontest_rent_block_head;var m=str_replace("%TIME%",formatTime(A.blocks[u].duration),t_foodcontest_rent_block_body);if(A.blocks[u].money){m=str_replace("%MONEY%",formatPrice(A.blocks[u].money),m)}if(A.blocks[u].coins){m=str_replace("%MONEY%",A.blocks[u].coins+"&nbsp;"+t_coins,m)}var v="farmAction('foodcontest_rent_block', 1, 1, "+u+")"}if(r=="merch_slots"){var e=t_foodcontest_merchandise_slots;var m="";m+='<div id="foodcontest_merch_slots_inner">';for(var z=1;z<=6;z++){m+='<div id="foodcontest_merch_slot'+z+'" class="foodcontest_merch_slot link" onmouseover="showDiv(\'foodcontest_merch_slot_tt'+z+"')\" onmouseout=\"hideDiv('foodcontest_merch_slot_tt"+z+"')\">";if(A.merch_slots[z]){var t="_top";if(z>3){t="_bottom"}if(A.merch_slots[z].pid){m+='<div class="foodcontest_merch'+A.merch_slots[z].pid+'"></div>'}m+='<div id="foodcontest_merch_slot_lock'+z+'" class="foodcontest_merch_slot_lock"></div>';m+='<div id="foodcontest_merch_slot_unlock'+z+'" class="foodcontest_merch_slot_unlock"></div>';m+='<div id="foodcontest_merch_slot_tt'+z+'" class="foodcontest_merch_slot_tt'+t+' ttbox"></div>';if(A.merch_slots[z].pid){for(var w=0;w<A.merch.length;w++){if(A.merch_slots[z].pid==A.merch[w].id){m+='<div class="foodcontest_select_merchitem_amount">'+A.merch[w].amount+"</div>"}}}}m+="</div>"}m+='  <div class="clear"></div>';m+="</div>";no_buttons=1}if(r=="buy_merch_slot"){if(A.merch_slots[u].duration){var e=t_foodcontest_merch_slot_rent_head;var m=str_replace("%COINS%",A.merch_slots[u].coins,t_foodcontest_merch_slot_rent_body)}else{var e=t_foodcontest_merch_slot_buy_head;var m=str_replace("%MONEY%",formatPrice(A.merch_slots[u].money),t_foodcontest_merch_slot_buy_body)}var v="farmAction('foodcontest_buy_slot', 1, 1, "+u+")";var n="dialogFoodcontest('merch_slots')"}if(r=="set_merch_slot"){if(u>0){foodcontest_merch_slot_select=u}var e=t_foodcontest_merch_overview;var m="";m+='<div id="foodcontest_merch_tab">';for(var z=1;z<=3;z++){var t="";if(z==1){t="margin-left:10px;"}m+='<div style="'+t+'" id="foodcontest_merch_tab'+z+'" class="foodcontest_merch_tab link foodcontest_merch_tab'+z+'" onclick="showMerchCategoryFoodcontest('+z+')"></div>'}m+='  <div class="clear"></div>';m+="</div>";m+="<div>";for(var z=1;z<=3;z++){m+='<div id="foodcontest_merch_category'+z+'"></div>';m+='<div class="clear"></div>'}m+="</div>";m+='<div id="foodcontest_merch_navi">';m+='  <div id="foodcontest_merch_navi_left" class="foodcontest_merch_navi_left link"></div>';m+='  <div id="foodcontest_merch_navi_right" class="foodcontest_merch_navi_right link"></div>';m+='  <div class="clear"></div>';m+='  <div id="foodcontest_merch_navi_middle"></div>';m+="</div>";$("foodcontest_merch_box_inner").innerHTML=m;showDiv("foodcontest_transp");showDiv("foodcontest_merch_box");hideDiv("globalbox");hideDiv("globaltransp");showMerchCategoryFoodcontest();return false}if(r=="buy_merch"){var e=str_replace("%NAME%",A.merch[u].name,t_foodcontest_merch_buy_head);var m='<div style="width:350px;">';m+='  <div class="foodcontest_merch'+A.merch[u].id+'" style="margin:0 auto; margin-bottom:10px;"></div>';m+='  <div style="background-color:#C3A75E; padding:5px; border-radius:5px; margin:10px 0;">';m+='    <input type="number" maxlength="5" id="foodcontest_merch_buy_input" style="display:block; float:left; font-weight:bold; padding:2px; border-radius:5px; border:1px solid #ccc; width:75px;" value="1" onkeyup="calcMerchPriceFoodcontest('+u+')" onchange="calcMerchPriceFoodcontest('+u+')">';if(A.merch[u].money||A.merch[u].coins){if(A.merch[u].money){var h=A.merch[u].money[1]}if(A.merch[u].coins){var h=A.merch[u].coins[1]}var q=str_replace("%COUNT%",h,t_foodcontest_merch_buy_package);q=str_replace("%SUM%",'<span id="foodcontest_merch_package_count" style="font-weight:bold;"></span>',q);m+='<div style="float:left; margin:5px 0px 0 5px;">'+q+"</div>"}m+='    <div style="float:left; margin:5px 0 0 5px;">'+t_inner_stock+"&nbsp;"+A.merch[u].amount+"&nbsp;"+t_stk+"</div>";m+='    <button type="button" id="foodcontest_merch_buy_button" class="button_new link" style="float:right;" onclick="dialogFoodcontest(\'buy_merch_commit\', '+u+')">'+market_buy+"</button>";m+='    <div class="clear"></div>';m+="  </div>";m+='  <div id="foodcontest_merch_buy_button_line">';m+='    <div style="float:left; margin-right:5px;">'+cityadcost+"</div>";m+='    <div style="float:left; font-weight:bold;" id="foodcontest_merch_buy_cost"></div>';m+='    <div class="clear"></div>';m+="  </div>";m+="</div>";c=1;n="dialogFoodcontest('set_merch_slot')"}if(r=="buy_merch_commit"){var l=$("foodcontest_merch_buy_input").value;var B=0;if(l>0){l=parseInt(l);var h=l;if(A.merch[u].money){h=(l*A.merch[u].money[1])}if(A.merch[u].coins){h=(l*A.merch[u].coins[1])}if(A.merch[u].money){var B=formatPrice(l*A.merch[u].money[0])}else{if(A.merch[u].coins){var B=(l*A.merch[u].coins[0])+"&nbsp;"+t_coins}else{var B=(l*A.merch[u].fruits[1])+"&nbsp"+str_replace("%NAME%",produkt_name[A.merch[u].fruits[0]],t_foodcontest_fruit_name)}}var e=str_replace("%NAME%",A.merch[u].name,t_foodcontest_merch_buy_head);var m=str_replace("%NAME%",A.merch[u].name,t_foodcontest_merch_buy_body);m=str_replace("%AMOUNT%",h,m);m=str_replace("%COST%",B,m);var v="farmAction('foodcontest_buy_merch', 1, 1, "+A.merch[u].id+", "+l+")";var n="dialogFoodcontest('buy_merch', "+u+")"}else{return false}}if(r=="stock"){var e=t_foodcontest_stock_button;var m="";m+='<div class="headline" style="text-align:center;margin-bottom:5px;">'+t_foodcontest_stock_button+"</div>";m+='<div class="foodcontest_stock">';for(var z=0;z<A.fruits.length;z++){var l=0;if(A.config.stock&&A.config.stock.fruits&&A.config.stock.fruits[A.fruits[z].pid]){l=A.config.stock.fruits[A.fruits[z].pid]}m+='<div class="foodcontest_stock_item" onmouseover="showDiv(\'foodcontest_stock_item_tt'+A.fruits[z].pid+"')\" onmouseout=\"hideDiv('foodcontest_stock_item_tt"+A.fruits[z].pid+"')\">";m+='  <img src="'+imgpath+"megafruitparts"+A.fruits[z].pid+'.png" class="foodcontest_stock_item_img">';m+='  <div id="foodcontest_stock_item_tt'+A.fruits[z].pid+'" class="ttbox foodcontest_stock_item_tt">';m+='    <div style="font-weight:bold;">'+produkt_name[A.fruits[z].pid]+"</div>";m+="    <div>"+t_foodcontest_bonus+A.fruits[z].bonus+"%</div>";m+="  </div>";m+='  <div class="foodcontest_stock_amount_plus amount_plus link" onclick="dialogFoodcontest(\'buy\', '+A.fruits[z].pid+')">';m+='    <div class="foodcontest_stock_item_amount">'+l+"</div>";m+='    <div class="clear"></div>';m+="  </div>";m+="</div>"}m+='  <div class="clear"></div>';m+="</div>";showDiv("foodcontest_transp");showDiv("foodcontest_stock");$("foodcontest_stock_inner").innerHTML=m;return false}if(r=="buy"){foodcontest_block=0;var e=t_foodcontest_buy_head;var m="";for(var z in A.coins){var s='<div style="font-weight:bold; font-size:16px;">';s+='  <div style="position:relative; float:left; margin:5px 0 0 30px;">'+A.coins[z]+"x&nbsp;</div>";s+='  <img style="position:relative; float:left; margin:-15px 0 0 0; width:65px;" src="'+imgpath+"megafruitparts"+u+'.png">';s+='  <div style="position:relative; float:left; margin:5px 0 0 0;">=&nbsp;'+z+"&nbsp"+t_coins+"</div>";s+='  <div class="clear"></div>';s+="</div>";s=str_replace("%COINS%",z,s);s=str_replace("%PRODUCT%",produkt_name[u],s);m+='<div class="foodcontest_stock_buy_button link" onclick="dialogFoodcontest(\'buy_commit\', '+u+", "+z+')">'+s+"</div>"}var v=0}if(r=="buy_commit"){foodcontest_block=1;var e=t_foodcontest_buy_head;var m=str_replace("%COUNT%",A.coins[b],t_foodcontest_buy_select);m=str_replace("%COINS%",b,m);m=str_replace("%PRODUCT%",produkt_name[u],m);var v="farmAction('foodcontest_buy', 1, 1, "+u+", "+b+")"}if(r=="feed"){farmAction("foodcontest_feed",1,1)}if(r=="need_more"){var d=A.config.fighter_need;if(A.config.stock&&A.config.stock.fruits&&A.config.stock.fruits[A.current.pid]){d=(A.config.fighter_need-A.config.stock.fruits[A.current.pid])}var s=str_replace("%PRODUCT%",produkt_name[A.current.pid],t_foodcontest_need_more);s=str_replace("%NEED%",d,s);s+='<button type="button" class="button_new link" style="margin-top:20px;" onclick="dialogFoodcontest(\'buy\', '+A.current.pid+')">'+t_foodcontest_buy_head+"</button>";globalerrorbox(s);return false}if(r=="start"){var e=str_replace("%PRODUCT%",produkt_name[u],t_foodcontest_start_head);var m='<img src="'+imgpath+"megafruitparts"+u+'.png" style="width:70px; margin-bottom:10px;"><br>'+str_replace("%PRODUCT%",produkt_name[u],t_foodcontest_start_body);if(!b){m+='<div style="margin-top:5px;" class="important">'+t_foodcontest_start_warning+"</div>"}var v="farmAction('foodcontest_start', 1, 1, "+u+")"}if(r=="collection"){if(A.current.data.collect){var e=t_foodcontest_collect_head;var m="<div>";if(A.current.data.collect.points){m+='<div style="float:left; margin-right:5px; width:135px;"><div style="float:left;" class="miniicons_points"></div><div style="float:left; margin-bottom:4px;">'+formatNumber(A.current.data.collect.points)+"&nbsp;"+t_points+'</div><div class="clear"></div></div>'}if(A.current.data.collect.money){m+='<div style="float:left; margin-right:5px; width:135px;"><div style="float:left;" class="miniicons_money"></div><div style="float:left; margin-bottom:4px;">'+formatPrice(A.current.data.collect.money)+'</div><div class="clear"></div></div>'}if(A.current.data.collect.fame){m+='<div style="float:left; margin-right:5px; width:135px;"><div style="float:left;" class="miniicons_fame"></div><div style="float:left; margin-bottom:4px;">'+A.current.data.collect.fame+"&nbsp;"+t_foodcontest_fame+'</div><div class="clear"></div></div>'}m+='  <div class="clear"></div>';m+='  <div style="margin-top:5px;">';if(A.current.data.collect.products){for(var z in A.current.data.collect.products){m+='<div style="float:left; margin-bottom:5px; margin-right:5px; width:135px;">';m+='  <div style="float:left; margin-right:5px;" class="kp'+z+'"></div>';m+='  <div style="float:left">'+A.current.data.collect.products[z]+"x&nbsp;"+produkt_name[z]+"</div>";m+='  <div class="clear"></div>';m+="</div>"}}m+="  </div>";m+="</div>";c=1}else{return false}}globalcommitbox(e,m,v,n,c);if(r=="merch_slots"||r=="collection"){hideDiv("globalbox_char");hideDiv("globalbox_footer")}if(r=="buy_merch"){calcMerchPriceFoodcontest(u)}if(r=="stock"||r=="merch_slots"||r=="collection"){$("globalbox_content").addClassName("globalbox_content_big");$("globalbox").style.marginLeft="-265px"}if(r=="merch_slots"||r=="rent_slot"){setContentFoodcontest()}}function navigateMerchCategoryFoodcontest(b,c,a){if(!a){c--}else{c++}showMerchCategoryFoodcontest(b,c)}function showMerchCategoryFoodcontest(b,q){if(!b){b=1}foodcontest_merch_category=b;if(!q){q=1}for(var h=1;h<=3;h++){hideDiv("foodcontest_merch_category"+h);$("foodcontest_merch_tab"+h).removeClassName("foodcontest_merch_tab"+h+"_active")}showDiv("foodcontest_merch_category"+b);$("foodcontest_merch_tab"+b).addClassName("foodcontest_merch_tab"+b+"_active");var m=farmersmarket_data.foodcontest;var r=[];for(var h=0;h<m.merch.length;h++){if(m.merch[h].category==b){r.push(h)}}var c={};for(var h in m.merch_slots){if(m.merch_slots[h].pid){c[m.merch_slots[h].pid]=1}}var n=3;if(q==1){var u=1}else{var u=(((q-1)*n)+1)}var t=(q*n);var l="";for(var h=0;h<r.length;h++){if(parseInt(h+1)>=u&&parseInt(h+1)<=t){var a=r[h];var e=0;var s="";if(parseInt(m.merch[a].level)>parseInt(m.config.fighter_level)){s="important";e=1}var v="";if(m.merch[a].money){v="("+m.merch[a].money[1]+"&nbsp;"+t_stk+")"}if(m.merch[a].coins){v="("+m.merch[a].coins[1]+"&nbsp;"+t_stk+")"}l+='<div class="foodcontest_merch_overview_item">';l+='  <div style="float:left; margin-right:10px;" class="foodcontest_merch'+m.merch[a].id+'_m" onmouseover="showDiv(\'foodcontest_merch_img'+m.merch[a].id+"')\" onmouseout=\"hideDiv('foodcontest_merch_img"+m.merch[a].id+"')\">";l+='    <div class="ttbox" id="foodcontest_merch_img'+m.merch[a].id+'" style="top:30px; left:30px;">';l+='      <div style="margin-bottom:5px;">'+t_foodcontest_merch_loot+"</div>";l+='      <div style="margin-bottom:5px;">'+formatPrice(m.merch[a].sell.money)+"</div>";l+='      <div style="margin-bottom:5px;">'+formatNumber(m.merch[a].sell.points)+"&nbsp;"+t_points+"</div>";l+='      <div style="margin-bottom:10px;">'+m.merch[a].sell.fame+"&nbsp;"+t_foodcontest_fame+"</div>";l+="    </div>";if(c[m.merch[a].id]){l+='<img style="width:35px; top:30px; position:absolute; left:15px;" src="'+imgpath+'merchslot_isset.png">'}l+="  </div>";l+='  <div style="float:left;">';l+='    <div style="float:left; width:250px;">';l+='      <div style="margin-bottom:5px; font-weight:bold;" class="'+s+'">'+m.merch[a].name+"</div>";if(e){l+='<div style="font-style:italic; color:#f00; margin-bottom:5px;">'+str_replace("%LEVEL%",m.merch[a].level,t_foodcontest_merch_require_level)+"</div>"}if(m.merch[a].money){var d=formatPrice(m.merch[a].money[0])+"&nbsp;("+m.merch[a].money[1]+"&nbsp;"+t_stk+")"}if(m.merch[a].coins){var d=m.merch[a].coins[0]+"&nbsp;"+t_coins+"&nbsp;("+m.merch[a].coins[1]+"&nbsp;"+t_stk+")"}if(m.merch[a].fruits){var d=m.merch[a].fruits[1]+"&nbsp;"+str_replace("%NAME%",produkt_name[m.merch[a].fruits[0]],t_foodcontest_fruit_name)}l+='      <div style="margin-bottom:5px;">'+t_sell_price+"&nbsp;"+d+"</div>";l+='      <div style="margin-bottom:5px;">'+t_inner_stock+"&nbsp;"+m.merch[a].amount+"&nbsp;"+t_stk+"</div>";l+="    </div>";l+='    <div style="float:left;">';if(m.merch[a].amount>0&&foodcontest_merch_slot_select>0){l+='<div style="float:left;" class="link foodcontest_merchslot_setbutton" onclick="farmAction(\'foodcontest_set_slot\', 1, 1, '+foodcontest_merch_slot_select+", "+m.merch[a].id+')" onmouseover="showDiv(\'foodcontest_merchslot_setbutton_tt\')" onmouseout="hideDiv(\'foodcontest_merchslot_setbutton_tt\')">';l+='  <div id="foodcontest_merchslot_setbutton_tt" class="ttbox">'+t_foodcontest_merch_button_set_item+"</div>";l+="</div>"}if(!e){l+='<div style="float:left;" class="link foodcontest_merchslot_buybutton" onclick="dialogFoodcontest(\'buy_merch\', '+a+')" onmouseover="showDiv(\'foodcontest_merchslot_buybutton_tt\')" onmouseout="hideDiv(\'foodcontest_merchslot_buybutton_tt\')">';l+='  <div id="foodcontest_merchslot_buybutton_tt" class="ttbox">'+t_foodcontest_merch_button_buy_more+"</div>";l+="</div>"}l+='      <div class="clear"></div>';l+="    </div>";l+='    <div class="clear"></div>';l+="  </div>";l+='  <div class="clear"></div>';l+="</div>"}}$("foodcontest_merch_category"+b).innerHTML=l;hideDiv("foodcontest_merch_navi_left");hideDiv("foodcontest_merch_navi_right");if(q>1){showDiv("foodcontest_merch_navi_left");$("foodcontest_merch_navi_left").onclick=new Function("showMerchCategoryFoodcontest("+b+", "+(q-1)+")")}if(r.length>n&&parseInt(t+1)<=r.length){showDiv("foodcontest_merch_navi_right");$("foodcontest_merch_navi_right").onclick=new Function("showMerchCategoryFoodcontest("+b+", "+(q+1)+")")}hideDiv("foodcontest_merch_navi_middle");if(r.length>n){showDiv("foodcontest_merch_navi_middle");$("foodcontest_merch_navi_middle").innerHTML=q+"/"+Math.ceil(r.length/n)}}function calcMerchPriceFoodcontest(b){var e=farmersmarket_data.foodcontest.merch[b];var a=$("foodcontest_merch_buy_input").value;var d=0;if(a){if(!isNumeric(a)){a=1}a=parseInt(a);if(a<=0){a=0}if(e.money){d=formatPrice(e.money[0]*a)}if(e.coins){d=(e.coins[0]*a)+"&nbsp;"+t_coins}if(e.fruits){d='<div style="float:left; margin-right:5px;" class="kp'+e.fruits[0]+'"></div>';d+='<div style="float:left;">'+(e.fruits[1]*a)+"&nbsp;"+str_replace("%NAME%",produkt_name[e.fruits[0]],t_foodcontest_fruit_name)+"</div>";d+='<div class="clear"></div>'}$("foodcontest_merch_buy_input").value=a}if(a>0){$("foodcontest_merch_buy_cost").innerHTML=d;if(e.money||e.coins){if(e.money){var c=(a*e.money[1])}if(e.coins){var c=(a*e.coins[1])}$("foodcontest_merch_package_count").innerHTML=c}showDiv("foodcontest_merch_buy_button_line");showDiv("foodcontest_merch_buy_button")}else{if(e.money||e.coins){$("foodcontest_merch_package_count").innerHTML=0}hideDiv("foodcontest_merch_buy_button_line");hideDiv("foodcontest_merch_buy_button")}}function merchPinResultFoodcontest(a){var h=farmersmarket_data.foodcontest;var n=t_foodcontest_merchpin_head;var e="";var l={money:0,points:0,fame:0};e+='<div style="width:465px;">';for(var b=1;b<=6;b++){e+='<div class="foodcontest_merchpin_item">';e+='  <div class="foodcontest_merchpin_slot">';var d=0;if(h.merch_slots[b]&&h.merch_slots[b].pid){var d=h.merch_slots[b].pid}if(a[b]&&a[b].pid){var d=a[b].pid}if(d>0){e+='<div style="margin-top:2px; margin-left:5px;" class="foodcontest_merch'+d+'_m"></div>'}e+="  </div>";if(h.merch_slots[b].block){e+='<div class="foodcontest_merchslot_lock"></div>'}e+='  <div style="margin-top:5px; padding:5px;">';if(a[b]){e+='<div style="margin-bottom:4px;">'+t_foodcontest_merch_sold+a[b].amount+"</div>";e+='<div style="margin-bottom:4px;">'+t_foodcontest_merch_demanded+a[b].demand+"</div>";var c=0;if(h.config.stock.merch&&h.config.stock.merch[h.merch_slots[b].pid]){c=h.config.stock.merch[h.merch_slots[b].pid]}e+="<div>"+t_inner_stock+" "+c+"</div>";l.money+=a[b].money;l.points+=a[b].points;l.fame+=a[b].fame}else{if(h.config.stock.merch&&h.config.stock.merch[h.merch_slots[b].pid]){e+=t_foodcontest_merch_nodemand}else{if(h.merch_slots[b].block){e+=t_foodcontest_merch_block}else{e+=t_foodcontest_merch_empty}}}e+="  </div>";e+="</div>"}e+='<div class="clear"></div>';e+='<div style="position:relative; background-color:#C3A75E; border-radius:5px; padding:4px; width:452px;">';e+='  <div style="margin-bottom:5px;">'+t_foodcontest_merchpin_total+"</div>";e+='  <div style="float:left; margin-right:5px; width:145px;"><div style="float:left;" class="miniicons_points"></div><div style="float:left; margin-bottom:4px; font-size:12px; font-weight:bold;">'+formatNumber(l.points)+"&nbsp;"+t_points+'</div><div class="clear"></div></div>';e+='  <div style="float:left; margin-right:5px; width:145px;"><div style="float:left;" class="miniicons_money"></div><div style="float:left; margin-bottom:4px; font-size:12px; font-weight:bold;">'+formatPrice(l.money)+'</div><div class="clear"></div></div>';e+='  <div style="float:left; margin-right:5px; width:145px;"><div style="float:left;" class="miniicons_fame"></div><div style="float:left; margin-bottom:4px; font-size:12px; font-weight:bold;">'+l.fame+"&nbsp;"+t_foodcontest_fame+'</div><div class="clear"></div></div>';e+='  <div class="clear"></div>';e+="</div>";e+="</div>";foodcontest_flyer_data={money:l.money,points:l.points,fame:l.fame};var m="hideDiv('globalbox'); hideDiv('globaltransp'); collectionFlyerFoodcontest()";globalBoxFlex(n,e,0,m,1)}function rewardFoodcontest(h){var e=t_foodcontest_reward_head[h.rank];var a="";a+='<div style="position:relative; width:325px;">';a+='  <div class="foodcontest_podium">';var l=1;for(var d in h.ranking){var b="foodcontest_podium_char2";if(d=="opponent1"){b="foodcontest_podium_char1"}if(d=="opponent2"){b="foodcontest_podium_char3"}a+='<div class="'+b+" foodcontest_podium_pos"+l+'"></div>';l++}a+="  </div>";if(h.reward){a+='  <div class="headline" style="margin-top:10px;">'+t_foodcontest_reward_collect_head+"</div>";a+='  <div style="height:80px; overflow:auto;">';if(h.reward.money){a+='<div style="margin-bottom:4px;">';a+='  <div style="float:left;" class="miniicons_money"></div>';a+='  <div style="float:left; width:285px; text-align:left;"><span style="font-weight:bold;">'+formatPrice(h.reward.money)+"</span>";if(h.reward.bonus&&h.reward.bonus.money){var c=str_replace("%AMOUNT%",formatPrice(h.reward.bonus.money),t_foodcontest_reward_incl);a+="&nbsp;"+str_replace("%POS%",h.rank,c)}a+="  </div>";a+='  <div class="clear"></div>';a+="</div>"}if(h.reward.fame){a+='<div style="margin-bottom:4px;">';a+='  <div style="float:left;" class="miniicons_fame"></div>';a+='  <div style="float:left; width:285px; text-align:left;"><span style="font-weight:bold;">'+h.reward.fame+"&nbsp;"+t_foodcontest_fame+"</span>";if(h.reward.bonus&&h.reward.bonus.fame){var c=str_replace("%AMOUNT%",h.reward.bonus.fame+"&nbsp;"+t_foodcontest_fame,t_foodcontest_reward_incl);a+="&nbsp;"+str_replace("%POS%",h.rank,c)}a+="  </div>";a+='  <div class="clear"></div>';a+="</div>"}if(h.reward.points){a+='<div style="margin-bottom:4px;">';a+='  <div style="float:left;" class="miniicons_points"></div>';a+='  <div style="float:left; width:285px; text-align:left;"><span style="font-weight:bold;">'+formatNumber(h.reward.points)+"&nbsp;"+t_points+"</span>";if(h.reward.bonus&&h.reward.bonus.points){var c=str_replace("%AMOUNT%",formatNumber(h.reward.bonus.points)+"&nbsp;"+t_points,t_foodcontest_reward_incl);a+="&nbsp;"+str_replace("%POS%",h.rank,c)}a+="  </div>";a+='  <div class="clear"></div>';a+="</div>"}a+="  <div>";a+='    <div class="link" style="margin:5px 0;" onclick="toogleDiv(\'foodcontest_product_overview\')">';a+='      <img style="float:left; margin-right:5px;" id="foodcontest_product_overview_plus" src="'+imgpath+'guild/plus.gif">';a+='      <div style="float:left;">'+t_foodcontest_products_overview+"</div>";a+='      <div class="clear"></div>';a+="    </div>";a+='  <div id="foodcontest_product_overview" style="display:none;">';for(var d in h.reward.products){a+='<div style="margin-bottom:4px; float:left; width:150px;">';a+='  <div class="kp'+d+'" style="float:left; margin-right:5px;"></div>';a+='  <div style="float:left;">'+h.reward.products[d]+"x&nbsp;"+produkt_name[d]+"</div>";a+='  <div class="clear"></div>';a+="</div>"}a+='  <div class="clear"></div>';a+="  </div>";a+="  </div>";a+="  </div>"}a+='  <div class="button_yes link" onclick="hideDiv(\'globalbox\'); hideDiv(\'globaltransp\')" style="position:relative; left:50%; margin-left:-25px; width:50px; height:50px;"></div>';a+="</div>";globalBoxFlex(e,a,0,0,0)}var foodcontest_flyer_data={};function collectionFlyerFoodcontest(){var c=foodcontest_flyer_data;if(!("transition" in $("foodcontest_collection_flyer").style)&&!("webkitTransition" in $("foodcontest_collection_flyer").style)){return false}var b="";if(c.points){b+='<div style="margin-bottom:4px;">+'+formatNumber(c.points)+"&nbsp;"+t_points+"</div>"}if(c.money){b+='<div style="margin-bottom:4px;">+'+formatPrice(c.money)+"</div>"}if(c.fame){b+='<div style="margin-bottom:4px;">+'+c.fame+"&nbsp;"+t_foodcontest_fame+"</div>"}if(c.products){for(var a in c.products){b+='<div style="margin-bottom:4px;">';b+='<div style="float:left; margin-right:5px;" class="kp'+a+'"></div>';b+='<div style="float:left">'+c.products[a]+"x&nbsp;"+produkt_name[a]+"</div>";b+='<div class="clear"></div>';b+="</div>"}}$("foodcontest_collection_flyer").innerHTML=b;$("foodcontest_collection_flyer").addClassName("collection_move");setTimeout(closeCollectionFlyerFoodcontest,3000)}function closeCollectionFlyerFoodcontest(){$("foodcontest_collection_flyer").innerHTML="";$("foodcontest_collection_flyer").removeClassName("collection_move")}function closeFoodcontest(){in_foodcontest=0;hideDiv("transp");if($("farmersmarket_pos6_inner")){hideDiv("farmersmarket_pos6_inner")}}function showFarmersmarketPosTimer(d,a,c){var b="";if(a!=0){if(a>-1){b+='<div class="kp'+a+'" style="float:left; margin:5px;"></div>'}b+='<div style="float:left; margin-top:5px;">'+c+"</div>";b+='<div class="clear"></div>'}$("farmersmarket_pos"+d+"_timer").innerHTML=b}function insertFarmChecker(){var a={};var e={};for(var m in farmersmarket_data.flower_area){var l=farmersmarket_data.flower_area[m];if(l.pid>0&&l.remain<0){a[1]=l.pid}}for(var d=1;d<=3;d++){if(farmersmarket_data.nursery.slots[d]){var l=farmersmarket_data.nursery.slots[d];if(l.pid&&l.remain<0){a[2]=l.pid}}}for(var d=1;d<=5;d++){if(a[d]){var h=0;var c={pid:a[d],farm:99,position:d};for(var b=0;b<farm_checker.length;b++){if(farm_checker[b]&&farm_checker[b].farm==99&&farm_checker[b].position==d){h=1}}if(!h){farm_checker.push(c)}}else{e[d]=1}}var c=[];for(var d=0;d<farm_checker.length;d++){if((e[1]==1&&farm_checker[d].farm==99&&farm_checker[d].position==1)||(e[2]==1&&farm_checker[d].farm==99&&farm_checker[d].position==2)){}else{c.push(farm_checker[d])}}farm_checker=c}var foodworld_products={};var foodworld_quest={};var foodworld_maxquest={};var foodworld_bonus={};function foodworldAction(b,a,m,h,d,e,n){if(!a){a=0}if(!m){m=0}if(!h){h=0}var l="";if(b=="speedup"){l+="&pos="+d+"&slot="+e+"&coins="+n}showGlobalWait(b);var c=createAjaxRequestObj();c.open("GET","ajax/foodworld.php?action="+b+"&id="+a+"&table="+m+"&chair="+h+"&rid="+rid+l,true);c.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");c.onreadystatechange=function(){foodworldActionResponse(c,b,a,m,h)};c.send(null)}function foodworldActionResponse(d,h,m,c,b){var a=_chkRequest(d);if(a!=0){hideGlobalWait();if(h=="speedup"){global_speedup_block=0}if(a[0]==0){globalerrorbox(a[1])}else{farm_checker_open=0;hideDiv("farm_production_checker");foodworld_touch_farmi=-1;$("foodworld_questblock_warning").innerHTML="";hideDiv("foodworld_questblock");hideDiv("foodworld_questblock_bubble");hideDiv("foodworld_questblock_zzz");hideDiv("foodworld_questblock_warning");if(a.quest){foodworld_maxquest=a.maxquest;foodworld_quest=a.quest;if(a.quest.remain>0){gametimer.foodworldquest=1}else{if(!(a.quest.config)){}else{if(parseInt(a.quest.config.level)>parseInt(currentuserlevel)){$("foodworld_questblock_warning").innerHTML=str_replace("%LEVEL%",a.quest.config.level,error1005);$("foodworld_questblock").onclick=new Function();$("foodworld_questblock").onmouseover=new Function("showDiv('foodworld_questblock_warning')");$("foodworld_questblock").onmouseout=new Function("hideDiv('foodworld_questblock_warning')");$("foodworld_questblock").addClassName("foodworld_questblock_wait").removeClassName("foodworld_questblock_work");showDiv("foodworld_questblock")}else{$("foodworld_questblock_bubble").innerHTML="";$("foodworld_questblock").onclick=new Function("setFoodworldDialog('quest')");$("foodworld_questblock").addClassName("foodworld_questblock_work");$("foodworld_questblock").removeClassName("foodworld_questblock_wait");showDiv("foodworld_questblock")}}}if(a.quest.questid>=20){$("foodworld_questblock").removeClassName("position1").addClassName("position2")}}if(a.bonus){foodworld_bonus=a.bonus}if(a.farmicount>5){$("food_minihelp_link").style.background="url("+imgpath+"foodworld/minihelp.gif)"}if(a.levelup&&a.levelup.level){levelupAlert(a.levelup.level,a.levelup.leveltitle)}if(a.farmis){foodworldfarmis=a.farmis;foodworldfarmiscount=a.farmicount||0;createFoodworldFarmis()}if(a.tables){foodworldtables=a.tables;if(h=="cash"){if(a.transfer&&(a.transfer["tip"]||a.transfer["price"]||a.transfer["bonus"]||a.transfer["ktbonus"])){var l="";if(a.transfer["price"]){l=formatPrice(a.transfer["price"])+"<br>"}if(a.transfer["tip"]){l+="+"+formatPrice(a.transfer["tip"])+"<br>"}if(a.transfer["bonus"]){l+="+"+formatPrice(a.transfer["bonus"])+"<br>"}if(a.transfer["ktbonus"]){l+="+"+formatPrice(a.transfer["ktbonus"])}$("foodworldchair"+c+"_"+b+"_tip").innerHTML=l;$("foodworldchair"+c+"_"+b+"_tip").appear({duration:0.1,from:1,to:1});var e=new Effect.Opacity("foodworldchair"+c+"_"+b+"_tip",{duration:5,transition:Effect.Transitions.linear,from:1,to:0})}moveFoodworldFarmi(c,b)}else{createFoodWorldTables()}}if(a.buildings){foodworldbuildings=a.buildings;setFoodworldBuildings()}if(a.speedup){foodworldspeedup=a.speedup}if(h=="foodworld_init"){farm=0;city=0;hideDiv("reallocateanimals_symbol");hideDiv("reallocatebuilding_symbol");train_quicknavi=0;forestry_quicknavi=0;foodworld_quicknavi=1;speedLinks();closeFoodworldBuilding();closeMarket();if(a.showTutorial){showDiv("food_minihelp_content")}if(eventgarden&&$("eventgarden")){eventgarden.close()}if(greenhouse&&$("greenhouse")){greenhouse.close()}if($("questbox")){hideDiv("questboxtransp");hideDiv("questbox")}}if(h=="open"){openFoodworldBuilding(m)}if(h=="crop"||h=="production"||h=="cancel"||h=="buyslot"){openFoodworldBuilding(c)}if(h=="kick"){hideDiv("food_buildinginner_transp");deselectFoodworldFarmiTouch()}if(a.products){foodworld_products=a.products}if($("globaltransp")){hideDiv("globaltransp");hideDiv("globalbox")}showDiv("foodworld");if(h=="questentry"){setFoodworldDialog("quest")}if(a.quest&&a.quest.remain>0){hideDiv("globaltransp");hideDiv("globalbox")}if(h=="foodworld_init"&&m=="questbox"){setFoodworldDialog("quest")}}setTimer("foodworld")}}function foodworldShowProdline(b,a){if(a==1){$("food_prodline"+b).addClassName("active")}else{$("food_prodline"+b).removeClassName("active")}}function foodworldTimer(){$("food_prodline1").innerHTML="";$("food_prodline2").innerHTML="";$("food_prodline3").innerHTML="";$("food_prodline4").innerHTML="";for(var d in foodworldbuildings){if(!foodworldbuildings[d].slots){continue}var c=0;var a={};for(var e in foodworldbuildings[d].slots){if(!foodworldbuildings[d].slots[e].pid){continue}if(foodworldbuildings[d].slots[e].remain&&foodworldbuildings[d].slots[e].remain>0){foodworldbuildings[d].slots[e].remain--;if(!a.pid||a.remain>foodworldbuildings[d].slots[e].remain){a={pid:foodworldbuildings[d].slots[e].pid,remain:foodworldbuildings[d].slots[e].remain}}}else{c=foodworldbuildings[d].slots[e].pid}}var b="";if(c>0){b+='<div class="kp'+c+'" style="float:left; margin:5px;"></div>';b+='<div style="float:left; margin-top:5px;">'+statusProductionComplete+"</div>";b+='<div class="clear"></div>'}else{if(a.pid){b+='<div class="kp'+a.pid+'" style="float:left; margin:5px;"></div>';b+='<div style="float:left; margin-top:5px;">'+formatTime(a.remain)+"</div>";b+='<div class="clear"></div>'}}$("food_prodline"+d).innerHTML=b}}function foodworldQuestTimer(){if($("foodworld_questblock_bubble")&&foodworld_quest){showDiv("foodworld_questblock");foodworld_quest.remain--;if(foodworld_quest.remain>0){showDiv("foodworld_questblock_bubble");showDiv("foodworld_questblock_zzz");$("foodworld_questblock_bubble").innerHTML=formatTime(foodworld_quest.remain);$("foodworld_questblock").onclick=new Function("");$("foodworld_questblock").removeClassName("foodworld_questblock_work");$("foodworld_questblock").addClassName("foodworld_questblock_wait")}else{if(foodworld_quest.config.level>currentuserlevel){$("foodworld_questblock_bubble").innerHTML=str_replace("%LEVEL%",foodworld_quest.config.level,error1005);$("foodworld_questblock").onclick=new Function("");hideDiv("foodworld_questblock")}else{hideDiv("foodworld_questblock_bubble");hideDiv("foodworld_questblock_zzz");$("foodworld_questblock_bubble").innerHTML="";$("foodworld_questblock").onclick=new Function("setFoodworldDialog('quest')");$("foodworld_questblock").removeClassName("foodworld_questblock_wait");$("foodworld_questblock").addClassName("foodworld_questblock_work")}clearTimer("foodworldquest")}}}function closeFoodworld(){for(var b=1;b<=3;b++){foodworldClearTimer("slot"+b);foodworldClearTimer("slot"+b+"_time")}for(var b=0;b<5;b++){foodworldClearTimer("table"+b);for(var a=1;a<=4;a++){foodworldClearTimer("chair"+b+"_"+a)}}hideDiv("foodworld")}function setFoodworldBuildings(){for(var c=1;c<=foodworldpos;c++){hideDiv("food_lock"+c);hideDiv("food_unlock"+c);hideDiv("food_cost"+c);hideDiv("food_update"+c);$("food_pos"+c).onclick=new Function("")}for(var c=1;c<=foodworldpos;c++){hideDiv("food_prod"+c);var h=0;var d=0;for(var b=1;b<=3;b++){if(foodworldbuildings[c]&&foodworldbuildings[c].slots&&foodworldbuildings[c].slots[b]){if(foodworldbuildings[c].slots[b].remain>0){h++}else{if(foodworldbuildings[c].slots[b].remain<1){d++}}if(foodworldbuildings[c].slots[b].ready){d++}}}if(d>0){showDiv("food_prod"+c);$("food_prod"+c).className="food_prod"+c+"_ready"}else{if(h>0){showDiv("food_prod"+c);$("food_prod"+c).className="food_prod"+c+"_"+foodworldbuildings[c]["level"]}}html='<div style="font-weight:bold;">'+foodworldbuildings[c]["name"]+"</div>";html+='<div style="margin-bottom:10px; font-style:italic;">'+foodworldbuildings[c]["desc"]+"</div>";if(foodworldbuildings[c]["level"]>0&&!foodworldbuildings[c]["block"]){var a="";for(var e=1;e<=foodworldbuildings[c]["level"];e++){a+='<img style="width:15px;" src="'+imgpath+'star.png">'}$("food_stars"+c).innerHTML=a}if(foodworldbuildings[c]["block"]==1){showDiv("food_lock"+c);if(foodworldbuildings[c].quest){html+="<div>"+str_replace("%QUEST%",foodworldbuildings[c].quest,t_foodworld_quest_block)+"</div>"}else{html+="<div>"+str_replace("%LEVEL%",foodworldbuildings[c]["level"],minlevel_feature)+"</div>"}}else{if(foodworldbuildings[c]["cost"]>0){showDiv("food_cost"+c);showDiv("food_unlock"+c);$("food_pos"+c).onclick=new Function("buyFoodworldbuilding("+c+")");html+="<div>"+str_replace("%COST%",formatNumber(foodworldbuildings[c]["cost"])+"&nbsp;"+gamecurrency,foodworld_blockcost)+"</div>"}else{$("food_pos"+c).onclick=new Function("foodworldAction('open',"+c+")")}}if(foodworldbuildings[c]["update"]==1){showDiv("food_update"+c);$("food_update"+c+"_tt").innerHTML=infoupdatebuilding;$("food_update"+c).onmouseover=new Function("showDiv('food_update"+c+"_tt'); $('food_update"+c+"').style.backgroundImage = 'url("+imgpath+"buildingupdatebutton_on.png)'");$("food_update"+c).onmouseout=new Function("hideDiv('food_update"+c+"_tt'); $('food_update"+c+"').style.backgroundImage = 'url("+imgpath+"buildingupdatebutton_off.png)'")}if(foodworldbuildings[c]["level"]){$("food_pos"+c).addClassName("food_pos"+c+"_"+foodworldbuildings[c]["level"])}$("food_pos"+c+"_tt").innerHTML=html}}function buyFoodworldbuilding(d){var l="";var h="";if(carpentry_bonus>0){l="*";h='<div class="bonusinfo">'+str_replace("%BONUS%",carpentry_bonus,t_price_add_carpentry)+"</div>"}var a=str_replace("%BUILDING%",foodworldbuildings[d]["name"],foodworld_buybuilding_body);a=str_replace("%COST%",formatPrice(foodworldbuildings[d]["cost"])+l,a);var c=str_replace("%BUILDING%",foodworldbuildings[d]["name"],foodworld_buybuilding_head);var b="<div>"+a+"</div>"+h;var e="foodworldAction('buy',"+d+")";globalcommitbox(c,b,e)}function updateFoodworldbuilding(d){var l="";var h="";if(carpentry_bonus>0){l="*";h='<div class="bonusinfo">'+str_replace("%BONUS%",carpentry_bonus,t_price_add_carpentry)+"</div>"}var a=str_replace("%BUILDING%",foodworldbuildings[d]["name"],foodworld_updatebuilding_body);a=str_replace("%COST%",formatPrice(foodworldbuildings[d]["ucost"])+l,a);a=str_replace("%PERCENT%",foodworldbuildings[d]["ubonus"],a);var c=str_replace("%BUILDING%",foodworldbuildings[d]["name"],foodworld_updatebuilding_head);var b="<div>"+a+"</div>"+h;var e="foodworldAction('update',"+d+")";globalcommitbox(c,b,e)}function openFoodworldBuilding(a){foodworld_bldselect_starter=1;closeFoodworldBuildingSelect();showDiv("food_buildinginner_transp");showDiv("food_buildinginner");$("food_buildinginner").className="foodworld_building_inner"+a+"_"+foodworldbuildings[a]["level"];for(var d=1;d<=3;d++){$("food_slot"+d).className="link food_slot_pos"+a;$("food_slot"+d+"_back").onclick=new Function("openFoodworldBuildingSelect("+a+","+d+")");$("food_slot"+d+"_img").innerHTML="";hideDiv("food_slot"+d+"_block");showDiv("food_slot"+d+"_remain");$("food_slot"+d+"_remain").update(foodworld_start_production);hideDiv("food_slot"+d+"_ready");hideDiv("food_slot"+d+"_time");hideDiv("food_slot"+d+"_cancel");hideDiv("food_slot"+d+"_speedup");$("food_slot"+d+"_cancel").onclick=new Function();$("food_slot"+d+"_speedup").onclick=new Function();foodworldClearTimer("slot"+d);if(foodworldbuildings[a]["slots"][d]){$("food_slot"+d+"_back").className="food_slot_pos"+a+"_back";if(foodworldbuildings[a]["slots"][d]["remain"]>0){$("food_slot"+d+"_back").onclick=new Function();showDiv("food_slot"+d+"_remain");var c=new Array;c.slot=d;c.bld=a;foodworldSetTimer("slot"+d,remainFoodworldSlot,c);showDiv("food_slot"+d+"_cancel");showDiv("food_slot"+d+"_speedup");$("food_slot"+d+"_cancel").onclick=new Function("cancelFoodworldProduction("+a+","+d+")");$("food_slot"+d+"_speedup").onclick=new Function("speedupFoodworldProduction("+a+","+d+")");$("food_slot"+d+"_remain").update(foodworld_productiontime+"<br>"+formatTime(foodworldbuildings[a]["slots"][d]["remain"]))}if(foodworldbuildings[a]["slots"][d]["sremain"]>0){var c=new Array;c.slot=d;c.bld=a;foodworldClearTimer("slot"+d+"_time");foodworldSetTimer("slot"+d+"_time",slotFoodworldTime,c);showDiv("food_slot"+d+"_time");$("food_slot"+d+"_time").setStyle({backgroundImage:"url("+imgpath+"foodworld/prod"+a+"_back.png)"}).update(forestry_slot_time+"&nbsp;"+formatTime(foodworldbuildings[a]["slots"][d]["sremain"]))}if(foodworldbuildings[a]["slots"][d]["ready"]==1){$("food_slot"+d+"_back").onclick=new Function();showDiv("food_slot"+d+"_ready");$("food_slot"+d+"_back").onclick=new Function("foodworldAction('crop',0,"+a+","+d+")");$("food_slot"+d).addClassName("link");showDiv("food_slot"+d+"_remain");$("food_slot"+d+"_remain").innerHTML=foodworld_getproducts;foodworldClearTimer("slot"+d)}if(foodworldbuildings[a]["slots"][d]["pid"]){var e='<div class="kp'+foodworldbuildings[a]["slots"][d]["pid"]+'" style="float:left; width:15px;"></div>';e+='<div style="float:left; width:120px; margin-left:5px; font-weight:bold;">'+foodworldbuildings[a]["slots"][d]["amount"]+"x&nbsp;"+produkt_name[foodworldbuildings[a]["slots"][d]["pid"]];if(specialbonus){var l=specialbonus.findBonus({key1:"foodworld",key2:"harvest"});if(l){e+='<div class="bonus">('+t_incl+" +"+l.harvest+" "+t_specialbonus_foodworld_harvest_info+")</div>"}}e+="</div>";e+='<div style="clear:both;"></div>';$("food_slot"+d+"_img").innerHTML=e;if(foodworldbuildings[a]["slots"][d]["ready"]){$("food_slot"+d).className="food_slot_pos"+a+"_ready"}else{$("food_slot"+d).className="food_slot_pos"+a+"_full"}}if(foodworldbuildings[a]["slots"][d]["block"]==1){$("food_slot"+d+"_back").onclick=new Function();showDiv("food_slot"+d+"_block");$("food_slot"+d+"_back").onclick=new Function("buyFoodworldSlot("+a+","+d+")");$("food_slot"+d).addClassName("link");showDiv("food_slot"+d+"_remain");if(foodworldbuildings[a]["slots"][d]["duration"]>0){var n=foodworldbuildings[a]["slots"][d]["coins"];var l=specialbonus.findBonus({key1:"foodworld",key2:"rentslot"});var h="";var m="";if(l&&l.rentslot){n=Math.ceil(n*(1-l.rentslot));h="color:green; font-weight:bold;";m=specialbonus.htmlBonusLine(l.rentslot,1)}var b=str_replace("%COINS%",'<span style="'+h+'">'+n+"&nbsp;"+t_coins+"</span>",foodworld_rentslot);b=str_replace("%TIME%",formatTime(foodworldbuildings[a]["slots"][d]["duration"]),b);if(m!=""){b+=m}if(specialbonus){var l=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(l&&in_array("foodworld",l.types)){b+='<div id="foodworld_productionslot'+d+'_bonus_star" class="foodworld production_slot bonus_star pulse">';b+='  <div class="inner">';b+='    <div class="percent">'+(l.discount*100)+"%</div>";b+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";b+="  </div>";b+="</div>"}}$("food_slot"+d+"_remain").innerHTML=b}else{$("food_slot"+d+"_remain").innerHTML=str_replace("%MONEY%",formatNumber(foodworldbuildings[a]["slots"][d]["cost"])+"&nbsp;"+gamecurrency,foodworld_buyslot)}}}}}function slotFoodworldTime(e,a){var d=a.slot;var b=a.bld;var c=foodworldbuildings[b]["slots"][d]["sremain"];c--;$("food_slot"+d+"_time").innerHTML=forestry_slot_time+"&nbsp;"+formatTime(c);$("food_slot"+d+"_time").style.backgroundImage="url("+imgpath+"foodworld/prod"+b+"_back.png)";if(c<1){foodworldClearTimer(e);hideDiv("food_slot"+d+"_time");showDiv("food_slot"+d+"_block");hideDiv("food_slot"+d+"_speedup");hideDiv("food_slot"+d+"_cancel");$("food_slot"+d+"_back").onclick=new Function("buyFoodworldSlot("+b+","+d+")")}foodworldbuildings[b]["slots"][d]["sremain"]=c}function remainFoodworldSlot(e,a){var d=a.slot;var b=a.bld;var c=foodworldbuildings[b]["slots"][d]["remain"];$("food_slot"+d+"_remain").innerHTML=foodworld_productiontime+"<br>"+formatTime(c);if(c<1||isNaN(c)){foodworldClearTimer(e);foodworldbuildings[b]["slots"][d]["ready"]=1;foodworldbuildings[b]["slots"][d]["remain"]=0;setFoodworldBuildings();openFoodworldBuilding(b)}foodworldbuildings[b]["slots"][d]["remain"]=c}function cancelFoodworldProduction(d,c){var a="<div>"+foodworld_cancelbody+"</div>";var b="foodworldAction('cancel',0,"+d+","+c+")";globalcommitbox(foodworld_cancelhead,a,b)}function speedupFoodworldProduction(b,a){if(foodworldspeedup[b]){globalSpeedupBox("foodworld",b,a);return false}}function buyFoodworldSlot(a,m){var b=foodworld_buyslot_dialog_head;var e="";if(foodworldbuildings[a]["slots"][m]["cost"]>0){e='<div style="margin-bottom:10px;"><img src="'+imgpath+'money.gif" style="height:12px;">&nbsp;'+formatPrice(foodworldbuildings[a]["slots"][m]["cost"])+"</div>"}e+=str_replace("%MONEY%",formatNumber(foodworldbuildings[a]["slots"][m]["cost"])+"&nbsp;"+gamecurrency,foodworld_buyslot_dialog_body);if(foodworldbuildings[a]["slots"][m]["duration"]>0){var q=foodworldbuildings[a]["slots"][m]["coins"];var l=specialbonus.findBonus({key1:"foodworld",key2:"rentslot"});var h="";var n="";if(l&&l.rentslot){q=Math.ceil(q*(1-l.rentslot));h="color:green; font-weight:bold;";n=specialbonus.htmlBonusLine(l.rentslot,1)}e='<div style="margin-bottom:10px;"><img src="'+imgpath+'menu/coins.gif" style="height:12px;">&nbsp;<span style="'+h+'">'+q+"&nbsp;"+t_coins+"</span></div>";e+=str_replace("%COINS%",'<span style="'+h+'">'+q+"&nbsp;"+t_coins+"</span>",foodworld_rentslot_dialog_body);e=str_replace("%TIME%",formatTime(foodworldbuildings[a]["slots"][m]["duration"]),e);if(n!=""){e+=n}}var d="<div>"+e+"</div>";var c="foodworldAction('buyslot',0,"+a+","+m+")";globalcommitbox(b,d,c)}function openFoodworldBuildingSelect(h,c){var w=((foodworld_bldselect_starter-1)*4)+1;var b=(foodworld_bldselect_starter*4);var l={};var m=0;var e={};if(specialbonus){var A=specialbonus.findBonus({key1:"foodworld",key2:"harvest"});if(A){e.harvest=A.harvest}}html="";html+='<div id="foodworld_selection">';for(var s in foodworldbuildings[h].products){for(var r in foodworldbuildings[h].products[s].out){if(produkt_name[r]){m++;if(m>=w&&m<=b){var n=foodworldbuildings[h].products[s].out[r];if(e.harvest){n+=e.harvest}html+='<div id="foodworld_selection_item'+r+'" class="item link">';html+='  <div class="tt'+r+' img"></div>';html+='  <div class="info">';html+='    <div style="font-weight:bold;">'+n+"x "+produkt_name[r]+"</div>";if(e.harvest){html+='<div class="bonus">('+t_incl+" +"+e.harvest+" "+t_specialbonus_foodworld_harvest_info+")</div>"}html+="    <div>"+formatTime(foodworldbuildings[h].products[s].duration)+"</div>";html+="    <div>"+formatNumber(produkt_points[r]*n)+"&nbsp;"+t_points+"</div>";html+="  </div>";html+='  <div class="clear"></div>';html+='  <div class="needs">';html+='    <div style="margin-bottom:2px; text-align:left;">'+t_needs+":&nbsp;</div>";html+='    <div class="clear"></div>';for(var v in foodworldbuildings[h].products[s]["in"]){if(produkt_name[v]){var d="";if(checkRackItem(v)<foodworldbuildings[h].products[s]["in"][v]){d="important";l[r]=1}html+='<div style="position:relative; float:left; margin-right:5px;" onmouseover="showDiv(\'foodworld_selection'+r+"_"+v+"_tt')\" onmouseout=\"hideDiv('foodworld_selection"+r+"_"+v+"_tt')\">";html+='  <div class="l'+v+'" style="border-radius:5px;"></div>';html+='  <div class="'+d+' amount">'+foodworldbuildings[h].products[s]["in"][v]+"x</div>";html+='  <div id="foodworld_selection'+r+"_"+v+'_tt" class="ttbox">'+produkt_name[v]+"</div>";html+="</div>"}}html+='    <div class="clear"></div>';html+="  </div>";html+='  <div class="stars" onmouseover="showDiv(\'foodworld_selection_stars'+r+"_"+v+"_tt')\" onmouseout=\"hideDiv('foodworld_selection_stars"+r+"_"+v+"_tt')\">";for(var z=1;z<=5;z++){var q="off";if(foodworldbuildings[h].products[s].star&&foodworldbuildings[h].products[s].star>=z){q=""}html+='<div class="foodworld_star '+q+'" style="float:left;"></div>'}html+='<div class="clear"></div>';if(foodworldbuildings[h].products[s].star==5){var a=formatNumber(foodworldbuildings[h].products[s].starcurrent)}else{if(!foodworldbuildings[h].products[s].starcurrent){var t=0}else{var t=foodworldbuildings[h].products[s].starcurrent}var a=formatNumber(t)+"/"+formatNumber(foodworldbuildings[h].products[s].starremain)}html+='    <div class="ttbox" id="foodworld_selection_stars'+r+"_"+v+'_tt">'+a+"</div>";html+="  </div>";html+="</div>"}}}}html+='  <div id="foodworld_selection_navi_top" class="link" onclick="foodworldSelectionNavi(-1, '+m+", "+h+", "+c+')"></div>';html+='  <div id="foodworld_selection_navi_down" class="link" onclick="foodworldSelectionNavi(1, '+m+", "+h+", "+c+')"></div>';html+="</div>";globalBoxFlex(t_foodworld_selection_head,html,0,0,1);for(var s in foodworldbuildings[h].products){for(var r in foodworldbuildings[h].products[s].out){if($("foodworld_selection_item"+r)){var u="foodworldAction('production', "+s+", "+h+", "+c+")";if(l[r]){u=""}$("foodworld_selection_item"+r).onclick=new Function(u)}}}}function foodworldSelectionNavi(b,c,e,d){var a=Math.ceil(c/4);foodworld_bldselect_starter+=b;if(foodworld_bldselect_starter<1){foodworld_bldselect_starter=1}if(foodworld_bldselect_starter>=a){foodworld_bldselect_starter=a}openFoodworldBuildingSelect(e,d);showDiv("foodworld_selection_navi_top");showDiv("foodworld_selection_navi_down");if(foodworld_bldselect_starter==1){hideDiv("foodworld_selection_navi_top")}if(foodworld_bldselect_starter==a){hideDiv("foodworld_selection_navi_down")}}function closeFoodworldBuildingSelect(){hideDiv("food_buildinginner_select");hideDiv("food_buildinginner_select_transp")}function closeFoodworldBuilding(){hideDiv("food_buildinginner_transp");hideDiv("food_buildinginner")}var chairsize=2;function createFoodWorldTables(){var c="";for(var b=0;b<5;b++){c+='<div class="foodworldtable'+b+'" id="foodworldtable'+b+'">';c+='  <div class="blackbox" id="foodworldtable'+b+'_tt"></div>';c+='  <div class="blackbox" id="foodworldtable'+b+'_remain"></div>';c+="</div>";c+='<div class="foodworldchairs'+b+'">';for(var a=1;a<=chairsize;a++){c+='<div class="foodworldchair'+a+'" id="foodworldchair'+b+"_"+a+'">';c+=' <div id="foodworldchair'+b+"_"+a+'_remain" class="blackbox" style="display:none; position:absolute; top:-20px; left:-20px;"></div>';c+=' <div class="foodworldchair_ready link" id="foodworldchair'+b+"_"+a+"_ready\" onclick=\"foodworldAction('cash',0,"+b+","+a+');"></div>';c+=' <div class="foodworldchair_touch" id="foodworldchair'+b+"_"+a+'_touch" onclick="dropFoodworldFarmiTouch('+b+","+a+');"></div>';c+=' <div class="foodworldchair_tip" id="foodworldchair'+b+"_"+a+'_tip"></div>';c+="</div>"}c+="</div>"}$("food_tables").innerHTML=c;updateFoodWorldTables()}function updateFoodWorldTables(){for(var d=0;d<5;d++){if(!foodworldtables[d]["locked"]){showDiv("foodworldtable"+d);hideDiv("foodworldtable"+d+"_remain");$("foodworldtable"+d).removeClassName("foodworldtable"+d+"_ready");$("foodworldtable"+d+"_remain").innerHTML="";$("foodworldtable"+d).removeClassName("link");for(var a=1;a<=chairsize;a++){if($("foodworldchair"+d+"_"+a)){Droppables.remove("foodworldchair"+d+"_"+a)}}for(var a=1;a<=chairsize;a++){showDiv("foodworldchair"+d+"_"+a);hideDiv("foodworldchair"+d+"_"+a+"_ready");$("foodworldchair"+d+"_"+a+"_ready").onmouseover=new Function("");$("foodworldchair"+d+"_"+a+"_ready").onmouseout=new Function("");$("foodworldchair"+d+"_"+a).className="foodworldchair"+a;$("foodworldchair"+d+"_"+a).onmouseover=new Function("");$("foodworldchair"+d+"_"+a).onmouseout=new Function("");if(!foodworldtables[d]["chairs"][a]["id"]&&!foodworldtables[d]["block"]){Droppables.add("foodworldchair"+d+"_"+a,{accept:"foodworldfarmi",hoverclass:"foodworldchairhover",onDrop:droppedFoodworldFarmi})}else{if(foodworldtables[d]["chairs"][a]["remain"]>0){$("foodworldchair"+d+"_"+a).onmouseover=new Function("showDiv('foodworldchair"+d+"_"+a+"_remain')");$("foodworldchair"+d+"_"+a).onmouseout=new Function("hideDiv('foodworldchair"+d+"_"+a+"_remain')");var m=foodworldtables[d]["chairs"][a]["id"];for(var l=0;l<foodworldfarmis.length;l++){if(foodworldfarmis[l]["id"]==m){$("foodworldchair"+d+"_"+a).className="foodworldchair"+a+" food_farmi"+foodworldfarmis[l]["img"]+"_2_"+a;break}}var h=new Array;h.i=d;h.j=a;foodworldSetTimer("chair"+d+"_"+a,remainFoodworldChair,h)}if(foodworldtables[d]["chairs"][a]["ready"]==1){var m=foodworldtables[d]["chairs"][a]["id"];for(var l=0;l<foodworldfarmis.length;l++){if(foodworldfarmis[l]["id"]==m){showDiv("foodworldchair"+d+"_"+a+"_ready");var c='<div style="display:none; white-space:nowrap; position:absolute; bottom:35px; left:-20px;" class="blackbox" id="foodworldchair'+d+"_"+a+'_ready_tt">';c+="  <div>"+formatPrice(foodworldfarmis[l]["price"])+"</div>";if(foodworld_bonus.bonus){questbonus=Math.ceil(foodworldfarmis[l]["price"]*(foodworld_bonus.bonus/100));c+='<div style="color:green;">+'+formatPrice(questbonus)+"&nbsp;"+t_foodworld_quest_bonus+"</div>"}if(specialbonus){var b=specialbonus.findBonus({key1:"foodworld",key2:"farmis"});if(b){var e=(foodworldfarmis[l]["price"]*b.farmis);c+='<div style="color:green;">+'+formatPrice(e)+"&nbsp;"+t_specialbonus_money_bonus+"</div>"}var b=specialbonus.findBonus({key1:"consumer",key2:"money"});if(b&&in_array("picnic",b.types)){var e=(foodworldfarmis[l]["price"]*b.money);c+='<div style="color:green;">+'+formatPrice(e)+"&nbsp;"+t_specialbonus_money_bonus+"</div>"}}c+="</div>";$("foodworldchair"+d+"_"+a+"_ready").innerHTML=c;$("foodworldchair"+d+"_"+a+"_ready").className="food_farmi"+foodworldfarmis[l]["img"]+"_4_"+a;$("foodworldchair"+d+"_"+a+"_ready").onmouseover=new Function("showDiv('foodworldchair"+d+"_"+a+"_ready_tt')");$("foodworldchair"+d+"_"+a+"_ready").onmouseout=new Function("hideDiv('foodworldchair"+d+"_"+a+"_ready_tt')");break}}}}}if(foodworldtables[d]["block"]==1){$("foodworldtable"+d).onmouseover=new Function("showDiv('foodworldtable"+d+"_tt')");$("foodworldtable"+d).onmouseout=new Function("hideDiv('foodworldtable"+d+"_tt')");$("foodworldtable"+d).onclick=new Function("buyFoodworldTable("+d+")");var c="";if(foodworldtables[d]["cost"]){c+="<div>"+foodworld_buy+"</div>"}if(foodworldtables[d]["coins"]){c+="<div>"+foodworld_rent+"</div>"}$("foodworldtable"+d+"_tt").innerHTML=c;$("foodworldtable"+d).addClassName("link")}else{$("foodworldtable"+d).addClassName("foodworldtable"+d+"_ready")}if(foodworldtables[d]["remain"]){$("foodworldtable"+d).onmouseover=new Function("showDiv('foodworldtable"+d+"_remain')");$("foodworldtable"+d).onmouseout=new Function("hideDiv('foodworldtable"+d+"_remain')");var h=new Array;h.i=d;foodworldSetTimer("table"+d,remainFoodworldTable,h)}}else{hideDiv("foodworldtable"+d);for(var a=1;a<=chairsize;a++){hideDiv("foodworldchair"+d+"_"+a)}}}}function buyFoodworldTable(c){var a=foodworld_buytable_head;var e=str_replace("%COST%",formatNumber(foodworldtables[c]["cost"])+"&nbsp;"+gamecurrency,foodworld_buytable_body);if(foodworldtables[c]["coins"]>0){var n=foodworldtables[c]["coins"];var h="";var m="";var l=specialbonus.findBonus({key1:"foodworld",key2:"renttable"});if(l&&l.renttable){n=(n*(1-l.renttable));h="color:green; font-weight:bold;";m=specialbonus.htmlBonusLine(l.renttable,1)}a=foodworld_renttable_head;e=str_replace("%COINS%",'<span style="'+h+'">'+n+"&nbsp;"+t_coins+"</span>",foodworld_renttable_body);e=str_replace("%TIME%",formatTime(foodworldtables[c]["duration"]),e);if(m!=""){e+=m}}var d="<div>"+e+"</div>";var b="foodworldAction('buytable',"+foodworldtables[c]["id"]+")";globalcommitbox(a,d,b)}function remainFoodworldTable(d,b){var a=b.i;var c=foodworldtables[a]["remain"];c--;$("foodworldtable"+a+"_remain").innerHTML=formatTime(c);if(c<1){foodworldClearTimer(d);foodworldtables[a]["block"]=1;delete foodworldtables[a]["remain"];updateFoodWorldTables()}foodworldtables[a]["remain"]=c}function remainFoodworldChair(h,c){var b=c.i;var a=c.j;var e=foodworldtables[b]["chairs"][a]["remain"];e--;$("foodworldchair"+b+"_"+a+"_remain").innerHTML=formatTime(e);for(var d=0;d<foodworldfarmis.length;d++){if(foodworldfarmis[d]["id"]==foodworldtables[b]["chairs"][a]["id"]){$("foodworldchair"+b+"_"+a).className="foodworldchair"+a+" food_farmi"+foodworldfarmis[d]["img"]+"_2_"+a;break}}if(e<1){foodworldClearTimer(h);delete foodworldtables[b]["chairs"][a]["remain"];foodworldtables[b]["chairs"][a]["ready"]=1;$("foodworldchair"+b+"_"+a).className="foodworldchair"+a;updateFoodWorldTables()}foodworldtables[c.i]["chairs"][c.j]["remain"]=e}function createFoodworldFarmis(){hideDiv("food_cart");if(foodworldfarmis.length>0){var e="";for(var d=0;d<foodworldfarmis.length;d++){if(foodworldfarmis[d]&&foodworldfarmis[d]["status"]==0){e+='<div id="foodworldfarmi'+d+'" class="link foodworldfarmi food_farmi'+foodworldfarmis[d]["img"]+'_1" onmouseover="showDiv(\'foodworldfarmi'+d+"tt');\" onmouseout=\"hideDiv('foodworldfarmi"+d+'tt\');" onclick="showFoodworldFarmiCart('+d+')">';e+='  <div class="foodworldfarmi_tt" id="foodworldfarmi'+d+'tt">';e+='  <div style="border-bottom:1px solid #000; padding:0px 0 5px; margin-bottom:5px;">';for(var b in foodworldfarmis[d]["products"]){e+='<div style="float:left; width:15px;" class="kp'+b+'"></div>';var a="";if(checkRackItem(b)<foodworldfarmis[d]["products"][b]){a="important"}e+='<div style="float:left; margin-left:5px; width:180px;" class="'+a+'">'+foodworldfarmis[d]["products"][b]+"x&nbsp;"+produkt_name[b]+"</div>";e+='<div style="clear:both;"></div>'}e+="    </div>";e+='    <div style="border-bottom:1px solid #000; padding:0px 0 5px; margin-bottom:5px;">'+formatTime(foodworldfarmis[d]["duration"])+"</div>";e+='    <div class="big">'+formatPrice(foodworldfarmis[d]["price"])+"</div>";if(foodworld_bonus.bonus){questbonus=Math.ceil(foodworldfarmis[d]["price"]*(foodworld_bonus.bonus/100));e+='<div style="font-weight:bold; color:green;">+'+formatPrice(questbonus)+"&nbsp;"+t_foodworld_quest_bonus+"</div>"}if(specialbonus){var c=specialbonus.findBonus({key1:"foodworld",key2:"farmis"});if(c){var h=foodworldfarmis[d]["price"]*c.farmis;e+='<div style="font-weight:bold; color:green;">+'+formatPrice(h)+"&nbsp;"+t_specialbonus_money_bonus+"</div>"}var c=specialbonus.findBonus({key1:"consumer",key2:"money"});if(c&&in_array("picnic",c.types)){var h=foodworldfarmis[d]["price"]*c.money;e+='<div style="font-weight:bold; color:green;">+'+formatPrice(h)+"&nbsp;"+t_specialbonus_money_bonus+"</div>"}}e+='    <div class="foodworld_farmi_bubble_zipfel"></div>';e+="  </div>";e+="</div>"}}e+='<div class="clear"></div>';$("food_farmis").innerHTML=e}else{$("food_farmis").innerHTML=""}}function showFoodworldFarmiCart(a){var e=-1;var r=-1;for(var q=0;q<foodworldfarmis.length;q++){if(q<a&&foodworldfarmis[q]["status"]=="0"){e=q}else{if(q>a&&foodworldfarmis[q]["status"]=="0"&&r==-1){r=q}}}if(e>-1){showDiv("food_cart_pre");$("food_cart_pre").onclick=new Function("showFoodworldFarmiCart("+e+")")}else{hideDiv("food_cart_pre")}if(r>-1){showDiv("food_cart_next");$("food_cart_next").onclick=new Function("showFoodworldFarmiCart("+r+")")}else{hideDiv("food_cart_next")}if(foodworldfarmis[a]){foodworld_touch_farmi=a;var s="";var d=0;for(var t in foodworldfarmis[a]["products"]){s+='<div style="margin-bottom:4px;">';s+='  <div style="float:left; width:15px;" class="kp'+t+'"></div>';var l="";var w="";if(checkRackItem(t)<foodworldfarmis[a]["products"][t]){w="link important";var h=1;for(var b in foodworld_products){for(var c in foodworld_products[b].out){if(c==t){h=foodworld_products[b].pos}}}l="onclick=\"foodworldAction('open',"+h+')"';d=1}s+='  <div style="float:left; margin-left:5px; width:250px; font-size:16px; font-weight:bold;" class="'+w+'" '+l+">"+foodworldfarmis[a]["products"][t]+"x&nbsp;"+produkt_name[t]+"</div>";s+='  <div style="clear:both;"></div>';s+="</div>"}$("food_cart_products").innerHTML=s;showDiv("food_buildinginner_transp");showDiv("food_cart");if(!d){showDiv("food_cart_button_set");$("food_cart_button_set").onclick=new Function("dragFoodworldFarmiTouch("+a+"); closeFoodworldFarmiCart();")}else{hideDiv("food_cart_button_set")}$("food_cart_button_kick").onclick=new Function("foodworldAction('kick',"+foodworldfarmis[a]["id"]+")");var z="";if(foodworld_bonus.bonus){questbonus=Math.ceil(foodworldfarmis[a]["price"]*(foodworld_bonus.bonus/100));z+='<div style="font-size:11px;">+'+formatPrice(questbonus)+"&nbsp;"+t_foodworld_quest_bonus+"</div>"}var u="";if(specialbonus){var v=specialbonus.findBonus({key1:"foodworld",key2:"farmis"});if(v){price=foodworldfarmis[a]["price"]*v.farmis;u+='<div style="font-size:11px;">+'+formatPrice(price)+"&nbsp;"+t_specialbonus_money_bonus+"</div>"}var v=specialbonus.findBonus({key1:"consumer",key2:"money"});if(v&&in_array("picnic",v.types)){price=foodworldfarmis[a]["price"]*v.money;u+='<div style="font-size:11px;">+'+formatPrice(price)+"&nbsp;"+t_specialbonus_money_bonus+"</div>"}}$("food_cart_sum").innerHTML=formatPrice(foodworldfarmis[a]["price"])+z+u;$("food_cart_time").innerHTML=formatTime(foodworldfarmis[a]["duration"])}}function closeFoodworldFarmiCart(){hideDiv("food_cart");hideDiv("food_buildinginner_transp")}function showPossibleChairs(){for(var b=0;b<5;b++){for(var a=1;a<=chairsize;a++){if(!foodworldtables[b]["block"]&&!foodworldtables[b]["chairs"][a]["remain"]&&!foodworldtables[b]["chairs"][a]["ready"]){$("foodworldchair"+b+"_"+a).addClassName("foodworldchairover")}}}}function hidePossibleChairs(){for(var b=0;b<5;b++){for(var a=1;a<=chairsize;a++){$("foodworldchair"+b+"_"+a).removeClassName("foodworldchairover")}}}function droppedFoodworldFarmi(b,l){var d=str_replace("foodworldfarmi","",b.id);var h=foodworldfarmis[d]["id"];var c=str_replace("foodworldchair","",l.id);var e=c.substring(0,1);var a=c.substring(2,3);foodworldAction("dropped",h,e,a)}function moveFoodworldFarmi(d,b){var c=0;var a=0;if((d==0&&b==1)||(d==2&&b==1)||(d==3&&b==1)){a=-400}if((d==0&&b==2)||(d==1&&b==1)){c=-400}if((d==1&&b==2)||(d==2&&b==2)){a=400}if((d==3&&b==2)){c=400}if((d==0&&b==1)||(d==2&&b==1)||(d==3&&b==1)){o=1}if((d==1&&b==1)||(d==0&&b==2)){o=4}if((d==1&&b==2)||(d==2&&b==2)){o=3}if((d==3&&b==2)){o=4}$("foodworldchair"+d+"_"+b+"_ready").className=str_replace("_4_"+b,"_3_"+o,$("foodworldchair"+d+"_"+b+"_ready").className);new Effect.Move("foodworldchair"+d+"_"+b+"_ready",{x:c,y:a,duration:getRandom(3,6),transition:Effect.Transitions.linear,mode:"relative",afterFinish:function(){hideDiv("foodworldchair"+d+"_"+b+"_ready");Droppables.add("foodworldchair"+d+"_"+b,{accept:"foodworldfarmi",hoverclass:"foodworldchairhover",onDrop:droppedFoodworldFarmi});createFoodWorldTables()}})}function dragFoodworldFarmiTouch(b){deselectFoodworldFarmiTouch();foodworld_touch_farmi=b;$("foodworldfarmi"+b).addClassName("foodworldselectfarmitouch");for(var b=0;b<5;b++){for(var a=1;a<=4;a++){if(!foodworldtables[b]["block"]&&!foodworldtables[b]["chairs"][a]["id"]){showDiv("foodworldchair"+b+"_"+a+"_touch")}}}if(parseInt(foodworldfarmiscount,10)<10){$("foodworld_placeseat_tutorial").setStyle({display:"block"})}}function dropFoodworldFarmiTouch(b,a){$("foodworld_placeseat_tutorial").hide();var c=foodworldfarmis[foodworld_touch_farmi]["id"];foodworldAction("dropped",c,b,a)}function deselectFoodworldFarmiTouch(){$("foodworld_placeseat_tutorial").hide();foodworld_touch_farmi=-1;for(var b=0;b<foodworldfarmis.length;b++){if($("foodworldfarmi"+b)){$("foodworldfarmi"+b).removeClassName("foodworldselectfarmitouch")}}for(var b=0;b<5;b++){for(var a=1;a<=4;a++){hideDiv("foodworldchair"+b+"_"+a+"_touch")}}}function setFoodworldDialog(q,n){var l="";var t="";if(q=="quest"){for(var h=0;h<foodworld_quest.config["in"].length;h++){var n=foodworld_quest.config["in"][h][0];var m=foodworld_quest.config["in"][h][1];var c=0;if(foodworld_quest.entries[n]){c=foodworld_quest.entries[n]}var r="";var u="setFoodworldDialog('questentry', "+n+")";var s=checkRackItem(n);if(!s){r="important";u=""}if(c==m){u=""}var a=(Math.ceil(c*100/m))+8;l+='<div class="foodworld_questbar_line">';l+='  <div class="kp'+n+' foodworld_questbar_icon"></div>';l+='  <div class="foodworld_questbar link" onclick="'+u+'" onmouseover="showDiv(\'foodworld_questbar_tt'+foodworld_quest.questid+"_"+n+"')\" onmouseout=\"hideDiv('foodworld_questbar_tt"+foodworld_quest.questid+"_"+n+"')\">";l+='    <div class="foodworld_questbar_inner" style="width:'+a+'px"></div>';l+="  </div>";l+='  <div class="foodworld_questbar_amount '+r+'">'+c+"/"+m+"</div>";if(r!=""){l+='<div class="clear"></div><div class="important" style="text-align:left; margin-left:20px;">'+product_notavailable_info+"</div>"}if(c<m&&s>0){l+='  <button type="button" class="foodworld_questbar_button button_new link" onclick="'+u+'">'+t_inner_feedsubmit+"</button>"}l+='  <div class="clear"></div>';l+='  <div class="foodworld_questbar_tt ttbox" id="foodworld_questbar_tt'+foodworld_quest.questid+"_"+n+'">'+produkt_name[n]+"</div>";l+="</div>"}if(foodworld_quest.config.reward){l+='<div style="margin-top:10px;">'+windmill_out+"</div>";if(foodworld_quest.config.reward.points){l+='<div style="margin-top:5px;">'+foodworld_quest.config.reward.points+"&nbsp;"+t_points+"</div>"}if(foodworld_quest.config.reward.building){l+='<div style="margin-top:5px;">'+foodworld_quest.config.reward.building+"</div>"}if(foodworld_quest.config.reward.bonus){l+='<div style="margin-top:5px;">'+str_replace("%PERCENT%",foodworld_quest.config.reward.bonus,t_foodworld_reward_bonus)+"</div>"}}if(foodworld_quest.nextbuilding){for(var h in foodworld_quest.nextbuilding){if(foodworld_quest.nextbuilding[h]>0){var e=str_replace("%COUNT%",foodworld_quest.nextbuilding[h],t_quest_foodworld_nextbuilding);e=str_replace("%BUILDING%",h,e);l+='<div style="margin-top:5px;">'+e+"</div>"}}}t=t_quest_foodworld+"&nbsp"+foodworld_quest.questid+" / "+foodworld_maxquest;globalBox(t,l,0,0,0,1)}if(q=="questentry"){for(var h=0;h<foodworld_quest.config["in"].length;h++){if(n==foodworld_quest.config["in"][h][0]){var m=0;if(foodworld_quest.entries[n]){m=foodworld_quest.entries[n]}var b=(foodworld_quest.config["in"][h][1]-m);var d={pid:n};globalcommitbox(t_foodworld_questbox_entry_head,htmlEntryLine(d),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("chkfoodworldQuestEntry("+n+", "+b+")");$("dialog_entryline_number").onkeyup=new Function("chkfoodworldQuestEntry("+n+", "+b+")");chkfoodworldQuestEntry(n,b);break}}}}function chkfoodworldQuestEntry(a,b){var c={stockamount:checkRackItem(a),rest:b,click:"foodworldQuestEntry("+a+")"};checkEntryLine(c)}function foodworldQuestEntry(a){if(!$("dialog_entryline_number").value){return false}var b=$("dialog_entryline_number").value;foodworldAction("questentry",a,b)}function foodworldSetTimer(a,c,b){if(!ftimer[a]){if(typeof c=="function"){ftimer[a]=window.setInterval(function(){c(a,b)},1000)}}}function foodworldClearTimer(a){if(ftimer[a]){window.clearInterval(ftimer[a]);ftimer[a]=0;if(fremains[a]){fremains[a]=0}}}function foodworldShowHelp(){showDiv("food_minihelp_content")}function forestryAutoplant(){var c='<div style="margin-bottom:10px;">'+t_forestry_autoplantinfo+"</div>";c+="<select id='forestry_autoplant_pid'>";for(var a in forestry_stock[1]){c+="<option value='"+a+"'>"+produkt_name_forestry[a]+"</option>"}c+="</select>";var b="forestryAjaxAction('autoplant')";globalcommitbox(t_forestry_autoplantheadline,c,b);if($("globalbox_char")){$("globalbox_char").className="globalbox_plantbot";hideDiv("globalbox_charani")}}function openForestryTutorial(a){if(!a){a=1}hideDiv("forestry_questlist_container");$("forestry_tutorial_headline").innerHTML=forestry_tutorial_head[a];var b="";b+='<div id="forestry_tutorial_img'+a+'"></div>';b+=forestry_tutorial_content[a];$("forestry_tutorial_content").innerHTML=b;showDiv("forestry_productiondialog_transp");showDiv("forestry_tutorial_container")}function closeForestryTutorial(){hideDiv("forestry_productiondialog_transp");hideDiv("forestry_tutorial_container")}function forestryUpdate(){var c=new Array();for(var b=1;b<=forestry_maxpos;b++){if(forestry_cache_area[b]){for(var a=0;a<forestry_area.length;a++){if(forestry_area[a]){if(forestry_area[a]["position"]==b){var c=forestry_area[a];var d=a;break}}}if(!c.category){forestryEmptyZone(b)}else{if(c.category==0||c.block>0){forestryWeedZone(d)}else{forestryProductZone(d)}}}}}function forestryEmptyZone(a){if(forestry_area_run[a]){window.clearInterval(forestry_area_run[a]);forestry_area_run[a]=0;forestry_area_time[a]=0;forestry_area_pid[a]=0}$("forestry_pos"+a).onclick=new Function("forestryPosOption(1,"+a+")");$("forestry_pos"+a).onmouseover=new Function("forestrySetStatus("+a+",1)");$("forestry_pos"+a).onmouseout=new Function("forestrySetStatus("+a+",0)");$("forestry_pos"+a).className="forestry_pos link";hideDiv("forestry_pos_block"+a);hideDiv("forestry_pos_info"+a);hideDiv("forestry_pos_load"+a);hideDiv("forestry_pos_water"+a)}function forestryWeedZone(a){if(forestry_area[a]){var c=" forestry_forest_weedblock1";if(forestry_area[a]["block"]>0){$("forestry_pos"+forestry_area[a]["position"]).className+=" tree"+forestry_area[a]["productid"]+"_3";$("forestry_pos_block"+forestry_area[a]["position"]).style.background="url("+imgpath+"forestry/blocker"+forestry_area[a]["block"]+".gif)";$("forestry_pos_info"+forestry_area[a]["position"]).innerHTML=forestry_quests_blockerinfo;showDiv("forestry_pos_block"+forestry_area[a]["position"])}if(forestry_area[a]["category"]==0){$("forestry_pos"+forestry_area[a]["position"]).className+=" tree"+forestry_area[a]["productid"];$("forestry_pos_info"+forestry_area[a]["position"]).innerHTML=forestry_quests_weedinfo}var d="";if(forestry_area[a]["block"]>0){d="<div class='headline'>"+forestry_remove_blocker+"</div>"}d+="<div style='float:left'>"+cityadcost+"</div>";if(forestry_area[a]["block"]>0){d+="<div style='float:left' class='kp"+forestry_area[a]["blockproduct"][0]+"'></div>";d+="<div style='float:left'>&nbsp;"+forestry_area[a]["blockproduct"][1]+"x "+produkt_name[forestry_area[a]["blockproduct"][0]]+"</div>"}else{d+="<div style='float:left'><img src='"+imgpath+"money.gif' border='0' width='14px'></div>";d+="<div style='float:left'>&nbsp;"+forestry_area[a]["cost"]+"</div>"}d+="<div class='clear'></div>";var b="forestryAjaxAction('deleteweed',"+forestry_area[a]["position"]+")";if(forestry_area[a]["block"]>0&&(checkRackItem(forestry_area[a]["blockproduct"][0])<forestry_area[a]["blockproduct"][1])){d+="<div class='important' style='margin-top:10px;'>"+product_notavailable_info+"</div>";b=0}$("forestry_pos"+forestry_area[a]["position"]).onclick=new Function('globalcommitbox("'+removeweedheadline+'","'+d+'","'+b+'")');$("forestry_pos"+forestry_area[a]["position"]).onmouseover=new Function("forestrySetStatus("+forestry_area[a]["position"]+",1,1); showDiv('forestry_pos_info"+forestry_area[a]["position"]+"')");$("forestry_pos"+forestry_area[a]["position"]).onmouseout=new Function("forestrySetStatus("+forestry_area[a]["position"]+",0,1); hideDiv('forestry_pos_info"+forestry_area[a]["position"]+"')")}}function forestryProductZone(a){if(forestry_area[a]){var b=forestry_area[a];forestryEmptyZone(b.position);$("forestry_pos"+b.position).onclick=new Function("forestryChkReady("+b.position+","+b.productid+")");$("forestry_pos"+b.position).onmouseover=new Function("forestrySetStatus("+b.position+",1,1); showDiv('forestry_pos_info"+b.position+"')");$("forestry_pos"+b.position).onmouseout=new Function("forestrySetStatus("+b.position+",0,1); hideDiv('forestry_pos_info"+b.position+"')");forestry_area_time[b.position]=b.remain;forestry_area_run[b.position]=window.setInterval("forestryAreaRun("+b.position+")",1000);forestry_area_watertime[b.position]=b.waterremain;forestry_area_pid[b.position]=b.productid;forestry_area_name[b.position]=b.name;forestryAreaRun(b.position)}}function forestrySetStatus(a,c,d){if($("forestry_pos"+a)){$("forestry_pos_status"+a).className=str_replace(" forestry_forest_crop","",$("forestry_pos_status"+a).className);$("forestry_pos_status"+a).className=str_replace(" forestry_forest_empty","",$("forestry_pos_status"+a).className);$("forestry_pos_status"+a).className=str_replace(" forestry_forest_plant","",$("forestry_pos_status"+a).className);if(d==1){var b=" forestry_forest_crop"}else{if(forestry_plant==0){var b=" forestry_forest_empty"}else{var b=" forestry_forest_plant"}}if(c==1){$("forestry_pos_status"+a).className+=b}else{$("forestry_pos_status"+a).className=str_replace(b,"",$("forestry_pos_status"+a).className)}}}function initForestry(c){temp_reachlimit=new Array();killGardenTimeruns();time=new Array();run=new Array();if(guildquestrun){window.clearInterval(guildquestrun)}guildquestrun=0;guildquesttime=0;if(eventgarden&&$("eventgarden")){eventgarden.close()}if(greenhouse&&$("greenhouse")){greenhouse.close()}hideDiv("questboxtransp");hideDiv("questbox");closeFoodworld();for(var b=1;b<=4;b++){for(var a=1;a<=100;a++){if(forestry_questdelay_run[b+"_"+a]){window.clearInterval(forestry_questdelay_run[b+"_"+a]);forestry_questdelay_run[b+"_"+a]=0;forestry_questdelay_time[b+"_"+a]=0}}}if(premium==1){$("forestry_forest_button2").onclick=new Function("forestryAjaxAction('cropall')");if($("forestry_forest_button6")){$("forestry_forest_button6").onclick=new Function("forestryAutoplant()")}hideDiv("forestry_forest_button2_premium");if($("forestry_forest_button6_premium")){hideDiv("forestry_forest_button6_premium")}$("forestry_forest_button2_info").innerHTML=forestry_forestbutton2;if($("forestry_forest_button6_info")){$("forestry_forest_button6_info").innerHTML=forestry_forestbutton6}}else{$("forestry_forest_button2").onclick=new Function();if($("forestry_forest_button6")){$("forestry_forest_button6").onclick=new Function()}$("forestry_forest_button2_info").innerHTML=forestry_forestbutton2+"<br><br><div class='important'>"+inforequirepremium+"</div>";if($("forestry_forest_button6_premium")){$("forestry_forest_button6_info").innerHTML=forestry_forestbutton6+"<br><br><div class='important'>"+inforequirepremium+"</div>"}showDiv("forestry_forest_button2_premium");if($("forestry_forest_button6_info")){showDiv("forestry_forest_button6_premium")}}forestryAjaxAction("initforestry")}var forestry_achievements=[];function initForestryResponse(b,a,H,u,Q){var B=_chkRequest(b);if(B!=0){hideGlobalWait();if(a=="updatebuilding"){updatebuilding_block=0}if(a=="speedup"||a=="fertilize"){global_speedup_block=0}if(B[0]==0){globalerrorbox(B[1]);for(var Y=1;Y<=forestry_maxpos;Y++){hideDiv("forestry_pos_load"+Y)}}else{farm=0;city=0;hideDiv("reallocateanimals_symbol");hideDiv("reallocatebuilding_symbol");forestryClearAllTimer();closeMarket();closeForestryProductionBox();if(u>0){openForestryTutorial(u)}forestry_production_products=B[4];forestry_slots=B[11];closeForestrySelection();forestry_achievements=B[15];forestry_slot_config=B[16];$("forestry_waterbonus_info").innerHTML=str_replace("%PERCENT%",B[12],$("forestry_waterbonus_info").innerHTML);if(B[13]&&B[13].level){levelupAlert(B[13].level,B[13].leveltitle)}var M=B[1];forestry_area=M;if(B[7]==0){forestryUpdate()}else{for(var Y=1;Y<=forestry_maxpos;Y++){forestryEmptyZone(Y)}for(var Y=0;Y<M.length;Y++){if(M[Y]){var H=M[Y];if(H.category==0||H.block>0){forestryWeedZone(Y)}else{forestryProductZone(Y)}}}}if(B[9]==1){$("forestry_forest_button1").onclick=new Function("forestryWater()");hideDiv("forestry_forest_button1_info_locked")}else{$("forestry_forest_button1").onclick=new Function("");showDiv("forestry_forest_button1_info_locked")}var e=B[2];forestry_user_buildings=e;for(var Y=1;Y<=2;Y++){if(forestry_production_run[Y]){window.clearInterval(forestry_production_run[Y]);forestry_production_run[Y]=0;forestry_production_time[Y]=0}$("forestry_building_click"+Y).onmouseover=new Function();$("forestry_building_click"+Y).onmouseout=new Function();if($("forestry_building_progress"+Y)){$("forestry_building_progress"+Y).className=""}if($("forestry_building_progress_add"+Y)){hideDiv("forestry_building_progress_add"+Y)}}forestry_production_run=new Array();for(var Y in e){if(e[Y]){var H=e[Y];var P=1;if(H.level>=4){P=3}else{if(H.level>=2){P=2}}$("forestry_stock"+(parseInt(H.position)+1)+"_object").style.background="url("+imgpath+"forestry/stock"+(parseInt(H.position)+1)+"_"+P+".png)";if(H.locked==1){$("forestry_building_click"+H.position).onclick=new Function();if(H.position==1){$("forestry_building_info"+H.position).innerHTML=forestry_bld1_info+'<br><br><div class="important">'+forestry_quests_locked+"</div>"}if(H.position==2){$("forestry_building_info"+H.position).innerHTML=forestry_bld2_info+'<br><br><div class="important">'+forestry_quests_locked+"</div>"}}else{if(H.status>0){if($("forestry_building"+Y)){$("forestry_building"+Y).style.background="url("+imgpath+"forestry/building"+Y+".jpg)"}if(H.next){var d="";var c="";if(carpentry_bonus>0){d="*";c="<div class='bonusinfo'>"+str_replace("%BONUS%",carpentry_bonus,t_price_add_carpentry)+"</div>"}showDiv("forestry_building"+H.position+"_update");var D="";D+="<div style='float:left'>"+cityadcost+"</div>";D+="<div style='float:left'><img src='"+imgpath+"money.gif' border='0' width='14px'></div>";D+="<div style='float:left'>&nbsp;"+formatPrice(H.cost)+d+"</div>";D+="<div class='clear'></div>";var A=forestry_buildings[H.position][(parseInt(H.level)+parseInt(1))][2];var F=forestry_buildings[H.position][(parseInt(H.level)+parseInt(1))][3];if(A>0){D+="<div style='margin:5px 0 0 0;'>"+str_replace("%PERCENT%",A,forestry_productionboni)+"</div>"}if(F>0){D+="<div style='margin:5px 0 0 0;'>"+str_replace("%AMOUNT%",F,forestry_productioncapacity)+"</div>"}var N="forestryAjaxAction('updatebuilding',"+H.position+")";$("forestry_building"+H.position+"_update").onclick=new Function('globalcommitbox("'+infoupdatebuilding+'","'+D+c+'","'+N+'")')}else{hideDiv("forestry_building"+H.position+"_update");$("forestry_building"+H.position+"_update").onclick=new Function()}var C="";for(var U=0;U<H.level;U++){C+='<img src="'+imgpath+'star.png" border="0">';if($("forestry_building_update_level"+(U+1)+"_"+H.position)){showDiv("forestry_building_update_level"+(U+1)+"_"+H.position)}}$("forestry_building"+H.position+"_stars").innerHTML=C;$("forestry_building_click"+H.position).onclick=new Function();var h=0;if(H.slots){for(var I in H.slots){if(H.slots[I]){if(H.slots[I]["ready"]>0){if(H.slots[I]["ready"]==1){h=1;break}else{h=H.slots[I]["ready"]}}}}for(var I in H.slots){if(H.slots[I]["ready"]>1){if(!ftimer["productionrun"+I+"_"+H.position]){var aa=new Array;aa.position=H.position;aa.slot=I;forestrySetTimer("productionrun"+I+"_"+H.position,forestryProductionRun,aa);fremains["productionrun"+I+"_"+H.position]=H.slots[I]["remain"]}}}}if(h){if(h==1){hideDiv("forestry_building"+H.position+"_update");$("forestry_building"+H.position+"_production_tooltip_time").innerHTML=statusProductionComplete;$("forestry_building_progress"+H.position).className="forestry_building_progress_finish"+H.position}else{if(h==2){hideDiv("forestry_building"+H.position+"_update");$("forestry_building_progress"+H.position).className="forestry_building_progress_go"+H.position;if("forestry_building_progress_add"+H.position){showDiv("forestry_building_progress_add"+H.position)}}}if(H.position==1||H.position==2){$("forestry_building_click"+H.position).onclick=new Function("showForestryProductionBox("+H.position+")")}}else{$("forestry_building_click"+H.position).onclick=new Function("showForestryProductionBox("+H.position+")")}}else{var d="";var c="";if(carpentry_bonus>0){d="*";c="<div class='clear'></div><div class='bonusinfo'>"+str_replace("%BONUS%",carpentry_bonus,t_price_add_carpentry)+"</div>"}if(H.position==1){var t=forestry_build_bld1}else{if(H.position==2){var t=forestry_build_bld2}}var D="<div style='float:left'>"+cityadcost+"</div>";D+="<div style='float:left'><img src='"+imgpath+"money.gif' border='0' width='14px'></div>";D+="<div style='float:left'>&nbsp;"+formatPrice(H.cost)+d+"</div>";var N="forestryAjaxAction('updatebuilding',"+H.position+")";$("forestry_building_click"+H.position).onclick=new Function('globalcommitbox("'+t+'","'+D+c+'","'+N+'")')}if(H.position==1){$("forestry_building_info"+H.position).innerHTML=forestry_bld1_info}if(H.position==2){$("forestry_building_info"+H.position).innerHTML=forestry_bld2_info}for(var W=0;W<10;W++){if(forestry_production_run[W]){}}}}}forestry_stock=B[3];buildForestryStocks();var S=B[5];forestry_farmis=S;var E="";for(var Y=1;Y<=10;Y++){E+='<div class="forestry_farmi link" id="forestry_farmi'+Y+'">';E+='  <div class="forestry_farmi_info blackbox" id="forestry_farmi_info'+Y+'">';for(U=1;U<=10;U++){E+='<div id="forestry_farmi_info_product_line'+Y+"_"+U+'">';E+='  <div class="forestry_farmi_info_productimg" id="forestry_farmi_info_productimg'+Y+"_"+U+'"></div>';E+='  <div class="forestry_farmi_info_amount" id="forestry_farmi_info_amount'+Y+"_"+U+'"></div>';E+='  <div class="forestry_farmi_info_product" id="forestry_farmi_info_product'+Y+"_"+U+'"></div>';E+='  <div class="clear"></div>';E+="</div>"}E+='    <div class="forestry_farmi_info_price">'+farmcartsum+'&nbsp;<span id="forestry_farmi_info_price'+Y+'"></span></div>';E+='    <div class="forestry_farmi_info_points">'+farmicartpoints+'&nbsp;<span id="forestry_farmi_info_points'+Y+'"></span></div>';E+='    <div class="forestry_farmi_info_buttonline" id="forestry_farmi_info_buttonline'+Y+'">';E+='      <button style="margin:0 4px 0 0;" class="main_float_right link" id="forestry_farmi_info_button1'+Y+'" type="button">'+farmcartyes+"</button>";E+='      <button style="margin:0 4px 0 0; color:#f00; font-weight:bold;" class="main_float_right link" id="forestry_farmi_info_button2'+Y+'" type="button">'+farmcartno+"</button>";E+='      <div class="clear"></div>';E+="    </div>";E+='    <div class="forestry_farmi_bubble_zipfel"></div>';E+="  </div>";E+="</div>"}E+='<div class="clear"></div>';$("forestry_farmiline").innerHTML=E;for(var Y=1;Y<=10;Y++){if($("forestry_farmi"+Y)){hideDiv("forestry_farmi"+Y)}}var T=1;for(var Y=0;Y<S.length;Y++){if($("forestry_farmi"+T)){$("forestry_farmi"+T).className+=" forestry_farmi"+S[Y]["pic"];$("forestry_farmi"+T).onmouseover=new Function("showDiv('forestry_farmi_info"+T+"')");$("forestry_farmi"+T).onmouseout=new Function("hideDiv('forestry_farmi_info"+T+"')");for(var U=1;U<=10;U++){if($("forestry_farmi_info_product_line"+T+"_"+U)){hideDiv("forestry_farmi_info_product_line"+T+"_"+U)}if($("forestry_farmi_info_product"+T+"_"+U)){$("forestry_farmi_info_product"+T+"_"+U).className="forestry_farmi_info_product"}if($("forestry_farmi_info_amount"+T+"_"+U)){$("forestry_farmi_info_amount"+T+"_"+U).className="forestry_farmi_info_amount"}if($("forestry_farmi_info_productimg"+T+"_"+U)){$("forestry_farmi_info_productimg"+T+"_"+U).className="forestry_farmi_info_productimg"}}var v=1;var L=1;for(var U=0;U<S[Y]["products"].length;U++){var O=S[Y]["products"][U]["product"];var m=S[Y]["products"][U]["amount"];var s=S[Y]["products"][U]["name"];if($("forestry_farmi_info_product_line"+T+"_"+L)){var G=0;for(var X=1;X<=4;X++){if(forestry_stock[X]){if(forestry_stock[X][O]){if(parseInt(forestry_stock[X][O]["amount"])>=parseInt(m)){G=1}}}}if(G==1){$("forestry_farmi_info_product"+T+"_"+L).className=str_replace("forestry_farmi_uncomplete","",$("forestry_farmi_info_product"+T+"_"+L).className);$("forestry_farmi_info_amount"+T+"_"+L).className=str_replace("forestry_farmi_uncomplete","",$("forestry_farmi_info_amount"+T+"_"+L).className);$("forestry_farmi_info_product_line"+T+"_"+L).onclick=new Function()}else{v=0;$("forestry_farmi_info_product"+T+"_"+L).className+=" forestry_farmi_uncomplete";$("forestry_farmi_info_amount"+T+"_"+L).className+=" forestry_farmi_uncomplete";var w=1;for(var V in forestry_production_products){if(forestry_production_products[V][O]){w=(V-2)}}$("forestry_farmi_info_product_line"+T+"_"+L).onclick=new Function("showForestryProductionBox("+w+")")}$("forestry_farmi_info_productimg"+T+"_"+L).className+=" f_m_symbol"+O;$("forestry_farmi_info_product"+T+"_"+L).innerHTML=s;$("forestry_farmi_info_amount"+T+"_"+L).innerHTML=m+"x";showDiv("forestry_farmi_info_product_line"+T+"_"+L);L++}}var d="";var J=S[Y]["price"];if(specialbonus){var K=specialbonus.findBonus({key1:"consumer",key2:"money"});if(K&&in_array("forestry",K.types)){var R=(J*K.money);d='<div style="color:green; font-size:11px;">+'+formatPrice(R)+"&nbsp;"+t_specialbonus_money_bonus+"</div>"}}$("forestry_farmi_info_price"+T).innerHTML=formatPrice(J)+"&nbsp;"+d;$("forestry_farmi_info_points"+T).innerHTML=formatNumber(S[Y]["points"]);if(v==1){showDiv("forestry_farmi_info_button1"+T);$("forestry_farmi_info_button1"+T).onclick=new Function("forestryAjaxAction('sellfarmi',0,"+S[Y]["farmiid"]+")")}else{hideDiv("forestry_farmi_info_button1"+T)}$("forestry_farmi_info_button2"+T).onclick=new Function("forestryAjaxAction('kickfarmi',0,"+S[Y]["farmiid"]+")");showDiv("forestry_farmi"+T);T++}}var z=B[6];forestry_quests=z;var r=B[8];if(r!=0){var Z="";for(pid in r){Z+="<div style='margin:0 0 4px 0; float:left' class='f_m_symbol"+pid+"'></div>";Z+="<div style='margin:0 0 4px 0; float:left; color:#fff;'>&nbsp;"+r[pid]+"x</div>";Z+="<div class='clear'></div>"}$("forestry_stock1_setzlinge").innerHTML=Z;$("forestry_stock1_setzlinge").appear({duration:0.1,from:1,to:1});var q=new Effect.Opacity("forestry_stock1_setzlinge",{duration:4,transition:Effect.Transitions.linear,from:1,to:0})}if(B[10]!=0){for(var H in B[10]){if($("forestry_pos_crop"+H)){$("forestry_pos_status"+H).className=str_replace(" forestry_forest_crop","",$("forestry_pos_status"+H).className);$("forestry_pos_status"+H).className=str_replace(" forestry_forest_empty","",$("forestry_pos_status"+H).className);$("forestry_pos_status"+H).className=str_replace(" forestry_forest_plant","",$("forestry_pos_status"+H).className);var Z="<div style='margin:25px 0 0 25px;'>";Z+="<div style='margin:0 0 4px 0; float:left' class='f_m_symbol"+B[10][H]+"'></div>";Z+="<div style='margin:0 0 4px 0; float:left; color:#fff;'>&nbsp;1x</div>";Z+="<div class='clear'></div>";Z+="</div>";$("forestry_pos_crop"+H).innerHTML=Z;$("forestry_pos_crop"+H).appear({duration:0.1,from:1,to:1});var q=new Effect.Opacity("forestry_pos_crop"+H,{duration:4,transition:Effect.Transitions.linear,from:1,to:0})}}}if($("globaltransp")){hideDiv("globaltransp");hideDiv("globalbox")}showDiv("forestry_container");train_quicknavi=0;foodworld_quicknavi=0;forestry_quicknavi=1;speedLinks();farm_checker_open=0;hideDiv("farm_production_checker");if(Q>0&&a!="cancelcrop"){showForestryProductionBox(Q)}if($("forestry_building_inner")){setTimer("forestry_inner")}forestry_production_log=B[14]}}}function forestryAreaRun(a){forestry_area_time[a]=(forestry_area_time[a]-1);forestry_area_watertime[a]=(forestry_area_watertime[a]-1);if(forestry_area_time[a]<0){$("forestry_pos"+a).className="forestry_pos link tree"+forestry_area_pid[a]+"_3";window.clearInterval(forestry_area_run[a]);forestry_area_run[a]=0;forestry_area_time[a]=0;forestry_area_pid[a]=0;forestry_area_watertime[a]=0;$("forestry_pos_info"+a).innerHTML="<b>"+forestry_area_name[a]+"</b><br>"+statusProductionComplete;forestry_area_name[a]=""}else{var b=forestry_area_pid[a];$("forestry_pos"+a).className="forestry_pos link tree"+b+"_1";if(forestry_area_time[a]<((forestry_production_products[1][b][0]/100)*(100-forestry_plantphase1))){$("forestry_pos"+a).className+=" tree"+b+"_2"}if(forestry_area_time[a]<((forestry_production_products[1][b][0]/100)*(100-forestry_plantphase2))){$("forestry_pos"+a).className+=" tree"+b+"_3"}$("forestry_pos_info"+a).innerHTML="<b>"+forestry_area_name[a]+"</b><br>"+formatTime(forestry_area_time[a])}if(forestry_area_watertime[a]<=0){hideDiv("forestry_pos_water"+a)}else{showDiv("forestry_pos_water"+a)}}function forestryChkReady(d,a){if(forestry_area_time[d]<=0){forestryPosOption(2,d)}else{var c=forestry_harvest_notready_dialogtext;var b="forestryAjaxAction('cancelcrop',"+d+")";globalcommitbox(forestry_harvest_notready_text,c,b)}}function forestryPosOption(d,e){if(forestry_current_mode!=d){forestryPosAction()}var c=1;if(d==1&&forestry_plant>0){if(forestry_stock[1]){if(forestry_stock[1]&&forestry_stock[1][forestry_plant]){forestry_stock[1][forestry_plant]["amount"]--;if(forestry_stock[1][forestry_plant]["amount"]>=0){if(!forestry_action["pos"+e]){forestry_action["pos"+e]=forestry_plant}else{c=0}}else{forestry_plant=0;c=0}}else{c=0}}else{c=0}}else{if(d==2){if(!forestry_action["pos"+e]){forestry_action["pos"+e]=1}else{c=0}}else{c=0}}if(c==1){showDiv("forestry_pos_load"+e);var b=0;for(var a=1;a<=forestry_maxpos;a++){if(forestry_action["pos"+a]){b++}}if(b>=forestry_cache_items){forestryPosAction()}else{if(forestry_cache_run==0){forestry_cache_run=setTimeout("forestryPosAction()",forestry_cache_timeout)}}}forestry_current_mode=d}function forestryPosAction(){var b="";forestry_cache_area=new Array();for(var a=1;a<=forestry_maxpos;a++){if(forestry_action["pos"+a]){b+="&z[]="+a+"&p[]="+forestry_action["pos"+a];forestry_cache_area[a]=forestry_action["pos"+a]}}if(b!=""){clearTimeout(forestry_cache_run);forestry_cache_run=0;forestry_action=new Array();forestryAreaAction(b)}}function buildForestryStocks(){if(forestry_stock[0]&&forestry_stock[0][300]){if($("forestry_stock0_amount")){$("forestry_stock0_amount").innerHTML="&nbsp;"+forestry_stock[0][300]["amount"]}}for(var d=1;d<=4;d++){for(var n=0;n<5;n++){if(forestry_user_buildings[n]){if(forestry_user_buildings[n]["position"]&&forestry_user_buildings[n]["position"]==(d-1)){var m=forestry_user_buildings[n]["capacity"];break}}}if(d==1){var a=1,c=20}if(d==2){var a=21;var c=40}if(d==3){var a=41;var c=100}if(d==4){var a=101;var c=200}for(var b=a;b<=c;b++){if($("f_stock_amount_"+b)){var e=0;var l=0;if(forestry_stock[d]&&forestry_stock[d][b]){e=forestry_stock[d][b]["amount"]}if(forestry_stock[d]&&forestry_stock[d][b]&&forestry_stock[d][b].produced){l=forestry_stock[d][b].produced}if($("f_stock_growing_"+b)&&forestry_stock[d]&&forestry_stock[d][b]){hideDiv("f_stock_info_"+b);$("f_stock_growing_"+b).innerHTML=formatTime(forestry_stock[d][b]["duration"]);showDiv("f_stock_growing_"+b)}else{hideDiv("f_stock_growing_"+b);showDiv("f_stock_info_"+b)}if(d==1){$("f_stock_amount_"+b).innerHTML=e}else{if(d==4){$("f_stock_amount_"+b).innerHTML=e+"x"}else{$("f_stock_amount_"+b).innerHTML="&nbsp;"+e+"/"+m}}if($("f_stock_bar_"+b)){var h=forestryCalcQuestBar(m,e);if(h>0){$("f_stock_bar_"+b).style.left="-"+h+"px"}}if(d==1){$("f_stock_item"+b).onclick=new Function("forestrySetStockItem("+d+","+b+")")}if(d==4){if(e>0){showDiv("f_stock_item"+b)}else{hideDiv("f_stock_item"+b)}}}}if($("forestry_stock_capacity"+d)){$("forestry_stock_capacity"+d).innerHTML=str_replace("%AMOUNT%",m,forestry_stockcapacityinfo)}if(d==1){if(usetouch==1){$("forestry_stock1_object").onclick=new Function("showDiv('forestry_stock1')");$("forestry_stock1_object").onmouseover=new Function("");$("forestry_stock1_object").onmouseout=new Function("");$("forestry_stock1").onmouseover=new Function("");$("forestry_stock1").onmouseout=new Function("")}else{$("forestry_stock1_object").onclick=new Function("");$("forestry_stock1_object").onmouseover=new Function("showDiv('forestry_stock1')");$("forestry_stock1_object").onmouseout=new Function("hideDiv('forestry_stock1')");$("forestry_stock1").onmouseover=new Function("showDiv('forestry_stock1')");$("forestry_stock1").onmouseout=new Function("hideDiv('forestry_stock1')")}}else{$("forestry_stock"+d+"_object").onclick=new Function("showForestryStock("+d+")")}}}function setForestryStockInfo(c,a,b){if(a>0){if(forestry_stock[c][a]){$("forestry_stock"+c+"_item_time"+b).innerHTML=formatTime(forestry_stock[c][a]["duration"]);showDiv("forestry_stock"+c+"_item_time"+b)}}else{hideDiv("forestry_stock"+c+"_item_info"+b)}}function forestrySetStockItem(e,a,d){if(e==1){forestry_plant=a;if(a>0){$("forestry_stock1_select").className="f_m_symbol"+a}else{$("forestry_stock1_select").className=""}if(usetouch==1){hideDiv("forestry_stock1")}}for(var c=1;c<=10;c++){if($("forestry_stock"+e+"_item_symbol"+c)){var b=$("forestry_stock"+e+"_item_symbol"+c).className;$("forestry_stock"+e+"_item_symbol"+c).className=str_replace(" forestry_stockitem_selected","",b)}}}function showForestryProductionBox(a){showForestryBuildingInner(a)}function closeForestryProductionBox(){hideDiv("forestry_productiondialog_transp");hideDiv("forestry_productiondialog")}function forestrySetTimer(a,c,b){if(typeof c=="function"){ftimer[a]=window.setInterval(function(){c(a,b)},1000)}}function forestryClearTimer(a){if(ftimer[a]){window.clearInterval(ftimer[a]);ftimer[a]=0;if(fremains[a]){fremains[a]=0}}}function forestryClearAllTimer(){for(var a in ftimer){forestryClearTimer(a)}ftimer=new Array;fremains=new Array}function forestrySlotRun(a,c){fremains[a]--;var b=str_replace("slotrun","",a);if(fremains[a]>0){$("forestry_slot_timer_value"+c.slot+"_"+b).innerHTML=formatTime(fremains[a])}else{forestryClearTimer(a);delete forestry_slots[b][c.slot];showForestryProductionBox(b)}}function forestryProductionRun(a,b){fremains[a]--;if(fremains[a]>0){$("forestry_slot_run_info"+b.slot+"_"+b.position).innerHTML=formatTime(fremains[a])}else{forestryClearTimer(a);forestry_user_buildings[b.position]["slots"][b.slot]["ready"]=1;showForestryProductionBox(b.position)}}function forestrySetSlot(a,c,b){if(a==1){showDiv("forestry_sawmill_productbox_transp");showDiv("forestry_sawmill_productbox")}else{if(a==2){showDiv("forestry_carpenter_productbox_transp");showDiv("forestry_carpenter_productbox")}}currenttype=a;currentslot=c}function forestryUnsetSlot(){hideDiv("forestry_sawmill_productbox_transp");hideDiv("forestry_sawmill_productbox");hideDiv("forestry_carpenter_productbox_transp");hideDiv("forestry_carpenter_productbox");currenttype=0;currentslot=0}function forestryBuySlotResponse(c,b){var a=_chkRequest(c);if(a!=0){hideGlobalWait();if(a[0]==0){globalerrorbox(a[1])}else{hideDiv("globalbox");hideDiv("globaltransp");updateMenu();forestry_slots=a[11];showForestryProductionBox(b)}}}function showForestryProductionInfo(s,u,q,t,e){if(s==1){for(var m=1;m<=20;m++){if($("forestry_productiondialog_content_item"+m)){$("forestry_productiondialog_content_item"+m).className=str_replace("selected","",$("forestry_productiondialog_content_item"+m).className)}}if($("forestry_productiondialog_content_item"+t)){$("forestry_productiondialog_content_item"+t).className+=" selected"}}for(var m=1;m<=5;m++){if($("forestry_productioninfo_item"+m)){hideDiv("forestry_productioninfo_item"+m)}if("forestry_productioninfo_item_con"+m){hideDiv("forestry_productioninfo_item_con"+m)}$("forestry_productioninfo_item_amount"+m).className=str_replace("redalert","",$("forestry_productioninfo_item_amount"+m).className)}if(forestry_production_products[u]){if(forestry_production_products[u][q]){var l=forestry_production_products[u][q];var r=1;if(s==1){var h=l[5]}else{if(s==2){var h=l[6]}}var b=1;for(var m=0;m<h.length;m++){var v=h[m][0];var n=h[m][1];if(s==1){var a=forestry_production_products[(u+1)][v][9];var c=formatTime(forestry_production_products[(u+1)][v][0])}else{if(s==2){var a=forestry_production_products[(u-1)][v][9];var c=""}}$("forestry_productioninfo_item"+r).className="link forestry_productiondialog_content_item f_symbol"+v;$("forestry_productioninfo_item_amount"+r).innerHTML=n+"x&nbsp;"+a+"<br>"+c;if(s==1){var w="<div style='width:25px; float:left' class='f_symbol"+v+"'></div><div style='width:130px; float:left'>&nbsp;"+n+"x&nbsp;"+forestry_production_products[(u+1)][v][9]+"</div><div class='clear'></div>";var d="forestryAjaxAction('startproduction',"+s+","+v+")";$("forestry_productioninfo_item"+r).onclick=new Function('globalcommitbox("'+forestry_productionstart+'","'+w+'","'+d+'")')}if(s==2){if(forestry_stock[(u-1)]){if(forestry_stock[(u-1)][v]){if(parseInt(forestry_stock[(u-1)][v]["amount"])<parseInt(n)){b=0;$("forestry_productioninfo_item_amount"+r).className+=" redalert"}}else{b=0;$("forestry_productioninfo_item_amount"+r).className+=" redalert"}}else{b=0;$("forestry_productioninfo_item_amount"+r).className+=" redalert"}}showDiv("forestry_productioninfo_item"+r);showDiv("forestry_productioninfo_item_con"+r);r++}if(s==2){if(b==1){var w="<div style='width:25px; float:left' class='f_symbol"+q+"'></div><div style='width:130px; float:left'>&nbsp;"+forestry_production_products[u][q][9]+"</div><div class='clear'></div>";var d="forestryAjaxAction('startproduction',"+s+","+q+",1)";$("forestry_productiondialog_content_item"+t).onclick=new Function('globalcommitbox("'+forestry_productionstart+'","'+w+'","'+d+'")')}else{$("forestry_productiondialog_content_item"+t).onclick=new Function()}}}}if(e==1){showDiv("forestry_productioninfo")}else{hideDiv("forestry_productioninfo")}}function forestryProductionCarpenterRun(a){forestry_production_time[a]=(forestry_production_time[a]-1);if(forestry_production_time[a]<0){window.clearInterval(forestry_production_run[a]);forestry_production_run[a]=0;forestry_production_time[a]=0;$("forestry_building"+a+"_production_tooltip_time").innerHTML=statusProductionComplete;initForestry()}else{$("forestry_building"+a+"_production_tooltip_time").innerHTML=formatTime(forestry_production_time[a])}}function forestryAreaAction(a){if(forestry_current_mode==1){forestryAjaxAction("plant",0,0,0,a)}else{if(forestry_current_mode==2){forestryAjaxAction("crop",0,0,0,a)}}}function forestryWater(){if(forestry_waterall_cost>0){var b="";b+="<div style='float:left'>"+cityadcost+"</div><div style='float:left'><img src='"+imgpath+"money.gif' border='0' height='12px'></div><div>&nbsp;"+forestry_waterall_cost+"&nbsp;"+gamecurrency+"</div><div class='clear'></div>";b+=forestry_waterall_dialogtext;var a="forestryAjaxAction('water')";globalcommitbox(forestry_wateralltext,b,a)}else{forestryAjaxAction("water")}}function forestryFertilize(){globalSpeedupBox("forestry_fertilize",1,1)}var forestry_schredder_p=0;var forestry_schredder_a=0;function forestrySchredder(){var d="";d+=shredder_product+"<br>";d+="<select id='forestry_schredder_items'>";for(var c in forestry_stock){for(var a in forestry_stock[c]){if(a>=20){d+="<option value='"+a+"'>"+forestry_stock[c][a]["name"]+"</option>"}}}d+="</select><br>";d+=shredder_amount+"<br>";d+="<input id='forestry_schredder_amount' type='text' size='15'>";var b="forestrySchredderCommit()";globalcommitbox(forestry_schreddertext,d,b)}function forestrySchredderCommit(){if($("forestry_schredder_items").value>0&&$("forestry_schredder_amount").value>0){forestry_schredder_p=$("forestry_schredder_items").value;forestry_schredder_a=$("forestry_schredder_amount").value;var b=shredder_commit;var a="forestryAjaxAction('schredder')";globalcommitbox(forestry_schreddertext,b,a)}}var updatebuilding_block=0;function forestryAjaxAction(c,h,e,n,b,r){forestry_cache_area=new Array();var a=0;var d=0;if(c=="updatebuilding"){if(updatebuilding_block==1){return false}updatebuilding_block=1}if(c=="autoplant"){e=$("forestry_autoplant_pid").value}if(c=="startproduction"){if(currentslot>0){n=currentslot}}if(c=="schredder"){e=forestry_schredder_p;d=forestry_schredder_a;forestry_schredder_p=0;forestry_schredder_a=0}var q="";if(h>0){q+="&position="+h}if(e>0){q+="&productid="+e}if(n>0){q+="&slot="+n}if(d>0){q+="&amount="+d}if(c=="fertilize"||c=="speedup"){q+="&speed="+r}if(c=="plant"||c=="crop"){q+="&params="+b}var m=0;if(c=="startproduction"||c=="cropproduction"||c=="cancelproduction"||c=="speedup"||c=="cancelcrop"){var m=h}showGlobalWait(c);var l=createAjaxRequestObj();l.open("GET","ajax/forestry.php?rid="+rid+"&action="+c+q,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");if(c=="buyslot"){l.onreadystatechange=function(){forestryBuySlotResponse(l,h)}}else{l.onreadystatechange=function(){initForestryResponse(l,c,0,0,m)}}l.send(null)}function initCampaigns(){var a=createAjaxRequestObj();a.open("GET","ajax/forestry.php?rid="+rid+"&action=initcampaigns",true);a.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");a.onreadystatechange=function(){initCampaignsResponse(a)};a.send(null)}function campaignQuestEntry(e,a,b,d){var c=$("dialog_entryline_number").value;if(c>0&&e>0&&a>0&&b>0&&d>0){var h=createAjaxRequestObj();h.open("GET","ajax/forestry.php?rid="+rid+"&action=questentry&campaignid="+e+"&questid="+a+"&type="+d+"&productid="+b+"&amount="+c,true);h.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");h.onreadystatechange=function(){initCampaignsResponse(h,1)};h.send(null)}}function initCampaignsResponse(c,e){var a=_chkRequest(c);if(a!=0){if(a[0]==0){globalerrorbox(a[1])}else{showDiv("transp3");if(a[1]==1){showDiv("forestry_teaser")}else{if(a[2]>1){forestry_unlock=1;if(premium==1){showDiv("quicknavifarmforestry")}$("cityzone_2_10").onclick=new Function("initForestry()");$("cityzone_tt_2_10").innerHTML=str_replace("%INFO%","",cityzone_f);initForestry(a[2])}forestry_stock=a[3];if(a[6]&&a[6].level){levelupAlert(a[6].level,a[6].leveltitle)}hideDiv("forestry_teaser");showDiv("forestry_questlist_container");hideDiv("globaltransp");hideDiv("globalbox");forestryBuildQuestLines(a[1]);for(var b=1;b<=20;b++){hideDiv("forestry_questlist_end"+b)}for(var d in a[5]){showDiv("forestry_questlist_end"+d)}}}}}function forestryBuildQuestLines(C){for(var D=1;D<=4;D++){if($("forestry_questlist_locked"+D)){hideDiv("forestry_questlist_locked"+D)}for(var A=1;A<=100;A++){if($("forestry_questlist_item"+D+"_"+A)){hideDiv("forestry_questlist_item"+D+"_"+A)}if(forestry_questdelay_run[D+"_"+A]){window.clearInterval(forestry_questdelay_run[D+"_"+A]);forestry_questdelay_run[D+"_"+A]=0;forestry_questdelay_time[D+"_"+A]=0}}}var h=0;for(var D=1;D<=3;D++){if($("forestry_questlist_container_inner"+D)){hideDiv("forestry_questlist_container_inner"+D)}}for(campaign in C){if(C[campaign]){if($("forestry_questlist_container_inner"+campaign)){showDiv("forestry_questlist_container_inner"+campaign)}h++}if(C[campaign]=="locked"){showDiv("forestry_questlist_locked"+campaign)}else{var H=C[campaign];var F=H.questid;if($("forestry_questlist_item_title"+campaign+"_current")){$("forestry_questlist_item_title"+campaign+"_current").innerHTML=F+". "+H[3];$("forestry_questlist_item_desc"+campaign+"_current").innerHTML=H[4]}var E=0;var n="";n+='<div id="forestry_quest_require'+campaign+"_"+F+'" class="forestry_quest_require" style="display:block;">';for(var D=0;D<=1;D++){if(H[1]&&H[1][D]){var d=1;if(D==1){d=2}for(var u in H[1][D]){var a="";var m="kp";var I=produkt_name[u];if(d==2){if(u<=20){E++;a="*"}m="f_m_symbol";I=produkt_name_forestry[u]}n+='<div id="forestry_quest_entry'+campaign+"_"+F+"_"+d+"_"+u+'" style="position:relative;" onmouseover="showDiv(\'forestry_tt_'+campaign+"_"+F+"_"+d+"_"+u+"')\" onmouseout=\"hideDiv('forestry_tt_"+campaign+"_"+F+"_"+d+"_"+u+"')\">";n+='  <div class="main_float_left '+m+u+'" style="position:relative;"></div>';n+='  <div class="main_float_left" style="position:relative; margin:0 0 0 5px; width:100px; height:15px; overflow:hidden; background-color:#000;">';n+='    <div id="forestry_questbar_'+campaign+"_"+F+"_"+d+"_"+u+'" style="position:absolute; top:0px; left:-100px; background:url('+imgpath+'guild/innerbar.png) 0 -5px; width:100px; height:15px;"></div>';n+="  </div>";n+='  <div class="clear"></div>';n+='  <div id="forestry_tt_'+campaign+"_"+F+"_"+d+"_"+u+'" class="blackbox" style="display:none; position:absolute; bottom:16px; left:20px;">'+I+"</div>";n+="</div>";n+='<div style="margin:0 0 5px 20px;">';n+='  <div class="main_float_left" id="forestry_quest_amount'+campaign+"_"+F+"_"+d+"_"+u+'">0</div>';n+='  <div class="main_float_left">&nbsp;/&nbsp;</div>';n+='  <div class="main_float_left" id="forestry_quest_amount_max'+campaign+"_"+F+"_"+d+"_"+u+'">'+H[1][D][u]+"</div>";if(a!=""){n+='  <div class="main_float_left">&nbsp;'+a+"</div>"}n+='  <div class="main_float_left" id="forestry_quest_amount_stockinfo'+campaign+"_"+F+"_"+d+"_"+u+'" style="display:none; color:#f00; font-weight:bold;">&nbsp;'+product_notavailable_info+"</div>";n+='  <div class="clear"></div>';n+="</div>"}}}n+="</div>";if(E>0){n+='<div class="bonusinfo">* '+t_forestry_settling_min+"</div>"}if($("forestry_quest_require"+campaign+"_current")){$("forestry_quest_require"+campaign+"_current").innerHTML=n}var n="";if(H[2]){if(H[2][0]||(H[2][1]&&H[2][1][1])||H[2][13]){n+='<div style="margin:0 0 5px 0;">'+forestry_quests_reward+"</div>"}if(H[2][0]>0){n+='<div style="margin:0 0 5px 0;">';n+='<div class="main_float_left"><img src="'+imgpath+'points.gif" border="0" height="13" width="13"></div>';n+='<div class="main_float_left">&nbsp;'+H[2][0]+"&nbsp;"+t_points+"</div>";n+='<div class="clear"></div>';n+="</div>"}for(var s in H[2][1][1]){n+='<div style="margin:0 0 5px 0;">';n+='  <div class="main_float_left f_m_symbol'+s+'"></div>';n+='  <div class="main_float_left">&nbsp;'+H[2][1][1][s]+"x "+produkt_name_forestry[s]+"</div>";n+='  <div class="clear"></div>';n+="</div>"}if(H[2][13]>0){n+='<div style="margin:0 0 5px 0;">'+quest_reward_6+"</div>";n+='<img src="'+imgpath+"farmhouse/thumbs/"+H[2][13]+'.jpg" style="margin:0 0 5px 0; border:0px;">'}if(H[2][2]>0||H[2][4]==1||H[2][5]!=0||H[2][6]!=0||H[2][7]!=0||H[2][8]==1||H[2][10]>0){n+='<div style="margin:15px 0 5px 0;">'+forestry_quests_reward2+"</div>"}if(H[2][4]==1){n+='<div style="margin:0 0 5px 0;">'+forestry_quests_new_forestry+"</div>"}if(H[2][2]>0){n+='<div style="margin:0 0 5px 0;">'+forestry_bld[H[2][2]]+"</div>"}if(H[2][5]!=0){for(var z=0;z<H[2][5].length;z++){n+='<div style="margin:0 0 5px 0;">';n+='  <div class="main_float_left f_m_symbol'+H[2][5][z]+'"></div>';n+='  <div class="main_float_left">&nbsp;'+produkt_name_forestry[H[2][5][z]]+"</div>";n+='  <div class="clear"></div>';n+="</div>"}}if(H[2][6]>0){n+='<div style="margin:0 0 5px 0;">'+str_replace("%BUILDING%",forestry_bld[H[2][6]],forestry_quests_unlock_questline)+"</div>"}if(H[2][7]>0){n+='<div style="margin:0 0 5px 0;">'+forestry_quest_unlock_waterall+"</div>"}if(H[2][8]>0){n+='<div style="margin:0 0 5px 0;">';n+='  <div class="main_float_left" style="width:15px;"><img src="'+imgpath+'adbonus.gif" border="0"></div>';n+='  <div class="main_float_left" style="width:150px;">'+forestry_quest_addfarmi+"</div>";n+='  <div class="clear"></div>';n+="  </div>"}if(H[2][9]>0){n+='<div style="margin:0 0 5px 0;">';n+='  <div class="main_float_left" style="width:15px;"><img src="'+imgpath+'adbonus_queue.gif" border="0"></div>';n+='  <div class="main_float_left" style="width:150px;">'+forestry_guildqueue+"</div>";n+='  <div class="clear"></div>';n+="</div>"}if(H[2][10]>0){n+='<div style="margin:0 0 5px 0;">'+str_replace("%AMOUNT%",H[2][10],forestry_quests_stockadd1)+"</div>"}if(H[2][11]>0){n+='<div style="margin:0 0 5px 0;">'+giftname[H[2][11]]+"</div>"}if(H[2][12]>0){n+='<div style="margin:0 0 5px 0;">'+forestry_newquests+"</div>"}}if($("forestry_quest_reward"+campaign+"_current")){$("forestry_quest_reward"+campaign+"_current").innerHTML=n}if($("forestry_questlist_item"+campaign+"_current")){if(C[campaign]["remain"]){hideDiv("forestry_nextquest");showDiv("forestry_questlist_delay"+campaign+"_current");hideDiv("forestry_quest_require"+campaign+"_current");forestry_questdelay_time[campaign+"_"+F]=C[campaign]["remain"];forestry_questdelay_run[campaign+"_"+F]=window.setInterval("forestryQuestDelayRun("+campaign+","+F+")",1000)}else{hideDiv("forestry_questlist_delay"+campaign+"_current");if(C[campaign]["entries"]){for(var d=1;d<=2;d++){if(C[campaign]["entries"][d]){var G=C[campaign]["entries"][d];for(var D=0;D<G.length;D++){var u=G[D]["productid"];var c=G[D]["sum"];var B=$("forestry_quest_amount_max"+campaign+"_"+F+"_"+d+"_"+u).innerHTML;var w=0;if(d==1){if(checkRackItem(u)>0){w=1}}else{if(d==2){for(var z=1;z<5;z++){if(forestry_stock[z]){if(forestry_stock[z][u]){if(forestry_stock[z][u]["amount"]>0){w=1}break}}}}}if(parseInt(c)>0){$("forestry_quest_amount"+campaign+"_"+F+"_"+d+"_"+u).innerHTML=c;var b=forestryCalcQuestBar(B,c);$("forestry_questbar_"+campaign+"_"+F+"_"+d+"_"+u).style.left="-"+b+"px"}if(parseInt(c)<parseInt(B)){var q=(parseInt(B)-parseInt(c));$("forestry_quest_entry"+campaign+"_"+F+"_"+d+"_"+u).onclick=new Function("buildForestryQuestEntry("+d+", "+u+", "+q+", "+campaign+", "+F+");")}else{$("forestry_quest_entry"+campaign+"_"+F+"_"+d+"_"+u).onclick=new Function()}if(w==0&&parseInt(c)<parseInt(B)){$("forestry_quest_entry"+campaign+"_"+F+"_"+d+"_"+u).onclick=new Function();showDiv("forestry_quest_amount_stockinfo"+campaign+"_"+F+"_"+d+"_"+u)}else{hideDiv("forestry_quest_amount_stockinfo"+campaign+"_"+F+"_"+d+"_"+u)}}}}}showDiv("forestry_quest_require"+campaign+"_current")}showDiv("forestry_questlist_item"+campaign+"_current")}}}if(h==1){var v=220;var t=260}else{if(h==2){var v=110;var t=150}else{var v=0;var t=40}}for(var D=1;D<=3;D++){$("forestry_questlist_close").style.right=t+"px";if($("forestry_questlist_container_inner"+D)&&$("forestry_questlist_container_inner"+D).style.display=="block"){$("forestry_questlist_container_inner"+D).style.marginLeft=v+"px";break}}if(C.length==0){hideDiv("forestry_nextquest");showDiv("forestry_questlist_container_inner1");$("forestry_questlist_container_inner1").style.marginLeft="220px"}}function buildForestryQuestEntry(e,b,d,l,a){if(e==1){var c="product"}if(e==2){var c="forestry"}var h={type:c,pid:b,rest:d,campaign:l,questid:a};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(h),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("chkForestryQuestEntryValue("+e+", "+b+", "+d+", "+l+", "+a+")");$("dialog_entryline_number").onkeyup=new Function("chkForestryQuestEntryValue("+e+", "+b+", "+d+", "+l+", "+a+")");chkForestryQuestEntryValue(e,b,d,l,a)}function chkForestryQuestEntryValue(d,b,c,l,a){var h=0;if(d==1){h=checkRackItem(b)}if(d==2){h=checkForestryRackItem(b)}var e={type:d,stockamount:h,rest:c,click:"campaignQuestEntry("+l+","+a+","+b+","+d+")"};checkEntryLine(e)}function forestryQuestDelayRun(b,a){forestry_questdelay_time[b+"_"+a]=(forestry_questdelay_time[b+"_"+a]-1);if(forestry_questdelay_time[b+"_"+a]<0){window.clearInterval(forestry_questdelay_run[b+"_"+a]);forestry_questdelay_run[b+"_"+a]=0;forestry_questdelay_time[b+"_"+a]=0;showDiv("forestry_nextquest");initCampaigns()}else{$("forestry_questlist_delay_time"+b+"_current").innerHTML=formatTime(forestry_questdelay_time[b+"_"+a])}}function forestryCalcQuestBar(a,d){if(!d){return 0}var b=parseInt(a-d);var c=Math.floor(parseInt(b*100)/a);if(c>100){c=100}return c}function closeForestry(){for(var a=1;a<=forestry_maxpos;a++){if(forestry_area_run[a]){window.clearInterval(forestry_area_run[a]);forestry_area_run[a]=0;forestry_area_time[a]=0;forestry_area_pid[a]=0;forestry_area_watertime[a]=0;forestry_area_name[a]=""}}forestry_area_run=new Array();forestry_area_time=new Array();forestry_area_pid=new Array();forestry_area_watertime=new Array();forestry_area_name=new Array();forestry_plant=0;for(var a=1;a<=10;a++){if(forestry_production_run[a]){window.clearInterval(forestry_production_run[a]);forestry_production_run[a]=0;forestry_production_time[a]=0}}forestry_production_run=new Array();forestry_production_time=new Array();forestry_quicknavi=0;hideDiv("forestry_productiondialog_transp");hideDiv("forestry_container")}var forestry_building_inner_current=0;function showForestryBuildingInner(c){forestry_building_inner_current=c;$("forestry_building_inner").className="forestry_building_inner_back"+c;var b="";for(var a=1;a<=3;a++){b+='<div id="forestry_building_inner_slot'+a+'" class="nursery_slot_item">';b+='  <div id="forestry_building_inner_slot_img_main'+a+'" class="link nursery_slot_item_img">';b+='    <div id="forestry_building_inner_slot_img'+a+'" class="forestry_building_inner_slot_img"></div>';b+="  </div>";b+='  <div id="forestry_building_inner_slot_info'+a+'" class="nursery_slot_item_info link" style="width:145px; height:120px;">';b+="  </div>";b+='  <div id="forestry_building_inner_slot_locked'+a+'" class="nursery_slot_block"></div>';b+='  <div id="forestry_building_inner_slot_cancel'+a+'" class="forestry_building_inner_slot_cancel button_destruct link" onclick="dialogForestry(\'cancelproduction\', '+c+", "+a+')"></div>';b+='  <div id="forestry_building_inner_slot_speedup'+a+'" class="forestry_building_inner_slot_speedup speedupgardenbutton link" onclick="globalSpeedupBox(\'forestry_speedup\','+c+","+a+')"></div>';if(a==3){b+='<div id="forestry_building_inner_slot_remain"></div>'}b+="</div>"}$("forestry_building_inner_slots").innerHTML=b;showDiv("forestry_building_inner_transp");showDiv("forestry_building_inner");timerForestryInner()}function closeForestryBuildingInner(){hideDiv("forestry_building_inner_transp");hideDiv("forestry_building_inner");forestry_building_inner_current=0}function dialogForestry(e,n,t,d,c){if(e=="cancelproduction"){var r=forestry_productioncancel;var h=forestry_productioncancel_content;var w="forestryAjaxAction('cancelproduction', "+n+", 0, "+t+")"}if(e=="startproduction"){currentslot=t;var r=forestry_productionstart;var h="<div style='position:relative; width:25px; margin:0 auto;' class='f_symbol"+d+"'></div>";var s="";var q=0;if(specialbonus){var m=specialbonus.findBonus({key1:"forestry",key2:"harvest"});if(m){s="bonus";q=m.harvest;c++}}h+='<div class="'+s+"\" style='margin-top:10px;'>&nbsp;"+c+"x&nbsp;"+forestry_production_products[(n+2)][d][9]+"</div>";if(s!=""&&q>0){h+='<div class="bonus">('+t_incl+" +"+q+" "+t_specialbonus_foodworld_harvest_info+")</div>"}h+="<div class='clear'></div>";var w="forestryAjaxAction('startproduction', "+n+", "+d+", "+t+")"}if(e=="buyslot"){if(forestry_slot_config[n][t]){var a=forestry_slot_config[n][t];var r=forestry_buy_slot;var h="";if(t==2){h+="<div>"+str_replace("%MONEY%",formatPrice(forestry_slot_config[n][t][0]),t_buy_slot)+"</div>"}if(t==3){var z=a[1];var l="";var v="";var u=0;var m=specialbonus.findBonus({key1:"forestry",key2:"rentslot"});if(m&&m.rentslot){u=m.rentslot}if(u>0){z=(z*(1-u));l="color:green; font-weight:bold;";v=specialbonus.htmlBonusLine(u,1)}var b=str_replace("%COINS%",'<span style="'+l+'">'+z+"&nbsp;"+t_coins+"</span>",t_rent_slot);b=str_replace("%TIME%",formatTime(a[2]),b);h+="<div>"+b+"</div>";if(v!=""){h+=v}}var w="forestryAjaxAction('buyslot', "+n+", 0, "+t+")"}else{return false}}globalcommitbox(r,h,w)}function forestryHoverProductionLine(b,a){if(a==1){$("forestry_building"+b+"_production_line").addClassName("active")}else{$("forestry_building"+b+"_production_line").removeClassName("active")}}function timerForestryInner(){$("forestry_building1_production_line").innerHTML="";$("forestry_building2_production_line").innerHTML="";if(forestry_user_buildings){for(var d in forestry_user_buildings){var r=0;var b={};if(!forestry_user_buildings[d].slots){continue}for(var c in forestry_user_buildings[d].slots){if(forestry_user_buildings[d].slots[c].remain){forestry_user_buildings[d].slots[c].remain--}if(forestry_user_buildings[d].slots[c].remain>0){if(!b.pid||b.remain>forestry_user_buildings[d].slots[c].remain){b={pid:forestry_user_buildings[d].slots[c].productid,remain:forestry_user_buildings[d].slots[c].remain}}}else{r=forestry_user_buildings[d].slots[c].productid}}var n="";if(r>0){n+='<div class="f_m_symbol'+r+'" style="float:left; margin:5px;"></div>';n+='<div style="float:left; margin-top:5px;">'+statusProductionComplete+"</div>";n+='<div class="clear"></div>'}else{if(b.pid){n+='<div class="f_m_symbol'+b.pid+'" style="float:left; margin:5px;"></div>';n+='<div style="float:left; margin-top:5px;">'+formatTime(b.remain)+"</div>";n+='<div class="clear"></div>'}}$("forestry_building"+d+"_production_line").innerHTML=n}}var d=forestry_building_inner_current;if($("forestry_building_inner")&&d>0){for(var c=1;c<=3;c++){var n="";var e="";var w="";var u="showForestrySelection("+d+", "+c+")";hideDiv("forestry_building_inner_slot_speedup"+c);hideDiv("forestry_building_inner_slot_cancel"+c);hideDiv("forestry_building_inner_slot_locked"+c);$("forestry_building_inner_slot_img"+c).className="";$("forestry_building_inner_slot_info"+c).innerHTML="";if(forestry_user_buildings[d]&&forestry_user_buildings[d].slots&&forestry_user_buildings[d].slots[c]){var A=forestry_user_buildings[d].slots[c];if(A.productid){$("forestry_building_inner_slot_img"+c).className="fbig"+A.productid+" nursery_slot_item_img";var h="";var l=0;var m=forestry_products[A.productid][2];if(specialbonus){var B=specialbonus.findBonus({key1:"forestry",key2:"harvest"});if(B){h="bonus";l=B.harvest;m++}}n+='<div class="'+h+'" style="font-weight:bold; margin-bottom:5px;">'+m+"x&nbsp;"+produkt_name_forestry[A.productid]+"</div>";if(h!=""&&l>0){n+='<div class="bonus">('+t_incl+" +"+l+" "+t_specialbonus_foodworld_harvest_info+")</div>"}}if(A.remain>0){n+="<div>"+formatTime(A.remain)+"</div>";var u=""}else{n+="<div>"+statusProductionComplete+"</div>";e='<div style="position:absolute; bottom:5px;">'+click4products+"</div>";forestry_user_buildings[d].slots[c].speedup=0;var u="forestryAjaxAction('cropproduction',"+d+",0,"+c+")"}if(A.speedup==0){hideDiv("forestry_building_inner_slot_speedup"+c)}else{showDiv("forestry_building_inner_slot_speedup"+c)}showDiv("forestry_building_inner_slot_cancel"+c)}var z=0;if(c==3){hideDiv("forestry_building_inner_slot_remain")}if(c==2||c==3){if(forestry_slots[d]&&forestry_slots[d][c]){if(c==3){forestry_slots[d][c]--;if(forestry_slots[d][c]>0){showDiv("forestry_building_inner_slot_remain");$("forestry_building_inner_slot_remain").innerHTML=formatTime(forestry_slots[d][c])}}if(forestry_slots[d][c]<0){z=1}}else{z=1}if(z==1){if(c==2){e='<div style="position:absolute; bottom:5px;">'+str_replace("%MONEY%",formatPrice(forestry_slot_config[d][c][0]),t_buy_slot)+"</div>"}if(c==3){var v=forestry_slot_config[d][c][1];var q="";var t="";var a=0;var B=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(B&&in_array("forestry",B.types)){a=B.discount}var B=specialbonus.findBonus({key1:"forestry",key2:"rentslot"});if(B&&B.rentslot){a=B.rentslot}if(a>0){v=Math.ceil(v*(1-a));q="color:green; font-weight:bold;";t=specialbonus.htmlBonusLine(a,1)}var s=str_replace("%COINS%",'<span style="'+q+'">'+v+"&nbsp"+t_coins+"</span>",t_rent_slot);s=str_replace("%TIME%",formatTime(forestry_slot_config[d][c][2]),s);if(t!=""){s+=t}e='<div style="position:absolute; bottom:5px;">'+s+"</div>"}showDiv("forestry_building_inner_slot_locked"+c);u="dialogForestry('buyslot', "+d+", "+c+")";$("forestry_building_inner_slot_locked"+c).onclick=new Function(u)}}if(!(forestry_user_buildings[d]&&forestry_user_buildings[d].slots&&forestry_user_buildings[d].slots[c])&&z==0){e='<div style="position:absolute; bottom:5px;">'+t_start_production+"</div>"}$("forestry_building_inner_slot_info"+c).innerHTML=n+e;$("forestry_building_inner_slot_info"+c).onclick=new Function(u);$("forestry_building_inner_slot_img_main"+c).onclick=new Function(u)}}}function showForestrySelection(c,b){if(!c){c=1}if(!b){b=1}forestry_productionselect_navi=1;var q=9;var n=0;var t="";if(c==1){var l=t_forestry_bld1_production_head;var d=forestry_stock[2]}if(c==2){var l=t_forestry_bld2_production_head;var d=forestry_stock[3]}$("forestry_selectproduction_head").innerHTML=l;var m=0;for(var v in forestry_products){var E=forestry_products[v];if((v==113||v==114||v==133)&&xmastimeforestry!=1){continue}if(forestry_production_products[(c+2)]&&forestry_production_products[(c+2)][v]&&forestry_production_products[(c+2)][v][13]){continue}if(E[3]==(c+2)&&(forestry_production_products[(c+2)]&&forestry_production_products[(c+2)][v])){m++;var s=[];if(E[3]==3){s.push([E[11],1])}if(E[3]==4){s=E[6]}var e="";var w="dialogForestry('startproduction', "+c+", "+b+", "+v+", "+E[2]+")";for(var A=0;A<s.length;A++){if(!(d&&d[s[A][0]]&&d[s[A][0]].amount>=s[A][1])){e="important";w=""}}t+='<div class="forestry_selectproduction_item link" onclick="'+w+'">';t+='  <div class="f_symbol'+v+'" style="float:left; margin-right:10px;"></div>';t+='  <div style="float:left; width:155px;">';var D="";var h=0;var r=E[2];if(specialbonus){var C=specialbonus.findBonus({key1:"forestry",key2:"harvest"});if(C){D="bonus";h=C.harvest;r++}}t+='    <div style="font-weight:bold; margin-bottom:3px;" class="'+D+" "+e+'">'+r+"x&nbsp;"+E[9]+"</div>";if(D!=""&&h>0){t+='<div class="bonus">('+t_incl+" +"+h+" "+t_specialbonus_foodworld_harvest_info+")</div>"}t+='    <div style="margin-bottom:3px; float:left; margin-right:15px;">'+formatTime(forestry_production_products[(c+2)][v][0])+"</div>";if(E[14]){t+='<div style="float:left;">';t+='  <img src="'+imgpath+'menu/coins.gif" style="float:left; margin-right:2px; margin-top:1px; height:12px;">';t+='  <div style="float:left;">'+E[14]+"&nbsp;"+t_coins+"</div>";t+='  <div class="clear"></div>';t+="</div>"}t+='<div class="clear"></div>';for(var A=0;A<s.length;A++){var B="";if(m%3==0){B="right"}var e="";var a=0;if(!(d&&d[s[A][0]]&&d[s[A][0]].amount>=s[A][1])){e="important"}if(d&&d[s[A][0]]){a=d[s[A][0]].amount;if(a>s[A][1]){a=s[A][1]}}t+='<div style="position:relative; float:left; margin:0 9px 5px 0;" onmouseover="showDiv(\'forestry_productionselect_item_need_tt'+v+"_"+s[A][0]+"')\" onmouseout=\"hideDiv('forestry_productionselect_item_need_tt"+v+"_"+s[A][0]+"')\">";t+='  <div style="float:left; margin-right:2px;" class="f_symbol'+s[A][0]+'"></div>';t+='  <div style="float:left; margin-top:5px;" class="'+e+'">'+a+"/"+s[A][1]+"</div>";t+='  <div class="clear"></div>';var u="";if(A>=2){u="bottom:25px;"}t+='  <div id="forestry_productionselect_item_need_tt'+v+"_"+s[A][0]+'" class="ttbox '+B+'" style="'+u+'">'+forestry_products[s[A][0]][9]+"</div>";t+="</div>"}t+='    <div class="clear"></div>';t+="  </div>";t+='  <div class="clear"></div>';t+="</div>";n++}}$("forestry_selectproduction_scrollcontent").innerHTML=t;var z=Math.ceil(n/q);$("forestry_selectproduction_navi_pre").onclick=new Function("forestryProductionselectNavi("+z+", -1)");$("forestry_selectproduction_navi_next").onclick=new Function("forestryProductionselectNavi("+z+", 1)");forestryProductionselectNavi(z,0);showDiv("forestry_production_select");showDiv("forestry_production_select_transp")}function closeForestrySelection(){hideDiv("forestry_production_select");hideDiv("forestry_production_select_transp")}var forestry_productionselect_navi=1;function forestryProductionselectNavi(a,b){forestry_productionselect_navi+=b;$("forestry_selectproduction_scrollcontent").className="forestry_selectproduction_scrollpage"+forestry_productionselect_navi;if(forestry_productionselect_navi<=1){hideDiv("forestry_selectproduction_navi_pre");forestry_productionselect_navi=1}else{showDiv("forestry_selectproduction_navi_pre")}if(forestry_productionselect_navi>=a){hideDiv("forestry_selectproduction_navi_next");forestry_productionselect_navi=a}else{showDiv("forestry_selectproduction_navi_next")}}function forestryProductionLog(){var b='<div style="overflow:auto; height:200px; width:350px;">';for(var a in forestry_production_log){if(a>0&&produkt_name_forestry[a]){b+='<div style="margin-bottom:2px;">';b+='  <div class="f_m_symbol'+a+'" style="float:left; margin-right:5px;"></div>';b+='  <div style="float:left; width:200px; margin-right:5px; text-align:left;">'+produkt_name_forestry[a]+"</div>";b+='  <div style="float:left; width:100px; margin-right:5px;">'+forestry_production_log[a]+"</div>";b+='  <div class="clear"></div>';b+="</div>"}}b+="</div>";globalBoxFlex(t_produced_products,b,0,0,1)}function showForestryStock(m){if(forestry_stock[m]){var d=0;if(forestry_user_buildings[(m-1)]){var d=forestry_user_buildings[(m-1)].capacity}var c="";if(m>1&&m<4){c+='<div class="bonusinfo" style="margin:-5px 0px 20px 0px;">'+str_replace("%AMOUNT%",d,t_forestry_stockcapacityinfo)+"</div>"}c+='<div style="position:relative; width:500px; height:320px; overflow:auto;">';var l=1;for(var a in forestry_products){var b=0;if(forestry_stock[m]&&forestry_stock[m][a]){b=forestry_stock[m][a].amount}var h=0;if(m<4&&forestry_products[a][3]==m){h=1}if(m==4&&b>0){h=1}if(h==1){if(l==1&&m==3){c+='<div style="float:left; width:230px; margin-bottom:20px;">'}c+='<div style="position:relative; float:left; width:230px; margin-right:10px; margin-bottom:10px; text-align:left;">';c+='  <div class="f_symbol'+a+'" style="float:left; margin-right:5px;"></div>';c+='  <div style="position:relative; float:left;">';c+="    <div>"+produkt_name_forestry[a]+"</div>";if(m==4){c+="<div>"+b+"x</div>"}else{c+='<div class="forestry_stockitembar" style="float:left; margin-right:5px;">';var e=((b*100)/d);c+='  <div class="forestry_stockitembarinner" style="width:'+e+'%;"></div>';c+="</div>";c+='<div style="float:left;">'+b+"/"+d+"</div>";c+='<div class="clear"></div>'}c+="  </div>";c+="</div>";if(l%3==0&&m==3){c+='</div><div style="float:left; width:225px; margin-bottom:20px;">'}l++}}c+='  </div><div class="clear;"></div>';c+="</div>";globalBoxFlex(t_map_stock_overview_head,c,0,0,1)}}function forestryHelp(){showDiv("forestry_help_transp");showDiv("forestry_help");if(forestry_achievements&&forestry_achievements.length){for(var a=0;a<forestry_achievements.length;a++){showDiv("forestry_achievement_check"+forestry_achievements[a])}}}function forestryHelpClose(){hideDiv("forestry_help_transp");hideDiv("forestry_help")}var friends=function(){this.data={};this.currentTab="friends";this.currentFilter="all";this.suggestList={};this.finished=0;this.friendsCount=0;this.visited=[];this.friendsPos={}};friends.prototype.buyTask=function(){friends.action("friends_buy_task")};friends.prototype.finishTasks=function(){friends.action("friends_finish_tasks")};friends.prototype.save=function(a){var b=friends.data.data.friends[a].friend;var c=$("friends_list_info_line"+a+"_textarea").value;friends.action("friends_save",{friend:b,info:c})};friends.prototype.setFav=function(a){if(this.data.data.favs&&!in_array(a,this.data.data.favs)&&this.data.data.favs.length>=this.data.config.favs_count){return 1}friends.action("friends_set_fav",{friend:a})};friends.prototype.suggestFriend=function(){friends.action("friends_suggest")};friends.prototype.addFriend=function(a){friends.action("friends_add",{name:a})};friends.prototype.denyFriend=function(a){friends.action("friends_deny",{friend:a})};friends.prototype.acceptFriend=function(a){friends.action("friends_accept",{friend:friends.data.data.requests[a].unr})};friends.prototype.removeFriend=function(a){friends.action("friends_remove",{friend:a})};friends.prototype.init=function(){friends.action("friends_init")};friends.prototype.action=function(a,b){ajaxAction("farm",a,b,friends.response)};friends.prototype.response=function(c,b,d){if(b=="friends_suggest"){friends.suggestList=c;friends.suggestSelection();return 1}friends.data=c;friends.build();if(in_array(b,["friends_accept","friends_save","friends_set_fav"])){friends.setNavi("friends");for(var a=0;a<friends.data.data.friends.length;a++){if(friends.data.data.friends[a].friend!=d.friend){continue}friends.highlightLine("friends",a);break}}};friends.prototype.getNextTaskFriend=function(){var b=-1;if(this.data.data.friends){for(var a=0;a<this.data.data.friends.length;a++){var c=this.data.data.friends[a];if(!parseInt(c.status)||!(this.data.data.favs&&in_array(c.friend,this.data.data.favs))||in_array(c.friend,this.visited)){continue}b=a;break}if(b<0){for(var a=0;a<this.data.data.friends.length;a++){var c=this.data.data.friends[a];if(!parseInt(c.status)||this.data.data.favs&&in_array(c.friend,this.data.data.favs)||in_array(c.friend,this.visited)){continue}b=a;break}}}return b};friends.prototype.buildTask=function(c,a,l,r,e){var q="";var b=0;var m="";if(this.data.data.tasks&&this.data.data.tasks[c]){if(a==1&&!premium){q+=" off";r=-1}else{q="istask friends_task_img_"+this.data.data.tasks[c].name;if(this.data.data.tasks[c].animal){q+=" is_animal"+this.data.data.tasks[c].animal}if((parseInt(l)+1)>parseInt(this.friendsCount)){q+=" off";m=t_friends_task_missing_friend;r=-1}else{var n=friends.data.config.tasks[this.data.data.tasks[c].name].count;var h=t_friends_daily_tasks_desc[this.data.data.tasks[c].name].replace("%COUNT%",n);if(this.data.data.tasks[c].name=="chicken"){h=h.replace("%NAME%",t_friends_daily_tasks_animal[this.data.data.tasks[c].animal])}m='<div class="info">';m+='  <div class="'+q+'"></div>';m+="  <div>"+h+"</div>";m+="</div>"}}if(this.data.data.tasks[c].finished){b=1}}else{r=-1}var d='<div class="task" ';if(m!=""){d+="onmouseover=\"showDiv('friends_task_"+c+"_tt')\" onmouseout=\"hideDiv('friends_task_"+c+"_tt')\""}if(!b&&r>-1){d+=" onclick=\"friends.clickOption('visit', "+r+')"'}d+=">";d+='  <div class="img '+q+'"></div>';if(b){d+='<div class="ready"></div>'}q="";if(l>8){q="right"}if(m!=""){d+='<div id="friends_task_'+c+'_tt" class="ttbox '+q+'">'+m+"</div>"}d+="</div>";return d};friends.prototype.build=function(){this.visited=this.getVisitedFriends();this.finished=0;this.friendsCount=0;var q=["friends","requests","log"];var c=["all","checked","unchecked"];var d=0;if(this.data.data.favs){d=this.data.data.favs.length}if(this.data.data.friends){for(var h=0;h<this.data.data.friends.length;h++){if(this.data.data.friends[h].status==1){this.friendsCount++}}}var m="";m+='<div class="head">'+t_friends_head+"</div>";m+='<div class="points">';m+='  <div class="amount">';m+="    <div>"+formatNumber(this.data.data.points)+"</div>";m+='    <div class="friendpoints"></div>';m+="  </div>";m+='  <div class="daily">';m+='    <div class="head2">'+t_friends_daily_tasks+"</div>";m+='    <div class="tasks">';var u=this.getNextTaskFriend();var r=(this.data.config.daily_tasks+this.data.config.task_premium_count+this.data.config.task_buy_count);var b=[];if(this.data.data.tasks){for(var h=0;h<this.data.data.tasks.length;h++){if(this.data.data.tasks[h].finished){this.finished++}if(!this.data.data.tasks[h].bought){continue}var s=this.data.data.tasks[h];s.pos=h;b.push(s)}}var n=0;m+='<div class="tasks_block isdefault">';for(var h=1;h<=this.data.config.daily_tasks;h++){m+=this.buildTask(n,0,n,u);n++}m+="</div>";m+='<div class="tasks_block ispremium">';for(var h=1;h<=this.data.config.task_premium_count;h++){m+=this.buildTask(n,1,n,u);n++}m+="</div>";var w="";var v="";if(!b.length){w="friends.buyTaskCommit()";v="onmouseover=\"showDiv('friends_task_block_buyable_tt')\" onmouseout=\"hideDiv('friends_task_block_buyable_tt')\""}m+='<div class="tasks_block isbuyable link" onclick="'+w+'" '+v+">";for(var h=1;h<=this.data.config.task_buy_count;h++){var s=n;if(b[(h-1)]){s=b[(h-1)].pos}m+=this.buildTask(s,0,n,u,1);n++}m+='  <div id="friends_task_block_buyable_tt" class="ttbox">'+t_friends_task_buyable_head.replace("%COUNT%",this.data.config.task_buy_count)+"</div>";m+="</div>";m+="    </div>";m+="  </div>";if(parseInt(this.finished)!=parseInt(this.data.data.tasks.length)){m+='<div class="buyall">';m+='  <div class="button_new link" onclick="friends.finishTasksCommit()">'+t_friends_daily_tasks_button+"</div>";m+="</div>"}m+="</div>";m+='<div class="navi">';for(var e=0;e<q.length;e++){var t="";if(this.currentTab==q[e]){t="active"}m+='<div class="tab '+t+' link" onclick="friends.setNavi(\''+q[e]+"')\">";m+="  <div>"+t_friends_navi_tab[q[e]]+"</div>";if(q[e]=="requests"){var l=0;if(this.data.data.requests&&this.data.data.requests.length){l=this.data.data.requests.length}if(l>0){m+='<div class="notification">'+l+"</div>"}}m+="</div>"}m+="</div>";if(this.currentTab=="friends"){m+='<div class="filters">';for(var e=0;e<c.length;e++){var v="";if(this.currentFilter==c[e]){v="checked"}m+='<input type="checkbox" '+v+' class="filter link" onclick="friends.setFilter(\''+c[e]+"')\">";m+='<div class="filter desc2">'+t_friends_list_filter[c[e]]+"</div>"}m+='  <div class="favs">';m+='    <div class="star_five"></div>';m+="    <div>"+d+"/"+this.data.config.favs_count+"</div>";m+="  </div>";m+="</div>"}else{if(this.currentTab=="requests"){m+='<div class="desc">'+t_friends_requests_desc+"</div>"}else{if(this.currentTab=="log"){m+='<div class="desc">'+t_friends_log_desc+"</div>"}}}m+='<div id="friends_list_list" class="list">';if(this.currentTab=="friends"){m+=this.buildFriends()}if(this.currentTab=="requests"){m+=this.buildRequests()}if(this.currentTab=="log"){m+=this.buildLog()}m+="</div>";m+='<div class="add">';m+='  <div class="col col1">';m+='    <input id="friends_invite_input" type="text" maxlength="25">';m+='    <div class="button_new link" onclick="friends.addCheck()">'+friendslist_invite_button+"</div>";m+="  </div>";m+='  <div class="col col2">';m+='    <div class="button_new link" onclick="friends.suggestFriend()">'+t_friends_suggest_button+"</div>";m+="  </div>";m+='  <div class="clear"></div>';m+="</div>";m+='<div class="helpbutton_blue link" onmouseover="showDiv(\'friends_help_tt\')" onmouseout="hideDiv(\'friends_help_tt\')">';m+='  <div id="friends_help_tt" class="ttbox">'+this.help()+"</div>";m+="</div>";m+='<div class="mini_close link" onclick="friends.close()"></div>';$("friends_inner").innerHTML=m;showDiv("friends");$("friends_inner").addClassName("bounce");this.notifications()};friends.prototype.notifications=function(){hideDiv("friends_link_request_notification");var a=0;if(this.data.data.requests&&this.data.data.requests.length){a=this.data.data.requests.length}if(a>0){showDiv("friends_link_request_notification");if($("friends_link_request_notification")){$("friends_link_request_notification").innerHTML=a}}};friends.prototype.buildFriends=function(){this.friendsPos={};var d=1;var b="";if(this.data.data.friends){for(var a=0;a<this.data.data.friends.length;a++){var c=this.data.data.friends[a];if(this.currentFilter=="checked"&&!parseInt(c.status)){continue}if(this.currentFilter=="unchecked"&&parseInt(c.status)){continue}if(!(this.data.data.favs&&in_array(c.friend,this.data.data.favs))){continue}b+=this.buildFriendsLine(a);this.friendsPos[c.friend]=d;d++}for(var a=0;a<this.data.data.friends.length;a++){var c=this.data.data.friends[a];if(this.currentFilter=="checked"&&!parseInt(c.status)){continue}if(this.currentFilter=="unchecked"&&parseInt(c.status)){continue}if(this.data.data.favs&&in_array(c.friend,this.data.data.favs)){continue}b+=this.buildFriendsLine(a);this.friendsPos[c.friend]=d;d++}}return b};friends.prototype.buildFriendsLine=function(d){var m=this.data.data.friends[d];var r=["visit","contract","message","gift","remove"];if(player_unr==m.friend){r=["contract","message","remove"]}var l=0;if(!parseInt(m.status)){l=1}var a=m.uname;if(m.guild&&m.guild["short"]){a+="&nbsp;["+m.guild["short"]+"]"}var h="";h+='<div id="friends_friends_line'+d+'" class="line status'+parseInt(m.status)+'">';h+='  <div class="infos">';var n="empty";var q="friends.expandLine("+d+")";if(!l){n="star_five";if(!(this.data.data.favs&&in_array(m.friend,this.data.data.favs))){n+=" off"}}else{q=""}h+='<div class="fav link '+n+'" onclick="friends.setFav('+m.friend+')"></div>';if(!l){h+='<div id="friends_list_info_line'+d+'_expand" class="expand isclose link" onclick="'+q+'"></div>'}else{h+='<div class="waiting"></div>'}h+='    <div class="name link" onclick="'+q+'">';h+="      <div>"+a+"</div>";h+="    </div>";if(m.schaufenster){h+='<div class="showgarden link" onclick="window.open(\''+http_host+"schaugarten/index.php?mode=view&user="+m.friend+"')\"></div>"}if(m.guild&&in_array(m.guild.status,[1,2])){h+='<div class="guild'+m.guild.status+'"></div>'}h+="  </div>";h+='  <div class="options">';for(var c=0;c<r.length;c++){if(l>0&&!in_array(r[c],["waiting","remove"])){continue}if(r[c]=="remove"){h+='<div class="link delete_icon" onclick="friends.clickOption(\''+r[c]+"', "+d+')"></div>'}else{var n="";if(r[c]=="visit"){n="friendpoints";if(in_array(m.friend,this.visited)){n+=" off"}}h+='<div class="option link '+r[c]+" "+n+'" onclick="friends.clickOption(\''+r[c]+"', "+d+')" onmouseover="showDiv(\'friends_list_'+r[c]+"_"+d+"_tt')\" onmouseout=\"hideDiv('friends_list_"+r[c]+"_"+d+"_tt')\">";h+='  <div id="friends_list_'+r[c]+"_"+d+'_tt" class="ttbox">'+t_friends_list_option[r[c]].replace("%USER%","<b>"+m.uname+"</b>")+"</div>";h+="</div>"}}h+="  </div>";h+='  <div class="clear"></div>';if(!l){var e=["friend","level","pkt","bar","register"];if(m.guild){e.push("guild")}h+='<div id="friends_list_info_line'+d+'" class="info">';for(var c=0;c<e.length;c++){if(e[c]!="guild"&&!m[e[c]]){continue}if(e[c]=="guild"){var b=m.guild.guildname+"&nbsp;["+m.guild["short"]+"]"}else{var b=this.data.data.friends[d][e[c]]}if(in_array(e[c],["bar"])){b=formatPrice(b)}if(in_array(e[c],["pkt"])){b=formatNumber(b)}h+='<div class="line2">';h+='  <div class="col1">'+t_friends_info_stat[e[c]]+"</div>";h+='  <div class="col2">';h+="    <div>"+b+"</div>";if(e[c]=="level"&&m.levelmax){h+='<div class="bar">';h+='  <div class="barinner" style="width:'+m.levelpercent+'%"></div>';h+='  <div class="amount">'+formatNumber(m.levelcurrent)+"&nbsp;/&nbsp;"+formatNumber(m.levelmax)+"</div>";h+="</div>"}h+="</div>";h+='  <div class="clear"></div>';h+="</div>"}h+='  <textarea id="friends_list_info_line'+d+'_textarea" onkeyup="friends.checkTextarea('+d+')" onchange="friends.checkTextarea('+d+')">'+m.info+"</textarea>";h+='  <div class="letters">'+guildcreatedialogcountletters.replace("%LETTERS%",'<span id="friends_list_info_line'+d+'_letters">'+friendlistinfo_maxletters+"</span>")+"</div>";h+='  <div id="friends_list_info_line'+d+'_save" class="button_new link" onclick="friends.save('+d+')">'+t_save+"</div>";h+="</div>"}h+="</div>";return h};friends.prototype.buildRequests=function(){var b="";if(this.data.data.requests){for(var a=0;a<this.data.data.requests.length;a++){b+='<div id="friends_requests_line'+a+'" class="line requests">';b+='  <div class="infos">';b+='    <div class="name">'+this.data.data.requests[a].uname+"</div>";b+="  </div>";b+='  <div class="options">';b+='    <div class="option button_new link accept" onclick="friends.clickOption(\'accept\', '+a+')">'+t_friends_requests_option_accept+"</div>";b+='    <div class="option button_new link deny" onclick="friends.clickOption(\'deny\', '+a+')">'+t_friends_requests_option_deny+"</div>";b+="  </div>";b+='  <div class="clear"></div>';b+="</div>"}}return b};friends.prototype.buildLog=function(){var d={};for(var c in this.data.data.friends){d[this.data.data.friends[c].friend]=this.data.data.friends[c].uname}var b="";if(this.data.data.log){for(var c=0;c<this.data.data.log.length;c++){var a="---";if(d[this.data.data.log[c].friend]){a=d[this.data.data.log[c].friend]}b+='<div id="friends_log_line'+c+'" class="line log">';b+='  <div class="infos">';b+='    <div class="date">'+this.data.data.log[c].createdate+"</div>";b+='    <div class="name">'+t_friends_log_list_desc[this.data.data.log[c].action].replace("%NAME%","<b>"+a+"</b>")+"</div>";b+="  </div>";if(in_array(this.data.data.log[c].action,["visit","visited"])){b+='<div class="friendpoints"></div>'}b+='  <div class="clear"></div>';b+="</div>"}}return b};friends.prototype.setNavi=function(a){this.currentTab=a;this.build()};friends.prototype.setFilter=function(a){this.currentFilter=a;this.build()};friends.prototype.clickOption=function(b,a){if(b=="visit"){visitor.init(this.data.data.friends[a].friend)}if(b=="contract"){showPage("contracts",this.data.data.friends[a].uname)}if(b=="message"){messagesOpen(this.data.data.friends[a].uname)}if(b=="gift"){giftshop.friendGift(this.data.data.friends[a].friend)}if(b=="remove"){friends.removeFriendCommit(a)}if(b=="accept"){friends.acceptFriend(a)}if(b=="deny"){friends.denyFriendCommit(a)}};friends.prototype.removeFriendCommit=function(b){var a='<div id="friends_commit">'+t_friends_remove_desc.replace("%NAME%","<b>"+this.data.data.friends[b].uname+"</b>")+"</div>";var c="friends.removeFriend("+this.data.data.friends[b].friend+")";globalcommitbox(t_friends_list_option.remove,a,c)};friends.prototype.denyFriendCommit=function(b){var a='<div id="friends_commit">'+t_friends_deny_desc.replace("%NAME%","<b>"+this.data.data.requests[b].uname+"</b>")+"</div>";var c="friends.denyFriend("+this.data.data.requests[b].unr+")";globalcommitbox(t_friends_deny_head,a,c)};friends.prototype.checkTextarea=function(a){hideDiv("friends_list_info_line"+a+"_save");var b=$("friends_list_info_line"+a+"_textarea").value;if(b!=this.data.data.friends[a].info){showDiv("friends_list_info_line"+a+"_save")}$("friends_list_info_line"+a+"_letters").innerHTML=(friendlistinfo_maxletters-b.length)};friends.prototype.addCheck=function(){var c=$("friends_invite_input").value;if(c==""){return 1}var a=["friends","requests"];for(var d=0;d<a.length;d++){if(!this.data.data[a[d]]||!this.data.data[a[d]].length){continue}for(var b=0;b<this.data.data[a[d]].length;b++){if(this.data.data[a[d]][b].uname!=c){continue}this.setNavi(a[d]);this.highlightLine(a[d],b);return 1}}this.addFriend(c)};friends.prototype.expandLine=function(b){if(!$("friends_list_info_line"+b)){return 1}if($("friends_list_info_line"+b).style.display=="block"){hideDiv("friends_list_info_line"+b);$("friends_list_info_line"+b+"_expand").removeClassName("isopen").addClassName("isclose")}else{showDiv("friends_list_info_line"+b);$("friends_list_info_line"+b+"_expand").removeClassName("isclose").addClassName("isopen")}var e={};for(var a in this.friendsPos){e[this.friendsPos[a]]=a}var c=0;var d=0;for(var a in e){if($("friends_friends_line"+d)){if($("friends_list_info_line"+d)&&$("friends_list_info_line"+d).style.display=="block"){c+=$("friends_list_info_line"+d).clientHeight+30}else{c+=32}}d++;if(d>b){break}}if(c>285){$("friends_list_list").scrollTop=(c-285)}};friends.prototype.highlightLine=function(b,a){if($("friends_"+b+"_line"+a)){$("friends_"+b+"_line"+a).addClassName("flash")}};friends.prototype.suggestSelection=function(){var b='<div id="friends_commit" class="suggestions">';b+='  <div class="list">';for(var a=0;a<this.suggestList.length;a++){b+='<div class="line">';b+='  <div class="info">';b+='    <div class="level">'+this.suggestList[a].level+"</div>";b+='    <div class="name">'+this.suggestList[a].uname+"</div>";b+="  </div>";b+='  <div class="button_new link" onclick="friends.addFriend(\''+this.suggestList[a].uname+"')\">"+t_friends_suggest_accept_button+"</div>";b+='  <div class="clear"></div>';b+="</div>"}b+="  </div>";b+="</div>";globalBoxFlex(t_friends_suggest_head,b,0,0,1)};friends.prototype.getVisitedFriends=function(){var a=[];for(var b=0;b<this.data.data.tasks.length;b++){if(!this.data.data.tasks[b].finished){continue}a.push(parseInt(this.data.data.tasks[b].friend))}return a};friends.prototype.finishTasksCommit=function(){var a=[];var l=0;for(var d=0;d<this.data.data.tasks.length;d++){if(!this.data.data.tasks[d].finished){continue}l++;a.push(this.data.data.tasks[d].friend)}var b=(this.data.data.tasks.length-l);if(b<=0){return 1}var h=[];for(var d=0;d<this.data.data.friends.length;d++){if(this.data.data.friends[d].status==0){continue}if(this.data.data.friends[d].tasks.points_given>=this.data.config.daily_tasks){continue}if(in_array(this.data.data.friends[d].friend,a)){continue}h.push(this.data.data.friends[d].friend)}if(b>h.length){b=h.length}var q=(b*friends.data.config.task_finish_coins);var n="friends.finishTasks()";var m="";if(q>user_coins){n="";m="important"}var c='<span class="'+m+'"><b>'+formatNumber(q)+"&nbsp;"+t_coins+"</b></span>";var e='<div id="friends_commit">';e+="  <div>"+t_friends_daily_finish_tasks_body.replace("%COUNT%",b).replace("%COST%",c)+"</div>";e+='  <div class="info2">'+t_friends_daily_finish_tasks_info+"</div>";e+="</div>";globalcommitbox(t_friends_daily_finish_tasks_head,e,n)};friends.prototype.buyTaskCommit=function(){var d=t_friends_buy_task_head;var h=t_friends_buy_task_body;var a=this.data.config.task_buy_coins;if(this.data.config.task_premium_count_all){d=t_friends_task_buyable_head;h=t_friends_task_buyable_body;a=this.data.config.task_premium_count_all}var b="";var e="friends.buyTask()";if(parseInt(user_coins)<parseInt(a)){b="important";e=""}var c='<div id="friends_commit">';c+="  <div>"+h.replace("%COUNT%",this.data.config.task_buy_count).replace("%COST%",'<b><span class="'+b+'">'+a+"&nbsp;"+t_coins+"</span></b>")+"</div>";c+="</div>";globalcommitbox(d.replace("%COUNT%",this.data.config.task_buy_count),c,e)};friends.prototype.help=function(){var a='<div id="friends_help">';a+='  <div class="headline">'+t_friends_help_headline+"</div>";a+='  <div class="line">'+t_friends_help_line1.replace("%COUNT%",this.data.config.daily_tasks)+"</div>";a+='  <div class="line">'+t_friends_help_line4.replace("%COUNT%",this.data.config.task_premium_count)+"</div>";a+='  <div class="line">';a+='    <div class="friendpoints col1"></div>';a+='    <div class="col2">'+t_friends_help_line2+"</div>";a+='    <div class="clear"></div>';a+="  </div>";a+='  <div class="line">'+t_friends_help_line3.replace("%COUNT%",this.data.config.favs_count).replace("%BUTTON%","<b>"+t_friends_daily_tasks_button+"</b>")+"</div>";a+='  <div class="line">'+t_friends_help_line6+"</div>";a+='  <div class="line">';a+='    <div class="shop col1"></div>';a+='    <div class="col2" style="width:325px;">'+t_friends_help_line5+"</div>";a+='    <div class="clear"></div>';a+="  </div>";a+="</div>";return a};friends.prototype.close=function(){hideDiv("friends")};function session_failed(){location.href=http_host+"logout.php"}function speedLinksFarmsControl(){if($("farm_speedlinks_farm_list").style.display=="block"){hideDiv("farm_speedlinks_farm_list");$("farm_speedlinks_farm_control").style.backgroundImage="url("+imgpath+"market/sel_open.gif)"}else{showDiv("farm_speedlinks_farm_list");$("farm_speedlinks_farm_control").style.backgroundImage="url("+imgpath+"market/sel_close.gif)"}}function speedLinks(){if(!premium||tutorial>0){hideDiv("farm_speedlinks")}else{showDiv("farm_speedlinks");for(var a=1;a<=const_maxfarms;a++){hideDiv("speedlink_farm"+a)}for(var a in farms_data.farms){showDiv("speedlink_farm"+a);if($("speedlink_farm"+a)){$("speedlink_farm"+a).removeClassName("speedlink_farm_active")}}showDiv("speedlink_city1");if(currentuserlevel<8){hideDiv("speedlink_city2")}else{showDiv("speedlink_city2")}if(!player_guild){hideDiv("speedlink_guild")}else{showDiv("speedlink_guild")}if(!forestry_unlock){hideDiv("speedlink_forestry")}else{showDiv("speedlink_forestry")}if(currentuserlevel<11){hideDiv("speedlink_foodworld")}else{showDiv("speedlink_foodworld")}if(!farmersmarket_data){hideDiv("speedlink_farmersmarket");hideDiv("speedlink_farmersmarket2")}else{showDiv("speedlink_farmersmarket");showDiv("speedlink_farmersmarket2")}if(!megafield_data||megafield_data.block){hideDiv("speedlink_megafield")}else{showDiv("speedlink_megafield")}if(!train_has_building){hideDiv("speedlink_train")}else{showDiv("speedlink_train")}if(farm>0&&(farm!=99&&farm!=100)){$("speedlink_farm"+farm).addClassName("speedlink_farm_active")}$("speedlink_farmersmarket").removeClassName("speedlink_farmersmarket_active");if($("speedlink_farmersmarket2")){$("speedlink_farmersmarket2").removeClassName("speedlink_farmersmarket2_active")}if(farm==99){$("speedlink_farmersmarket").addClassName("speedlink_farmersmarket_active")}if(farm==100&&$("speedlink_farmersmarket2")){$("speedlink_farmersmarket2").addClassName("speedlink_farmersmarket2_active")}$("speedlink_city1").removeClassName("speedlink_city_active");$("speedlink_city2").removeClassName("speedlink_city_active");if(city>0){$("speedlink_city"+city).addClassName("speedlink_city_active")}if(inguild){$("speedlink_guild").addClassName("speedlink_guild_active")}else{$("speedlink_guild").removeClassName("speedlink_guild_active")}if(forestry_quicknavi){$("speedlink_forestry").addClassName("speedlink_forestry_active")}else{$("speedlink_forestry").removeClassName("speedlink_forestry_active")}if(foodworld_quicknavi){$("speedlink_foodworld").addClassName("speedlink_foodworld_active")}else{$("speedlink_foodworld").removeClassName("speedlink_foodworld_active")}if($("speedlink_train")){if(train_quicknavi){$("speedlink_train").addClassName("speedlink_train_active")}else{$("speedlink_train").removeClassName("speedlink_train_active")}}}}function selectMode(c,a,b){g("bedientext").style.fontSize="12pt";mode=c;if(mode==0){g("lagerlock").style.display="none";if(b){selectRackItem(b)}else{sortRackNew(0,1)}}else{if(mode==1){g("bedientext").innerHTML=lng_t_ernten;g("erntewasserpic").src=imgpath+"lager/ernten.gif";g("erntewasserpic").style.display="block";g("lager_pic").style.display="none";g("lager_info").style.zIndex=15;g("lager_name").innerHTML="&nbsp;";g("lager_wachsezeit").src=imgpath+"leer.gif";g("lager_ist1").innerHTML="";g("lager_zeit").innerHTML="";g("lager_ertrag").src=imgpath+"leer.gif";g("lager_ist2").innerHTML="";g("lager_ernte").innerHTML="";$("lager_info").style.display="none"}else{if(mode==2){g("bedientext").innerHTML=lng_t_giessen;g("erntewasserpic").src=imgpath+"lager/giessen.gif";g("erntewasserpic").style.display="block";g("lager_pic").style.display="none";g("lager_info").style.zIndex=15;g("lager_name").innerHTML="&nbsp;";g("lager_wachsezeit").src=imgpath+"leer.gif";g("lager_ist1").innerHTML="";g("lager_zeit").innerHTML="";g("lager_ertrag").src=imgpath+"leer.gif";g("lager_ist2").innerHTML="";g("lager_ernte").innerHTML="";$("lager_info").style.display="none"}else{if(mode==-1){deleteCursor()}}}}}function showMain(){var c=["transp","cart","globaltransp","globalbox","globalerrorbox","notepad","farmhousecontainer","farmhousetransp","headquarteroptions","gardenmaincontainer","innermaincontainer","guildmaincontainer","createguildbox","reallocatebox","guildmultibox","guildnewsticker","transp9","commitbox","buildbox","transp2","locationwait","feedcommit","citymaincontainer","friendscontainer","reallocateBuildingContainer","transp3","newsboy","newsboystart","fundpopup","glock","shop","animaldealer","giftshopinner","marktschreierinner","beemasterinner","collectorscontainer","transp4","ordercommit","einkaufszettel","multiframe","popup_garden","forestry_questlist_container","questboxtransp","questbox","xmasevent_city","minigameShipTransp","minigameShip","clothingdonation_transp","clothingdonation","building_inner","farm_dog_box","farmersmarket_pos1_inner","farmersmarket_pos2_inner","farmersmarket_pos3_inner","farmersmarket_pos4_inner","farmersmarket_pos5_inner","farmersmarket_pos6_inner","megafield","kniffel","olympia_transp","olympia_box","hillwalk","farmersmarket_pos7_inner","farmersmarket_pos8_inner","farmersmarket_pos9_inner","farmersmarket_pos10_inner","farmersmarket_pos11_inner","map_stall","pansetshop","sushibar","spicehouse","train"];for(var b=0;b<c.length;b++){if($(c[b])){hideDiv(c[b])}}if(fishing&&fishing.data){fishing.close()}if(vineyard&&vineyard.data){vineyard.close()}if(scouts&&scouts.data){scouts.close()}if(insecthotel&&insecthotel.data){insecthotel.close()}if(megafield_data&&!megafield_data.block){closeMegafield()}if(eventgarden&&$("eventgarden")){eventgarden.close()}if(greenhouse&&greenhouse.data){greenhouse.close()}if(train&&train.data){train.close()}closeFoodworld();$("multiframe").src="";closeMarket();city="";closeForestry();closeFoodcontest();closeMap();for(var b=1;b<=4;b++){for(var a=1;a<=100;a++){if(forestry_questdelay_run[b+"_"+a]){window.clearInterval(forestry_questdelay_run[b+"_"+a]);forestry_questdelay_run[b+"_"+a]=0;forestry_questdelay_time[b+"_"+a]=0}}}}function setBlockMain(a){if(a==1){$("blockmainnavi").style.width="170px";$("blockmainnavi").style.left="635px"}else{$("blockmainnavi").style.width="275px";$("blockmainnavi").style.left="530px"}}function generalAction(c,d,b,a){if(d){if(b){d.opt1=b}if(a){d.opt2=a}}ajaxAction("main",c,d,generalActionResponse)}function generalActionResponse(m,h,e){var u=m;var s=0;if(e&&e.opt1){s=e.opt1}var r=0;if(e&&e.opt2){r=e.opt2}if(h=="setnewsunread"&&specialoffer&&specialoffer.data&&specialoffer.data.active&&specialoffer.data.today){specialoffer.init(1)}else{if(h=="setnewsunread"&&collectevent&&collectevent.data&&collectevent.data.daily){collectevent.daily(collectevent.data.daily)}else{hideDiv("globalbox");hideDiv("globaltransp")}}if(h=="help"){newhelp_data[s]=u[1];helpInit(s)}if(h=="setnewsunread"){var q=s;if(q==1){closeNewsboyStart()}if(q==2){nextNews()}}if(h=="boxinit"){initBoxFeaturesResponse(u)}if(h=="boxpremium"){location.href="main.php"}if(h=="boxad"){currentad=u[1];setAdCountDown(u[1]);initBoxFeatures()}if(h=="box48hbonus"||h=="boxitem"||h=="boxsendcode"){initBoxFeatures()}if(h=="initnotepad"){$("notepadentry").value=u[1];calcNotepadLetters();showDiv("notepad")}if(h=="savenotepad"){hideDiv("notepad")}if(h=="rackupdate"){var t=s;rackobj=u[1];racklocks=u[2];rackbonis=u[3];updateRackGo(t)}if(h=="savefriendinfo"){initFriendsResponse(u);hideDiv("friendlist_infofield")}if(h=="initwbw"){setCityWBWContentResponse(u)}if(h=="sendwbwproduct"){setCityWBWContent(2)}if(h=="sendcanvass"){profilCanvassSendResponse()}if(h=="closetutorial"){tutorial=0;showMain();initZones(1)}if(h=="friendinfo"){var d=s;friendinfo=u[1];setFriendInfoContent(1);setActivateFriend(d)}if(h=="addfriend"){checkedfriends=u[1];uncheckedfriends=u[2];showfriendslist(2);hideDiv("friendscontainertransp");showFriendlistFeedback("friendslistfeedback",str_replace("%NAME%",$("friendsearchinput").value,friendslist_invite_success));$("friendsearchinput").value="";hideDiv("friendsearch")}if(h=="acceptfriend"){initFriends();showFriendlistFeedback("friendslistfeedback",friendslist_invite_accept)}if(h=="denyfriend"){globalerrorbox(friendslist_invite_deny)}if(h=="delfriend"){var c=s;var b=r;for(var l=0;l<checkedfriends.length;l++){if(checkedfriends[l]["id"]==c){checkedfriends[l]=0}}for(var l=0;l<uncheckedfriends.length;l++){if(uncheckedfriends[l]["id"]==c){uncheckedfriends[l]=0}}showFriendlistFeedback("friendslistfeedback",str_replace("%NAME%",b,friendslist_del_info));showfriendslist(friendslistsel);$("friendsinfo").innerHTML="";hideDiv("friendscontainertransp")}if(h=="memoryinit"||h=="memoryflip"){openMemoryResponse(u)}if(h=="watchtravelad"){if(u==1){travelad=0}mapTravelEnd()}if(h=="pollvote"){pollvotes=new Array;hideDiv("pollcontainer")}var a=["contracts_init","contracts_unread","contracts_cancel","contracts_accept","contracts_deny","contracts_send","contracts_savetemplate","contracts_deltemplate"];if(in_array(h,a)){if(h=="contracts_send"){contractsResetCart()}contracts_data=u;contractsInit(s);if(h=="contracts_send"){contractsOverview("out");contractsToogleDetail(s,"out");var n=str_replace("[*player*]",s,t_contracts_sent_text);globalerrorbox(n)}if(h=="contracts_cancel"){contractsOverview("out")}if(h=="contracts_accept"||h=="contracts_deny"){contractsOverview("in")}if(h=="contracts_unread"){contractsOverview("in");contractsToogleDetail(s,"in")}if(h=="contracts_deltemplate"||h=="contracts_savetemplate"){contractsNew()}}}function farmAction(q,m,D,t,d,c,b){var e="ajax/farm.php?";var B="rid="+rid+"&mode="+q+"&farm="+m+"&position="+D;if(t&&typeof t!="undefined"){t=t.toString();use_id=t;if(q=="destructbuilding"){use_id=encodeURIComponent(t)}if(t.indexOf("[]")==-1){B+="&id="+use_id}}if(D>1){currentposition=D}if(q=="speedup_addon"){B+="&coins="+t+"&slot="+d}if(q=="cropgarden"&&t){B+="&ignoreguild=1"}if(q=="autoplant_buy_load"&&t){B+="&coins="+t}if(q=="createnewrack"&&t){B+="&deco="+t}if(q=="garden_removeweed"){B+="&tile="+t}if(q=="garden_plant"){B+="&"+t+"&cid="+d}if(q=="garden_water"){B+="&"+t}if(q=="garden_harvest"){if(t.indexOf("[]")>-1){B+="&"+t}else{B+="&pflanze[]="+t+"&feld[]="+d+"&felder[]="+c+"&closepopup=1&force="+b}}if(q=="cancelproduction"||q=="harvestproduction"||q=="startproduction"||q=="cancelguildproduction"){B+="&slot="+t}if(q=="startproduction"){B+="&pid="+d+"&guildjob="+c}if(q=="fuelstation_stats"){B+="&type="+fuelstation_stats_select}if(q=="fuelstation_level"){B+="&slot="+t+"&amount="+$("fuelstation_dialog_leveladd_insert").value}if(q=="fuelstation_entry"){var l=$("fuelstation_product_select_input").value;if(l<=0){return false}B+="&amount="+l+"&slot="+t+"&pid="+d}if(q=="fuelstation_buyslot"){B+="&slot="+t}if(q=="fuelstation_harvest"){B+="&slot="+t}if(q=="fuelstation_speedup"){B+="&slot="+t+"&coins="+d}if(q=="fuelstation_buy"&&!fuelstation_block){return false}else{fuelstation_block=0}if(q=="map_speedup"){B+="&slot="+t+"&coins="+d}if(q=="map_sendvehicle"){var w="";for(var z in map_vehicle_cart[map_current_vehicle]){var u=map_vehicle_cart[map_current_vehicle][z].pid;var C=map_vehicle_cart[map_current_vehicle][z].amount;w+=z+","+u+","+C+"_"}B+="&route="+map_current_route+"&vehicle="+map_current_vehicle+"&cart="+w;map_current_route=0;map_current_vehicle=0;map_vehicle_cart={}}if(q=="map_buyvehicle"){B+="&route="+t+"&vehicle="+d}if(q=="map_buyfarm"){B+="&newfarm="+t}if(q=="vet_setrole"){B+="&role="+t}if(q=="vet_leveladd"){B+="&amount="+$("vet_dialog_leveladd_insert").value}if(q=="vet_questentry"){B+="&pid="+t+"&amount="+d}if(q=="vet_buyanimalslot"){B+="&slot="+t}if(q=="vet_rentanimalslot"){B+="&slot="+t}if(q=="vet_buyproductionslot"){B+="&slot="+t}if(q=="vet_rentproductionslot"){B+="&slot="+t}if(q=="vet_harvestproduction"){B+="&slot="+t+"&pos="+d}if(q=="vet_speedupproduction"){B+="&slot="+t+"&coins="+d}if(q=="vet_startproduction"){B+="&slot="+t+"&pid="+d+"&pos="+c}if(q=="vet_stats"){B+="&type="+t}if(q=="vet_setslot"){B+="&slot="+t+"&aid="+d}if(q=="vet_endtreatment"){B+="&slot="+t}if(q=="vet_speeduptreatment"){B+="&slot="+t+"&coins="+d}if(q=="vet_starttreatment"){var n="";for(var r in vet_selected_drugs[t]){n+=r+"_"+vet_selected_drugs[t][r]+","}B+="&slot="+t+"&set="+n}if(q=="foodcontest_stats"){B+="&type="+t}if(q=="foodcontest_pincache"){B+="&value="+t}if(q=="foodcontest_rent_block"||q=="foodcontest_buy_block"){B+="&block="+t}if(q=="foodcontest_buy_merch"){B+="&pid="+t+"&amount="+d}if(q=="foodcontest_set_slot"){B+="&slot="+t+"&pid="+d}if(q=="foodcontest_buy_slot"){B+="&slot="+t}if(q=="foodcontest_buy"){if(!foodcontest_block){return false}B+="&pid="+t+"&coins="+d;foodcontest_block=0}if(q=="foodcontest_start"){B+="&pid="+t}if(q=="megafruit_buy"&&!megafruit_block){return false}else{megafruit_block=0}if(q=="megafruit_stats"){B+="&pos="+t}if(q=="megafruit_start"){B+="&pid="+t}if(q=="megafruit_buyobject"||q=="megafruit_unlockobject"){B+="&oid="+t}if(q=="megafruit_level"){B+="&amount="+$("megafruit_dialog_leveladd_insert").value}if(q=="flowerarea_plant"||q=="flowerarea_harvest"||q=="flowerarea_water"){var n="";for(var h in flowerarea_cache){t=flowerarea_cache;n+=h+":"+flowerarea_cache[h]+","}B+="&set="+n}if(q=="flowerarea_changebonus"){if(!flowerarea_changebonus_select){return false}B+="&pid="+flowerarea_changebonus_select}if(q=="flowerarea_autoplant"){if(!flowerarea_autoplant_select){return false}B+="&set=0&pid="+flowerarea_autoplant_select}if(q=="flowerarea_speedup"){B+="&coins="+d+"&slot="+t}if(q=="flowerslot_plant"||q=="flowerslot_water"||q=="flowerslot_remove"){var n="";for(var h in flowerslots_cache){t=flowerslots_cache;n+=h+":"+flowerslots_cache[h]+","}B+="&set="+n}if(q=="handleflowerfarmi"){B+="&farmi="+t+"&status="+d}if(q=="buyflowergardener"){B+="&coins="+t}if(q=="nursery_speedup"){B+="&coins="+d+"&slot="+t}if(q=="nursery_harvest"){B+="&slot="+t}if(q=="nursery_startproduction"){if(nursery_startproduction_block==1){return false}nursery_startproduction_block=1;B+="&pid="+t+"&slot="+d}if(q=="nursery_buyslot"){B+="&slot="+t}if(q=="buyfarmersmarketbuilding"){B+="&pos="+t}if(q=="touchpad"){B+="&dir="+t}if(q=="coinsbonusitems"){B+="&aktion="+t}if(q=="getcoinsbonus"){B+="&itemid="+t}if(q=="buyfarmhouseitem"){B+="&itemid="+t+"&color="+d}if(q=="changegardenspecial"){B+="&product="+t}if(q=="reallocatebuilding"){B+="&set="+t}if(q=="setfarmhouseitem"){B+="&itemid="+t+"&color="+d}if(q=="setpetname"){B+="&itemid="+t+"&color="+d+"&name="+encodeURIComponent(c)}if(q=="shredderstart"){B+="&product="+t+"&amount="+d}if(q=="sellfarmi"){B+="&farmi="+t+"&status="+d}if(q=="buybuilding"){B+="&buildingid="+t}if(q=="activatepowerup"){B+="&formula="+t}if(q=="destructbuilding"){B+="&pass="+encodeURIComponent(t)}if(q=="setadvancedproduction"){B+="&product="+t+"&guildjob="+d+"&slot="+c}if(q=="gardenspeedup"){B+="&coins="+t}if(q=="autoplant"){B+="&product="+t}if(q=="pony_setfarmi"){if(!pony_sel_farmi||!pony_sel_pony){return false}B+="&farmi="+pony_sel_farmi+"&pony="+pony_sel_pony}if(q=="pony_feed"){if(!$("pony_feed_amount").value){return false}B+="&pos="+t+"&amount="+$("pony_feed_amount").value}if(q=="pony_speedup"){if(!$("pony_speedup_amount").value){return false}B+="&pos="+t+"&amount="+$("pony_speedup_amount").value}if(q=="buyarchitect"||q=="activatearchitect"){B+="&id="+architect_current_item}if(q=="carpentryentry"){if(carpentry_entryblock==1){return false}carpentry_entryblock=1;if(!($("carpentrybox_entry_pid").value>0&&$("carpentrybox_entry").value>0)){return false}B+="&pid="+$("carpentrybox_entry_pid").value+"&amount="+$("carpentrybox_entry").value}if(q=="reallocate_animals"){B+="&set="+t}if(q=="megafield_fuel"){B+="&vehicle="+megafield_vehicle_id}if(q=="megafield_plant"){var A="";for(var z in megafield_plant_cache){A+=z+"_"+megafield_plant_cache[z]+"|"}if(A==""){return false}B+="&set="+A}if(q=="megafield_tour"){var A="";for(var z=0;z<megafield_vehicle_tour.length;z++){for(var v=0;v<megafield_vehicle_tour[z].length;v++){A+=megafield_vehicle_tour[z][v]+","}A+="|"}if(A==""){return false}B+="&set="+A+"&vid="+megafield_vehicle_id}if(q=="megafield_buytile"){B+="&tile="+t}if(q=="megafield_selectjob"){B+="&option="+t}if(q=="megafield_vehicle_unlock"||q=="megafield_vehicle_buy"){B+="&vid="+t}if(q=="megafield_level"){var l=$("megafield_dialog_leveladd_insert").value;if(l>0){B+="&amount="+l}else{return false}}if(q=="megafield_stats"){B+="&type="+t}if(q=="megafield_insert"){if(megafield_insert_block==1){return false}megafield_insert_block=1;var l=$("dialog_entryline_number").value;if(!l){return false}B+="&pid="+t+"&amount="+l}if(q=="megafield_buylicense"){buy_license_block=1}if(q=="megafield_autoplant"){B+="&pid="+t}showGlobalWait(q);var s=createAjaxRequestObj();s.open("GET",e+B,true);s.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");s.onreadystatechange=function(){farmActionResponse(s,q,m,D,t,d,c,b)};s.send(null)}function farmActionResponse(n,B,v,O,D,d,b,a){var z=_chkRequest(n,B);if(z!=0){hideGlobalWait();powerup_block=0;carpentry_entryblock=0;blockgardenspeedup=0;megafield_insert_block=0;if(B=="nursery_startproduction"){nursery_startproduction_block=0}if(B=="vet_setrole"){vet_wait_checkrole=0}if($("gardenspeedupbox")){hideDiv("gardenspeedupbox")}if(in_array(B,["gardenspeedup","speedup_addon","nursery_speedup","flowerarea_speedup","vet_speeduptreatment","vet_speedupproduction","pets_speedupproduction","fuelstation_speedup","map_speedup","cowracing_speedupproduction","fishing_speedupproduction","sushibar_speedupproduction","scouts_speedupproduction"])){global_speedup_block=0}if(B=="megafield_buylicense"){buy_license_block=0}if(z[0]==0){var M={mode:B,farm:v,position:O,id:D,id2:d,id3:b,id4:a};if(B=="vet_checkrole"){vet_wait_checkrole=0}else{if(B=="watergarden"){errorboxgarden(gardennothingtowater)}else{if(B=="getadvancedcrop"){var F="closeLocationwait("+O+")";globalerrorbox(z[1],F)}else{if(B=="cropgarden"||B=="garden_harvest"){var P=0;if(z[2]==1){P="hideDiv('globalbox'); hideDiv('globaltransp');"}errorboxgarden(z[1],P,M)}else{globalerrorbox(z[1],0,M)}}}}}else{var E=["carpentryentry","setdonkey","setcropbonus","pony_buy","pony_feed","pony_speedup","getadvancedcrop","gardenspeedup","speedup_addon","autoplant","updatebuilding","buybuilding","activatepowerup","shredderstart","setpetname","changegardenspecial","buyfarmhouseitem","bulldozeground","createnewrack","createnewfarm","getcoinsbonus","setadvancedproduction","deleteproduction","reallocatebuilding","megafruit_start","megafruit_buyobject","megafruit_unlockobject","megafruit_level","megafruit_buy","buyarchitect","foodcontest_start","foodcontest_feed","foodcontest_buy","foodcontest_buy_slot","foodcontest_set_slot","foodcontest_buy_merch","foodcontest_rent_block","foodcontest_buy_block","foodcontest_merchpin","megafield_buytile","megafield_selectjob","megafield_level","megafield_buylicense","megafield_vehicle_unlock","megafield_vehicle_buy","megafield_update","megafield_gamblejob","megafield_insert","megafield_autoplant","megafield_teaser_close","megafield_fuel","vet_speeduptreatment","vet_startproduction","vet_speedupproduction","vet_buyproductionslot","vet_rentproductionslot","vet_buyanimalslot","vet_rentanimalslot","vet_questentry","vet_leveladd","vet_buyleveladd","vet_setrole","vet_checkrole","map_buyfarm","map_buyvehicle","map_sendvehicle","map_speedup","fuelstation_entry","fuelstation_harvest","fuelstation_speedup","fuelstation_buy","fuelstation_level","fuelstation_stats","reallocate_animals","weather_forecast","fuelstation_buyslot","vet_buypharmacist","megafield_harvest_all","megafield_fertilize_all","cancelproduction","garden_removeweed","garden_harvest","autoplant_buy_load","cancelguildproduction"];if(in_array(B,E)){hideDiv("globalbox");hideDiv("globaltransp")}if(B=="carpentryentry"){carpentry_data=z[1];carpentryBuild(O)}if(B=="initarchitect"||B=="buyarchitect"||B=="activatearchitect"){if(B=="buyarchitect"||B=="activatearchitect"){setFarmhouse(architect_current_item)}architect_config=[z[1],z[2],z[3]];if(z.farmhousebonus_info){architect_config.push(z.farmhousebonus_info)}initArchitect()}if(B=="setdonkey"){closeDonkeyBuy()}if(B=="dailydonkey"){dailyDonkeyResult(z)}if(B=="setcropbonus"){closeCropBonusBox()}if(B=="initcropbonus"){cropbonus_data=z[1];gametimer.cropbonus_cooldown;cropBonusCoolDownTimer();showDiv("cropbonusbox");showDiv("box_donkeydialogtransp")}if(B=="pony_buy"||B=="pony_setfarmi"||B=="pony_crop"||B=="pony_feed"||B=="pony_speedup"){pony_sel_farmi=0;pony_sel_pony=0;pony_sel_farmi_pos=0;pony_data=z[1];ponyBuild(O,B);if(z[1].levelup&&z[1].levelup.level){levelupAlert(z[1].levelup.level,z[1].levelup.leveltitle)}}if(B=="innerinfos"||B=="harvestproduction"){innerinfos_data=z;setBuildingInnerInfo(v,O,innerinfos_data);innerInfosResponse(O)}if(B=="speedup_addon"){buildingdata=z[1];newBuildingInner(v,O)}if(B=="getadvancedcrop"){getAdvancedCropResponse(z,O)}if(B=="setadvancedproduction"||B=="cancelproduction"){createAdvancedProductResponse(z,O,D,b)}if(B=="inithq"){initFarmhouseResponse(z)}if(B=="gardenspeedup"){useGardenSpeedupResponse(z,v,O)}if(B=="updatebuilding"){updateBuildingResponse(z,O,d,D,0)}if(B=="cropgarden"||B=="garden_harvest"){cropGardenResponse(z,O);if(z[5]){getGardenInfoResponse(z[5],O)}}if(B=="destructbuilding"){afterDestruction(O)}if(B=="buybuilding"){buyBuildingResponse(z,O,D)}if(B=="sellfarmi"){farmilist[b]=0;goFarmi(b,d,D)}if(B=="activatepowerup"){poweruprack=z[1].rack;powerupactive=z[1].active;handlePowerups(1);if(z[1].points){globalerrorbox(t_get_points_text.replace("%POINTS%",formatNumber(z[1].points)),"hideDiv('globalbox'); hideDiv('globaltransp')");$("globalbox_headline").innerHTML=t_get_points}}if(B=="autoplant"||B=="garden_plant"){if(z[4]==1){showTutorial("4_1",1)}autoplantposition=0;if(z[3]){showDiv("transp");showDiv("gardenmaincontainer");getGardenInfoResponse(z[3],O)}if(z[2]==1){waterGarden(O)}}if(B=="gardeninit"){getGardenInfoResponse(z,O)}if(B=="garden_removeweed"){AbrissResponse(z)}if(B=="cleargarden"){clearGardenResponse(z,O)}if(B=="watergarden"||B=="garden_water"){getGardenInfoResponse(z,O)}if(B=="setpetname"){setPetnameResponse(z,D,d,b,a)}if(B=="setfarmhouseitem"){farmhouseSelectedResponse(z,b)}if(B=="reallocatebuilding"){openReallocateBuilding(1)}if(B=="initreallocatebuildings"){initReallocateBuildingResponse(z)}if(B=="initreallocateanimals"){reallocateAnimalsInitResponse(z)}if(B=="changegardenspecial"){hideDiv("transp");hideDiv("headquarteroptions")}if(B=="getbuildingoptions"){buildBoxResponse(z,O)}if(B=="deleteproduction"){deleteProductionResponse(z,O)}if(B=="buyfarmhouseitem"){buyFarmhouseItemResponse(z,b,a,d)}if(B=="createnewrack"){createNewRackResponse(z)}if(B=="createnewfarm"){createNewFarmResponse(z)}if(B=="getcoinsbonus"){getCoinsBonusResponse()}if(B=="coinsbonusitems"){coinsBonusItemsResponse(z)}if(B=="showpan"){showPanResponse(z)}if(B=="touchpad"){usetouch=z[1];setTouchControl(D,d);if($("farm_main")){farmBuildPositions()}}if(B=="questbar"){questbarstatus=z[1];setQuestbarControl()}if(B=="initfriends"){initFriendsResponse(z)}if(B=="getfarms"){farmMove(1);setFarmersMarket();speedLinks()}if(B=="map_buyfarm"){speedLinks()}if(in_array(B,["weather_init","weather_forecast"])){openWeather()}if(B=="dogbonus"){hideDiv("transp");hideDiv("farm_dog_box")}if(B=="megafruit_harvest"||B=="megafruit_start"||B=="megafruit_buyobject"||B=="megafruit_unlockobject"||B=="megafruit_level"||B=="megafruit_buy"){if(z[1]&&z[1].levelup&&z[1].levelup.level){levelupAlert(z[1].levelup.level,z[1].levelup.leveltitle)}if(z[1]&&z[1].megafruit_levelup){var r=t_megafruit_levelup_head;if(z[1].megafruit_levelup.pid){var A=str_replace("%PRODUCT%",produkt_name[z[1].megafruit_levelup.pid],t_megafruit_levelup_body);A+='<br><img style="position:relative; margin-top:20px; width:35%" src="'+imgpath+"monsterfruit_"+z[1].megafruit_levelup.pid+'.png">'}else{var A=t_megafruit_levelup_body2}A=str_replace("%LEVEL%",z[1].megafruit_levelup.level,A);globalcommitbox(r,A)}if(z[1]&&z[1].reward){var r=t_megafruit_reward_head;var A="<div>"+t_megafruit_reward_body1+"</div>";A+='<div style="font-weight:bold; font-size:12px; margin-bottom:10px;">'+formatNumber(z[1].reward.reached)+"</div>";A+="<div>"+t_megafruit_reward_body2+"</div>";if(z[1].reward.points>0){A+="<div>"+formatNumber(z[1].reward.points)+"&nbsp;"+t_points+"</div>"}A+="<div>"+formatPrice(z[1].reward.money)+"</div>";if(z[1].reward.count>0){A+="<div>"+formatNumber(z[1].reward.count)+"&nbsp;"+t_megafruit_fruit_name+"</div>"}if(z[1].reward.parts>0){A+="<div>"+z[1].reward.parts+"&nbsp;"+str_replace("%NAME%",produkt_name[z[1].reward.pid],t_foodcontest_fruit_name)+"</div>"}if(z[1].reward["package"]>0){A+='<div class="pets_package'+z[1].reward["package"]+'" style="width:50px; height:50px; background-size:100%; float:left; margin-left:65px;"></div><div style="float:left; margin:10px 0px 5px 0px;">1x</div><div class="clear"></div>'}globalcommitbox(r,A)}if(z[1]&&z[1].feedback){var r=t_megafruit_need_object_feedback;var A="<div>"+t_megafruit_fruit_size+":&nbsp;<b>"+farmersmarket_data.megafruit.current.points+"</b></div>";var l=(farmersmarket_data.megafruit.current.rewards.points-z[1].feedback.points);if(l>0){A+='<div style="margin-top:4px;">+'+formatNumber(l)+"&nbsp;"+t_points+"</div>"}var q=(farmersmarket_data.megafruit.current.rewards.money-z[1].feedback.money);if(q>0){A+='<div style="margin-top:4px;">+'+formatPrice(q)+"</div>"}var h=(farmersmarket_data.megafruit.current.rewards.fruits-z[1].feedback.fruits);if(h>0){A+='<div style="margin-top:4px;">+'+formatNumber(h)+"&nbsp;"+t_megafruit_fruit_name+"</div>"}var w=(farmersmarket_data.megafruit.current.rewards.parts-z[1].feedback.parts);if(w>0){A+='<div style="margin-top:4px;">+'+formatNumber(w)+"&nbsp;"+str_replace("%NAME%",produkt_name[farmersmarket_data.megafruit.current.rewards.pid],t_foodcontest_fruit_name)+"</div>"}globalcommitbox(r,A)}if(B=="megafruit_harvest"){delete megafruit_stats_cache[megafruit_stats_select]}initMegaFruit()}if(B=="megafruit_stats"){megafruit_stats=z[1].stats;megafruit_stats_delay=const_megafruit_stats_delay;if(!megafruit_stats_cache[megafruit_stats_select]){megafruit_stats_cache[megafruit_stats_select]={}}megafruit_stats_cache[megafruit_stats_select]=megafruit_stats;dialogMegaFruit("stats")}if(B=="foodcontest_update"||B=="foodcontest_start"||B=="foodcontest_feed"||B=="foodcontest_finish"||B=="foodcontest_buy"||B=="foodcontest_buy_slot"||B=="foodcontest_set_slot"||B=="foodcontest_buy_merch"||B=="foodcontest_rent_block"||B=="foodcontest_buy_block"||B=="foodcontest_pincache"||B=="foodcontest_stats"||B=="foodcontest_merchpin"){if(z[1]&&z[1].levelup&&z[1].levelup.level){levelupAlert(z[1].levelup.level,z[1].levelup.leveltitle)}if(z[1]&&z[1].finish){rewardFoodcontest(z[1].finish)}if(B=="foodcontest_update"){setContentFoodcontest()}else{var G=1;if(B=="foodcontest_pincache"&&$("farmersmarket_pos6_inner").style.display!="block"){G=0}if(G==1){initFoodcontest()}}if(B=="foodcontest_buy"){dialogFoodcontest("stock")}if(B=="foodcontest_buy_slot"||B=="foodcontest_set_slot"){dialogFoodcontest("merch_slots")}if(B=="foodcontest_buy_merch"){dialogFoodcontest("set_merch_slot",foodcontest_merch_slot_select)}if(B=="foodcontest_pincache"||B=="foodcontest_rent_block"){}if(B=="foodcontest_feed"){var N=getRandom(0,(t_foodcontest_sound.length-1));showFeedback("foodcontest_feedback",t_foodcontest_sound[N])}if(z[1]&&z[1].stats){foodcontest_stats=z[1].stats;openStatsFoodcontest()}if(z[1]&&z[1].result){merchPinResultFoodcontest(z[1].result)}if(z[1]&&z[1].collect){foodcontest_flyer_data=z[1].collect;setTimeout(collectionFlyerFoodcontest,100)}}if(B=="farmersmarket_update"){if($("flowerarea_changebonus_dialog_inner")){flowerarea_changebonus_select=0;dialogFlowerArea("changebonus",1)}}var m=["flowerarea_plant","flowerarea_harvest","flowerarea_harvest_all","flowerarea_water","flowerarea_water_all","flowerarea_autoplant","flowerarea_speedup","flowerarea_changebonus","buyflowergardener","buyfarmersmarketbuilding","createflowerfarmi","handleflowerfarmi","flowerslot_plant","flowerslot_water","flowerslot_remove","nursery_speedup","nursery_harvest","nursery_startproduction","nursery_buyslot"];if(in_array(B,m)){if(D){for(var J in D){if($("flowerarea_tile"+J+"_status")){$("flowerarea_tile"+J+"_status").removeClassName("flowerarea_tile_wait")}if($("farmersmarket_deco"+J+"_status")){hideDiv("farmersmarket_deco"+J+"_plant_cursor");hideDiv("farmersmarket_deco"+J+"_water_cursor");hideDiv("farmersmarket_deco"+J+"_remove_cursor");hideDiv("farmersmarket_deco"+J+"_nowater_cursor");$("farmersmarket_deco"+J+"_status").removeClassName("flowerslots_wait")}if(B=="flowerslot_plant"){animateFlowerSlot(J)}}}if(B=="flowerarea_speedup"||B=="nursery_speedup"){hideDiv("speedupbox")}if(B!="createflowerfarmi"&&B!="flowerslot_plant"&&B!="flowerslot_water"){hideDiv("globalbox");hideDiv("globaltransp");if(B=="buyflowergardener"){hideDiv("transp")}hideDiv("flowers_gardener_box");flowerarea_autoplant_select=0;flowerarea_changebonus_select=0;var t=["flowerarea_plant","flowerarea_harvest","flowerarea_harvest_all","flowerarea_water","flowerarea_water_all","flowerarea_autoplant","flowerarea_speedup","flowerarea_changebonus"];if(in_array(B,t)){buildFlowerArea()}var c=["flowerslot_plant"];if(in_array(B,c)){setFlowerSlots()}if(z[1]&&z[1].levelup&&z[1].levelup.level){levelupAlert(z[1].levelup.level,z[1].levelup.leveltitle)}var P=0;if(z[1]&&z[1].drops){flowerarea_unique_drops=z[1].drops;if(z[1]&&z[1].harvested){P="uniqueFoundFlowerArea()"}else{uniqueFoundFlowerArea()}}if(z[1]&&z[1].harvested){var r=cropalllistheadline;var A="";for(var C in z[1].harvested){A+='<div style="float:left; margin-right:5px;" class="kp'+C+'"></div>';A+='<div style="float:left;">'+z[1].harvested[C]+"x "+produkt_name[C]+"</div>";A+='<div class="clear"></div>'}globalBox(r,A,P,0,1)}}if(B=="nursery_speedup"||B=="nursery_harvest"||B=="nursery_startproduction"||B=="nursery_buyslot"){initNursery()}if(B=="flowerslot_plant"||B=="flowerslot_water"||B=="flowerslot_remove"){timerFlowerSlots()}if(B=="handleflowerfarmi"||B=="createflowerfarmi"){updateFarmersMarketFarmis();var s=[];if(B=="createflowerfarmi"){s=z;setFlowerFarmis(D,s)}else{clearCart();setFlowerFarmis(D,s,d)}}else{setFarmersMarket()}if(B=="buyfarmersmarketbuilding"&&D==5){openFarmersMarketHowTo("vet")}}var u=["megafield_update","megafield_buytile","megafield_selectjob","megafield_level","megafield_buylicense","megafield_vehicle_unlock","megafield_vehicle_buy","megafield_gamblejob","megafield_tour","megafield_stats","megafield_closetutorial","megafield_insert","megafield_autoplant","megafield_harvest_all","megafield_fuel"];if(in_array(B,u)){buildMegafield();if(B=="megafield_insert"){megafield_insert_block=0}if(B=="megafield_gamblejob"){dialogMegafield("show_job")}if(B=="megafield_stats"){megafield_stats=z[1].stats;megafield_stats_delay=megafield_data.constants.stats_delay;if(!megafield_stats_cache[D]){megafield_stats_cache[D]={}}megafield_stats_cache[D]=megafield_stats;dialogMegafield("stats",0,0,D)}}var L=["vet_setslot","vet_starttreatment","vet_endtreatment","vet_speeduptreatment","vet_stats","vet_startproduction","vet_speedupproduction","vet_harvestproduction","vet_buyproductionslot","vet_rentproductionslot","vet_buyanimalslot","vet_rentanimalslot","vet_questentry","vet_leveladd","vet_buyleveladd","vet_setrole","vet_checkrole"];if(in_array(B,L)){if(B=="vet_stats"){vet_data.stats=z[1].stats;vet_stats_cache_delay[vet_stats_select]=30;if(!vet_stats_cache[vet_stats_select]){vet_stats_cache[vet_stats_select]={}}vet_stats_cache[vet_stats_select]=vet_data.stats;vetDialog("stats",D)}vet_selected_drugs={};updateVet();if(B=="vet_endtreatment"||B=="vet_starttreatment"){hideDiv("vet_transp");hideDiv("vet_animal_record")}if(B=="vet_checkrole"||B=="vet_endtreatment"){if(z[1]&&z[1].role_reward){vetDialog("role_reward",0,z[1].role_reward,z[1].reward_bonus)}else{if(B=="vet_endtreatment"&&z[1]&&z[1].animal_reward){setTimeout(function K(){vetSetAnimalFlyer(D,z[1].animal_reward)},500)}}}if(B=="vet_harvestproduction"){}if(B=="vet_questentry"){vetDialog("quests")}}var I=["map_buyfarm","map_buyvehicle","map_sendvehicle","map_update","map_speedup"];if(in_array(B,I)){updateMap();if(B=="map_buyfarm"){hideDiv("transp");hideDiv("farmhousecontainer");openMap();if(D==5){mapHelpOpen()}}if(B=="map_update"){mapDialog("vehicleSheetTour")}else{if(B=="map_buyvehicle"){mapDialog("openVehicleSheet",D)}else{mapCloseVehicleSheet();if(B=="map_sendvehicle"){mapVehicleTours()}}}}var H=["fuelstation_entry","fuelstation_harvest","fuelstation_speedup","fuelstation_buy","fuelstation_level","fuelstation_stats","fuelstation_buyslot"];if(in_array(B,H)){updateFuelstation(O);if(B=="fuelstation_stats"){fuelstation_stats_cache_delay[fuelstation_stats_select]=30;if(!fuelstation_stats_cache[fuelstation_stats_select]){fuelstation_stats_cache[fuelstation_stats_select]={}}fuelstation_stats_cache[fuelstation_stats_select]=z[1].stats;dialogFuelstation("stats",fuelstation_stats_select)}if(B=="fuelstation_harvest"){if(z[1]&&z[1].levelup&&z[1].levelup.level){levelupAlert(z[1].levelup.level,z[1].levelup.leveltitle)}}}if(B=="autoplant_buy_load"){autoPlantCommit(O,1)}if(B=="cancelguildproduction"){showMain()}if(z.guildjob_log){jobProductionInfoFlyer(v,O,z.guildjob_log)}}}}function initZones(a,b){farmMove(a);return false}function killGardenTimeruns(){for(var a=1;a<=fieldsamount;a++){if(to[a]){window.clearTimeout(to[a])}}}function setTutorialLine(){if(tutorial){if(tutorialarray&&tutorialarray[tutorial]){$("tutoriallinecontent").innerHTML=tutoriallinepre+tutorialarray[tutorial];showDiv("tutorialline")}showDiv("blockmainnavi");setBlockMain(2);if(tutorial==1){showTutorial(1)}else{if(tutorial==2){showTutorial(3,1)}else{if(tutorial==4){setBlockMain(1);showTutorial(7,1)}else{if(tutorial==5){setBlockMain(2);showTutorial(8,1)}else{if(tutorial==6&&currentuserlevel==1){showTutorial(10)}else{if(tutorial==7){showTutorial(12,1)}else{if(tutorial==8){showTutorial(14,1)}else{if(tutorial==9){showTutorial(17,1);setBlockMain(1)}else{setBlockMain(2)}}}}}}}}}else{if(currentuserlevel==1&&tutorial==0){if($("tutorialline")){$("tutoriallinecontent").innerHTML=tutoriallinepre+tutorialreachnextlevel;showDiv("tutorialline")}}else{if(tutorial==0&&$("tutorialline")){hideDiv("tutorialline")}}}if(!tutorial){hideDiv("blockmainnavi")}}var poweruprack=0;var powerupactive=0;var player_guild=0;var player_guildmemberstatus=0;var freegardenspeedup=0;var freegardenspeedup2=0;var freegardenspeeduptelekom=0;function bulldozeZone(a){if(farms_data.farms[farm][a].bulldoze.premium==1){var b="bulldozeZoneCommit2("+a+");"}else{var b="letsBulldozeZone("+a+");"}var c=str_replace("%MONEY%","<b>"+formatPrice(farms_data.farms[farm][a].bulldoze.cost)+"</b>",infobulldozegroundtext);globalcommitbox(infobulldozegroundheadline,c,b)}function bulldozeZoneCommit2(a){var b="letsBulldozeZone("+a+");";var c=premiumzoneinfo;globalcommitbox(infobulldozegroundheadline,c,b)}function letsBulldozeZone(a){farmAction("bulldozeground",farm,a)}function specialZoneFieldHandler(a){showDiv("transp");showDiv("gardenmaincontainer");initGarten(a)}function destructBuildingInit(a,d){if(checkPartnerPortal()||isSteam()==1){var b="destructBuilding("+a+");"}else{var b="destructBuildingInit2("+a+");"}var c=infodestructbuildingcommit;if(d&&d==17){c=str_replace("%CARPENTRYBONUS%",carpentry_bonus,t_carpentry_destruct1)}globalcommitbox(infodestructbuildingheadline,c,b)}function destructBuildingInit2(a){var b="destructBuilding("+a+");";var c=infodestructbuildingcommit2+'<br><input type="password" id="destruct_pass" name="destruct_pass">';globalcommitbox(infodestructbuildingheadline2,c,b)}function destructBuilding(a,c){if(checkPartnerPortal()||isSteam()==1){var b="none"}else{if($("destruct_pass").value!=""){if(upportaluser==1){var b=$("destruct_pass").value}else{var b=$("destruct_pass").value}}else{return false}}farmAction("destructbuilding",farm,a,b)}function afterDestruction(a){if(gametimer.carpentrytimer){clearTimer("carpentrytimer")}if(checkPartnerPortal()||isSteam()==1){}else{$("destruct_pass").value=""}window.clearInterval(run[a]);run[a]=0;temp_reachlimit[a]=0;hideDiv("globaltransp");hideDiv("globalbox");speedLinks()}function updateBuilding(a,c,b){farmAction("updatebuilding",farm,a,c,b)}function updateBuildingResponse(b,a,e,d,c){hideDiv("transp");hideDiv("headquarteroptions")}function fillBuildBox(a){if((currentuserlevel<buildingallowedminlevel)&&tutorial==0){globalerrorbox(str_replace("%LEVEL%",buildingallowedminlevel,noupdate_lowlevel))}else{farmAction("getbuildingoptions",farm,a)}}function buyBuildingCategoryInfo(b,h,d){var a="";if(in_array("ex",farm_garden_products[farm])&&h==1){a=t_building_buy_exotic_info}if(in_array("alpin",farm_garden_products[farm])&&h==1){a=t_building_buy_alpine_info}if(a==""){buyBuildingCommit(b,h,d)}else{var c=errorheadline;var e="buyBuildingCommit("+b+","+h+",'"+d+"')";globalcommitbox(c,a,e)}}function buildBoxResponse(r,h){buildinginfos[0]=r.options;if(r.main){var e="";for(buildingid in r.options){var a=r.options[buildingid];var q="buyBuildingCommit("+h+", "+buildingid+", '"+a[10]+"')";if(farm_garden_products[farm]){q="buyBuildingCategoryInfo("+h+", "+buildingid+", '"+a[10]+"')"}if(buildingid==6){q="createGuildCommit("+h+", 0, 0)"}var l='<div class="name">'+a[10]+"</div>";if(a.block){q="";l+='<div class="block">';if(a.block.level){var m=t_requirements.replace("%NAME%",a[10]);l+="<div>"+m.replace("%LEVEL%",a[6])+"</div>"}if(a.block.quest){var m=t_needs_quest.replace("%CAMPAIGN%",a[14].campaign);l+="<div>"+m.replace("%QUEST%",a[14].questid)+"</div>"}if(a.block.unique){l+="<div>"+t_building_only_once_allowed+"</div>"}if(a.block.premium){l+="<div>"+t_error1053+"</div>"}if(a.block.farm){l+="<div>"+t_build_only_info+a[13].join()+"</div>"}l+="</div>"}var n="";if(buildingid==1&&farm==5){n="_ex"}if(buildingid==1&&farm==6){n="_alpin"}if(buildingid==1&&farm==8){n="_water"}if(buildingid==1&&farm==10){n="_spice"}var d="";if(user_bar<a[1]){d="invalid";q=""}e+='<div class="link option" onclick="'+q+'" onmouseover="showDiv(\'buildBoxItem'+buildingid+"')\" onmouseout=\"hideDiv('buildBoxItem"+buildingid+"')\">";e+='  <div class="img buildoption'+buildingid+n+'"></div>';if(!in_array(tutorial,[1,7])){e+='<div class="price '+d+'">'+formatPrice(a[1])+"</div>"}if(a.block){e+='<div class="blocked"></div>'}e+='  <div id="buildBoxItem'+buildingid+'" class="ttbox">'+l+"</div>";e+="</div>"}$("buildboxcontent").innerHTML=e;showDiv("transp");showDiv("buildbox")}if(r.addon){if(run[h]){globalerrorbox(noupdate_whileproduction)}else{var a=r.upgrade;var e="";var q="callCommitBox("+h+","+a[9]+","+a[10]+")";if(a[10]==1&&a[9]==5){var c=r.options[a[10]][9]+a[2];q="updateChoiceProduct("+h+","+a[9]+","+a[10]+","+c+","+currentuserlevel+");"}var l="";var b="";if(a[2]>0){if(a[10]==1){if(a[9]==5){l+="<div>"+updatetext[7].replace("%MORE%",(r.options[a[10]][9]+a[2]))+"</div>"}else{l+=updatetext[6].replace("%MORE%",(5+(r.options[a[10]][9]+a[2])))}b="bo_waterboni.jpg"}else{l+=updatetext[1].replace("%MORE%",(r.options[a[10]][9]+a[2]));var n="";if(a[10]==3){n="2"}b="bo"+n+"_animalbonus_"+a[10]+".jpg"}}if(a[3]>0){l+="<div>"+updatetext[2].replace("%MORE%",a[3])+"</div>";if(a[10]<=6){b="bo_timebonus_"+a[10]+".jpg"}else{b="bo_timebonus_"+a[10]+"_"+a[9]+".jpg"}}if(a[4]>0){l+="<div>"+updatetext[3].replace("%MORE%",a[4])+"</div>";b="bo_cropbonus_"+a[10]+".jpg"}e+='<div class="upgrade link" onclick="'+q+'" onmouseover="showDiv(\'buildboxupgrade_tt\')" onmouseout="hideDiv(\'buildboxupgrade_tt\')">';e+='  <img class="img" src="'+imgpath+b+'">';e+='  <div class="stars" style="width:'+(a[9]*13)+'px"></div>';var n="";if(carpentry_bonus>0){n="*"}if(a[0]>0){e+='<div class="price">'+formatPrice(a[0])+n+"</div>"}if(a[8]>0){e+='<div class="price">'+a[8]+"&nbsp;"+t_coins+"</div>"}e+='  <div id="buildboxupgrade_tt" class="ttbox">'+l+"</div>";e+="</div>";if(carpentry_bonus>0){e+='<div class="bonusinfo">'+t_price_add_carpentry.replace("%BONUS%",carpentry_bonus)+"</div>"}$("headquarteroptionscontent").innerHTML=e;showDiv("transp");showDiv("headquarteroptions")}}if(tutorial==1){showTutorial(2,2)}else{if(tutorial==7){showTutorial(13,2)}}}function callCommitBox(a,h,e){var b="updateBuilding("+a+","+h+","+e+");";if(e==1){var c=infoupdatebuildingfield;var d=infoupdatebuildingcommitfield}else{var c=infoupdatebuilding;var d=infoupdatebuildingcommit}globalcommitbox(c,d,b)}function updateBuildingBox(d,q,a,n,b){var e=0;for(_obj in buildinginfos[0]){e++}var m=buildinginfos[0];var c="";for(var l=1;l<=e;l++){if(m[l]){if(q==m[l][0]){var r="buyBuildingCommit("+d+","+q+",'"+m[l][10]+"',"+b+");";if(q==6){r="createGuildCommit("+d+","+b+",0);"}var h='<div class="link" style="position:absolute; top:'+n+"px; left:"+a+'px;" ';h+='onclick="'+r+'" onmouseover="showDiv(\'buildingoptionsinfo'+q+"');\" onmouseout=\"hideDiv('buildingoptionsinfo"+q+"');\">";h+='<img src="'+imgpath+"bo_"+str_replace(".png",".jpg",m[l][5])+'" >';if(tutorial!=1&&tutorial!=7){h+='<div class="pricesign">'+formatPrice(m[l][1])+"</div>"}h+="</div>";c+='<div style="position:absolute; top:'+(n+50)+"px; left:"+(a+50)+'px;" id="buildingoptionsinfo'+q+'" class="blackbox tooltip_bo" onmouseover="showDiv(\'buildingoptionsinfo'+q+"');\" onmouseout=\"hideDiv('buildingoptionsinfo"+q+"');\">"+str_replace("%BUILDING%",m[l][10],infobuildingbuytext)+"</div>"}}}return h+c}function updateChoiceProduct(d,a,l,h,m){var e="";e+=str_replace("%MORE%",h,buildinglastupdategardenintro)+"<br>";e+='<select name="updatechoiceproduct" id="updatechoiceproduct" style="margin-top:10px;">';if(farm>4){f=farm}else{f=1}var b=farm_garden_products[f];for(var c in produkt_name){if(produkt_name[c]&&produkt_level[c]<=m&&in_array(produkt_category[c],b)){e+='<option value="'+c+'">'+produkt_name[c]+"</option>"}}e+="</select>";var n="buyBuildingGardenChoiceProduct("+d+","+l+","+a+")";globalcommitbox(buildinglastupdategardenheadline,e,n)}function buyBuildingGardenChoiceProduct(a,d,c){var b=$("updatechoiceproduct").value;farmAction("changegardenspecial",farm,a,b)}function changeGardenSpecial(h,m){var c="";if(changegardenspecialcost>0){c+="<span onmouseover=\"showDiv('chggardenspecialinfomoney');\" onmouseout=\"hideDiv('chggardenspecialinfomoney');\">";c+='<img src="'+imgpath+'money.gif" width="12" height="12">&nbsp;'+formatPrice(changegardenspecialcost)+"</span>";c+="&nbsp;&nbsp;"}c+="<span onmouseover=\"showDiv('chggardenspecialinfocoins');\" onmouseout=\"hideDiv('chggardenspecialinfocoins');\">";c+='<img src="'+imgpath+'menu/coins.gif" width="10" height="10">&nbsp;'+changegardenspecialcoins+"</span>";if(changegardenspecialcost>0){c+='<div class="blackbox" id="chggardenspecialinfomoney" style="display:none; z-index:100; position:absolute; top:-2px; left:0px;">'+t_money+"</div>";var a=105}else{var a=0}c+='<div class="blackbox" id="chggardenspecialinfocoins" style="display:none; z-index:100; position:absolute; top:-2px; left:'+a+'px;">'+t_coins+"</div>";var b=c+"<br><br>"+gardenupdatechangespecialinfo;var l="";l+=b+"<br>";l+='<select name="updatechoiceproductchg" id="updatechoiceproductchg">';if(farm>4){f=farm}else{f=1}var d=farm_garden_products[f];for(var e in produkt_name){if(produkt_name[e]&&parseInt(produkt_level[e])<=parseInt(currentuserlevel)&&in_array(produkt_category[e],d)&&produkt_category[e]!="z"){if(e!=m){l+='<option value="'+e+'">'+produkt_name[e]+"</option>"}}}l+="</select>";var n="changeGardenSpecialGo("+h+")";globalcommitbox(gardenupdatechangespecialheadline,l,n)}function changeGardenSpecialGo(a){var b=$("updatechoiceproductchg").value;farmAction("changegardenspecial",farm,a,b)}function buyBuildingCommit(a,m,c){var l="";var h="";if(carpentry_bonus>0){l="*";h='<div class="bonusinfo">'+str_replace("%BONUS%",carpentry_bonus,t_price_add_carpentry)+"</div>"}if(farms_data.farms[farm][a].premium){var b="buyBuildingCommit2("+a+","+m+",'"+c+"');"}else{var b="buyBuilding("+a+","+m+")"}var d=str_replace("%BUILDING%",c,infobuildingbuycommittext);var e=str_replace("%COST%","<b>"+formatPrice(buildinginfos[0][m][1])+"</b>"+l,t_buybuilding+h);globalcommitbox(d,e,b)}function buyBuildingCommit2(a,h,c){var b="buyBuilding("+a+","+h+")";var d=str_replace("%BUILDING%",c,infobuildingbuycommittext);var e=premiumzoneinfo;globalcommitbox(d,e,b)}function buyBuilding(a,b){farmAction("buybuilding",farm,a,b)}function buyBuildingResponse(b,a,d){if(b[7]){if(b[7][0]==1){b[7][1]=str_replace("%MONEY%",formatPrice(b[7][1]),gambletext[b[7][0]]);globalerrorbox(b[7][1])}}if(b[5]>0){tutorial=b[5]}if(tutorial==2){showTutorial(3,1)}if(tutorial==8){showTutorial(14,1)}var c=0;hideDiv("transp");hideDiv("globaltransp");hideDiv("buildbox");hideDiv("globalbox");speedLinks()}function shredderCommit(){var c="";c+="<div>"+shredder_product+"</div>";c+='<div style="margin-bottom:5px;"><select id="shredderselect" name="shredderselect" onchange="fillShredderAmount();">';for(var b in produkt_name){if(checkRackItem(b)>0&&!in_array(produkt_category[b],["ex","water","spice"])){c+='<option value="'+b+'">'+produkt_name[b]+"</option>"}}c+="</select></div>";c+="<div>"+shredder_amount+'</div><div><input type="text" name="shredderamount" id="shredderamount" maxlength="5" size="20"></div>';var a="shredderStartSecure()";globalcommitbox(shredder_headline,c,a);fillShredderAmount()}function shredderStartSecure(a,c){var a=parseInt($("shredderselect").value);var c=parseInt($("shredderamount").value);if(c<0){return false}var b="shredderStart("+a+","+c+");";var d=shredder_commit;globalcommitbox(shredder_headline,d,b)}function shredderStart(a,b){farmAction("shredderstart",farm,0,a,b)}function fillShredderAmount(){var a=$("shredderselect").value;$("shredderamount").value=checkRackItem(a)}function hqBuildingOptions(e,d,c){if(e==1){var a="createNewRack()";if(!d){var b=str_replace("%COST%","<b>"+formatPrice(farmhouse_rack_data.price)+"</b>",infoheadquarterbuyracktext);if(farmhouse_rack_data.quest&&farmhouse_rack_data.altprice){b+='<div class="bonusinfo">'+str_replace("%COST%",formatPrice(farmhouse_rack_data.altprice),t_rack6_info)+"</div>";b=str_replace("%QUEST%",farmhouse_rack_data.quest,b)}}else{var b=str_replace("%COST%","<b>"+d+"</b>",infoheadquarterbuyracktext)}}if(e==2){var a="farmAction('map_buyfarm', 1, 1, "+c+")";var b=str_replace("%COST%","<b>"+d+"</b>",infoheadquarterbuyfarmtext)}globalcommitbox(0,b,a)}function createNewFarm(){farmAction("createnewfarm",farm,0)}function createNewFarmResponse(a){farmamount=a[2];hideDiv("headquarteroptions");hideDiv("iconnewfarm")}function createNewRack(){farmAction("createnewrack",farm,0)}function createNewRackResponse(a){userracks=a[2];if(a[3]&&a[3]=="DECO"){decorack=1;showDiv("rackcontrol")}hideDiv("iconnewrack");hideDiv("headquarteroptions")}function showAwards(l,b,a,h,d){var e='<div id="awardsimg'+b+'" style="position:relative; font-size:10px; margin-left:2px;">';if(a>0){var c="onmouseover=\"document.getElementById('"+l+"goldanz"+b+"').style.display='block';\" onmouseout=\"document.getElementById('"+l+"goldanz"+b+"').style.display='none';\"";e+='<div class="link" style="float:left; margin-top:2px;" '+c+'><img src="'+imgpath+'medaillen/10er.gif" border="0"></div>';e+='<div style="float:left; display:none;" id="'+l+"goldanz"+b+'">'+a+"</div>"}if(h>0){var c="onmouseover=\"document.getElementById('"+l+"silberanz"+b+"').style.display='block';\" onmouseout=\"document.getElementById('"+l+"silberanz"+b+"').style.display='none';\"";e+='<div class="link" style="float:left; margin-top:2px;" '+c+'><img src="'+imgpath+'medaillen/5er.gif" border="0"></div>';e+='<div style="float:left; display:none;" id="'+l+"silberanz"+b+'">'+h+"</div>"}if(d>0){var c="onmouseover=\"document.getElementById('"+l+"bronzeanz"+b+"').style.display='block';\" onmouseout=\"document.getElementById('"+l+"bronzeanz"+b+"').style.display='none';\"";e+='<div class="link" style="float:left; margin-top:2px;" '+c+'><img src="'+imgpath+'medaillen/1er.gif" border="0"></div>';e+='<div style="float:left; display:none;" id="'+l+"bronzeanz"+b+'">'+d+"</div>"}e+='<div style="clear:both;"></div>';e+="</div>";return e}function cancelProduction(a,c){var b="farmAction('cancelproduction', "+farm+", "+a+", "+c+")";globalcommitbox(productionfinishheadline,productionfinish,b)}function buildProductionOptions(a,d){var c="<div>";if(innerinfos_data[1]["in"]){for(var b=0;b<innerinfos_data[1]["in"].length;b++){c+=htmlProductionSlotOption(a,innerinfos_data[1]["out"][b][1],innerinfos_data[1]["in"][b],innerinfos_data[1]["need"][b],innerinfos_data[1]["out"][b][2],0,d)}}c+=' <div class="clear"></div>';if(checkIsValidGuildJobProduct()){c+='<div class="headline">'+t_select_product_guild+"</div>";for(var b=0;b<innerinfos_data[1]["in"].length;b++){if(job_data.guild_job_data.data.products[innerinfos_data[1]["out"][b][1]]){c+=htmlProductionSlotOption(a,innerinfos_data[1]["out"][b][1],innerinfos_data[1]["in"][b],innerinfos_data[1]["need"][b],innerinfos_data[1]["out"][b][2],1,d)}}c+='<div class="clear"></div>'}c+="</div>";globalBoxFlex(t_select_product,c,0,0,1)}function initLocation(a){currentposition=a;hideDiv("guildmaincontainer");hideDiv("gardenmaincontainer");if($("commitboxcrop")){hideDiv("commitboxcrop")}hideDiv("globalbox");hideDiv("globaltransp");hideDiv("transp2");if(farms_data.farms[farm][a].animals>0){buildingInnerAction("init",farm,a)}else{if($("innercontent")){$("innercontent").innerHTML=""}innerInfos(a)}}function innerInfos(a){farmAction("innerinfos",farm,a)}var carpentry_data={};var pony_data={};var innerinfos_data={};function innerInfosResponse(b){var a=innerinfos_data;showDiv("transp");showDiv("innermaincontainer");locationinfo=a[1];var d=["beeaniinner","kaeserei_info","mayo_info","wollerei_info","update_crop_2","update_crop_3","update_crop_4","update_crop_5","update_crop_11_1","update_crop_11_2","update_crop_12","update_time_2","update_time_3","update_time_4","update_time_5","update_time_11_1","update_time_11_2","update_time_12","update_time_15","update_13_2","update_13_4","update_13_5","update_13_5_ani","update_14_2","update_14_4","update_14_5","update_14_5_1","update_14_5_2","update_16_2","update_16_3","update_16_4","update_16_4_ani","update_16_5","update_21_2","update_21_3","update_21_4","update_21_5","update_25_2","update_25_3","update_25_4","update_25_5"];for(var c=0;c<d.length;c++){hideDiv(d[c])}if(locationinfo.buildingid==17){carpentry_data=locationinfo;carpentryBuild(b)}else{if(locationinfo.buildingid==18){pony_data=locationinfo;ponyBuild(b)}else{if(locationinfo.buildingid==20){buildFuelstation(b)}else{if(in_array(locationinfo.buildingid,[13,14,16,21])){factory.data=locationinfo;factory.inner(b)}else{if(factory_rent_slot_config&&in_array(locationinfo.buildingid,factory_rent_slot_config.buildings)){factory.data=locationinfo;factory.inner(b)}}}}}}function setCompleteProductionAdvanced(a){if($("productionbar7_"+farm+"_"+a)){$("productionbar7_"+farm+"_"+a).style.top="8px"}if($("productionbar8_"+farm+"_"+a)){$("productionimg8_"+farm+"_"+a).src=imgpath+"cheese_8.gif"}if($("productionbar9_"+farm+"_"+a)){$("productionbar9_"+farm+"_"+a).style.height="118px"}if($("productionbar10_"+farm+"_"+a)){$("productionbar10_"+farm+"_"+a).style.height="73px"}if($("productionyogurt"+farm+"_"+a)){$("productionyogurt_inner"+farm+"_"+a).style.top="0px"}if($("productionketchup"+farm+"_"+a)){$("productionketchup_inner"+farm+"_"+a).style.height="181px"}if($("productionwool"+farm+"_"+a)){$("productionwool_inner"+farm+"_"+a).style.height="181px"}if($("productionangora"+farm+"_"+a)){$("productionangora_inner"+farm+"_"+a).style.height="160px"}if($("advancedproduction"+farm+"_"+a)){$("advancedproduction"+farm+"_"+a).innerHTML=statusProductionComplete}else{if($("productioninfotime2_"+farm+"_"+a)){$("productioninfotime2"+farm+"_"+a).innerHTML=statusProductionComplete}}var c=advancedproductioncropcommit;var b="getAdvancedCrop("+a+");";var d="closeLocationwait("+a+");";commitboxcrop(advancedproductioncropcommit,c,b,d)}function createAdvancedProductionCommit(a,e,c,h){var d=advancedproduction_commit;if(c){d=t_select_product_guild_info}var b="createAdvancedProduction("+a+","+e+", "+c+", "+h+")";commitboxinner(advancedproduction_headline,d,b)}function createAdvancedProduction(a,c,b,d){farmAction("setadvancedproduction",farm,a,c,b,d)}function createAdvancedProductResponse(b,a,d,h){var c=b;var e=c[1];hideDiv("transp2");hideDiv("commitboxinner");hideDiv("globalbox");hideDiv("globaltransp");initLocation(a)}function setCurrentAdvancedProduction(){var a=info[6];if(stopanimation==0){showDiv("productionani"+a)}else{showDiv("productionani"+a+"_static")}setInfoBlock(position,info)}function showFeedDropZone(a){$("foodcontainer"+a).style.border="2px solid #f00"}function hideFeedDropZone(a){$("foodcontainer"+a).style.border="0px solid #f00"}function closeLocationwait(a){hideDiv("transp2");hideDiv("feedcommit");hideDiv("locationwait");if($("commitboxcrop")){hideDiv("commitboxcrop")}hideDiv("globalbox");hideDiv("globaltransp");hideDiv("transp");hideDiv("innermaincontainer")}function closeAfterCrop(a){setNoneProduction(a,locationinfo)}function setCurrentProduction(a,d){var e=d[6];if(e==5){showDiv("beeaniinner")}showDiv("feed"+e);setInfoBlock(a,d);var b=0;if(d[2]){for(var c=1;c<5;c++){if(d[2][c]){if(checkRackItem(d[2][c][1],farm)){if(b==0){b=d[2][c][3]}else{if(d[2][c][3]<b){b=d[2][c][3]}}}}}}b=Math.floor(b/d[1][2]);if(d[10]>=(time[a]-b)){if($("infobubble"+e)){$("infobubble"+e).innerHTML=infotext[e][4]}}else{if($("infobubble"+e)){$("infobubble"+e).innerHTML=str_replace("%TIME%",'<span style="color:red;">'+formatTime(d[10])+"</span>",infotext[e][2])}}}function setNoneProduction(a,h){var l=h[6];hideDiv("transp2");if($("commitboxcrop")){hideDiv("commitboxcrop")}hideDiv("globalbox");hideDiv("globaltransp");hideDiv("locationwait");hideDiv("infoblock"+l);if($("feed"+l)){hideDiv("feed"+l)}hideDiv("commitboxinner");if($("beeaniinner")){hideDiv("beeaniinner")}var e=h[4][2];var d="";if(h[7]){e=parseInt(h[4][2])-(parseInt(h[4][2])/100*parseInt(h[7]));if(setarab==1){d='<span style="color:red; direction: ltr; unicode-bidi: embed">&nbsp;(-'+h[7]+"%)</span>"}else{d='<span style="color:red;">&nbsp;(-'+h[7]+"%)</span>"}}if(!h[2]){var b='<div class="kp'+h.need[0]+' buildinginner_feedproductsimg"></div>';var c=str_replace("%PRODUCT1%",b+'<div class="buildinginner_feedproductstxt">'+produkt_name[h.need[0]]+'</div><div style="clear:both;"></div>',infotext_nonefood);var b='<div class="kp'+h.need[1]+' buildinginner_feedproductsimg"></div>';c=str_replace("%PRODUCT2%",b+'<div class="buildinginner_feedproductstxt">'+produkt_name[h.need[1]]+'</div><div style="clear:both;"></div>',c);$("infobubble"+h[6]).innerHTML=c}else{$("infobubble"+h[6]).innerHTML=str_replace("%TIME%",'<span style="color:red;">'+formatTime(e)+"</span>"+d,infotext[l][1])}}function setCompleteProduction(a,h){if(h){var b=h[6];var c=h[1][1];setInfoBlock(a,h)}else{var b=locationinfo[6];if(locationinfo[1]){var c=locationinfo[1][1]}setInfoBlock(a,locationinfo)}if($("infobubble"+b)){$("infobubble"+b).innerHTML=infotext[b][3]}if($("productionbar"+farm+"_"+a)){$("productioninfotime"+farm+"_"+a).innerHTML=statusProductionComplete}if($("productionbar"+farm+"_"+a)){$("productionbar"+farm+"_"+a).style.top="0px"}if($("productionbar2_"+farm+"_"+a)){$("productionbar2_"+farm+"_"+a).style.top="-6px";$("productionbar2_"+farm+"_"+a).style.left="-24px"}if($("productionbar3_"+farm+"_"+a)){$("productionbar3_"+farm+"_"+a).style.top="0px";$("productionbar3_"+farm+"_"+a).style.height="102px"}if($("productionbar4_"+farm+"_"+a)){$("productionbar4_"+farm+"_"+a).style.top="0px"}if($("productionbar7_"+farm+"_"+a)){$("productionbar7_"+farm+"_"+a).style.top="8px"}if($("productionbar15_"+farm+"_"+a)){$("productionbar15_"+farm+"_"+a).style.height="144px"}if(locationinfo[1]){var d=(parseInt(locationinfo[1][2])*parseInt(locationinfo[4][3]))+parseInt(locationinfo[8])}if(infotext[b]){var e=infotext[b][3]}else{var e=""}}function setInfoBlock(b,e){if(e){buildingid=e[6];showDiv("infoblock"+buildingid);var h=0;if(e[8]>0){h=(parseInt(e[8])*parseInt(e[1][2]))}var d="";var c=((parseInt(e[4][3])*parseInt(e[1][2]))+parseInt(h));var a="";if(produkt_ernte_bonus[e[4][1]]){a='&nbsp;<span class="rack_cropbonus">+'+(produkt_ernte_bonus[e[4][1]]*parseInt(e[1][2]))+"</span>"}d+='<span class="productnamewhite">'+e[4][5]+"</span><br>"+croptext+" "+c+a;if(e[8]>0){d+='<span id="bonusinfo"> (+'+h+")</span>"}d+='<div id="cancelproduction" onclick="killProduction('+b+')" class="important" onmouseover="showDiv(\'cancelproductioninfo\');" onmouseout="hideDiv(\'cancelproductioninfo\');">';d+='<img id="cancel" src="'+imgpath+'cancel_off.png" onmouseover="changeButton(\'cancel\',1,1);" onmouseout="changeButton(\'cancel\',0,1);">';d+='<div id="cancelproductioninfo" class="blackbox" onmouseover="showDiv(\'cancelproductioninfo\');" onmouseout="hideDiv(\'cancelproductioninfo\');">'+terminateproduction+"</div>";d+="</div>";document.getElementById("productioninfo"+b).innerHTML=d}}function killProduction(a){var c="";c+=productionfinish;var b="deleteProduction("+a+")";commitboxinner(productionfinishheadline,c,b)}function deleteProduction(a){farmAction("deleteproduction",farm,a)}function deleteProductionResponse(b,a){window.clearInterval(run[a]);temp_reachlimit[a]=0;run[a]=0;if(locationinfo[6]>6){hideDiv("transp2");hideDiv("commitboxinner");hideDiv("globalbox");hideDiv("globaltransp");initLocation(a)}else{setNoneProduction(a,locationinfo)}}function getAdvancedCrop(a){farmAction("getadvancedcrop",farm,a)}function getAdvancedCropResponse(b,a){var d=b;var b=d[0];window.clearInterval(run[a]);temp_reachlimit[a]=0;run[a]=0;if(d[3]&&d[3].level){levelupAlert(d[3].level,d[3].leveltitle)}if(d[2]){var c="hideDiv('globalbox'); hideDiv('globaltransp'); initLocation("+a+");";globalerrorbox(d[2],c)}else{initLocation(a)}}function setEndproductImage(c,b,e,d){var b=b;var n=e;var d=d;var a=a;var h=parseInt(n)*((parseInt(c)%parseInt(d))-parseInt(1));var m=parseInt(n)*((Math.ceil(parseInt(c)/parseInt(d)))-parseInt(1));var l=new Array();l[1]=h;l[2]=m;return l}function setCustomerStats(){if(customerstats){var b="";b+="<b>"+str_replace("%DAYS%",farmichronikdays,farmistatsheadline)+"</b><br><i>"+farmistatsinfo+"</i><br><br>";for(var a in customerstats){if(customerstats[a]&&a!="adstart"&&customerstats[a]["count"]>0){if(setarab==1){b+=str_replace("%FARMI%","<b>"+customerstats[a]["count"]+"</b>",customerarecalled)+"&nbsp;"+a+"<br>"}else{b+=a+"&nbsp;"+str_replace("%FARMI%","<b>"+customerstats[a]["count"]+"</b>",customerarecalled)+"<br>"}if(customerstats[a]["serve"]){b+=farmistatsserve+":&nbsp;"+customerstats[a]["serve"]+"<br>"}if(customerstats[a]["fired"]){b+=farmistatsfired+":&nbsp;"+customerstats[a]["fired"]+"<br>"}}}if(currentad.startad){b+="<br>"+adbegin+"<br><b>"+currentad.startad+"</b><br>";b+=adend+"<br><b>"+currentad.endad+"</b><br>"}$("customerstatsinfo").innerHTML=b;showDiv("customerstatsinfo")}}function setFarmis(){customers.setFarmis(farmisinfo[0]);customers.setPositions();customers.build();var b=farmisinfo[0];farmilist=[];for(var a=0;a<b.length;a++){farmilist[a]=1}if(farmisinfo[2]){customerstats=farmisinfo[2];$("customerstats").onmouseover=function(c){setCustomerStats()};$("customerstats").onmouseout=function(c){hideDiv("customerstatsinfo")}}else{$("customerstats").onmouseover=function(c){};$("customerstats").onmouseout=function(c){}}}function showCart(c,d){var C={};if(d==1){var e={};for(var A=0;A<farmersmarket_data.farmis.length;A++){if(farmersmarket_data.farmis[A].id==c){var B=farmersmarket_data.farmis[A]}e[A]=farmersmarket_data.farmis[A].id}}else{var B=farmisinfo[0][c];var e=farmisinfo[0];B.cart=[];for(var A=1;A<=7;A++){if(B["p"+A]>0){var E={pid:B["p"+A],amount:parseInt(B["a"+A])};B.cart.push(E)}}}clearCart();var u="";var G=0;var D="";var v=B.price;var w=B.cart;for(var A=0;A<w.length;A++){var m=w[A].pid;var b=parseInt(w[A].amount);var l="";if(m>0&&b>0){if(checkRackItem(m)>=b){D="color:#333366; font-weight:bold; font-size:16px;"}else{D="color:#f00; font-weight:bold; font-size:16px;";G=1}u+='<div style="margin-bottom:5px; font-size:16px;">';u+='<div class="cartinner_productimg kp'+m+'"></div>';u+='<div class="cartinner_productinfo" style="'+D+'">'+b+"x "+produkt_name[m]+" "+l+"</div>";u+='<div style="clear:both;"></div>';u+="</div>"}}var I="handleFarmi("+c;if(d==1){I="handleFlowerFarmi("+c}var h="";if(B.points){h+='<div style="font-size:20px;"><div class="farmcartsumtext">'+t_pony_points+'</div><div class="farmcartsumamount">&nbsp;'+formatNumber(B.points)+'</div><div style="clear:both;"></div></div>'}var a=0;var l="";if(specialbonus){var H=specialbonus.findBonus({key1:"farmis",key2:"money"});if(H){a+=H.money}var F="farm";if(d==1){F="flowers"}var H=specialbonus.findBonus({key1:"consumer",key2:"money"});if(H&&in_array(F,H.types)){a+=H.money}}if(!d&&stall&&stall.data&&stall.data.milestones&&stall.data.milestones.farmis){a+=stall.data.milestones.farmis}if(a>0){l='<div style="float:left; font-size:12px; color:green;">('+t_specialbonus_farmis_money_info.replace("%BONUS%",Math.round(a*100))+")</div>";v=Math.ceil(v*(1+a))}h+='<div style="font-size:20px;"><div class="farmcartsumtext">'+farmcartsum+'</div><div class="farmcartsumamount">&nbsp;'+formatPrice(v)+"</div>"+l+'<div style="clear:both;"></div></div>';h+='<div style="margin-bottom:5px;">'+farmcartsubmitintro+"</div>";h+='<div class="farmicartbutton1">';if(G==0){h+='<button class="link button_big" type="button" onclick="'+I+', 1)">'+farmcartyes+"</button>&nbsp;&nbsp;&nbsp;"}h+='<button class="link button_big" type="button" onclick="clearCart();">'+farmcartlater+"</button>";h+="</div>";h+='<div class="farmicartbutton2">';h+='<button class="link button_big" type="button" onclick="'+I+', 2)" style="font-weight:bold; color:#f00;">'+farmcartno+"</button>";h+="</div>";var z='<span style="font-size:20px;">'+farmcartintro+"</span>";if(d==1){var n=0;var r=0;var s=0;for(var t in e){t=parseInt(t);if(e[t]==c){if(e[(t-1)]){n=e[(t-1)]}if(e[(t+1)]){r=e[(t+1)]}s=e[t]}}if(n>0){z+='<div id="ell" class="link farmicartnaviposleft" onclick="showCart('+n+', 1)"></div>'}if(r>0){z+='<div id="elr" class="link farmicartnaviposright" onclick="showCart('+r+', 1)"></div>'}}else{if(c>=1){for(var q=parseInt(c-1);q>=0;q--){if(farmilist[q]==1&&e[q]){z+='<div id="ell" class="link farmicartnaviposleft" onclick="showCart('+q+", "+d+')"></div>';break}}}if(parseInt(c+1)<16){for(var q=parseInt(c+1);q<16;q++){if(farmilist[q]==1&&e[q]){z+='<div id="elr" class="link farmicartnaviposright" onclick="showCart('+q+", "+d+')"></div>';break}}}}$("cartheader").innerHTML=z;$("cartcontent").innerHTML=u;$("cartsubmit").innerHTML=h;$("carttrend").className="";if(B.trend&&B.trend==1&&!d){$("carttrend").addClassName("carttrend"+B.trend)}if(B.points){$("cartsubmit").removeClassName("cartsubmit");$("cartsubmit").addClassName("cartsubmit_flower")}else{$("cartsubmit").removeClassName("cartsubmit_flower");$("cartsubmit").addClassName("cartsubmit")}showDiv("transp");showDiv("cart")}function clearCart(){$("cartcontent").innerHTML="";$("cartsubmit").innerHTML="";hideDiv("transp");hideDiv("cart")}function handleFarmi(c,a){var b=farmisinfo[0][c].id;farmAction("sellfarmi",farm,1,b,a,c)}function goFarmi(h,b,e){clearCart();customers.leave(e,b);return 1;$("kunde_"+h).style.zIndex=5;$("kundeimg_"+h).style.transform="rotate(0deg)";$("kundeimg_"+h).style.webkitTransform="rotate(0deg)";new Effect.Move($("kunde_"+h),{x:35,y:25,mode:"relative",duration:2,beforeStart:function(){goAwayFarmi(h,b)},queue:{scope:"test"+h}});if(b==2&&is_halloween==1){$("farmiline_special_add"+h).style.left="-35px";new Effect.Fade($("farmiline_special_add"+h),{duration:2,from:0,to:0.6,afterFinish:function(){$("farmiline_special_add"+h).style.opacity=0.6;$("farmiline_special_add"+h).addClassName("farmiline_special_add2")},queue:{scope:"test"+h}});new Effect.Shake($("farmiline_special_add"+h),{duration:5,distance:4,afterFinish:function(){},queue:{scope:"test"+h}});new Effect.Move($("kunde_"+h),{x:640,y:25,mode:"absolute",duration:5,afterFinish:function(){},queue:{position:"end",scope:"test"+h}})}else{new Effect.Move($("kunde_"+h),{x:650,y:25,mode:"absolute",duration:8,afterFinish:function(){$("kundeimg_"+h).style.transform="rotate(90deg)";$("kundeimg_"+h).style.webkitTransform="rotate(90deg)"},queue:{position:"end",scope:"test"+h}})}new Effect.Move($("kunde_"+h),{x:650,y:1500,mode:"absolute",duration:12,afterFinish:function(){$("kundeimg_"+h).style.transform="rotate(0deg)";$("kundeimg_"+h).style.webkitTransform="rotate(0deg)"},queue:{position:"end",scope:"test"+h}});farmisaway[h]=1;for(var d=0;d<maxfarmisinline;d++){if(d>h&&$("kunde_"+d)&&!farmisaway[d]){var c=d;var a=Effect.Queues.get("test"+c);a.each(function(l){l.cancel()});new Effect.Move($("kunde_"+c),{x:-35,y:0,duration:2,beforeStart:function(){moveFarmiLeft(c)},afterFinish:function(){standStillFarmi()},queue:{position:"end",scope:"test"+c}})}}}function goAwayFarmi(c,a){var b=farmisinfo[0][c]["pic"];if(a==1){$("sonne"+c).style.display="block";$("kundeimg_"+c).src=imgpath+"verkauf/kunde_"+b+"_gehkorb.gif"}else{if(a==2){$("wolke"+c).style.display="block";$("kundeimg_"+c).src=imgpath+"verkauf/kunde_"+b+"_geh.gif"}}$("kunde_"+c).onmouseover=function(d){};$("kunde_"+c).onmouseout=function(d){};$("kunde_"+c).onclick=function(d){}}function moveNewFarmi(){var a=15;new Effect.Move($("kunde_"+a),{x:-35,y:0,duration:8,beforeStart:function(){moveFarmiLeft(a)},afterFinish:function(){setFarmiStatus(a)},queue:{position:"end",scope:"test"+a}})}function standStillFarmi(){for(var a=0;a<maxfarmisinline;a++){if(!farmisaway[a]){setFarmiStatus(a)}}}function moveFarmiLeft(b){if(farmisinfo[0][b]){var a=farmisinfo[0][b]["pic"];if($("kunde_"+b)){$("kundeimg_"+b).src=imgpath+"verkauf/kunde_"+a+"_komm.gif"}$("kunde_"+b).onmouseover=function(c){};$("kunde_"+b).onmouseout=function(c){};$("kunde_"+b).onclick=function(c){}}}function setFarmiStatus(b){if(farmisinfo[0][b]){var a=farmisinfo[0][b]["pic"];$("kundeimg_"+b).src=imgpath+"verkauf/kunde_"+a+"_still.gif";$("kunde_"+b).onmouseover=function(c){$("kundeimg_"+b).src=imgpath+"verkauf/kunde_"+a+"_wink.gif";showDiv("blase"+b)};$("kunde_"+b).onmouseout=function(c){$("kundeimg_"+b).src=imgpath+"verkauf/kunde_"+a+"_still.gif";hideDiv("blase"+b)};$("kunde_"+b).onclick=function(c){showCart(b)}}}function initGarten(a){if(tutorial!=3){clearWachseTimeouts()}hideDiv("guildmaincontainer");hideDiv("innermaincontainer");for(var b=1;b<=maxfieldfields;b++){$("field"+b).innerHTML=""}water=new Array();to=new Array();garten_prod=new Array();garten_x=new Array();garten_y=new Array();garten_max_x=new Array();garten_max_y=new Array();garten_name=new Array();garten_gttpic=new Array();garten_zeit=new Array();garten_ernte=new Array();garten_wasser=new Array();garten_kategorie=new Array();garten_entf=new Array();if(tutorial==2){showTutorial(4,2)}setGartenPremiumFeatures(a);if(tutorial>0&&tutorial<=3){hideDiv("gardencancel")}else{showDiv("gardencancel")}getGartenInfo(a)}function setGartenPremiumFeatures(a){if(premium==1||(currentuserlevel>=teasergardenfeaturecropmin&&currentuserlevel<teasergardenfeaturecropmax)){$("cropall").onclick=new Function("cropGarden("+a+")");$("cropall").className="cropall";$("cropall").onmouseover=new Function("showDiv('tooltipcropall')");$("cropall").onmouseout=new Function("hideDiv('tooltipcropall')")}else{$("cropall").onclick=new Function();$("cropall").className="cropall_inactive";$("cropall").onmouseover=new Function("");$("cropall").onmouseout=new Function("")}if(premium==1||(currentuserlevel>=teasergardenfeaturewatermin&&currentuserlevel<teasergardenfeaturewatermax)){$("waterall").onclick=new Function("waterGarden("+a+")");$("waterall").className="waterall";$("waterall").onmouseover=new Function("showDiv('tooltipwaterall')");$("waterall").onmouseout=new Function("hideDiv('tooltipwaterall')")}else{$("waterall").onclick=new Function();$("waterall").className="waterall_inactive";$("waterall").onmouseover=new Function("");$("waterall").onmouseout=new Function("")}}function setWaterBonusInfo(a,c){var b="";if(c){if(c.waterbonus>0){b+="<br><br>"+str_replace("%BONUS%",c.waterbonus,garden_waterbonus)}if(c.specialwaterbonus){if(c.specialwaterbonus[0]>0){b+='<br><div style="width:130px; margin-top:2px;"><div style="float:left; width:15px; height:15px;" class="kp'+c.specialwaterbonus[0]+'"></div>';b+='<div style="float:left; margin-top:1px;">&nbsp;'+str_replace("%BONUS%","+"+c.specialwaterbonus[1],garden_waterbonus)+"</div>";b+='<div style="clear:both;"></div></div>'}}if($("currentwaterbonus")){$("currentwaterbonus").innerHTML=b}if($("currentwaterallbonus")){$("currentwaterallbonus").innerHTML=b}}}function getGartenInfo(a){farmAction("gardeninit",farm,a)}function getGardenInfoResponse(s,D){if(farm<=4){f=1}else{f=farm}var h=farm_garden_products[f];var u="";if(in_array("ex",h)){u="_tropical"}if(in_array("alpin",h)){u="_alpin"}if(in_array("water",h)){u="_water"}if(in_array("spice",h)){u="_spice"}if(f==7){u="_farm7"}$("gardenmaincontainer").className="garden_back"+u;$("anpflanzen").className="anpflanzen"+u;$("giessen").className="giessen"+u;$("ernten").className="ernten"+u;$("waterall").className="waterall"+u;$("cropall").className="cropall"+u;var v=s[1];if(!v){return false}setBuildingInnerInfo(farm,D,v);if(v.plantinfo){gartenshortinfo=v.plantinfo}var d=0;for(_obj in v){d++}var e=new Array();for(var A=1;A<=d;A++){if(v[A]){infos=v[A];if(infos.teil_nr){var q="";var m="";if(!e[infos.teil_nr]){var c="";if(infos.x==1&&infos.y==1){e[infos.teil_nr]=infos.inhalt;showField(D,infos.teil_nr,infos,c)}else{var b=1;var a=1;for(var r=0;r<infos.x;r++){q=parseInt(infos.teil_nr)+r;e[q]=infos.inhalt;c="."+a+"."+b;showField(D,q,infos,c);for(var n=1;n<infos.y;n++){a++;m=parseInt(q)+(n*parseInt(maxfieldsx));e[m]=infos.inhalt;c="."+a+"."+b;showField(D,m,infos,c);if(a==infos.y){a=1}}b++}}}}}}for(var l=1;l<=fieldsamount;l++){if(!e[l]){infos="";showField(D,l,infos,"",1)}}if(v.water){var w=v.water;setWaterBonusInfo(D,w)}$("gardenclearer").innerHTML='<div id="gardenclearercontent" onclick="clearGardenCommit('+D+');"></div>';hideDiv("gardenclearer");for(var A=0;A<=fieldsamount;A++){if(garten_prod[A]&&garten_kategorie[A]=="u"){showDiv("gardenclearer");break}}hideDiv("autoplantbuttoninner");if((premium==1||!premium&&autoplant_allow_loads==1)&&currentuserlevel>=autoplantlevel){showDiv("autoplantbuttoninner");$("autoplantbuttoninner").onclick=new Function("autoPlantCommit("+D+",1)")}hideDiv("speedupbuttoninner");if((!tutorial||tutorial>=4)&&speedupgardenactive==1){if(freegardenspeedup||freegardenspeedup2||freegardenspeeduptelekom){$("speedupbuttoninner").className="speedupgardenbutton_free link"}else{$("speedupbuttoninner").className="speedupgardenbutton link"}showDiv("speedupbuttoninner");$("speedupbuttoninner").onclick=new Function("initGardenSpeedup("+D+")")}var B=v.process;var t="";for(var A=1;A<=fieldsamount;A++){if(to[A]){window.clearTimeout(to[A])}if(B[A]){var C=parseInt(B[A]["zeit"])-parseInt(B[A]["gepflanzt"]);to[A]=window.setTimeout("wachse("+A+", "+B[A]["id"]+", "+C+", "+B[A]["gepflanzt"]+")",1);t=B[A]["currenttime"]}else{continue}}setGartenPremiumFeatures(D)}function showField(l,b,r,c,m){var n="field"+b;var q="";var e="";if(document.getElementById(n)){var a=0;var d=0;var s=0;if(m==1){garten_prod[b]=0;garten_x[b]=1;garten_y[b]=1;garten_max_x[b]=1;garten_max_y[b]=1;garten_gttpic[b]="";garten_zeit[b]=0;garten_ernte[b]=0;garten_wasser[b]=0}else{garten_prod[b]=r.inhalt;garten_x[b]=1;garten_y[b]=1;garten_max_x[b]=produkt_x[r.inhalt];garten_max_y[b]=produkt_y[r.inhalt];garten_name[b]=produkt_name[r.inhalt];garten_gttpic[b]=produkt_gttpic[r.inhalt];garten_zeit[b]=r.zeit;garten_ernte[b]=produkt_ernte[r.inhalt];garten_wasser[b]=r.wasser;garten_kategorie[b]=produkt_category[r.inhalt];garten_entf[b]=produkt_destructcost[r.inhalt]}if(c!=""){var h=c.split(".");garten_x[b]=h[2];garten_y[b]=h[1]}if(m){a=0;d=0}else{if(produkt_category[r.inhalt]=="z"){r.phase=4}if(r.phase==0){if(c){if(r.x==1&&r.y==2){a="buddler3"}else{a="buddler2"}}else{a="buddler"}}else{if(r.phase==1){a=produkt_picgrow1[r.inhalt]}else{if(r.phase==2){a=produkt_picgrow2[r.inhalt]}else{if(r.phase==3){a=produkt_picgrow3[r.inhalt]}else{if(r.phase==4){a=produkt_picgrow4[r.inhalt];d=produkt_ernte[r.inhalt]}}}}}if(r.iswater&&r.phase<4){if(stopanimation==1){s="garten/gegossen_static"}else{s="garten/gegossen"}water[b]=r.wasser}}q+='<div class="feld" id="f'+b+'" ';q+="style=\"background:url('"+imgpath+"produkte/"+a+c+".gif');\"";q+='onclick="parent.cache_me('+l+","+b+",garten_prod["+b+"],garten_kategorie["+b+']);" ';q+='onmouseover="';q+="parent.show_built("+b+",'over'); displayMenuTooltip("+b+');" ';q+='onmouseout="';q+="parent.show_built("+b+",'out');\">";if(r.guild==1&&c==".1.1"){q+='<div class="guildjob_orderpoints" style="position:absolute; width:20px; height:20px; background-size:100%; opacity:0.7; margin-top:12px;"></div>'}q+='<img src="'+imgpath+s+'.gif" class="wasser" id="w'+b+'" alt="">';q+='<img src="'+imgpath+'0.gif" class="cursor" id="b'+b+'" alt="'+d+'">';q+="</div>";$(n).innerHTML=q}}function gardenShowPlantInfo(e){window.clearInterval(prodtitle_interval);prodtitle_interval=0;if(garten_name[e]&&garten_prod[e]){var a=Math.floor(parseInt(e/12));var b=parseInt(e%12);if(b==0){var d=parseInt(12*40)+48;var c=parseInt((a-1)*40)+110}else{var d=parseInt(b*40)+48;var c=parseInt(a*40)+110}gardenRemainTimeTitle(e,c,d);window.clearInterval(prodtitle_interval);prodtitle_interval=0;prodtitle_interval=window.setInterval("gardenRemainTimeTitle("+e+","+c+","+d+")",1000)}else{hideDiv("remaintimeinfo")}}function hideGardenRemainTimeTitle(){window.clearInterval(prodtitle_interval);prodtitle_interval=0;$("remaintimeinfo").innerHTML="";hideDiv("remaintimeinfo")}function gardenRemainTimeTitle(h,d,e){if(h<=maxfieldfields){var b="";kategorie=garten_kategorie[h];if(Zeit.Server==0){b+="lng_t_tt_berechne"}else{var c=(parseInt(garten_zeit[h])+parseInt(Zeit.Verschiebung))-parseInt(Zeit.Client);var a;if(c<=0){c=0;window.clearInterval(prodtitle_interval);prodtitle_interval=0;if(kategorie!="z"&&kategorie!="u"){b+=lng_t_fertig}}else{a=0;if(kategorie!="z"){b=formatTime(c)}}}$("remaintimeinfo").innerHTML="<b>"+garten_name[h]+"</b><br>"+b;$("remaintimeinfo").style.top=d+"px";$("remaintimeinfo").style.left=e+"px";showDiv("remaintimeinfo")}}function cropGarden(a){farmAction("cropgarden",farm,a)}function cropGardenResponse(b,a){if(b[1]){var e='<div style="width:160px; height:80px; overflow:auto;">';for(var d=0;d<b[1].length;d++){e+='<div class="cropall_dialog_img kp'+b[1][d]["i"]+'"></div>';e+='<div class="cropall_dialog_product">'+b[1][d]["a"]+"x "+b[1][d]["n"]+"</div>";e+='<div style="clear:both;"></div>'}e+="</div>";var h="";if(b.olympia_finder>0){h="olympia.finder("+b.olympia_finder+");"}if(b.battle_finder>0){h="battle.finder("+b.battle_finder+");"}if(b.tinkergame_finder.length&&b.tinkergame_finder.length>0){tinkergame.finderData=b.tinkergame_finder;h="tinkergame.finder();"}if(b.rainbowevent_finder>0){h="rainbowevent.finder("+b.rainbowevent_finder+");"}if(b.pentecostevent_finder){pentecostevent.finderData=b.pentecostevent_finder;h="pentecostevent.finder();"}if(b[4]){h="cropActionCropDialog("+b[4][0]+","+b[4][1]+","+b[4][2]+");"}var c="hideDiv('globalbox'); hideDiv('globaltransp'); "+h;errorboxgarden(e,c)}else{if(b.olympia_finder>0){olympia.finder(b.olympia_finder)}if(b.battle_finder>0){battle.finder(b.battle_finder)}if(b.tinkergame_finder>0){tinkergame.finder(b.tinkergame_finder)}if(b.rainbowevent_finder>0){rainbowevent.finder(b.rainbowevent_finder)}if(b.pentecostevent_finder){pentecostevent.finder(b.pentecostevent_finder)}if(b[4]){cropActionCropDialog(b[4][0],b[4][1],b[4][2])}}if(b[2]){if(currentuserlevel==1&&b[3]==1){startTutorialPart2()}currentuserlevel++;levelupAlert(b[2].level,b[2].leveltitle);if(b[2].level==2){startTutorialPart2()}}if(b[6]){tutorial=4;showDiv("transp8");showTutorial(6,1)}}function refreshGarden(a){setGartenPremiumFeatures(a);getGartenInfo(a)}function waterGarden(a){farmAction("watergarden",farm,a)}function clearGardenCommit(a){var d=0;for(var c=0;c<=fieldsamount;c++){if(garten_prod[c]&&garten_kategorie[c]=="u"){d=parseInt(d)+parseInt(garten_entf[c])}}d=d+cleargardencost;var h="<div>"+cityadcost+'<img src="'+imgpath+'money.gif" width="12" height="12">&nbsp;'+formatPrice(d)+'&nbsp;&nbsp;<img src="'+imgpath+'menu/coins.gif" width="10" height="10">&nbsp;'+cleargardencoins+"</div>";h+='<div class="blackbox" id="cleargardeninfomoney" style="display:none; z-index:100; position:absolute; top:-2px; left:0px;">'+t_money+"</div>";h+='<div class="blackbox" id="cleargardeninfocoins" style="display:none; z-index:100; position:absolute; top:-2px; left:105px;">'+t_coins+"</div>";var e=h+"<br><br>"+cleargardenintro;var b="clearGarden("+a+")";globalcommitbox(cleargardenheadline,e,b)}function clearGarden(a){farmAction("cleargarden",farm,a)}function clearGardenResponse(b,a){if(b[2]>0){document.getElementById("fundpopupbetrag").innerHTML=formatPrice(b[2]);document.getElementById("glock").style.display="block";document.getElementById("fundpopup").style.display="block"}hideDiv("globaltransp");hideDiv("globalbox");specialZoneFieldHandler(a)}function displayMenuTooltip(c){if(garten_prod[c]){prod=garten_prod[c]}else{prod=0}if(prod!=0){var a=garten_name[c];var b=garten_ernte[c];parent.ginfo(c,prod,a,b,garten_kategorie[c],garten_entf[c])}}function showDiv(a){if($(a)){$(a).style.display="block"}}function hideDiv(a){if($(a)){$(a).style.display="none"}}function toogleDiv(a){if($(a)){if($(a).style.display=="block"){$(a).style.display="none";if($(a+"_plus")){$(a+"_plus").src=imgpath+"guild/plus.gif"}if($(a+"_expand")){$(a+"_expand").removeClassName("up").addClassName("down")}}else{$(a).style.display="block";if($(a+"_plus")){$(a+"_plus").src=imgpath+"guild/minus.gif"}if($(a+"_expand")){$(a+"_expand").removeClassName("down").addClassName("up")}}}}function changeImg(b,a){document.getElementById(b).src=a}function changeButton(d,c,a){var b=str_replace(a,"",d);if(c==1){document.getElementById(d).src=imgpath+b+"_on.png"}if(c==0){document.getElementById(d).src=imgpath+b+"_off.png"}}function str_replace(c,b,a){if(a){return a.split(c).join(b)}}function isNumeric(c){var d="0123456789.";var b=true;var a;for(i=0;i<c.length&&b==true;i++){a=c.charAt(i);if(d.indexOf(a)==-1){b=false}}return b}function number_format(h,c,q,e){var b=h,a=c;b=!isFinite(+b)?0:+b;a=!isFinite(+a)?0:Math.abs(a);var u=(typeof e=="undefined")?",":e;var d=(typeof q=="undefined")?".":q;var t=(a>0)?b.toFixed(a):Math.round(b).toFixed(a);var r=Math.abs(b).toFixed(a);var m,l;if(r>=1000){m=r.split(/\D/);l=m[0].length%3||3;m[0]=t.slice(0,l+(b<0))+m[0].slice(l).replace(/(\d{3})/g,u+"$1");t=m.join(d)}else{t=t.replace(".",d)}return t}function errorboxguild(a){globalBox(0,a,0,0,1)}function errorboxgarden(d,a,c){var b=errorheadline;if(a){b=cropalllistheadline}globalBox(b,d,a,0,1,0,c)}function commitbox(l,c,b,h){var e="<div>"+l+"</div>";$("commitboxcontent").innerHTML=e;var a="hideDiv('transp');";if(h==1){a=""}if($("farmhousetransp")){a+=" hideDiv('farmhousetransp');"}var d="";d+='<div class="button_ok_commitbox" onclick="'+c+'" class="link">';d+='<img src="'+imgpath+'button_ok.png" onmouseover="this.src=\''+imgpath+"button_ok_over.png'; showDiv('info_ok');\" onmouseout=\"this.src='"+imgpath+"button_ok.png'; hideDiv('info_ok');\">";d+='<div class="button_ok_commitbox_info" id="info_ok" onmouseover="showDiv(\'info_ok\');" onmouseout="hideDiv(\'info_ok\');">'+commitbox_text_yes+"</div>";d+="</div>";d+='<div class="button_no_commitbox" onclick="'+a+' hideDiv(\'commitbox\');" class="link">';d+='<img src="'+imgpath+'button_no.png" onmouseover="this.src=\''+imgpath+"button_no_over.png'; showDiv('info_no');\" onmouseout=\"this.src='"+imgpath+"button_no.png'; hideDiv('info_no');\">";d+='<div class="button_no_commitbox_info" id="info_no" onmouseover="showDiv(\'info_no\');" onmouseout="hideDiv(\'info_no\');">'+commitbox_text_no+"</div>";d+="</div>";$("commitboxfooter").innerHTML=d;$("commitpigani").style.backgroundImage="url("+imgpath+"pig_ani"+b+".gif)";if(b==1){$("commitpigani").style.backgroundPosition="3px -2px"}else{if(b==2){$("commitpigani").style.backgroundPosition="10px 8px"}}showDiv("transp");showDiv("commitbox")}function commitboxinner(b,c,a){globalBox(b,c,a)}function commitboxgarden(c,d,b,a){globalBox(c,d,b)}function commitboxcrop(b,d,a,c){globalBox(b,d,a,c)}function commitboxguild(c,a,d,b,e){globalBox(c,a,d)}function globalcommitbox(b,c,a,d,e){globalBox(b,c,a,d,0,e)}function globalerrorbox(a,b,d){var c=errorheadline;globalBox(c,a,b,0,1,0,d)}function globalBox(l,e,n,m,h,b,c){if(n=="0"){n=0}if(!(typeof e==="string")){return 1}var q="hideDiv('globalbox'); hideDiv('globaltransp'); $('globalbox_content').innerHTML=''; ";if(n=="maintenance"){n="session_failed()";q=n}if(h){if(!n){n=q}if(e&&e.indexOf("%FORCEHARVEST%")>=0&&c){m=n;n="farmAction('cancelguildproduction', "+c.farm+", "+c.position+", "+c.id+")";if(c.mode=="cropgarden"){n="farmAction('cropgarden', "+c.farm+", "+c.position+", 1)"}if(c.mode=="garden_harvest"){n="farmAction('garden_harvest', "+c.farm+", "+c.position+", '"+c.id+"&ignoreguild=1')"}e+='<br><div style="margin:10px 0px;">'+t_guildjob_stock_full+"</div>"}if(e&&e.indexOf("%PREMIUMLINK%")>=0){e+="<br><br>!PREMIUMLINK!"}if(e&&e.indexOf("%HELPMETOEARNMONEY%")>=0&&PAYMENTLINK){if(isSteam()){e+='<div class="steam_payment_arrow ani"></div>'}else{e+='<br><br><a href="'+PAYMENTLINK+'" target="_blank"><button class="link coinsbutton_small" type="button">'+t_coins_buy_menu+"</button></a>"}}if(e&&e.indexOf("%LICENSEBUTTON%")>=0){e+='<br><br><button class="link coinsbutton_small" type="button" onclick="dialogMegafield(\'buy_license_confirm\')">'+t_megafield_license_plus+"</button>"}}if(n=="off"){n=q;h=1}var d="";if(b==1){d=""}else{if(n){d+='<button type="button" id="globalbox_button1" class="button_yes link" onclick="'+n+'"></button>'}if(n&&!h&&!m){m=q}if(m){d+='<button type="button" id="globalbox_button2" class="button_no link" onclick="'+m+'"></button>'}}$("globalbox_footer_buttons").innerHTML=d;$("globalbox_add").innerHTML="";if(!m){m=q}$("globalbox_close").onclick=new Function(m);if(!l){l=""}$("globalbox_headline").innerHTML=l;e=str_replace("%PREMIUMLINK%","",e);e=str_replace("%HELPMETOEARNMONEY%","",e);e=str_replace("%LICENSEBUTTON%","",e);e=str_replace("%FORCEHARVEST%","",e);$("globalbox_content").innerHTML=e;$("globalbox_char").className="globalbox_sheep";$("globalbox_charani").className="globalbox_sheepani";if(em2016==1){$("globalbox_char").className="globalbox_sheep_em";$("globalbox_charani").className="globalbox_sheepani_em"}showDiv("globalbox_charani");showDiv("globalbox_char");showDiv("globaltransp");showDiv("globalbox");showDiv("globalbox_footer");showDiv("globalbox_footer_buttons");$("globalbox_content").className="globalbox_content";var a=$("globalbox").getWidth();$("globalbox").style.marginLeft="-"+((a+80)/2)+"px";$("globalbox").style.top=null;$("globalbox").className="globalbox";$("globalbox_footer").className="";showDiv("globalbox_close");$("globalbox_close");$("globalbox_headline").className=""}function globalBoxFlex(c,a,e,b,h){globalcommitbox(c,a,e,b,h);$("globalbox_content").removeClassName("globalbox_content");$("globalbox_content").addClassName("globalbox_content_flex");hideDiv("globalbox_char");hideDiv("globalbox_footer");var d=$("globalbox").getWidth();$("globalbox").style.marginLeft="-"+(d/2)+"px";$("globalbox").style.top="100px";$("globalbox_headline").style.paddingTop="10px"}function showTutorial(c,a){if(tutorialarray){if(c){for(var b in tutorialarray){hideDiv("tutorial"+b)}showDiv("tutorial");showDiv("tutorial"+c)}if(tutorial){if(tutorialarray[tutorial]){$("tutoriallinecontent").innerHTML=tutoriallinepre+tutorialarray[tutorial];if(a&&$("t_step"+a)){$("t_step"+a).className="highlight_tutorial_step"}}else{hideDiv("tutorialline")}}else{hideDiv("tutorialline")}}}function closeTutorial(){generalAction("closetutorial")}function increaseTutorialStep(){if(tutorial==11){return false}else{generalAction("increasetutorialstep")}}function formatTime(e){var a=Math.floor(e/3600);var b=Math.floor((e%3600)/60);var d=Math.floor((e%3600)%60);if(a.toString().length==1){a="0"+a.toString()}if(b.toString().length==1){b="0"+b.toString()}if(d.toString().length==1){d="0"+d.toString()}var c=a+":"+b+":"+d+"&nbsp;h";return c}function setServerTime(){servertimetime=servertimetime+1;var e=new Date(servertimetime*1000);var h=e.getFullYear();var d=e.getMonth()+1;if(String(d).length==1){d="0"+d}var b=e.getDate();if(String(b).length==1){b="0"+b}var a=e.getHours();if(String(a).length==1){a="0"+a}var m=e.getMinutes();if(String(m).length==1){m="0"+m}var c=e.getSeconds();if(String(c).length==1){c="0"+c}var l=str_replace("d",b,date_format);l=str_replace("m",d,l);l=str_replace("Y",h,l);l=str_replace("H",a,l);l=str_replace("i",m,l);l=str_replace("s",c,l);$("serverzeit").innerHTML=servertime+" "+l}function formatPrice(b){if(priceformat){var c=priceformat.split(":");var a=number_format(b,c[0],c[1],c[3])+" "+c[2];return a}}function formatPoints(b){if(pointsformat){var c=priceformat.split(":");var a=number_format(price,c[0],c[1],c[3])+" "+c[2];return a}}function formatNumber(a){return number_format(a,0,set_komma,set_tausender)}function formatDate(e){var c=new Date(parseInt(e)*parseInt(1000));var d=c.getFullYear();var b=c.getMonth()+1;var a=c.getDate();return a+"."+b+"."+d}function getRandom(b,a){if(b>a){return(-1)}if(b==a){return(b)}return(b+parseInt(Math.random()*(a-b+1)))}function in_array(b,a){for(p=0;p<a.length;p++){if(b==a[p]){return true}}return false}function initNotepad(){generalAction("initnotepad")}function calcNotepadLetters(){var a=$("notepadentry").value;if(a.length>notepadletters){a=a.substring(0,notepadletters);$("notepadentry").value=a;$("notepadentry").scrollTop=$("notepadentry").scrollHeight}var b=str_replace("%LETTERS%",(parseInt(notepadletters)-parseInt(a.length)),marktschreierletters);$("restlettersnotepad").innerHTML=b}function saveNotepad(){var b=$("notepadentry").value;b=b.substring(0,notepadletters);var a={text:encodeURIComponent(b)};generalAction("savenotepad",a)}function autoPlantBuyLoads(b){var a="";for(coins in autoplant_loads){var d=str_replace("%COINS%",coins,t_autoplant_buy_loads_item);a+='<div class="link coinsbutton_flex" style="font-size:12px; margin-bottom:5px;" onclick="farmAction(\'autoplant_buy_load\', '+farm+", "+b+", "+coins+')">'+str_replace("%LOADS%",autoplant_loads[coins],d)+"</div>"}var c="";globalcommitbox(t_autoplant_buy_loads,a,c)}var autoplantposition=0;var autoplantselected=0;function autoPlantCommit(B,b){autoplantposition=B;var r='<div id="autoplantselectbox" style="display:none; height:120px; width:204px; overflow:auto; margin:0 auto; position:absolute; left:83px;">';var c=0;var u=0;if(farm<=4){var v=1}else{var v=farm}valid=farm_garden_products[v];var A={};var z=[];var m=[];var h=0;for(var t in produkt_name){var a=checkRackItem(t,farm);if(a>0){if(in_array(produkt_category[t],valid)&&a>0){if(in_array(produkt_category[t],["water"])){A[t]=1;m.push(h)}z.push(t);h++}}}A=sushibar.sortProductsAppear(A);var h=0;for(var t in A){var q=parseInt(t.replace("a_",""));var e=m[h];z[e]=q;h++}if(z.length){for(var t=0;t<z.length;t++){var q=z[t];if(autoplantselected==q){u=1}var s="autoplantselected="+q+"; autoPlantCommit("+B+", "+q+")";if(t==selected){c=selected}if(!c){c=q}r+='<div class="link" onclick="'+s+'" style="background-color:#fff; color:#000; padding:2px; text-align:left;" onmouseover="this.style.backgroundColor=\'#B39056\'" onmouseout="this.style.backgroundColor=\'#fff\'">';r+='  <div class="kp'+q+'" style="float:left; margin-right:5px; width:15px;"></div>';r+='  <div style="float:left;">'+produkt_name[q]+"</div>";r+='  <div class="clear"></div>';r+="</div>"}}r+="</div>";if(autoplantselected>0&&u==1){c=autoplantselected}else{autoplantselected=c}if(!autoplantselected){autoplantselected=c}var d='<div style="position:relative; width:350px;">';if(autoplant_allow_loads==1){var l=0;if(farms_data.autoplant_loads){l=farms_data.autoplant_loads}if(!premium||l>0){d+='<div style="margin-bottom:15px;">';d+='  <div style="margin-top:-10px;">'+t_autoplant_loads+l+"</div>";if(!premium){d+='<div class="link coinsbutton_flex" style="margin-bottom:-10px;" onclick="autoPlantBuyLoads('+B+')">'+t_autoplant_buy_loads+"</div>"}var n=str_replace("%[PREMIUMACCOUNTLINK%",'<span class="link" style="text-decoration:underline;"; onclick=\'hideDiv("globalbox"); show_page("coins",0);\'>',t_autoplant_loads_info);d+='  <div class="bonusinfo">'+str_replace("%]%","</span>",n)+"</div>";d+="</div>"}}d+=autoplant_select+"<br><br>";d+='<div style="position:relative; width:204px; margin:0 auto;" class="link" onclick="autoPlantControl()">';d+='  <div class="link" style="float:left; padding:2px; height:15px; text-align:left; width:185px; border-bottom:1px solid #000; background-color:#fff; color:#000;">';if(c){d+='    <div class="kp'+c+'" style="float:left; margin-right:5px; width:15px;"></div>';d+='    <div style="float:left;">'+produkt_name[c]+"</div>";d+='    <div class="clear"></div>'}else{d+=t_stats_produkte}d+="   </div>";d+='  <div class="link" id="autoplantselector" style="float:left; width:15px; height:20px; background:url('+imgpath+'market/sel_open.gif); background-color:#000;"></div>';d+='  <div class="clear"></div>';d+="</div>";d+="</div>";var C="autoPlant("+B+")";var w="autoplantposition=0; hideDiv('globaltransp'); hideDiv('globalbox')";globalcommitbox(autoplant_headline,d+r,C,w)}function autoPlantControl(){if($("autoplantselectbox").style.display=="block"){hideDiv("autoplantselectbox");$("autoplantselector").style.backgroundImage="url("+imgpath+"market/sel_open.gif)"}else{showDiv("autoplantselectbox");$("autoplantselector").style.backgroundImage="url("+imgpath+"market/sel_close.gif)"}}function autoPlant(a){if(!autoplantselected){return false}var b=autoplantselected;farmAction("autoplant",farm,a,b)}function closePan(){hideDiv("farmhousetransp");hideDiv("pancontainer");if($("petnamecontainer")){hideDiv("petnamecontainer")}if(panscenes){panscenes.close()}}function showPan(a){if(a){pan_site=1}if($("pancontainer").style.display=="block"){$("pancontainer").style.display="none"}else{farmAction("showpan",farm,0)}}var searchPanID=0;var panMerchant=0;var superAnimals={};var superAnimalsPage=1;var panCollectionScrollMax=8;var panCollectionCurrentScroll=-1;function showPanResponse(a){if(a[1]){pan_items=a[1]}if(a.paymentitemcollection&&paymentitemcollection){paymentitemcollection.data=a.paymentitemcollection}if(a.superanimals){superAnimals=a.superanimals}if(a.merchant){panMerchant=a.merchant}if(a.config_sheeps&&panscenes){panscenes.close();panscenes.config=a.config_sheeps;panscenes.data=a.data_sheeps}if(searchPanID>0){gotoPanGift(searchPanID);searchPanID=0}buildPanContent();showDiv("farmhousetransp");showDiv("pancontainer")}function gotoPanGift(d){var c=1;if(pan_items.order&&pan_items.order.length){for(var a=0;a<pan_items.order.length;a++){if((c-1)%10==0){}else{c=(Math.ceil((c-1)/10)*10)+1}for(var b=0;b<pan_items.categories[pan_items.order[a]].length;b++){if(+pan_items.categories[pan_items.order[a]][b]==+d){pan_site=Math.ceil(c/80)}c++}}}}function buildPanContent(A){if(!A){A=0}if(panscenes){panscenes.close()}$("pancontainer").className="";$("pancontainer").style.backgroundImage="url("+imgpath+"schaufenster/pan2.jpg)";var r=["paymentitem_collection","pan_superanimal_showcase"];for(var w=0;w<r.length;w++){if($(r[w])){hideDiv(r[w])}}var m="";var d=1;var t=((pan_site-1)*80)+1;var a=(pan_site*80);var z={};if(pan_items.order&&pan_items.order.length){for(var v=0;v<pan_items.order.length;v++){if((d-1)%10==0){}else{d=(Math.ceil((d-1)/10)*10)+1}for(var w=0;w<pan_items.categories[pan_items.order[v]].length;w++){if(d>=t&&d<=a){z[d]=pan_items.categories[pan_items.order[v]][w]}d++}}}m+='<div id="pan_item_overview">';for(var w=t;w<=a;w++){if(z[w]&&pan_items.gifts[z[w]]){var s=z[w];var b=".gif";if(pan_items.gifts[s].png){b=".png"}var n="";if(w%10==0||w%10>5){n+=" right:50px; left:auto;"}else{n+=" left:50px; right:auto;"}var l=(w,Math.ceil((w-(((pan_site-1)*80)))/10));if(l>4){n+=" bottom:0px; top:auto;"}else{n+=" top:0px; bottom:auto;"}var C=s;if(presents_hack[s]){C=presents_hack[s]}var c="";var e="";if(pan_items.gifts[s].giver){c="link";e="cityAction('giverpresent', "+s+")"}if(A){e=""}m+='<div id="pan_item'+w+'" class="item '+c+'" onclick="'+e+'" onmouseover="showDiv(\'gift_tt'+s+"');\" onmouseout=\"hideDiv('gift_tt"+s+"');\">";m+='  <div style="background:url('+imgpath+"gifts/"+C+b+')" class="img"></div>';if(pan_items.gifts[s].counter){m+='<div class="pan_navi_line_item_count">'+pan_items.gifts[s].counter+"</div>"}if(pan_items.gifts[s].giver){m+='<div class="giverblingbling"></div>'}m+='  <div id="panflyer'+s+'" class="panflyer"></div>';m+='  <div id="gift_tt'+s+'" class="ttbox" style="width:220px; max-width:220px; text-align:center; '+n+'">';m+='    <div style="width:100px; height:100px; margin:0 auto; background:url('+imgpath+"gifts/"+C+b+');"></div>';m+='    <div style="font-weight:bold; margin:5px 0;">'+pan_items.gifts[s].name+"</div>";if(pan_items.gifts[s].points&&pan_items.gifts[s].giver){m+='<div style="margin:5px 0; font-style:italic;">'+str_replace("%POINTS%",pan_items.gifts[s].points,t_giverinfo)+"</div>"}if(pan_items.gifts[s].donators){m+='<div style="overflow:auto; height:100px; width:100%;">';for(var u=0;u<pan_items.gifts[s].donators.length;u++){m+='<div style="float:left;">'+pan_items.gifts[s].donators[u].date+"</div>";if(pan_items.gifts[s].donators[u].unr>0&&!A){m+='<div class="link pan_delete_gift" onclick="delPresentCommit('+pan_items.gifts[s].donators[u].id+');"></div>'}var q="";if(pan_items.gifts[s].donators[u].server&&pan_items.gifts[s].donators[u].server>0){var q="&nbsp;("+pan_items.gifts[s].donators[u].server+")"}var B=pan_items.names[pan_items.gifts[s].donators[u].unr];if(pan_items.gifts[s].donators[u].name){B=pan_items.gifts[s].donators[u].name}m+='<div style="float:right;">'+B+q+"</div>";m+='<div class="clear"></div>'}m+="</div>"}m+="  </div>";m+="</div>"}else{m+='<div id="pan_item'+d+'" class="item"></div>'}}m+='  <div class="clear"></div>';m+="</div>";m+='<div id="paymentitem_collection" class="collection"></div>';if(superanimal_showcase==1){m+='<div id="pan_superanimal_showcase" class="superanimal_showcase"></div>'}m+='<div id="pan_navi_line" class="pan_navi_line">';var h=Math.ceil(d/80);m+=panNaviPages(h,A);m+='<div id="panscenes_navi" class="pan_site_list" onmouseover="showDiv(\'panscenes_navi_tt\')" onmouseout="hideDiv(\'panscenes_navi_tt\')"></div>';if(superanimal_showcase==1&&!A){m+='<div class="pan_site_list superanimal_showcase_link link" onclick="panBuildSuperanimalShowcase()" onmouseover="showDiv(\'superanimal_showcase_link_tt\')" onmouseout="hideDiv(\'superanimal_showcase_link_tt\')">';m+='  <div id="superanimal_showcase_link_tt" class="ttbox">'+t_superanimal_showcase_link+"</div>";m+="</div>"}if(panMerchant==1){m+='<div class="pan_site_list merchant_pan_link link" onclick="merchant.gotoCity()" onmouseover="showDiv(\'merchant_pan_link_tt\')" onmouseout="hideDiv(\'merchant_pan_link_tt\')">';m+='  <div class="back">';m+='    <div class="back2"></div>';m+="  </div>";m+='  <div id="merchant_pan_link_tt" class="ttbox">'+t_merchant_name+"</div>";m+="</div>"}m+='<div id="pan_navi_collections" class="collections"></div>';$("pancontainercontent").innerHTML=m;if($("pan_navi_line_item"+pan_site)){$("pan_navi_line_item"+pan_site).addClassName("pan_navi_item_active")}panNaviCollections(A);if(panscenes){panscenes.buildNavi()}}function panNaviPages(a,e){var d="";var b=1;if(pan_site<=a){b=pan_site}if(!b){b="---"}d+='<div class="pan_site_list" onmouseover="showDiv(\'pan_site_list_tt\')" onmouseout="hideDiv(\'pan_site_list_tt\')">';d+='  <div class="arrow left link" onclick="panScrollSiteList(-1, '+a+", "+e+');"></div>';d+='  <div class="current link" onclick="panToogleList(\'site\');">'+b+"</div>";d+='  <div class="selector link" onclick="panToogleList(\'site\');">';d+='    <div id="pan_site_list_selector" class="img down"></div>';d+="  </div>";d+='  <div class="arrow right link" onclick="panScrollSiteList(1, '+a+", "+e+');"></div>';d+='  <div class="clear"></div>';d+='  <div id="pan_site_list_list" class="list">';for(var c=1;c<=a;c++){d+='<div class="line link" onclick="panCurrentScene=\'\'; pan_site='+c+"; buildPanContent("+e+');">'+c+"</div>"}d+="  </div>";d+='  <div id="pan_site_list_tt" class="ttbox">'+t_pan_main_navi1+"</div>";d+="</div>";return d}function panNaviCollections(m){var d="";if(m&&pan_privacy==1){}else{if(paymentitemcollection&&paymentitemcollection.data){var c=paymentitemcollection.data.valid;if(c){if(panCollectionCurrentScroll==-1){var e=paymentitemcollection.data.valid.length;var h=(e-panCollectionScrollMax)+1}else{var h=panCollectionCurrentScroll;var e=(panCollectionCurrentScroll+(panCollectionScrollMax-1))}var n=0;var l="";if(h==1){l="off"}d+='<div class="scroller top link '+l+'" onclick="panScrollCollectionNavi(-1, '+m+')"></div>';for(var b=0;b<c.length;b++){var a=(b+1);if(a<h||a>e){continue}d+='<div id="pan_navi_line_item'+c[b]+'" class="navi '+c[b]+' link" onclick="panBuildCollection(\''+c[b]+"')\" onmouseover=\"showDiv('pan_navi_line_item"+c[b]+"_tt')\" onmouseout=\"hideDiv('pan_navi_line_item"+c[b]+"_tt')\">";d+='  <div id="pan_navi_line_item'+c[b]+'_tt" class="ttbox">'+t_paymentitemcollection_names[c[b]]+"</div>";d+="</div>";n=a}l="";if(n==c.length){l="off"}d+='<div class="scroller bottom link '+l+'" onclick="panScrollCollectionNavi(1, '+m+')"></div>'}d+="</div>"}}$("pan_navi_collections").innerHTML=d}function panScrollCollectionNavi(b,d){var c=paymentitemcollection.data.valid.length;var a=(c-panCollectionScrollMax);panCollectionCurrentScroll+=b;if(panCollectionCurrentScroll<1){panCollectionCurrentScroll=1}if(panCollectionCurrentScroll>(a+1)){panCollectionCurrentScroll=(a+1)}panNaviCollections(d)}function panToogleList(a){if($("pan_"+a+"_list_list").style.display=="block"){$("pan_"+a+"_list_list").style.display="none";$("pan_"+a+"_list_selector").addClassName("down");$("pan_"+a+"_list_selector").removeClassName("up")}else{$("pan_"+a+"_list_list").style.display="block";$("pan_"+a+"_list_selector").addClassName("up");$("pan_"+a+"_list_selector").removeClassName("down")}}function panScrollSiteList(b,a,c){pan_site+=b;if(pan_site>a){pan_site=1}if(pan_site<1){pan_site=a}panCurrentScene="";buildPanContent(c)}function panFlyer(b,a){if($("panflyer"+b)){$("panflyer"+b).innerHTML="+"+a;$("panflyer"+b).addClassName("panflyer_ani")}}function panBuildCollection(a){panCurrentScene="";pan_site=0;buildPanContent();setTimer("paymentitemcollection");paymentitemcollection.update(a)}function panBuildSuperanimalShowcase(){panCurrentScene="";pan_site=0;buildPanContent();showDiv("pan_superanimal_showcase");hideDiv("paymentitem_collection");var l=(superAnimalsPage*12);var h=(l-12)+1;var b="";b+='<div class="header">';b+="  <div>"+t_superanimal_showcase_info+"</div>";b+="</div>";b+='<div class="slots">';var d=0;for(var e in superAnimals){d++;if(!(d>=h&&d<=l)){continue}var a="off";if(parseInt(superAnimals[e].collected)>=parseInt(superAnimals[e].sum)){a=""}else{if(superAnimals[e].data){a=""}}b+='<div class="slot" onmouseover="showDiv(\'pan_superanimal_slot'+e+"_tt')\" onmouseout=\"hideDiv('pan_superanimal_slot"+e+"_tt')\">";b+='  <div class="animal city_animal_special'+superAnimals[e].reward.animalid+"_"+superAnimals[e].reward.special+" "+a+'"></div>';if(superAnimals[e].data&&superAnimals[e].data.animal_data){var c="";if(premium==1){c="showMain(); farmMove("+superAnimals[e].data.animal_data.farm+")"}b+='<div class="link building bm'+superAnimals[e].reward.animalid+'" onclick="'+c+'"></div>'}b+='  <div id="pan_superanimal_slot'+e+'_tt" class="ttbox">'+animal_special_config[superAnimals[e].reward.animalid][e].title+"</div>";b+="</div>"}b+="</div>";b+='<div id="pan_superanimal_showcase_goto_left" class="goto left link" onclick="panBuildSuperanimalShowcaseNavi(-1, '+d+')"></div>';b+='<div id="pan_superanimal_showcase_goto_right" class="goto right link" onclick="panBuildSuperanimalShowcaseNavi(1, '+d+')"></div>';$("pan_superanimal_showcase").innerHTML=b;panBuildSuperanimalShowcaseNavi(0,d)}function panBuildSuperanimalShowcaseNavi(b,c){var a=Math.ceil(c/12);if(b!=0){superAnimalsPage+=b}if(superAnimalsPage<1){superAnimalsPage=1}if(superAnimalsPage>a){superAnimalsPage=a}if(b!=0){panBuildSuperanimalShowcase()}showDiv("pan_superanimal_showcase_goto_left");showDiv("pan_superanimal_showcase_goto_right");if(superAnimalsPage==1){hideDiv("pan_superanimal_showcase_goto_left")}if(superAnimalsPage>=a){hideDiv("pan_superanimal_showcase_goto_right")}}function delPresentCommit(c){var a="delPresent("+c+");";var b="<div>"+gift_delgift_content+"</div>";globalcommitbox(gift_delgift_head,b,a)}function delPresent(a){cityAction("delpresent",a)}var achievements=new Array;function initFarmhouse(){farmAction("inithq",farm,1)}var farmhouse_rack_data={};function initFarmhouseResponse(a){currentuserquest=a[3];farmhouseitems=a[2];usertrophies=a[4];achievements=a[5];setFarmhouseInner();setFarmhouseItemSelector(1);farmhouseSelected(1,0,1);showDiv("transp");showDiv("farmhousecontainer");closePan()}function setFarmhouseItemSelector(l){var h="";if(farmhouseitems[l]){var r="";var u="";var a=0;for(var c=1;c<=20;c++){if(farmhouseitems[c]){var b=0;for(var n=0;n<farmhouseitems[c].length;n++){if(farmhouseitems[c][n]){if(farmhouseitems[c][n]["rack"]==1){var b=1;break}}}if(b==1){if(c==l){var e="border-top:3px solid #f00; top:-3px;"}else{var e=""}r+='<div class="link" style="position:absolute; top:0px; left:'+a+"px; width:20px; height:20px; background:url("+imgpath+"farmhouse/transp.png) top left; "+e+'" ';r+='onclick="setFarmhouseItemSelector('+c+"); farmhouseSelected("+c+',0,1);" onmouseover="showDiv(\'fhselnavi'+c+"');\" onmouseout=\"hideDiv('fhselnavi"+c+"');\">";r+='<img src="'+imgpath+"farmhouse/caticon"+c+'.gif" border="0" width="20" height="20">';r+="</div>";u+='<div id="fhselnavi'+c+'" class="blackbox" style="display:none; position:absolute; top:-32px; left:'+a+'px;">'+fh_minfo[c]+"</div>";a=a+23}}}r+='<div style="clear:both;"></div>';$("farmhouseitemselectornavi").innerHTML=r+u;var m=0;var a=0;var d=0;for(var n=0;n<farmhouseitems[l].length;n++){if(farmhouseitems[l][n]){if(farmhouseitems[l][n]["rack"]==1){var q=farmhouseitems[l][n];h+='<div style="position:absolute; top:'+m+"px; left:"+a+"px; background:url("+imgpath+"farmhouse/thumbs/"+q.itemid+'.jpg) 12px 11px no-repeat;">';var t="";var s="";if(l==11){t='onclick="petnameChange('+l+","+n+')"';if(farmhouseitems[l][n]["name"]!=""){t+=" onmouseover=\"$('pn_"+l+"_"+n+"').style.fontSize='11px';$('pn_"+l+"_"+n+"').style.fontWeight='bold'\" onmouseout=\"$('pn_"+l+"_"+n+"').style.fontSize='9px';$('pn_"+l+"_"+n+"').style.fontWeight='normal'\""}s="link"}h+='<img class="'+s+'" src="'+imgpath+'farmhouse/itemborder.png" border="0" '+t+">";h+='<div style="position:absolute; top:-3px; left:37px; width:31px; height:31px; background:url('+imgpath+"farmhouse/color"+q.color+'.png) top left no-repeat;"></div>';h+='<div style="position:absolute; bottom:0px; left:43px;"><input class="link" type="checkbox" id="fhcheckbox'+n+'" onclick="farmhouseSelected('+l+","+n+',0);" style="background:transparent; border:0;"></div>';if(farmhouseitems[l][n]["name"]!=""){h+='<div id="pn_'+l+"_"+n+'" class="link" '+t+' style="position:absolute; top:-2px; font-weight:normal; color:#fff; left:0px; font-size:9px;">'+farmhouseitems[l][n]["name"]+"</div>"}h+="</div>";a=a+75;if((d+1)%6==0){a=0;m=m+75}d++}}}}$("farmhouseitemselectorcontent").innerHTML=h}function farmhouseSelected(c,h,e){if(farmhouseitems[c][h]["active"]==1&&(c==1||c==5)){if($("fhcheckbox"+h)){$("fhcheckbox"+h).checked=true}}else{if(e==1){for(var b=0;b<120;b++){if($("fhcheckbox"+b)){if(farmhouseitems[c][b]["active"]==1){$("fhcheckbox"+b).checked=true}else{$("fhcheckbox"+b).checked=false}}}}else{var d=farmhouseitems[c][h]["itemid"];var a=farmhouseitems[c][h]["color"];farmAction("setfarmhouseitem",farm,0,d,a,c)}}}function farmhouseSelectedResponse(a,c){farmhouseitems=a[1];setFarmhouseInner();for(var b=0;b<120;b++){if($("fhcheckbox"+b)){if(farmhouseitems[c][b]["active"]==1&&a[2]==0){$("fhcheckbox"+b).checked=true}else{$("fhcheckbox"+b).checked=false}}}}function initCatalogue(){showDiv("farmhousetransp");showDiv("catalogueinner");setCatalogueCategory(1)}function setCatalogueCategory(a){if(a){clearCatalogueRight();for(var l=1;l<20;l++){if($("fh_m"+l)){if(l==a){$("fh_m"+l).style.background="url("+imgpath+"farmhouse/m"+l+"_over.gif)"}else{$("fh_m"+l).style.background="url("+imgpath+"leer.gif)"}}}$("catalogueleftheadline").innerHTML=fh_minfo[a];var n="";var h="";if(farmhouseitems[a]){var c=0;var r=0;var d=0;var m=0;for(var l=0;l<farmhouseitems[a].length;l++){if(farmhouseitems[a][l]){var q="";var t="showCatalogueItem("+a+","+l+");";var b=0;var s=farmhouseitems[a][l];if(d==0){d=s.itemid;var e=1}else{if(s.itemid==d){var e=0}else{e=1;d=s.itemid}}if(e==1){if(s.buy==1){if(s.lvl>currentuserlevel||s.quest>currentuserquest){b=1;if(s.lvl>currentuserlevel){q=str_replace("%LEVEL%",s.lvl,fh_categorylistminlvl)}if(s.quest>currentuserquest){q=str_replace("%QUEST%",s.quest,fh_categorylistminquest)}t="clearCatalogueRight(); $('cataloguerightheader').innerHTML = '"+q+"'"}n+='<div class="link" onclick="'+t+'" style="position:absolute; top:'+r+"px; left:"+c+"px; background:url("+imgpath+"farmhouse/thumbs/"+s.itemid+'.jpg) 12px 11px no-repeat;">';n+='<img src="'+imgpath+'farmhouse/itemborder.png" border="0">';if(b==1){n+='<div style="position:absolute; top:6px; left:7px; width:49px; height:50px; background:url('+imgpath+'farmhouse/notallowed.png) top left no-repeat;"></div>'}if(s.aktion>0){n+='<div style="position:absolute; top:10px; left:10px; background:url('+imgpath+'topaktion_klein.gif) top left no-repeat; height:15px; width:15px;" ';n+=">";n+="</div>"}n+="</div>";c=c+70;if((m+1)%3==0){c=0;r=r+70}m++}}}}}$("catalogueleftcontent").innerHTML=n}}function showCatalogueItem(l,n){var a="";$("cataloguerightheader").innerHTML="";if(farmhouseitems[l][n]){var c=0;var d=farmhouseitems[l][n]["itemid"];var a=farmhouseitems[l][n]["colors"];var e="";for(var b=1;b<=10;b++){if(in_array(b,a)){e+='<div style="float:left; margin-right:10px;"><img class="link" onclick="setCatalougeItemColor('+d+","+b+')" src="'+imgpath+"farmhouse/color"+b+'.png" border="0"></div>';if(c==0){c=b}}}}var q="";var m="";var h=farmhouseitems[l][n]["aktion"];if(h>0){q+='<div style="position:relative; background:url('+imgpath+'topaktion.gif) top left no-repeat; width:120px; height:122px; color:#fff; font-weight:bold; font-size:16px;">';q+='<div style="position:absolute; top:40px; left:20px; width:80px; text-align:center;">';q+='<div style="font-size:12px; margin-bottom:10px;">'+aktion_price+"</div>";q+=farmhouseitems[l][n]["aktion"];if(farmhouseitems[l][n]["bar"]>0){q+="&nbsp;"+gamecurrency}if(farmhouseitems[l][n]["coins"]>0){q+="&nbsp;"+t_coins}q+="</div>";q+="</div>";m="text-decoration:line-through;"}if(farmhouseitems[l][n]["buy"]==1){if(farmhouseitems[l][n]["bar"]>0){q+='<div style="text-align:center; '+m+'">'+cityadcost+"<b>"+farmhouseitems[l][n]["bar"]+"&nbsp;"+gamecurrency+"</b></div>"}if(farmhouseitems[l][n]["coins"]>0){q+='<div style="text-align:center; '+m+'">'+cityadcost+"<b>"+farmhouseitems[l][n]["coins"]+"&nbsp;"+t_coins+"</b></div>"}q+='<div style="text-align:center;"><button type="button" class="link" onclick="buyFarmhouseItemCommit('+l+","+n+');">'+fh_buyitem+"</button></div>"}$("cataloguerightcolor").innerHTML=e;$("cataloguerightfooter").innerHTML=q;showDiv("cataloguerightcolor");showDiv("cataloguerightcontent");showDiv("cataloguerightfooter");setCatalougeItemColor(d,c)}function buyFarmhouseItemCommit(e,m){var l=farmhouseitems[e][m];var h="";h+="<div>";var a=l.aktion;if(l.bar>0){var d=l.bar;if(a>0){d=a}h+='<img src="'+imgpath+'money.gif" border="0" width="12" height="12">&nbsp;'+d+"&nbsp;"+gamecurrency}if(l.coins>0){var b=l.coins;if(a>0){b=a}h+='<img src="'+imgpath+'menu/coins.gif" border="0" width="12" height="12">&nbsp;'+b+"&nbsp;"+t_coins}h+="</div>";h+="<br>"+fh_commitbuyitem;var c="buyFarmhouseItem("+l.itemid+","+e+","+m+")";globalcommitbox(fh_buyitem,h,c)}function buyFarmhouseItem(c,b,d){if($("selectedcolor").value>0){var a=$("selectedcolor").value;farmAction("buyfarmhouseitem",farm,0,c,a,b,d)}else{return false}}function buyFarmhouseItemResponse(a,c,d,b){clearCatalogueRight();$("cataloguerightheader").innerHTML=fh_buycommittext;farmhouseitems=a[1];setFarmhouseInner();setFarmhouseItemSelector(c);farmhouseSelected(c,0,1)}function setFarmhouseInner(){if(farmhouseitems){$("fhpets").style.background="url("+imgpath+"leer.gif)";var q={"1":"farmhousecontainer","2":"fhpicture","3":"fhclock","4":"fhcurtain","5":"fhfloor","6":"fhcarpet","7":["fhtable","fhtableani"],"8":"fhchair","9":"fhplant","10":["fhlights","fhlightsani"],"11":["fhpets","fhpetsani","fhpetsinfo"]};for(e in q){if($(q[e])){var d=[];if(!is_array(q[e])){d.push(q[e])}else{d=q[e]}for(var c=0;c<d.length;c++){hideDiv(d[c]);if(d[c]=="fhpetsani"){$("fhpetsani").onmouseover=new Function();$("fhpetsani").onmouseout=new Function();$("fhpetsani").onclick=new Function()}}}}$("farmhousecontainer").style.background="url("+imgpath+"farmhouse/basicback.jpg) top left no-repeat";showDiv(q[1]);for(var e=1;e<=20;e++){var s="";if(farmhouseitems[e]){for(var c=0;c<farmhouseitems[e].length;c++){var h="";if(farmhouseitems[e][c]["rack"]==1){if(farmhouseitems[e][c]["active"]==1){var l=farmhouseitems[e][c]["itemid"];s="item"+l;if(e==1){var t=".jpg"}else{if(e==5){var t=".gif"}else{var t=".png"}}if(e==1){t=".png"}var a="";var n="";if(e==11){h="farmhouse/items/"+farmhouseitems[e][c]["itemid"]+"_"+farmhouseitems[e][c]["color"]+t;no_ani=[97,99,101,102,103,228,232,234,246,248,294,299];if(!in_array(farmhouseitems[e][c]["itemid"],no_ani)){a="farmhouse/items/"+farmhouseitems[e][c]["itemid"]+"_"+farmhouseitems[e][c]["color"]+".gif"}if(farmhouseitems[e][c]["name"]!=""){$("fhpetsinfo").innerHTML=farmhouseitems[e][c]["name"];$("fhpetsani").onmouseover=new Function("showDiv('fhpetsinfo')");$("fhpetsani").onmouseout=new Function("hideDiv('fhpetsinfo')")}$("fhpetsani").onclick=new Function("petnameChange("+e+","+c+")")}else{var r=[129,161];if(in_array(farmhouseitems[e][c]["itemid"],r)){a="farmhouse/items/"+farmhouseitems[e][c]["itemid"]+"_"+farmhouseitems[e][c]["color"]+".gif"}if(in_array(farmhouseitems[e][c]["itemid"],[161])){h="transparent.gif"}else{h="farmhouse/items/"+farmhouseitems[e][c]["itemid"]+"_"+farmhouseitems[e][c]["color"]+t}if(farmhouseitems[e][c]["itemid"]==164){for(var b=1;b<=4;b++){if(b<=advent_count){n+='<div id="farmhouse_candle'+b+'" class="farmhouse_candle"></div>'}}}}break}}}}else{h=""}if(h!="undefined"&&h!=""){if(is_array(q[e])){id=q[e][0]}else{id=q[e]}if(in_array(l,[228,232,234,246,248])){}else{$(id).style.background="url("+imgpath+h+") top left no-repeat"}showDiv(id);$(id).className=s;if(n!=""&&e==7){$("fhtableani").innerHTML=n;showDiv("fhtableani")}if(a!=""&&e==8){$("fhchairani").style.background="url("+imgpath+a+") no-repeat";showDiv("fhchairani")}if(a!=""&&e==10){$("fhlightsani").style.background="url("+imgpath+a+") no-repeat";showDiv("fhlightsani")}if(e==11){if(a!=""){$("fhpetsani").style.backgroundImage="url("+imgpath+a+")"}else{$("fhpetsani").style.backgroundImage="none"}showDiv("fhpetsani")}}}}}function openFarmhouseSelectorCategory(a){showFarmhouseItemSelector();setFarmhouseItemSelector(a);farmhouseSelected(a,0,1)}function showFarmhouseItemSelector(){if($("farmhouseitemselector").style.display=="block"){$("farmhouseitemselector").style.display="none";$("farmhouseitemselectoractiveatezone").style.background="url("+imgpath+"farmhouse/itemselectorbar_on.gif)"}else{$("farmhouseitemselector").style.display="block";$("farmhouseitemselectoractiveatezone").style.background="url("+imgpath+"farmhouse/itemselectorbar_off.gif)"}}function clearCatalogueRight(){$("cataloguerightheader").innerHTML="";hideDiv("cataloguerightcolor");hideDiv("cataloguerightcontent");hideDiv("cataloguerightfooter")}function setCatalougeItemColor(b,a){$("cataloguerightcontent").style.background="url("+imgpath+"farmhouse/previews/"+b+"_"+a+".jpg) no-repeat 18px 18px";$("cataloguerightcontent").innerHTML='<img src="'+imgpath+'farmhouse/previewborder.png" border="0">';$("selectedcolor").value=a}function closeCatalogue(){hideDiv("farmhousetransp");hideDiv("catalogueinner")}var achievementpage=1;function showTrophies(){hideDiv("trophies_headline");if(usertrophies){var d="";if(usertrophies.gold>0){d+='<div class="trophy1"><div class="trophytxt1">'+usertrophies.gold+"</div></div>"}if(usertrophies.silber>0){d+='<div class="trophy2"><div class="trophytxt2">'+usertrophies.silber+"</div></div>"}if(usertrophies.bronze>0){d+='<div class="trophy3"><div class="trophytxt3">'+usertrophies.bronze+"</div></div>"}d+='<div style="clear:both;"></div>';$("trophycontainercontent").innerHTML=d}if(achievements){var a="";var b=1;var e=38;if(achievementpage>1){b=39;e=75}for(var c=b;c<=e;c++){if(achievements[c]&&achievements[c]["title"]){a+='<div id="ach'+c+'" class="ach'+c+'" onmouseover="showDiv(\'ach_tt'+c+"')\" onmouseout=\"hideDiv('ach_tt"+c+"')\">";a+='<div class="ach_tt'+c+' blackbox" id="ach_tt'+c+'" class="blackbox">';a+="<b>"+achievements[c]["title"]+"</b><br><br>";if(achievements[c]["date2"]){a+="<i>"+achievements[c]["date2"]+"</i><br><br>"}a+=achievements[c]["desc"];if(achievements[c]["info"]){a+="<br><br>"+achievements[c]["info"]}a+="</div>";a+="</div>"}}$("achievementcontainercontent").innerHTML=a;for(var c=b;c<=e;c++){if(achievements[c]&&achievements[c]["title"]){if(!achievements[c]["date"]&&$("ach"+c)){$("ach"+c).style.backgroundPosition="-1000px -1000px"}}}achievementNavi()}showDiv("farmhousetransp");showDiv("trophycontainer")}function achievementNavi(){if(achievementpage==1){$("trophycontainer").style.backgroundImage="url("+imgpath+"new_trophyrack_new.gif)";hideDiv("trophynavileft");showDiv("trophynaviright")}else{$("trophycontainer").style.backgroundImage="url("+imgpath+"new_trophyrack2_2.gif)";showDiv("trophynavileft");hideDiv("trophynaviright")}}function petnameChange(b,d){if(farmhouseitems){if(b==11){var c="";if(petnamecostbar>0||petnamecostcoins>0){c+=reallocatanimals_cost+"&nbsp;"}if(petnamecostbar>0){c+='<img src="'+imgpath+'money.gif" width="12" height="12" border="0">&nbsp;'+formatPrice(petnamecostbar)}if(petnamecostcoins>0){c+='<img src="'+imgpath+'menu/coins.gif" width="12" height="12" border="0">&nbsp;'+petnamecostcoins}c+="<br><br>"+fh_petnamechange_content+"<br>";c+='<input type="text" maxlength="10" size="20" id="petnameinsert" title="'+str_replace("%LETTERS%",petnamemaxletters,fh_maxpetnameletters)+'">';var a="setPetname("+b+","+d+")";globalcommitbox(fh_petnamechangeheadline,c,a);if(farmhouseitems[b][d]["name"]){$("petnameinsert").value=farmhouseitems[b][d]["name"]}$("petnameinsert").focus()}else{return false}}}function setPetname(c,e){if($("petnameinsert").value!=""){var b=$("petnameinsert").value;var d=farmhouseitems[c][e]["itemid"];var a=farmhouseitems[c][e]["color"];farmAction("setpetname",farm,0,d,a,b,c)}else{return false}}function setPetnameResponse(a,e,c,b,d){if(parseInt(e)==168&&b.toLowerCase()=="jule"){juleWasHere()}farmhouseitems=a[1];setFarmhouseInner();setFarmhouseItemSelector(d);farmhouseSelected(d,0,1)}function showFeedback2(c,b,a){$(c).innerHTML=b;window.setTimeout("showFeedbackOff('"+c+"','"+a+"')",2000)}function showFeedbackOff(b,a){if(a!="0"){$(b).innerHTML=a}}function coinsBonusItems(a){if(!a){a=1}farmAction("coinsbonusitems",farm,0,a)}function coinsBonusItemsResponse(a){var d="";if(a[1].length>0){for(var c=0;c<a[1].length;c++){var h=a[1][c]["action"];d+='<div id="coinsbonuspuppycontainer">';if(h==1){for(var b=0;b<a[1][c]["items"].length;b++){var e=a[1][c]["items"][b];d+='<div id="coinsbonuspuppy'+parseInt(b+1)+'" class="link" onclick="getCoinsBonusCommit('+e+');" ';d+="onmouseover=\"this.style.backgroundImage='url("+imgpath+"puppy_over"+parseInt(b+1)+".jpg)';\" ";d+="onmouseout=\"this.style.backgroundImage='url("+imgpath+"leer.gif)';\">";d+="</div>"}}if(h==2){for(var b=0;b<a[1][c]["items"].length;b++){var e=a[1][c]["items"][b];d+='<div id="coinsbonuscat'+parseInt(b+1)+'" class="link" onclick="getCoinsBonusCommit('+e+');" ';d+="onmouseover=\"this.style.backgroundImage='url("+imgpath+"cat_over"+parseInt(b+1)+".jpg)';\" ";d+="onmouseout=\"this.style.backgroundImage='url("+imgpath+"leer.gif)';\">";d+="</div>"}}if(h==3||h==999){for(var b=1;b<=5;b++){var e=a[1][c]["items"][0];d+='<div id="coinsbonussunflower'+b+'" class="link" onclick="getCoinsBonusCommit('+b+');" ';d+="onmouseover=\"this.style.backgroundImage='url("+imgpath+"sunflower_over"+b+".jpg)';\" ";d+="onmouseout=\"this.style.backgroundImage='url("+imgpath+"leer.gif)';\">";d+="</div>"}}if(h==4||h==998){for(var b=1;b<=5;b++){var e=a[1][c]["items"][0];d+='<div id="coinsbonuspumpkin'+b+'" class="link" onclick="getCoinsBonusCommit('+b+');" ';d+="onmouseover=\"this.style.backgroundImage='url("+imgpath+"pumpkin_over"+b+".jpg)';\" ";d+="onmouseout=\"this.style.backgroundImage='url("+imgpath+"leer.gif)';\">";d+="</div>"}}if(h==5||h==997){for(var b=1;b<=5;b++){var e=a[1][c]["items"][0];var l=[4,2,1,3,5];d+='<div id="coinsbonushedgehog'+b+'" class="link" onclick="getCoinsBonusCommit('+l[(b-1)]+');" ';d+="onmouseover=\"this.style.backgroundImage='url("+imgpath+"hedgehog_over"+b+".jpg)';\" ";d+="onmouseout=\"this.style.backgroundImage='url("+imgpath+"leer.gif)';\">";d+="</div>"}}d+="</div>";if(c==0){break}}$("coinsbonusheadline").innerHTML=coinsbonus_selectheadline;$("coinsbonuscontent").innerHTML=d;showDiv("transp");if($("coinsbonuspuppycontainer")){if(h==1){$("coinsbonuspuppycontainer").style.backgroundImage="url("+imgpath+"puppy_sel_inner.jpg)"}if(h==2){$("coinsbonuspuppycontainer").style.backgroundImage="url("+imgpath+"cat_sel_inner.jpg)"}if(h==3||h==999){$("coinsbonuspuppycontainer").style.backgroundImage="url("+imgpath+"sunflower_sel_inner.jpg)"}if(h==4||h==998){$("coinsbonuspuppycontainer").style.backgroundImage="url("+imgpath+"pumpkin_sel_inner.jpg)"}if(h==5||h==997){$("coinsbonuspuppycontainer").style.backgroundImage="url("+imgpath+"hedgehog_sel_inner.jpg)"}}$("coinsbonuscontainer").style.backgroundImage="url("+imgpath+"coinsbonusborder.gif)";showDiv("coinsbonuscontainer")}}function getCoinsBonusCommit(c){var a="getCoinsBonus("+c+");";var b=coinsbonus_commitcontent;globalcommitbox(coinsbonus_commitheadline,b,a)}function getCoinsBonus(a){farmAction("getcoinsbonus",farm,position,a)}function getCoinsBonusResponse(){hideDiv("transp");hideDiv("coinsbonuscontainer");initFarmhouse()}function mainOpenPan(a){initZones(1);showMain();initFarmhouse();if(a){searchPanID=a}showPan()}function gotoPanScene(a){mapGo2Location("farm",1);initFarmhouse();showPan(1);setTimeout(function(){var c=0;for(var b in panscenes.config.scenes[a]){c++}panscenes.initScene(a,c);panscenes.naviScene(c)},1000)}function showTravelAd(){if(tutorial==0){var a=getRandom(1,3);if(a==1){showDiv("travelpremiuminfo");hideDiv("travelad")}else{hideDiv("travelpremiuminfo");showDiv("travelad")}}else{hideDiv("travelpremiuminfo");hideDiv("travelad")}}function initFriends(){farmAction("initfriends",farm,0)}function initFriendsResponse(a){checkedfriends=a[1];uncheckedfriends=a[2];showfriendslist(1);showDiv("transp");if(setarab==1){$("friendscontainer").style.background="url("+imgpath+"friendlist_inner_arab.jpg)"}else{$("friendscontainer").style.background="url("+imgpath+"friendlist_inner.jpg)"}showDiv("friendscontainer");if(stopanimation==0&&setarab!=1){$("friendslistsheepani").style.background="url("+imgpath+"friendlist_sheepani.gif)"}}function showfriendslist(b){friendslistheadernavi(b);var e="";if(b==1){var h=checkedfriends}else{if(b==2){var h=uncheckedfriends}}friendslistsel=b;if(b==2){$("friendsinfo").innerHTML=""}e+='<ul id="friendslistcon">';var l=0;for(var d=0;d<h.length;d++){if(h[d]){if(b==1){var c='onclick="setFriendInfo('+h[d]["id"]+')";'}else{var c=""}e+='<li id="friendsline'+h[d]["id"]+'" class="friendsline" onmouseover="$(\'friendsline'+h[d]["id"]+"').style.backgroundColor='#E4B55D';\" onmouseout=\"$('friendsline"+h[d]["id"]+"').style.backgroundColor='transparent';\">";e+='<div class="friendslinename link" '+c+">";e+='<div id="friendsline_name">'+h[d]["name"];if(h[d]["gshort"]){e+="&nbsp;["+h[d]["gshort"]+"]"}e+="</div>";e+='<div id="friendslist_symbols">';if(h[d]["gstatus"]==1||h[d]["gstatus"]==2){e+='&nbsp;<img src="'+imgpath+"guild/"+h[d]["gstatus"]+'.gif" border="0">'}if(h[d]["premium"]){e+='&nbsp;<img src="'+imgpath+'star.png" border="0">'}e+="</div>";e+='<div style="clear:both;"></div>';e+="</div>";e+='<div class="friendslineoptions">';if(b==1){var a="messagesOpen('"+h[d]["name"]+"');";e+="<span class=\"link\" onclick=\"showPage('contracts', '"+h[d]["name"]+'\');"><img src="'+imgpath+'guild/contract.gif" border="0" onmouseover="showDiv(\'flcontractinfo'+d+"');\" onmouseout=\"hideDiv('flcontractinfo"+d+"');\"></span>&nbsp;";e+='<span class="link" onclick="'+a+'"><img src="'+imgpath+'guild/mail.gif" border="0" onmouseover="showDiv(\'flmsginfo'+d+"');\" onmouseout=\"hideDiv('flmsginfo"+d+"');\"></span>&nbsp;";click="giftshop.friendGift('"+h[d]["id"]+"')";e+='<span class="link" onclick="'+click+'"><img src="'+imgpath+'friendlist_gift.png" border="0" onmouseover="showDiv(\'flgiftinfo'+d+"');\" onmouseout=\"hideDiv('flgiftinfo"+d+"');\"></span>&nbsp;"}e+='<span class="link" onclick="delFriendSubmit('+h[d]["id"]+",'"+h[d]["name"]+'\');"><img src="'+imgpath+'friendlist_del.png" border="0" onmouseover="showDiv(\'fldelinfo'+d+"');\" onmouseout=\"hideDiv('fldelinfo"+d+"');\"></span>";e+='<div class="blackbox flmsginfo" id="flcontractinfo'+d+'" style="display:none; position:absolute; top:'+l+'px;">'+str_replace("%USER%",h[d]["name"],marktschreierwritecontract)+"</div>";e+='<div class="blackbox flmsginfo" id="flmsginfo'+d+'" style="display:none; position:absolute; top:'+l+'px;">'+str_replace("%USER%",h[d]["name"],marktschreierwriteuser)+"</div>";e+='<div class="blackbox flmsginfo" id="flgiftinfo'+d+'" style="display:none; position:absolute; top:'+l+'px;">'+friendslist_gift+"</div>";e+='<div class="blackbox flmsginfo" id="fldelinfo'+d+'" style="display:none; position:absolute; top:'+l+'px;">'+friendslist_del+"</div>";e+="</div>";e+='<div style="clear:both;"></div>';e+="</li>";l=l+23}}e+="</ul>";$("friendslistbody").innerHTML=e}function setActivateFriend(a){if(activatefriend>0){showfriendslist(friendslistsel)}$("friendsline"+a).onmouseover=function(b){};$("friendsline"+a).onmouseout=function(b){};$("friendsline"+a).style.backgroundColor="#E4B55D";activatefriend=a}function setFriendInfo(b){var a={friend:b};generalAction("friendinfo",a,b)}var friendlistinfo_maxletters=500;function setFriendInfoContent(m,c){var d=friendinfo;if(!(c>0)){c=1}var t="";t+='<div id="friendinfonavi" style="position:absolute; top:-15px; left:-7px; width:281px; height:78px;">';t+='<div style="position:absolute; top:15px; left:10px;">';t+='<div id="friendinfonavi_name">'+d.name;if(d.gshort){t+="&nbsp;["+d.gshort+"]"}t+="</div>";t+='<div id="friendinfonavi_showcase">';if(!isSteam()){t+='&nbsp;<img class="link" src="'+imgpath+'stadt/stats_sf_black.gif" border="0" onclick="window.open(\'schaugarten/index.php?mode=view&user='+d.id+"');\">"}if(d.gstatus==1||d.gstatus==2){t+='&nbsp;<img width="15" height="15" src="'+imgpath+"guild/"+d.gstatus+'.gif" border="0">'}if(d.premium==1){t+='&nbsp;<img width="15" height="15" src="'+imgpath+'star.png" border="0">'}else{t+='&nbsp;<img width="15" height="15" src="'+imgpath+'leer.gif" border="0">'}t+="</div>";t+='<div style="clear:both;"></div>';t+="</div>";if(setarab==1){t+='<div class="link" style="position:absolute; top:40px; right:16px; width:50px; height:35px;" onclick="setFriendInfoContent(1);" onmouseover="showDiv(\'friendlistnavi1\');" onmouseout="hideDiv(\'friendlistnavi1\');"></div>';t+='<div class="link" style="position:absolute; top:40px; right:72px; width:50px; height:35px;" onclick="setFriendInfoContent(2);" onmouseover="showDiv(\'friendlistnavi2\');" onmouseout="hideDiv(\'friendlistnavi2\');"></div>'}else{t+='<div class="link" style="position:absolute; top:40px; left:16px; width:50px; height:35px;" onclick="setFriendInfoContent(1);" onmouseover="showDiv(\'friendlistnavi1\');" onmouseout="hideDiv(\'friendlistnavi1\');"></div>';t+='<div class="link" style="position:absolute; top:40px; left:72px; width:50px; height:35px;" onclick="setFriendInfoContent(2);" onmouseover="showDiv(\'friendlistnavi2\');" onmouseout="hideDiv(\'friendlistnavi2\');"></div>'}t+='<div class="blackbox" id="friendlistnavi1">'+friendlistnavi1+"</div>";t+='<div class="blackbox" id="friendlistnavi2">'+friendlistnavi2+"</div>";t+="</div>";t+='<div id="friendlistinfoblock" style="position:absolute; top:75px; height:340px; overflow:auto; width:100%;">';if(m==1){var q=parseInt(d.pktdiff);var r=parseInt(q-d.pktremain);var u=Math.floor(parseInt(r*100)/q);if(u==0){u=1}var h="";h+='<div style="position:relative; background:url('+imgpath+'levelbar.jpg) top left no-repeat; width:244px; height:20px; overflow:hidden;">';h+='<div style="position:absolute; background:url('+imgpath+"levelbar_inner.png) top left no-repeat; width:244px; height:20px; top:0px; left:-"+(parseInt((244/100*(100-u))))+'px;"></div>';h+='<div style="position:absolute; width:250px; color:#000; margin-top:3px; text-align:center;">'+u+"%</div>";h+="</div>";t+='<ul style="margin:0px; padding:0px; list-style-type:none;">';t+='<li><div class="friendsinfoleft">'+friendslist_table_id+'</div><div class="friendsinforight">'+d.id+"</div><br></li>";t+='<li><div class="friendsinfoleft">'+friendslist_table_lvl+'</div><div class="friendsinforight">'+d.lvl+"</div><br></li>";t+='<li><div class="friendsinfoleft">'+friendslist_table_pkt+'</div><div class="friendsinforight">'+d.pkt+"</div><br></li>";t+="<li>"+h+'<div style="font-size:10px;">'+str_replace("%POINTS%",d.pktremainf,friendslist_table_pktremain)+"</div></li>";t+='<li><div class="friendsinfoleft">'+friendslist_table_bar+'</div><div class="friendsinforight">'+d.bar+"</div><br></li>";t+='<li><div class="friendsinfoleft">'+friendslist_table_quest+'</div><div class="friendsinforight">'+d.quest+"</div><br></li>";if(d.gname){t+='<li><div class="friendsinfoleft">'+friendslist_table_guild+'</div><div class="friendsinforight">'+d.gname+"</div><br></li>"}t+='<li><div class="friendsinfoleft">'+friendslist_table_sales+'</div><div class="friendsinforight">'+d.salesnpc+"</div><br></li>";t+='<li><div class="friendsinfoleft">'+friendslist_table_money+'</div><div class="friendsinforight">'+formatPrice(d.incomenpc)+"</div><br></li>";t+='<li><div class="friendsinfoleft">'+friendslist_table_rating+'</div><div class="friendsinforight">'+d.rating+"</div><br></li>";t+='<li><div class="friendsinfoleft">'+friendslist_table_ratingall+'</div><div class="friendsinforight">'+d.ratingall+"</div><br></li>";t+="</ul>";t+="<div>";t+='<textarea id="friendlistinfo" style="width:250px; height:60px;" onchange="calcFriendlistInfo()" onkeyup="calcFriendlistInfo()">';if(typeof friendinfo.info!="undefined"){t+=d.info}t+="</textarea>";t+='<div id="friendlistinfocount" style="font-size:9px;">'+str_replace("%LETTERS%",friendlistinfo_maxletters,guildcreatedialogcountletters)+"</div>";t+='<button type="button" id="friendlist_infofield" onclick="fireFriendlistInfo('+d.id+')">'+t_save+"</button>";t+="</div>"}if(m==2){t+='<div style="width:100%;">';var v=0;var e=0;t+='<div style="float:left;">'+farmname+"</div>";for(var n in d.farm){t+='<div class="link" style="float:left; margin-left:4px; border:1px solid #794D0C; text-align:center; width:15px; height:15px; ';if(c==n){t+="background-color:#C7A661;"}t+='" onclick="setFriendInfoContent(2,'+n+')">'+n+"</div>"}t+='<div style="clear:both;"></div>';t+='<div style="position:relative; margin-top:20px;">';n=c;if(d.farm[n]){if(c==4){var a=6}else{a=6}for(var l=1;l<=a;l++){if(d.farm[n][l]["bid"]>0){var b="";for(var A=1;A<=d.farm[n][l]["level"];A++){b+='<img src="'+imgpath+'star.png" height="10" width="10">'}t+='<div style="width:64px; height:64px; position:absolute; top:'+v+"px; left:"+e+'px;" ';t+='onmouseover="setFriendInfoBuildingStats('+d.farm[n][l]["bid"]+');" onmouseout="setFriendInfoBuildingStats(0);">';t+='<img src="'+imgpath+"building"+d.farm[n][l]["bid"]+'.gif" border="0">';t+='<div style="position:absolute; top:4px; left:4px;">'+b+"</div>";t+="</div>"}else{if(d.farm[n][l]["status"]>0){var z="block"+d.farm[n][l]["status"]}else{var z="building0"}t+='<div style="width:64px; height:64px; position:absolute; top:'+v+"px; left:"+e+'px;">';t+='<img src="'+imgpath+z+'.gif" border="0">';t+="</div>"}e=e+70;if(l%3==0){v=v+70;e=0}}}t+="</div>";t+='<div style="position:relative; top:150px;" id="friendslistbuildinginfo"></div>'}t+="</div>";$("friendsinfo").innerHTML=t;if(m==1){calcFriendlistInfo()}var w="";if(setarab==1){var w="_arab"}if(m==1){$("friendinfonavi").style.background="url("+imgpath+"friendinfo_general"+w+".jpg)"}else{if(m==2){$("friendinfonavi").style.background="url("+imgpath+"friendinfo_farm"+w+".jpg)"}}}function calcFriendlistInfo(){var a=$("friendlistinfo").value;if(typeof friendinfo.info=="undefined"){friendinfo.info=""}if(a!=friendinfo.info||a.length>0&&!friendinfo.info){showDiv("friendlist_infofield")}else{hideDiv("friendlist_infofield")}if(a.length>friendlistinfo_maxletters){$("friendlistinfo").value=a.substring(0,(friendlistinfo_maxletters));$("friendlistinfo").scrollTop=$("friendlistinfo").scrollHeight}$("friendlistinfocount").innerHTML=str_replace("%LETTERS%",(friendlistinfo_maxletters-$("friendlistinfo").value.length),guildcreatedialogcountletters)}function fireFriendlistInfo(c){var a=$("friendlistinfo").value;var b={id:c,text:encodeURIComponent(a)};generalAction("savefriendinfo",b,c)}function setFriendInfoBuildingStats(a){if(a>0){$("friendslistbuildinginfo").innerHTML="<b>"+buildinginfos[0][a][10]+"</b>"}else{$("friendslistbuildinginfo").innerHTML=""}}function addFriendSubmit(d){if($("friendsearchinput").value!=""){showDiv("friendscontainertransp");var a="addFriend();";var b=str_replace("%FRIEND%","<b>"+$("friendsearchinput").value+"</b>",friendslist_invite_body);var c="hideDiv('friendscontainertransp'); hideDiv('globalbox');";globalcommitbox(friendslist_invite_head,b,a,c)}else{return false}}function addFriend(){if($("friendsearchinput").value!=""){var a={friend:encodeURIComponent($("friendsearchinput").value)};generalAction("addfriend",a)}}function showFriendlistFeedback(b,a){$(b).innerHTML=a;showDiv(b);window.setTimeout("showFriendlistFeedbackOff('"+b+"')",1000)}function showFriendlistFeedbackOff(a){Effect.Fade($(a),{duration:1,from:0.7,to:0})}function delFriendSubmit(e,b){showDiv("friendscontainertransp");var a="delFriend("+e+",'"+b+"');";var c=str_replace("%FRIEND%","<b>"+b+"</b>",friendslist_del_body);var d="hideDiv('friendscontainertransp'); hideDiv('globalbox');";globalcommitbox(friendslist_del_head,c,a,d)}function delFriend(c,a){var b={friend:c};generalAction("delfriend",b,c,a)}function acceptFriend(b){var a={friend:b};generalAction("acceptfriend",a)}function denyFriend(b){var a={friend:b};generalAction("denyfriend",a)}function friendslistheadernavi(a){var b="";if(setarab==1){var b="_arab"}if(a==1){$("friendslistheader").style.background="url("+imgpath+"locked"+b+".jpg)"}else{if(a==2){$("friendslistheader").style.background="url("+imgpath+"unlocked"+b+".jpg)"}}}function buyPresentFriend(){var a=$("giftid").value;var d=$("presenteeid1").value;var b=$("presenteename1").value;var c=$("presenteemsg1_fl").value;if(a==""||d==""){return false}else{$("presenteeid1").value="";$("presenteemsg1_fl").value="";cityAction("buypresentfriend",a,d,c,b)}}function runEE(a){if(a==1){showDiv("ee1a");new Effect.Move("ee1a",{y:-1000,duration:10,transition:Effect.Transitions.linear,mode:"relative",afterFinish:function(){$("ee1a").style.top="700px";hideDiv("ee1a")}});$("ee1a_1").innerHTML="&#9834; Always look of the bright side of life... &#9835;"}}function startMoo(){var c="";c+='<div id="ee_moo_title"><span style="font-size:14px;">YOU\'VE FOUND</span><br>THE SECRET COW-LEVEL!</div>';for(var b=1;b<=50;b++){var e=getRandom(0,500);c+='<div id="ee_moo'+b+'" class="ee_moo ee_moo_start" style="top:'+e+'px">';c+='  <div id="ee_moo'+b+'_tt" class="ee_moo_tt">MOO</div>';c+="</div>"}$("ee_moos").innerHTML=c;for(var b=1;b<=50;b++){var d=getRandom(5,15);setTimeout(function(){$("ee_moo_title").addClassName("ee_moo_out")},200);new Effect.Move("ee_moo"+b,{x:1500,duration:d,transition:Effect.Transitions.linear,mode:"relative",afterFinish:function(){hideDiv("ee_moo"+b)}});var a=getRandom(200,1000);setTimeout(function(){showDiv("ee_moo"+b+"_tt")},a)}setTimeout(function(){$("ee_moo_title").addClassName("ee_moo_out")},100);setTimeout(function(){hideDiv("ee_moos")},8000)}var reallocateBuildingFarmSelect1=1;var reallocateBuildingPosSelect1=0;var reallocateBuildingFarmSelect2=1;var reallocateBuildingPosSelect2=0;var reallocateAnimalsCart={};function openReallocateBuilding(a){if(!$("building_overview_content")){main.buildingOverviewNavi("buildings")}else{openReallocate("buildings",a)}}function openReallocateAnimals(a){if(!$("building_overview_content")){main.buildingOverviewNavi("animals")}else{openReallocate("animals",a)}}function controlReallocate(a,c,b){if(a==1){if(reallocateBuildingFarmSelect1==reallocateBuildingFarmSelect2&&c==reallocateBuildingPosSelect2){return false}if(reallocateBuildingFarmSelect1!=$("selectFarmReallocateBuilding1").value){reallocateBuildingPosSelect1=0}if(reallocateBuildingFarmSelect1==$("selectFarmReallocateBuilding1").value&&c==reallocateBuildingPosSelect1){reallocateBuildingPosSelect1=0}else{if(c>0){reallocateBuildingPosSelect1=c}}reallocateBuildingFarmSelect1=$("selectFarmReallocateBuilding1").value}if(a==2){if(reallocateBuildingFarmSelect1==reallocateBuildingFarmSelect2&&c==reallocateBuildingPosSelect1){return false}if(reallocateBuildingFarmSelect2!=$("selectFarmReallocateBuilding2").value){reallocateBuildingPosSelect2=0}if(reallocateBuildingFarmSelect2==$("selectFarmReallocateBuilding2").value&&c==reallocateBuildingPosSelect2){reallocateBuildingPosSelect2=0}else{if(c>0){reallocateBuildingPosSelect2=c}}reallocateBuildingFarmSelect2=$("selectFarmReallocateBuilding2").value}openReallocate(b)}function buildFarmReallocate(l,m){if(l==1){var e=reallocateBuildingFarmSelect1;var a=reallocateBuildingPosSelect1}if(l==2){var e=reallocateBuildingFarmSelect2;var a=reallocateBuildingPosSelect2}var r=0;if(reallocateBuildingFarmSelect1>0&&reallocateBuildingPosSelect1>0){r=farms_data.farms[reallocateBuildingFarmSelect1][reallocateBuildingPosSelect1].buildingid}if(reallocateBuildingFarmSelect2>0&&reallocateBuildingPosSelect2>0){r=farms_data.farms[reallocateBuildingFarmSelect2][reallocateBuildingPosSelect2].buildingid}var d="";for(var n in farms_data.farms[e]){var s="";var q="";var b=0;if(farms_data.farms[e][n].buildingid){b=farms_data.farms[e][n].buildingid}if(farms_data.farms[e][n].status>0){s="controlReallocate("+l+", "+n+", '"+m+"')"}else{b="Block"}if(farms_data.farms[e][n].premium==1&&!premium){s=""}if(reallocateBuildingFarmSelect1==reallocateBuildingFarmSelect2){if((l==1&&reallocateBuildingPosSelect2==n)||(l==2&&reallocateBuildingPosSelect1==n)){q="transp";s=""}}if(m=="animals"){if(farms_data.farms[e][n].animals>-1){if((r>0&&farms_data.farms[e][n].buildingid!=r)||farms_data.farms[e][n].production){q="transp";s=""}}else{q="transp";s=""}}var h="";if(reallocate_addon==1){if(buildinginfos[0][b]){var c=0;if(l==1){if(buildinginfos[0][b][13]&&!in_array(reallocateBuildingFarmSelect2,buildinginfos[0][b][13])){c=1}if(b==1&&in_array(reallocateBuildingFarmSelect1,reallocate_config.uniquefarms)&&reallocateBuildingFarmSelect1!=reallocateBuildingFarmSelect2){c=1}}if(l==2){if(buildinginfos[0][b][13]&&!in_array(reallocateBuildingFarmSelect1,buildinginfos[0][b][13])){c=1}if(b==1&&in_array(reallocateBuildingFarmSelect2,reallocate_config.uniquefarms)&&reallocateBuildingFarmSelect1!=reallocateBuildingFarmSelect2){c=1}}if(c==1){h="filter:grayscale(1); opacity:0.5; pointer-events:none;"}}}d+='<div style="position:relative; float:left; margin:0 5px 10px 5px; '+h+'" class="link buildingMiddle'+b+" "+q+'" onclick="'+s+'">';if(farms_data.farms[e][n].premium==1){d+='<div class="icon_premium" style="position:absolute; right:0;"></div>'}if(farms_data.farms[e][n].production){d+='<div style="background:url('+imgpath+'reallocatebuildingproductionani.gif); width:25px; height:24px; position:absolute; top:0px; left:0px;"></div>'}if(+n==+a){d+='<div class="buildingMiddleSelect"></div>'}d+="</div>";if(n%3==0){d+='<div class="clear"></div>'}}return d}function buildAnimalReallocate(l){if(l==1){f=reallocateBuildingFarmSelect1;p=reallocateBuildingPosSelect1}if(l==2){f=reallocateBuildingFarmSelect2;p=reallocateBuildingPosSelect2}var c="";if(f>0&&p>0&&farms_data.farms[f][p]){var a=farms_data.farms[f][p];var d=a.animals;if(a.animalsmax>0){var n=a.buildingid;for(var b=1;b<=a.animalsmax;b++){var q="selectReallocateAnimal("+l+","+f+","+p+","+b+")";var m="animalsheadsempty";if(farms_data.animals[f]&&farms_data.animals[f][p]&&farms_data.animals[f][p][b]){var h=farms_data.animals[f][p][b].data.special;m="animalheads"+n+"_"+h;d--}else{if(d>0){m="animalheads"+n;d--}}var e="margin:2px 2px;";if(reallocateAnimalsCart[l]&&reallocateAnimalsCart[l][f]&&reallocateAnimalsCart[l][f][p]&&reallocateAnimalsCart[l][f][p]==b){e="margin:1px 1px; border:1px dashed yellow;"}c+='<div style="float:left; width:20px; height:20px; '+e+'" class="'+m+' link" onclick="'+q+'">&nbsp;</div>'}c+='<div class="clear"></div>'}}return c}function selectReallocateAnimal(b,c,d,a){if(reallocateAnimalsCart[b]&&reallocateAnimalsCart[b][c]&&reallocateAnimalsCart[b][c][d]){if(reallocateAnimalsCart[b][c][d]==a){delete reallocateAnimalsCart[b]}else{reallocateAnimalsCart[b][c][d]=a}}else{if(!reallocateAnimalsCart[b]){reallocateAnimalsCart[b]={}}if(!reallocateAnimalsCart[b][c]){delete reallocateAnimalsCart[b];reallocateAnimalsCart[b]={};reallocateAnimalsCart[b][c]={}}if(!reallocateAnimalsCart[b][c][d]){reallocateAnimalsCart[b][c][d]=a}}openReallocateAnimals()}function openReallocate(n,l){if(l==1){reallocateBuildingFarmSelect1=1;reallocateBuildingPosSelect1=0;reallocateBuildingFarmSelect2=1;reallocateBuildingPosSelect2=0;reallocateAnimalsCart={}}var u="";var t="";if(n=="buildings"){var r=reallocatebuildinghead;var d='<div style="margin-bottom:10px; width:470px;">'+str_replace("%COST%",reallocatebuildingcoin+"&nbsp;"+t_coins,t_reallocate_newinfo)+"</div>";if(reallocate_addon==1){d+='<div class="info-btn" onmouseover="showDiv(\'reallocate_building_info_tt\')" onmouseout="hideDiv(\'reallocate_building_info_tt\')">';d+='  <div id="reallocate_building_info_tt" class="ttbox" style="text-align:left;">';d+='    <div style="font-weight:bold; margin-bottom:5px;">'+t_reallocate_building_help_head+"</div>";d+="    <div>"+t_reallocate_building_help1+"</div>";d+="  </div>";d+="</div>"}}if(n=="animals"){var r=reallocatanimals_info;var d='<div style="margin-bottom:10px; width:470px;">'+reallocatanimals_intro+"</div>"}var a=[1,2,3,4];if(reallocate_addon==1&&n=="buildings"){a=reallocate_config.valid}for(var h in farms_data.farms){if(!in_array(h,a)){continue}var w="";if(reallocateBuildingFarmSelect1==h){w="selected"}u+="<option "+w+' value="'+h+'">'+farmname+h+"</option>";w="";if(reallocateBuildingFarmSelect2==h){w="selected"}t+="<option "+w+' value="'+h+'">'+farmname+h+"</option>"}d+='<div style="float:left; width:225px; padding-right:10px; border-right:1px dashed #C3A75E;">';d+='  <div style="background-color:#C3A75E; border-radius:4px; padding:2px;"><select id="selectFarmReallocateBuilding1" onchange="controlReallocate(1, -1, \''+n+'\')" style="border:0; padding:1px; border-radius:4px;">'+u+"</select></div>";d+='  <div style="margin-top:10px;">'+buildFarmReallocate(1,n)+"</div>";if(n=="animals"){d+='<div id="buildAnimalsReallocate1">'+buildAnimalReallocate(1)+"</div>"}d+="</div>";d+='<div style="float:left; width:225px; margin-left:10px;">';d+='  <div style="background-color:#C3A75E; border-radius:4px; padding:2px;"><select id="selectFarmReallocateBuilding2" onchange="controlReallocate(2, -1, \''+n+'\')" style="border:0; padding:1px; border-radius:4px;">'+t+"</select></div>";d+='  <div style="margin-top:10px;">'+buildFarmReallocate(2,n)+"</div>";if(n=="animals"){d+='<div id="buildAnimalsReallocate2">'+buildAnimalReallocate(2)+"</div>"}d+="</div>";d+='<div class="clear"></div></div>';if($("building_overview_content")){$("building_overview_content").innerHTML=d}else{globalBoxFlex(r,d,0,0,1)}if(n=="buildings"&&reallocateBuildingFarmSelect1>0&&reallocateBuildingPosSelect1>0&&reallocateBuildingFarmSelect2>0&&reallocateBuildingPosSelect2>0){if(farms_data.farms[reallocateBuildingFarmSelect1][reallocateBuildingPosSelect1].buildingid==6&&farms_data.farms[reallocateBuildingFarmSelect2][reallocateBuildingPosSelect2].premium||farms_data.farms[reallocateBuildingFarmSelect2][reallocateBuildingPosSelect2].buildingid==6&&farms_data.farms[reallocateBuildingFarmSelect1][reallocateBuildingPosSelect1].premium){globalerrorbox(t_error1053);return false}var r=reallocatebuildinghead;var e='<div style="float:left; margin:1px 4px 0 70px;">'+reallocatanimals_cost+"</div>";e+='<div class="icon_coins" style="float:left; margin-right:4px;"></div>';e+='<div style="float:left; margin-top:1px; font-weight:bold;">'+reallocatebuildingcoin+"&nbsp;"+t_coins+"</div>";e+='<div class="clear"></div>';e+='<div style="margin-top:10px;">'+reallocatebuildingcommit1+"</div>";var s=reallocateBuildingFarmSelect1+","+reallocateBuildingPosSelect1+","+reallocateBuildingFarmSelect2+","+reallocateBuildingPosSelect2;var v="farmAction('reallocatebuilding', "+farm+", 0, '"+s+"')";var q="hideDiv('globaltransp'); hideDiv('globalbox'); openReallocateBuilding(1)";globalcommitbox(r,e,v,q)}if(n=="animals"){if(reallocateAnimalsCart[1]&&reallocateAnimalsCart[2]){var r=reallocatanimals_info;var e="";var c="";for(var m in reallocateAnimalsCart){for(var h in reallocateAnimalsCart[m]){for(var b in reallocateAnimalsCart[m][h]){if(m==1){e+=str_replace("%COST%",formatPrice(farms_data.farms[h][b].allocate_cost),reallocatanimals_commit)}c+="|"+h+"_"+b+"_"+reallocateAnimalsCart[m][h][b]}}}var v="farmAction('reallocate_animals', "+farm+", 0, '"+c+"')";var q="hideDiv('globaltransp'); hideDiv('globalbox'); reallocateAnimalsCart = {}; openReallocate('animals')";globalcommitbox(r,e,v,q)}}}var powerup_block=0;var powerup_rackpage=1;function handlePowerups(n){if(powerupactive){for(var c in powerupactive){if(powerupactive[c]&&powerupactive[c].remain>0){if(!gametimer.powerups){gametimer.powerups=new Object}gametimer.powerups[c]=1}}}hideDiv("powerupcontainer");if(farm==1){showDiv("powerupcontainer")}hideDiv("powerupbar");if(poweruprack){showDiv("powerupbar")}hideDiv("powerupselector");if(n){powerup_rackpage=n;var l=0;if(poweruprack){html="";for(var c in poweruprack){if(poweruprack[c]){l++;var r=(((powerup_rackpage-1)*12)+1);if(powerup_rackpage==1){r=1}var s=(powerup_rackpage*12);if(l>=r&&l<=s){if(poweruprack[c][5]&&poweruprack[c][5][0]){var d="powerup_rackitem_back1";var h=poweruprack[c][5][0][0];var e=poweruprack[c][5][0][1];var b=str_replace("%AMOUNT%",poweruprack[c][5][0][1],powerup_bonustext1)}if(poweruprack[c][5]&&poweruprack[c][5][1]){var d="powerup_rackitem_back2";var h=poweruprack[c][5][1][0];var e="+"+poweruprack[c][5][1][1];var b=str_replace("%TIME%",formatTime(poweruprack[c][5][1][2]),powerup_bonustext2);b=str_replace("%CROP%","+"+poweruprack[c][5][1][1],b)}if(poweruprack[c][5]&&poweruprack[c][5][2]){var d="powerup_rackitem_back3";var h=poweruprack[c][5][2][0];var e="+"+poweruprack[c][5][2][1];var b=str_replace("%TIME%",formatTime(poweruprack[c][5][2][2]),powerup_bonustext3);b=str_replace("%POINTS%","+"+poweruprack[c][5][2][1],b)}if(poweruprack[c][5]&&poweruprack[c][5][3]){var d="powerup_rackitem_back4";var h=0;var e='<div style="width:47px; text-align:center;">'+poweruprack[c][5][3]+"%</div>";var b=str_replace("%PERCENT%",poweruprack[c][5][3],t_pointsboost)}if(poweruprack[c][11]){var d="powerup_rackitem_backtree";b=str_replace("%PRODUCT%",forestry_product[h],b)}else{b=str_replace("%PRODUCT%",produkt_name[h],b)}if(poweruprack[c][12]){var d="powerup_rackitem_backbirthday"}var q="link";var t="activatePowerupCommit("+poweruprack[c][0]+",'"+poweruprack[c][2]+"')";if(powerupactive&&powerupactive[c]&&powerupactive[c].remain>0){t="";q="";b+='<div class="bonusinfo">'+t_powerupstillactive+"</div>"}html+='<div class="powerup_rackitem '+d+" "+q+'" onclick="'+t+'" onmouseover="showDiv(\'powerup_rackitem'+c+"_tt')\" onmouseout=\"hideDiv('powerup_rackitem"+c+"_tt')\">";html+='  <div class="powerup_rackitem_productline">';if(h){html+='<div class="powerup_rackitem_img kp'+h+'"></div>'}html+='    <div class="powerup_rackitem_txt">'+e+"</div>";html+='    <div class="clear;"></div>';html+="  </div>";html+='  <div class="powerup_rackitem_amount">'+poweruprack[c].rack+"</div>";html+='  <div id="powerup_rackitem'+c+'_tt" class="powerup_rackitem_tt ttbox"><div class="bold">'+poweruprack[c][2]+"</div>"+b+"</div>";html+="</div>"}}}hideDiv("powerselectornaviup");hideDiv("powerselectornavidown");var a=Math.ceil(l/12);if(powerup_rackpage<a){showDiv("powerselectornavidown")}if(powerup_rackpage>1){showDiv("powerselectornaviup")}if(currentuserlevel>=powerup_show_points_cap_level){html+='<div class="powerup_limit link" onmouseover="showDiv(\'powerup_limit_tt\')" onmouseout="hideDiv(\'powerup_limit_tt\')">';html+='  <div class="helpbutton_blue"></div>';html+='  <div id="powerup_limit_tt" class="ttbox">';html+='    <div class="info">'+t_powerup_points_cap_info+"</div>";for(var c in powerup_points_cap){var m=c.replace("pu","");html+='<div class="line">';html+='  <div class="col1">'+m+"%</div>";html+='  <div class="col2">'+formatNumber(powerup_points_cap[c])+"&nbsp;"+t_points+"</div>";html+="</div>"}html+="  </div>";html+="</div>"}$("powerselectorcontent").innerHTML=html;$("powerupselector").style.display="block";$("powerupbar").style.background="url("+imgpath+"powerupbar_on.gif)";$("powerupbar").onclick=new Function("handlePowerups()")}}else{closePowerups()}}function closePowerups(){hideDiv("powerupselector");$("powerupbar").style.background="url("+imgpath+"powerupbar_off.gif)";$("powerupbar").onclick=new Function("handlePowerups(1)")}function activatePowerupCommit(e,b){var d=str_replace("%NAME%","<b>"+b+"</b>",powerup_activate_content);var a="activatePowerup("+e+");";var c="hideDiv('globaltransp'); hideDiv('globalbox'); showDiv('transp3');";globalcommitbox(powerup_activate_headline,d,a,c)}function activatePowerup(a){if(farm==1&&!powerup_block){powerup_block=1;farmAction("activatepowerup",farm,1,a)}}function powerupTimer(){if(gametimer.powerups){var b="";for(var e in gametimer.powerups){if(powerupactive[e]){var d=powerupactive[e].remain--;if(d>0){if(powerupactive[e][5][0]){var a=powerupactive[e][5][0][0];var c=str_replace("%AMOUNT%",powerupactive[e][5][0][1],powerup_bonustext1)}if(powerupactive[e][5][1]){var a=powerupactive[e][5][1][0];var c=str_replace("%TIME%",formatTime(powerupactive[e][5][1][2]),powerup_bonustext2);c=str_replace("%CROP%","+"+powerupactive[e][5][1][1],c)}if(powerupactive[e][5][2]){var a=powerupactive[e][5][2][0];var c=str_replace("%TIME%",formatTime(powerupactive[e][5][2][2]),powerup_bonustext3);c=str_replace("%POINTS%","+"+powerupactive[e][5][2][1],c)}if(powerupactive[e][11]){c=str_replace("%PRODUCT%",forestry_product[a],c)}else{c=str_replace("%PRODUCT%",produkt_name[a],c)}b+='<div style="margin-bottom:10px;">';b+='  <div class="bold">'+powerupactive[e][2]+"</div>";b+="  <div>"+formatTime(d)+"&nbsp;</div>";b+='  <div class="bonusinfo">'+c+"</div>";b+="</div>"}else{delete gametimer.powerups[e]}}}if(b!=""){$("poweruptimes_content").innerHTML=b;showDiv("poweruptimes")}else{clearTimer("powerups");hideDiv("poweruptimes")}}}function initGardenSpeedup(a){if(speedupgardenactive==1){globalSpeedupBox("garden",a,1)}}var blockgardenspeedup=0;function useGardenSpeedup(b,a){if(speedupgardenactive==1&&!blockgardenspeedup){blockgardenspeedup=1;farmAction("gardenspeedup",farm,b,a)}else{return false}}function useGardenSpeedupResponse(b,e,a){if(b[1].wasforfree){if(b[1].wasforfree==1){freegardenspeedup=0}if(b[1].wasforfree==2){freegardenspeedup2=0}if(b[1].wasforfree==2){freegardenspeeduptelekom=0}if(!freegardenspeedup&&!freegardenspeedup2&&!freegardenspeeduptelekom){for(var c=1;c<=4;c++){for(var d=1;d<=6;d++){if($("farm_button_gardenspeedup"+c+"_"+d)){$("farm_button_gardenspeedup"+c+"_"+d).className="farm_button_gardenspeedup speedupgardenbutton link"}}}}}specialZoneFieldHandler(a)}var questbarstatus=0;function initQuestbarControl(){farmAction("questbar",farm,0)}function setQuestbarControl(){if(tutorial>0||currentuserlevel<3){hideDiv("quests_status_bar")}else{if(currentuserlevel<questline_show_minlevel){hideDiv("questbarcontrol")}else{showDiv("questbarcontrol")}if(questbarstatus==1){hideDiv("quests_status_bar");$("questbarcontrol").style.backgroundPosition="0px -20px"}else{showDiv("quests_status_bar");$("questbarcontrol").style.backgroundPosition="0px 0px"}}}function openForestryQuestBox(){if(premium>0){mapGo2Location("city",2);showDiv("transp3");initCampaigns()}}function openFoodworldQuestBox(){if(premium>0){if(foodworld_quicknavi==1){setFoodworldDialog("quest")}else{foodworldAction("foodworld_init","questbox")}}}function touchpad(a,b){farmAction("touchpad",farm,0,a,b)}function setTouchControl(a,b){if(a==1){$("game_control").style.backgroundImage="url("+imgpath+"button_pad.png)";$("game_control").onclick=new Function("touchpad(0,1)");$("game_control_tt").innerHTML=settouch_off;if($("touchinfobox")&&b==1){showDiv("globaltransp");showDiv("touchinfobox");showDiv("touchinfobox_inner1");hideDiv("touchinfobox_inner2")}}else{$("game_control").style.backgroundImage="url("+imgpath+"button_mouse.png)";$("game_control").onclick=new Function("touchpad(1,1)");$("game_control_tt").innerHTML=settouch_on;if($("touchinfobox")&&b==1){showDiv("globaltransp");showDiv("touchinfobox");hideDiv("touchinfobox_inner1");showDiv("touchinfobox_inner2")}}}var cropbonus_remain=0;var cropbonus_data=new Object;function setCropBonusCommit(a){var c="<div>"+str_replace("%COINS%",a,t_coinsfeatureactivate)+"</div>";var b="farmAction('setcropbonus',1,1)";globalcommitbox(t_cropbonusbox_headline,c,b)}function showCropBonus(a){if(a){cropbonus_remain=a;showDiv("cropbonus_symbol");if(gametimer.cropbonus){clearTimer("cropbonus")}gametimer.cropbonus=1}}function cropBonusTimer(){cropbonus_remain--;if(cropbonus_remain>0){$("cropbonus_symbol_tt_time").innerHTML=formatTime(cropbonus_remain)}else{hideDiv("cropbonus_symbol");clearTimer("cropbonus");updateRack(_currRack,1)}}function showCropBonusBox(){if(cropbonus_remain>0){globalerrorbox(error1062)}else{farmAction("initcropbonus",1,1)}}function cropBonusCoolDownTimer(){cropbonus_data.remain2--;if(cropbonus_data.remain2>0){showDiv("cropboxbonusbutton_sw");$("cropboxbonusbutton_sw").innerHTML='<span style="font-size:11px; font-weight:normal;">'+str_replace("%TIME%",formatTime(cropbonus_data.remain2),t_cropbonusavailable)+"</span><br>"+str_replace("%COINS%",cropbonus_data.coins,t_forcoins);$("cropboxbonusbutton_sw").onclick=new Function("");$("cropboxbonusbutton").innerHTML='<span style="font-size:11px; font-weight:normal;">'+t_cropbonusbookitnow+"</span><br>"+str_replace("%COINS%",cropbonus_data.coins2,t_forcoins);$("cropboxbonusbutton").onclick=new Function("setCropBonusCommit("+cropbonus_data.coins2+")")}else{hideDiv("cropboxbonusbutton_sw");$("cropboxbonusbutton_sw").onclick=new Function("");$("cropboxbonusbutton").innerHTML=str_replace("%COINS%",cropbonus_data.coins,t_forcoins);$("cropboxbonusbutton").onclick=new Function("setCropBonusCommit("+cropbonus_data.coins+")");clearTimer("cropbonus_cooldown")}if(blackfriday_action==1){showDiv("cropbonus_blackfriday_in")}else{hideDiv("cropbonus_blackfriday_in")}}function closeCropBonusBox(){hideDiv("cropbonusbox");hideDiv("box_donkeydialogtransp")}function setDonkeyCommit(){var b="<div>"+str_replace("%COINS%",donkey_coins,t_coinsfeatureactivate)+"</div>";var a="farmAction('setdonkey',1,1)";globalcommitbox(t_donkeybox_buyheadline,b,a)}function showDonkey(a){if(a){if($("box_donkey")){$("box_donkey").removeClassName("box_donkey_inactive");$("box_donkey").addClassName("box_donkey")}if($("farm_inner_waltraud")){$("farm_inner_waltraud").removeClassName("farm_inner_waltraud");$("farm_inner_waltraud").addClassName("farm_inner_waltraud_active")}}else{if($("box_donkey")){$("box_donkey").removeClassName("box_donkey");$("box_donkey").addClassName("box_donkey_inactive")}if($("farm_inner_waltraud")){$("farm_inner_waltraud").removeClassName("farm_inner_waltraud_active");$("farm_inner_waltraud").addClassName("farm_inner_waltraud")}}}function dailyDonkeyResult(m){if(m[0]==2){if(m[1].box){initBoxFeatures()}else{showDiv("buybox_donkey");showDiv("box_donkeydialogtransp")}}else{var n=m[2];var l=m[3];var d=m[4];var a=m[5];var c=m[6];var b=m[7];var e=m[8];if(e&&e.msg){globalerrorbox(e.msg)}var h="";h+='<div style="margin:0 0 10px 0;"><img src="'+imgpath+'points.gif" border="0" height="10" width="10"><span>&nbsp;'+m[1]+"&nbsp;"+t_points+"</span></div>";if(b>0){h+='<div><img src="'+imgpath+'adbonus.gif" border="0" height="10" width="10"><span>&nbsp;'+t_donkey_farmiadd+"</span></div>"}else{if(n>0){h+='<div><img src="'+imgpath+'menu/coins.gif" border="0" height="10" width="10"><span>&nbsp;1x '+t_coins+"</span></div>"}else{if(d>0){h+='<div><img src="'+imgpath+"gifts/"+d+'.gif" border="0" height="50" width="50"></div>'}else{if(c>0){h+='<div><img src="'+imgpath+"farmhouse/thumbs/"+c+'.jpg" border="0" height="20" width="20"><span>&nbsp;1x '+quest_reward_6+"</span></div>"}else{if(a>0){h+='<div class="main_float_left kp'+a+'"></div>';h+='<div class="main_float_left">&nbsp;1x&nbsp;'+produkt_name[a]+"</div>";h+='<div style="clear:both;"></div>'}else{if(l){for(pid in l){if(isNumeric(pid)){h+='<div class="main_float_left kp'+pid+'"></div>';h+='<div class="main_float_left">&nbsp;'+l[pid]+"x "+produkt_name[pid]+"</div>";h+='<div style="clear:both;"></div>'}}}}}}}}$("box_donkeydialogcontent").innerHTML=h;showDiv("box_donkeydialogtransp");showDiv("box_donkeydialog")}}function closeDonkeyDialog(){hideDiv("box_donkeydialogtransp");hideDiv("box_donkeydialog")}function closeDonkeyBuy(){hideDiv("buybox_donkey");hideDiv("box_donkeydialogtransp")}var cropactionbuyitems=0;var cropactionrunner=0;var cropactioninfo={};function cropActionAction(c,a){if(c=="cropactioncoins"&&cropactionbuyitems){return false}if(c=="cropactioncoins"){cropactionbuyitems=1}var b="";if(a){b+="&coins="+a}var d=createAjaxRequestObj();d.open("GET","ajax/city.php?rid="+rid+"&mode="+c+b,true);d.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");d.onreadystatechange=function(){initCropActionResponse(d,c)};d.send(null)}function initCropActionResponse(a,m){var t=_chkRequest(a);if(t!=0){cropactionbuyitems=0;if(t[0]==0){globalerrorbox(t[1])}else{cropactioninfo=t[1];var b=t[2];if(m=="cropactioncoins"){hideDiv("globalbox");hideDiv("globaltransp");updateMenu();showFeedback("cropaction_feedback",str_replace("%PRODUCT%",t_cropaction_product[cropactioninfo.action],t_cropaction_buy_feedback))}if(!b.sum){sum=0}else{sum=b.sum}var h="";var q=cropactioninfo.name;if(sum>=cropactioninfo.sum){q=t_cropaction_successhead}h+='<div class="headline" style="font-size:14px;">'+q+"</div>";var c="";c+='<div style="margin-bottom:5px;">'+t_cropaction_txt[cropactioninfo.action]+"</div>";if(!cropactioninfo.close){c+='<div style="margin-bottom:5px; margin-bottom:5px; padding:5px; background-color:#B5A166; border-radius:5px; width:300px; margin:0 auto; margin-bottom:10px;">'+t_cropaction_resttime+'<span id="cropactiontimer" style="font-size:14px; font-weight:bold;">'+formatTime(cropactioninfo.remain)+"</span></div>"}if(sum>=cropactioninfo.sum){c=t_cropaction_successtxt[cropactioninfo.action]}h+='<div style="padding:0px 50px; margin-bottom:10px;">'+c+"</div>";h+='<div class="city_animal_special'+cropactioninfo.reward.animalid+"_"+cropactioninfo.reward.special+'"></div>';var n=((sum*100)/cropactioninfo.sum);if(n>100){n=100}var e=(200/100);if(sum<cropactioninfo.sum&&!cropactioninfo.close){if(setarab==1){var r="right"}else{var r="left"}h+='<div style="margin-bottom:10px; margin-'+r+':140px; width:300px;">'+str_replace("%PRODUCT%",t_cropaction_product[cropactioninfo.action],t_cropaction_dropline)+"</div>";h+='<div style="position:relative; background-color:#B5A166; margin:0 auto; width:130px; border-radius:5px; padding:10px">';for(var d in cropactioninfo.products){h+='<div style="margin-bottom:4px;">';h+='  <div style="float:left; margin-right:5px;" class="kp'+d+'"></div>';h+='  <div style="float:left;">'+produkt_name[d]+"</div>";h+='  <div class="clear"></div>';h+="</div>"}h+="</div>"}if(sum<cropactioninfo.sum){h+='<div class="collect" onmouseover="showDiv(\'cropaction_fill_tt\')" onmouseout="hideDiv(\'cropaction_fill_tt\')">';h+='  <div class="bar">';h+='    <div class="inner" style="height:'+(n*e)+'px"></div>';h+='    <div class="front"></div>';h+='    <div id="cropaction_fill_tt" class="blackbox">'+sum+"/"+cropactioninfo.sum+"</div>";h+="  </div>";h+='  <button id="cropaction_buyitem_button" type="button" class="button_new link">'+str_replace("%PRODUCT%",t_cropaction_product[cropactioninfo.action],t_cropaction_buybutton)+"</button>";h+="</div>"}$("cropactionbox_content").innerHTML=h;var q=str_replace("%PRODUCT%",t_cropaction_product[cropactioninfo.action],t_cropaction_buybutton);var l="";for(var s in cropactioninfo.change){l+="<div class='coinsbutton_flex link' style='margin-bottom:5px; font-size:12px;' onclick=cropActionCoinsDialog("+s+","+cropactioninfo.change[s]+");>"+s+"&nbsp;"+t_coins+" = "+cropactioninfo.change[s]+"&nbsp;"+t_cropaction_product[cropactioninfo.action]+"</div>"}if($("cropaction_buyitem_button")){$("cropaction_buyitem_button").onclick=new Function('globalcommitbox("'+q+'","'+l+'")')}showDiv("transp3");showDiv("cropactionbox");$("cropactionbox").addClassName("action"+cropactioninfo.action);if(parseInt(sum)<parseInt(cropactioninfo.sum)){setTimer("cropaction")}else{clearTimer("cropaction")}}}}function cropActionCoinsDialog(b,d){var c=str_replace("%PRODUCT%",t_cropaction_product[cropactioninfo.action],t_cropaction_buybutton);var a="<div>"+cityadcost+"<img src='"+imgpath+"menu/coins.gif' border=0>&nbsp;"+b+"&nbsp;"+t_coins;var e="cropActionAction('cropactioncoins',"+b+")";globalcommitbox(c,a,e)}function cropActionTimer(){var a=1;if(cropactioninfo.remain){cropactioninfo.remain--;if(cropactioninfo.remain>0&&$("cropactiontimer")){$("cropactiontimer").innerHTML=formatTime(cropactioninfo.remain);a=0}else{a=1}}if(a==1){hideDiv("globalbox");hideDiv("globaltransp");clearTimer("cropaction")}}function closeCropAction(){hideDiv("transp3");hideDiv("cropactionbox");clearTimer("cropaction")}function cropActionCropDialog(d,e,b){var a="";a+="<div style='margin-bottom:10px;'>"+t_cropaction_found+"</div>";a+="<div style='margin-bottom:10px;'>"+b+"x&nbsp;"+t_cropaction_product[d]+"</div>";a+="<div class='cropaction_product"+d+"'></div>";var c="off";globalcommitbox(t_cropaction_found_head,a,c)}var carpentry_entryblock=0;function carpentryBuild(h){var c='<div style="padding:10px; width:620px; height:180px; background:url('+imgpath+'capentry_inner_back.jpg);">';c+='<div style="position:relative; margin:0 auto; margin-top:15px; width:500px; text-align:center;">';c+="  <div>"+t_carpentry_currentlevel+"</div>";c+='  <div style="font-weight:bold; font-size:24px;"><span id="carpentry_currentbonus">'+carpentry_data.currentbonus+"</span>%</div>";c+='  <div id="carpentry_nextbonus_div" style="margin-top:10px;">'+t_carpentry_nextbonus+'<b><span id="carpentry_nextbonus">'+carpentry_data.nextbonus+"</span>%</b></div>";c+='  <div id="carpentry_timebar" style="position:relative; width:250px; margin:0 auto; height:15px; background:#000;">';c+='    <div style="position:absolute; top:15px;">'+t_carpentry_time+'<span id="carpentry_time"></span></div>';c+='    <div id="carpentry_timebar_inner" style="position:absolute; top:-3px; left:0px; width:0px; height:18px; background:url('+imgpath+'guild/innerbar.png);"></div>';c+="  </div>";if(carpentry_data.levelblock>0){c+='<div style="margin-top:20px;">'+str_replace("%LEVEL%",carpentry_data.levelblock,t_carpentry_levelrequired)+"</div>"}if(carpentry_data.config&&!carpentry_data.levelblock){c+='  <div id="carpentry_entries" style="width:250px; position:relative; margin:0 auto">';for(var e in carpentry_data.config.needs){var a=0;var l=0;var b=carpentry_data.config.needs[e];if(carpentry_data.data.have&&carpentry_data.data.have[e]){var d=(150/100);var n=(carpentry_data.data.have[e]*100/carpentry_data.config.needs[e]);a=(n*d);l=carpentry_data.data.have[e];b=(carpentry_data.config.needs[e]-carpentry_data.data.have[e])}var q="";var m="important";if(checkRackItem(e,farm)){if(b==carpentry_data.config.needs[e]||(carpentry_data.data.have&&carpentry_data.data.have[e]&&carpentry_data.data.have[e]<carpentry_data.config.needs[e])){q="carpentryEntry("+h+","+e+","+b+")"}m=""}c+='<div style="margin-bottom:5px;">';c+='  <div style="float:left; margin-right:5px;" class="kp'+e+'"></div>';c+='  <div class="link" style="float:left; margin-right:5px; position:relative; width:150px; height:15px; background:#000;" onclick="'+q+'" onmouseover="showDiv(\'carpentry_bar_tt'+e+"')\" onmouseout=\"hideDiv('carpentry_bar_tt"+e+"')\">";c+='    <div id="carpentry_bar_inner'+e+'" style="position:absolute; top:-3px; left:0px; width:'+a+"px; height:18px; background:url("+imgpath+'guild/innerbar.png);"></div>';c+='    <div id="carpentry_bar_tt'+e+'" class="blackbox" style="display:none; position:absolute; top:-25px; left:0px;">'+produkt_name[e]+"</div>";c+="  </div>";c+='  <div style="float:left;" class="'+m+'">'+l+"</span>/"+carpentry_data.config.needs[e]+"</div>";c+='  <div style="clear:both;"></div>';c+="</div>"}c+="  <div>"+t_carpentry_nextdelay+formatTime(carpentry_data.config.duration)+"</div>";c+="  </div>"}c+="  </div>";c+='  <div style="width:25px; height:25px; position:absolute; top:5px; left:5px; background:url('+imgpath+'kaeserei_info.png);" onmouseover="showDiv(\'carpentry_info\')" onmouseout="hideDiv(\'carpentry_info\')">';c+='    <div id="carpentry_info" class="blackbox" style="display:none; width:350px; margin-left:30px;">'+t_carpentry_info+"</div>";c+="  </div>";c+="</div>";c+='<div class="link big_close" onclick="carpentryClose()"></div>';$("innercontent").innerHTML=c;showDiv("carpentry_entries");hideDiv("carpentry_timebar");$("innermaincontainer").className="inner_back inner_back17";hideDiv("carpentryproductionrunning");if(carpentry_data.data.remain){if(carpentry_data.data.remain>0){hideDiv("carpentry_entries");showDiv("carpentry_timebar");gametimer.carpentrytimer=1}}if(!carpentry_data.nextbonus){hideDiv("carpentry_nextbonus_div")}}function carpentryEntry(a,b,e){var d="";d+='<input type="hidden" id="carpentrybox_entry_pid" value="'+b+'"></div>';d+='<div style="margin:0 0 5px 0;">'+str_replace("%AMOUNT%",e,questbox_entry_rest)+"</div>";d+='<div class="main_float_left kp'+b+'"></div>';d+='<input onkeyup="chkCarpentryEntry('+b+","+e+')" onchange="chkCarpentryEntry('+b+","+e+')" id="carpentrybox_entry" style="margin:0 0 0 5px;" class="main_float_left" type="text" size="10" maxlength="6" value="1">&nbsp;'+t_stk;d+='<div class="clear"></div>';var h="farmAction('carpentryentry',"+farm+","+a+")";var c="hideDiv('globaltransp'); hideDiv('globalbox');";globalcommitbox(forestry_questentry_dialog_head,d,h,c);$("carpentrybox_entry").select()}function chkCarpentryEntry(a,b){var c=parseInt($("carpentrybox_entry").value,10);if(isNaN(c)){return}var d=checkRackItem(a,farm);if(d){if(d<c){c=d}if(parseInt(b)<parseInt(c)){c=b}}$("carpentrybox_entry").value=c}function carpentryClose(){hideDiv("transp");hideDiv("innermaincontainer")}function carpentryTimer(){var d=carpentry_data.data.remain--;if(d>0){var a=(250/100);var c=(100-(d*100/carpentry_data.data.duration));var b=(a*c);if($("carpentry_timebar_inner")){$("carpentry_timebar_inner").style.width=b+"px"}if($("carpentry_time")){$("carpentry_time").innerHTML=formatTime(d)}showDiv("carpentryproductionrunning")}else{showDiv("carpentry_entries");hideDiv("carpentry_timebar");clearTimer("carpentrytimer");if($("carpentry_currentbonus")){$("carpentry_currentbonus").innerHTML=carpentry_data.nextbonus}if($("carpentry_nextbonus")){if(carpentry_data.config){$("carpentry_nextbonus").innerHTML=carpentry_data.config.bonus}else{hideDiv("carpentry_nextbonus")}}showCarpentryBonus(carpentry_data.nextbonus);hideDiv("carpentryproductionrunning")}if(!carpentry_data.nextbonus){hideDiv("carpentry_nextbonus_div")}}function showCarpentryBonus(a){showDiv("carpentrybonus_symbol");if($("carpentry_icon_currentbonus")){$("carpentry_icon_currentbonus").innerHTML=a}carpentry_bonus=a}var architect_config=new Array;var architect_current_item=1;var architect_navi_move=0;var farmhouse_design=0;var architect_page=1;var architect_navi_current_category="";var architect_categories=["new","easter","pentecost","cherryblossom","summer","delivery","battle","oktoberfest","birthday","halloween","xmas","winter","soccer","general"];function setArchitectNavi(a){architect_navi_current_category=a;architect_page=1;initArchitect()}function initArchitect(){var n=[];for(var e in architect_config[0]){if(architect_config[0][e]["new"]){if(architect_navi_current_category==""){architect_navi_current_category="new"}if(!in_array("new",n)){n.push("new")}for(d=0;d<architect_categories.length;d++){if(architect_config[0][e][architect_categories[d]]&&!in_array(architect_categories[d],n)){n.push(architect_categories[d])}}}}for(d=0;d<architect_categories.length;d++){if(architect_categories[d]!="new"&&!in_array(architect_categories[d],n)){n.push(architect_categories[d]);if(architect_navi_current_category==""){architect_navi_current_category=architect_categories[d]}}}var h='<div id="architect">';h+='  <div class="headline">'+t_architect_name+"</div>";h+='  <div class="infobutton" onmouseover="showDiv(\'architect_infobutton_tt\')" onmouseout="hideDiv(\'architect_infobutton_tt\')">';h+='    <div id="architect_infobutton_tt" class="ttbox">'+t_architect_info+"</div>";h+="  </div>";h+='<div class="navi">';for(var e=0;e<n.length;e++){var s="";if(architect_navi_current_category==n[e]){s="active"}var c="img cat_"+n[e];if(n[e]=="new"){c="bonus_star"}h+='<div class="tab '+s+' link" onclick="setArchitectNavi(\''+n[e]+"')\">";h+='  <div class="'+c+'">';if(n[e]=="new"){var t=t_new;h+='<div class="inner">'+t.toUpperCase()+"</div>"}h+="  </div>";h+="</div>"}h+="</div>";var m=[];var l=1;startit:for(var e=250;e>0;e--){if(architect_config[0][e]){if(architect_navi_current_category=="new"&&!architect_config[0][e]["new"]){continue}else{if(architect_navi_current_category=="general"){for(var d=0;d<n.length;d++){if(architect_config[0][e][n[d]]){continue startit}}}else{if(!architect_config[0][e][architect_navi_current_category]){continue}}}architect_config[0][e].id=e;m[l]=architect_config[0][e];l++}}var r=((architect_page-1)*6)+1;var q=(architect_page*6);h+='<div class="list">';for(var e in m){if(e>=r&&e<=q){var b=m[e].id;var u="";if(m[e].bought){u="architect_current_item="+b+"; farmAction('activatearchitect',1,1);"}else{u="detailArchitect("+b+")"}var s="";if(!m[e].buyable&&!m[e].bought){s="off"}h+='<div id="architect_item'+b+'" class="item headquarter_design'+b+"_preview link "+s+'" onclick="'+u+'">';if(architect_config[1]==b){h+='<div class="select"></div>'}if(m[e]["new"]&&m[e].buyable){h+='<div class="new bonus_star"><div class="inner">'+t_new.toUpperCase()+"</div></div>"}if(m[e].bought){h+='<div class="ready"></div>'}if(!m[e].bought&&!m[e].buyable){h+='<div class="block locked_big"></div>'}h+='  <div class="info">';if(architect_navi_current_category=="new"){var a="";if(m[e].halloween){a=t_architect_halloween}if(m[e].xmas){a=t_architect_xmas}if(m[e].soccer){a=t_architect_soccer}if(m[e].easter){a=t_architect_easter_info}if(m[e].specialoffer){a=t_architect_specialoffer_info}if(m[e].summer){a=t_architect_summer}if(m[e].delivery){a=t_architect_delivery}if(m[e].winter){a=t_architect_winter}if(m[e].battle){a=t_architect_battle}if(m[e].oktoberfest){a=t_architect_oktoberfest}if(m[e].cherryblossom){a=t_architect_cherryblossom}h+='<div class="event">'+a+"</div>";if(!m[e].bought){h+='<div id="architect_item'+b+'_timer" class="timer"></div>'}}h+="  </div>";if(m[e].bonus){h+='<div class="bonus '+m[e].bonus.token+'" onmouseover="showDiv(\'architect_list_item'+b+"_tt')\" onmouseout=\"hideDiv('architect_list_item"+b+"_tt')\">";h+='  <div id="architect_list_item'+b+'_tt" class="ttbox">'+specialoffer.getFarmhouseBonusDesc(m[e].id)+"</div>";h+="</div>"}h+="</div>"}}h+='  <div class="clear"></div>';var a="";if(architect_navi_current_category=="halloween"){a=t_architect_halloween}if(architect_navi_current_category=="xmas"){a=t_architect_xmas}if(architect_navi_current_category=="soccer"){a=t_architect_soccer}if(architect_navi_current_category=="easter"){a=t_architect_easter_info}if(architect_navi_current_category=="delivery"){a=t_architect_delivery}if(architect_navi_current_category=="winter"){a=t_architect_winter}if(architect_navi_current_category=="summer"){a=t_architect_summer}if(architect_navi_current_category=="battle"){a=t_architect_battle}if(architect_navi_current_category=="oktoberfest"){a=t_architect_oktoberfest}if(architect_navi_current_category=="cherryblossom"){a=t_architect_cherryblossom}if(a!=""){h+='<div class="bonusinfo_list">';h+="  <div>"+a+"</div>";h+='  <div id="architect_item_'+architect_navi_current_category+'_timer" class="timer"></div>';h+="</div>"}h+="</div>";h+='<div id="architect_navi_up" class="link" onclick="naviArchitect(-1, '+(l-1)+')"></div>';h+='<div id="architect_navi_down" class="link" onclick="naviArchitect(1, '+(l-1)+')"></div>';if(architect_config[3]){architect_farmhousebonus_info=1;farmBuild();setFarmhouse(current_farmhouse);readFarmhouseBonusInfoArchitect()}globalBoxFlex("",h,0,0,1);$("globalbox").style.top="35px";naviArchitect(0,(l-1));setTimer("architect")}function naviArchitect(b,c){var a=Math.ceil(c/6);architect_page+=b;if(architect_page<1){architect_page=1}if(architect_page>=a){architect_page=a}if(b!=0){initArchitect()}showDiv("architect_navi_up");showDiv("architect_navi_down");if(architect_page==1){hideDiv("architect_navi_up")}if(architect_page==a){hideDiv("architect_navi_down")}}function timerArchitect(){for(var a in architect_config[0]){if(architect_config[0][a]&&architect_config[0][a].remain&&architect_config[0][a].remain>0){architect_config[0][a].remain--;if(architect_config[0][a].remain>1){var b=t_architect_resttime+"&nbsp;<b>"+formatTime(architect_config[0][a].remain)+"</b>";if($("architect_item"+a+"_timer")){$("architect_item"+a+"_timer").innerHTML=b}if($("architect_detail"+a+"_timer")){$("architect_detail"+a+"_timer").innerHTML=b}if(architect_config[0][a][architect_navi_current_category]&&$("architect_item_"+architect_navi_current_category+"_timer")){$("architect_item_"+architect_navi_current_category+"_timer").innerHTML=b}}else{architect_config[0][a].buyable=0;initArchitect()}}}}function detailArchitect(m){architect_current_item=m;var l={};for(var d=0;d<architect_config[2].length;d++){if(architect_config[2][d].productid<10){architect_config[2][d].amount-=5}if(architect_config[2][d].amount>0){l[architect_config[2][d].productid]=architect_config[2][d].amount}}var c="";c+='<div id="architect_detail">';c+='  <div class="img headquarter_design'+m+'_preview"></div>';c+='  <div class="products">';var h=0;var b=0;if(architect_config[0][m].products){for(var d in architect_config[0][m].products){if(d<10){b=1}var a="";if(!l[d]||l[d]<architect_config[0][m].products[d]){h=1;a="important"}c+='<div class="f_m_symbol'+d+'" style="float:left; margin-right:5px;"></div>';c+='<div class="'+a+'" style="float:left; margin-bottom:5px;">'+architect_config[0][m].products[d]+"x&nbsp;"+produkt_name_forestry[d]+"</div>";c+='<div class="clear"></div>'}}if(architect_config[0][m].coins){var a="";if(parseInt($("coins").innerHTML)<architect_config[0][m].coins){h=1;a="important"}c+='<img src="'+imgpath+'menu/coins.gif" style="float:left; margin-right:5px; width:15px;">';c+='<div style="float:left;" class="'+a+'">'+architect_config[0][m].coins+"&nbsp;"+t_coins+"</div>";c+='<div class="clear"></div>'}if(architect_config[0][m].bonus){c+='<div class="bonus '+architect_config[0][m].bonus.token+'">';c+='  <div class="img"></div>';c+='  <div class="info">'+specialoffer.getFarmhouseBonusDesc(m)+"</div>";c+='  <div class="clear"></div>';c+="</div>"}if(architect_config[0][m].buyable&&!h){c+='<div id="architect_detail'+m+'_timer" class="timer"></div>';c+='<button class="buy button_new link" onclick="buyCommitArchitect('+m+')">'+market_buy+"</button>"}c+="  </div>";c+='  <div class="clear"></div>';if(architect_config[0][m].specialoffer&&(specialoffer&&specialoffer.data&&specialoffer.data.remain>0)){c+='<div class="bonusinfo">'+t_farmhousedesign_specialoffer+"</div>";c+='<button class="specialoffer button_new link" onclick="specialoffer.init()">'+t_goto_specialoffer+"</button>"}var e="";if(architect_config[0][m].halloween){e=t_architect_halloween}if(architect_config[0][m].xmas){e=t_architect_xmas}if(architect_config[0][m].soccer){e=t_architect_soccer}if(architect_config[0][m].easter){e=t_architect_easter_info}if(architect_config[0][m].specialoffer){e=t_architect_specialoffer_info}if(architect_config[0][m].delivery){e=t_architect_delivery}if(architect_config[0][m].winter){e=t_architect_winter}if(architect_config[0][m].summer){e=t_architect_summer}if(architect_config[0][m].battle){e=t_architect_battle}if(architect_config[0][m].oktoberfest){e=t_architect_oktoberfest}if(architect_config[0][m].cherryblossom){e=t_architect_cherryblossom}c+='<div class="bonusinfo">'+e+"</div>";if(b){c+='<div class="bonusinfo">'+t_forestry_settling_min+"</div>"}c+="</div>";globalBoxFlex(t_architect_name,c,0,"initArchitect()",1)}function readFarmhouseBonusInfoArchitect(){farmAction("readFarmhousebonusinfoarchitect",1,1)}function buyCommitArchitect(a){if(architect_config[0][a].coins){globalcommitbox(t_architect_name,str_replace("%COINS%",architect_config[0][a].coins,t_coinsfeatureactivate),"farmAction('buyarchitect',1,1)")}else{farmAction("buyarchitect",1,1)}}function setFarmhouse(e){for(var c=1;c<=100;c++){if($("hq_upgrade"+c+"_ani")){hideDiv("hq_upgrade"+c+"_ani")}for(var a=1;a<10;a++){if($("hq_upgrade"+c+"_ani"+a)){hideDiv("hq_upgrade"+c+"_ani"+a)}}}$("farm_inner_headquarter").className="link headquarter_design"+e;if($("hq_upgrade"+e+"_ani")){showDiv("hq_upgrade"+e+"_ani")}for(var c=1;c<=10;c++){if($("hq_upgrade"+e+"_ani"+c)){showDiv("hq_upgrade"+e+"_ani"+c)}if($("hq_upgrade"+c)){$("hq_upgrade"+c).className="hq_upgrade"+c+"_"+e}}if((quests_status&&quests_status.main&&quests_status.main[1])||highestquest1>0){if((quests_status.main&&quests_status.main[1]&&quests_status.main[1].questid>4)||highestquest1>4){showDiv("hq_upgrade1")}if((quests_status.main&&quests_status.main[1]&&quests_status.main[1].questid>23)||highestquest1>23){showDiv("hq_upgrade2")}if((quests_status.main&&quests_status.main[1]&&quests_status.main[1].questid>34)||highestquest1>34){showDiv("hq_upgrade3")}}var b={21:[2,3],22:[3],35:[2,3],38:[3]};if(b[e]){for(var c=0;c<b[e].length;c++){hideDiv("hq_upgrade"+b[e][c])}}var d="<div>"+t_building_headquarter+"</div>";if(farmhouse_style_config[e].bonus){d+='<div class="bonus '+farmhouse_style_config[e].bonus.token+'">';d+='  <div class="img"></div>';d+='  <div class="info">'+specialoffer.getFarmhouseBonusDesc(e)+"</div>";d+='  <div class="clear"></div>';d+="</div>"}$("farm_inner_headquarter_tt").addClassName("house"+e).innerHTML=d;farmhouse_design=e;checkFarmhouseAnimation()}function checkFarmhouseAnimation(){}function babaJagaFarmhouse(a){if(a%2==0){$("hq_upgrade44_ani1").removeClassName("static");$("hq_upgrade44_ani1").addClassName("animation")}else{$("hq_upgrade44_ani1").removeClassName("animation");$("hq_upgrade44_ani1").addClassName("static")}a++;setTimeout(function(){babaJagaFarmhouse(a)},4000)}function checkFarmhouseBonus(a){if(farmhouse_style_config[farmhouse_design]&&farmhouse_style_config[farmhouse_design].bonus&&farmhouse_style_config[farmhouse_design].bonus.token==a){return farmhouse_style_config[farmhouse_design].bonus}return 0}function initBoxFeatures(){generalAction("boxinit")}function initBoxFeaturesResponse(a){if(a[1]!=0){hideDiv("box_premium_activate");hideDiv("box_48hbonus_activate");hideDiv("box_ad_activate");hideDiv("box_premium_activatedate");hideDiv("box_48hbonus_activatedate");hideDiv("box_ad_activatedate");hideDiv("box_farmhouse_activate");hideDiv("box_farmhouse_activatedate");hideDiv("box_zieracker_activate");hideDiv("box_zieracker_activatedate");hideDiv("box_present_activate");hideDiv("box_present_activatedate");if(a[1]["premium"]>0){$("box_premium_activatedate").innerHTML=str_replace("[%DATE%]",a[1]["date_premium"],box_activated_date);showDiv("box_premium_activatedate")}else{showDiv("box_premium_activate")}if(a[1]["48hbonus"]>0){$("box_48hbonus_activatedate").innerHTML=str_replace("[%DATE%]",a[1]["date_48hbonus"],box_activated_date);showDiv("box_48hbonus_activatedate")}else{showDiv("box_48hbonus_activate")}if(a[1]["ad"]>0){$("box_ad_activatedate").innerHTML=str_replace("[%DATE%]",a[1]["date_ad"],box_activated_date);showDiv("box_ad_activatedate")}else{showDiv("box_ad_activate")}if(a[1]["farmhouse"]>0){$("box_farmhouse_activatedate").innerHTML=str_replace("[%DATE%]",a[1]["date_farmhouse"],box_activateditem_date);showDiv("box_farmhouse_activatedate")}else{showDiv("box_farmhouse_activate")}if(a[1]["zieracker"]>0){$("box_zieracker_activatedate").innerHTML=str_replace("[%DATE%]",a[1]["date_zieracker"],box_activateditem_date);showDiv("box_zieracker_activatedate")}else{showDiv("box_zieracker_activate")}if(a[1]["gift"]>0){$("box_present_activatedate").innerHTML=str_replace("[%DATE%]",a[1]["date_present"],box_activateditem_date);showDiv("box_present_activatedate")}else{showDiv("box_present_activate")}showDiv("box_containercontent1")}else{$("box_boxerror").innerHTML="";showDiv("box_containercontent2")}$("box_boxerror").innerHTML="";showDiv("box_containertransp");showDiv("box_container")}function sendBoxCode(){var a=$("box_inputcode").value;if(a!=""){var b={code:encodeURIComponent(a)};generalAction("boxsendcode",b)}return false}function activateBoxPremium(){generalAction("boxpremium")}function activateBox48hBonus(){generalAction("box48hbonus")}function activateBoxAd(){generalAction("boxad")}function activateBoxItem(a){if(a>0){var b={type:a};generalAction("boxitem",b)}return false}function closeBoxFeatures(){hideDiv("box_containercontent1");hideDiv("box_containercontent2");hideDiv("box_containertransp");hideDiv("box_container")}function chgDVDBoxImg(b){if(b==1){var a="dvdbox"}if(b==2){var a="dvdbox_ani"}$("box_button").style.backgroundImage="url("+imgpath+a+".gif)"}function globalAlert(a){if(!("transition" in $("globalalert").style)&&!("webkitTransition" in $("globalalert").style)){return false}$("globalalert").innerHTML=a;$("globalalert").addClassName("globalalert");setTimeout(closeGlobalAlert,3000)}function closeGlobalAlert(){$("globalalert").innerHTML="";$("globalalert").removeClassName("globalalert")}function levelupAlert(d,c,b){if(!b){return 1}var a="";a+='<div style="font-size:16px; font-weight:bold;">'+str_replace(":","",guildinfo_level)+" "+d+"</div>";a+="<div>"+c+"</div>";globalAlert(a)}var gametimer=new Object;var gametimer_runtime=0;function setTimer(a){if(!gametimer[a]){gametimer[a]=1}}function clearTimer(a){if(gametimer[a]){delete gametimer[a]}}function runningTimer(){gametimer_runtime++;for(var b in gametimer){if(b=="coinsbox"){coinsBoxTimer()}if(b=="cropbonus"){cropBonusTimer()}if(b=="cropbonus_cooldown"){cropBonusCoolDownTimer()}if(b=="powerups"){powerupTimer()}if(b=="logout"){logoutTimer()}if(b=="clothingdonation_gambletimer"){gambleTimerClothingDonation()}if(b=="carpentrytimer"){carpentryTimer()}if(b=="windmilltimer"){windmillTimer()}if(b=="foodworld"){foodworldTimer()}if(b=="foodworldquest"){foodworldQuestTimer()}if(b=="farm_productions"){farmProductions()}if(b=="farm_water"){farmWater()}if(b=="quests_status"){questsStatusTimer()}if(b=="guild_quest"){countdownGuildQuest()}if(b=="flowerarea"){timerFlowerArea()}if(b=="flowergardener"){timerFlowerGardener()}if(b=="flowerslots"){timerFlowerSlots()}if(b=="nursery"){timerNursery()}if(b=="megafruit"){timerMegaFruit()}if(b=="foodcontest"){timerFoodcontest()}if(b=="mastermind"){mastermindTimer()}if(b=="forestry_inner"){timerForestryInner()}if(b=="megafield"){timerMegafield()}if(b=="vet"){timerVet()}if(b=="map"){mapTimer()}if(b=="fuelstation"){fuelstationTimer()}if(b=="cropaction"&&cropaction){cropaction.timer()}if(b=="job"){jobTimer()}if(b=="guildjob"){guildJobTimer()}if(b=="guildjob_quickview"){guildJobQuickViewTimer()}if(b=="kniffel"&&kniffel){kniffel.timer()}if(b=="animaldealer"){timerAnimalDealer()}if(b=="travelbox"){if((travel_box_timer_start+5)<=gametimer_runtime){mapTravelEnd()}else{$("travel_box_timer").innerHTML=formatTime(5-(gametimer_runtime-travel_box_timer_start))}}if(b=="olympia"){olympia.timer()}if(b=="specialoffer"){specialoffer.timer()}if(b=="specialbonus"){specialbonus.timer()}if(b=="architect"){timerArchitect()}if(b=="pets"){pets.timer()}if(b=="cowracing"){cowracing.timer()}if(b=="collectevent"){collectevent.timer()}if(b=="cinema"){cinema.timer()}if(b=="merchant"){merchant.timer()}if(b=="hillwalk"){hillwalk.timer()}if(b=="giftevent"){giftevent.timer()}if(b=="giftshop"){giftshop.timer()}if(b=="calendar"){calendar.timer()}if(b=="loginevent"){loginevent.timer()}if(b=="loginbonus"){loginbonus.timer()}if(b=="deliveryevent"){deliveryevent.timer()}if(b=="battle"){battle.timer()}if(b=="paymentitemcollection"){paymentitemcollection.timer()}if(b=="butterfly"){butterfly.timer()}if(b=="stall"){stall.timer()}if(b=="tinkergame"){tinkergame.timer()}if(b=="eventcountdown"){eventcountdown.timer()}if(b=="pansetshop"){pansetshop.timer()}if(b=="veggiesplash"){veggiesplash.timer()}if(b=="missingproductions"){missingproductionsTimer()}if(b=="whatsup"){whatsup.timer()}if(b=="rainbowevent"){rainbowevent.timer()}if(b=="easterevent"){easterevent.timer()}if(b=="infinitequestline"){infinitequestline.timer()}if(b=="bonuspack"){bonuspack.timer()}if(b=="fishing"){fishing.timer()}if(b=="weather"){weatherTimer()}if(b=="nutcracker"){nutcracker.timer()}if(b=="coinsevent"){coinsevent.timer()}if(b=="pentecostevent"){pentecostevent.timer()}if(b=="vineyard"){vineyard.timer()}if(b=="xmasgame"){timerXmasGame()}if(b=="youthprotection"){youthprotection.timer()}if(b=="sushibar"){sushibar.timer()}if(b=="scouts"){scouts.timer()}if(b=="insecthotel"){insecthotel.timer()}if(b=="oktoberfest"){oktoberfest.timer()}if(b=="statscacher"){statscacher.timer()}if(b=="eventgarden"){eventgarden.timer()}if(b=="visitor"){visitor.timer()}if(b=="laddergame"){laddergame.timer()}if(b=="lottery"){lottery.timer()}if(b=="tilegame"){tilegame.timer()}if(b=="pepeevent"){pepeevent.timer()}if(b=="premiumdiscount"){premiumdiscount.timer()}if(b=="greenhouse"){greenhouse.timer()}if(b=="seasonpass"){seasonpass.timer()}if(b=="spicehouse"){spicehouse.timer()}if(b=="train"){train.timer()}if(b=="jamexchange"){jamexchange.timer()}if(b=="memory"){timerMemory()}}ponyTimer();if($("newsbox_body_paymentcollection_timer")&&newsbody_paymentcollection_timer){newsbody_paymentcollection_timer--;$("newsbox_body_paymentcollection_timer").innerHTML=formatTime(newsbody_paymentcollection_timer)}if(gametimer_runtime%600==0&&!city){farmAction("updater",farm,0)}if($("farmersmarket_teaser")&&farmersmarket_firstvisit==1&&gametimer_runtime%10==0){showDiv("farmersmarket_teaser_tt");window.setTimeout("hideDiv('farmersmarket_teaser_tt')",3000)}if($("flowers_gardener_hello")&&flowerslots_need_water>0&&gametimer_runtime%10==0){showDiv("flowers_gardener_hello");window.setTimeout("hideDiv('flowers_gardener_hello')",3000)}megafruit_stats_delay--;megafield_stats_delay--;hideDiv("farm_production_checker_icon");if($("farm_production_checker_icon")&&currentuserlevel>=3&&farm_checker.length>0&&premium){var c=0;for(var a=0;a<farm_checker.length;a++){if(!farm_checker[a].pid){continue}c++}if(c>0){showDiv("farm_production_checker_icon")}}}newsbody_paymentcollection_timer=0;function closeNewsboyStart(){hideDiv("transp");hideDiv("newsbox");if($("globalerrorbox").style.display!="block"){hideDiv("globaltransp")}}function setNewsUnread(a){if(currentnews>0&&(news[(currentnews-1)]["nnr"]>0||news[(currentnews-1)].paymentcollection_reminder)){var b=news[(currentnews-1)]["nnr"];var c={nnr:b};generalAction("setnewsunread",c,a)}}function showNews(){if(!$("newsbox")||!news.length){return true}var b="";var c=0;for(var a=0;a<news.length;a++){if(news[a].paymentcollection_remain&&!newsbody_paymentcollection_timer){newsbody_paymentcollection_timer=news[a].paymentcollection_remain}b+='<div class="news" id="news'+(a+1)+'">';b+='	<div class="newsbox_subject">'+news[a]["subject"]+"</div>";b+='	<div class="newsbox_body">'+news[a]["body"]+"</div>";b+="</div>";c++}$("newsbox_inner").innerHTML=b;showDiv("newsbox");showDiv("globaltransp");hideDiv("newsbox_navi_count");if(c>0){$("allnewscount").innerHTML=c;showDiv("newsbox_navi_count")}naviNews()}function naviNews(){var b=parseInt(news.length);if(currentnews>b){currentnews=b}for(var a=1;a<=b;a++){hideDiv("news"+a);hideDiv("newsbox_navi_left");hideDiv("newsbox_navi_right");$("newsbox_navi_left").onclick=new Function("");$("newsbox_navi_right").onclick=new Function("")}showDiv("news"+currentnews);$("currentnewscount").innerHTML=currentnews;if(currentnews!=b){if(currentnews>1){showDiv("newsbox_navi_left");$("newsbox_navi_left").onclick=new Function("backNews()")}if(b>1&&currentnews<b){showDiv("newsbox_navi_right");$("newsbox_navi_right").onclick=new Function("setNewsUnread(2)")}}else{if(b>1){showDiv("newsbox_navi_left");$("newsbox_navi_left").onclick=new Function("backNews()")}}}function backNews(){currentnews--;naviNews()}function nextNews(){currentnews++;naviNews()}function initWeather(){farmAction("weather_init",farm,0)}function showWeather(){if(farms_data.weather){for(var a=1;a<=3;a++){$("weatherlink").removeClassName("weatherlink_back"+a)}$("weatherlink").addClassName("weatherlink_back"+farms_data.weather.today.weather);showDiv("weatherlink")}else{hideDiv("weatherlink")}}function openWeather(){var c=t_weather_link;var b='<div style="position:relative; width:350px;">';b+="<div>"+str_replace("%PERCENT%",farms_data.weather.constants.reduction,t_weather_info)+"</div>";b+='<div class="headline" style="margin-top:10px;">'+t_weather_body1+"</div>";b+='<div class="weather_block">';b+='  <div style="float:left; margin:0px 15px 0px 10px;" class="weather_free'+farms_data.weather.today.weather+'"></div>';b+='  <div style="float:left; margin-top:15px;">';for(var a=0;a<farms_data.weather.today.set.length;a++){b+='<div style="margin-top:5px;">'+htmlProductBody(farms_data.weather.today.set[a])+"</div>"}b+="  </div>";b+='  <div class="clear"></div>';b+="</div>";if(farms_data.weather.tomorrow){b+='<div class="headline" style="margin-top:10px;">'+t_weather_body2+"</div>";b+='<div class="weather_block">';b+='  <div style="float:left; margin:0px 15px 0px 10px;" class="weather_free'+farms_data.weather.tomorrow.weather+'"></div>';b+='  <div style="float:left; margin-top:15px;">';for(var a=0;a<farms_data.weather.tomorrow.set.length;a++){b+='<div style="margin-top:5px;">'+htmlProductBody(farms_data.weather.tomorrow.set[a])+"</div>"}b+="  </div>";b+='  <div class="clear"></div>';b+="</div>"}b+="</div>";globalBoxFlex(c,b,0,0,1);$("globalbox_char").className="globalbox_frog";$("globalbox_charani").className="globalbox_frogani";showDiv("globalbox_char");showDiv("globalbox_charani");showDiv("globalbox_footer");$("globalbox").style.top="50px";if(!farms_data.weather.tomorrow&&farms_data.weather.forecast==1){b='<div class="weather_forecast link" onclick="forecastWeatherCommit()">'+t_weather_forecast+"</div>";$("globalbox_add").innerHTML=b}}function forecastWeatherCommit(){var c=t_weather_forecast_head;var b=str_replace("%AMOUNT%",farms_data.weather.constants.coins,t_weather_forecast_desc);var d="forecastWeather()";var a="openWeather()";globalcommitbox(c,b,d,a);$("globalbox_char").className="globalbox_frog";$("globalbox_charani").className="globalbox_frogani"}function forecastWeather(){farmAction("weather_forecast",farm,0)}function weatherTimer(){farms_data.weather.remain--}function openCoinsBox(){showDiv("globaltransp");showDiv("coins_box");setTimer("coinsbox");$("coins_premium_exchange_amount").value="";$("coins_premium_months").value=0;coinsCheckPremiumMonth();coinsCheckExchange();if(premium){$("coins_premium_months_premiuminfo").innerHTML=str_replace("[*date*]",user_premium_bis,t_coins_use_premium_until);showDiv("coins_premium_months_premiuminfo")}else{hideDiv("coins_premium_months_premiuminfo")}}function coinsCheckPremiumMonth(){var b=$("coins_premium_months").value;if(b>0){var a=(b*premiummonth[b][0])}if(b>0&&a>0){showDiv("coins_premium_months_button")}else{hideDiv("coins_premium_months_button")}}function coinsCheckExchange(){var a=$("coins_premium_exchange_amount").value;if(isNumeric(a)&&a!=""&&a>0){var b=str_replace("%COINS%",a,t_payment_exchange_coins);$("coins_premium_exchange_button").innerHTML=str_replace("%AMOUNT%",formatPrice(coinsexchange*a),b);showDiv("coins_premium_exchange_button")}else{hideDiv("coins_premium_exchange_button")}}function coinsBoxDialog(b,l){hideDiv("coins_box");if(b=="exchange"){var n=$("coins_premium_exchange_amount").value;var e=str_replace("%CURRENCY%",gamecurrency,t_payment_exchange_head);var c=str_replace("%COINS%",n,t_payment_exchange_coins);c=str_replace("%AMOUNT%",formatPrice(coinsexchange*n),c);var m="cityAction('exchangecoins', "+n+")";var h="closeCoinsBox(); openCoinsBox(); hideDiv('globalbox');"}if(b=="premium"){if(l==1&&premiumdiscount&&premiumdiscount.selectBoxValue){var d=premiumdiscount.selectBoxValue;var a=Math.round(d*premiummonth[d]);var a="<s>"+a+'</s>&nbsp;<span style="color:green; font-weight:bold;">'+Math.ceil(a/2)+"</span>"}else{var d=$("coins_premium_months").value;var a=Math.round(d*premiummonth[d])}var e=t_coins_buy_premium_button;var c=t_payment_premium_buy.replace("%MONTH%",d).replace("%COINS%",a);var m="cityAction('buycoinspremium', "+d+")";var h="closeCoinsBox(); openCoinsBox(); hideDiv('globalbox');"}globalcommitbox(e,c,m,h)}function coinsBoxTimer(){paymentitem_remain--;if($("coins_box_paymentitem_available")){hideDiv("coins_box_paymentitem_available");if(paymentitem_remain>0){$("coins_box_paymentitem_available").innerHTML=str_replace("%TIME%",formatTime(paymentitem_remain),t_paymentitem_available);if(paymentitem_remain<=259200){showDiv("coins_box_paymentitem_available")}}}}function closeCoinsBox(){hideDiv("globaltransp");hideDiv("coins_box");$("coins_premium_months").value=0;$("coins_premium_exchange_amount").value=""}function starter(){timerWorker.onmessage=function(a){if(a.data=="ping"){runningTimer()}};gametimer.logout=1;wasserinterval=setInterval(checkWasser,5000);updateInterval=setInterval(updateMenu,900000);farmAction("getfarms",1,0);checkAd();if(currentuserlevel>=40){showDiv("map_stock_overview_link")}else{hideDiv("map_stock_overview_link")}}function logoutTimer(){if(disable_autologout==1||isSteam()==1){hideDiv("logout_timer")}else{showDiv("logout_timer");logout_remain--;if($("logout_timer")){$("logout_timer").innerHTML="("+formatTime(logout_remain)+")"}if(logout_remain<=0){location.href="main.php?page=logout&autologout=1"}}servertimetime++;if($("servertime")){$("servertime").innerHTML=formatDateString(servertimetime)}}function checkPartnerPortal(){for(var a=0;a<partnerportal.length;a++){if(userref==partnerportal[a]){return 1}}return 0}function isPresentAction(){if(setcurrenttime>=presentaktionstart&&setcurrenttime<=presentaktionend){return 1}else{return 0}}function formatDateString(c){var a=new Date();var b=(a.getTimezoneOffset()*60);if(b>0){b-=3600}else{b+=3600}c=(c+b);var e=new Date(c*1000);var r=e.getDate();var l=(e.getMonth()+1);var u=e.getFullYear();var q=String(e.getHours());if(q.length==1){q="0"+q}var n=String(e.getMinutes());if(n.length==1){n="0"+n}var w=String(e.getSeconds());if(w.length==1){w="0"+w}var v=str_replace("d",r,t_datetimeformat);v=str_replace("m",l,v);v=str_replace("y",u,v);v=str_replace("H",q,v);v=str_replace("i",n,v);v=str_replace("s",w,v);v=str_replace("\\","",v);return v}function is_array(a){return typeof(a)=="object"&&(a instanceof Array)}function questsStatusTimer(){if(gametimer.quests_status){for(var c in gametimer.quests_status){for(var b in gametimer.quests_status[c]){if(gametimer.quests_status[c][b]&&$("quests_status_bar_"+c+b)){gametimer.quests_status[c][b].remain--;if(gametimer.quests_status[c][b].remain<=0){hideDiv("quests_status_bar_"+c+b+"_cooldown");delete gametimer.quests_status[c][b];$("quests_status_bar_"+c+b+"_tt_time").innerHTML="";if(c=="main"){$("quests_status_bar_"+c+b).onclick=new Function("questAction('init',0,0,1,"+b+")")}if(c=="forestry"){$("quests_status_bar_"+c+b).onclick=new Function("openForestryQuestBox()")}if(c=="foodworld"){$("quests_status_bar_"+c+b).onclick=new Function("openFoodworldQuestBox()")}}else{showDiv("quests_status_bar_"+c+b+"_cooldown");$("quests_status_bar_"+c+b).onclick=new Function();$("quests_status_bar_"+c+b+"_tt_time").innerHTML=formatTime(gametimer.quests_status[c][b].remain);var d=((gametimer.quests_status[c][b].remain*100)/gametimer.quests_status[c][b].cooldown);var a=((14/100)*d);$("quests_status_bar_"+c+b+"_cooldown_top").style.height=a+"px";$("quests_status_bar_"+c+b+"_cooldown_bottom").style.height=(14-a)+"px"}}}}}}var highestquest1=0;function _chkRequest(request,mode){if(request.readyState==4&&request.status==200){response=request.responseText;if(response=="failed"||response.session_tot==1){session_failed()}else{if(response=="maintenance"){globalerrorbox(t_maintenance,"maintenance")}else{var result=eval("("+response+")");if(response==0){}else{if(result.updateblock){if(result.updateblock.stock){rackHandler(result.updateblock.stock,mode)}if(result.updateblock.menue){result.updateblock.menue.lastaction=mode;menueHandler(result.updateblock.menue)}if(result.updateblock.quests){questInitGo(result.updateblock.quests,"init",0,0,1)}if(result.updateblock.queststatus){questsHandler(result.updateblock.queststatus)}if(result.updateblock.farmis){farmisHandler(result.updateblock.farmis)}if(result.updateblock.farmersmarket){farmersMarketHandler(result.updateblock.farmersmarket)}if(result.updateblock.megafield){megafieldHandler(result.updateblock.megafield)}if(result.updateblock.farms&&result.updateblock.farms.farms){farmsHandler(result.updateblock.farms,mode)}if(result.updateblock.missingproductions){missingproductionsHandler(result.updateblock.missingproductions)}if(result.updateblock.map){farms_data.map=result.updateblock.map;if(farms_data.map.stall){if(stall.currentPosition>0&&stall.data.data&&stall.data.data[stall.currentPosition]){var valOld=stall.data.data[stall.currentPosition].points;var valNew=farms_data.map.stall.data[stall.currentPosition].points;if(valOld<valNew){stall.pointsFlyer(valOld,valNew)}}stall.data=farms_data.map.stall;stall.build();setTimer("stall")}if(insecthotel&&farms_data.map.insecthotel){insecthotel.data=farms_data.map.insecthotel;insecthotel.opener();setTimer("insecthotel")}}if(result.updateblock.weather){weatherHandler(result.updateblock.weather)}if(result.updateblock.guild_job&&guild_job){guild_job=result.updateblock.guild_job}if(result.updateblock.job){jobHandler(result.updateblock.job)}if(result.updateblock.forestry_stock){forestryHandler(result.updateblock.forestry_stock)}if(result.updateblock.actionsheep){actionsheep=result.updateblock.actionsheep;initActionSheep()}if(result.updateblock.merchant){merchant.data=result.updateblock.merchant;setTimer("merchant")}if(result.updateblock.hillwalk){hillwalk.data=result.updateblock.hillwalk;setTimer("hillwalk")}if(result.updateblock.sushibar){sushibar.data=result.updateblock.sushibar;setTimer("sushibar")}if(result.updateblock.seasonpass&&seasonpass){var diff=0;if(seasonpass.data&&seasonpass.data.data){diff=(parseInt(result.updateblock.seasonpass.data.points)-parseInt(seasonpass.data.data.points))}if(diff>0){seasonpass.data=result.updateblock.seasonpass;seasonpass.buildLink();setTimeout(function(){seasonpass.flyer(diff)},1000)}}if(result.updateblock.spicehouse){if($("spicehouse")&&$("spicehouse").style.display=="flex"&&spicehouse&&spicehouse.data&&spicehouse.data.data){if(+result.updateblock.spicehouse.count!=+spicehouse.data.data.count){var diff=(+result.updateblock.spicehouse.data.count-+spicehouse.data.data.count);setTimeout(function(){spicehouse.pointsFlyer(diff)},100)}}spicehouse.data=result.updateblock.spicehouse;setTimer("spicehouse")}if(result.updateblock.train){train.data=result.updateblock.train;setTimer("train")}}if(result.datablock){return result.datablock}else{return result}}}}}return 0}function farmsHandler(a,d){for(var b in a.farms){for(var c in a.farms[b]){if(farms_data.farms&&farms_data.farms[b]&&farms_data.farms[b][c]){delete farms_data.farms[b][c]}if(!farms_data.farms[b]){farms_data.farms[b]={}}farms_data.farms[b][c]=a.farms[b][c]}}if(a.count){farms_data.count=a.count}if(a.blocked){farms_data.blocked=a.blocked}if(a.newarea){farms_data.newarea=a.newarea}if(a.autoplant_loads){farms_data.autoplant_loads=a.autoplant_loads}if(a.megafield_level){farms_data.megafield_level=a.megafield_level}if(a.fuelstation_level){farms_data.fuelstation_level=a.fuelstation_level}if(a.hillwalk_level){farms_data.hillwalk_level=a.hillwalk_level}if(a.sushibar_level){farms_data.sushibar_level=a.sushibar_level}if(a.unlocklevels){farms_data.unlocklevels=a.unlocklevels}if(a.freegardenspeedup){farms_data.freegardenspeedup=a.freegardenspeedup;freegardenspeedup=farms_data.freegardenspeedup}if(a.freegardenspeedup2){farms_data.freegardenspeedup2=a.freegardenspeedup2;freegardenspeedup2=farms_data.freegardenspeedup2}if(a.highestquest1){highestquest1=a.highestquest1}if(a.guildquest){guildquestrun=1}if(d=="getfarms"||d=="initcity"||d=="map_buyfarm"){farmBuild()}else{farmBuildPositions()}if(a.animals){farms_data.animals=a.animals}if(a.config){farms_data.config=a.config}if(a.farmhouse){current_farmhouse=a.farmhouse}if(current_farmhouse){setFarmhouse(current_farmhouse)}if(a.powerups){poweruprack=a.powerups.rack;powerupactive=a.powerups.active;handlePowerups()}if(a.megafield_teaser==1&&$("megafield_teaser")){showDiv("globaltransp");showDiv("megafield_teaser")}else{hideDiv("megafield_teaser")}setTimer("fuelstation");if(farmdeco&&a.farmdeco){farmdeco.init(a.farmdeco)}}function farmersMarketHandler(b){if(b.pets){pets.data=b.pets;if(pets.data.first){pets.teaser()}}if(b.butterfly){butterfly.data=b.butterfly}if(b.cowracing){cowracing.data=b.cowracing;if(b.cowracing.pvp){cowracing.pvpInfo=b.cowracing.pvp}else{b.cowracing.pvp=cowracing.pvpInfo}}if(b.fishing){fishing.data=b.fishing}if(b.scouts){scouts.data=b.scouts}if(b.vineyard){vineyard.data=b.vineyard}if(b.pos){farmersmarket_data=b;if(farmersmarket_data.vet){vet_data=farmersmarket_data.vet}farmersmarket_firstvisit=b.firstvisit;if(farmersmarket_data.gifts){for(var a=0;a<farmersmarket_data.gifts.length;a++){if($("farmersmarket_achievement_check"+farmersmarket_data.gifts[a])){showDiv("farmersmarket_achievement_check"+farmersmarket_data.gifts[a])}}}}}var missingproductionsData={};var missingproductionsRuntime=0;function missingproductionsHandler(a){missingproductionsData=a;setTimer("missingproductions")}function missingproductionsTimer(){missingproductionsRuntime++;var e=[];for(var h in missingproductionsData){e.push(h)}var b={};if(farm_checker){var d=[];for(var c=0;c<farm_checker.length;c++){if(!in_array(farm_checker[c].farm,e)){d.push(farm_checker[c])}}farm_checker=d;for(var h in missingproductionsData){b[h]={};for(var l in missingproductionsData[h]){for(var c=0;c<missingproductionsData[h][l].length;c++){missingproductionsData[h][l][c].remain--;if(missingproductionsData[h][l][c].remain>0||b[h][l]){continue}var a=0;if(missingproductionsData[h][l][c].pid){a=missingproductionsData[h][l][c].pid}if(missingproductionsData[h][l][c].productid){a=missingproductionsData[h][l][c].productid}d={pid:a,farm:h,position:l};if(missingproductionsData[h][l][c].type){d.type=missingproductionsData[h][l][c].type}farm_checker.push(d);b[h][l]=1}}}}}function megafieldHandler(a){megafield_data=a;megafield_tutorial_step=a.tutorial_step;if($("megafield_tile1")){showTutorialMegafield()}setTimer("megafield")}var quests_status={};function questsHandler(b){quests_status=b;gametimer.quests_status={};hideDiv("quests_status_bar_main1");hideDiv("quests_status_bar_main2");hideDiv("quests_status_bar_main3");hideDiv("quests_status_bar_main4");hideDiv("quests_status_bar_main5");if(b.main){for(var a in b.main){if(b.main[a]){showDiv("quests_status_bar_main"+a);if(b.main[a].remain&&b.main[a].remain>0){$("quests_status_bar_main"+a).onclick=new Function();if(!gametimer.quests_status["main"]){gametimer.quests_status["main"]={}}gametimer.quests_status["main"][a]={remain:b.main[a].remain,cooldown:b.main[a].cooldown}}else{$("quests_status_bar_main"+a).onclick=new Function("questAction('init',0,0,1,"+a+")")}}else{hideDiv("quests_status_bar_main"+a)}}}if(b.forestry){for(var a=1;a<=2;a++){if(b.forestry[a]&&premium){showDiv("quests_status_bar_forestry"+a);if(b.forestry[a].remain&&b.forestry[a].remain>0){if(!gametimer.quests_status["forestry"]){gametimer.quests_status["forestry"]={}}gametimer.quests_status["forestry"][a]={remain:b.forestry[a].remain,cooldown:b.forestry[a].cooldown}}else{$("quests_status_bar_forestry"+a).onclick=new Function("openForestryQuestBox()")}}else{hideDiv("quests_status_bar_forestry"+a)}}}else{hideDiv("quests_status_bar_forestry1");hideDiv("quests_status_bar_forestry2")}if(b.foodworld&&b.foodworld[1]&&premium){showDiv("quests_status_bar_foodworld1");if(b.foodworld[1].remain&&b.foodworld[1].remain>0){if(!gametimer.quests_status["foodworld"]){gametimer.quests_status["foodworld"]={}}gametimer.quests_status["foodworld"][1]={remain:b.foodworld[1].remain,cooldown:b.foodworld[1].cooldown}}else{$("quests_status_bar_foodworld1").onclick=new Function("openFoodworldQuestBox()")}}else{hideDiv("quests_status_bar_foodworld1")}if(b.infinite&&infinitequestline){showDiv("quests_status_bar_infinite");infinitequestline.data=b.infinite;setTimer("infinitequestline")}else{hideDiv("quests_status_bar_infinite")}}function farmisHandler(a){farmisinfo=a}function rackHandler(c,b){rackobj=c.stock;racklocks=c.racklock;rackbonis=c.harvestbonus;racktemp=c.tempstock;rackfarm=c.rackfarm;for(var a in rackobj){if((a>0&&a<5)||a==99||a==100){rackCache[1]=rackobj[a];rackCache[2]=rackobj[a];rackCache[3]=rackobj[a];rackCache[4]=rackobj[a];rackCache[99]=rackobj[a];rackCache[100]=rackobj[a]}else{rackCache[a]=rackobj[a]}}if(b=="getfarms"){updateRackGo(1)}else{updateRackGo()}}function menueHandler(a){updatemenue_data=a;updateMenuGo()}function weatherHandler(a){farms_data.weather=a;setTimer("weather");showWeather()}var job_data={};function jobHandler(a){job_data=a;setTimer("job");if(job_data.teaser){window.setTimeout(jobTeaser,1200)}}var rackForestry={};function forestryHandler(a){rackForestry=a}function htmlEntryLine(d){var c="kp"+d.pid;if(produkt_name[d.pid]){var a=produkt_name[d.pid]}if(d.type&&d.type=="forestry"){var a=produkt_name_forestry[d.pid];c="f_m_symbol"+d.pid}if(d.type&&d.type=="coins"){var a=t_coins;c="icon_coins"}var b="";b+='<div style="margin:5px 0px;">'+str_replace("%AMOUNT%",'<span id="dialog_entryline_rest"></span>',t_forestry_questentry_dialog_info)+"</div>";b+='<div class="dialog_input_line">';b+='  <div id="dialog_entryline_img" class="dialog_entryline_img '+c+'" onmouseover="showDiv(\'dialog_entryline_tt\')" onmouseout="hideDiv(\'dialog_entryline_tt\')">';b+='    <div id="dialog_entryline_tt" class="ttbox">'+a+"</div>";b+="  </div>";b+='  <input id="dialog_entryline_number" class="dialog_input" type="number">';b+='  <button id="dialog_entryline_button" class="button_new link">'+t_inner_feedsubmit+"</button>";b+='  <div class="clear"></div>';b+="</div>";b+="<div>"+t_inner_stock+'&nbsp;<span id="dialog_entryline_stockamount"></span></div>';if(d.type=="forestry"&&d.pid<21){b+='<div class="bonusinfo">'+t_forestry_settling_min+"</div>"}return b}function checkEntryLine(b){$("dialog_entryline_stockamount").innerHTML=formatNumber(b.stockamount);$("dialog_entryline_rest").innerHTML=formatNumber(b.rest);$("dialog_entryline_button").onclick=new Function(b.click);var a=$("dialog_entryline_number").value;a=parseInt(a);if(a>b.stockamount){a=b.stockamount}if(a>b.rest){a=b.rest}if(isNaN(a)){a=""}$("dialog_entryline_number").value=a}function htmlLevelBar(b,c,e){var h=["pets","vet","megafruit","fuelstation","guild_job","hillwalk","butterfly","stall","fishing","vineyard","sushibar","scouts","spicehouse","train"];if(in_array(b,h)){var d="";if(c>0){d="_"+c}var a="";a+='<div id="'+b+d+'_levelbar" class="main_levelbar" onmouseover="showDiv(\''+b+d+"_levelbar_tt')\" onmouseout=\"hideDiv('"+b+d+"_levelbar_tt')\">";a+='  <div id="'+b+d+'_levelbar_tt" class="main_levelbar_tt ttbox"></div>';a+='  <div id="'+b+d+'_levelbar_number" class="main_levelbar_number"></div>';a+='  <div class="main_levelbar_bar">';a+='    <div id="'+b+d+'_levelbar_inner" class="main_levelbar_inner"></div>';a+="  </div>";a+='  <div class="main_levelbar_front"></div>';if(!e){a+='<div id="'+b+d+'_levelbar_plus" class="main_levelbar_plus plus link" onmouseover="showDiv(\''+b+d+"_levelbar_plus_tt')\" onmouseout=\"hideDiv('"+b+d+"_levelbar_plus_tt')\">";a+='  <div id="'+b+d+'_levelbar_plus_tt" class="main_levelbar_plus_tt ttbox"></div>';a+="</div>"}a+="</div>";return a}}function htmlCountBar(b){var c=["pets","vet","megafruit","fuelstation","vehicleshop","guild_job","hillwalk","butterfly","fishing","vineyard","sushibar","scouts","spicehouse","train"];if(in_array(b,c)){var a="";a+='<div id="'+b+'_countbar" class="main_countbar">';a+='  <div id="'+b+'_countbar_inner" class="main_countbar_inner"></div>';a+='  <div id="'+b+'_countbar_plus" class="main_levelbar_plus plus link" onmouseover="showDiv(\''+b+"_countbar_plus_tt')\" onmouseout=\"hideDiv('"+b+"_countbar_plus_tt')\">";a+='    <div id="'+b+'_countbar_plus_tt" class="main_countbar_plus_tt ttbox"></div>';a+="  </div>";a+="</div>";return a}}function htmlLevelAddDialog(d,a,l){var h={};if(guild_job&&guild_job.job&&guild_job.job.next_level_points){h.guild_job={intro:t_guildjob_dialog_leveladd_body,info:t_guildjob_dialog_leveladd_info,item:"guild_job_leveladd_item",left:(guild_job.job.next_level_points-guild_job.job.points),click:"guildAction('job_leveladd')"}}if(vet_data&&vet_data.info&&vet_data.info.next_level_points){h.vet={intro:t_vet_dialog_leveladd_body,info:t_vet_dialog_leveladd_info,item:"vet_leveladd_item",left:(vet_data.info.next_level_points-vet_data.info.points),click:"farmAction('vet_leveladd', 1, 1)"}}if(pets.data&&pets.data.data&&pets.data.data.level_rest){h.pets={intro:t_pets_dialog_leveladd_body,info:t_pets_dialog_leveladd_info,item:"pets_leveladd_item",left:pets.data.data.level_rest,click:"pets.addLevel()"}}if(farmersmarket_data.megafruit&&farmersmarket_data.megafruit.pointsleft){h.megafruit={intro:t_megafruit_level_body,info:t_megafruit_level_line,item:"megafruit_seed",left:farmersmarket_data.megafruit.pointsleft,click:"farmAction('megafruit_level', 1, 1)"}}h.megafield={intro:t_megafield_level_plus_body,info:t_megafield_level_plus_body2,item:"megafield_license_icon megafield_license_icon_leveladd",left:megafield_data.level_rest,click:"farmAction('megafield_level', 1, 1)"};if(a&&l){h.fuelstation={intro:t_fuelstation_level_plus_body,info:t_fuelstation_level_plus_body2,item:"biofuelcoin fuelstation_icon_leveladd",left:farms_data.farms[farm][a].data.data.slots[l].points_left,click:"farmAction('fuelstation_level', "+farm+", "+a+", "+l+")"}}if(hillwalk&&hillwalk.data&&hillwalk.data.data&&hillwalk.data.data.level_rest){h.hillwalk={intro:t_hillwalk_dialog_leveladd_body,info:t_hillwalk_dialog_leveladd_info,item:"hillwalk_symbol_hillpoints",left:hillwalk.data.data.level_rest,click:"hillwalk.addLevel()"}}if(butterfly&&butterfly.data&&butterfly.data.data&&butterfly.data.data.level_rest){h.butterfly={intro:t_butterfly_dialog_leveladd_body,info:t_butterfly_dialog_leveladd_info,item:"butterfly_leveladd_item",left:butterfly.data.data.level_rest,click:"butterfly.addLevel()"}}if(fishing&&fishing.data&&fishing.data.data&&fishing.data.data.level_rest){h.fishing={intro:t_fishing_dialog_leveladd_body,info:t_fishing_dialog_leveladd_info,item:"fishing_leveladd_item",left:fishing.data.data.level_rest,click:"fishing.addLevel()"}}if(vineyard&&vineyard.data&&vineyard.data.data&&vineyard.data.data.level_rest){h.vineyard={intro:t_vineyard_dialog_leveladd_body,info:t_vineyard_dialog_leveladd_info,item:"vineyard_leveladd_item",left:vineyard.data.data.level_rest,click:"vineyard.addLevel()"}}if(sushibar&&sushibar.data&&sushibar.data.data&&sushibar.data.data.level_rest){h.sushibar={intro:t_sushibar_dialog_leveladd_body,info:t_sushibar_dialog_leveladd_info,item:"sushibar_leveladd_item",left:sushibar.data.data.level_rest,click:"sushibar.addLevel()"}}if(scouts&&scouts.data&&scouts.data.data&&scouts.data.data.level_rest){h.scouts={intro:t_scouts_dialog_leveladd_body.replace("%NAME%",t_scouts_points),info:t_scouts_dialog_leveladd_info.replace("%NAME%",t_scouts_points),item:"scouts_leveladd_item",left:scouts.data.data.level_rest,click:"scouts.addLevel()"}}if(spicehouse&&spicehouse.data&&spicehouse.data.data&&spicehouse.data.data.level_rest){h.spicehouse={intro:t_spicehouse_dialog_leveladd_body.replace("%NAME%",t_spicehouse_points),info:t_spicehouse_dialog_leveladd_info.replace("%NAME%",t_spicehouse_points),item:"spicehouse_leveladd_item",left:spicehouse.data.data.level_rest,click:"spicehouse.addLevel()"}}if(train&&train.data&&train.data.data&&train.data.data.level_rest){h.train={intro:t_train_dialog_leveladd_body.replace("%NAME%",t_train_points),info:t_train_dialog_leveladd_info.replace("%NAME%",t_train_points),item:"train_leveladd_item",left:train.data.data.level_rest,click:"train.addLevel()"}}if(h[d]){var e=str_replace("%AMOUNT%",formatNumber(h[d].left),h[d].info);e=str_replace("%COUNT%",formatNumber(h[d].left),e);var b=d+"CheckLevelAdd("+a+", "+l+")";if(in_array(d,["pets","hillwalk","butterfly","fishing","vineyard","sushibar","scouts","spicehouse","train"])){b=d+".addLevelCheck()"}var c='<div style="width:350px;">';c+=h[d].intro;c+='  <div class="dialog_leveladd">';c+='    <div class="'+h[d].item+' dialog_leveladd_item"></div>';c+='    <input id="'+d+'_dialog_leveladd_insert" class="dialog_leveladd_insert" type="text" maxlength="6" onchange="'+b+'" onkeyup="'+b+'">';c+='    <button type="button" class="button_new link dialog_leveladd_button" onclick="'+h[d].click+'">'+t_megafruit_level_button+"</button>";c+='    <div class="clear"></div>';c+="  </div>";c+='  <div id="'+d+'_dialog_leveladd_info" class="dialog_leveladd_info">'+e+"</div>";c+="</div>";return c}}function htmlStatsContent(e,m,a){var l="";var b=-1;var d=1;for(var h=0;h<e.length;h++){var r="&nbsp;";if(e[h].count!=b){var r=d+"."}var q="";if(e[h].banner){q="onmouseover=\"showDiv('dialog_stats_line_banner"+h+"')\" onmouseout=\"hideDiv('dialog_stats_line_banner"+h+"')\""}var n="";if(e[h].self==1){n="important"}l+='<div class="dialog_stats_line" '+q+">";l+='  <div class="dialog_stats_field1">'+r+"</div>";l+='  <div class="dialog_stats_field2 '+n+'">'+e[h].name+"</div>";l+='  <div class="dialog_stats_field3">';if(e[h].col1){for(var c=1;c<=3;c++){if(e[h]["col"+c]){l+='<div class="col">'+e[h]["col"+c]+"</div>"}}l+='<div class="clear"></div>'}else{if(e[h].count){if(m&&m.indexOf("fish")!=-1){l+=fishing.showFishSize(e[h].count)}else{if(m&&m.indexOf("nutcracker")!=-1){l+=formatNumber(e[h].count)}else{if(m&&m!="sold2"&&m.indexOf("sold")!=-1){l+=formatPrice(e[h].count)}else{if(a=="sushibar"&&in_array(m,["earned","highest"])){l+=formatPrice(e[h].count)}else{if(m&&m.indexOf("vineyard_type")!=-1){l+=e[h].count+"%"}else{l+=e[h].count}}}}}}}l+="  </div>";l+='  <div class="clear"></div>';if(e[h].banner){var n="";if(h>6){n="bottom"}l+='<div id="dialog_stats_line_banner'+h+'" class="banner '+n+'">';l+=cowracing.showBanner(e[h].banner);l+="</div>"}l+="</div>";if(b!=e[h].count){d++}b=e[h].count}l+="  </div>";return l}function htmlProductBody(a,c){var b="";b+='<div class="kp'+a+' product_body_image"></div>';if(c>0){b+='<div class="product_body_amount">'+formatNumber(c)+"x</div>"}b+='<div class="product_body_name">'+produkt_name[a]+"</div>";b+='<div class="clear"></div>';return b}function htmlProductSymbol(c,h,e,b,a){var d="";d+='<div id="'+h+c+'" class="'+e+c+" "+b+'" onmouseover="showDiv(\'product_symbol_tt'+c+"')\" onmouseout=\"hideDiv('product_symbol_tt"+c+"')\">";d+='  <div id="product_symbol_tt'+c+'" class="ttbox '+a+'">'+produkt_name[c]+"</div>";d+="</div>";return d}function htmlProductionSlot(c,a,d){var b="";b+='<div id="production_slot'+c+"_"+a+"_"+d+'" class="link production_slot">';b+='  <div class="production_slot_plank">';b+='    <div id="production_slot_img_oil_inner'+c+"_"+a+"_"+d+'" class="production_slot_img_oil_inner"></div>';b+='    <div id="production_slot_img_oil'+c+"_"+a+"_"+d+'" class="production_slot_img_oil"></div>';b+='    <div id="production_slot_img'+c+"_"+a+"_"+d+'" class="production_slot_img"></div>';b+='    <div id="production_slot_block'+c+"_"+a+"_"+d+'" class="production_slot_block"></div>';b+="  </div>";b+='  <div id="production_slot_info'+c+"_"+a+"_"+d+'" class="production_slot_info"></div>';b+='  <div id="production_slot_info2'+c+"_"+a+"_"+d+'" class="production_slot_info2"></div>';b+='  <div id="production_slot_timer'+c+"_"+a+"_"+d+'" class="production_slot_timer"></div>';b+='  <div id="production_slot_cancel'+c+"_"+a+"_"+d+'" class="link production_slot_cancel"></div>';b+='  <div id="production_slot_speedup'+c+"_"+a+"_"+d+'" class="link production_slot_speedup"></div>';b+='  <div id="production_slot_guild'+c+"_"+a+"_"+d+'" class="link production_slot_guild guildjob_orderpoints"></div>';b+="</div>";return b}function updateProductionSlot(d,e){for(var l=1;l<=3;l++){var h={farm:d,position:e,slot:l};if(farms_data.farms[d][e]){if(farms_data.farms[d][e].buildingid){h.buildingid=farms_data.farms[d][e].buildingid}var c=0;if(farms_data.farms[d][e].production){for(var a=0;a<farms_data.farms[d][e].production.length;a++){var b=farms_data.farms[d][e].production[a];if(l==b.slot){c=1;h.pid=b.pid;h.img_class="production_slot_img"+b.pid;h.guild=b.guild;if(b.time){h.duration=b.time}if(b.remain){h.remain=b.remain}if(b.remain<=0){h.harvest=1;h.click="farmAction('harvestproduction', "+d+", "+e+", "+l+")"}else{h.cancel=1;if(!in_array(farms_data.farms[d][e].buildingid,[7,8,9,10,25])){if(in_array(h.buildingid,[13,14,16,21])){h.speedup="factory.speedupCommit("+e+", "+l+")"}}else{if(const_speedup_addon==1){h.speedup="globalSpeedupBox('speedup_addon', "+e+", "+l+")"}}}break}}}if(!c){if(in_array(h.buildingid,[7,8,9,10,25])){h.click="factory.selection("+l+")"}if(in_array(h.buildingid,[13,14,16,21])){h.click="factory.selection("+l+")"}}if(locationinfo.slots&&locationinfo.slots[l]&&parseInt(locationinfo.farm)==parseInt(d)&&parseInt(locationinfo.position)==parseInt(e)){if(locationinfo.slots[l].cost&&locationinfo.slots[l].cost[2]){if(locationinfo.slots[l].slotremain){locationinfo.slots[l].slotremain--;h.slotremain=locationinfo.slots[l].slotremain}else{locationinfo.slots[l].block=1}}if(locationinfo.slots[l].block==1){h.block=1;if(locationinfo.slots[l].cost){if(locationinfo.slots[l].cost[1]){h.buy={money:locationinfo.slots[l].cost[1]}}if(locationinfo.slots[l].cost[2]){h.rent={coins:locationinfo.slots[l].cost[2][0],duration:locationinfo.slots[l].cost[2][1]}}if(in_array(h.buildingid,[7,8,9,10,25])){h.click="factory.buyCommit("+l+")"}if(in_array(h.buildingid,[13,14,16,21])){h.click="factory.buyCommit("+l+")"}}}}}fillProductionSlot(h)}}function fillProductionSlot(c){var r=c.farm+"_"+c.position+"_"+c.slot;if($("production_slot"+r)){hideDiv("production_slot_img_oil_inner"+r);hideDiv("production_slot_img_oil"+r);hideDiv("production_slot_block"+r);hideDiv("production_slot_timer"+r);hideDiv("production_slot_cancel"+r);hideDiv("production_slot_speedup"+r);if(c.img_class){$("production_slot_img"+r).addClassName(c.img_class);if(c.pid&&produkt_category[c.pid]=="tea"){$("production_slot_img"+r).addClassName("expand")}}else{$("production_slot_img"+r).className="production_slot_img"}if(c.block){showDiv("production_slot_block"+r)}if(c.click){$("production_slot"+r).onclick=new Function(c.click)}else{$("production_slot"+r).onclick=new Function()}if(c.renttime){showDiv("production_slot_timer"+r)}if(c.cancel&&!c.block){showDiv("production_slot_cancel"+r);$("production_slot_cancel"+r).onclick=new Function("cancelProduction("+c.position+", "+c.slot+")")}var h="";if(c.pid){if(in_array(c.buildingid,[13,14])){var q=100;if(c.remain>0&&c.duration){q=(100-((c.remain*100)/c.duration))}showDiv("production_slot_img_oil_inner"+r);$("production_slot_img_oil_inner"+r).style.height=q+"px";showDiv("production_slot_img_oil"+r);$("production_slot_img"+r).addClassName("production_slot_img_oil_fix oil"+c.pid)}var e=produkt_ernte[c.pid];var a=getRackItemInfo(c.pid);var l=0;if(a.cropbonus){l+=a.cropbonus}else{if(rackbonis[c.pid]){l+=rackbonis[c.pid].cropbonus}}if(specialbonus){var m=specialbonus.findBonus({key1:"production",key2:"harvest"});if(m&&in_array(c.buildingid,m.buildings)){l+=m.harvest}}var n="";if(l>0){n='&nbsp;<span class="rack_cropbonus">+'+l+"</span>"}h+='<div style="font-weight:bold;">'+produkt_name[c.pid]+"</div>";h+="<div>"+croptext+e+n+"</div>";var b="&nbsp;";if(c.remain>0){var b=formatTime(c.remain);if(c.speedup&&!c.block){showDiv("production_slot_speedup"+r);$("production_slot_speedup"+r).onclick=new Function(c.speedup)}}else{if(c.remain<=0){var b=statusProductionComplete}}if(c.guild&&parseInt(c.guild)==1){showDiv("production_slot_guild"+r)}else{hideDiv("production_slot_guild"+r)}h+='<div id="production_slot_info_time'+r+'">'+b+"</div>"}$("production_slot_info"+r).innerHTML=h;var h="";if(c.harvest){h=click4products}if(c.block){if(c.buy){h=t_buy_slot.replace("%MONEY%",c.buy.money+"&nbsp;"+gamecurrency)}if(c.rent){h=t_rent_slot.replace("%COINS%",c.rent.coins+"&nbsp;"+t_coins);h=h.replace("%TIME%",formatTime(c.rent.duration));if(specialbonus){var d={7:"mayo",8:"cheese",9:"wool",10:"bonbon",13:"oilpress",14:"oilspecial",16:"woolspecial",21:"teaspecial"};var m=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(m&&in_array(d[c.buildingid],m.types)){h+='<div id="production_productionslot'+r+'_bonus_star" class="production_slot bonus_star pulse">';h+='  <div class="inner">';h+='    <div class="percent">'+(m.discount*100)+"%</div>";h+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";h+="  </div>";h+="</div>"}}}}else{if(!c.pid){h=advancedproduction_headline}}if(c.slotremain){showDiv("production_slot_timer"+r);if(c.slotremain>0){$("production_slot_timer"+r).innerHTML=formatTime(c.slotremain)}}$("production_slot_info2"+r).innerHTML=h}}function htmlProductionSlotOption(e,d,a,m,b,r,q){var t="createAdvancedProductionCommit("+e+", "+a+", "+r+", "+q+")";var n="";if(r){}else{var h=checkRackItem(a,farm);if(h<m){n="important";t=""}}var l='<div style="font-weight:bold; margin-bottom:2px;">'+produkt_name[d]+"</div>";l+='<div style="margin-bottom:2px;">'+t_rack_need_products+"</div>";l+='<div class="'+n+'">';l+="  <div>"+htmlProductBody(a,m)+"</div>";l+="  <div>"+formatTime(b)+"</div>";l+="</div>";var s="";if(r){l+='<div class="bonusinfo">'+t_guildjob_stock_info+"</div>";s="_guildjob"}var c="";c+='<div class="market_pframe link" style="position:relative; float:left; margin:0 10px 10px 10px;" onclick="'+t+'" onmouseover="showDiv(\'production_option'+d+"_tt"+s+"')\" onmouseout=\"hideDiv('production_option"+d+"_tt"+s+"')\">";c+='  <div class="tt'+d+'" style="position:absolute; top:7px; left:8px;" onclick="'+t+'"></div>';c+='  <div id="production_option'+d+"_tt"+s+'" class="ttbox" style="top:65px; left:0px; width:150px; text-align:left;">'+l+"</div>";if(r){c+='<div class="guildjob_orderpoints" style="position:absolute; right:-5px;"></div>'}c+="</div>";return c}function htmlProductSlotSelection(e,u,A,b,z,d,l,w){var s="";var r="";if(b){r="_guild"}var a='<div style="font-weight:bold; margin-bottom:5px;">'+produkt_name[A[2][0]]+"</div>";if(A.block){if(Array.isArray(A[0])){var q=str_replace("%QUEST%",A[0][1],t_needs_quest);a+='<div class="important">'+str_replace("%CAMPAIGN%",A[0][0],q)+"</div>"}else{if(A[5]>0){a+='<div class="important">'+str_replace("%LEVEL%",A[5],minlevel_feature)+"</div>"}}}else{var c=1;var v=0;if(l>0){v=((A[2][1]*l)-A[2][1])}if(w>0){v+=w}a+="<div>"+productionduration+formatTime(A[4])+"</div>";a+="<div>"+croptext+A[2][1];if(v>0){a+='<span class="rack_cropbonus">&nbsp;+'+v+"</span>"}a+="</div>";a+='<div style="margin:5px 0px;">'+t_rack_need_products+"</div>";for(var t=0;t<A[1].length;t++){var h="";if(b){if(!job_data.guild_job_data.stock[A[1][t][0]]||job_data.guild_job_data.stock[A[1][t][0]]<A[1][t][1]){c=0;h="important"}}else{if(checkRackItem(A[1][t][0],farm)<A[1][t][1]){c=0;h="important"}}a+='<div class="'+h+'">'+htmlProductBody(A[1][t][0],A[1][t][1])+"</div>"}if(b){a+='<div class="bonusinfo">'+t_guildjob_stock_info+"</div>"}if(c==1){if(b){s="factory.start('start',"+z+","+u+","+d+", 1)"}else{s="factory.start('start',"+z+","+u+","+d+")"}}}var n="";if(!c){n="filter:grayscale(1); opacity:0.5"}var m="";m+='<div id="select'+e+u+r+'" class="market_pframe link" style="position:relative; float:left;" onclick="'+s+'" onmouseover="showDiv(\'select'+e+"_tt"+u+r+"')\" onmouseout=\"hideDiv('select"+e+"_tt"+u+r+"')\">";m+='  <div class="tt'+A[2][0]+'" style="top:5px; left:7px; '+n+'"></div>';m+='  <div id="select'+e+"_tt"+u+r+'" class="ttbox" style="top:65px; left:-5px; width:160px;">'+a+"</div>";if(b){m+='<div class="guildjob_orderpoints" style="position:absolute; right:-5px; top:0px;"></div>'}m+="</div>";return m}function htmlQuestBox(m){var a={};if(pets&&pets.data.quest){a.pets={head:t_pets_quest_head,intro:t_pets_quest_body,data:pets.data.quest}}if(butterfly&&butterfly.data.quest){a.butterfly={head:t_pets_quest_head,intro:t_butterfly_quest_body,data:butterfly.data.quest}}if(cowracing&&cowracing.data.quest){a.cowracing={head:t_pets_quest_head,intro:t_cowracing_quest_body,data:cowracing.data.quest}}if(fishing&&fishing.data.quest){a.fishing={head:t_pets_quest_head,intro:t_fishing_quest_body,data:fishing.data.quest}}if(vineyard&&vineyard.data.quest){a.vineyard={head:t_pets_quest_head,intro:t_vineyard_quest_body,data:vineyard.data.quest}}if(scouts&&scouts.data.quest){a.scouts={head:t_pets_quest_head,intro:t_scouts_quest_body,data:scouts.data.quest}}if(!a[m]){return 1}var n=a[m].head.replace("%QUEST%",a[m].data.questid);var e='<div id="farmersmarket_quest">';e+='  <div class="intro">'+a[m].intro+"</div>";e+='  <div id="'+m+'_quest_data">';e+='    <div class="need">';for(var d in a[m].data.products){var h=0;if(a[m].data.data&&a[m].data.data[d]){h=a[m].data.data[d]}var l=((h*100)/a[m].data.products[d]);var u="";var r="important";if(checkRackItem(d)>0){var u=m+".questEntryCommit("+d+")";var r=""}if(h>=a[m].data.products[d]){u=""}e+='<div class="item">';e+='  <div class="kp'+d+'"></div>';e+='  <div class="bar link" onclick="'+u+'" onmouseover="showDiv(\'farmersmarket_quest_need_item'+d+"')\" onmouseout=\"hideDiv('farmersmarket_quest_need_item"+d+"')\">";e+='    <div class="inner" style="width:'+l+'%"></div>';e+='    <div id="farmersmarket_quest_need_item'+d+'" class="ttbox">'+produkt_name[d]+"</div>";e+="  </div>";e+='  <div class="amount '+r+'">'+formatNumber(h)+"/"+formatNumber(a[m].data.products[d])+"</div>";e+="  <br>";e+="</div>"}if(a[m].data.vineyard){for(var b=0;b<a[m].data.vineyard.length;b++){var d=a[m].data.vineyard[b].type;var s=a[m].data.vineyard[b].quality;var c=a[m].data.vineyard[b].amount;var h=0;if(a[m].data.data&&a[m].data.data.vineyard&&a[m].data.data.vineyard[d]){h=a[m].data.data.vineyard[d]}var l=((h*100)/c);var u="";var r="important";if(vineyard.getStockAmount(d,s)>0){var u="vineyard.questEntryStockCommit("+d+", "+s+")";var r=""}var t={type:d,quality:s};if(h>=c){u=""}e+='<div class="item vine">';e+=vineyard.buildBottle("questinfo",t);e+='  <div class="bar link" onclick="'+u+'" onmouseover="showDiv(\'farmersmarket_quest_need_vineyard_item'+d+"')\" onmouseout=\"hideDiv('farmersmarket_quest_need_vineyard_item"+d+"')\">";e+='    <div class="inner" style="width:'+l+'%"></div>';e+='    <div id="farmersmarket_quest_need_vineyard_item'+d+'" class="ttbox">'+t_vineyard_quest_require_pid.replace("%NAME%","<b>"+vineyard.data.config.plants[d].name+"</b>").replace("%QUALITY%",s)+"</div>";e+="  </div>";e+='  <div class="amount '+r+'">'+formatNumber(h)+"/"+formatNumber(c)+"</div>";e+="  <br>";e+="</div>"}}e+="    </div>";e+="    <div>"+t_megafield_reward_basic+"</div>";e+='    <div class="reward">';for(var b in a[m].data.reward){var c="";if(b=="points"){var r="megafield_points_icon";c=formatNumber(a[m].data.reward[b])+"&nbsp;"+t_points}if(b=="package"){var r="package pets_package"+a[m].data.reward[b];c="1x"}if(b=="deco"&&m=="butterfly"){var r="deco"+a[m].data.reward[b];c=t_butterfly_unlock_deco.replace("%NAME%","<b>"+butterfly.data.config.deco[a[m].data.reward[b]].name+"</b>")}if(b=="slot"&&m=="butterfly"){var r="";c=a[m].data.reward[b]+".&nbsp;"+t_butterfly_slot}if(b=="slot"&&m=="cowracing"){var r="";c=t_cowracing_slot.replace("%SLOT%",a[m].data.reward[b])}if(b=="product"&&m=="cowracing"){var r="";c=t_unlock_product.replace("%PRODUCT%",produkt_name[a[m].data.reward[b]])}if(m=="fishing"&&in_array(b,["bonus_fishingtime","bonus_productiontime","bonus_fishingpoints","fishingslots","unlock_item"])){var r="";var q=a[m].data.reward[b];c=fishing_quest_reward_name[b].replace("%PERCENT%",Math.round(q*100)).replace("%SLOT%",q);if(fishing.data.config.items[q]){c=c.replace("%NAME%",fishing.data.config.items[q].name)}}if(m=="vineyard"&&in_array(b,["plantslot","barrelslot"])){var r="";var q=a[m].data.reward[b];c=t_vineyard_quest_reward_name[b].replace("%SLOT%",q)}if(m=="scouts"&&in_array(b,["bonus_productiontime","scoutsslots","unlock_item"])){var r="";var q=a[m].data.reward[b];if(b=="scoutsslots"&&q<=2){continue}c=scouts_quest_reward_name[b].replace("%PERCENT%",Math.round(q*100)).replace("%SLOT%",q);if(scouts.data.config.items[q]){c=c.replace("%NAME%",scouts.data.config.items[q].name)}}if(c!=""){e+='<div class="img '+r+'"></div>';e+='<div class="amount">'+c+"</div>";e+="<br>"}}e+="    </div>";e+="  </div>";e+='  <div id="'+m+'_quest_timer" class="timer"></div>';e+="</div>";if(a[m].data.end){n=str_replace("%QUEST%.","",a[m].data.head);e=t_pets_out_of_quests}globalcommitbox(n,e,0,0,1)}function htmlProductDropdown(n,m,d,c){var a={};a.stall={products:stall.data.products,fillproduct:stall.fillProduct,setproduct:"stall.fillSlotCommitSetProduct"};if(insecthotel&&insecthotel.data&&insecthotel.data.data){a.insecthotel={products:insecthotel.data.data.products,fillproduct:insecthotel.fillProduct,setproduct:"insecthotel.setStockSlotCommitSetProduct"};a.insecthotel2={products:insecthotel.data.data.bonusproducts,fillproduct:insecthotel.fillBonusproduct,setproduct:"insecthotel.setBonusproductSelect"}}var h="";if(!a[n]){return h}var l=a[n].fillproduct;if(l<=0){for(var e=0;e<a[n].products.length;e++){l=a[n].products[e];break}}var r="htmlProductDropdownList('"+n+"')";if(c){r=""}h+='<div class="productdropdown">';h+='  <div class="header link" onclick="'+r+'">';h+='    <div class="product link">';h+='      <div class="img kp'+l+'"></div>';h+='      <div class="name">'+produkt_name[l]+"</div>";if(in_array(l,d)){h+='<div class="marker"></div>'}h+='      <div class="clear"></div>';h+="    </div>";h+='    <div class="selector link nodrop'+c+'" id="'+n+'ProductDropdownListSelector"></div>';h+='    <div class="clear"></div>';h+="  </div>";if(!c){h+='<div id="'+n+'ProductDropdownList" class="list">';var b=getRackItems();for(var e=0;e<a[n].products.length;e++){var l=a[n].products[e];if(m&&in_array(l,m)){continue}var q="grayscale";if(b[l]&&b[l]>0){q=""}h+='  <div class="line link" onclick="'+a[n].setproduct+"("+l+')">';h+='  	<div class="img kp'+l+" "+q+'"></div>';h+='  	<div class="name '+q+'">'+produkt_name[l]+"</div>";if(in_array(l,d)){h+='<div class="marker"></div>'}h+='  	<div class="clear"></div>';h+="  </div>"}h+="</div>"}h+="</div>";return h}function htmlProductDropdownList(a){if($(a+"ProductDropdownList").style.display=="block"){hideDiv(a+"ProductDropdownList");$(a+"ProductDropdownListSelector").style.backgroundImage="url("+imgpath+"market/sel_open.gif)"}else{showDiv(a+"ProductDropdownList");$(a+"ProductDropdownListSelector").style.backgroundImage="url("+imgpath+"market/sel_close.gif)"}}function showGlobalWait(c){var a=["getfarms","insert","marketbuyoffer","marketcreateoffer","animaldealerbuy","buyformula","windmillbuyslot","startproduction","buyslot","megafield_gamblejob","megafield_buylicense","nursery_startproduction","nursery_buyslot","megafruit_buy","foodcontest_rent_block","foodcontest_buy_block","vet_buyleveladd","vet_buyproductionslot","vet_speedupproduction","vet_startproduction","vet_endtreatment","shopfire","animaldealerbuy","map_buyfarm","map_sendvehicle","fuelstation_entry","fuelstation_harvest","fuelstation_speedup","fuelstation_level","reallocatebuilding","initcity","initforestry","foodworld_init","contracts_send","contracts_savetemplate","contracts_deltemplate","contracts_cancel","contracts_accept","contracts_deny","contracts_send","job_leveladd","stock_slot_entry","job_entry","kniffel_roll","kniffel_end","kniffel_buy","autoplant_buy_load","pets_start_production","busad_watched","hillwalk_start_tour","hillwalk_finish_tour"];if(!in_array(c,a)){return false}var b=getRandom(0,(t_waiting_text.length-1));$("superglobal_wait_text").innerHTML=t_waiting_text[b]+"&nbsp;...";showDiv("superglobal_transp");showDiv("superglobal_wait");showDiv("superglobal_wait_text")}function hideGlobalWait(){hideDiv("superglobal_transp");hideDiv("superglobal_wait");hideDiv("superglobal_wait_text")}function getRackItems(d){var b={};if(!d){d=1}for(var e in rackCache[d]){for(var c in rackCache[d][e]){b[rackCache[d][e][c].pid]=parseInt(rackCache[d][e][c].amount)}}return b}function checkRackItem(a,c){if(!c){c=1}for(var d in rackCache[c]){for(var b in rackCache[c][d]){if(rackCache[c][d][b].pid==a){return parseInt(rackCache[c][d][b].amount)}}}return 0}function setRackItem(a,b,c){if(!c){c=1}if(!rackElement[a]){rackElement[a]={}}if(b>0){rackElement[a].number=b}return rackElement[a]}function getRackItemInfo(b){for(var d in rackCache){for(var c in rackCache[d]){for(var a in rackCache[d][c]){if(rackCache[d][c][a].pid==b){return rackCache[d][c][a]}}}}return 0}function checkForestryRackItem(a){var c=0;if(rackForestry&&rackForestry[a]){c=rackForestry[a]}if(!c){for(var b=1;b<5;b++){if(forestry_stock[b]&&forestry_stock[b][a]){c=forestry_stock[b][a]["amount"]}}}return c}function showPage(e,c){if(e=="coins"){show_page(e,c);return false}var b=["messages_transp","messages_main","profil_main_transp","profil_main","contracts_transp","contracts_main","globaltransp","newhelp","newhelp_menue"];for(var d=0;d<b.length;d++){hideDiv(b[d])}if(e=="messages"){messagesAction("open")}if(e=="profil"){profilAction("init")}if(e=="contracts"){generalAction("contracts_init",{},c);if(farm>4){mapGo2Location("farm",1,1)}}if(e=="help"){helpAction()}}var building_inner_data={};function setBuildingInnerInfo(d,a,c){hideDiv("building_inner_jobbox");hideDiv("building_inner_jobbox_garden");hideDiv("building_inner_jobbox_special");var e=farms_data.farms[d][a].buildingid;if(!in_array(e,[1,13,14,16])&&!farms_data.config.advancedbuilding[e]&&!farms_data.config.building2product[e]){return 0}building_inner_data={farm:d,position:a,buildingid:e,data:c};if(checkIsValidJob()){var b=htmlJobProductionInfo(d,a);if(e==1){showDiv("building_inner_jobbox_garden");$("building_inner_jobbox_garden").innerHTML=b}else{if(farms_data.config.building2product[e]){showDiv("building_inner_jobbox");$("building_inner_jobbox").innerHTML=b}else{if(farms_data.config.advancedbuilding[e]||in_array(e,[13,14,16])){showDiv("building_inner_jobbox_special");$("building_inner_jobbox_special").innerHTML=b}}}jobProductionInfoResetFlyer(d,a)}}function htmlJobProductionInfo(e,a){var m=farms_data.farms[e][a].buildingid;var l="";var h="";var b="right";if(farms_data.config.building2product[m]){l="margin-top:-50px; margin-left:50px; width:150px;";h="float:left; margin-top:-5px; margin-left:5px;";b="top"}var d=getJobLevel(job_data.currentjob);var c="";c+='<div style="position:absolute; top:0px; left:0px;" >';c+='  <div class="job_jobsymbol'+job_data.currentjob+'_mini job_jobsymbol_mini link" onclick="showJobOverview()" onmouseover="showDiv(\'job_productioninfo_tt'+e+"_"+a+"')\" onmouseout=\"hideDiv('job_productioninfo_tt"+e+"_"+a+"')\">";c+='    <div id="job_productioninfo_tt'+e+"_"+a+'" class="ttbox job_item_tt_'+b+'">';c+='      <div style="font-weight:bold">'+job_data.config.jobs[job_data.currentjob].name+"</div>";c+="      <div>"+htmlJobLevelBoni(job_data.currentjob,d.level)+"</div>";c+="    </div>";c+="  </div>";c+='  <div id="job_productioninfo_flyer'+e+"_"+a+'" class="job_productioninfo_flyer_basic job_productioninfo_flyer"></div>';c+='  <div style="'+l+'">';if(job_data.boost&&job_data.boost.remain>0){c+='<div style="'+h+'">'+htmlJobItem("boost",job_data.boost.pid,b)+"</div>"}if(job_data.tool&&job_data.tool.remain>0){c+='<div style="'+h+'">'+htmlJobItem("tool",job_data.tool.pid,b)+"</div>"}c+="  </div>";c+='  <div class="clear"></div>';c+="</div>";return c}function jobProductionInfoFlyer(l,a,h){if($("job_productioninfo_flyer"+l+"_"+a)){var e="";for(var d=0;d<h.length;d++){if(h[d].pid){var c=h[d].amount;var b="kp"+h[d].pid;var m=""}else{if(h[d].job_points){var c=h[d].job_points;var b="guildjob_jobpoints";var m="margin-top:-10px;"}}e+='<div style="margin-bottom:4px; width:120px;">';e+='  <div style="float:left; color:#fff;">'+c+"x&nbsp;</div>";e+='  <div style="float:left; '+m+'" class="'+b+'"></div>';e+='  <div class="clear"></div>';e+="</div>"}$("job_productioninfo_flyer"+l+"_"+a).innerHTML=e;setTimeout(function(){$("job_productioninfo_flyer"+l+"_"+a).addClassName("job_productioninfo_flyer_go")},1000);setTimeout(function(){jobProductionInfoResetFlyer(l,a)},3000)}}function jobProductionInfoResetFlyer(b,a){if($("job_productioninfo_flyer"+b+"_"+a)){$("job_productioninfo_flyer"+b+"_"+a).removeClassName("job_productioninfo_flyer_go").addClassName("job_productioninfo_flyer");$("job_productioninfo_flyer"+b+"_"+a).innerHTML=""}}function checkIsValidJob(){if(job_data&&job_data.currentjob>0){if(building_inner_data.buildingid==1){var c=["v","hr"];if(farm==5){c.push("ex")}if(farm==6){c.push("alpin")}if(farm==8){c.push("water")}if(farm==10){c.push("spice")}for(var b=0;b<job_data.config.jobs[job_data.currentjob].product_category.length;b++){if(in_array(job_data.config.jobs[job_data.currentjob].product_category[b],c)){return 1}}}else{if(in_array(building_inner_data.buildingid,[13,14])){if(job_data.config.jobs[job_data.currentjob].product_category=="o"){return 1}}else{if(building_inner_data.buildingid==16){for(var b in building_inner_data.data[1]["products"]){var a=building_inner_data.data[1]["products"][b][2][0];if(in_array(a,job_data.config.jobs[job_data.currentjob].products)&&job_data.config.jobs[job_data.currentjob].product_category=="e"){return 1}}}else{if(farms_data.config.advancedbuilding[building_inner_data.buildingid]){var d=[];if(farms_data.config.advancedbuilding[building_inner_data.buildingid][0] instanceof Array){for(var b=0;b<farms_data.config.advancedbuilding[building_inner_data.buildingid].length;b++){d.push(farms_data.config.advancedbuilding[building_inner_data.buildingid][b][2])}}else{d.push(farms_data.config.advancedbuilding[building_inner_data.buildingid][2])}for(var b=0;b<d.length;b++){if(in_array(d[b],job_data.config.jobs[job_data.currentjob].products)&&job_data.config.jobs[job_data.currentjob].product_category=="e"){return 1}}}else{if(farms_data.config.building2product[building_inner_data.buildingid]){if(in_array(building_inner_data.data.pid,job_data.config.jobs[job_data.currentjob].products)&&job_data.config.jobs[job_data.currentjob].product_category=="e"){return 1}}}}}}}return 0}function checkIsValidGuildJobProduct(){if(checkIsValidJob()){if(!job_data||!job_data.guild_job_data||!job_data.guild_job_data.data){return 0}if(building_inner_data.buildingid==1){var c=["v","hr"];if(farm==5){c.push("ex")}if(farm==6){c.push("alpin")}if(farm==8){c.push("water")}if(farm==10){c.push("spice")}for(var a in job_data.guild_job_data.data.products){if(in_array(produkt_category[a],c)){return 1}}}else{var d=[];if(in_array(building_inner_data.buildingid,[13,14])){for(var b in building_inner_data.data[1].oil){d.push(building_inner_data.data[1].oil[b][2][0])}}else{if(building_inner_data.buildingid==16){for(var b in building_inner_data.data[1]["products"]){d.push(building_inner_data.data[1]["products"][b][2][0])}}else{if(farms_data.config.advancedbuilding[building_inner_data.buildingid]){if(farms_data.config.advancedbuilding[building_inner_data.buildingid][0] instanceof Array){for(var b=0;b<farms_data.config.advancedbuilding[building_inner_data.buildingid].length;b++){d.push(farms_data.config.advancedbuilding[building_inner_data.buildingid][b][2])}}else{d.push(farms_data.config.advancedbuilding[building_inner_data.buildingid][2])}}else{if(farms_data.config.building2product[building_inner_data.buildingid]){d.push(building_inner_data.data.pid)}}}}for(var a in job_data.guild_job_data.data.products){if(in_array(a,d)){return 1}}}}return 0}function isSteam(){if(user_partner=="steam"&&user_partnerid>0){return 1}else{return 0}}function ajaxAction(a,c,e,l){var d="?rid="+rid;if(e){for(i in e){if(e[i]){d+="&"+i+"="+encodeURIComponent(e[i])}}}var b="action";if(a=="farm"){b="mode"}d+="&"+b+"="+c;showGlobalWait(c);var h=createAjaxRequestObj();if(in_array(c,["savefriendinfo","savenotepad","friends_save","farmdeco_save","train_save_grid"])){if(a=="farm"){d=d.substring(1)}h.open("POST","ajax/"+a+".php",true);h.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");h.setRequestHeader("Content-type","application/x-www-form-urlencoded");h.onreadystatechange=function(){ajaxActionResponse(h,c,e,l)};h.send(d)}else{h.open("GET","ajax/"+a+".php"+d,true);h.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");h.onreadystatechange=function(){ajaxActionResponse(h,c,e,l)};h.send(null)}}function ajaxActionResponse(b,c,d,e){var a=_chkRequest(b);if(a!=0){hideGlobalWait();if(a[0]==0){globalerrorbox(a[1])}else{if(!in_array(c,["cowracing_saveteam","cowracing_getteamchat","fishing_settutorial","sushibar_checktrain","scouts_settutorial","insecthotel_silent","buildingoverview_settoken"])){hideDiv("globaltransp");hideDiv("globalbox")}e(a,c,d)}}}function juleWasHere(){var a='<div id="julewashere">';a+='  <div id="julewashere_back" class="back"></div>';a+='  <div id="julewashere_char" class="char">';a+='    <div class="bubble">War schn hier :)</div>';a+="  </div>";a+="</div>";if(!$("julewashere")){$("farmhousecontainer").insert(a)}setTimeout(function(){if($("julewashere")){$("julewashere_char").addClassName("move")}},200);setInterval(function(){if($("julewashere")){var d="0123456789ABCDEF";var b="#";for(var c=0;c<6;c++){b+=d[Math.floor(Math.random()*16)]}$("julewashere_back").style.backgroundColor=b}},100);setTimeout(function(){if($("julewashere")){$("julewashere").remove()}},5000)}function checkTabFocus(){if(document.visibilityState==="visible"){if(checkTabFocusTimer>tabupdatertime){farmAction("updater2",farm,0);checkTabFocusTimer=0}}else{checkTabFocusTimer=0}}var giftevent=function(){this.data={};this.bunny_click=0;this.bunny_status=0;this.bunny_interval=30};giftevent.prototype.init=function(a){giftevent.action("giftevent_init")};giftevent.prototype.action=function(a,b){ajaxAction("farm",a,b,giftevent.response)};giftevent.prototype.response=function(b,a,c){giftevent.data=b;if(giftevent.data["new"]){giftevent.log(1)}else{giftevent.open()}};giftevent.prototype.open=function(){var d='<div id="giftevent">';d+='  <div class="back"></div>';d+='  <div class="intro"></div>';d+='  <div class="help helpbutton_blue link" onclick="giftevent.help()"></div>';d+='  <div class="log link" onclick="giftevent.log()">'+t_giftevent_log+"</div>";d+='  <div class="send link" onclick="giftshop.eventGift()">'+giftshopsubmit+"</div>";d+='  <div class="bar">';d+='    <div class="front">';var e=0;if(this.data.data.points){e=this.data.data.points}d+='      <div class="amount">'+formatNumber(e)+"/"+formatNumber(this.data.config.max_fillage)+"</div>";d+='      <div class="inner">';d+='        <div id="giftevent_bar_inner"></div>';for(var c in this.data.config.stages){var b="uneven";if(c%2==0){b="even"}var a=Math.min(((this.data.config.stages[c].points*100)/this.data.config.max_fillage),100);d+='<div class="stage '+b+'" style="bottom:'+a+'%">';d+='  <div class="prize '+b+'">';if(this.data.config.stages[c].item){d+='<div class="item '+b+'" onmouseover="showDiv(\'giftevent_stage'+c+"_item')\" onmouseout=\"hideDiv('giftevent_stage"+c+"_item')\">";d+='  <img src="'+imgpath+'Sheep_DirtyDancing_ALL.gif">';d+='  <div id="giftevent_stage'+c+'_item" class="ttbox">'+t_quest_item_info_type+"</div>";d+="</div>"}if(this.data.config.stages[c].farmhouse){d+='<div class="farmhouse '+b+'" onmouseover="showDiv(\'giftevent_stage'+c+"_farmhouse')\" onmouseout=\"hideDiv('giftevent_stage"+c+"_farmhouse')\">";d+='  <img src="'+imgpath+"farmhouse/previews/"+this.data.config.stages[c].farmhouse+'_1.jpg">';d+='  <div id="giftevent_stage'+c+'_farmhouse" class="ttbox">'+quest_reward_6+"</div>";d+="</div>"}if(this.data.config.stages[c].powerup){d+='<div class="powerup '+b+'" onmouseover="showDiv(\'giftevent_stage'+c+"_powerup')\" onmouseout=\"hideDiv('giftevent_stage"+c+"_powerup')\">";d+='  <div id="giftevent_stage'+c+'_powerup" class="ttbox"><b>'+t_pointsboost_unit+"</b><br>"+str_replace("%PERCENT%",this.data.config.stages[c].percent,t_pointsboost)+"</div>";d+="</div>"}d+='    <div class="clear"></div>';d+="  </div>";d+='  <div class="need '+b+'">';d+="    <div>"+formatNumber(this.data.config.stages[c].points)+"</div>";if(this.data.data.stages&&this.data.data.stages[c]){d+='<div class="ready"></div>'}d+="  </div>";d+="</div>"}d+="      </div>";d+="    </div>";d+="  </div>";d+='  <div id="bunny_box" class="bunny_box"></div>';d+='  <div class="grass"></div>';d+='  <div class="timer">'+t_event_resttime+':&nbsp;<span id="giftevent_timer"></span></div>';d+="</div>";globalBoxFlex(t_giftevent_link,d,0,0,1);$("globalbox").style.top="40px";$("globalbox_headline").style.paddingTop="0px";var h=Math.min(((e*100)/this.data.config.max_fillage),100);$("giftevent_bar_inner").style.height=h+"%"};giftevent.prototype.help=function(){var d='<div id="giftevent_help">';d+='  <div class="line">'+t_giftevent_help1+"</div>";d+='  <div class="line">'+t_giftevent_help2+"</div>";d+='  <div class="line" style="margin-bottom:30px;">';for(var c in this.data.config.gifts){var a=c;if(presents_hack[c]){a=presents_hack[c]}d+='<div class="float gift">';d+='  <img src="'+imgpath+"gifts/"+a+'.gif">';d+='  <div class="points">'+this.data.config.gifts[c].points+"</div>";d+="</div>"}d+='    <div class="clear"></div>';d+="  </div>";d+='  <div class="line">'+t_giftevent_help3+"</div>";d+='  <div class="line">'+t_giftevent_help4+"</div>";d+='  <div class="line border">'+t_giftevent_help5+"</div>";d+="</div>";var b="giftevent.open()";globalBoxFlex(t_giftevent_link,d,0,b,1)};giftevent.prototype.log=function(e,m){var l=this.data.data.log;var h=t_giftevent_log_intro;if(e){l=this.data["new"];h=t_giftevent_lastupdates}if(m){l=this.data.data.send;h=t_giftevent_log_send_intro}var d="";if(!e&&this.data.data.send){d+='<div id="giftevent_navi">';var a="";if(!e&&!m){a="active"}d+='  <div class="link item '+a+'" onclick="giftevent.log()"><div class="in"></div></div>';a="";if(m){a="active"}d+='  <div class="link item '+a+'" onclick="giftevent.log(0, 1)"><div class="out"></div></div>';d+='  <div class="clear"></div>';d+="</div>"}d+='<div id="giftevent_lastupdates">';d+='  <div class="intro">'+h+"</div>";d+='  <div class="list">';if(l){for(var c=l.length;c>0;c--){d+=this.logLine(l[(c-1)])}}d+="  </div>";d+="</div>";var b="giftevent.open()";globalcommitbox(t_giftevent_log,d,0,b,1)};giftevent.prototype.logLine=function(d){var c='<div class="line">';var a=d.id;if(presents_hack[d.id]){a=presents_hack[d.id]}c+='  <img class="float" src="'+imgpath+"gifts/"+a+'.gif">';var b=t_giftevent_anonym;if(d.name!=""){b=d.name}c+='  <div class="float name">'+b+"</div>";c+='  <div class="float date">'+d.date+"</div>";c+='  <div class="float points">'+this.data.config.gifts[d.id].points+"</div>";c+='  <div class="clear"></div>';c+="</div>";return c};giftevent.prototype.timer=function(){this.data.data.remain--;if(this.data.data.remain<=0){hideDiv("giftevent_link")}else{showDiv("giftevent_link");if(this.data.data["new"]&&this.data.data["new"].length>0){showDiv("giftevent_link_alert")}else{hideDiv("giftevent_link_alert")}if($("giftevent_timer")){$("giftevent_timer").innerHTML=formatTime(this.data.data.remain)}}if(this.data.data.remain%this.bunny_interval==0&&$("bunny_box")){this.bunny()}};giftevent.prototype.bunny=function(){if(this.bunny_status>0){var b="";if(this.bunny_status==1){for(var a=1;a<=2;a++){b+='<div id="valentine_bunny'+a+'" class="valentine_bunny valentine_bunny_ani start" onclick="giftevent.bunnyClick()"></div>'}$("bunny_box").innerHTML=b;setTimeout(function(){if($("valentine_bunny1")){$("valentine_bunny1").removeClassName("start").addClassName("end")}},500);setTimeout(function(){if($("valentine_bunny2")){$("valentine_bunny2").style.animationDelay="0.2s";$("valentine_bunny2").removeClassName("start").addClassName("end")}},777);setTimeout(function(){giftevent.bunny_status=2},2000)}if(this.bunny_status==2){for(var a=1;a<=12;a++){var c="rewind";if(a<=10){c="child"}b+='<div id="valentine_bunny'+a+'" class="valentine_bunny valentine_bunny_ani end '+c+'" onclick="giftevent.bunnyClick()"></div>'}$("bunny_box").innerHTML=b;setTimeout(function(){if($("valentine_bunny1")){$("valentine_bunny1").removeClassName("end").addClassName("start")}},500);setTimeout(function(){if($("valentine_bunny2")){$("valentine_bunny2").style.animationDelay="0.2s";$("valentine_bunny2").removeClassName("end").addClassName("start")}},700);setTimeout(function(){if($("valentine_bunny3")){$("valentine_bunny3").style.animationDelay="0.4s";$("valentine_bunny3").removeClassName("end").addClassName("start")}},900);setTimeout(function(){if($("valentine_bunny4")){$("valentine_bunny4").style.animationDelay="0.6s";$("valentine_bunny4").removeClassName("end").addClassName("start")}},1100);setTimeout(function(){if($("valentine_bunny5")){$("valentine_bunny5").style.animationDelay="0.5s";$("valentine_bunny5").removeClassName("end").addClassName("start")}},1300);setTimeout(function(){if($("valentine_bunny6")){$("valentine_bunny6").style.animationDelay="0.2s";$("valentine_bunny6").removeClassName("end").addClassName("start")}},1500);setTimeout(function(){if($("valentine_bunny7")){$("valentine_bunny7").style.animationDelay="0.7s";$("valentine_bunny7").removeClassName("end").addClassName("start")}},1700);setTimeout(function(){if($("valentine_bunny8")){$("valentine_bunny8").style.animationDelay="0.9s";$("valentine_bunny8").removeClassName("end").addClassName("start")}},1900);setTimeout(function(){if($("valentine_bunny9")){$("valentine_bunny9").style.animationDelay="0.3s";$("valentine_bunny9").removeClassName("end").addClassName("start")}},2100);setTimeout(function(){if($("valentine_bunny10")){$("valentine_bunny10").style.animationDelay="0.4s";$("valentine_bunny10").removeClassName("end").addClassName("start")}},2300);setTimeout(function(){if($("valentine_bunny11")){$("valentine_bunny11").style.animationDelay="1s";$("valentine_bunny11").removeClassName("end").addClassName("start")}},1500);setTimeout(function(){if($("valentine_bunny12")){$("valentine_bunny12").style.animationDelay="0.4s";$("valentine_bunny12").removeClassName("end").addClassName("start")}},2000);setTimeout(function(){giftevent.bunny_status=0;giftevent.bunny_click=0;giftevent.bunny_interval=30},3000)}}else{var b='<div id="valentine_bunny1" class="valentine_bunny valentine_bunny_ani start" onclick="giftevent.bunnyClick()"></div>';$("bunny_box").innerHTML=b;setTimeout(function(){$("valentine_bunny1").removeClassName("start").addClassName("end")},500)}};giftevent.prototype.bunnyClick=function(){this.bunny_click++;if(this.bunny_click>=2){this.bunny_status=1;this.bunny_interval=5}};var giftshop=function(){this.data={};this.category="default";this.currentList="";this.is_anonym=0;this.friendId=0;this.fromEvent=0};giftshop.prototype.send=function(c){if($("giftshop_detail_name").value==""){$("giftshop_detail_name").focus();return false}var a=servernumber;var b="";if($("giftshop_detail_msg")){b=$("giftshop_detail_msg").value}if($("giftshop_detail_server")){a=$("giftshop_detail_server").value}giftshop.action("giftshop_send",{giftid:c,name:$("giftshop_detail_name").value,msg:b,anonym:this.is_anonym,server:a})};giftshop.prototype.init=function(b,a){giftshop.action("giftshop_init",{friend:b,event:a})};giftshop.prototype.action=function(a,b){ajaxAction("city",a,b,giftshop.response)};giftshop.prototype.response=function(b,a,c){giftshop.data=b;if(c.event&&giftshop.data.event){giftshop.fromEvent=1}else{giftshop.fromEvent=0}giftshop.open();if(c.friend){giftshop.navi("friends")}if(c.event&&giftshop.data.event){giftshop.navi(giftshop.data.event.category)}if(a=="giftshop_send"){giftshop.feedback()}setTimer("giftshop")};giftshop.prototype.timer=function(){for(var a in this.data.remains){if(this.data.remains[a]>0){this.data.remains[a]--;if(!this.data.remains[a]){if($("giftshop_box_menue_"+a)){hideDiv("giftshop_box_menue_"+a)}if(this.category==a){giftshop.navi("default")}}else{if($("giftshop_"+a+"_remain")){$("giftshop_"+a+"_remain").innerHTML=str_replace("%TIME%",formatTime(this.data.remains[a]),t_giftshop_remain)}}}}};giftshop.prototype.open=function(){hideDiv("transp3");var a={};for(var d in this.data.gifts){if(this.data.gifts[d].event){a[this.data.gifts[d].event]=1}if(this.data.gifts[d][14]){a.friends=1}else{a["default"]=1}}var c='<div id="giftshop_box">';c+='  <div class="intro">'+giftshopintro+"</div>";c+='  <div class="menue">';for(var d in a){c+='<div id="giftshop_box_menue_'+d+'" class="item link '+d+'" onclick="giftshop.navi(\''+d+"')\">";c+='  <div class="img symbol symbol_'+d+'"></div>';c+="</div>"}c+='    <div class="clear"></div>';c+="  </div>";c+='  <div id="giftshop_box_gifts" class="gifts"></div>';c+='  <div id="giftshop_box_feedback" class="feedback" style="display:none;">'+giftshopsuccess+"</div>";c+="</div>";var b=0;if(this.fromEvent==1&&giftevent){b="giftevent.init()"}globalBoxFlex(t_giftshop_name,c,0,b,1);$("globalbox").style.top="35px";this.navi()};giftshop.prototype.navi=function(a){if(a){this.category=a}this.showGifts();$$("#giftshop_box .menue .item").each(function(b){$(b.id).removeClassName("active")});$("giftshop_box_menue_"+this.category).addClassName("active");if(this.category=="friends"){this.is_anonym=0}};giftshop.prototype.showGifts=function(){var b="";for(var a in this.data.gifts){var c=0;if(this.category=="friends"){if(this.data.gifts[a][14]){c=1}}else{if(this.category=="default"){if(!this.data.gifts[a].event&&!this.data.gifts[a][14]){c=1}}else{if(this.data.gifts[a].event&&this.category==this.data.gifts[a].event){c=1}}}if(c==1){b+=this.showGift(a)}}if(this.category=="friends"){b+='<div class="info">'+t_giftshop_category_friends+"</div>"}if(this.data.event&&this.category==this.data.event.category){b+='<div class="info">'+t_giftshop_giftevent_info+"</div>"}if(!in_array(this.category,["default","friends"])){b+='<div id="giftshop_'+this.category+'_remain" class="remain"></div>'}b+='<div class="legend">';b+='  <div class="col1"></div>';b+='  <div class="col2">= '+t_merchant_item_blocked+"</div>";b+="</div>";$("giftshop_box_gifts").innerHTML=b};giftshop.prototype.showGift=function(d){var b="";b+='<div class="item link" onclick="giftshop.detail('+d+')" onmouseover="showDiv(\'giftshop_item'+d+"_tt')\" onmouseout=\"hideDiv('giftshop_item"+d+"_tt')\">";var a=d;if(presents_hack[d]){a=presents_hack[d]}b+='  <img src="'+imgpath+"gifts/"+a+'.gif">';b+='  <div id="giftshop_item'+d+'_tt" class="ttbox">';b+='    <div class="name">'+this.data.gifts[d][9]+"</div>";if(this.data.gifts[d][1]){var c=formatPrice(this.data.gifts[d][1])}if(this.data.gifts[d][2]){var c=this.data.gifts[d][2]+"&nbsp;"+t_coins}b+='    <div class="cost">'+c+"</div>";b+="  </div>";if(this.data.gifts[d].owned){b+='<div class="ready"></div>'}b+="</div>";return b};giftshop.prototype.detail=function(a){this.is_anonym=0;var l=this.data.gifts[a][9];var e='<div id="giftshop_detail">';var d=a;if(presents_hack[a]){d=presents_hack[a]}e+='  <img src="'+imgpath+"gifts/"+d+'.gif">';if(this.data.gifts[a][1]){var b=formatPrice(this.data.gifts[a][1])}if(this.data.gifts[a][2]){var b=this.data.gifts[a][2]+"&nbsp;"+t_coins}e+='  <div class="cost">'+cityadcost+b+"</div>";e+='  <div id="giftshop_detail_servercost" class="cost">'+t_giftshop_server_cost+"&nbsp;"+this.data.config.foreign_cost+"&nbsp;"+t_coins+"</div>";if(this.data.event&&this.category==this.data.event.category){e+='<div class="points" onmouseover="showDiv(\'giftshop_event_points_tt\')" onmouseout="hideDiv(\'giftshop_event_points_tt\')">';e+="  <div>"+this.data.event.gifts[a].points+"</div>";e+='  <div id="giftshop_event_points_tt" class="ttbox">'+t_giftevent_points_info.replace("%AMOUNT%",this.data.event.gifts[a].points)+"</div>";e+="</div>"}e+='  <div class="form">';e+='    <div class="line"><span class="head">'+giftshoppresentee+"</span><br>";var m="";var n="";if(this.category=="friends"){m="readonly";n="toogleDiv('giftshop_contacts')"}e+='      <div id="giftshop_detail_name_line" class="float">';e+='        <input id="giftshop_detail_name" type="text" '+m+' onclick="'+n+'" onchange="giftshop.insertName()" onkeyup="giftshop.insertName()">';e+='		 <div class="contacts" id="giftshop_contacts"></div>';e+="      </div>";if(this.category!="friends"&&this.data.contacts){e+='<div id="giftshop_detail_contactbook" class="book contactbook link" onclick="giftshop.getList(\'contact\');"></div>'}if(this.data.friends){e+='<div id="giftshop_detail_friendsbook" class="book friendsbook link" onclick="giftshop.getList(\'friends\');"></div>'}e+='      <div class="clear"></div>';e+="    </div>";if((this.category!="friends"&&this.data.config.option_anonym)||(this.data.event&&this.category==this.data.event.category)){e+='<div id="giftshop_detail_anonym_line" class="line">';e+='  <div id="giftshop_detail_anonym" class="link" onclick="giftshop.anonym(1)">';e+='    <div id="giftshop_detail_anonym_checked" class="checked"></div>';e+="  </div>";e+='  <div class="anonym float">'+t_giftshop_anonym+"</div>";e+='  <div class="clear"></div>';e+="</div>"}if(!(this.data.event&&this.category==this.data.event.category)){e+='<div class="line">';e+='  <span class="head">'+giftshopmessage+"</span><br>";e+='  <textarea id="giftshop_detail_msg" onkeyup="giftshop.checkMessage()" onchange="giftshop.checkMessage()"></textarea>';e+="</div>"}if(this.category!="friends"){e+='<div class="line"><span class="head">'+t_server+"</span><br>";e+='  <select id="giftshop_detail_server" onchange="giftshop.setServer()">';for(var c=1;c<=this.data.config.server;c++){var m="";if(servernumber==c){m="selected"}e+="<option "+m+' value="'+c+'">'+t_server+"&nbsp;"+c+"</option>"}e+="  </select>";e+="</div>"}e+='    <div class="button_new link" onclick="giftshop.send('+a+')">'+giftshopsubmit+"</div>";e+="  </div>";e+="</div>";var h="giftshop.open()";globalBoxFlex(l,e,0,h,1);giftshop.anonym();if(this.friendId>0){for(var c=0;c<this.data.friends.length;c++){if(this.data.friends[c].unr==this.friendId){$("giftshop_detail_name").value=this.data.friends[c].uname}}}if(this.category=="friends"&&$("giftshop_detail_name").value==""){this.currentList="friends";this.getList("friends")}};giftshop.prototype.getList=function(b){this.currentList=b;if(b=="contact"){var c=this.data.contacts}if(b=="friends"){var c=this.data.friends}var a="";for(i=0;i<c.length;i++){a+='<div class="line link" onclick="giftshop.setContact('+i+')">'+c[i].uname+"</div>"}$("giftshop_contacts").innerHTML=a;toogleDiv("giftshop_contacts")};giftshop.prototype.insertName=function(){this.is_anonym=0;hideDiv("giftshop_detail_anonym_checked")};giftshop.prototype.setContact=function(b){if(this.currentList=="friends"){var a=this.data.friends[b].uname}else{var a=this.data.contacts[b].uname}$("giftshop_detail_name").value=a;this.is_anonym=0;hideDiv("giftshop_detail_anonym_checked");toogleDiv("giftshop_contacts")};giftshop.prototype.setServer=function(){if(parseInt($("giftshop_detail_server").value)==parseInt(servernumber)){hideDiv("giftshop_detail_servercost");showDiv("giftshop_detail_anonym_line");if($("giftshop_detail_contactbook")){showDiv("giftshop_detail_contactbook")}if($("giftshop_detail_friendsbook")){showDiv("giftshop_detail_friendsbook")}}else{showDiv("giftshop_detail_servercost");hideDiv("giftshop_detail_anonym_line");if($("giftshop_detail_contactbook")){hideDiv("giftshop_detail_contactbook")}if($("giftshop_detail_friendsbook")){hideDiv("giftshop_detail_friendsbook")}if(this.is_anonym==1){this.anonym(1)}}};giftshop.prototype.anonym=function(a){if(a){if(this.is_anonym){this.is_anonym=0}else{this.is_anonym=1}}if(this.is_anonym){$("giftshop_detail_name").value=t_giftshop_option_anonym;showDiv("giftshop_detail_anonym_checked");$("giftshop_detail_server").value=servernumber;hideDiv("giftshop_detail_servercost")}else{$("giftshop_detail_name").value="";hideDiv("giftshop_detail_anonym_checked")}};giftshop.prototype.checkMessage=function(){var a=$("giftshop_detail_msg").value;if(a.length>100){a=a.substring(0,100)}$("giftshop_detail_msg").value=a};giftshop.prototype.friendGift=function(a){this.friendId=a;this.init(1)};giftshop.prototype.eventGift=function(a){this.init(0,1)};giftshop.prototype.feedback=function(){$("giftshop_box_feedback").show();setTimeout(function(){$("giftshop_box_feedback").fade()},1500)};var greenhouse=function(){this.data={};this.currentPid="";this.shopPos=1;this.shopType="all";this.shopCategory="all";this.currentRoom=1;this.stockCount=16;this.stockItems={};this.stockPage=1;this.stockFilters=[];this.stockFilter="";this.bookPageSlots=3;this.bookPage=1;this.bookList={};this.bookFilter="all";this.toogleDivs=["regal_main_buttons","rackInfo","rackItems","rackBottom","carpentrybonus_symbol","reallocatebuilding_symbol"];this.toogleDivsTmp=[];this.tutorialActive=0;this.tutorialStep=1};greenhouse.prototype.setOption=function(a){greenhouse.action("greenhouse_set_option",{option:a})};greenhouse.prototype.clearAll=function(){var a=this.calcBonus();if(a<=0){return 1}greenhouse.action("greenhouse_clearall",{room:this.currentRoom})};greenhouse.prototype.buyRoom=function(){greenhouse.action("greenhouse_buy_room",{room:this.currentRoom})};greenhouse.prototype.getBonus=function(){if(this.data.data.remain>0){return 1}greenhouse.action("greenhouse_get_bonus")};greenhouse.prototype.buyShop=function(a){var b=$("greenhouse_shop_detail_amount").value;greenhouse.action("greenhouse_buy_shop",{name:a,amount:b})};greenhouse.prototype.removeSlotCategory=function(b,a){greenhouse.action("greenhouse_remove_slot_category",{room:this.currentRoom,slot:b,category:a})};greenhouse.prototype.buyFertilizer=function(a){var b=this.currentRoom;if(a==1){b="all"}greenhouse.action("greenhouse_buy_fertilizer",{room:b})};greenhouse.prototype.setSlot=function(a){greenhouse.action("greenhouse_set_slot",{room:this.currentRoom,slot:a,pid:this.currentPid})};greenhouse.prototype.init=function(){greenhouse.action("greenhouse_init")};greenhouse.prototype.action=function(a,b){ajaxAction("farm",a,b,greenhouse.response)};greenhouse.prototype.response=function(d,c,e){greenhouse.data=d;if(greenhouse.currentPid!=""&&(!greenhouse.data.data.stock||!greenhouse.data.data.stock[greenhouse.currentPid]||greenhouse.data.data.stock[greenhouse.currentPid]<=0)){greenhouse.currentPid="";greenhouse.closeHelper()}if(c=="greenhouse_init"){greenhouse.toogleDivsTmp=[];for(var b=0;b<greenhouse.toogleDivs.length;b++){if(!$(greenhouse.toogleDivs[b])||$(greenhouse.toogleDivs[b]).style.display!="block"){continue}hideDiv(greenhouse.toogleDivs[b]);greenhouse.toogleDivsTmp.push(greenhouse.toogleDivs[b])}}greenhouse.build();if(c=="greenhouse_set_slot"){var h="greenhouse_slot_"+e.slot+"_"+greenhouse.data.config.products[e.pid].category;greenhouse.isNew(h)}if(c=="greenhouse_remove_slot_category"&&d.stockback){for(var b=0;b<d.stockback.length;b++){var h="greenhouse_item_"+d.stockback[b];greenhouse.isNew(h)}}if(c=="greenhouse_buy_shop"){greenhouse.openShop()}if(d.points){var a='<div id="greenhouse_commit" class="points">';a+="  <div>"+t_specialoffer_message+"</div>";a+='  <div style="margin-top:10px; font-size:12px; font-weight:bold;">'+formatNumber(d.points)+"&nbsp;"+t_points+"</div>";a+="  <div class=\"button_yes link\" onclick=\"hideDiv('globalbox'); hideDiv('globaltransp');\"></div>";a+="</div>";globalBoxFlex(t_vet_reward_head,a,0,0,1);$("globalbox").style.top="175px"}if(d.tutorial){greenhouse.tutorial()}};greenhouse.prototype.build=function(){var d="";d+='<div id="greenhouse_slots" class="slots"></div>';d+='<div id="greenhouse_rooms_navi_tabs" class="tabs rooms"></div>';if(this.data.data.rooms[this.currentRoom]){var h=["bonus","fertilizer","clearall"];d+='<div class="buttons">';for(var c=0;c<h.length;c++){var n=t_greenhouse_bonus_ready;if(h[c]=="fertilizer"){n=t_greenhouse_fertilizer_ready}if(h[c]=="clearall"){n=t_greenhouse_clearall_name}d+='<div id="greenhouse_button_'+h[c]+'" class="btn is-'+h[c]+' link" onclick="greenhouse.clickButton(\''+h[c]+"')\" onmouseover=\"showDiv('greenhouse_button_"+h[c]+"_tt')\" onmouseout=\"hideDiv('greenhouse_button_"+h[c]+"_tt')\">";d+='  <div class="img"></div>';d+='  <div id="greenhouse_button_'+h[c]+'_tt" class="ttbox">'+n+"</div>";d+="</div>"}d+="</div>"}else{var e=0;if(this.data.config.rooms[this.currentRoom].money){var b=formatPrice(this.data.config.rooms[this.currentRoom].money);if(user_bar<this.data.config.rooms[this.currentRoom].money){e++}}if(this.data.config.rooms[this.currentRoom].coins){var b=formatNumber(this.data.config.rooms[this.currentRoom].coins)+"&nbsp;"+t_coins;if(user_coins<this.data.config.rooms[this.currentRoom].coins){e++}}var m="";if(e>0){m="off"}d+='<div class="buyit">';d+='  <div class="popup">';if(this.data.config.rooms[this.currentRoom].locked){var a=this.data.config.rooms[this.currentRoom].locked;if(a.indexOf("seasonpass")>-1){a=a.replace("seasonpass",t_seasonpass_name+"&nbsp;")}d+="<div>"+t_greenhouse_locked_room_head.replace("%NAME%","<b>"+a+"</b>")+"</div>"}else{d+="<div>"+t_greenhouse_buy_room_desc.replace("%COST%",'<span class="'+m+'">'+b+"</span>")+"</div>";d+='<div class="button_new link '+m+'" onclick="greenhouse.buyRoom()">'+t_greenhouse_buy_room_head+"</div>"}d+="  </div>";d+="</div>"}d+='<div class="info_link link" onmouseover="showDiv(\'greenhouse_info_link_tt\')" onmouseout="hideDiv(\'greenhouse_info_link_tt\')">';d+='  <div id="greenhouse_info_link_tt" class="ttbox">';d+='    <div class="name">'+t_greenhouse_name+"</div>";d+="    <ul>";d+="      <li>"+t_greenhouse_help1+"</li>";d+="      <li>"+t_greenhouse_help2+"</li>";d+="      <li>"+t_greenhouse_help3+"</li>";d+="      <li>"+t_greenhouse_help4.replace("%TIME%",formatTime(this.data.config.constants.points_cooldown))+"</li>";d+="      <li>"+t_greenhouse_help5+"</li>";d+="      <li>"+t_greenhouse_help6.replace("%PERCENT%",Math.round(this.data.config.constants.fertilizer.percent*100))+"</li>";d+="      <li>"+t_greenhouse_help7+"</li>";d+="      <li>"+t_greenhouse_help8+"</li>";if(greenhouse_merge==1){d+="<li>"+t_greenhouse_help9.replace("%COUNT%",this.data.config.constants.merge_max)+"</li>";d+="<li>"+t_greenhouse_help10.replace("%PERCENT%",Math.round(this.data.config.constants.merge_bonus*100))+"</li>"}d+="    </ul>";d+="  </div>";d+="</div>";d+='<div id="greenhouse_tutorial" class="tutorial">';d+='  <div class="transp"></div>';d+='  <div id="greenhouse_tutorial_char" class="char"></div>';d+='  <div id="greenhouse_tutorial_bubble" class="bubble"></div>';d+="</div>";d+='<div class="mini_close link" onclick="greenhouse.close()"></div>';if(greenhouse_merge==1){var l="checked";if(this.data.data.options&&this.data.data.options.stars){l=""}d+='<div class="options">';d+='  <input type="checkbox" '+l+" onclick=\"greenhouse.setOption('stars')\">";d+="  <div>"+t_greenhouse_option_show_stars+"</div>";d+="</div>"}$("greenhouse_inner").innerHTML=d;$("greenhouse").style.display="flex";$("greenhouse_inner").className="inner room"+this.currentRoom;$("greenhouse_inner").addClassName("bounce");this.buildSlots();this.buildStock();this.buildRoomsNavi();setTimer("greenhouse");this.timerUpdate()};greenhouse.prototype.clickButton=function(a){if(a=="bonus"){this.getBonus()}if(a=="fertilizer"){this.buyFertilizerCommit()}if(a=="clearall"){this.clearAll()}};greenhouse.prototype.buyFertilizerCommit=function(){if(this.data.data.rooms[this.currentRoom].fertilizer_remain>0){return 1}var d=0;for(var c in this.data.data.rooms){d++}var b='<div id="greenhouse_commit">';b+="  <div>"+t_greenhouse_set_fertilizer_desc.replace("%PERCENT%","<span>"+Math.round(this.data.config.constants.fertilizer.percent*100)+"%</span>").replace("%TIME%",formatTime(this.data.config.constants.fertilizer.duration))+"</div>";var a=this.data.config.constants.fertilizer.coins;b+='  <div class="block">';b+="    <div>"+t_greenhouse_set_fertilizer_desc_current+"</div>";b+='    <div class="link coinsbutton_flex link" onclick="greenhouse.buyFertilizer()">'+t_greenhouse_set_fertilizer_button.replace("%COINS%",a)+"</div>";b+="  </div>";if(d>1){a=Math.ceil((this.data.config.constants.fertilizer.coins*d)*(1-this.data.config.constants.fertilizer.multi_discount));b+='<div class="block">';b+="  <div>"+t_greenhouse_set_fertilizer_desc_all+"</div>";b+='  <div class="link coinsbutton_flex link" onclick="greenhouse.buyFertilizer(1)">'+t_greenhouse_set_fertilizer_button.replace("%COINS%",a)+"</div>";b+='  <div class="info">'+t_greenhouse_set_fertilizer_info_all+"</div>";b+="</div>"}b+="</div>";globalcommitbox(t_greenhouse_set_fertilizer_head,b,0,0,1)};greenhouse.prototype.buildRoomsNavi=function(){var h=[];for(var d in this.data.data.rooms){h.push(this.data.data.rooms[d].room)}var c="";for(var d in this.data.config.rooms){var a="";if(this.currentRoom==d){a="active"}var e="";if(!in_array(d,h)){e="onmouseover=\"showDiv('greenhouse_room_"+d+"_locked_tt')\" onmouseout=\"hideDiv('greenhouse_room_"+d+"_locked_tt')\""}c+='<div class="tab link '+a+'" onclick="greenhouse.clickRoomsNavi('+d+')" '+e+">";c+='  <div class="amount">'+d+"</div>";if(!in_array(d,h)){c+='<div class="locked"></div>';if(this.data.config.rooms[d].money){c+='  <div id="greenhouse_room_'+d+'_locked_tt" class="ttbox">'+t_greenhouse_buy_room_head+"</div>"}if(this.data.config.rooms[d].locked){var b=this.data.config.rooms[d].locked;if(b.indexOf("seasonpass")>-1){b=b.replace("seasonpass",t_seasonpass_name+"&nbsp;")}c+='<div id="greenhouse_room_'+d+'_locked_tt" class="ttbox">'+t_greenhouse_locked_room_head.replace("%NAME%","<b>"+b+"</b>")+"</div>"}}c+="</div>"}$("greenhouse_rooms_navi_tabs").innerHTML=c};greenhouse.prototype.clickRoomsNavi=function(a){this.currentRoom=a;this.build()};greenhouse.prototype.buildSlots=function(){var a=0;var b="";for(var l in this.data.config.rooms[this.currentRoom].slots){var h="greenhouse.clickSlot("+l+")";if(this.currentPid==""){h=""}var d=this.data.config.rooms[this.currentRoom].slots;b+='<div id="greenhouse_slot'+l+'" class="slot slot'+l+" valid-"+d[l].valid+" level-"+d[l].level+" dir-"+d[l].dir+' link" onclick="'+h+'" onmouseover="greenhouse.slotHover('+l+', 1)" onmouseout="greenhouse.slotHover('+l+', 0)">';if(this.data.data.rooms[this.currentRoom]&&this.data.data.rooms[this.currentRoom].slots&&this.data.data.rooms[this.currentRoom].slots[l]){var c=this.data.data.rooms[this.currentRoom].slots[l];for(var e in c){if(!(c[e]&&c[e])||!this.data.config.products[c[e]]){continue}var h="greenhouse.removeSlotCategory("+l+", '"+e+"')";if(this.currentPid!=""){h=""}b+='<div id="greenhouse_slot_'+l+"_"+e+'" class="'+e+' link" onclick="'+h+'" onmouseover="greenhouse.hoverSlotCategory(\''+c[e]+'\')" onmouseout="greenhouse.unhoverSlotCategory()">';b+='  <div class="greenhouse_product '+c[e]+'"></div>';b+="</div>";if(greenhouse_merge==1&&e=="plant"&&c.stars&&(this.data.data.options&&this.data.data.options.stars)){b+='<div class="star">';b+='  <div class="star_five"></div>';b+='  <div class="count">'+c.stars+"</div>";b+="</div>"}}if(!a){a=0.1}else{a=(getRandom(0,1000)/100)}b+='<div id="greenhouse_slot_'+l+'_fertilized" class="fertilized" style="--greenhouse-fertilizer-delay:'+a+'s"></div>';if(c.fertilizer){b+='<div id="greenhouse_slot_'+l+'_fertilizer_timer" class="timer-fertilizer"></div>'}}b+="</div>"}$("greenhouse_slots").innerHTML=b;$("greenhouse_slots").removeClassName("is-selected");if(this.currentPid!=""){$("greenhouse_slots").addClassName("is-selected")}this.setPulse()};greenhouse.prototype.slotHover=function(b,a){$("greenhouse_slot"+b).removeClassName("hover");if(a==1){$("greenhouse_slot"+b).addClassName("hover")}};greenhouse.prototype.setPulse=function(){if(this.currentPid==""||!this.data.data.rooms[this.currentRoom]){this.closeHelper();return 1}var a=this.data.config.products[this.currentPid].type;var d=this.data.config.products[this.currentPid].category;var c="novalidslot";var b=0;for(var e in this.data.config.rooms[this.currentRoom].slots){if(!$("greenhouse_slot"+e)){continue}if(a=="fertilizer"){if(!(this.data.data.rooms[this.currentRoom]&&this.data.data.rooms[this.currentRoom].slots&&this.data.data.rooms[this.currentRoom].slots[e]&&this.data.data.rooms[this.currentRoom].slots[e].plant)){continue}c="fertilizer"}else{if(in_array(a,["plant","tree"])&&in_array(d,["plant","tree","hanging"])&&!(this.data.data.rooms[this.currentRoom]&&this.data.data.rooms[this.currentRoom].slots&&this.data.data.rooms[this.currentRoom].slots[e]&&this.data.data.rooms[this.currentRoom].slots[e].pot)){continue}if(this.data.data.rooms[this.currentRoom]&&this.data.data.rooms[this.currentRoom].slots&&this.data.data.rooms[this.currentRoom].slots[e]&&this.data.data.rooms[this.currentRoom].slots[e][a]&&this.data.data.rooms[this.currentRoom].slots[e][a]==this.currentPid){if(greenhouse_merge==1&&a=="plant"){if(!this.data.data.rooms[this.currentRoom].slots[e].stars||+this.data.data.rooms[this.currentRoom].slots[e].stars<+this.data.config.constants.merge_max){$("greenhouse_slot"+e).addClassName("merge")}}continue}if(d!=this.data.config.rooms[this.currentRoom].slots[e].valid){continue}c="plant"}$("greenhouse_slot"+e).addClassName("pulse");b++}if(!b&&a=="pot"){c="noslot"}this.showHelper(c,{name:this.data.config.products[this.currentPid].name})};greenhouse.prototype.clickSlot=function(a){if(greenhouse_merge==1&&this.currentPid!=""&&$("greenhouse_slot"+a).hasClassName("merge")){this.setSlot(a);return 1}if(this.currentPid==""||!$("greenhouse_slot"+a).hasClassName("pulse")){return 1}if(this.data.config.products[this.currentPid].type=="fertilizer"){this.buyFertilizer(a)}else{this.setSlot(a)}};greenhouse.prototype.hoverSlotCategory=function(a){if(this.currentPid!=""||(a===undefined||a=="undefined")){return 1}this.showHelper("hoverslotcategory",{name:this.data.config.products[a].name})};greenhouse.prototype.unhoverSlotCategory=function(){if(this.currentPid!=""){return 1}this.closeHelper()};greenhouse.prototype.buildStock=function(){this.stockItems=JSON.parse(JSON.stringify(this.data.data.stock));this.stockFilters=[];for(var h in this.stockItems){if(!this.data.config.products[h]){continue}if(this.data.data.stock[h]<=0){continue}if(!in_array(this.data.config.products[h].type,this.stockFilters)){this.stockFilters.push(this.data.config.products[h].type)}}if(!in_array(this.stockFilter,this.stockFilters)){this.stockFilter=""}var d={};var l=0;for(var h in this.stockItems){if(!this.data.config.products[h]){continue}if(this.data.data.stock[h]<=0){continue}if(this.stockFilter==this.data.config.products[h].type){d[h]=this.stockItems[h]}l++}if(this.stockFilter!=""){this.stockItems=d}if(!this.stockPage){this.stockPage=1}var b=Math.ceil(l/this.stockCount);if(parseInt(this.stockPage)>parseInt(b)){this.stockPage=b}var e="";e+='<div class="info">';e+='  <div class="head">'+t_greenhouse_mode_plant+"</div>";if(this.currentPid!=""){e+='  <div class="img">';e+='    <div class="greenhouse_product '+this.currentPid+'"></div>';e+="  </div>";e+='  <div class="data">';e+='    <div class="name">'+this.data.config.products[this.currentPid].name+"</div>";e+='    <div class="category">'+t_greenhouse_type[this.data.config.products[this.currentPid].type]+"</div>";if(this.data.config.products[this.currentPid].points){e+='<div class="points">'+formatNumber(this.data.config.products[this.currentPid].points)+"&nbsp;"+t_points+"</div>"}e+="  </div>"}else{e+='<div class="desc">'+t_greenhouse_mode_plant_desc+"</div>"}e+="</div>";e+='<div id="greenhouse_stock_navi_tabs" class="navi tabs"></div>';e+='<div id="greenhouse_stock_filter_tabs" class="filter tabs"></div>';e+='<div id="greenhouse_stock_items" class="items">';if(this.stockItems){var a=((this.stockPage-1)*this.stockCount)+1;var c=(this.stockPage*this.stockCount);l=1;for(var h in this.stockItems){if(!this.data.config.products[h]){continue}if(this.data.data.stock[h]<=0){continue}if(l>=a&&l<=c){var m="";var n="greenhouse.setPid('"+h+"')";e+='<div id="greenhouse_item_'+h+'" class="item link '+m+'" onclick="'+n+'" onmouseover="showDiv(\'greenhouse_stock_'+h+"_tt')\" onmouseout=\"hideDiv('greenhouse_stock_"+h+"_tt')\">";e+='  <div class="back '+this.data.config.products[h].type+"-"+this.data.config.products[h].category+'"></div>';e+='  <div class="label '+h+" "+this.data.config.products[h].type+"-"+this.data.config.products[h].category+'">';e+='    <div class="greenhouse_product '+h+'"></div>';e+="  </div>";e+='  <div class="amount">'+formatNumber(this.data.data.stock[h])+"</div>";e+='  <div id="greenhouse_stock_'+h+'_tt" class="ttbox">'+this.itemTT(h)+"</div>";e+="</div>"}l++}e+='<div class="clear"></div>'}e+="</div>";e+='<div id="greenhouse_shop_link" class="shop_link link" onclick="greenhouse.openShop()" onmouseover="showDiv(\'greenhouse_shop_link_tt\')" onmouseout="hideDiv(\'greenhouse_shop_link_tt\')">';e+='  <div id="greenhouse_shop_link_tt" class="ttbox">'+t_greenhouse_shop_name+"</div>";e+="</div>";$("greenhouse_stock").innerHTML=e;this.buildStockNavi();this.buildStockFilter()};greenhouse.prototype.setPid=function(a){if(this.tutorialActive==1){return 1}if(!this.data.data.stock[a]){return 1}if(this.currentPid==a){this.currentPid=""}else{this.currentPid=a}this.buildSlots();this.buildStock()};greenhouse.prototype.unsetPid=function(){this.currentPid="";this.buildSlots();this.buildStock()};greenhouse.prototype.buildStockFilter=function(){var c="";var a="";if(this.stockFilter==""){a="active"}if(this.stockFilters.length){c+='<div class="tab link '+a+' is-all" onclick="greenhouse.clickStockFilter(\'\')" onmouseover="showDiv(\'greenhouse_filter_all_tt\')" onmouseout="hideDiv(\'greenhouse_filter_all_tt\')">';c+='  <div id="greenhouse_filter_all_tt" class="ttbox">'+t_greenhouse_type.all+"</div>";c+="</div>";for(var b=0;b<this.stockFilters.length;b++){a="";if(this.stockFilter==this.stockFilters[b]){a="active"}c+='<div class="tab link '+a+" is-"+this.stockFilters[b]+'" onclick="greenhouse.clickStockFilter(\''+this.stockFilters[b]+"')\" onmouseover=\"showDiv('greenhouse_filter_"+this.stockFilters[b]+"_tt')\" onmouseout=\"hideDiv('greenhouse_filter_"+this.stockFilters[b]+"_tt')\">";c+='  <div id="greenhouse_filter_'+this.stockFilters[b]+'_tt" class="ttbox">'+t_greenhouse_type[this.stockFilters[b]]+"</div>";c+="</div>"}}$("greenhouse_stock_filter_tabs").innerHTML=c};greenhouse.prototype.clickStockFilter=function(a){this.stockFilter=a;this.stockPage=1;this.buildStock()};greenhouse.prototype.buildStockNavi=function(){var h=0;if(this.stockItems){for(var c in this.stockItems){if(!this.data.config.products[c]||this.data.data.stock[c]<=0){continue}h++}}var a=Math.ceil(h/this.stockCount);var e="";if(a>1){for(var d=1;d<=a;d++){var b="";if(this.stockPage==d){b="active"}e+='<div class="tab '+b+' link" onclick="greenhouse.clickStockNavi('+d+')">';e+='  <div class="amount">'+d+"</div>";e+="</div>"}}$("greenhouse_stock_navi_tabs").innerHTML=e};greenhouse.prototype.clickStockNavi=function(a){this.stockPage=a;this.buildStock()};greenhouse.prototype.clickShopType=function(a){this.shopType=a;this.shopCategory="all";this.openShop()};greenhouse.prototype.clickShopCategory=function(a){this.shopCategory=a;this.openShop()};greenhouse.prototype.openShop=function(){if(this.tutorialActive==1){return 1}var m=this.getShopProductList();var e='<div id="greenhouse_shop">';e+='  <div class="desc">'+t_greenhouse_shop_desc+"</div>";e+='  <div class="tabs">';var a=["all","plant","pot"];for(var b=0;b<a.length;b++){var q="";if(a[b]==this.shopType){q="active"}e+='<div class="tab '+q+' link" onclick="greenhouse.clickShopType(\''+a[b]+"')\">"+t_greenhouse_type[a[b]]+"</div>"}e+="  </div>";if(!in_array(this.shopType,["fertilizer"])){e+='  <div class="filters flex-left">';var l=["all","plant","hanging","tree"];for(var b=0;b<l.length;b++){var n="";if(l[b]==this.shopCategory){n="checked"}e+='<div class="flex-left">';e+='  <input type="checkbox" '+n+' class="link" onclick="greenhouse.clickShopCategory(\''+l[b]+"')\">";e+="  <div>"+t_greenhouse_category[l[b]]+"</div>";e+="</div>"}e+="  </div>"}e+='  <div class="slots">';var h=1;for(var d in m){var c=0;if(this.data.data.stock&&this.data.data.stock[d]){c=this.data.data.stock[d]}var q="";if(in_array(h,[7,8,15,16,23,24])){q="right"}e+='<div class="slot link '+q+'" onclick="greenhouse.detailShop(\''+d+"')\" onmouseover=\"showDiv('greenhouse_shop_"+d+"_tt')\" onmouseout=\"hideDiv('greenhouse_shop_"+d+"_tt')\">";e+='  <div class="label '+d+'">';e+='    <div class="greenhouse_product '+d+'"></div>';e+='    <div id="greenhouse_shop_'+d+'_tt" class="ttbox">'+greenhouse.itemTT(d)+"</div>";e+='    <div class="amount">'+c+"</div>";e+="  </div>";e+="</div>";h++}e+='    <div class="clear"></div>';e+="  </div>";e+="</div>";globalBoxFlex(t_greenhouse_shop_name,e,0,0,1)};greenhouse.prototype.detailShop=function(d){var a=this.data.config.products[d].category;var h=this.getShopProductList();var m=0;for(var b in h){m++;if(b==d){this.shopPos=m}}if(this.data.config.products[d].money){var e=formatPrice(this.data.config.products[d].money)}if(this.data.config.products[d].coins){var e=this.data.config.products[d].coins+"&nbsp;"+t_coins}var c='<div id="greenhouse_shop">';c+='  <div class="detail">';c+='    <div class="greenhouse_product '+d+'" onmouseover="showDiv(\'greenhouse_product '+d+"_tt')\" onmouseout=\"hideDiv('greenhouse_product "+d+"_tt')\">";c+='      <div id="greenhouse_product '+d+'_tt" class="ttbox">'+greenhouse.itemTT(d)+"</div>";c+='      <div class="'+this.data.config.products[d].category+'-icon"></div>';c+="    </div>";c+='    <div class="name">'+this.data.config.products[d].name+"</div>";c+='    <div class="price">'+e+"</div>";c+='    <div class="cost">';c+='      <div class="top">'+beemasteramount+"</div>";c+='      <input id="greenhouse_shop_detail_amount" type="number" value="1" min="1" class="amount" onchange="greenhouse.checkPriceDetailShop(\''+d+"')\" onkeyup=\"greenhouse.checkPriceDetailShop('"+d+"')\">";c+='      <div class="top">'+farmcartsum+"</div>";c+='      <div id="greenhouse_shop_detail_sum" class="sum"></div>';c+='      <div id="greenhouse_shop_detail_button" class="button_new link" onclick="greenhouse.buyShop(\''+d+"')\">"+t_buy+"</div>";c+="    </div>";c+="  </div>";if(this.shopPos>1){c+='<div class="navi left link" onclick="greenhouse.naviDetailShop(-1, \''+d+"')\"></div>"}if(this.shopPos<m){c+='<div class="navi right link" onclick="greenhouse.naviDetailShop(1, \''+d+"')\"></div>"}c+="</div>";var n="";var l="greenhouse.openShop()";globalBoxFlex(t_greenhouse_shop_name,c,n,l);this.checkPriceDetailShop(d)};greenhouse.prototype.checkPriceDetailShop=function(b){var c=$("greenhouse_shop_detail_amount").value;if(this.data.config.products[b].money){var e=this.data.config.products[b].money;var d=formatPrice(e*c);var a=(user_bar/e)}if(this.data.config.products[b].coins){var e=this.data.config.products[b].coins;var d=formatNumber(e*c)+"&nbsp;"+t_coins;var a=(user_coins/e)}$("greenhouse_shop_detail_sum").innerHTML=d;$("greenhouse_shop_detail_button").removeClassName("off");if(parseInt(c)>parseInt(a)){$("greenhouse_shop_detail_button").addClassName("off")}};greenhouse.prototype.naviDetailShop=function(c,b){var d=this.getShopProductList();var a=0;var e={};for(var b in d){a++;e[a]=b}this.shopPos+=c;if(parseInt(this.shopPos)<1){this.shopPos=1}if(parseInt(this.shopPos)>parseInt(a)){this.shopPos=a}this.detailShop(e[this.shopPos])};greenhouse.prototype.getShopProductList=function(){var b={};for(var a in this.data.config.products){if(!(this.data.config.products[a].money||this.data.config.products[a].coins)){continue}if(this.shopType!="all"&&this.data.config.products[a].type!=this.shopType){continue}if(this.shopCategory!="all"&&this.data.config.products[a].category!=this.shopCategory){continue}b[a]=this.data.config.products[a]}return b};greenhouse.prototype.openBook=function(){this.unsetPid();var a="";a+='<div id="greenhouse_book_page_left" class="page left"></div>';a+='<div id="greenhouse_book_page_right" class="page right"></div>';a+='<div id="greenhouse_book_arrow_left" class="arrow left link" onclick="greenhouse.clickBookArrow(-1)"></div>';a+='<div id="greenhouse_book_arrow_right" class="arrow right link" onclick="greenhouse.clickBookArrow(1)"></div>';a+='<div id="greenhouse_filters" class="filters"></div>';a+='<div class="mini_close link" onclick="greenhouse.closeBook()"></div>';$("greenhouse_book").innerHTML=a;$("greenhouse_book").addClassName("bounce");showDiv("greenhouse_book");hideDiv("greenhouse_inner");this.buildBookPage()};greenhouse.prototype.buildBookFilter=function(){var c="";var d=["all","plant","pot","fertilizer"];for(var b=0;b<d.length;b++){var a="";if(this.bookFilter==d[b]){a="active"}c+='<div class="tab link '+a+'" onclick="greenhouse.setBookFilter(\''+d[b]+"')\">"+d[b]+"</div>"}$("greenhouse_filters").innerHTML=c};greenhouse.prototype.setBookFilter=function(a){this.bookFilter=a;this.bookPage=1;this.buildBookPage()};greenhouse.prototype.buildBookPage=function(){this.bookList=JSON.parse(JSON.stringify(this.data.config.products));if(this.bookFilter!="all"){var d={};for(var b in this.bookList){if(this.data.config.products[b].type==this.bookFilter){d[b]=this.bookList[b]}}this.bookList=d}var c={left:"",right:""};var h=((this.bookPage-1)*(this.bookPageSlots*2))+1;var a=((this.bookPageSlots*2)*this.bookPage);var e=1;for(var b in this.bookList){if(e>=h&&e<=a){var d="";d+='<div class="slot">';d+='  <div class="greenhouse_product '+b+'" onmouseover="showDiv(\'greenhouse_book_'+b+"_tt')\" onmouseout=\"hideDiv('greenhouse_book_"+b+"_tt')\">";d+='    <div id="greenhouse_book_'+b+'_tt" class="ttbox">'+this.itemTT(b)+"</div>";d+="  </div>";d+="</div>";if(e<(h+this.bookPageSlots)){c.left+=d}else{c.right+=d}}e++}$("greenhouse_book_page_left").innerHTML=c.left;$("greenhouse_book_page_right").innerHTML=c.right;this.buildBookFilter();this.clickBookArrow(0)};greenhouse.prototype.clickBookArrow=function(b){var c=0;for(var a in this.bookList){c++}max=Math.ceil(c/(this.bookPageSlots*2));if(b!=0){this.bookPage+=b}if(this.bookPage<1){this.bookPage=1}if(this.bookPage>max){this.bookPage=max}if(b!=0){this.buildBookPage()}showDiv("greenhouse_book_arrow_left");showDiv("greenhouse_book_arrow_right");if(this.bookPage==1){hideDiv("greenhouse_book_arrow_left")}if(this.bookPage==max){hideDiv("greenhouse_book_arrow_right")}};greenhouse.prototype.closeBook=function(){this.bookPage=1;this.bookFilter="all";hideDiv("greenhouse_book");showDiv("greenhouse_inner")};greenhouse.prototype.showHelper=function(b,d){$("greenhouse_helper_line").addClassName("on");var c="";if(t_greenhouse_helper_text[b]){c=t_greenhouse_helper_text[b];if(d){for(var a in d){c=c.replace("%"+a.toUpperCase()+"%","<b>"+d[a]+"</b>")}}}$("greenhouse_helper_bubble").innerHTML=c};greenhouse.prototype.closeHelper=function(){$("greenhouse_helper_line").removeClassName("on")};greenhouse.prototype.tutorial=function(){$("greenhouse_stock_items").removeClassName("pulse");$("greenhouse_slots").removeClassName("pulse");$("greenhouse_shop_link").removeClassName("pulse");for(var c in this.data.config.rooms[this.currentRoom].slots){$("greenhouse_slot"+c).removeClassName("pulse")}this.tutorialActive=1;hideDiv("greenhouse_rooms_navi_tabs");if(!t_greenhouse_tutorial_text[this.tutorialStep]){this.closeTutorial();return 1}showDiv("greenhouse_tutorial");var b=t_continue;if(!t_greenhouse_tutorial_text[(this.tutorialStep+1)]){b=t_vineyard_tutorial_text_finish}var a=t_greenhouse_tutorial_text[this.tutorialStep].replace("%NAME%","<b>"+username+"</b>").replace("%TIME%",formatTime(this.data.config.constants.points_cooldown));a+='<div class="footer">';a+='  <button class="button_new link" onclick="greenhouse.nextTutorialStep()">'+b+"</button>";a+="</div>";if(this.tutorialStep==2){$("greenhouse_stock_items").addClassName("pulse");setTimeout(function(){if($("greenhouse_stock_items")){$("greenhouse_stock_items").removeClassName("pulse")}},2000)}if(this.tutorialStep==3){$("greenhouse_slots").addClassName("pulse");for(var c in this.data.config.rooms[this.currentRoom].slots){if(in_array(c,[4,5])){continue}$("greenhouse_slot"+c).addClassName("pulse")}setTimeout(function(){if($("greenhouse_slots")){$("greenhouse_slots").removeClassName("pulse")}},2000)}if(this.tutorialStep==5){$("greenhouse_shop_link").addClassName("pulse");setTimeout(function(){if($("greenhouse_shop_link")){$("greenhouse_shop_link").removeClassName("pulse")}},2000)}$("greenhouse_tutorial_bubble").innerHTML=a};greenhouse.prototype.nextTutorialStep=function(){this.tutorialStep++;this.tutorial()};greenhouse.prototype.closeTutorial=function(){this.tutorialActive=0;showDiv("greenhouse_rooms_navi_tabs");hideDiv("greenhouse_tutorial")};greenhouse.prototype.isNew=function(a){if(!$(a)){return 1}$(a).addClassName("isnew");setTimeout(function(){if($(a)){$(a).removeClassName("isnew")}},2500)};greenhouse.prototype.itemTT=function(a){var c=0;if(this.data.data.stock&&this.data.data.stock[a]){c=this.data.data.stock[a]}var b='<div id="greenhouse_item">';b+='  <div class="headline">'+this.data.config.products[a].name+"</div>";b+='  <div class="img greenhouse_product '+a+'"></div>';b+='  <div class="'+this.data.config.products[a].category+'-icon"></div>';b+='  <div class="stats">';b+='    <div class="line">';b+='      <div class="col col1">'+t_greenhouse_plant_type+":</div>";b+='      <div class="col col2">';b+="        <div>"+t_greenhouse_type[this.data.config.products[a].type]+"</div>";b+="      </div>";b+="    </div>";if(this.data.config.products[a].category!="all"){b+='<div class="line">';b+='  <div class="col col1">'+t_greenhouse_plant_category+":</div>";b+='  <div class="col col2">';b+="    <div>"+t_greenhouse_category[this.data.config.products[a].category]+"</div>";b+="  </div>";b+="</div>"}if(this.data.config.products[a].points){b+='<div class="line">';b+='  <div class="col col1">'+t_points+":</div>";b+='  <div class="col col2">'+formatNumber(this.data.config.products[a].points)+"</div>";b+="</div>"}if(this.data.config.products[a].money||this.data.config.products[a].coins){if(this.data.config.products[a].money){var d=formatPrice(this.data.config.products[a].money)}if(this.data.config.products[a].coins){var d=formatNumber(this.data.config.products[a].coins)+"&nbsp;"+t_coins}b+='<div class="line">';b+='  <div class="col col1">'+t_market_new_price+"</div>";b+='  <div class="col col2">'+d+"</div>";b+="</div>"}else{b+='<div class="line notbuyable">';b+="  <div>"+t_greenhouse_not_buyable+"</div>";b+="</div>"}b+="  </div>";b+="</div>";return b};greenhouse.prototype.calcBonus=function(){var l=0;for(var a in this.data.data.rooms){var e=1;if(this.data.data.rooms[a].fertilizer_remain>0){e+=this.data.config.constants.fertilizer.percent}if(!(this.data.data.rooms[a]&&this.data.data.rooms[a].slots)){continue}var b=0;for(var h in this.data.data.rooms[a].slots){for(var c in this.data.data.rooms[a].slots[h]){var d=this.data.data.rooms[a].slots[h][c];if(!this.data.config.products[d]){continue}var n=this.data.config.products[d].points;if(greenhouse_merge==1&&c=="plant"&&this.data.data.rooms[a].slots[h].stars){var m=this.data.config.constants.merge_bonus*(this.data.data.rooms[a].slots[h].stars-1);n=(n*(1+m))}if(this.data.config.products[d].points){b+=n}}}l+=Math.ceil(b*e)}return l};greenhouse.prototype.timer=function(){if(this.data&&this.data.data){this.data.data.remain--;if(this.data.data.rooms){for(var a in this.data.data.rooms){if(this.data.data.rooms[a].fertilizer>0){this.data.data.rooms[a].fertilizer_remain--}for(var b in this.data.data.rooms[a].slots){if(this.data.data.rooms[a].slots[b].fertilizer){this.data.data.rooms[a].slots[b].fertilizer.remain--}}}}this.timerUpdate()}};greenhouse.prototype.timerUpdate=function(){var a=this.calcBonus();if($("greenhouse_button_bonus")){$("greenhouse_button_bonus").removeClassName("off2");if(this.data.data.remain<=0){if(a<=0){$("greenhouse_button_bonus").addClassName("off2")}else{$("greenhouse_button_bonus_tt").innerHTML=t_greenhouse_bonus_ready+'<div style="font-style:italic; margin-top:5px;">('+formatNumber(this.calcBonus())+"&nbsp;"+t_points+")</div>"}}else{$("greenhouse_button_bonus").addClassName("off2");$("greenhouse_button_bonus_tt").innerHTML=t_greenhouse_bonus_remain.replace("%TIME%",formatTime(this.data.data.remain))+'<div style="font-style:italic; margin-top:5px;">('+formatNumber(this.calcBonus())+"&nbsp;"+t_points+")</div>"}}if($("greenhouse_button_clearall")){$("greenhouse_button_clearall").removeClassName("off2");if(a<=0){$("greenhouse_button_clearall").addClassName("off2")}}if($("greenhouse").style.display=="flex"){if(this.data.data.rooms&&this.data.data.rooms[this.currentRoom]){if(this.data.data.rooms[this.currentRoom].fertilizer>0){$("greenhouse_button_fertilizer").removeClassName("off2");if(this.data.data.rooms[this.currentRoom].fertilizer_remain<=0){$("greenhouse_button_fertilizer_tt").innerHTML=t_greenhouse_fertilizer_ready}else{$("greenhouse_button_fertilizer").addClassName("off2");$("greenhouse_button_fertilizer_tt").innerHTML=t_greenhouse_fertilizer_remain.replace("%TIME%",formatTime(this.data.data.rooms[this.currentRoom].fertilizer_remain))}for(var b in this.data.config.rooms[this.currentRoom].slots){hideDiv("greenhouse_slot_"+b+"_fertilized");if(this.data.data.rooms[this.currentRoom].slots&&this.data.data.rooms[this.currentRoom].slots[b]){if(!this.data.data.rooms[this.currentRoom].slots[b].pot&&!this.data.data.rooms[this.currentRoom].slots[b].plant){continue}if(this.data.data.rooms[this.currentRoom].fertilizer_remain>0){showDiv("greenhouse_slot_"+b+"_fertilized")}}}}}}};greenhouse.prototype.close=function(){for(var a=0;a<this.toogleDivsTmp.length;a++){showDiv(this.toogleDivsTmp[a])}hideDiv("greenhouse")};function guildAction(d,c,a){var b="";if(d=="job_leveladd"){c={amount:$("guild_job_dialog_leveladd_insert").value}}if(c){for(i in c){b+="&"+i+"="+encodeURIComponent(c[i])}}showGlobalWait(d);var e=createAjaxRequestObj();e.open("GET","ajax/guild.php?rid="+rid+"&mode="+d+b,true);e.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");e.onreadystatechange=function(){guildActionResponse(e,d,c,a)};e.send(null)}function guildActionResponse(d,l,h,c){var a=_chkRequest(d);if(a!=0){hideGlobalWait();guild_questentry_block=0;if(a[0]==0){globalerrorbox(a[1])}else{hideDiv("globaltransp");hideDiv("globalbox");if($("farm_inner_guildlink")){$("farm_inner_guildlink").removeClassName("pulse")}var b=["create","close","leave","joinmessage"];if(in_array(l,b)){if(!(a[0]&&a[0][2])){clearTimer("guild_quest");guildquestrun=0}}if(l=="init"||l=="edit"||l=="setquest"||l=="questentry"||l=="commitproxy"||l=="denyproxy"||l=="proxycallback"||l=="proxyreject"){initGuildResponse(a)}if(l=="create"){hideDiv("transp");hideDiv("createguildbox");userfarminfos[farm][c.position]["buildingid"]=6;userfarminfos[farm][c.position]["level"]=1;userfarminfos[farm][c.position]["animals"]=0;userfarminfos[farm]["guild"]=1}if(l=="close"||l=="leave"){player_guild=0;showMain();initZones(1)}if(l=="openticker"){openNewstickerResponse(a,h.type)}if(l=="deletenews"||l=="writenews"||l=="writemail"){openNewstickerResponse(a,1)}if(l=="getmembers"||l=="admitcandidate"||l=="refusecandidate"||l=="suggestproxy"||l=="degradesuggestproxy"||l=="degradeproxy"||l=="promoteproxy"||l=="promoteproxyask"||l=="kickmember"){getGuildMembersResponse(a)}if(l=="buyitem"){hideDiv("transp9");hideDiv("guildshop")}if(l=="initguildpark"||l=="sendguildpark"){sculpturedata=a[1];guildpark_stock=a[2];guildpark_userstatus=a[3];guildpark_entries=a[4];guildparkstats=a[5];setGuildParkView()}if(l=="joinmessage"){closeGuildPublic()}if(l=="searchguild"){searchGuildResponse(a)}if(l=="initshop"){initGuildShopResponse(a)}if(l=="initquests"){initGuildQuestsResponse(a,h.only)}if(l=="initranking"){buildStatsResponse(a,h.type)}if(l=="queststats"){showGuildQuestStatsResponse(a,h.type,h.page,h.self)}if(l=="initwbw"||l=="wbwsenditems"||l=="cleartruck"||l=="callbacktruck"||l=="starttruck"||l=="startalltrucks"){initGuildWBWResponse(a)}if(l=="proxycallback"||l=="proxyreject"||l=="commitproxy"||l=="denyproxy"){hideDiv("multiframe");hideDiv("transp9")}if(l=="initwbwshop"){shopdata=a[1];setGuildWBWContent(3,a[2])}if(l=="wbwshopdonate"){guildWBWDonateResponse(a)}if(l=="wbwtrophies"){buildGuildWBWtrophies(a);showDiv("transp9");showDiv("guildwbwtrophies")}if(l=="halloffame"){guildWBWHallOfFameResponse(a,c.ispublic)}if(l=="wbwranking"){guildWBWRankingResponse(a,h["public"])}if(l=="wbwmemberranking"){guildwbwuserranking=a[1];setGuildWBWContent(4)}var e=["job_init","memberjob_change","stock_delete_product","job_gamble","stock_slot_entry","stock_slot_unlock","job_set_tool","job_set_boost","job_join","job_leveladd","job_start","job_entry","add_jobmember","job_buy_points","job_finish","job_stats"];if(in_array(l,e)){if(l=="job_stats"){guild_job_stats_cache_delay[h.type]=60;guild_job_stats_cache[h.type]=a[1].stats;showGuildJobStats(h.type)}else{if(l=="job_set_tool"||l=="job_set_boost"||l=="memberjob_change"){showJobOverview()}else{initGuildJobBox();if(l=="job_join"){naviGuildJob(2)}if(in_array(l,["stock_slot_entry","stock_slot_unlock","stock_delete_product"])){naviGuildJob(3);if(in_array(l,["stock_slot_entry","stock_slot_unlock"])){showGuildJobStockInfo(h.slot)}}}}if(a[1]&&a[1].levelup&&a[1].levelup.level){levelupAlert(a[1].levelup.level,a[1].levelup.leveltitle)}if(a[1]&&a[1].reward){guildJobRewardDialog(a[1].reward)}if(l=="job_init"&&h.page){naviGuildJob(h.page)}}if(l=="memberjob_change"){guild_job_change_memberjob_block=0}if(l=="achievementsinit"){buildGuildAchievements(a[1]);showDiv("transp9");showDiv("guildachievements")}}}}var guilddata={};var guildquestrun=0;var guildmemberstatus=0;var inguild=0;var guild_questentry_block=0;var guildquesttime=0;var sculptureid=1;var guildpark_data=new Object;var guildpark_stock=new Object;var guildpark_entries=new Object;var guildpark_userstatus=1;function initGuild(){showMain();inguild=1;guildAction("init")}function initGuildResponse(b){guilddata=b[0];hideDiv("guildpark");hideDiv("transp9");hideDiv("guildmultibox");hideDiv("createguildbox");hideDiv("guildquestbox");if(b[1]==1){showDiv("guildwbwlink")}else{hideDiv("guildwbwlink")}if(b[0][0]["tag"]==""){var e="---"}else{var e=b[0][0]["tag"]}$("guildname").innerHTML=b[0][0][1]+'&nbsp;[<span id="editguildtag">'+e+"</span>]";if(b[0][1][2]==1||b[0][1][2]==2){if(!a){var a=1}$("guildedit").innerHTML='<img width="15" height="15" src="'+imgpath+'guild/edit.gif" border="0" onclick="showDiv(\'transp9\'); createGuildCommit('+a+',0,1);">'}else{$("guildedit").innerHTML=""}if(b[0][0][2]){var c=str_replace("\r","\n",b[0][0][2]);c=str_replace("\n","<br>",c)}else{c=" "}$("guildinfodesc").innerHTML=c;$("guildinfopoints").innerHTML=b[0][0][6];$("guildinfobirthday").innerHTML=formatDate(b[0][0][9]);$("guildinfomembers").innerHTML=b[0][0][10];$("guildinfojointax").innerHTML=formatPrice(b[0][0][13]);if($("farm_inner_guildlink")){$("farm_inner_guildlink").removeClassName("pulse")}if(b[0][2]!=0){if(b[0][1][2]<=5&&b[0][1][2]>0){setGuildQuestRun(b[0][2])}else{guildquestrun=0;clearTimer("guild_quest")}}else{guildquestrun=0;clearTimer("guild_quest")}if(b[0][0][4]){var d=b[0][0][4].split("_");$("guildbanner_back").style.backgroundImage="url("+imgpath+"guildbanner/backgrounds/back_"+d[0]+".jpg)";$("guildbanner_border").style.backgroundImage="url("+imgpath+"guildbanner/borders/GeneriertesBild_"+d[1]+"_"+d[2]+".png)";$("guildbanner_head").style.backgroundImage="url("+imgpath+"guildbanner/heads/GeneriertesBild_"+d[3]+"_"+d[4]+".png)"}guildmemberstatus=b[2];setBeauties();showDiv("guildbanner_back");showDiv("transp");showDiv("guildmaincontainer")}function createGuild(m,r){var a=$("gildentax").value;if(!isNumeric(a)){$("gildentax").value=guildjoincost;return false}var n=$("guildbanner_headcount").value;var d=$("guildbanner_headcolorcount").value;var c=$("guildbanner_bordercount").value;var l=$("guildbanner_bordercolorcount").value;var h=$("guildbanner_backcount").value;var e=h+"_"+c+"_"+l+"_"+n+"_"+d;if($("gildenname").value==""){globalerrorbox(t_guild_insert_guildname)}else{if($("gildentag").value==""){globalerrorbox(t_guild_insert_guildtag)}else{var b={farm:farm,position:m,name:$("gildenname").value,desc:$("gildendesc").value,tax:$("gildentax").value,tag:$("gildentag").value,img:e};var q={position:m,edit:r};if(r==1){guildAction("edit",b,q)}else{guildAction("create",b,q)}}}}function countLetters(c,b){var a=$(c).value;if(a.length>guilddescmaxlength){$(c).value=a.substring(0,(guilddescmaxlength-1));$(c).scrollTop=$(c).scrollHeight}$(b).innerHTML=str_replace("%LETTERS%",(guilddescmaxlength-a.length),guildcreatedialogcountletters)}function createGuildCommit(w,c,q){if(c==1){globalerrorbox(error1001)}else{var t="";if(q==1){t+='<div class="headline">'+guildeditdialogheadline+"</div>"}else{t+='<div class="headline">'+guildcreateguild+"</div>"}t+="<div>";t+='<div style="float:left; width:220px;">'+guildinsertname+'<br><input type="text" name="name" size="30" maxlength="25" id="gildenname" title="'+inputinfo_guildname+'"></div>';t+='<div style="float:left; width:110px;">'+guildinnertagcommit+'<br>[<input type="text" maxlength="'+guildtagmaxlength+'" name="gildentag" size="10" id="gildentag" value="" title="'+inputinfo_taginfo+'">]</div>';t+='<div style="float:left;">'+guildinnerjointaxcommit+'<br><input type="text" maxlength="5" name="gildentax" size="10" id="gildentax" value="'+guildjoincost+'">&nbsp;'+gamecurrency+"</div>";t+='<div style="clear:both;"></div>';t+="</div>";t+='<div style="margin-top:5px;">'+guildinsertdesc+'<br><textarea style="border:1px solid #6C441E;" name="desc" cols="65" rows="1" id="gildendesc" onkeyup="countLetters(\'gildendesc\',\'guilddesccountletters\');" onchange="countLetters(\'gildendesc\',\'guilddesccountletters\');"></textarea></div>';t+='<div style="font-size:9px;" id="guilddesccountletters">'+str_replace("%LETTERS%",guilddescmaxlength,guildcreatedialogcountletters)+"</div>";if(q==1){var z="createGuild("+w+",1)"}else{var z="createGuild("+w+",0)"}if(q==1){var v="hideDiv('transp9'); hideDiv('createguildbox')"}else{var v="hideDiv('transp'); hideDiv('createguildbox')"}if(q==1){var m='<button type="button" class="link" onclick="'+z+'">'+guildeditguildsubmit+"</button>"}else{var m='<button type="button" class="link" onclick="'+z+'">'+guildcreateguild+"</button>"}var d='<img class="link" src="'+imgpath+'button_cancel_off.png" onclick="'+v+'" onmouseover="this.src=\''+imgpath+"button_cancel_on.png';\" onmouseout=\"this.src='"+imgpath+"button_cancel_off.png';\"></div>";t+='<div id="createguildbannerdiv">';t+='<div id="createguildbannerdiv_banner">';t+='<div id="bannerback"></div>';t+='<div id="bannerborder"></div>';t+='<div id="bannerhead"></div>';t+="</div>";t+='<div id="createguildbannerdiv_settings">';for(var u=1;u<=5;u++){if(u==1){var l=banner_head;var b="guildbanner_headcount"}else{if(u==2){var l=banner_headcolor;var b="guildbanner_headcolorcount"}else{if(u==3){var l=banner_border;var b="guildbanner_bordercount"}else{if(u==4){var l=banner_bordercolor;var b="guildbanner_bordercolorcount"}else{if(u==5){var l=banner_backcolor;var b="guildbanner_backcount"}}}}}t+='<div class="guildbanneroption">';t+='<div class="guildbanner_headline">'+l+"</div>";t+='<div class="guildbanner_navipre link" onclick="setBanner('+u+',1);"></div>';t+='<div class="guildbanner_count link">';t+='<input type="text" id="'+b+'" maxlength="1" size="2" value="0" readonly onChange="setBanner('+u+',3);">';t+="</div>";t+='<div class="guildbanner_navinext link" onclick="setBanner('+u+',2);"></div>';t+="</div>"}t+="</div>";t+="</div>";$("createguildboxheader").innerHTML=d;$("createguildboxcontent").innerHTML=t;$("createguildboxfooter").innerHTML=m;if(q==1){$("gildenname").value=guilddata[0][1];$("gildentax").value=guilddata[0][13];$("gildentag").value=guilddata[0]["tag"];$("gildendesc").value=guilddata[0][2];var A=guilddata[0][4];var r=A.split("_");$("guildbanner_headcount").value=r[3];$("guildbanner_headcolorcount").value=r[4];$("guildbanner_bordercount").value=r[1];$("guildbanner_bordercolorcount").value=r[2];$("guildbanner_backcount").value=r[0];var a=r[3];var s=r[4];var e=r[1];var h=r[2];var n=r[0];$("bannerhead").style.backgroundImage="url("+guildbannerpath+"heads/GeneriertesBild_"+r[3]+"_"+r[4]+".png)";$("bannerborder").style.backgroundImage="url("+guildbannerpath+"borders/GeneriertesBild_"+r[1]+"_"+r[2]+".png)";$("bannerback").style.backgroundImage="url("+guildbannerpath+"backgrounds/back_"+r[0]+".jpg)"}hideDiv("buildbox");showDiv("createguildbox")}}function setBanner(d,a){var c={};c[1]={inputid:"guildbanner_headcount",imgid:"bannerhead",imgpath:"heads/GeneriertesBild_",max:23};c[2]={inputid:"guildbanner_headcolorcount",imgid:"bannerhead",imgpath:"heads/GeneriertesBild_",max:4};c[3]={inputid:"guildbanner_bordercount",imgid:"bannerborder",imgpath:"borders/GeneriertesBild_",max:4};c[4]={inputid:"guildbanner_bordercolorcount",imgid:"bannerborder",imgpath:"borders/GeneriertesBild_",max:2};c[5]={inputid:"guildbanner_backcount",imgid:"bannerback",imgpath:"backgrounds/back_",max:4};if(c[d]){var e=parseInt($(c[d].inputid).value);if(a==1){if(e>0){e--}else{e=c[d].max}}else{if(a==2){if(e<c[d].max){e++}else{e=0}}else{if(a==3){if(e>c[d].max||e<0){e=c[d].max}}}}$(c[d].inputid).value=e;if(d==1||d==2){var b=$("guildbanner_headcount").value+"_"+$("guildbanner_headcolorcount").value+".png"}if(d==3||d==4){var b=$("guildbanner_bordercount").value+"_"+$("guildbanner_bordercolorcount").value+".png"}if(d==5){var b=$("guildbanner_backcount").value+".jpg"}$(c[d].imgid).style.backgroundImage="url("+guildbannerpath+c[d].imgpath+b+")"}}function setBeauties(){var d="";var c="";if(xmastime==1){var b="xmas_inner_background6.jpg"}else{var b="inner_background6.jpg"}if(guilddata[4]){if(guilddata[4].length>15){var e=15}else{if(guilddata[4].length>6){var e=6}else{var e=0}}for(var a=e;a<guilddata[4].length;a++){if(guilddata[4][a]){d+='<div id="guildbeauty'+guilddata[4][a]+'"></div>'}if((guilddata[4][a]==4||guilddata[4][a]==11||guilddata[4][a]==12||guilddata[4][a]==13||guilddata[4][a]==15||guilddata[4][a]==18)&&stopanimation==0){d+='<div id="guildbeauty'+guilddata[4][a]+'ani"></div>'}if(guilddata[4][a]==6){if(xmastime==1){b="guild/xmas_gh_update_1_complete.jpg"}else{b="guild/gh_update_1_complete.jpg"}c=guilddata[4][a]}if(guilddata[4][a]==7){if(xmastime==1){var b="xmas_inner_background6_2.jpg"}else{var b="inner_background6_2.jpg"}c=guilddata[4][a]}if(guilddata[4][a]==16){if(xmastime==1){var b="xmas_inner_background6_3.jpg"}else{var b="inner_background6_3.jpg"}c=guilddata[4][a]}if(guilddata[4][a]>6){if(xmastime==1){$("guildquestbox").style.backgroundImage="url("+imgpath+"xmas_guildquest_plate_2.jpg)"}else{$("guildquestbox").style.backgroundImage="url("+imgpath+"guildquest_plate_2.jpg)"}$("guildquestslink").onmouseover=function(h){$("guildquestslink").style.backgroundImage="url("+imgpath+"guild/3_outline_2.gif)";showDiv("guildquestslink_tt")};$("guildquestslink").style.left="362px";$("guildquestslink").style.top="340px";$("guildstatslink").style.left="165px";$("guildstatslink").style.top="238px";$("guildstatslink_tt").style.left="238px";$("guildstatslink_tt").style.top="250px";$("guildmessageslink").style.left="184px";$("guildmessageslink").style.top="184px";$("guildmessageslink").style.height="50px";$("guildmessageslink_tt").style.left="220px";$("guildmessageslink_tt").style.top="180px"}if(guilddata[4][a]>=16){if(xmastime==1){$("guildquestbox").style.backgroundImage="url("+imgpath+"xmas_guildquest_plate_3.jpg)"}else{$("guildquestbox").style.backgroundImage="url("+imgpath+"guildquest_plate_3.jpg)"}$("guildquestslink").onmouseover=function(h){$("guildquestslink").style.backgroundImage="url("+imgpath+"guild/3_outline_3.gif)";showDiv("guildquestslink_tt")};$("guildquestslink").style.left="370px";$("guildquestslink").style.top="328px";$("guildquestslink").style.height="200px";$("guildmessageslink").style.left="165px";$("guildmessageslink").style.top="190px";$("guildstatslink").style.left="176px";$("guildstatslink").style.top="257px"}}if(c==6){d="";if(stopanimation==0){d+='<div id="guildbeauty4ani"></div>'}}if(c>=16){if(!guildquestrun){if(stopanimation==0){d+='<div id="guildquestimgani"></div>'}else{d+='<div id="guildquestimg"></div>'}}}$("guildbeauties").innerHTML=d}if(guilddata[4].length>=12&&guilddata[4].length<=15){if(xmastime==1){b="guild/xmas_gh_update_2_complete.jpg"}else{b="guild/gh_update_2_complete.jpg"}}$("guildmaincontainer").style.backgroundImage="url("+imgpath+b+")"}function closeGuildCommit(){globalcommitbox(0,guildmemberlist_closeguild_commit,"closeGuild()")}function closeGuild(){guildAction("close")}function getGuildMembers(){guildAction("getmembers")}function getGuildMembersResponse(m){var w="";var h="";var C=0;var n=0;var b=20;for(var B=0;B<m.length;B++){var D=m[B]["memberid"];var A=m[B]["unr"];var v=m[B]["status"];if(m[B]["acker"]==1&&!isSteam()){var z='&nbsp;<span class="link" onclick="window.open(\'schaugarten/index.php?mode=view&user='+A+'\')"><img src="'+imgpath+'stadt/stats_sf_black.gif" border="0"></span>'}else{var z=""}var e=showAwards(B,A,m[B]["gold"],m[B]["silber"],m[B]["bronze"]);var d="leer.gif";if(v==1){d="guild/1.gif"}if(v==2){d="guild/2.gif"}if(v==4){d="guild/no.gif"}if(setarab==1){var s="position:absolute; left:5px; top:2px;";var c="position:absolute; right:100px; top:2px; width:200px;";var a="position:absolute; top:2px; left:5px;";var E="position:absolute; left:85px; display:none;";var u="position:absolute; top:0px; width:15px; left:30px;";var r="position:absolute; top:0px; width:15px; left:15px;";var q="position:absolute; width:15px; top:0px; left:45px;"}else{var s="position:absolute; right:5px; top:2px;";var c="position:absolute; left:195px; top:2px; width:200px;";var a="position:absolute; top:2px; right:5px;";var E="position:absolute; right:85px; display:none;";var u="position:absolute; top:0px; width:15px; right:30px;";var r="position:absolute; top:0px; width:15px; right:15px;";var q="position:absolute; width:15px; top:0px; right:45px;"}if(C!=v){w+='<div class="guildmemberlist_title" style="position:absolute; top:'+n+'px;" class="memberstatus">';w+='<span id="guildmemberlisttitle_left" style="'+s+'">'+guildrank[v]+"</span>";w+='<span id="guildmemberlisttitle_right" style="'+c+'">'+guildmemberlist_jointime+"</span>";w+="</div>";n=n+b}var l="guildmemberlist_even";if(B%2>0){l="guildmemberlist_uneven"}w+='<div class="'+l+'" id="line'+B+'" style="position:absolute; width:400px; top:'+n+'px" ';w+="onmouseover=\"$('line"+B+"').style.backgroundColor='#B5AA96';\" onmouseout=\"$('line"+B+"').style.backgroundColor='transparent';\">";w+='<div class="main_float_left" style="width:15px;"><img src="'+imgpath+d+'" width="15" height="15"></div>';w+='<div class="main_float_left" style="width:180px; top:2px;">';w+='<div class="main_float_left">'+m[B]["name"]+z+"</div>";w+='<div class="main_float_left">'+e+"</div>";w+='<div style="clear:both;"></div>';w+="</div>";w+='<div class="main_float_left" style="width:100px; top:2px;">'+formatDate(m[B]["joindate"])+"</div>";w+='<div class="main_float_left" style="positon:relative; width:100px; height:15px;">';if(guilddata[1][0]!=D){w+='<div class="guildmemberlisticon1 link" style="'+u+'" ';w+='onclick="writeMessage2GuildMember('+D+",'"+m[B]["name"]+"');\" onmouseover=\"showDiv('guildmailinfo"+D+"');\" onmouseout=\"hideDiv('guildmailinfo"+D+"');\">";w+='<img src="'+imgpath+'guild/mail.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guildmailinfo'+D+'" style="'+E+" top:"+n+'px;">';h+=str_replace("%MEMBER%",m[B]["name"],guildmemberlist_sendmail);h+="</div>"}if(guilddata[1][0]==D){if(guilddata[1][2]==1||guilddata[1][2]==4){w+='<div style="'+r+'" class="guildmemberlisticon2 link" ';w+='onclick="closeGuildCommit();" onmouseover="showDiv(\'closeguild'+D+"');\" onmouseout=\"hideDiv('closeguild"+D+"');\">";w+='<img src="'+imgpath+'guild/kick.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="closeguild'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_closeguild;h+="</div>";if(guilddata[1][2]==4){w+='<div style="'+q+'" class="guildmemberlisticon3 link" ';w+='onclick="promoteProxyCallBack();" onmouseover="showDiv(\'promoteproxycallbackinfo'+D+"');\" onmouseout=\"hideDiv('promoteproxycallbackinfo"+D+"');\">";w+='<img src="'+imgpath+'guild/leave.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="promoteproxycallbackinfo'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_promoteproxy_callback;h+="</div>"}else{w+='<div style="'+q+'" class="guildmemberlisticon3 link" ';w+='onclick="promoteProxyCommit();" onmouseover="showDiv(\'promoteproxyinfo'+D+"');\" onmouseout=\"hideDiv('promoteproxyinfo"+D+"');\">";w+='<img src="'+imgpath+'guild/leave.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="promoteproxyinfo'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_promoteproxy;h+="</div>"}}else{w+='<div style="'+r+'" class="guildmemberlisticon2 link" ';w+='onclick="leaveGuildCommit();" onmouseover="showDiv(\'guildleaveinfo'+D+"');\" onmouseout=\"hideDiv('guildleaveinfo"+D+"');\">";w+='<img src="'+imgpath+'guild/leave.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guildleaveinfo'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_leave;h+="</div>"}}if(guilddata[1][2]==1||guilddata[1][2]==2||guilddata[1][2]==4){if(v!=1&&v!=4){if(v==2&&guilddata[1][2]==1){w+='<div style="'+q+'" class="guildmemberlisticon3 link" ';w+='onclick="degradeProxyCommit('+D+",'"+m[B]["name"]+"')\" onmouseover=\"showDiv('guilddegradeproxy"+D+"');\" onmouseout=\"hideDiv('guilddegradeproxy"+D+"');\">";w+='<img src="'+imgpath+'guild/degrade.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guilddegradeproxy'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_degradeproxy;h+="</div>"}if(v==3&&guilddata[1][2]==1){w+='<div style="'+q+'" class="guildmemberlisticon3 link" ';w+='onclick="degradeSuggestProxyCommit('+D+",'"+m[B]["name"]+"')\" onmouseover=\"showDiv('guilddegradesuggestproxy"+D+"');\" onmouseout=\"hideDiv('guilddegradesuggestproxy"+D+"');\">";w+='<img src="'+imgpath+'guild/degrade.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guilddegradesuggestproxy'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_degradesuggestproxy;h+="</div>"}if(v==5&&guilddata[1][2]==1){w+='<div style="'+q+'" class="guildmemberlisticon3 link" ';w+='onclick="suggestProxyCommit('+D+",'"+m[B]["name"]+"')\" onmouseover=\"showDiv('guildsetproxy"+D+"');\" onmouseout=\"hideDiv('guildsetproxy"+D+"');\">";w+='<img src="'+imgpath+'guild/suggest.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guildsetproxy'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_suggestproxy;h+="</div>"}if(v==6){w+='<div style="'+q+'" class="guildmemberlisticon3 link" ';w+='onclick="admitCandidateCommit('+D+",'"+m[B]["name"]+"');\" onmouseover=\"showDiv('guildadmitcandidate"+D+"');\" onmouseout=\"hideDiv('guildadmitcandidate"+D+"');\">";w+='<img src="'+imgpath+'guild/suggest.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guildadmitcandidate'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_allowmembership;h+="</div>"}if(v==6){w+='<div style="'+r+'" class="guildmemberlisticon2 link" ';w+='onclick="refuseCandidateCommit('+D+",'"+m[B]["name"]+"');\" onmouseover=\"showDiv('guildrefusecandidate"+D+"');\" onmouseout=\"hideDiv('guildrefusecandidate"+D+"');\">";w+='<img src="'+imgpath+'guild/kick.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guildrefusecandidate'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_refusemembership;h+="</div>"}else{var t=1;if(guilddata[1][2]==4&&v==2){t=0}if(guilddata[1][0]!=D&&t==1){w+='<div style="'+r+'" class="guildmemberlisticon2 link" ';w+='onclick="kickMemberCommit('+D+",'"+m[B]["name"]+"');\" onmouseover=\"showDiv('guildkickmember"+D+"');\" onmouseout=\"hideDiv('guildkickmember"+D+"');\">";w+='<img src="'+imgpath+'guild/kick.gif">';w+="</div>";h+='<div class="blackbox guildmemberlisticoninfo" id="guildkickmember'+D+'" style="'+E+" top:"+n+'px;">';h+=guildmemberlist_kickmember;h+="</div>"}}}}w+="</div>";w+='<div style="clear:both;"></div>';w+="</div>";C=v;n=n+b}$("guildmultiboxcontent").innerHTML=w+h}function writeMessage2GuildMember(b,a){messagesOpen(a)}function promoteProxyCommit(){var b=guildmemberlist_promoteproxy_commit;var a="promoteProxyAsk()";commitboxguild(0,b,a,1,1)}function promoteProxyAsk(){guildAction("promoteproxyask")}function promoteProxy(){guildAction("promoteproxy")}function promoteProxyReject(){guildAction("proxyreject")}function promoteProxyCallBack(){guildAction("proxycallback")}function admitCandidateCommit(c,b){var d=str_replace("%MEMBER%",b,guildinneradmitcandidatecommit);var a="handleGuildMember('admitcandidate', "+c+")";commitboxguild(0,d,a,1,1)}function refuseCandidateCommit(c,b){var d=str_replace("%MEMBER%",b,guildinnerrefusecandidatecommit);var a="handleGuildMember('refusecandidate', "+c+")";commitboxguild(0,d,a,1,1)}function kickMemberCommit(c,b){var d=str_replace("%MEMBER%",b,guildinnerkickmembercommit);var a="handleGuildMember('kickmember', "+c+")";commitboxguild(0,d,a,1,1)}function suggestProxyCommit(c,b){var d=str_replace("%MEMBER%",b,guildinnersuggestproxycommit);var a="handleGuildMember('suggestproxy', "+c+")";commitboxguild(0,d,a,1,1)}function degradeSuggestProxyCommit(b){var c=str_replace("%MEMBER%",name,guildinnerdegradesuggestproxycommit);var a="handleGuildMember('degradesuggestproxy', "+b+")";commitboxguild(0,c,a,1,1)}function degradeProxyCommit(c,b){var d=str_replace("%MEMBER%",b,guildinnerdegradeproxycommit);var a="handleGuildMember('degradeproxy', "+c+")";globalcommitbox(0,d,a)}function leaveGuildCommit(){globalcommitbox(0,guildinnerleaveguildcommit,"leaveGuild()")}function leaveGuild(){guildAction("leave")}function committedProxyGuildMember(a){handleGuildMember("commitproxy",a)}function committedProxyGuildMemberDeny(a){handleGuildMember("denyproxy",a)}function handleGuildMember(a,b){guildAction(a,{memberid:b})}function sendJoinMessage(a){guildAction("joinmessage",{guildid:a})}function openMultiBox(h){if(!h){h=1}var a="";a='<img class="link" src="'+imgpath+"button_cancel_off.png\" onclick=\"hideDiv('transp9'); hideDiv('guildmultibox');\" onmouseover=\"this.src='"+imgpath+"button_cancel_on.png';\" onmouseout=\"this.src='"+imgpath+"button_cancel_off.png';\"></div>";$("guildmultiboxheader").innerHTML=a;$("guildmultiboxcontent").innerHTML="";var e="";if(h==1){var d=guildmultibox_headline1;getGuildMembers()}else{if(h==2){var d=guildmultibox_headline2;initGuildStats(1,2,0)}else{if(h==3){var d='<div style="float:left;">'+guildmultibox_headline3+"&nbsp;</div>";if(guildmemberstatus!="6"){d+='<div style="float:right; margin-bottom:2px;" class="button" onclick="showGuildMedalcase();">'+guildmedalbox+"</div>"}d+='<div style="clear:both;"></div>';initGuildQuests(0)}else{if(h==4){var d=guildmultibox_headline4;showGuildQuestStats(1,1,0)}}}}for(var c=1;c<=4;c++){var b="leer.gif";if(c==h){b="multiscreen_reiter"+h+".jpg"}$("guildmultiboxmenue"+c).style.backgroundImage="url("+imgpath+b+")"}$("guildmultiboxheadline").innerHTML=d;hideDiv("guildnewsticker");showDiv("transp9");showDiv("guildmultibox")}function showGuildQuestStats(b,c,a){var d={type:b,page:c,self:a};guildAction("queststats",d)}function initGuildStats(c,b,a){if(b==0){$("guildstatsrankingcontent").innerHTML=""}else{var d={page:c,type:b,self:a,pagemax:guildstatspagemax};guildAction("initranking",d)}}function buildStatsResponse(v,d){var h=v[1];var n=v[2];var A="";var e="";var w=20;A+='<div style="position:absolute; top:0px; left:0px; width:400px; height:20px;" ';A+="onmouseover=\"showDiv('guildsearchoptions');\" onmouseout=\"hideDiv('guildsearchoptions');\">";A+=guildstats_search+' <input type="text" id="guildsearchterm" maxlength="15" style="border:1px solid #ddd;">&nbsp;';A+='<input type="button" onclick="searchGuild($(\'guildsearchterm\').value,0);" value="'+guildstats_searchbutton+'">';A+="</div>";A+='<div class="blackbox" style="display:none; position:absolute; top:-25px; left:75px;" id="guildsearchoptions">'+guildstats_searchoptions+"</div>";A+='<div style="position:absolute; top:30px; left:0px; width:400px; height:20px;">';A+=guildstats_sort+' <select id="guildstatsselectsort" onchange="initGuildStats(1,$(\'guildstatsselectsort\').value,0);">';A+='<option value="0">'+guildstats_sortnone+"</option>";A+='<option value="2">'+guildstats_sortpoints+"</option>";A+='<option value="3">'+guildstats_sortjointax+"</option>";A+='<option value="4">'+guildstats_sortdate+"</option>";A+="</select>";A+='&nbsp;<span class="link" onclick="initGuildStats(1,'+d+',1);">'+guildstats_sortmyguild+"</span>";A+="</div>";A+='<div id="guildstatsrankingcontent" style="position:absolute; top:65px; left:0px; width:400px;">';A+='<div style="position:absolute; top:0px; left:0px; width:400px; height:20px;" class="subheadline">';if(setarab==1){var z="position:absolute; top:2px; right:0px;";var c="position:absolute; top:2px; right:50px;";var b="position:absolute; top:2px; left:5px;";var G="position:absolute; right:0px; width:400px; height:20px;";var F="display:none; position:absolute; width:250px; right:140px;";var u="position:absolute; right:25px;";var s="position:absolute; right:100px;";var q="position:absolute; left:100px;";var m="position:absolute; left:25px;"}else{var z="position:absolute; top:2px; left:0px;";var c="position:absolute; top:2px; left:50px;";var b="position:absolute; top:2px; right:5px;";var G="position:absolute; left:0px; width:400px; height:20px;";var F="display:none; position:absolute; width:250px; left:140px;";var u="position:absolute; left:25px;";var s="position:absolute; left:100px;";var q="position:absolute; right:100px;";var m="position:absolute; right:25px;"}A+='<span class="guildstatsheadline_left" style="'+z+'">&nbsp;'+guildstats_rank+"</span>";A+='<span class="guildstatsheadline_right" style="'+c+'">'+guildstats_name+"</span>";if(d==1){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+guildstats_bar+"</span>"}if(d==2){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+guildstats_pts+"</span>"}if(d==3){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+guildstats_jointax+"</span>"}if(d==4){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+guildstats_date+"</span>"}if(d==5){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+guildstats_level+"</span>"}A+="</div>";for(var C=0;C<v[0].length;C++){var l=v[0][C];var t="";if(l[0]==1){t="rank_hightlight"}var E="";var D=(C+1);if(h>1){D=((h-1)*guildstatspagemax)+(C+1)}if(l[1]["short"]==""){var B=""}else{var B=l[1]["short"]}var a="";a+='<div><div class="guildstats_col1">'+guildstats_tt_name+'</div><div class="guildstats_col2"><b>'+l[1]["guildname"]+"</b>&nbsp;["+B+']</div><div style="clear:both;"></div></div>';a+='<div><div class="guildstats_col1">'+guildstats_tt_pts+'</div><div class="guildstats_col2">'+l[1]["guildpts"]+'</div><div style="clear:both;"></div></div>';a+='<div><div class="guildstats_col1">'+guildstats_tt_tax+'</div><div class="guildstats_col2">'+formatPrice(l[1]["joincost"])+'</div><div style="clear:both;"></div></div>';a+='<div><div class="guildstats_col1">'+guildstats_tt_members+'</div><div class="guildstats_col2">'+l[1]["members"]+'</div><div style="clear:both;"></div></div>';a+='<div><div class="guildstats_col1">'+guildstats_tt_date+'</div><div class="guildstats_col2">'+formatDate(l[1]["createguild"])+'</div><div style="clear:both;"></div></div>';a+="<div><div>"+guildstats_tt_desc+'</div><div style="width:250px; overflow:hidden;"><i>';if(l[1]["guilddescription"]){a+=l[1]["guilddescription"].substring(0,100)}a+="</i></div></div>";A+='<div class="'+t+' guildstats_line" id="line'+C+'" style="'+G+" top:"+w+"px; "+E+'" ';A+="onmouseover=\"showDiv('guildstatsinfo"+C+"'); $('line"+C+"').style.backgroundColor='#B5AA96';\" onmouseout=\"hideDiv('guildstatsinfo"+C+"'); $('line"+C+"').style.backgroundColor='transparent';\">";A+='<span class="guildstatsheadline_left" style="'+z+'">&nbsp;'+D+".</span>";A+='<span class="guildstatsheadline_right" style="'+c+'">'+l[1]["guildname"]+"&nbsp;["+l[1]["short"]+"]</span>";if(d==1){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+formatPrice(l[1]["guildbar"])+"</span>"}if(d==2){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+l[1]["guildpts"]+"</span>"}if(d==3){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+formatPrice(l[1]["joincost"])+"</span>"}if(d==4){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+formatDate(l[1]["createguild"])+"</span>"}if(d==5){A+='<span class="guildstatsheadline_right2" style="'+b+'">'+l[1]["guildlevel"]+"</span>"}A+="</div>";e+='<div class="blackbox guildstats_guildinfotooltip" style="'+F+" top:"+(w+10)+'px;" id="guildstatsinfo'+C+'" ';e+="onmouseover=\"showDiv('guildstatsinfo"+C+"');\" onmouseout=\"hideDiv('guildstatsinfo"+C+"');\">"+a+"</div>";w=w+20}if(h>1){A+='<div class="link guildstatsnavi1" style="'+u+" top:"+(w+15)+'px;" onclick="initGuildStats('+(parseInt(1))+","+d+',0)"><<<</div>'}if(h>1){A+='<div class="link guildstatsnavi2" style="'+s+" top:"+(w+15)+'px;" onclick="initGuildStats('+(parseInt(h)-parseInt(1))+","+d+',0)"><<</div>'}if((h*guildstatspagemax)<n){A+='<div class="link guildstatsnavi3" style="'+q+" top:"+(w+15)+'px;" onclick="initGuildStats('+(parseInt(h)+parseInt(1))+","+d+',0)">>></div>'}var r=Math.ceil(n/guildstatspagemax);if(r>h){A+='<div class="link guildstatsnavi4" style="'+m+" top:"+(w+15)+'px;" onclick="initGuildStats('+(parseInt(r))+","+d+',0)">>>></div>'}A+="</div>";$("guildmultiboxcontent").innerHTML=A+e;$("guildstatsselectsort").value=d}function searchGuild(b,a){var c={searchterm:b,type:a};guildAction("searchguild",c)}function searchGuildResponse(a){var d=a[1];var c="";c+="<div><hr></div>";if(a[0]==1){c+="<div><span>"+guildstats_tt_name+"</span><span>"+d[0]["guildname"]+"</span>&nbsp;["+d[0]["short"]+"]</div>";c+="<div><span>"+guildstats_tt_pts+"</span><span>"+d[0]["guildpts"]+"</span></div>";c+="<div><span>"+guildstats_tt_tax+"</span><span>"+formatPrice(d[0]["joincost"])+"</span></div>";c+="<div><span>"+guildstats_tt_members+"</span><span>"+d[0]["members"]+"</span></div>";c+="<div><span>"+guildstats_tt_date+"</span><span>"+formatDate(d[0]["createguild"])+"</span></div>";c+="<div><span>"+guildstats_tt_desc+"</span><div>"+d[0]["guilddescription"].substring(0,100)+"</div></div>"}else{if(a[0]==2){c+='<div style="margin-bottom:10px;">'+guildqueststatssearchresults+"</div>";c+='<div style="overflow:auto; height:240px;">';for(var b=0;b<d.length;b++){c+='<div class="link" style="text-decoration:underline; margin-bottom:5px;" onclick="searchGuild(\''+d[b]["guildname"]+"',1)\">"+d[b]["guildname"]+"&nbsp;["+d[b]["short"]+"]</div>"}c+="</div>"}}$("guildstatsrankingcontent").innerHTML=c;$("guildstatsselectsort").value=0}function showGuildQuestStatsResponse(C,s,u,G){var I="";var w="";I+='<div id="guildquestrankinghead">';I+=guildstats_sort+'<select id="chg_guildqueststats" onchange="showGuildQuestStats($(\'chg_guildqueststats\').value,1,0);">';I+='<option value="1">'+guildquestrankinggetallpoints+"</option>";I+='<option value="3">'+guildquestrankinggetlastpoints+"</option>";I+='<option value="2">'+guildquestrankinggetcurrentpoints+"</option>";I+='</select>&nbsp;<span class="link" style="text-decoration:underline;" onclick="showGuildQuestStats($(\'chg_guildqueststats\').value,1,1);">'+guildstats_whoiam+"</span>";I+="</div>";I+='<div class="subheadline" style="position:absolute; top:20px; left:0px; width:400px; height:20px;" id="guildquestrankingcontent">';I+='<span class="prestigeranking_1">'+guildquestrankingname+"</span>";I+='<span class="prestigeranking_2">'+guildquestrankingpoints+"</span>";I+="</div>";if(C[1]==0){I+='<div style="position:absolute; top:60px; left:0px;">'+guildstats_noentry+"</div>"}else{var K=C[1];var u=parseInt(C[3]);var t=parseInt(C[4]);var E=40;var L=14;var F="";var v=1;if(u>1){v=((u-1)*L)+1}var c=0;if(setarab==1){var h="";var e="";var b="";var a=""}else{var h="position:absolute; left:0px; top:2px; left:0px; width:25px; text-align:right;";var e="position:absolute; left:0px; top:2px; left:30px; width:115px; overflow:hidden;";var b="position:absolute; left:0px; top:2px; left:150px; width:150px;";var a="position:absolute; left:0px; top:2px; left:300px; width:100px; text-align:right;"}for(var J=0;J<K.length;J++){var d=(K[J]["p"]/t)*100;var q=(140/100)*d;if(q<1){q=2}var D="";if(K[J]["c"]==1){D='class="rank_hightlight"'}if(c==0){c=K[J]["p"];F=v+"."}else{if(K[J]["p"]<c){c=K[J]["p"];v++;F=v+"."}else{F="";v++}}if(K[J]["products"]){w+='<div class="blackbox" id="bartt'+J+'" style="display:none; position:absolute; top:'+(E+14)+'px; left:150px;" ';w+="onmouseover=\"showDiv('bartt"+J+"');\" onmouseout=\"hideDiv('bartt"+J+"');\">";if(s==2){var H=1;for(var A=0;A<=150;A++){if(K[J]["products"][A]){if(K[J]["products"][A]>0){w+='<div class="main_float_left kp'+A+'"></div>';w+='<div class="main_float_left" style="width:75px;">&nbsp;'+K[J]["products"][A]+"&nbsp;</div>";if(H==2){w+='<div style="clear:both;"></div>';H=1}else{H++}}}}}else{for(var B=0;B<K[J]["products"].length;B++){if(K[J]["products"][B]["a"]>0){w+='<div style="float:left;" class="kp'+K[J]["products"][B]["p"]+'"></div><div style="float:left;">&nbsp;'+K[J]["products"][B]["a"]+"&nbsp;</div>"}}}w+='<div style="clear:both;"></div></div>'}I+="<div "+D+' id="line'+J+'" style="position:absolute; left:0px; top:'+E+'px; width:400px; height:20px;" onmouseover="$(\'line'+J+"').style.backgroundColor='#B5AA96'; showDiv('bartt"+J+"');\" onmouseout=\"$('line"+J+"').style.backgroundColor='transparent'; hideDiv('bartt"+J+"');\">";I+='<div style="'+h+'" class="prestigetable1">'+F+"</div>";I+='<div style="'+e+'" class="prestigetable2">'+K[J]["n"]+"</div>";I+='<div style="'+b+'" class="prestigetable3">';I+='<div style="background:url('+imgpath+"stadt/percentbar.gif) top left repeat-x; height:18px; width:"+q+'px;"></div>';I+="</div>";I+='<div style="'+a+'" class="prestigetable4">'+K[J]["p"]+"</div>";I+="</div>";E=E+20}I+='<div id="guildquestrankingpagenavi" style="position:absolute; top:340px; left:0px; height:20px; width:400px;">';var z=Math.ceil(C[2]/L);var r=1;var n=1;var m=1;var l=1;if(u==z){m=0;l=0;if(z<2){r=0;n=0}}else{if(u==1){r=0;n=0;if(z==1){m=0;l=0}}}if(r==1){I+='<span class="link" style="position:absolute; left:50px;" onclick="showGuildQuestStats('+s+',1,0)"><<<</span>'}if(n==1){I+='<span class="link" style="position:absolute; left:100px;"  onclick="showGuildQuestStats('+s+","+(parseInt(u)-1)+',0)"><<</span>'}if(m==1){I+='<span class="link" style="position:absolute; right:100px;"  onclick="showGuildQuestStats('+s+","+(parseInt(u)+1)+',0)">>></span>'}if(l==1){I+='<span class="link" style="position:absolute; right:50px;"  onclick="showGuildQuestStats('+s+","+z+',0)">>>></span>'}I+="</div>"}$("guildmultiboxcontent").innerHTML=I+w;$("chg_guildqueststats").value=s}function initGuildWBW(){guildAction("initwbw")}function guildWBWShop(){guildAction("initwbwshop")}function guildWBWtrophies(){guildAction("wbwtrophies")}function guildWBWStartAll(){guildAction("startalltrucks")}function initGuildWBWResponse(a){trucks=a[1];wbwinfo=a[2];if(a[4]){guildwbwrankpoints=a[4]}else{guildwbwrankpoints=0}var b="";b+='<div style="position:absolute; top:46px; left:84px;" class="v'+wbwinfo.product+'" onmouseover="showDiv(\'guildwbwproductinfo\')" onmouseout="hideDiv(\'guildwbwproductinfo\')"></div>';b+='<div style="position:absolute; top:35px; left:120px;">'+guildwbwresttime+"</div>";b+='<div style="position:absolute; top:54px; left:120px; font-size:12px; font-weight:bold;" id="guildwbwremaintime"></div>';b+='<div style="position:absolute; top:35px; left:400px;">'+guildwbwentries+"</div>";b+='<div style="position:absolute; top:54px; left:400px; font-size:12px; font-weight:bold;" id="guildwbwrankpoints">'+guildwbwrankpoints+"</div>";b+='<div style="position:absolute; top:72px; left:400px;" id="guildwbwguildname">'+a[5]+"</div>";b+='<div id="guildwbwnavi1" onmouseover="showDiv(\'guildwbwnavi1info\')" onmouseout="hideDiv(\'guildwbwnavi1info\')" style="height:37px; left:50px; position:absolute; top:87px; width:106px;" class="link" onclick="setGuildWBWNavi(1); initGuildWBW(1);"></div>';b+='<div id="guildwbwnavi2" onmouseover="showDiv(\'guildwbwnavi2info\')" onmouseout="hideDiv(\'guildwbwnavi2info\')" style="height:37px; left:151px; position:absolute; top:88px; width:106px;" class="link" onclick="setGuildWBWNavi(2); guildWBWRanking();"></div>';b+='<div id="guildwbwnavi3" onmouseover="showDiv(\'guildwbwnavi3info\')" onmouseout="hideDiv(\'guildwbwnavi3info\')" style="height:37px; left:252px; position:absolute; top:87px; width:106px;" class="link" onclick="setGuildWBWNavi(3); guildWBWShop();"></div>';b+='<div id="guildwbwnavi1info" class="blackbox" style="display:none; position:absolute; top:60px; left:60px;">'+guildwbwnavi1+"</div>";b+='<div id="guildwbwnavi2info" class="blackbox" style="display:none; position:absolute; top:60px; left:160px;">'+guildwbwnavi2+"</div>";b+='<div id="guildwbwnavi3info" class="blackbox" style="display:none; position:absolute; top:60px; left:260px;">'+guildwbwnavi3+"</div>";b+='<div id="guildwbwproductinfo" class="blackbox" style="display:none; position:absolute; top:10px; left:80px;">'+str_replace("%PRODUCT%","<b>"+produkt_name[wbwinfo.product]+"</b>",guildwbwproduct)+"</div>";$("guildwbwheader").innerHTML=b;setGuildWBWContent(1,a[3]);setGuildWBWNavi(1);if(wbwinfo==0){$("guildwbwremaintime").innerHTML=guildwbwnocurrentwbw}showDiv("guildwbw")}function setGuildWBWNavi(a){if(a==1){$("guildwbwnavi1").style.background="url("+imgpath+"guild/trucks.jpg)";$("guildwbwnavi2").style.background="url("+imgpath+"leer.gif)";$("guildwbwnavi3").style.background="url("+imgpath+"leer.gif)"}if(a==2){$("guildwbwnavi1").style.background="url("+imgpath+"leer.gif)";$("guildwbwnavi2").style.background="url("+imgpath+"guild/ranking.jpg)";$("guildwbwnavi3").style.background="url("+imgpath+"leer.gif)"}if(a==3){$("guildwbwnavi1").style.background="url("+imgpath+"leer.gif)";$("guildwbwnavi2").style.background="url("+imgpath+"leer.gif)";$("guildwbwnavi3").style.background="url("+imgpath+"guild/shop.jpg)"}}function showGuildWBWHelpTxt(a){$("guildwbwhelpcontainercontent").innerHTML=guildwbwhelpcontent[a];showDiv("guildwbwhelpcontainertransp");showDiv("guildwbwhelpcontainer")}function stopTrucksGuildWBW(){for(var a=0;a<trucks.length;a++){var b=trucks[a]["truckid"];window.clearInterval(guildwbwtruckrunto[b]);window.clearInterval(guildwbwtruckrunback[b]);guildwbwtruckrunto[b]=0;guildwbwtruckrunback[b]=0;guildwbwtrucktimeto[b]=0;guildwbwtrucktimeback[b]=0}}function setGuildWBWContent(M,h,e,Q){guildwbwcontentstatus=M;var B="";var D="";if(M==1){if(wbwinfo.remain>0){window.clearInterval(guildwbwrun);guildwbwrun=0;guildwbwtime=0;guildwbwrun=window.setInterval("setGuildWBWTime()",1000);guildwbwtime=wbwinfo.remain}B+='<div style="margin-bottom:10px; text-align:right; width:560px;">';if(trucks.length>0&&(h==1||h==2)){B+='<button class="link" onclick="guildWBWstartAllTrucksCommit()" type="button">'+guildwbwalltrucksinfo+"</button>&nbsp;&nbsp;"}B+='<button class="link" onclick="showGuildWBWHelpTxt(1)" type="button">'+guildwbwhelp+"</button>&nbsp;&nbsp;";B+='<button class="link" onclick="guildWBWmemberRanking(1);" type="button">'+guildwbwmemberrankingproducts+"</button>";B+="</div>";if(trucks.length>0){stopTrucksGuildWBW();for(var Z=0;Z<trucks.length;Z++){var b=trucks[Z]["truckid"];var C=0;if(trucks[Z]["to"]>0){guildwbwtruckrunto[b]=window.setInterval("setGuildWBWTruckTimer("+b+","+Z+")",1000);guildwbwtrucktimeto[b]=trucks[Z]["to"]}else{if(trucks[Z]["back"]>0){guildwbwtruckrunback[b]=window.setInterval("setGuildWBWTruckTimerBack("+b+","+Z+")",1000);guildwbwtrucktimeback[b]=trucks[Z]["back"];C=1}}var a=Math.ceil(parseInt(trucks[Z]["load"]*100)/trucks[Z]["maxload"]);B+='<div id="truck'+trucks[Z]["truckid"]+'" style="position:relative; margin-top:10px; width:565px;">';var X='<div style="position:absolute; top:17px; left:101px;">';X+='<div id="guildwbwloadbar'+b+'" style="position:relative; background-Color:transparent; width:275px; height:18px; overflow:hidden; border:0px solid #000;" ';if(trucks[Z]["maxload"]>trucks[Z]["load"]&&(trucks[Z]["product"]==0||trucks[Z]["product"]==wbwinfo.product)&&trucks[Z]["time"]<guildwbwtime){X+='class="link" onclick="guildWBWsendItemsCommit('+b+","+wbwinfo.product+","+trucks[Z]["load"]+","+trucks[Z]["maxload"]+","+trucks[Z]["time"]+');"'}X+="onmouseover=\"showDiv('guildwbwbarinfo2"+b+"')\" onmouseout=\"hideDiv('guildwbwbarinfo2"+b+"')\"";X+=">";if(C==0){X+='<div style="position:absolute; background:url('+imgpath+"guild/innerbar.png) top left; width:275px; height:20px; left:-"+(parseInt((275/100*(100-a))))+'px;"></div>';X+='<div style="position:absolute; width:275px; top:3px; color:#000; text-align:center;"><b>';if(trucks[Z]["load"]==0){X+=guildwbwamountbarempty}else{X+=trucks[Z]["load"]+"/"+trucks[Z]["maxload"]}if(trucks[Z]["product"]>0&&trucks[Z]["product"]!=wbwinfo.product){X+='&nbsp;<span style="font-weight:bold; color:#f00;">'+guildwbwwrongproduct+"</span>"}X+="</b></div>"}X+="</div>";X+="</div>";B+='<div style="position:relative; height:65px; width:565px;">';B+='<div style="position:absolute; top:10px; left:75px; width:409px; height:52px; background:url('+imgpath+'guild/guildwbw_bar.png) top left no-repeat;">';if(trucks[Z]["product"]>0){B+="<div onmouseover=\"showDiv('guildwbwbarinfo"+b+"')\" onmouseout=\"hideDiv('guildwbwbarinfo"+b+'\')" class="v'+trucks[Z]["product"]+'" style="position:absolute; top:11px; left:36px; width:30px;"></div>'}else{B+='<div style="position:absolute; top:11px; left:36px; width:30px;">&nbsp;</div>'}B+='<div id="guildwbwbarinfo'+b+'" class="blackbox" style="display:none; position:absolute; top:-20px; left:35px;">'+str_replace("%PRODUCT%","<b>"+produkt_name[trucks[Z]["product"]]+"</b>",guildwbwtruckbarinfo)+"</div>";var v=str_replace("%AMOUNT%","<b>"+trucks[Z]["load"]+"</b>",guildwbwtruckbarinfo2);v=str_replace("%MAX%","<b>"+trucks[Z]["maxload"]+"</b>",v);if(trucks[Z]["load"]<trucks[Z]["maxload"]&&trucks[Z]["time"]<guildwbwtime){if((trucks[Z]["load"]>0&&trucks[Z]["product"]==wbwinfo.product)||trucks[Z]["load"]==0){v+="<br>"+guildwbwtruckbarinfo2click}}B+='<div id="guildwbwbarinfo2'+b+'" class="blackbox" style="display:none; position:absolute; top:-20px; left:100px;">'+v+"</div>";B+=X;B+="</div>";B+='<div style="position:absolute; top:0px; left:10px;"><img src="'+imgpath+"guild/truck"+trucks[Z]["type"]+'.png" border="0"></div>';if((h==1||h==2)&&trucks[Z]["time"]<guildwbwtime){if(!(trucks[Z]["back"]>0||trucks[Z]["to"]>0)){if(trucks[Z]["load"]>0&&trucks[Z]["product"]==wbwinfo.product){B+='<div id="guildwbwgotruck'+b+'" class="link" style="position:absolute; right:40px; top:20px; width:35px; height:35px; background:url('+imgpath+'guild/go.png) top left no-repeat;" onclick="guildWBWstartTruckCommit('+b+","+trucks[Z]["time"]+');" onmouseover="showDiv(\'guildwbwgoinfo'+Z+"')\" onmouseout=\"hideDiv('guildwbwgoinfo"+Z+"')\"></div>"}}}if(h==1||h==2){if(!(trucks[Z]["back"]>0||trucks[Z]["to"]>0)){if(trucks[Z]["load"]>0){B+='<div id="guildwbwcleartruck'+b+'" class="link" style="position:absolute; right:0px; top:20px; width:35px; height:35px; background:url('+imgpath+'guild/clear.png) top left no-repeat;" onclick="guildWBWclearTruckCommit('+b+')" onmouseover="showDiv(\'guildwbwclearinfo'+Z+"')\" onmouseout=\"hideDiv('guildwbwclearinfo"+Z+"')\"></div>"}}}B+='<div id="guildwbwclearinfo'+Z+'" class="blackbox" style="display:none; position:absolute; top:-10px; right:0px;">'+guildwbwbuttonclear+"</div>";B+='<div id="guildwbwgoinfo'+Z+'" class="blackbox" style="display:none; position:absolute; top:-10px; right:0px;">'+guildwbwbuttongo+"</div>";B+='<div id="guildwbwcallbackinfo'+Z+'" class="blackbox" style="display:none; position:absolute; top:-10px; right:0px;">'+guildwbwbuttoncallback+"</div>";B+="</div>";B+='<div style="margin-left:120px; position:relative;">';B+='<span id="guildwbwshowtimetext'+b+'">'+guildwbwtimetxt+"</span>";B+='<span style="font-weight:bold" id="guildwbwshowtime'+b+'">'+formatTime(trucks[Z]["time"])+"</span>";B+="<br><span>"+str_replace("%COUNT%",((trucks[Z]["durability"]-trucks[Z]["rideid"])+1),guildwbwdurability)+"</span>";if(trucks[Z]["entries"]){var R=trucks[Z]["entries"];if(R.length>0){B+="<div onclick=\"showGuildWBWEntries('entries', "+Z+');" class="link">';B+='<div style="float:left;"><img id="entries'+Z+'img" src="'+imgpath+'guild/plus.gif" border="0"></div>';B+='<div style="float:left; position:relative; top:1px;">&nbsp;'+guildwbwmemberlist+"</div>";B+='<div style="clear:both;"></div>';B+="</div>"}B+='<div id="guildwbwentries'+Z+'" style="display:none; width:410px;">';for(var U=0;U<R.length;U++){B+='<div style="float:left; width:200px;">'+R[U]["uname"]+"</div>";B+='<div style="float:left; width:200px;">'+R[U]["sum"]+"</div>";B+='<div style="clear:both;"></div>'}B+="</div>"}B+="</div>";B+="</div>"}}else{B+='<div style="margin-left:10px; width:570px;">'+guildwbwnovehiclesinfo+"<br><br>";B+='<button type="button" onclick="setGuildWBWNavi(3); guildWBWShop();">'+guildwbwnovehiclesinfo2+"</button></div>"}}if(M==2){stopTrucksGuildWBW();var O=0;var J=1;var c=0;var w=new Array;if(guildwbwranking!="no"){var aa="";aa+='<div style="position:relative; margin-bottom:10px;">';aa+='<div class="kp'+wbwinfo.product+'" style="float:left; width:15px; height:15px;"></div>';aa+='<div style="float:left; margin-top:1px;">&nbsp;<b>'+produkt_name[wbwinfo.product]+"</b></div>";aa+='<div style="clear:both;"></div>';aa+="</div>";aa+="<div>"+t_stadt_wettbewerb_beginn+"&nbsp;<b>"+wbwinfo.formatstart+"</b></div>";aa+='<div style="margin-bottom:10px;">'+t_stadt_wettbewerb_ende+"&nbsp;<b>"+wbwinfo.formatend+"</b></div>";$("globalwbwdata").innerHTML=aa}B+='<div style="width:500px; margin-top:10px;">';B+='<div class="guildwbwrankingline_rank">'+guildwbwrankingrank+"</div>";B+='<div class="guildwbwrankingline_name">'+guildwbwrankingguildname+"</div>";B+='<div class="guildwbwrankingline_server">'+guildwbwrankingserver+"</div>";B+='<div class="guildwbwrankingline_sum">'+guildwbwrankingamount+"</div>";B+='<div style="clear:both;"></div>';B+="</div>";if(guildwbwranking=="no"){B+='<div style="margin-left:10px; text-align:center; padding-top:25px; font-weight:normal; width:500px;">'+guildwbwnocurrentwbw+"</div>"}else{for(var Z=0;Z<guildwbwranking.length;Z++){if(e>0){if(e==guildwbwranking[Z]["server"]){var z=1}else{var z=0}}else{var z=1}if(O==0){O=guildwbwranking[Z]["amountsum"];var I=J+"."}else{if(O==guildwbwranking[Z]["amountsum"]){if(e>0){var I=J+"."}else{var I="&nbsp;"}}else{J++;var I=J+".";O=guildwbwranking[Z]["amountsum"]}}if(z==1){if(guildwbwranking[Z]["self"]==1){c=1;d="color:#f00; font-weight:bold;"}else{d=""}if(Z%2==0){var F="transparent"}else{var F="transparent"}B+='<div style="width:500px; padding-top:2px; padding-bottom:2px; background-color:'+F+'" id="guildwbwrankingline'+Z+'" ';B+="onmouseover=\"this.style.backgroundColor='#D8B57D'\" onmouseout=\"this.style.backgroundColor='transparent'\"";B+=">";if(guildwbwranking[Z]["self"]==1){B+='<a name="ownguild"></a>'}B+='<div class="guildwbwrankingline_rank" style="'+d+'">'+I+"</div>";B+='<div class="guildwbwrankingline_name" style="'+d+'">'+guildwbwranking[Z]["guildname"]+"</div>";B+='<div class="guildwbwrankingline_server" style="'+d+'">'+guildwbwranking[Z]["server"]+"</div>";B+='<div class="guildwbwrankingline_sum" style="'+d+'">'+guildwbwranking[Z]["amountsum"]+"</div>";B+='<div style="clear:both;"></div>';B+="</div>"}w[guildwbwranking[Z]["server"]]=1}}var l="";if(Q==1){selectname="guildwbwserversortpublic"}else{selectname="guildwbwserversort"}l+=guildwbwrankingsorthead+'<select id="'+selectname+'" onchange="showGuildWBWRankingSortByServer(\''+selectname+"',"+h+","+Q+')">';l+="<option>"+guildwbwrankingsortall+"</option>";for(var Z=0;Z<50;Z++){if(w[Z]){var d="";if(e==Z){var d="selected"}l+='<option value="'+Z+'" '+d+">"+str_replace("%NUMBER%",Z,guildwbwrankingsortserver)+"</option>"}}l+="</select>";if(Q!=1){if(c==1){l+='&nbsp;<button type="button" onclick="showOwnGuild()">'+guildwbwrankingsortownguild+"</button>"}}l+='&nbsp;<button class="link" onclick="guildWBWHallOfFame('+Q+')" type="button">'+guildwbwstatslink1+"</button>";B=l+'<div style="height:350px;">'+B+"</div>"}if(M==3){B+='<div style="margin-bottom:10px; text-align:right; width:560px;">';B+='<button class="link" onclick="showGuildWBWHelpTxt(4)" type="button">'+guildwbwhelp+"</button>&nbsp;&nbsp;";B+='<button class="link" onclick="guildWBWmemberRanking(2);" type="button">'+guildwbwmemberrankinghar+"</button>";B+="</div>";stopTrucksGuildWBW();for(var Z=1;Z<20;Z++){if(shopdata[Z]){B+='<div style="margin-left:10px; margin-bottom:10px; width:550px; margin-right:10px;" ';B+=">";B+='<div class="main_float_left" style="position:relative; width:335px; height:145px;">';B+='<img src="'+imgpath+"guild/truck"+Z+'_shop.gif" border="0">';B+='<div style="position:absolute; top:86px; text-align:center; width:97px; left:223px; color:#f00; font-weight:bold; font-size:10px;">'+formatPrice(shopdata[Z][4])+"</div>";B+="</div>";B+='<div class="main_float_left" id="guildwbwshoptruckinfo">';B+='<div style="margin-top:0px; margin-bottom:5px;" onmouseover="showDiv(\'guildWBWdrivetimeinfo'+Z+"')\" onmouseout=\"hideDiv('guildWBWdrivetimeinfo"+Z+"')\">";B+='<div class="main_float_left" style="background:url('+imgpath+'guild/time.png) top left no-repeat; width:37px; height:34px;"></div>';B+='<div class="main_float_left" style="position:relative; top:10px;">&nbsp;'+formatTime(shopdata[Z][0])+'</div><div style="clear:both;"></div>';B+='<div id="guildWBWdrivetimeinfo'+Z+'" class="blackbox guildshopinfo_drivetime">'+str_replace("%TIME%",formatTime(shopdata[Z][0]),guildwbwshoptruckdrivetime)+"</div>";B+="</div>";B+='<div style="margin-bottom:5px;" onmouseover="showDiv(\'guildWBWdrivesinfo'+Z+"')\" onmouseout=\"hideDiv('guildWBWdrivesinfo"+Z+"')\">";B+='<div class="main_float_left" style="background:url('+imgpath+'guild/space.png) top left no-repeat; width:37px; height:34px;"></div>';B+='<div class="main_float_left" style="position:relative; top:10px;">&nbsp;'+shopdata[Z][1]+'</div><div style="clear:both;"></div>';B+='<div id="guildWBWdrivesinfo'+Z+'" class="blackbox guildshopinfo_drives">'+str_replace("%AMOUNT%",shopdata[Z][1],guildwbwshoptruckload)+"</div>";B+="</div>";B+='<div style="margin-bottom:5px;" onmouseover="showDiv(\'guildWBWloadinfo'+Z+"')\" onmouseout=\"hideDiv('guildWBWloadinfo"+Z+"')\">";B+='<div class="main_float_left" style="background:url('+imgpath+'guild/drives.png) top left no-repeat; width:37px; height:34px;"></div>';B+='<div class="main_float_left" style="position:relative; top:10px;">&nbsp;'+shopdata[Z][2]+'</div><div style="clear:both;"></div>';B+='<div id="guildWBWloadinfo'+Z+'" class="blackbox guildshopinfo_load">'+str_replace("%AMOUNT%",shopdata[Z][2],guildwbwshoptruckdrives)+"</div>";B+="</div>";if(shopdata[Z]["active"]==0){B+='<div style="position:absolute; width:200px; top:120px; font-weight:bold; color:#f00;">'+str_replace("%QUEST%",shopdata[Z][3],guildwbwdshoptruckminquest)+"</div>"}var E=0;var R="";if(shopdata[Z]["entries"]){for(var Y=0;Y<=shopdata[Z]["entries"]["name"].length;Y++){if(shopdata[Z]["entries"]["amount"][Y]>0){R+='<div class="main_float_left" style="width:120px;">'+shopdata[Z]["entries"]["name"][Y]+"</div>";R+='<div id="" class="main_float_left guildshopinfo_entriesamount">'+shopdata[Z]["entries"]["amount"][Y]+"</div>";R+='<div style="clear:both;"></div>';E=(parseInt(E)+parseInt(shopdata[Z]["entries"]["amount"][Y]))}}}if(R!=""){B+='<div style="margin-top:5px;">';B+='<div class="main_float_left"><img class="link" src="'+imgpath+'guild/plus.gif" id="entriesshop'+Z+"img\" onclick=\"showGuildWBWEntries('shopentries', "+Z+')"></div>';B+='<div class="main_float_left" style="position:relative; top:1px;">&nbsp;'+guildwbwshopdonators+"</div>";B+='<div style="clear:both;"></div>';B+='<div style="display:none;" id="guildwbwshopentries'+Z+'">'+R+"</div>";B+="</div>"}B+="</div>";var a=Math.ceil(parseInt(E*100)/shopdata[Z][4]);var n='<div class="link" style="position:relative;" ';n+='onclick="guildWBWShopDonateCommit('+Z+","+E+","+shopdata[Z][4]+')" ';n+="onmouseover=\"showDiv('guildwbwdonatebarinfo"+Z+"')\" onmouseout=\"hideDiv('guildwbwdonatebarinfo"+Z+"')\">";n+='<div style="position:absolute; left:5px; top:10px; overflow:hidden; width:20px; height:100px;">';n+='<div style="position:absolute; left:0px; background-color:#f00; width:20px; height:100px; top:'+(parseInt((100/100*(100-a))))+'px;"></div>';n+="</div>";n+='<div style="position:absolute; top:0px; left:0px; background:url('+imgpath+'guild/donate_bar.png) top left no-repeat; width:31px; height:142px;"></div>';n+="</div>";var v=str_replace("%COST%","<b>"+formatPrice(shopdata[Z][4])+"</b>",guildwbwdshopdonatebarinfo);v=str_replace("%PAID%","<b>"+formatPrice(E)+"</b>",v);if(shopdata[Z]["active"]==1){B+='<div class="main_float_left" style="position:relative;">';B+=n;B+='<div id="guildwbwdonatebarinfo'+Z+'" class="blackbox guildshopdonatebarinfo">'+v+"</div>";B+="</div>"}B+='<div style="clear:both;"></div>';B+="</div>"}}}if(M==4){stopTrucksGuildWBW();B+='<div style="margin-bottom:10px; text-align:right; width:560px;">';if(guildwbwuserranking[0]){if(guildwbwuserranking[0]["prestige"]){B+='<button class="link" onclick="showGuildWBWHelpTxt(2)" type="button">'+guildwbwhelp+"</button>&nbsp;&nbsp;";var G="initGuildWBW(1)"}else{if(guildwbwuserranking[0]["donatesum"]){B+='<button class="link" onclick="showGuildWBWHelpTxt(3)" type="button">'+guildwbwhelp+"</button>&nbsp;&nbsp;";var G="guildWBWShop()"}}}else{var G="initGuildWBW(1)"}B+='<button class="link" onclick="'+G+'" type="button">'+guildwbwmemberrankingback+"</button>";B+="</div>";if(guildwbwuserranking[0]){if(guildwbwuserranking[0]["prestige"]){var H=guildwbwuserranking[0]["prestige"];var A=guildwbwrankingglobalprestige}if(guildwbwuserranking[0]["donatesum"]){var H=guildwbwuserranking[0]["donatesum"];var A=guildwbwrankingglobalbar}var q=0;var t=45;var S=250;var V=Math.ceil(S/H);var L=0;var J=1;var m=0;B+='<div style="font-weight:bold;">';B+='<div class="main_float_left guildwbwmemberranking_rank">'+guildwbwrankingrank+"</div>";B+='<div class="main_float_left guildwbwmemberranking_name">'+guildwbwrankingmember+"</div>";B+='<div class="main_float_left guildwbwmemberranking_graph" style="width:150px;">&nbsp;</div>';B+='<div class="main_float_left guildwbwmemberranking_amount" style="width:220px;">'+A+"</div>";B+='<div style="clear:both;"></div>';B+="</div>";for(var Z=0;Z<guildwbwuserranking.length;Z++){if(guildwbwuserranking[0]["prestige"]){m=guildwbwuserranking[Z]["prestige"]}if(guildwbwuserranking[0]["donatesum"]){m=guildwbwuserranking[Z]["donatesum"]}if(Z>0&&parseInt(L)>parseInt(m)){S=Math.ceil(Math.ceil((m*100)/H)*V)}if(Z==0){L=m;I=J+"."}else{if(parseInt(L)>parseInt(m)){L=m;I=J+"."}else{I="&nbsp;"}}if(setarab==1){var s="right"}else{var s="left"}B+='<div style="position:absolute; top:'+t+"px; padding-top:2px; padding-bottom:2px; "+s+":"+q+'px;" onmouseover="this.style.backgroundColor=\'#D8B57D\'" onmouseout="this.style.backgroundColor=\'transparent\'">';B+='<div class="main_float_left guildwbwmemberranking_rank">'+I+"</div>";B+='<div class="main_float_left guildwbwmemberranking_name">'+guildwbwuserranking[Z]["uname"]+"</div>";B+='<div class="main_float_left guildwbwmemberranking_graph" ';if(guildwbwuserranking[0]["prestige"]){B+="onmouseover=\"showDiv('guildwbwuserrankingproductinfo"+Z+"')\" onmouseout=\"hideDiv('guildwbwuserrankingproductinfo"+Z+"')\""}B+=">";B+='<div style="height:18px; background:url('+imgpath+"guild/percentbar.gif) top left repeat-x; width:"+S+'px;"></div>';B+="</div>";B+='<div class="main_float_left guildwbwmemberranking_amount">'+m;if(guildwbwuserranking[0]["donatesum"]){B+="&nbsp;"+gamecurrency}B+="</div>";B+='<div style="clear:both;"></div>';B+="</div>";if(guildwbwuserranking[0]["prestige"]){D+='<div id="guildwbwuserrankingproductinfo'+Z+'" class="blackbox" style="position:absolute; left:'+(q+180)+"px; top:"+(t+20)+'px; display:none; z-index:100; width:250px;">';for(var U=0;U<guildwbwuserranking[Z]["entries"].length;U++){if(U%2==0&&U>0){D+='<div style="clear:both;"></div>'}D+='<div class="main_float_left" style="margin-bottom:2px;">';D+='<div class="kp'+guildwbwuserranking[Z]["entries"][U][0]+' main_float_left" style="width:15px;"></div>';D+='<div class="main_float_left" style="width:100px;">&nbsp;'+guildwbwuserranking[Z]["entries"][U][1]+"</div>";D+='<div style="clear:both;"></div>';D+="</div>"}D+='<div style="clear:both;"></div>';D+="</div>"}t=(t+20);J++}}}if(M==5){stopTrucksGuildWBW();var K="";K+='<button style="position:absolute; top:0px; right:10px;" class="link" onclick="guildWBWRanking('+Q+')">'+guildwbwstatslink2+"</button>";K+='<div style="margin-top:25px; margin-left:10px;">';if(guildwbw_alltime){var L=0;var J=0;K+='<div class="main_float_left" style="width:25px; text-align:right;">&nbsp;</div>';K+='<div class="main_float_left" style="width:200px; margin-left:5px; font-weight:bold;">'+guildwbwrankingguildname+"</div>";K+='<div class="main_float_left" style="width:75px; margin-left:5px; font-weight:bold; text-align:left;">'+guildwbwrankingserver+"</div>";K+='<img class="main_float_left" style="margin:0px 15px;" src="'+imgpath+'guild/gold.gif" border="0">';K+='<img class="main_float_left" style="margin:0px 15px;"  src="'+imgpath+'guild/silber.gif" border="0">';K+='<img class="main_float_left" style="margin:0px 15px;"  src="'+imgpath+'guild/bronze.gif" border="0">';K+='<img class="main_float_left" style="margin:0px 15px;"  src="'+imgpath+'guild/serversieger.gif" border="0">';K+='<div style="clear:both;"></div>';for(var Z in guildwbw_alltime){var u="&nbsp;";if(L!=guildwbw_alltime[Z]["i"]){J++;u=J+"."}K+='<div class="guild_halloffame_line">';K+='  <div class="main_float_left" style="width:25px; text-align:right;">'+u+"</div>";K+='  <div class="main_float_left" style="width:200px; margin-left:5px;">'+guildwbw_alltime[Z]["name"]+"</div>";K+='  <div class="main_float_left" style="width:75px; margin-left:5px; text-align:left;">'+guildwbw_alltime[Z]["server"]+"</div>";var T=["g","s","b","w"];for(var Y=0;Y<T.length;Y++){var m=0;if(guildwbw_alltime[Z][T[Y]]){m=guildwbw_alltime[Z][T[Y]]}K+='<div class="main_float_left" style="width:45px; text-align:center;">'+m+"</div>"}K+='  <div style="clear:both;"></div>';K+="</div>";L=guildwbw_alltime[Z]["i"]}}if(guildwbw_hof_global){var P=[{trophy:"gold",data:guildwbw_hof_global},{trophy:"silber",data:guildwbw_hof_second},{trophy:"bronze",data:guildwbw_hof_third},{trophy:"gold",data:guildwbw_hof_server}];K+='<div style="margin-top:10px;">';for(var Z=0;Z<guildwbw_hof_global.length;Z++){var l=str_replace("%START%","<b>"+guildwbw_hof_data[Z][0][0]+"</b>",guildwbwhalloffameheader);l=str_replace("%END%","<b>"+guildwbw_hof_data[Z][0][1]+"</b>",l);K+='<div style="margin-bottom:20px;">';K+='  <div class="main_float_left kp'+guildwbw_hof_data[Z][0][2]+'" style="margin-right:5px;"></div>';K+='  <div class="main_float_left">'+l+"</div>";K+='  <div class="clear"></div>';K+='  <div class="main_float_left" style="width:315px; font-weight:bold;">'+guildwbwrankingguildname+"</div>";K+='  <div class="main_float_left" style="width:50px; font-weight:bold;">'+guildwbwrankingserver+"</div>";K+='  <div class="main_float_left guildwbwrankingamount" style="font-weight:bold;">'+guildwbwrankingamount+"</div>";K+='  <div class="clear"></div>';var r="";for(var W=0;W<P.length;W++){var ab=P[W].data;for(var N=1;N<=30;N++){if(ab[Z][N]){for(var Y=0;Y<ab[Z][N].length;Y++){if(W==3){r+=htmlGuildWBWHallOfFameItem(P[W].trophy,ab[Z][N][Y][0],N,ab[Z][N][Y][1])}else{K+=htmlGuildWBWHallOfFameItem(P[W].trophy,ab[Z][N][Y][0],N,ab[Z][N][Y][1])}}}}}K+='  <img class="main_float_left link" style="margin-right:5px;" id="serverwinnerimg'+Z+'" src="'+imgpath+'guild/plus.gif" border="0" onclick="showGuildWBWEntries(\'serverwinner\', '+Z+')">';K+='  <div class="main_float_left">'+guildwbwhalloffameserver+"</div>";K+='  <div class="clear"></div>';K+='  <div style="display:none;" id="guildwbwhofserver'+Z+'">'+r+"</div>";K+="</div>"}K+="</div>"}K+="</div>";B=K}if((M==2||M==5)&&Q==1){$("globalwbwranking").innerHTML=B+D}else{$("guildwbwcontent").innerHTML=B+D}}function htmlGuildWBWHallOfFameItem(d,a,e,c){var b="";b+='<div class="guild_halloffame_line">';b+='  <img class="main_float_left" src="'+imgpath+"guild/"+d+'.gif">';b+='  <div class="main_float_left" style="width:300px; margin-top:1px;">'+a+"</div>";b+='  <div class="main_float_left" style="width:50px;">'+e+"</div>";b+='  <div class="main_float_left" style="text-align:right; width:100px;">'+c+"</div>";b+='  <div class="clear"></div>';b+="</div>";return b}function showGuildWBWEntries(b,c){var a={};a.serverwinner={div:"guildwbwhofserver",img:"serverwinnerimg"+c};a.shopentries={div:"guildwbwshopentries",img:"entriesshop"+c+"img"};a.entries={div:"guildwbwentries",img:"entries"+c+"img"};if(a[b]){if($(a[b].div+c).style.display=="block"){$(a[b].div+c).style.display="none";$(a[b].img).src=imgpath+"guild/plus.gif"}else{$(a[b].div+c).style.display="block";$(a[b].img).src=imgpath+"guild/minus.gif"}}}function showOwnGuild(){location.hash="#ownguild"}function showGuildWBWRankingSortByServer(c,a,b){setGuildWBWContent(2,a,$(c).value,b)}function setGuildWBWTruckTimer(a,b){if(guildwbwtrucktimeto[a]>0){if($("guildwbwloadbar"+a)){$("guildwbwloadbar"+a).onclick=function(c){}}$("guildwbwbarinfo2"+a).innerHTML=guildwbwenroute;guildwbwtrucktimeto[a]=(guildwbwtrucktimeto[a]-1);if(guildwbwtrucktimeto[a]<=0){window.clearInterval(guildwbwtruckrunto[a]);guildwbwtruckrunto[a]=0;guildwbwtrucktimeto[a]=0;if(guildwbwtrucktimeto[a]==0){window.clearInterval(guildwbwtruckrunback[a]);guildwbwtruckrunback[a]=0;guildwbwtrucktimeback[a]=0;if(trucks[b]["back"]>0){$("guildwbwloadbar"+a).innerHTML='<div style="width:275px; text-align:center; font-weight:bold;">'+guildwbwproductssend+"</div>";guildwbwtruckrunback[a]=window.setInterval("setGuildWBWTruckTimerBack("+a+")",1000);guildwbwtrucktimeback[a]=trucks[b]["back"]}}}else{$("guildwbwshowtimetext"+a).innerHTML=guildwbwtime2target;$("guildwbwshowtime"+a).innerHTML=formatTime(guildwbwtrucktimeto[a])}}}function setGuildWBWTruckTimerBack(a){if(guildwbwtrucktimeback[a]>0){$("guildwbwloadbar"+a).innerHTML='<div style="width:275px; text-align:center; font-weight:bold;">'+guildwbwproductssend+"</div>";$("guildwbwloadbar"+a).onclick=function(b){};$("guildwbwbarinfo2"+a).innerHTML=guildwbwenroute;guildwbwtrucktimeback[a]=(guildwbwtrucktimeback[a]-1);if(guildwbwtrucktimeback[a]<=0){window.clearInterval(guildwbwtruckrunback[a]);guildwbwtruckrunback[a]=0;guildwbwtrucktimeback[a]=0;initGuildWBW()}else{$("guildwbwshowtimetext"+a).innerHTML=guildwbwtime4back;$("guildwbwshowtime"+a).innerHTML=formatTime(guildwbwtrucktimeback[a])}}}function setGuildWBWTime(){if(guildwbwtime>0){guildwbwtime=(guildwbwtime-1);if(guildwbwtime<=0){window.clearInterval(guildwbwrun);poweruprun[a]=0;poweruptime[a]=0}else{if(guildwbwcontentstatus==1){for(var a=0;a<trucks.length;a++){if(trucks[a]["time"]>guildwbwtime){$("guildwbwshowtimetext"+trucks[a]["truckid"]).innerHTML=guildwbwtruckimpossible;$("guildwbwshowtime"+trucks[a]["truckid"]).innerHTML="";hideDiv("guildwbwgotruck"+trucks[a]["truckid"])}else{if(!guildwbwtruckrunto[trucks[a]["truckid"]]&&!guildwbwtruckrunback[trucks[a]["truckid"]]){$("guildwbwshowtime"+trucks[a]["truckid"]).innerHTML=formatTime(trucks[a]["time"])}}}}$("guildwbwremaintime").innerHTML=formatTime(guildwbwtime)}}}function guildWBWclearTruckCommit(b){var a="guildWBWclearTruck("+b+");";var c=guildwbwtruckclearcontent;globalcommitbox(guildwbwtruckclearhead,c,a)}function guildWBWclearTruck(a){var b={truckid:a};guildAction("cleartruck",b)}function guildWBWCallbackTruckCommit(b){var a="guildWBWCallbackTruck("+b+");";var c=guildwbwtruckcallbackcontent;globalcommitbox(guildwbwtruckcallbackhead,c,a)}function guildWBWCallbackTruck(a){var b={truckid:a};guildAction("callbacktruck",b)}function guildWBWsendItemsCommit(c,e,l,b,h){if(checkRackItem(e)>0){var a="guildWBWsendItemsCommit2("+c+");";var d="<div>"+guildwbwtruckentrycontent+"</div>";d+='<div class="kp'+e+'" style="float:left; width:15px;"></div>';d+='<div style="float:left; width:100px;">';d+='<input maxlength="6" size="15" type="text" id="guildwbwentry" value="0" onchange="calcCurrentLoad('+e+","+l+","+b+');" onkeyup="calcCurrentLoad('+e+","+l+","+b+');">';d+="</div>";d+='<div style="clear:both;"></div>';d+=guildwbwtruckcurrent+'<span id="guildwbwcurrentload">'+l+"</span>&nbsp;/&nbsp;"+guildwbwtruckmax+b;globalcommitbox(guildwbwtruckentryhead,d,a);$("guildwbwentry").focus()}else{var d="";d+='<div class="kp'+e+'" style="float:left; width:15px;"></div>';d+='<div style="float:left;">&nbsp;'+produkt_name[e]+"</div>";d+='<div style="clear:both;"></div>';d+="<div>"+guildquest_addproduct_none+"</div>";globalerrorbox(d)}}function calcCurrentLoad(c,h,b){h=parseInt(h);b=parseInt(b);var a=$("guildwbwentry").value;if(a){if(!isNumeric(a)){a=1}a=parseInt(a);var e=checkRackItem(c);if(a>e){a=e}var d=parseInt(b-h);if(a>d){a=d}$("guildwbwcurrentload").innerHTML=(parseInt(h)+parseInt(a));$("guildwbwentry").value=a}else{$("guildwbwcurrentload").innerHTML=h}}function guildWBWsendItemsCommit2(c){var b=$("guildwbwentry").value;if(b>0){var a="guildWBWsendItems("+c+","+b+");";var d=guildwbwtruckentrycontent2;globalcommitbox(guildwbwtruckentryhead2,d,a)}else{$("guildwbwentry").focus();return false}}function guildWBWsendItems(b,a){if(a){var c={truckid:b,amount:a};guildAction("wbwsenditems",c)}else{return false}}function guildWBWstartTruckCommit(b,d){var a="guildWBWstartTruck("+b+");";var c="<div>"+str_replace("%TIME%","<b>"+formatTime(d)+"</b>",guildwbwtruckgocontent)+"</div>";globalcommitbox(guildwbwtruckgohead,c,a)}function guildWBWstartTruck(a){var b={truckid:a};guildAction("starttruck",b)}function guildWBWRanking(b){var a={"public":b};guildAction("wbwranking",a)}function guildWBWRankingResponse(a,b){guildwbwranking=a[1];if(b==1){wbwinfo=a[4]}setGuildWBWContent(2,a[2],0,b)}function guildWBWShopDonateCommit(c,e,a){var b="guildWBWShopDonateCommit2("+c+","+a+");";var d="<div>"+guildwbwtruckcontent+"</div>";d+='<div style="float:left; width:15px;"><img src="'+imgpath+'money.gif" border="0" width="15" height="15"></div>';d+='<div style="float:left; width:150px;">';d+='<input maxlength="7" size="15" type="text" id="guildwbwshopdonateentry" value="0" onchange="calcCurrentShopDonate('+e+","+a+');" onkeyup="calcCurrentShopDonate('+e+","+a+');">'+gamecurrency;d+="</div>";d+='<div style="clear:both;"></div>';d+=guildwbwtruckcurrent+'<span id="guildwbwcurrentdonateentry">'+formatPrice(e)+"</span><br>"+guildwbwtruckmax+formatPrice(a);globalcommitbox(guildwbwtruckhead,d,b);$("guildwbwshopdonateentry").focus()}function guildWBWShopDonateCommit2(d,a){var c=$("guildwbwshopdonateentry").value;if(c>0){var b="guildWBWDonate("+d+","+c+","+a+");";var e=str_replace("%AMOUNT%","<b>"+formatPrice(c)+"</b>",guildwbwtruckcontent2);globalcommitbox(guildwbwtruckhead2,e,b)}else{return false}}function calcCurrentShopDonate(d,a){var b=$("guildwbwshopdonateentry").value;if(b){if(!isNumeric(b)){b=1}b=parseInt(b);var c=parseInt(a-d);if(b>c){b=c}$("guildwbwcurrentdonateentry").innerHTML=formatPrice(parseInt(d+b));$("guildwbwshopdonateentry").value=b}else{$("guildwbwcurrentdonateentry").innerHTML=formatPrice(d)}}function guildWBWDonate(c,b,a){if(b>0){var d={type:c,amount:b};guildAction("wbwshopdonate",d)}else{return false}}function guildWBWDonateResponse(a){if(a[1]==1){globalerrorbox(guildwbwdshopboughtinfo);initGuildWBW()}else{globalerrorbox(str_replace("%REST%","<b>"+formatPrice(parseInt(a[2]))+"</b>",guildwbwdshopdonatesuccess));guildWBWShop()}}function guildWBWmemberRanking(a){guildAction("wbwmemberranking",{type:a})}function guildWBWHallOfFame(a){guildAction("halloffame",0,{ispublic:a})}function guildWBWHallOfFameResponse(a,b){guildwbw_hof_global=a[1];guildwbw_hof_server=a[2];guildwbw_hof_data=a[3];guildwbw_hof_second=a[4];guildwbw_hof_third=a[5];guildwbw_alltime=a[6];setGuildWBWContent(5,0,0,b)}function buildGuildWBWtrophies(b){hideDiv("guildwbwtrophy5");hideDiv("guildwbwtrophy7");for(var a=0;a<4;a++){hideDiv("guildwbwtrophy"+(a+1));if(b[1][a]>0){$("guildwbwtrophy"+(a+1)+"info").innerHTML=str_replace("%COUNT%",b[1][a],guildwbwtrophy[(a+1)]);showDiv("guildwbwtrophy"+(a+1))}}if(b[2]==1){$("guildwbwtrophy5info").innerHTML=guildwbwtrophy[5];showDiv("guildwbwtrophy5")}if($("guildwbwtrophy6info")){$("guildwbwtrophy6info").innerHTML=guildwbwtrophy[6]}if(b[3]==1){$("guildwbwtrophy7info").innerHTML=guildwbwtrophy[7];showDiv("guildwbwtrophy7")}}function guildWBWstartAllTrucksCommit(){var a="guildWBWStartAll();";var b="<div>"+guildwbwalltruckscontent+"</div>";globalcommitbox(guildwbwalltrucksheader,b,a)}function initGuildQuests(a){guildAction("initquests",{only:a})}function setGuildQuest(a){guildAction("setquest",{questid:a})}function initGuildQuestsResponse(a,c){infoguildquests=a;if(c==1){showGuildMedalcase(1)}else{var b=0;if(gametimer.guild_quest>0){b=1}var e="";for(var d=0;d<infoguildquests.length;d++){e+='<div class="questblock link">';e+='  <div class="questlisttitle">';e+='    <div style="float:left;">'+infoguildquests[d]["id"]+". "+infoguildquests[d][5]+"</div>";e+='    <img style="float:right;" id="questlistdescimg'+d+'" src="'+imgpath+'guild/plus.gif" onclick="showquestlistdesc('+d+');">';e+='    <div class="clear"></div>';e+="  </div>";e+='  <div id="questlistdesc'+d+'" class="questlistdesc">'+infoguildquests[d][6]+"</div>";e+='  <div style="margin:4px 0 0 0;">';e+='    <div style="float:left; margin-right:20px;" title="'+t_points+'"><img width="12" height="12" src="'+imgpath+'points.gif" border="0">&nbsp;'+infoguildquests[d]["points"]+"</div>";e+='    <div style="float:left; margin-right:20px;" title="'+guildquestlist_duration+'"><img src="'+imgpath+'adtime.gif" border="0">&nbsp;'+formatTime(infoguildquests[d][3])+"</div>";e+='    <div style="float:left; margin-right:20px;" title="'+str_replace("%STARTS%",infoguildquests[d]["counter"],guildquestlist_starts_tt)+'"><img src="'+imgpath+'guild/start.gif" border="0">&nbsp;'+infoguildquests[d]["counter"]+"</div>";e+='    <div style="float:left; margin-right:20px;" title="'+str_replace("%SUCCESS%",infoguildquests[d]["success"],guildquestlist_success_tt)+'"><img src="'+imgpath+'guild/success.gif" border="0">&nbsp;'+infoguildquests[d]["success"]+"</div>";e+='    <div style="float:left; margin-right:20px;" title="'+guildquestlist_low_tt+'"><img src="'+imgpath+'guild/low.gif" border="0">&nbsp;'+infoguildquests[d]["low"]+"</div>";e+='    <div style="float:left; margin-right:20px;" title="'+guildquestlist_high_tt+'"><img src="'+imgpath+'guild/high.gif" border="0">&nbsp;'+infoguildquests[d]["high"]+"</div>";e+='    <div class="clear"></div>';e+="  </div>";if(b&&infoguildquests[d]["run"]){e+='<div style="margin:5px 0;" class="important">'+guildquestlist_running+'<span id="questlisttime"></span></div>'}if(!b&&in_array(player_guildmemberstatus,[1,2])){e+='<div class="button activateguildquest" onclick="setQuestCommit('+infoguildquests[d]["id"]+')">'+guildquestlist_startquest_tt+"</div>"}e+="</div>"}$("guildmultiboxcontent").innerHTML=e}}function showquestlistdesc(a){if($("questlistdesc"+a).style.display=="block"){hideDiv("questlistdesc"+a);$("questlistdescimg"+a).src=imgpath+"guild/plus.gif"}else{showDiv("questlistdesc"+a);$("questlistdescimg"+a).src=imgpath+"guild/minus.gif"}}function setQuestCommit(a){var b="setGuildQuest("+a+")";globalcommitbox(guildactivatequestcommit,guildactivatequestcommit,b)}function setGuildQuestRun(a){var d="";d+='<div style="position:absolute; top:0px; left:0px; padding:2px;"><img src="'+imgpath+'adtime.gif">&nbsp;<span id="guildquesttime">'+formatTime(a.remain)+"</span></div>";d+='<div id="questshare_info" class="link" style="position:absolute; width:50px; height:50px; left:100px; top:0px;" onclick="openMultiBox(4)" title="'+guildmap_tt_questshare+'"></div>';d+='<div style="position:absolute; left:0px; top:22px;"><img src="'+imgpath+'points.gif" height="15" width="15">&nbsp;<span style="margin-top:1px; position:absolute;">'+a.points+"</span></div>";d+='<div style="position:absolute; left:0px; top:50px;">';for(var c=1;c<=2;c++){if(a["product"+c]>0){var l=checkRackItem(a["product"+c]);var b="";var h="";if(!l){b="important"}else{h="guildQuestAddProductsCommit("+a["product"+c]+", "+(a["amount"+c]-a["sum"+c])+");"}var e=((a["sum"+c]*100)/a["amount"+c]);d+='<div style="margin-bottom:2px;">'+htmlProductBody(a["product"+c])+"</div>";d+='<div class="link" style="position:relative; background-color:#000; width:140px; height:15px; margin-right:5px; border-radius:3px; overflow:hidden;" onclick="'+h+'">';d+='  <div style="position:absolute; top:0px; left:0px; background-color:#f00; width:'+e+'%; height:15px;"></div>';d+="</div>";d+='<div style="margin-bottom:15px;" class="'+b+'">'+a["sum"+c]+"/"+a["amount"+c]+"</div>"}}d+="</div>";$("guildquestboxcontent").innerHTML=d;hideDiv("guildquestimg");hideDiv("guildquestimgani");showDiv("guildquestbox");if(!gametimer.guild_quest){gametimer.guild_quest=a.remain}}function guildQuestAddProductsCommit(a,b){if(checkRackItem(a)>0){var c={pid:a};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(c),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("checkGuildQuestAddProducts("+a+", "+b+")");$("dialog_entryline_number").onkeyup=new Function("checkGuildQuestAddProducts("+a+", "+b+")");checkGuildQuestAddProducts(a,b)}else{errorboxguild(guildquest_addproduct_none)}}function checkGuildQuestAddProducts(a,b){var c={stockamount:checkRackItem(a),rest:b,click:"guildQuestAddProducts("+a+")"};checkEntryLine(c)}function guildQuestAddProducts(b){if(guild_questentry_block==1){return false}var a=parseInt($("dialog_entryline_number").value);if(parseInt(a)>checkRackItem(b)){errorboxguild(guildquest_addproduct_notenough)}else{guild_questentry_block=1;var c={product:b,amount:a};guildAction("questentry",c)}}function countdownGuildQuest(){if(gametimer.guild_quest){gametimer.guild_quest--;if(gametimer.guild_quest>0){if($("guildquesttime")){$("guildquesttime").innerHTML=formatTime(gametimer.guild_quest)}if($("questlisttime")){$("questlisttime").innerHTML=formatTime(gametimer.guild_quest)}guildquestrun=1;if($("farm_inner_guildlink")){$("farm_inner_guildlink").addClassName("pulse")}}else{clearTimer("guild_quest");guildquestrun=0;if(inguild){initGuild(1)}if($("farm_inner_guildlink")){$("farm_inner_guildlink").removeClassName("pulse")}}}}function initGuildShop(){guildAction("initshop")}function buyGuildShopItem(a){guildAction("buyitem",{product:a,amount:1})}function initGuildShopResponse(b){var d="";var a='<div style="position:relative; width:330px; height:330px; overflow:auto;">';for(var c=0;c<b.length;c++){var h="guildShopAmountDialog("+b[c]["id"]+", "+b[c]["price"]+", "+b[c]["coins"]+")";a+='<div class="market_pframe link" style="position:relative; float:left; margin:20px;" onclick="'+h+'" onmouseover="showDiv(\'guild_shop_item'+c+"_tt')\" onmouseout=\"hideDiv('guild_shop_item"+c+"_tt')\">";a+='  <div class="tt'+b[c]["id"]+' link" style="position:absolute; top:7px; left:8px;"></div>';a+='  <div id="guild_shop_item'+c+'_tt" class="ttbox" style="top:50px; left:0px;">'+produkt_name[b[c]["id"]]+"</div>";if(b[c]["price"]){var e=formatPrice(b[c]["price"])}if(b[c]["coins"]){var e=b[c]["coins"]+"&nbsp;"+t_coins}a+='  <div style="position:absolute; bottom:-15px; width:100%; text-align:center; white-space:nowrap;">'+e+"</div>";a+="</div>"}a+="</div>";globalBoxFlex(d,a,0,0,1)}function guildShopAmountDialog(e,d,b){head=str_replace("%PRODUCT%",produkt_name[e],t_cropaction_buybutton);if(d>0){var a="<div>"+cityadcost+"&nbsp;"+formatPrice(d)+"</div>"}if(b>0){var a="<div>"+cityadcost+"&nbsp;"+b+"&nbsp;"+t_coins+"</div>"}var c="buyGuildShopItem("+e+")";globalcommitbox(head,a,c)}function openNewsticker(a){guildAction("openticker",{type:a})}function deleteGuildNewsCommit(a){globalcommitbox(guildnews_delete_headline,guildnews_delete_info,"deleteGuildNews("+a+")")}function deleteGuildNews(a){guildAction("deletenews",{nid:a})}function openNewstickerResponse(a,b){guildnews=a[1];if(player_guildmemberstatus==0||player_guildmemberstatus==6){errorboxguild(error1114);return false}showDiv("guildnewsticker1");hideDiv("guildnewsticker2");hideDiv("writeguildmail");hideDiv("guildnewsdurable");if(player_guildmemberstatus==1||player_guildmemberstatus==2){showDiv("writeguildmail");showDiv("guildnewsdurable")}showGuildNews();$("guildnewsentry").value="";showDiv("transp9");showDiv("guildnewsticker")}function writeGuildNews(){if($("guildnewsentry").value==""){return false}var a=0;if($("guildnewsdurable").checked==true){a=1}var b={status:a,msg:$("guildnewsentry").value};guildAction("writenews",b)}function calcGuildNewsLength(){var a=$("guildnewsentry").value;if(a.length>0){var b=parseInt(guildnewsmaxlength)-parseInt(a.length);$("guildnewsentrycounter").innerHTML=str_replace("%LETTERS%",b,guildnewsletters)}else{$("guildnewsentrycounter").innerHTML=str_replace("%LETTERS%",guildnewsmaxlength,guildnewsletters)}}function showGuildNews(){var c={"1":[1,16],"2":[2,3,4,5,6,7,8,11,12,13,14,15],"3":[9,10],"4":[17],"5":[20]};var b="";for(var a=0;a<2;a++){if(guildnews[a]){for(j=0;j<guildnews[a].length;j++){for(var d in c){if($("guildnewsfilter"+d).checked==true&&in_array(guildnews[a][j]["type"],c[d])){var h="";if(in_array(guildnews[a][j]["type"],[1,16,17])&&guildnews[a][j]["name"]){h="<i>"+guildnews[a][j]["name"]+":</i><br>"}b+='<div class="guild_newsticker_item guild_newsticker_item_back'+d+'">';b+='<div style="float:left; margin-top:2px; margin-right:5px;">';if(player_guildmemberstatus==1||player_guildmemberstatus==2){b+='<img style="margin-bottom:2px;" width="10" height="10" border="0" src="'+imgpath+'guild/cancel.gif" class="link" onclick="deleteGuildNewsCommit('+guildnews[a][j]["nid"]+');">'}if(youthprotection_active==1&&in_array(guildnews[a][j]["type"],[1,16,17])){b+='<div class="youthprotection_icon guild link" onclick="youthprotection.report(\'guilds\', '+guildnews[a][j]["nid"]+')" onmouseover="showDiv(\'guild_newsticker_item'+guildnews[a][j]["nid"]+"_youthprotection_tt')\" onmouseout=\"hideDiv('guild_newsticker_item"+guildnews[a][j]["nid"]+"_youthprotection_tt')\">";b+="  <div>!</div>";b+='  <div id="guild_newsticker_item'+guildnews[a][j]["nid"]+'_youthprotection_tt" class="ttbox">'+t_youthprotection_report+"</div>";b+="</div>"}b+="</div>";b+='  <div style="float:left; width:75px;">'+str_replace(" ","<br>",guildnews[a][j]["date"])+"</div>";if(in_array(guildnews[a][j]["type"],[1,16])){var e=1;if(guildnews[a][j]["type"]==16){e=2}b+='<img src="'+imgpath+"guild/"+e+'.gif" border="0" style="float:left; margin-right:5px; margin-top:-2px;">'}else{b+='<div style="float:left; width:25px;">&nbsp;</div>'}b+='  <div style="float:left; width:230px; overflow:hidden;">'+h+guildnews[a][j]["message"]+"</div>";b+='  <div class="clear"></div>';b+="</div>"}}}}}$("guildnewstickercontent").innerHTML=b}function calcGuildMailLetters(){var a=$("guildnewsmailmessage").value;if(a.length>0){var b=parseInt(guildnewsmailmessagelength)-parseInt(a.length);$("guildnewsmailentrycounter").innerHTML=str_replace("%LETTERS%",b,guildnewsletters)}else{$("guildnewsmailentrycounter").innerHTML=str_replace("%LETTERS%",guildnewsmailmessagelength,guildnewsletters)}}function writeGuildMailCommit(){hideDiv("guildnewsticker1");showDiv("guildnewsticker2")}function writeGuildMail(){if($("guildnewsmailsubject").value==""||$("guildnewsmailmessage").value==""){return false}var a={subject:$("guildnewsmailsubject").value,message:$("guildnewsmailmessage").value};guildAction("writemail",a)}function initGuildPark(){guildAction("initguildpark")}function setGuildParkView(c){var l=0;hideDiv("guildparknavileft");hideDiv("guildparknaviright");for(var d in sculpturedata){hideDiv("guildparkitem"+d);l++}if(c==1){sculptureid=(sculptureid-1)}else{if(c==2){sculptureid=(sculptureid+1)}}if(sculptureid<1){sculptureid=1}if(sculptureid>l){sculptureid=l}if(sculptureid>1){showDiv("guildparknavileft")}if(sculptureid<l){showDiv("guildparknaviright")}showDiv("guildparkitem"+sculptureid);if(sculpturedata[sculptureid]){for(var h in sculpturedata[sculptureid]["products"]){var s="";var m=0;var q=sculpturedata[sculptureid]["products"][h];if(sculpturedata[sculptureid]["sum"][h]){var m=sculpturedata[sculptureid]["sum"][h]}if(m<q&&guildpark_userstatus!=6&&guildpark_stock[h]&&guildpark_stock[h]>0){s="buildGuildParkEntry("+h+", "+(q-m)+")"}$("guildparkitem"+sculptureid+"_entry"+h).onclick=new Function(s);var n=Math.floor(((q-m)*100)/q);$("guildparkitem"+sculptureid+"_entry"+h+"_bar").style.left="-"+n+"px";$("guildparkitem"+sculptureid+"_entry"+h+"_entry").innerHTML=m;if(guildpark_entries[sculptureid]&&guildpark_entries[sculptureid][h]){var e='<div style="margin-bottom:2px;">';for(var b in guildpark_entries[sculptureid][h]){if(guildpark_entries[sculptureid][h][b]["sum"]>0){e+='<div style="float:left; width:15px; margin-right:5px;" class="f_m_symbol'+h+'"></div>';e+='<div style="float:left; width:50px; margin-right:5px;">'+guildpark_entries[sculptureid][h][b]["sum"]+"</div>";e+='<div style="float:left; width:100px;">'+guildpark_entries[sculptureid][h][b]["name"]+"</div>";e+='<div style="clear:both;"></div>'}}e+="</div>";$("guildparkitem"+sculptureid+"_info"+h+"_entries").innerHTML=e}}var r="jpg";if(sculptureid==1){var a="megacow"}else{if(sculptureid==2){var a="megasheep"}else{if(sculptureid==3){var a="megachicken"}else{if(sculptureid==4){var a="megagoat"}else{if(sculptureid==5){var a="megabunny";r="png"}}}}}$("guildpark").style.background="url("+imgpath+"guild/"+a+sculpturedata[sculptureid]["phase"]+"."+r+")"}showDiv("transp9");showDiv("guildpark")}function buildGuildParkEntry(a,b){var c={type:"forestry",pid:a};globalcommitbox(guild_park_entry_headline,htmlEntryLine(c),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("chkGuildParkEntry("+a+", "+b+")");$("dialog_entryline_number").onkeyup=new Function("chkGuildParkEntry("+a+", "+b+")");chkGuildParkEntry(a,b)}function chkGuildParkEntry(a,b){var c={stockamount:guildpark_stock[a],rest:b,click:"sendGuildPark("+a+")"};checkEntryLine(c)}function sendGuildPark(a){if($("dialog_entryline_number").value>0){var b={id:sculptureid,pid:a,amount:$("dialog_entryline_number").value};guildAction("sendguildpark",b)}}function showGuildParkStats(){if(guildparkstats[sculptureid]){if($("guildparksstats_container").style.display=="block"){hideDiv("guildparksstats_container");hideDiv("guildparksstats_container_transp");$("guildparkcompareimg").style.backgroundImage="url("+imgpath+"guild/plus.gif)"}else{hideDiv("guildpark_ownguild");showDiv("guildparksstats_container");showDiv("guildparksstats_container_transp");$("guildparkcompareimg").style.backgroundImage="url("+imgpath+"guild/minus.gif)";var c=0;var d=0;var b="";for(var a=0;a<guildparkstats[sculptureid].length;a++){if(c!=guildparkstats[sculptureid][a][2]){d++}var h="";if(guildparkstats[sculptureid][a][4]==1){h="font-weight:bold;";showDiv("guildpark_ownguild")}var e=d+".";if(c==guildparkstats[sculptureid][a][2]){var e="&nbsp;"}b+='<div style="margin-bottom:4px;">';if(guildparkstats[sculptureid][a][4]==1){b+='<a name="guildparkownguild"></a>'}b+='  <div style="float:left; width:30px; text-align:right; margin-right:5px;">'+e+"</div>";b+='  <div style="float:left; width:200px; margin-right:5px; '+h+'">'+guildparkstats[sculptureid][a][1]+"&nbsp;["+guildparkstats[sculptureid][a][3]+"]</div>";b+='  <div style="float:left; position:relative; width:200px; height:15px; background-color:#000; overflow:hidden; margin-right:5px;">';b+='    <div style="position:absolute; background-color:#f00; height:15px; width:'+guildparkstats[sculptureid][a][2]+'%"></div>';b+="  </div>";b+='  <div style="float:left;">'+guildparkstats[sculptureid][a][2]+"%</div>";b+='  <div class="clear"></div>';b+="</div>";c=guildparkstats[sculptureid][a][2]}$("guildparksstats_container_content").innerHTML=b}}}function showGuildParkEntryLine(){if($("guildparkentries").style.display=="block"){hideDiv("guildparkentriestransp");hideDiv("guildparkentries");$("guildparkentriesimg").style.background="url("+imgpath+"guild/plus.gif)"}else{showDiv("guildparkentriestransp");showDiv("guildparkentries");$("guildparkentriesimg").style.background="url("+imgpath+"guild/minus.gif)"}}function closeGuildPark(){hideDiv("transp9");hideDiv("guildpark")}function showGuildMedalcase(l){var e="";var d={};for(var c=0;c<infoguildquests.length;c++){if(infoguildquests[c]["success"]>0){d[infoguildquests[c]["id"]]=infoguildquests[c]["success"]}}for(var c=1;c<=130;c++){var b="left";if(c%22>15||c%22==0){b="right"}var a="";var h="<div>"+t_quest_foodworld+"&nbsp;"+c+"</div>";if(d[c]){if(d[c]>=guildmedalboxbronze){a="guild_medalcase_bronze"}if(d[c]>=guildmedalboxsilver){a="guild_medalcase_silver"}if(d[c]>=guildmedalboxgold){a="guild_medalcase_gold"}if(d[c]>=guildmedalboxplatin){a="guild_medalcase_platin"}h+='<div class="bonusinfo">'+str_replace("%SUCCESS%",d[c],guildquestlist_success_tt)+"</div>"}e+='<div class="guild_medalcase_item link '+a+'" onmouseover="showDiv(\'guild_medalcase_tt'+c+"')\" onmouseout=\"hideDiv('guild_medalcase_tt"+c+"')\">";e+='  <div id="guild_medalcase_tt'+c+'" class="ttbox guild_medalcase_item_tt_'+b+'">'+h+"</div>";e+="</div>";if(c%22==0){e+='<div class="clear"></div>'}}$("guildmedalcasecontent").innerHTML=e;showDiv("guildmedalcase")}function initGuildAchievements(){guildAction("achievementsinit")}function buildGuildAchievements(a){for(var b in a){if($("guildachievement"+b)){$("guildachievement"+b).addClassName("gach"+b+"off");$("guildachievement"+b).removeClassName("gach"+b).removeClassName("gach0");if(a[b].date){$("guildachievement"+b).removeClassName("gach"+b+"off").removeClassName("gach0");$("guildachievement"+b).addClassName("gach"+b);$("guildachievements_item_tt_time"+b).innerHTML=a[b].date}}}}function closeguildachievements(){hideDiv("transp9");hideDiv("guildachievements")}var guildjob_quickview={};var guildjob_quickview_mover=0;function guildJobQuickView(){showDiv("guildjob_quickview");setTimer("guildjob_quickview");if(job_data&&job_data.config){var e='<div style="font-weight:bold; margin-bottom:5px;">'+t_guildjob_current_job+"</div>";e+='<div style="margin-bottom:2px;">'+t_guildjob_need_jobs+":</div>";for(var d=0;d<guildjob_quickview.data.jobs.length;d++){var n="opacity:0.3";if(job_data.currentjob==guildjob_quickview.data.jobs[d]){n=""}e+='<div class="link" style="float:left; position:relative; margin-right:5px; width:50px; height:50px;" onclick="showJobOverview()" onmouseover="showDiv(\'guildjob_quickview_job_tt'+d+"')\" onmouseout=\"hideDiv('guildjob_quickview_job_tt"+d+"')\">";e+='  <div style="position:absolute; width:100%; height:100%; '+n+'" class="job_jobsymbol_mini job_jobsymbol'+guildjob_quickview.data.jobs[d]+'_mini"></div>';if(n==""){n="<br>"+t_guildjob_memberjob_select}else{n=""}e+='  <div id="guildjob_quickview_job_tt'+d+'" class="ttbox" style="left:50px;"><b>'+job_data.config.jobs[guildjob_quickview.data.jobs[d]].name+"</b>"+n+"</div>";e+="</div>"}e+='<div class="clear"></div>';$("guildjob_quickview_info_jobs").innerHTML=e;e='<div style="margin-bottom:2px;">'+t_guildjob_need_products+":</div>";for(var d in guildjob_quickview.data.products){var n="opacity:0.3";if(in_array(d,job_data.config.jobs[job_data.currentjob].products)){n=""}e+='<div style="float:left; position:relative; margin-right:5px; margin-bottom:5px; width:50px; height:50px;" onmouseover="showDiv(\'guildjob_quickview_product'+d+"_tt')\" onmouseout=\"hideDiv('guildjob_quickview_product"+d+"_tt')\">";e+='  <div class="tt'+d+'" style="position:absolute; top:0px; border-radius:5px; '+n+'"></div>';e+='  <div id="guildjob_quickview_product'+d+'_tt" class="ttbox" style="left:50px;">'+produkt_name[d]+"</div>";e+='  <div style="position:absolute; bottom:0px; left:0px; width:100%; height:5px; background-color:#000;">';var l=0;if(guildjob_quickview.data.entries&&guildjob_quickview.data.entries[d]){l=((guildjob_quickview.data.entries[d]*100)/guildjob_quickview.data.products[d])}e+='    <div style="position:absolute; top:0px; left:0px; width:'+l+'%; height:5px; background-color:#f00;"></div>';e+="  </div>";if(n==""){var m=0;if(in_array(produkt_category[d],["v","hr"])){m=1}for(var c in farms_data.config.building2product){if(farms_data.config.building2product[c]==d){m=c}}if(!m){for(var c in farms_data.config.advancedbuilding){for(var b=0;b<farms_data.config.advancedbuilding[c].length;b++){if(farms_data.config.advancedbuilding[c][b][2]==d){m=c}}}}if(m>0){start:for(var h in farms_data.farms){for(var a in farms_data.farms[h]){if(farms_data.farms[h][a].buildingid==m&&(m==1||!farms_data.farms[h][a].production)){e+='<div class="button_new link" style="position:absolute; top:50px; text-align:center; width:42px;" onclick="guildJobQuickViewOpenBuilding('+h+", "+a+", "+m+')">';e+='  <div style="margin-left:20px; border-color:transparent transparent transparent #000; border-style:solid; border-width:6px; height:0px; width:0px;"></div>';e+="</div>";break start}}}}}e+="</div>"}e+='<div class="clear"></div>';$("guildjob_quickview_info_products").innerHTML=e}guildJobQuickViewUpdate()}function guildJobQuickViewOpenBuilding(b,c,a){guildJobQuickViewNavi();farmMove(b);if(a==1){setTimeout(function(){specialZoneFieldHandler(c)},200)}else{setTimeout(function(){initLocation(c)},200)}}function guildJobQuickViewUpdate(){$("guildjob_quickview_timer").innerHTML=formatTime(guildjob_quickview.remain)}function guildJobQuickViewTimer(){guildjob_quickview.remain--;if(guildjob_quickview.remain>0){}else{clearTimer("guildjob_quickview");hideDiv("guildjob_quickview")}guildJobQuickViewUpdate()}function guildJobQuickViewNavi(){if(guildjob_quickview_mover){hideDiv("guildjob_quickview_info");guildjob_quickview_mover=0}else{showDiv("guildjob_quickview_info");guildjob_quickview_mover=1}}var guild_job={};var guild_job_change_memberjob_block=0;function guildJobInit(a){guildAction("job_init",{page:a})}function guildJobChangeMemberJob(a){if(!guild_job_change_memberjob_block){guild_job_change_memberjob_block=1;guildAction("memberjob_change",{job:a})}}function guildJobGamble(){guildAction("job_gamble")}function guildJobSetBoost(a){guildAction("job_set_boost",{pid:a})}function guildStockSlotEntry(c,a,b){guildAction("stock_slot_entry",{slot:c,pid:a,type:b,amount:$("dialog_entryline_number").value})}function guildStockSlotUnlock(a){guildAction("stock_slot_unlock",{slot:a})}function guildStockDeleteProduct(a){guildAction("stock_delete_product",{pid:a})}function guildJobJoin(){guildAction("job_join")}function guildJobStartJob(a){guildAction("job_start",{difficulty:a})}function guildJobEntry(a){guildAction("job_entry",{pid:a,amount:$("dialog_entryline_number").value})}function guildJobAddMember(){guildAction("add_jobmember")}function guildJobBuyPoints(a){guildAction("job_buy_points",{coins:a})}function guildJobFinish(){guildAction("job_finish")}function guildJobSetTool(a){guildAction("job_set_tool",{pid:a})}function guildJobSetToolCommit(a){if(!job_data.guild_job_data){var b="<div>"+t_guildjob_tools_and_booster_warning+"</div>";b+='<div style="margin-top:10px; font-weight:bold;">'+t_guildjob_no_current_job_commit+"</div>";var c="guildJobSetTool("+a+")";globalcommitbox(t_guildjob_no_current_job,b,c)}else{guildJobSetTool(a)}}function guildJobStartJobCommit(c){var l={};for(var d=0;d<guild_job.members.length;d++){l[guild_job.members[d].unr]=guild_job.members[d].uname}var e="guildJobStartJob("+c+")";var b="<div>"+t_guildjob_start_body+"</div>";b+='<div style="margin-top:10px; font-weight:bold;">'+t_guildjob_member_confirmed+":</div>";var h=0;for(var a in guild_job.job.jobs){if(a==player_unr){h=1}b+="<div>"+l[a]+"</div>"}if(!h){b+='<div style="margin-top:10px; background-color:#C3A75E; border-radius:5px; padding:10px;">'+t_guildjob_start_body_join+"</div>"}globalcommitbox(t_guildjob_start_head,b,e)}function guildJobStats(){var a="points";if($("guild_job_stats_select")){a=$("guild_job_stats_select").value}guild_job_stats_select=a;if(guild_job_stats_cache_delay[a]&&guild_job_stats_cache_delay[a]>0){showGuildJobStats(a)}else{guildAction("job_stats",{type:a})}}function initGuildJobBox(){showDiv("transp9");showDiv("guild_job_box");naviGuildJob(1);setTimer("guildjob");showDiv("guild_job_jobselect_timer_bar");$("guild_job_levelbar").innerHTML=htmlLevelBar("guild_job",0,0);$("guild_job_countbar").innerHTML=htmlCountBar("guild_job");$("guild_job_countbar_inner").innerHTML='<div class="guildjob_orderpoints" style="float:left; margin:-5px 5px 0px -5px;"></div><div style="float:left;">'+guild_job.job.count+'</div><div class="clear"></div>';$("guild_job_countbar_plus").onclick=new Function("guildJobDialog('buy_points')");$("guild_job_countbar_plus_tt").innerHTML=t_guildjob_points_buy;$("guild_job_levelbar_number").innerHTML=guild_job.job.level;$("guild_job_levelbar_inner").style.width=guild_job.job.level_progress+"%";$("guild_job_levelbar_plus").onclick=new Function("guildJobDialog('add_level')");$("guild_job_levelbar_plus_tt").innerHTML=t_guildjob_points_add;var a=str_replace("%AMOUNT%",(guild_job.job.next_level_points-guild_job.job.points),t_guildjob_level_tt);if(!guild_job.config.level[(guild_job.job.level+1)]){a=t_reached_maxlevel;hideDiv("guild_job_levelbar_plus")}if(!checkGuildJobMemberStatus("levelbar")){hideDiv("guild_job_levelbar_plus")}$("guild_job_levelbar_tt").innerHTML=a;hideDiv("guildbanner_back")}function closeGuildJobBox(){showDiv("guildbanner_back");hideDiv("transp9");hideDiv("guild_job_box")}function naviGuildJob(b){for(var a=1;a<=4;a++){$("guild_job_box_navi"+a).removeClassName("brown_tab_active");if(b==a){$("guild_job_box_navi"+b).addClassName("brown_tab_active")}}if(b==1){buildGuildJobInfoboard()}else{if(b==2){buildGuildJobMemberlist()}else{if(b==3){buildGuildJobStock()}else{if(b==4){buildGuildJobLog()}}}}}function buildGuildJobInfos(){var c="";if(guild_job.job.startdate==0){var a={};for(var b in guild_job.job.jobs){if(guild_job.job.jobs[b]>0){if(!a[guild_job.job.jobs[b]]){a[guild_job.job.jobs[b]]=0}a[guild_job.job.jobs[b]]++}}c+='<div id="guild_job_jobselect_box">';c+='  <div style="float:left; padding:5px; margin-right:5px;">';c+='    <div style="margin-bottom:5px;">'+t_guildjob_need_jobs+"</div>";for(var b=0;b<guild_job.job.data.jobs.length;b++){var e=guild_job.job.data.jobs[b];c+='<div style="position:relative; float:left; margin-right:5px;" class="job_jobsymbol_mini job_jobsymbol'+e+'_mini link" onclick="showJobOverview()" onmouseover="showDiv(\'guild_job_jobselect_job'+b+"_"+e+"_tt')\" onmouseout=\"hideDiv('guild_job_jobselect_job"+b+"_"+e+"_tt')\">";var d="<div>"+job_data.config.jobs[e].name+"</div>";if(a[e]){d+='<div style="margin-top:2px;">'+t_guildjob_take_part+":&nbsp;"+a[e]+"</div>"}c+='  <div id="guild_job_jobselect_job'+b+"_"+e+'_tt" class="guild_job_jobselect_job_tt ttbox">'+d+"</div>";c+="</div>"}c+='    <div class="clear"></div>';c+="  </div>";c+='  <div style="float:left; padding:5px; margin-right:5px;">';c+='    <div style="margin-bottom:5px;">'+t_guildjob_need_products+"</div>";for(pid in guild_job.job.data.products){c+=htmlProductSymbol(pid,"guild_job_jobselect_product","l","guild_job_jobselect_product","guild_job_jobselect_product_tt")}c+='    <div class="clear"></div>';c+="  </div>";c+='  <div style="float:right">';if(checkGuildJobMemberStatus("gamble")){c+='<div class="megafield_job_gamble link" style="margin-top:7px;" onclick="guildJobDialog(\'gamble_job\')" onmouseover="showDiv(\'guild_job_jobselect_gamble_tt\')" onmouseout="hideDiv(\'guild_job_jobselect_gamble_tt\')">';c+='  <div id="guild_job_jobselect_gamble_tt" class="ttbox">'+str_replace("%COINS%",guild_job.config.job_gamble_coins,t_guildjob_change_jobs)+"</div>";c+="</div>"}c+="  </div>";c+='  <div class="clear"></div>';c+="</div>"}c+='<div id="guild_job_jobselect_timer_bar">';c+='  <div id="guild_job_jobselect_timer_bar_inner"></div>';c+='  <div id="guild_job_jobselect_timer"></div>';c+="</div>";return c}function buildGuildJobInfoboard(){var r="";r+=buildGuildJobInfos();if(guild_job.job.startdate>0&&guild_job.job.startdate>0){var J=1;var E=0;var l=0;var d=0;var s=0;var b=20;var c='<div id="guild_job_products">';for(var A in guild_job.job.data.products){lastpid=A}for(var A in guild_job.job.data.products){var B=0;if(guild_job.job.data.entries&&guild_job.job.data.entries[A]){B=guild_job.job.data.entries[A]}var C="";if(guild_job.stock.stock[A]&&B<guild_job.job.data.products[A]&&checkGuildJobMemberStatus("jobentry")){C="guildJobDialog('job_entry', "+A+")"}var J=(guild_job.config.difficulty[guild_job.job.difficulty].steps_amount.length-1);var O="";if(lastpid==A){O="lastpid"}c+='<div class="product '+O+'" style="z-index:'+(b--)+'">';c+='  <div class="img l'+A+'" onmouseover="showDiv(\'guild_job_product'+A+"_tt')\" onmouseout=\"hideDiv('guild_job_product"+A+"_tt')\">";c+='    <div id="guild_job_product'+A+'_tt" class="ttbox">'+produkt_name[A]+"</div>";c+='    <div class="guildjob_orderpoints"></div>';c+="  </div>";c+='  <div class="bar link" onclick="'+C+'">';var a=Math.min((B*100/guild_job.job.data.products[A]),100);var e="";if(guild_job.reward.reached>-1){e="reached"}c+='    <div class="inner '+e+'" style="width:'+a+'%"></div>';var n=10;for(var K=0;K<=J;K++){var m=guild_job.job.data.products[A];var e="";var a=guild_job.config.difficulty[guild_job.job.difficulty].steps_amount[K]*100;if(K==J){e="last";a=100}else{var m=Math.ceil(guild_job.job.data.products[A]*guild_job.config.difficulty[guild_job.job.difficulty].steps_amount[K])}c+='<div class="step '+e+'" style="width:'+a+"%; z-index:"+(n--)+'" onmouseover="showDiv(\'guild_job_product'+A+"_step"+K+"_tt')\" onmouseout=\"hideDiv('guild_job_product"+A+"_step"+K+"_tt')\">";c+='  <div id="guild_job_product'+A+"_step"+K+'_tt" class="ttbox">';c+='    <div class="percent">'+a+"%</div>";if(K==0){c+="<div>"+t_min_sum+"</div>"}c+="    <div>"+lotterylotsrequired+"</div>";c+="    <div>"+formatNumber(m)+"/"+formatNumber(guild_job.job.data.products[A])+"</div>";c+="  </div>";c+="</div>"}if(!guild_job.stock.stock[A]){c+='<div class="block important" class="important">'+product_notavailable_info+"</div>"}c+="  </div>";c+='  <div class="amount">'+formatNumber(B)+"/"+formatNumber(guild_job.job.data.products[A])+"</div>";c+='  <div class="clear"></div>';c+="</div>";s+=guild_job.job.data.products[A];d+=B;l++}c+="</div>";r+='<div style="position:absolute; right:19px; z-index:10; top:13px;" class="refresh link" onclick="guildJobInit()" onmouseover="showDiv(\'guild_job_refresh_tt\')" onmouseout="hideDiv(\'guild_job_refresh_tt\')">';r+='  <div id="guild_job_refresh_tt" class="ttbox" style="right:20px;">'+guildnewsrefresh+"</div>";r+="</div>";if(!guild_job.job.joinedtask){r+='<div class="important" style="position:absolute; top:215px; width:500px;">'+t_guildjob_not_take_part+"</div>"}var z="";if(!checkGuildJobMemberStatus("jobentry")){z="&nbsp;("+t_guildjob_insert_only+")"}r+='<div class="guild_job_memberlist_item_head" style="margin-bottom:5px;">'+t_need_products+z+"</div>";r+='  <div style="overflow:auto; height:205px; margin:5px 0px;">'+c+"</div>";r+='<div class="guild_job_memberlist_item_head">'+t_current_reward+"</div>";r+='<div style="position:absolute; width:548px; margin:0 auto;">';var J=(guild_job.config.difficulty[guild_job.job.difficulty].steps_taskpoints.length-1);var a=0;var v=t_guildjob_reward_goal_none;if(guild_job.reward.reached==J){a=100;v=t_guildjob_reward_goal_final}else{if(guild_job.reward.reached>-1){a=(guild_job.config.difficulty[guild_job.job.difficulty].steps_amount[guild_job.reward.reached]*100);if(guild_job.reward.reached==0){v=t_guildjob_reward_goal_step0}else{v=t_guildjob_reward_goal_step}v=str_replace("%PERCENT%",a,v);v=str_replace("%STEP%",(guild_job.reward.reached+1),v)}}r+='<div id="guild_job_reward_status">';r+='  <div class="inner" style="width:'+a+'%"></div>';for(var K=0;K<=J;K++){var a=(guild_job.config.difficulty[guild_job.job.difficulty].steps_amount[K]*100);if(K==J){a=100}r+='<div class="step" style="width:'+a+'%"></div>'}r+='  <div class="istext">'+v+"</div>";r+="</div>";var I=0;for(var G in guild_job.reward.player_points){if(parseInt(G)==parseInt(player_unr)){I=guild_job.reward.player_points[G]}}r+='<div id="guild_job_reward_player">';r+='  <div class="headline">'+t_guildjob_player_reward+"</div>";r+='  <div class="icon_star"></div>';r+='  <div class="points">'+formatNumber(I)+"&nbsp;"+t_points+"</div>";r+='  <div class="clear"></div>';for(var G in guild_job.reward.job_points){if(parseInt(G)==parseInt(player_unr)){r+='  <div class="guildjob_jobpoints"></div>';r+='  <div class="points2">';for(var H in guild_job.reward.job_points[G]){r+='<div class="job_jobsymbol'+H+'_mini job_jobsymbol_mini"></div>';r+='<div class="points">'+formatNumber(guild_job.reward.job_points[G][H])+"&nbsp;"+t_guildjob_jobpoints+"</div>";r+='<div class="clear"></div>'}r+="  </div>";r+='  <div class="clear"></div>'}}r+='  <div class="bonusinfo">'+t_guildjob_reward_player_info+"</div>";r+="</div>";var L=Math.round(guild_job.config.production[guild_job.job.data.configuration].taskpoints*guild_job.config.difficulty[guild_job.job.difficulty].steps_taskpoints[J]);r+='<div id="guild_job_reward_guild">';r+='  <div class="headline">'+t_guildjob_guild_reward+"</div>";for(var K=1;K<=2;K++){var e="";if(guild_job.reward.reached==-1){e="active"}if(K==1){r+='<div class="column'+K+'">'+guildwbwrankingamount+'</div><div class="column'+K+'">0%</div>'}if(K==2){r+='<div class="guildjob_orderpoints column'+K+'"></div><div class="column'+K+" "+e+'">0</div>'}for(var F=0;F<guild_job.config.difficulty[guild_job.job.difficulty].steps_taskpoints.length;F++){var a=guild_job.config.difficulty[guild_job.job.difficulty].steps_amount[F]*100;if(F==J){a=100}var m=L;if(F<J){m=Math.round(L*guild_job.config.difficulty[guild_job.job.difficulty].steps_taskpoints[F])}if(K==1){r+='<div class="column'+K+'">'+a+"%</div>"}if(K==2){var e="";if(F==guild_job.reward.reached){e="active"}r+='<div class="column'+K+" "+e+'">'+m+"</div>"}}r+='<div class="clear"></div>'}r+="</div>";r+="</div>";r+='<div id="guild_job_finish_button">';r+='  <div id="guild_job_finish_button_inner">';r+="    <div>"+t_guildjob_finish_job_info+"</div>";if(checkGuildJobMemberStatus("finishjob")){r+='<div class="button_new link" style="margin-top:10px;" onclick="guildJobFinish()">'+t_guildjob_finish_job+"</div>"}r+="  </div>";r+="</div>";r+='<div class="clear"></div>'}else{if(specialbonus){var N=specialbonus.findBonus({key1:"guild",key2:"products_reduction_animal"});if(N){r+='<div class="specialbonus" style="text-align:center; font-weight:bold; margin-top:5px;">'+t_specialbonus_guild_products_reduction_animal_inguild.replace("%BONUS%",(N.products_reduction_animal*100))+"</div>"}}var q="";if(checkGuildJobMemberStatus("startjob")){var q="onmouseover=\"this.style.transform='scale(1.02)'\" onmouseout=\"this.style.transform='scale(1)'\"";var h=t_farmersmarket_job_select_difficulty}else{var h=""}r+='<div style="padding:4px; text-align:center; margin-top:5px; font-weight:bold;">'+h+"</div>";r+='<div style="position:relative; margin-left:5px; width:558px;">';if(!checkGuildJobMemberStatus("startjob")){for(var K=0;K<guild_job.members.length;K++){if(guild_job.members[K].unr==player_unr){r+='<div style="background-color:#C3A75E; width:100%; border-radius:5px; text-align:center; padding:20px 0px;">';if(job_data.currentjob){var M=t_guildjob_memberjob_job_check;r+="<div>"+t_guildjob_memberjob_select+"</div>";r+='<div class="job_jobsymbol_mini job_jobsymbol'+job_data.currentjob+'_mini link" style="margin:0 auto; margin-top:5px;" onclick="showJobOverview()"></div>';if(parseInt(job_data.jobs[job_data.currentjob].joined)==1){if(guild_job.job.jobs[player_unr]){r+='<div style="margin-top:10px;">'+t_guildjob_start_ready+"</div>"}else{r+='<div style="margin-top:10px;">'+t_guildjob_start_wait+"</div>"}M=t_guildjob_start_undone}else{r+='<div style="margin-top:10px;">'+t_guildjob_start_join+"</div>"}r+='<div class="button_new link" style="width:200px; margin:0 auto; margin-top:5px;" onclick="guildJobDialog(\'job_check\', '+K+')">'+M+"</div>"}else{r+="<div>"+t_guildjob_start_need_job+"</div>";r+='<div class="button_new link" style="width:200px; margin:0 auto; margin-top:5px;" onclick="showJobOverview()">'+t_guildjob_start_need_job_button+"</div>"}r+="</div>";break}}}else{var w=0;if(guild_job.job.jobs){for(var K in guild_job.job.jobs){if(guild_job.job.jobs[K]>0){w++}}}for(var K=1;K<=3;K++){var u=t_difficulty[K];if(K==1){u=t_difficulty[3]}if(K==3){u=t_difficulty[1]}r+='<div class="guild_job_jobselect_job_box" '+q+">";r+='  <div style="text-align:center; color:#6C441D; font-size:12px; font-weight:bold;">'+u+"</div>";r+='  <div class="guild_job_difficulty'+K+'"></div>';r+='  <div id="guild_job_jobselect_membercount'+K+'">';r+='    <div style="margin-bottom:2px;">'+t_guildjob_need_member_count+":</div>";var z="";if(guild_job.job.data.memberadd){z='<span style="color:green;">+'+guild_job.job.data.memberadd.length+"</span>"}r+='    <div style="float:left; margin-top:3px; font-size:14px; font-weight:bold; margin-left:37px;">'+guild_job.config.difficulty[K].min+"&nbsp;-&nbsp;"+guild_job.config.difficulty[K].max+"&nbsp;"+z+"</div>";var D=1;if(guild_job.job.data.memberadd&&guild_job.job.data.memberadd.length>=guild_job.config.addmembers_max){D=0}if(checkGuildJobMemberStatus("addmemberspace")&&D==1){r+='<button class="button_new link" style="float:left; width:24px; font-size:14px; margin-left:4px;" onclick="guildJobDialog(\'add_jobmember\')">+</button>'}r+='    <div class="clear"></div>';r+="  </div>";var J=guild_job.config.difficulty[K].max;if(guild_job.job.data.memberadd){J+=guild_job.job.data.memberadd.length}var t=(parseInt(guild_job.config.difficulty[K].min)-parseInt(w));if(parseInt(w)>J){r+='<div id="guild_job_jobselect_maxmember'+K+'" style="position:absolute; bottom:5px; width:95%;">'+str_replace("%COUNT%",(parseInt(w)-J),t_guildjob_to_much_member_for_start)+"</div>"}else{if(t>0){r+='<div id="guild_job_jobselect_minmember'+K+'" style="position:absolute; bottom:5px; width:95%;">'+str_replace("%COUNT%",t,t_guildjob_need_member_for_start)+"</div>"}else{r+='<button id="guild_job_jobselect_start'+K+'" style="position:absolute; bottom:5px; width:171px;" class="button_new link" onclick="guildJobStartJobCommit('+K+')">'+t_megafield_job_select+"</button>"}}r+='  <div id="guild_job_jobselect_block'+K+'" class="big_block"></div>';r+='  <div id="guild_job_jobselect_blockinfo'+K+'" class="guild_job_jobselect_blockinfo important">'+str_replace("%LEVEL%",guild_job.config.difficulty[K].level,t_guildjob_need_level)+"</div>";r+="</div>"}}r+='  <div class="clear"></div>';r+="</div>"}$("guild_job_box_inner").innerHTML=r;for(var K in guild_job.config.difficulty){if(guild_job.config.difficulty[K].level>guild_job.job.level){showDiv("guild_job_jobselect_block"+K);showDiv("guild_job_jobselect_blockinfo"+K);hideDiv("guild_job_jobselect_membercount"+K);if($("guild_job_jobselect_minmember"+K)){hideDiv("guild_job_jobselect_minmember"+K)}if($("guild_job_jobselect_maxmember"+K)){hideDiv("guild_job_jobselect_maxmember"+K)}if($("guild_job_jobselect_start"+K)){hideDiv("guild_job_jobselect_start"+K)}}else{hideDiv("guild_job_jobselect_block"+K);hideDiv("guild_job_jobselect_blockinfo"+K);showDiv("guild_job_jobselect_membercount"+K);if($("guild_job_jobselect_minmember"+K)){showDiv("guild_job_jobselect_minmember"+K)}if($("guild_job_jobselect_maxmember"+K)){showDiv("guild_job_jobselect_maxmember"+K)}if($("guild_job_jobselect_start"+K)){showDiv("guild_job_jobselect_start"+K)}}}}function buildGuildJobMemberlist(){var h="";h+=buildGuildJobInfos();var b=250;if(guild_job.job.startdate>0&&guild_job.job.startdate>0){b=395}h+='<div style="position:relative; height:'+b+'px; overflow:auto; margin:10px 0px;">';h+='  <div class="guild_job_memberlist_item_blank">';h+='    <select id="guild_job_memberlist_filter" class="link guild_job_memberlist_filter" onchange="setGuildJobMemberFilter()" style="width:160px; margin-right:20px; border-radius:5px; border:0px; padding:2px;">';h+='      <option value="0">---</option>';for(jobid in guild_job.config.jobs){h+='<option value="'+jobid+'">'+guild_job.config.jobs[jobid].name+"</option>"}h+='      <option value="confirmed">'+t_guildjob_member_confirmed+"</option>";h+='      <option value="unconfirmed">'+t_guildjob_member_unconfirmed+"</option>";h+="    </select>";h+='    <div class="guild_job_memberlist_currentjob head">'+t_guildjob_memberjob_job_head+"</div>";h+='    <div class="guild_job_memberlist_check head">'+t_guildjob_memberjob_job_check+"</div>";h+='    <div class="guild_job_memberlist_join head">'+t_guildjob_memberjob_job_joined+"</div>";h+='    <div style="float:right;" class="refresh link" onclick="guildJobInit(2);" onmouseover="showDiv(\'guild_job_memberlist_refresh_tt\')" onmouseout="hideDiv(\'guild_job_memberlist_refresh_tt\')">';h+='      <div id="guild_job_memberlist_refresh_tt" class="ttbox" style="right:20px;">'+guildnewsrefresh+"</div>";h+="    </div>";h+='    <div class="clear"></div>';h+="  </div>";var c="";var a="";for(var e=0;e<guild_job.members.length;e++){var d="";d+='<div id="guild_job_memberlist_item'+e+'" class="guild_job_memberlist_item">';d+='  <div id="guild_job_memberlist_status'+e+'" class="guild_job_memberlist_status">&nbsp;</div>';d+='  <div id="guild_job_memberlist_name'+e+'" class="link guild_job_memberlist_name"></div>';d+='  <div id="guild_job_memberlist_currentjob'+e+'" class="guild_job_memberlist_currentjob"></div>';d+='  <div id="guild_job_memberlist_check'+e+'" class="guild_job_memberlist_check"></div>';d+='  <div id="guild_job_memberlist_join'+e+'" class="guild_job_memberlist_join"></div>';d+='  <div class="clear"></div>';d+='  <div id="guild_job_memberlist_data'+e+'" class="guild_job_memberlist_data"></div>';d+="</div>";if(guild_job.members[e].self){c+=d}else{a+=d}}h+='  <div class="guild_job_memberlist_item_head">'+t_guildjob_member_self+"</div>";h+=c;h+='  <div class="guild_job_memberlist_item_head">'+t_guildjob_member_other+"</div>";h+=a;$("guild_job_box_inner").innerHTML=h;h+="</div>";for(var e=0;e<guild_job.members.length;e++){buildGuildJobMemberlistEntry(e)}}function buildGuildJobStock(){var d="";d+='<div id="guildstock">';d+='	<div id="guildstock_slots">';for(var c=1;c<=guild_job.config.stock_slots_max;c++){var l="showGuildJobStockInfo("+c+")";d+='<div id="guildstock_item'+c+'" class="guildstock_item link" onclick="'+l+'">';d+='  <div id="guildstock_item_img'+c+'" class="guildstock_item_img"></div>';d+='  <div id="guildstock_item_del'+c+'" class="guildstock_item_del shop_cart_item_del link"></div>';d+='  <div id="guildstock_item_amount'+c+'" class="guildstock_item_amount"></div>';d+='  <div id="guildstock_item_locked'+c+'" class="guildstock_item_locked"></div>';var a="guildstock_item_top";if(c>25){a="guildstock_item_bottom"}d+='  <div id="guildstock_item_tt'+c+'" class="guildstock_item_tt ttbox '+a+'"></div>';d+="</div>"}d+='    <div class="clear"></div>';d+="  </div>";d+='  <div id="guildstock_info"></div>';d+='  <div class="clear"></div>';d+="</div>";$("guild_job_box_inner").innerHTML=d;for(var c=1;c<=guild_job.config.stock_slots_max;c++){if(c>guild_job.config.stock_slots_base){var e="";var a="";if(!guild_job.stock.slots[c]||(guild_job.stock.slots[c]&&guild_job.stock.slots[c].finishdate==0)){if(guild_job.config.stock_expansion[c].level>guild_job.job.level){$("guildstock_item"+c).style.backgroundColor="coral";a="locked";e='<div class="important">'+str_replace("%LEVEL%",guild_job.config.stock_expansion[c].level,t_guildjob_stock_slot_locked)+"</div>"}else{if(guild_job.stock.slots[c]){a="locked_plus";e=t_guildjob_stock_slot_fill}else{$("guildstock_item"+c).style.backgroundColor="cornflowerblue";a="unlocked";e=t_guildjob_stock_slot_unlock}}}if(e!=""){$("guildstock_item"+c).onmouseover=new Function("showDiv('guildstock_item_tt"+c+"')");$("guildstock_item"+c).onmouseout=new Function("hideDiv('guildstock_item_tt"+c+"')");$("guildstock_item_tt"+c).innerHTML=e}$("guildstock_item_locked"+c).addClassName(a)}}var h=1;if(guild_job.stock.stock){for(var b in guild_job.stock.stock){if(guild_job.stock.stock[b]>0){while(h>guild_job.config.stock_slots_base&&!(guild_job.stock.slots[h]&&guild_job.stock.slots[h].finishdate>0)){h++;if(h>=guild_job.config.stock_slots_max){break}}if(checkGuildJobMemberStatus("delstockslot")){showDiv("guildstock_item_del"+h)}$("guildstock_item_del"+h).onclick=new Function("guildJobDialog('stock_product_delete', "+b+")");$("guildstock_item_img"+h).className="guildstock_item_img tt"+b;$("guildstock_item_amount"+h).innerHTML=guild_job.stock.stock[b];$("guildstock_item_tt"+h).innerHTML=produkt_name[b];$("guildstock_item"+h).onmouseover=new Function("showDiv('guildstock_item_tt"+h+"')");$("guildstock_item"+h).onmouseout=new Function("hideDiv('guildstock_item_tt"+h+"')")}h++}}}function buildGuildJobLog(){if(guild_job.stock_log){var b='<div style="height:415px; overflow:auto; width:100%;">';for(var a=0;a<guild_job.stock_log.length;a++){b+='<div style="margin-bottom:2px;">';b+='  <div style="float:left; width:120px; margin-right:5px;">'+guild_job.stock_log[a].time+"</div>";b+='  <div style="float:left; width:50px; text-align:right; margin-right:5px;">'+guild_job.stock_log[a].amount+"x</div>";b+='  <div style="float:left; margin-right:5px;" class="kp'+guild_job.stock_log[a].pid+'"></div>';b+='  <div style="float:left; width:100px; margin-right:5px;">'+produkt_name[guild_job.stock_log[a].pid]+"</div>";b+='  <div style="float:left; width:150px;">'+guild_job.stock_log[a].uname+"</div>";b+='  <div class="clear"></div>';b+="</div>"}b+="</div>";$("guild_job_box_inner").innerHTML=b}}function setGuildJobMemberlistJobConfirm(a){guildAction("job_confirm",{unr:guild_job.members[a].unr})}function buildGuildJobMemberlistEntry(l){var h=guild_job.members[l];var r=0;if(h.job&&h.job.currentjob){r=h.job.currentjob}if(h.status==1||h.status==2){$("guild_job_memberlist_status"+l).addClassName("guild_crown"+h.status)}$("guild_job_memberlist_name"+l).innerHTML=h.uname;var q="toogleDiv('guild_job_memberlist_data"+l+"')";$("guild_job_memberlist_name"+l).onclick=new Function(q);if(!r){var c=t_guildjob_memberjob_noselect}else{var e=getGuildJobMemberJobLevel(l,r);var c=guild_job.config.jobs[r].name+"&nbsp;("+e.level+")"}$("guild_job_memberlist_currentjob"+l).innerHTML='<div class="job_jobsymbol_mini job_jobsymbol'+r+'_mini link" onclick="showJobOverview();" style="float:left; transform:scale(0.5); margin:-16px 0px;"></div><div style="float:left; width:100px;">'+c+'</div><div class="clear"></div>';var b="";if(h.self&&guild_job.job.startdate==0){if(r>0){var n="";if(h.job.jobs[r].joined==1){n="checked"}b='<input id="guild_job_memberlist_checkbox" style="padding:0px; margin:0px;" class="link" type="checkbox" '+n+" onclick=\"guildJobDialog('job_check', "+l+')">'}}else{var m="";if(r>0&&h.job.jobs[r].joined==1){m="guildjob_job_confirm_confirmed"}b='<div class="'+m+'">&nbsp;</div>'}$("guild_job_memberlist_check"+l).innerHTML=b;var a="";if(checkGuildJobMemberStatus("confirmmember")&&guild_job.job.startdate==0){var n="";for(var d in guild_job.job.jobs){if(d==h.unr){n="checked"}}if(r>0&&h.job.jobs[r].joined==1){var a='<input id="guild_job_memberlist_confirmbox'+l+'" style="padding:0px; margin:0px;" class="link" type="checkbox" onclick="setGuildJobMemberlistJobConfirm('+l+')" '+n+">"}else{a="&nbsp;"}}else{if(r>0){var m="guildjob_job_confirm_wait";if(guild_job.job.jobs[h.unr]){m="guildjob_job_confirm_confirmed"}var a='<div class="'+m+'">&nbsp;</div>'}}$("guild_job_memberlist_join"+l).innerHTML=a;$("guild_job_memberlist_data"+l).innerHTML=getGuildJobMemberJobData(l);if(guild_job.job.startdate>0){hideDiv("guild_job_memberlist_item"+l);for(var d in guild_job.job.jobs){if(d==h.unr){showDiv("guild_job_memberlist_item"+l)}}}else{showDiv("guild_job_memberlist_item"+l)}}function getGuildJobMemberJobData(c){var b="";for(var a in guild_job.config.jobs){var d=getGuildJobMemberJobLevel(c,a);var e="";if(guild_job.members[c].job.currentjob==a){e="color:#0f0;"}b+='<div style="margin-bottom:2px;">';b+='  <div style="float:left; width:150px; '+e+'">'+guild_job.config.jobs[a].name+"</div>";b+='  <div style="float:left; margin-right:5px;">'+getGuildJobMemberJobLevelBar(d)+"</div>";b+='  <div class="clear"></div>';b+="</div>"}return b}function getGuildJobMemberJobLevel(c,b){var e={level:1,percent:0};if(guild_job.members[c].job.jobs&&guild_job.members[c].job.jobs[b]){var d=parseInt(guild_job.members[c].job.jobs[b].points);for(var m in guild_job.config.jobs_level){var a=parseInt(guild_job.config.jobs_level[m].points);if(d>=a){e.level=parseInt(m);if(!guild_job.config.jobs_level[(parseInt(m)+1)]){e.percent=100}else{var l=(guild_job.config.jobs_level[(parseInt(m)+1)].points-a);var h=(d-a);e.percent=((h*100)/l)}}}}return e}function getGuildJobMemberJobLevelBar(b){var a="";a+='<div style="float:left; margin-right:2px;">'+b.level+"</div>";a+='<div style="float:left; width:150px; height:12px; background-color:#000; margin-bottom:2px; overflow:hidden; border-radius:3px;">';a+='  <div style="width:'+b.percent+'%; height:12px; background-color:#f00;"></div>';a+="</div>";a+='<div class="clear"></div>';return a}function setGuildJobMemberFilter(){var b=$("guild_job_memberlist_filter").value;hideDiv("globaltransp");hideDiv("globalbox");for(var a=0;a<guild_job.members.length;a++){if(b==0){showDiv("guild_job_memberlist_item"+a)}else{if(b=="confirmed"){if(guild_job.job.jobs[guild_job.members[a].unr]){showDiv("guild_job_memberlist_item"+a)}else{hideDiv("guild_job_memberlist_item"+a)}}else{if(b=="unconfirmed"){if(!guild_job.job.jobs[guild_job.members[a].unr]){showDiv("guild_job_memberlist_item"+a)}else{hideDiv("guild_job_memberlist_item"+a)}}else{if(guild_job.config.jobs[b]){if(guild_job.members[a].job.currentjob&&guild_job.members[a].job.currentjob==b){showDiv("guild_job_memberlist_item"+a)}else{hideDiv("guild_job_memberlist_item"+a)}}}}}}}function showGuildJobStockInfo(c){$("guildstock_info").innerHTML="";if(guild_job.config.stock_expansion[c]&&guild_job.config.stock_expansion[c].level<=guild_job.job.level){var b="";if(!guild_job.stock.slots[c]){if(checkGuildJobMemberStatus("unlockstockslot")){b+=str_replace("%COUNT%",guild_job.config.stock_expansion[c].unlock,t_guildjob_stock_slot_entry_to_unlock);b+='<div class="button_new link" style="text-align:center; margin:10px 0px;" onclick="guildStockSlotUnlock('+c+')">'+t_unlock+"</div>"}}else{if(guild_job.stock.slots[c]&&guild_job.stock.slots[c].finishdate>0){return false}for(var a in guild_job.config.stock_expansion[c].products){b+=htmlGuildStockSlotEntry(c,a,guild_job.config.stock_expansion[c].products[a],"products")}for(var a in guild_job.config.stock_expansion[c].forestry){b+=htmlGuildStockSlotEntry(c,a,guild_job.config.stock_expansion[c].forestry[a],"forestry")}if(guild_job.config.stock_expansion[c].coins){b+=htmlGuildStockSlotEntry(c,0,guild_job.config.stock_expansion[c].coins,"coins")}}$("guildstock_info").innerHTML=b;showDiv("guildstock_info")}}function htmlGuildStockSlotEntry(w,l,h,s){var m=0;if(guild_job.stock.slots[w]){var c=guild_job.stock.slots[w].data;for(var d=0;d<c.length;d++){if(c[d].pid==l&&c[d].type==s){if(!m){m={}}if(!m[c[d].unr]){m[c[d].unr]=c[d].amount}else{m[c[d].unr]+=c[d].amount}}}}var r="";var b="l"+l;var a=produkt_name[l];if(s=="forestry"){b="f_symbol"+l;a=produkt_name_forestry[l];r="margin-left:15px;"}if(s=="coins"){b="icon_coins";var t=guild_job.config.stock_expansion[w][s];a=t_coins}else{var t=guild_job.config.stock_expansion[w][s][l]}var n=getGuildStockSlotAmount(w,l,s);var q=((n*100)/t);var v="link";var z="guildJobDialog('stock_slotentry', "+w+", "+l+", '"+s+"')";if(!getGuildStockProductAmount(l,s)||n>=t){v="";z=""}var u="";if(!getGuildStockProductAmount(l,s)){u="important"}var e="";e+='<div style="position:relative; margin-bottom:5px; min-height:50px;" class="'+v+'">';e+='  <div style="float:left; position:relative; margin-right:5px; margin-bottom:5px; border-radius:5px;" class="'+b+' link"></div>';e+='  <div style="float:left; position:relative; width:180px; margin-right:5px; '+r+'">';e+='    <div class="'+u+'" style="margin:2px 0px; float:left;">'+a+"</div>";if(m){e+='<div id="stockslotentry'+w+"_"+l+"_"+s+'" style="float:right;" class="link arrow_black_small_top" onclick="toogleGuildStockSlotEntries('+w+", "+l+", '"+s+"')\"></div>"}e+='    <div class="clear"></div>';e+='    <div class="guild_job_bar" style="width:100%; height:20px;" onclick="'+z+'">';e+='      <div class="guild_job_bar_inner" style="width:'+q+'%; background-color:#f00;"></div>';e+='      <div style="position:absolute; top:0px; left:0px; width:100%; text-align:center; margin-top:3px; color:#fff;">'+n+"/"+t+"</div>";e+="    </div>";e+="  </div>";e+='  <div class="clear"></div>';if(m){e+='<div id="guildstock_slotentries'+w+"_"+l+"_"+s+'_log" class="guildstock_slotentries_log">';for(unr in m){for(var d=0;d<guild_job.members_all.length;d++){if(unr==guild_job.members_all[d].unr){e+='<div style="margin-bottom:2px;">';e+='  <div style="float:left; width:120px;">'+guild_job.members_all[d].uname+"</div>";e+='  <div style="float:left; width:92px; text-align:right;">'+m[unr]+"</div>";e+='  <div class="clear"></div>';e+="</div>"}}}e+="</div>"}e+="</div>";return e}function toogleGuildStockSlotEntries(e,a,c){var d="stockslotentry"+e+"_"+a+"_"+c;var b="guildstock_slotentries"+e+"_"+a+"_"+c+"_log";if($(b).style.display=="block"){$(d).removeClassName("arrow_black_small_bottom").addClassName("arrow_black_small_top")}else{$(d).removeClassName("arrow_black_small_top").addClassName("arrow_black_small_bottom")}toogleDiv(b)}function checkGuildStockSlotEntry(l,a,d){if(d=="coins"){var c=guild_job.config.stock_expansion[l][d]}else{var c=guild_job.config.stock_expansion[l][d][a]}var e=getGuildStockSlotAmount(l,a,d);var b=(c-e);var h={stockamount:getGuildStockProductAmount(a,d),rest:b,click:"guildStockSlotEntry("+l+", "+a+", '"+d+"')"};checkEntryLine(h)}function getGuildStockProductAmount(a,b){var c=checkRackItem(a);if(b=="coins"){c=$("coins").innerHTML}if(b=="forestry"){c=checkForestryRackItem(a)}return c}function getGuildStockSlotAmount(h,b,d){var e=0;if(guild_job.stock.slots[h]&&guild_job.stock.slots[h]["data"]){var a=guild_job.stock.slots[h]["data"];for(var c=0;c<a.length;c++){if(a[c].type==d&&a[c].pid==b){e+=a[c].amount}}}return e}function guildJobRewardDialog(d){if(d.success){var b=t_guildjob_job_message_head;var a='<div style="margin-bottom:10px;">'+t_guildjob_job_success+"</div>";if(d.count>0){a+='<div class="guildjob_orderpoints" style="float:left; margin-left:60px; margin-right:5px;"></div><div style="float:left; margin-top:5px;">'+d.count+'</div><div class="clear"></div>'}}else{var b=t_guildjob_job_failed;var a=t_guildjob_job_failed_body}var c="";globalcommitbox(b,a,c)}function checkGuildJobEntry(a){var c=guild_job.job.data.products[a];var d=0;if(guild_job.job.data.entries&&guild_job.job.data.entries[a]){d=guild_job.job.data.entries[a]}var b=(c-d);var e={stockamount:guild_job.stock.stock[a],rest:b,click:"guildJobEntry("+a+")"};checkEntryLine(e)}function guild_jobCheckLevelAdd(){var a=$("guild_job_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>guild_job.job.count){a=guild_job.job.count}if(a>(guild_job.job.next_level_points-guild_job.job.points)){a=(guild_job.job.next_level_points-guild_job.job.points)}$("guild_job_dialog_leveladd_insert").value=a}function guildJobDialog(d,l,h,e){var q="";var n="";var t=0;var r=0;var a=0;if(d=="buy_points"){q=t_guildjob_points_buy;for(var u in guild_job.config.points_cost){var s=str_replace("%COUNT%",guild_job.config.points_cost[u],t_guildjob_points_buy_body);s=str_replace("%COINS%",u,s);n+='<div class="coinsbutton_flex link" style="margin-bottom:10px; font-size:11px; font-weight:normal;" onclick="guildJobDialog(\'buy_points_commit\', '+u+')">'+s+"</div>"}a=1}if(d=="buy_points_commit"){q=t_guildjob_points_buy;var n=str_replace("%COUNT%",guild_job.config.points_cost[l],t_guildjob_points_buy_body);n=str_replace("%COINS%",l,n);t="guildJobBuyPoints("+l+")"}if(d=="add_jobmember"){q=t_guildjob_addmember_head;n=str_replace("%AMOUNT%",guild_job.job.addmember_cost,t_guildjob_addmember_body);t="guildJobAddMember()"}if(d=="job_entry"){var c={pid:l};globalcommitbox(t_inner_feedsubmit,htmlEntryLine(c),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("checkGuildJobEntry("+l+")");$("dialog_entryline_number").onkeyup=new Function("checkGuildJobEntry("+l+")");checkGuildJobEntry(l);return false}if(d=="add_level"){var q=t_guildjob_level_plus_head;var n=htmlLevelAddDialog("guild_job")}if(d=="job_check"){var b=guild_job.members[l].job;if(b.jobs[b.currentjob].joined==1){q=t_guildjob_check_head2;n=t_guildjob_check_body2;if($("guild_job_memberlist_checkbox")){$("guild_job_memberlist_checkbox").checked=true}}else{q=t_guildjob_check_head;n=t_guildjob_check_body;if($("guild_job_memberlist_checkbox")){$("guild_job_memberlist_checkbox").checked=false}}t="guildJobJoin()"}if(d=="stock_slotentry"){var c={slot:l,pid:h,type:e};globalcommitbox(t_inner_feedsubmit,htmlEntryLine(c),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("checkGuildStockSlotEntry("+l+", "+h+", '"+e+"')");$("dialog_entryline_number").onkeyup=new Function("checkGuildStockSlotEntry("+l+", "+h+", '"+e+"')");checkGuildStockSlotEntry(l,h,e);return false}if(d=="stock_product_delete"){q=t_guildjob_stock_pid_delete_head;n=str_replace("%PRODUCT%",produkt_name[l],t_guildjob_stock_pid_delete_body);t="guildStockDeleteProduct("+l+")"}if(d=="gamble_job"){q=t_megafield_new_jobs_head;n=str_replace("%COINS%",guild_job.config.job_gamble_coins,t_guildjob_change_jobs);t="guildJobGamble()"}globalcommitbox(q,n,t,r,a)}function guildJobTimer(){guild_job.job.remain--;guildJobTimerContentUpdater();for(var a in guild_job_stats_cache_delay){guild_job_stats_cache_delay[a]--}}function guildJobTimerContentUpdater(){if($("guild_job_jobselect_timer")){if(guild_job.job.remain>0){showDiv("guild_job_jobselect_timer_bar");hideDiv("guild_job_finish_button");if(guild_job.job.startdate>0){var b=t_guildjob_jobrunning_time}else{var b=t_guildjob_jobselect_time}$("guild_job_jobselect_timer").innerHTML=str_replace("%TIME%",formatTime(guild_job.job.remain),b);var a=100-((guild_job.job.remain*100)/guild_job.config.job_duration);$("guild_job_jobselect_timer_bar_inner").style.width=a+"%"}if(guild_job.job.remain<=0){if(guild_job.job.remain==-1&&guild_job.job.startdate==0){guildJobInit()}else{hideDiv("guild_job_jobselect_timer_bar");showDiv("guild_job_finish_button")}}}}var guild_job_stats_cache={};var guild_job_stats_cache_delay={};var guild_job_stats_select="points";function showGuildJobStats(d){var c="";c+='<div id="guild_job_stats_select_line">';c+=' <select id="guild_job_stats_select" onchange="guildJobStats()">';var a=["points","job1","job2","job3"];for(var b=0;b<a.length;b++){var e="";if(guild_job_stats_select==a[b]){e="selected"}c+='<option value="'+a[b]+'" '+e+">"+t_guildjob_stats[a[b]]+"</option>"}c+=" </select>";c+="</div>";c+='<div class="headline">'+t_guildjob_stats_headlines[guild_job_stats_select]+"</div>";c+='<div class="guild_job_stats_list">';c+=htmlStatsContent(guild_job_stats_cache[d]);c+='<div class="mini_close link" onclick="closeGuildJobStats()"></div>';$("guild_job_stats_box").innerHTML=c;showDiv("guild_job_stats_box_transp");showDiv("guild_job_stats_box")}function closeGuildJobStats(){hideDiv("guild_job_stats_box_transp");hideDiv("guild_job_stats_box")}function checkGuildJobMemberStatus(a){if(in_array(a,["levelbar","gamble","jobentry","confirmmember","finishjob","startjob","unlockstockslot","addmemberspace","delstockslot"])&&in_array(player_guildmemberstatus,[1,2])){return 1}return 0}var hillwalk=function(){this.data={};this.tour={};this.tourString="";this.tourNeed={};this.tourReward={};this.tourHelper={stamina:0,duration:0};this.tourLastStage=0;this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.page=1;this.drawingsInStage=0;this.drawingsCount=0};hillwalk.prototype.stats=function(){if($("hillwalk_stats_select")){hillwalk.stats_select=$("hillwalk_stats_select").value}if(hillwalk.stats_cache_delay[hillwalk.stats_select]<=0||!hillwalk.stats_cache[this.stats_select]){hillwalk.action("hillwalk_stats",{type:hillwalk.stats_select})}else{hillwalk.showStats(hillwalk.stats_select)}};hillwalk.prototype.addLevel=function(){hillwalk.action("hillwalk_add_level",{amount:$("hillwalk_dialog_leveladd_insert").value})};hillwalk.prototype.buyAddLevel=function(){hillwalk.action("hillwalk_buy_add_level")};hillwalk.prototype.start=function(){hillwalk.action("hillwalk_start_tour",{tour:"{"+this.tourString+"}",helper_stamina:this.tourHelper.stamina,helper_duration:this.tourHelper.duration})};hillwalk.prototype.finish=function(){hillwalk.action("hillwalk_finish_tour")};hillwalk.prototype.init=function(){hillwalk.action("hillwalk_init")};hillwalk.prototype.action=function(a,b){ajaxAction("farm",a,b,hillwalk.response)};hillwalk.prototype.response=function(b,a,c){showDiv("hillwalk");if(a=="hillwalk_finish_tour"){hideDiv("hillwalk_book");hideDiv("hillwalk_transp");showDiv("hillwalk_plan");hillwalk.tour={};hillwalk.tourString="";hillwalk.tourNeed={};hillwalk.tourHelper={stamina:0,duration:0};hillwalk.tourLastStage=0;$("hillwalk_helper_stamina").className="link helper helper0";$("hillwalk_helper_duration").className="link helper helper0"}hillwalk.build();hillwalk.update();hillwalk.timerUpdate();if(b.stats){hillwalk.stats_cache_delay[hillwalk.stats_select]=30;if(!hillwalk.stats_cache[hillwalk.stats_select]){hillwalk.stats_cache[hillwalk.stats_select]={}}hillwalk.stats_cache[hillwalk.stats_select]=b.stats;hillwalk.showStats()}if(b.book&&b.book.length>0){hillwalk.bookEntry(b.book)}if(b.first==1){hillwalk.help()}};hillwalk.prototype.update=function(){if(this.data.data.tour&&this.data.data.tour.remain>0){this.tourLastStage=0;this.tour=this.data.data.tour.tour}this.drawingsStats();this.need();this.stages();this.hunt()};hillwalk.prototype.build=function(){var a="";a+=htmlLevelBar("hillwalk");a+=htmlCountBar("hillwalk");$("hillwalk_header").innerHTML=a;$("hillwalk_levelbar_number").innerHTML=this.data.data.level;$("hillwalk_countbar_inner").innerHTML=formatNumber(this.data.data.count);$("hillwalk_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var b=t_reached_maxlevel;hideDiv("hillwalk_levelbar_plus")}else{var b=str_replace("%AMOUNT%",formatNumber(this.data.data.level_rest),t_hillwalk_level_line);$("hillwalk_levelbar_plus").onclick=new Function("hillwalk.addLevelCommit()");$("hillwalk_levelbar_plus_tt").innerHTML=t_hillwalk_leveladd_tt}$("hillwalk_levelbar_tt").innerHTML=b;$("hillwalk_countbar_plus_tt").innerHTML=t_hillwalk_levelitem_buy;$("hillwalk_countbar_plus").onclick=new Function("hillwalk.buyAddLevelCommit()")};hillwalk.prototype.addLevelCommit=function(){var b=t_hillwalk_dialog_leveladd_head;var a=htmlLevelAddDialog("hillwalk");globalcommitbox(b,a,0,0,1)};hillwalk.prototype.addLevelCheck=function(){var a=$("hillwalk_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>hillwalk.data.data.count){a=hillwalk.data.data.count}$("hillwalk_dialog_leveladd_insert").value=a};hillwalk.prototype.buyAddLevelCommit=function(c){var d=t_hillwalk_levelitem_buy;var b=str_replace("%COINS%",hillwalk.data.data.exchangecoins,t_hillwalk_levelitem_buy_dialog);b=str_replace("%AMOUNT%",(hillwalk.data.data.exchangeamount),b);if(!c){var a='<div class="link coinsbutton_flex" onclick="hillwalk.buyAddLevelCommit(1)">'+b+"</div>";globalcommitbox(d,a,0,0,1)}else{var a=b;var e="hillwalk.buyAddLevel()";globalcommitbox(d,a,e)}};hillwalk.prototype.stages=function(){var c="";c+='<div id="hillwalk_stage_start" class="stage start link" onclick="mapGo2Location(\'farm\', '+farm+')" onmouseover="showDiv(\'hillwalk_stage_start_tt\')" onmouseout="hideDiv(\'hillwalk_stage_start_tt\')">';c+='  <div id="hillwalk_stage_start_tt" class="ttbox">'+t_back_to_farm+"&nbsp;"+farm+"</div>";c+='  <div id="hillwalk_stage_start_lines" class="lines"></div>';c+='  <div id="hillwalk_stage_start_img"></div>';c+="</div>";for(var b in this.data.config.stages){var l=0;var d="hillwalk.clickStage("+b+")";var a="";if(this.data.data.level<this.data.config.stages[b].level){l=1;d=""}var h=0;if(this.tour){for(var m in this.tour){if(m>0&&this.tour[m]==b){a="active"}h=this.tour[m]}}c+='<div id="hillwalk_stage'+b+'" class="stage stage'+b+'" onclick="'+d+'">';c+='  <div id="hillwalk_stage'+b+'_lines" class="lines"></div>';c+='  <div id="hillwalk_stage'+b+'_img" class="img cat'+this.data.config.stages[b].category+" "+a+'" onmouseover="hillwalk.stageInfo('+b+')" onmouseout="hillwalk.stageInfo('+b+', 1)">';if(b==h){c+='<div class="current"></div>'}if(this.data.data.fav==b){c+='<div class="fav"></div>'}if(this.data.hunt&&this.data.hunt.stage==b){c+='<div class="hunt" onmouseover="showDiv(\'hillwalk_stage_hunt_tt\')" onmouseout="hideDiv(\'hillwalk_stage_hunt_tt\')">';c+='  <div id="hillwalk_stage_hunt_tt" class="ttbox">'+t_hillwalk_hunt_info+"</div>";c+="</div>"}if(l){c+='<div class="locked"></div>'}if(this.data.config.stages[b].start){var e="start";if(this.tourString!=""){if(this.tour[1]!=b){e="finish"}}c+='<div id="hillwalk_starter'+b+'" class="'+e+'"></div>'}c+="  </div>";c+="</div>"}$("hillwalk_stages").innerHTML=c;this.checkStartButton();this.showInfo();this.drawLines()};hillwalk.prototype.checkStartButton=function(){$("hillwalk_tourstart").addClassName("inactive");var c="";var b=0;if(this.tour){if(this.tourLastStage<=1||!this.tour[this.tourLastStage]||!this.data.config.stages[this.tour[this.tourLastStage]].start){b=1;c+="<div>"+t_hillwalk_start_failed1+"</div>"}for(var a in this.tourNeed.products){if(checkRackItem(a,farm)<this.tourNeed.products[a]){b=2;c+="<div>"+str_replace("%FARM%",6,t_hillwalk_start_failed2)+"</div>";break}}if((this.data.config.level[this.data.data.level].stamina-this.tourNeed.stamina)<0){b=3;c+="<div>"+t_hillwalk_start_failed3+"</div>"}if(this.tourNeed.money>0&&this.tourNeed.money>user_bar){b=4}if(this.tourNeed.hillwalk_points>0&&this.tourNeed.hillwalk_points>parseInt(this.data.data.count)){b=4}if(this.tourNeed.coins>0&&this.tourNeed.coins>user_coins){b=4}if(b==4){c+="<div>"+t_hillwalk_start_failed4+"</div>"}if(!b){$("hillwalk_tourstart").removeClassName("inactive");$("hillwalk_tourstart").onmouseover=new Function("");$("hillwalk_tourstart").onmouseout=new Function("")}else{$("hillwalk_tourstart_tt").innerHTML=c;$("hillwalk_tourstart").onmouseover=new Function("showDiv('hillwalk_tourstart_tt')");$("hillwalk_tourstart").onmouseout=new Function("hideDiv('hillwalk_tourstart_tt')")}}};hillwalk.prototype.stageInfo=function(d,h){if(h){hideDiv("hillwalk_stage_info");return true}var e=0;var l=1;if(this.data.data.level<this.data.config.stages[d].level){e=1}if(this.data.data.fav==d){l=this.data.config.fav_bonus}var c="";c+='<div class="name">'+this.data.config.stages[d].name+"</div>";c+='<div class="info">';c+='<div class="need">';c+='  <div class="bold">'+t_hillwalk_stage_needs+"</div>";c+="  <div>"+this.data.config.stages[d].stamina+"&nbsp;"+t_hillwalk_stamina+"</div>";c+="  <div>"+formatTime(this.data.config.stages[d].duration)+"</div>";if(this.data.config.stages[d].coins){c+="<div>"+this.data.config.stages[d].coins+"&nbsp;"+t_coins+"</div>"}if(this.data.config.stages[d].money){c+="<div>"+formatPrice(this.data.config.stages[d].money)+"</div>"}if(this.data.config.stages[d].hillwalk_points){c+="<div>"+formatNumber(this.data.config.stages[d].hillwalk_points)+"&nbsp;"+t_hillwalk_points+"</div>"}for(var b in this.data.data.stages[d]){var a="";if(checkRackItem(b,farm)<this.data.data.stages[d][b]){a="important"}c+='<div class="'+a+'">'+htmlProductBody(b,this.data.data.stages[d][b])+"</div>"}if(e){c+='<div class="important">'+t_hillwalk_level_info.replace("%LEVEL%",this.data.config.stages[d].level)+"</div>"}c+="</div>";c+='<div class="reward">';c+='  <div class="bold">'+t_vet_reward_head+":</div>";if(this.data.config.stages[d].reward.points){c+="<div>"+formatNumber(Math.ceil(this.data.config.stages[d].reward.points*l))+"&nbsp;"+t_points+"</div>"}if(this.data.config.stages[d].reward.money){c+="<div>"+formatPrice(Math.ceil(this.data.config.stages[d].reward.money*l))+"</div>"}if(this.data.config.stages[d].reward.hillwalk_points){c+="<div>"+formatNumber(Math.ceil(this.data.config.stages[d].reward.hillwalk_points*l))+"&nbsp;"+t_hillwalk_points+"</div>"}if(this.data.config.stages[d].recovery){c+="<div>"+t_hillwalk_recovery.replace("%AMOUNT%",this.data.config.stages[d].recovery)+"</div>"}if(this.data.data.fav==d){c+="<div>"+t_hillwalk_fav_bonus.replace("%AMOUNT%",Math.ceil((this.data.config.fav_bonus-1)*100))+"</div>"}c+="  </div>";c+="</div>";$("hillwalk_stage_info").innerHTML=c;showDiv("hillwalk_stage_info")};hillwalk.prototype.drawLines=function(){var e={};for(var l in this.data.config.stages){var q=parseInt($("hillwalk_stage"+l).getStyle("left"));var m=parseInt($("hillwalk_stage"+l).getStyle("bottom"));for(var d=0;d<this.data.config.stages[l].neighbors.length;d++){var b=this.data.config.stages[l].neighbors[d];if(!(e[l]&&e[l][b])&&!(e[b]&&e[b][l])){var t=parseInt($("hillwalk_stage"+b).getStyle("left"));var s=parseInt($("hillwalk_stage"+b).getStyle("bottom"));var a=Math.ceil(Math.sqrt(Math.pow(t-q,2)+Math.pow(s-m,2)));var h=Math.ceil(Math.atan2((m-s),(t-q))*180/Math.PI);var n='<div class="angel" style="transform:rotate('+h+'deg);">';n+='  <div id="hillwalk_stage_line'+l+"_"+b+'" class="line" style="width:'+a+'px;"></div>';n+="</div>";$("hillwalk_stage"+l+"_lines").insert(n);if(!e[l]){e[l]={}}e[l][b]=1;if(!e[b]){e[b]={}}e[b][l]=1}}}var q=parseInt($("hillwalk_stage_start").getStyle("left"));var m=parseInt($("hillwalk_stage_start").getStyle("bottom"));for(var l=1;l<=3;l++){var t=parseInt($("hillwalk_stage"+l).getStyle("left"));var s=parseInt($("hillwalk_stage"+l).getStyle("bottom"));var a=Math.ceil(Math.sqrt(Math.pow(t-q,2)+Math.pow(s-m,2)));var h=Math.ceil(Math.atan2((m-s),(t-q))*180/Math.PI);var n='<div class="angel" style="transform:rotate('+h+'deg);">';n+='  <div id="hillwalk_stage_line_start_'+l+'" class="line" style="width:'+a+'px;"></div>';n+="</div>";$("hillwalk_stage_start_lines").insert(n)}var c=0;if(this.tour){var r=0;for(var l in this.tour){r++}for(var l in this.tour){if(l==1){$("hillwalk_stage_line_start_"+this.tour[l]).addClassName("active")}if(l==r&&$("hillwalk_stage_line_start_"+this.tour[l])){$("hillwalk_stage_line_start_"+this.tour[l]).addClassName("active")}if(!c){c=this.tour[l];continue}if($("hillwalk_stage_line"+c+"_"+this.tour[l])){$("hillwalk_stage_line"+c+"_"+this.tour[l]).addClassName("active")}if($("hillwalk_stage_line"+this.tour[l]+"_"+c)){$("hillwalk_stage_line"+this.tour[l]+"_"+c).addClassName("active")}c=this.tour[l]}}};hillwalk.prototype.showInfo=function(){var d="";all=1;for(var e in this.tourNeed.products){var r="";if(checkRackItem(e,farm)<this.tourNeed.products[e]){r="important";all=0}d+='<div class="'+r+'">'+htmlProductBody(e,this.tourNeed.products[e])+"</div>"}$("hillwalk_products").innerHTML=d;if(this.tourNeed.money>0){$("hillwalk_money").innerHTML=formatPrice(this.tourNeed.money)}else{$("hillwalk_money").innerHTML=""}if(this.tourNeed.hillwalk_points>0){$("hillwalk_points").innerHTML=formatNumber(this.tourNeed.hillwalk_points)+"&nbsp;"+t_hillwalk_points}else{$("hillwalk_points").innerHTML=""}if(this.tourNeed.coins>0){$("hillwalk_coins").innerHTML=this.tourNeed.coins+"&nbsp;"+t_coins}else{$("hillwalk_coins").innerHTML=""}if(this.tourNeed.money>0&&this.tourNeed.money>user_bar){$("hillwalk_money").addClassName("important")}else{$("hillwalk_money").removeClassName("important")}if(this.tourNeed.hillwalk_points>0&&this.tourNeed.hillwalk_points>parseInt(this.data.data.count)){$("hillwalk_points").addClassName("important")}else{$("hillwalk_points").removeClassName("important")}if(this.tourNeed.coins>0&&this.tourNeed.coins>user_coins){$("hillwalk_coins").addClassName("important")}else{$("hillwalk_coins").removeClassName("important")}var s=this.tourReward.points;var a=this.tourReward.money;var t=this.tourReward.hillwalk_points;if(this.tour){var h=0;for(var c in this.tour){h++}}if(h>0){var q=this.data.config.stagecountbonus[h]}var d='<div class="bold">'+t_vet_reward_head+":</div>";if(this.tourReward.points){d+="<div>"+formatNumber(s)+" "+t_points+"</div>"}if(this.tourReward.money){d+="<div>"+formatPrice(a)+"</div>"}if(this.tourReward.hillwalk_points){d+="<div>"+formatNumber(t)+" "+t_hillwalk_points+"</div>"}if(h>0&&q.points>1){d+='<div class="stagebonus">'+str_replace("%AMOUNT%",Math.round((q.points-1)*100),t_hillwalk_stage_bonus)+"</div>"}$("hillwalk_reward").innerHTML=d;var m=(this.data.config.level[this.data.data.level].stamina-this.tourNeed.stamina);if(this.data.data.tour&&this.data.data.tour.remain>0){}else{if(this.tourLastStage>0){for(var c=0;c<this.data.config.stages[this.tour[this.tourLastStage]].neighbors.length;c++){var b=this.data.config.stages[this.tour[this.tourLastStage]].neighbors[c];if(this.data.data.level<this.data.config.stages[b].level){continue}if(!$("hillwalk_stage"+b+"_img").hasClassName("active")){$("hillwalk_stage"+b+"_img").addClassName("valid").addClassName("pulse");if(m<this.getStageStamina(b)){$("hillwalk_stage"+b+"_img").removeClassName("valid").removeClassName("pulse").addClassName("exhausted")}}}}else{for(var c in this.data.config.stages){if(this.data.config.stages[c].start){$("hillwalk_stage"+c+"_img").addClassName("valid").addClassName("pulse")}}}}$("hillwalk_stamina").removeClassName("important");if(m<0){$("hillwalk_stamina").addClassName("important")}$("hillwalk_duration").innerHTML=formatTime(this.tourNeed.time);$("hillwalk_stamina").innerHTML=(this.data.config.level[this.data.data.level].stamina-this.tourNeed.stamina)+"/"+this.data.config.level[this.data.data.level].stamina;var l=Math.min((this.tourNeed.stamina*100)/this.data.config.level[this.data.data.level].stamina,100);$("hillwalk_stamina_bar_inner").style.width=(100-l)+"%";this.checkStartButton()};hillwalk.prototype.timer=function(){if(this.data&&this.data.data&&this.data.data.tour){this.data.data.tour.remain--;this.timerUpdate()}};hillwalk.prototype.timerUpdate=function(){if(this.data&&this.data.data&&this.data.data.tour){for(var l in farms_data.farms){for(var m in farms_data.farms[l]){var h=parseInt(farms_data.farms[l][m].buildingid);if(h!=22||!$("farm"+l+"_pos"+m)){continue}var a="";if(xmastime){a="xmas"}var d='<div id="farm'+l+"_pos"+m+'_statusline_alpin" class="farm_production_timer alpin '+a+'">';d+='  <div class="col1"></div>';d+='  <div id="farm'+l+"_pos"+m+'_statusline_alpin_timer" class="col2"></div>';d+='  <div class="clear"></div>';d+="</div>";if(!$("farm"+l+"_pos"+m+"_statusline_alpin")){$("farm"+l+"_pos"+m).insert(d)}if($("farm"+l+"_pos"+m+"_statusline_alpin")){$("farm"+l+"_pos"+m).onmouseover=new Function("$('farm"+l+"_pos"+m+"_statusline_alpin').addClassName('farm_production_timer_hover')");$("farm"+l+"_pos"+m).onmouseout=new Function("$('farm"+l+"_pos"+m+"_statusline_alpin').removeClassName('farm_production_timer_hover')");if(this.data.data.tour.remain>0){d=formatTime(this.data.data.tour.remain)}else{d=statusProductionComplete;found=0;for(var c=0;c<farm_checker.length;c++){if(farm_checker[c].farm==l&&farm_checker[c].position==m){found++}}if(!found){var b={pid:1,farm:l,position:m,type:"hillwalk"}}}$("farm"+l+"_pos"+m+"_statusline_alpin_timer").innerHTML=d}}}if($("hillwalk")&&$("hillwalk").style.display=="block"){showDiv("hillwalk_transp");hideDiv("hillwalk_plan");if(this.data.data.tour.remain<=0){hideDiv("hillwalk_progress");var d='<div id="hillwalk_tour_finished">';d+='  <div style="font-weight:bold;">'+t_vet_reward_head+"</div>";if(this.data.reward){if(this.data.reward.points){d+="<div>"+formatNumber(this.data.reward.points)+"&nbsp;"+t_points+"</div>"}if(this.data.reward.money){d+="<div>"+formatPrice(this.data.reward.money)+"</div>"}if(this.data.reward.hillwalk_points){d+="<div>"+formatNumber(this.data.reward.hillwalk_points)+"&nbsp;"+t_hillwalk_points+"</div>"}}d+='  <div class="button_new link" onclick="hillwalk.finish()">'+t_hillwalk_tour_end_reward+"</div>";d+="</div>";globalcommitbox(t_hillwalk_tour_end,d,0,0,1);hideDiv("globalbox_close")}else{var e=100-((this.data.data.tour.remain*100)/this.data.data.tour.duration);$("hillwalk_progress_bar_inner").style.width=Math.min(e,100)+"%";$("hillwalk_progress_bar_timer").innerHTML=formatTime(this.data.data.tour.remain);showDiv("hillwalk_progress")}}}};hillwalk.prototype.need=function(){this.tourLastStage=0;this.tourString="";this.tourNeed={time:this.data.config.duration_base,stamina:0,money:0,coins:0,hillwalk_points:0,products:{}};this.tourReward={points:0,money:0,hillwalk_points:0};var b=0;for(var c in this.tour){if(c>0){this.tourNeed.time+=this.getStageDuration(this.tour[c]);this.tourNeed.stamina+=this.getStageStamina(this.tour[c]);if(this.data.config.stages[this.tour[c]].recovery){this.tourNeed.stamina=Math.max(this.tourNeed.stamina-this.data.config.stages[this.tour[c]].recovery,0)}if(this.data.config.stages[this.tour[c]].money){this.tourNeed.money+=this.data.config.stages[this.tour[c]].money}if(this.data.config.stages[this.tour[c]].coins){this.tourNeed.coins+=this.data.config.stages[this.tour[c]].coins}if(this.data.config.stages[this.tour[c]].hillwalk_points){this.tourNeed.hillwalk_points+=this.data.config.stages[this.tour[c]].hillwalk_points}if(this.data.data.stages[this.tour[c]]){for(var a in this.data.data.stages[this.tour[c]]){if(!this.tourNeed.products[a]){this.tourNeed.products[a]=0}this.tourNeed.products[a]+=this.data.data.stages[this.tour[c]][a]}}this.tourString+='"'+c+'":'+this.tour[c]+",";this.tourLastStage=c;if(this.data.config.stages[this.tour[c]].reward.points){this.tourReward.points+=this.data.config.stages[this.tour[c]].reward.points}if(this.data.config.stages[this.tour[c]].reward.money){this.tourReward.money+=this.data.config.stages[this.tour[c]].reward.money}if(this.data.config.stages[this.tour[c]].reward.hillwalk_points){this.tourReward.hillwalk_points+=this.data.config.stages[this.tour[c]].reward.hillwalk_points}b++}}if(this.data.config.stagecountbonus[b]){bonus=this.data.config.stagecountbonus[b];this.tourReward.points=Math.ceil(this.tourReward.points*bonus.points);this.tourReward.money=Math.ceil(this.tourReward.money*bonus.money);this.tourReward.hillwalk_points=Math.ceil(this.tourReward.hillwalk_points*bonus.hillwalk_points)}if(this.tourHelper.stamina>0){if(this.data.config.helper[this.tourHelper.stamina].money){this.tourNeed.money+=this.data.config.helper[this.tourHelper.stamina].money}if(this.data.config.helper[this.tourHelper.stamina].coins){this.tourNeed.coins+=this.data.config.helper[this.tourHelper.stamina].coins}}if(this.tourHelper.duration>0){if(this.data.config.helper[this.tourHelper.duration].money){this.tourNeed.money+=this.data.config.helper[this.tourHelper.duration].money}if(this.data.config.helper[this.tourHelper.duration].coins){this.tourNeed.coins+=this.data.config.helper[this.tourHelper.duration].coins}}this.tourString=this.tourString.substring(0,this.tourString.length-1)};hillwalk.prototype.clickStage=function(b){var l=this.data.config.level[this.data.data.level].stamina;var d=0;var a=0;var h=1;for(var c in this.tour){if(c>0){h++;if(this.tour[c]==b){a=1}if(a==1){delete this.tour[c]}else{d+=this.getStageStamina(this.tour[c]);if(this.data.config.stages[this.tour[c]].recovery){d=Math.max(d-this.data.config.stages[this.tour[c]].recovery,0)}}}}if(!a){var e=0;if(h==1){if(this.data.config.stages[b].start){e=1}}else{if(in_array(b,this.data.config.stages[this.tour[(h-1)]].neighbors)){e=1}}if(e&&(l-d)>=this.getStageStamina(b)){this.tour[h]=b}}this.update()};hillwalk.prototype.showHelper=function(e){var d='<div id="hillwalk_helper_select">';d+='<div class="item">';if(e=="stamina"){var a=t_hillwalk_helper_stamina_remove}if(e=="duration"){var a=t_hillwalk_helper_duration_remove}d+='  <div class="button_new link" onclick="hillwalk.addHelper(\''+e+"', 0)\">"+a+"</div>";d+="</div>";for(var c in this.data.config.helper){if(this.data.config.helper[c].type==e){d+='<div class="item">';d+='  <div class="img helper helper'+c+'"></div>';d+='  <div class="info">';d+='    <div class="name">'+this.data.config.helper[c].name+"</div>";d+="    <div>"+t_hillwalk_helper[e].replace("%PERCENT%",Math.floor((1-this.data.config.helper[c].reduction)*100))+"</div>";if(this.data.config.helper[c].coins){d+='<div class="cost">'+cityadcost+this.data.config.helper[c].coins+"&nbsp;"+t_coins+"</div>"}if(this.data.config.helper[c].money){d+='<div class="cost">'+cityadcost+formatPrice(this.data.config.helper[c].money)+"</div>"}d+='    <div class="button_new link" onclick="hillwalk.addHelper(\''+e+"', "+c+')">'+t_hillwalk_helper_add+"</div>";d+="  </div>";d+='  <div class="clear"></div>';d+="</div>"}}d+="</div>";if(e=="stamina"){var b=t_hillwalk_helper_stamina_head}if(e=="duration"){var b=t_hillwalk_helper_duration_head}globalBoxFlex(b,d,0,0,1)};hillwalk.prototype.addHelper=function(a,b){$("hillwalk_helper_"+a).className="link helper helper"+b;this.tourHelper[a]=b;hideDiv("globaltransp");hideDiv("globalbox");this.update()};hillwalk.prototype.getStageStamina=function(a){var b=this.data.config.stages[a].stamina;if(this.tourHelper.stamina>0){b=Math.ceil(b*this.data.config.helper[this.tourHelper.stamina].reduction)}return b};hillwalk.prototype.getStageDuration=function(a){var b=this.data.config.stages[a].duration;if(this.tourHelper.duration>0){b=Math.ceil(b*this.data.config.helper[this.tourHelper.duration].reduction)}return b};hillwalk.prototype.startCommit=function(){if($("hillwalk_tourstart").hasClassName("inactive")){return 0}var b='<div id="hillwalk_startcommit">';b+='  <div class="block">';b+='    <div class="bold">'+t_pony_tt_need+"</div>";for(var a in this.tourNeed.products){b+=htmlProductBody(a,this.tourNeed.products[a])}if(this.tourNeed.money>0){b+="<div>"+formatPrice(this.tourNeed.money)+"</div>"}if(this.tourNeed.coins>0){b+="<div>"+this.tourNeed.coins+"&nbsp;"+t_coins+"</div>"}if(this.tourNeed.hillwalk_points>0){b+="<div>"+formatNumber(this.tourNeed.hillwalk_points)+"&nbsp;"+t_hillwalk_points+"</div>"}b+="  </div>";b+='  <div class="block">';b+='    <div class="bold">'+t_vet_reward_head+":</div>";if(this.tourReward.points){b+="<div>"+formatNumber(this.tourReward.points)+"&nbsp;"+t_points+"</div>"}if(this.tourReward.money){b+="<div>"+formatPrice(this.tourReward.money)+"</div>"}if(this.tourReward.hillwalk_points){b+="<div>"+formatNumber(this.tourReward.hillwalk_points)+"&nbsp;"+t_hillwalk_points+"</div>"}b+="  </div>";b+="</div>";var c="hillwalk.start()";globalcommitbox(t_hillwalk_tour_start,b,c)};hillwalk.prototype.drawingsStats=function(){this.drawingsInStage={};this.drawingsCount=0;for(var b in this.data.config.stages){if(!this.data.config.stages[b].drawings){continue}for(var a=0;a<this.data.config.stages[b].drawings.pool.length;a++){this.drawingsInStage[this.data.config.stages[b].drawings.pool[a]]=b;this.drawingsCount++}}};hillwalk.prototype.book=function(){var d=t_hillwalk_book;var c="";c+='<div id="hillwalk_book_page1" class="page"></div>';c+='<div id="hillwalk_book_page2" class="page"></div>';c+='<div class="clear"></div>';c+='<div class="navi">';c+='  <div id="hillwalk_book_navi_left" class="link" onclick="hillwalk.bookNavi(-1)"></div>';c+='  <div id="hillwalk_book_navi_right" class="link" onclick="hillwalk.bookNavi(1)"></div>';c+='  <div class="clear"></div>';c+="</div>";c+='<div class="subnavi">';var a=0;for(var b in this.data.config.stages){if(!this.data.config.stages[b].drawings){continue}c+='<div id="hillwalk_book_subnavi_'+b+'" class="link link'+b+'" onclick="hillwalk.page='+((Math.ceil((a+1)/2)*2)-1)+'; hillwalk.bookNavi();" onmouseover="showDiv(\'hillwalk_book_subnavi_'+b+"_tt')\" onmouseout=\"hideDiv('hillwalk_book_subnavi_"+b+"_tt')\">";c+='  <div id="hillwalk_book_subnavi_'+b+'_tt" class="ttbox">'+this.data.config.stages[b].name+"</div>";c+="</div>";a+=this.data.config.stages[b].drawings.pool.length}c+="</div>";c+="<div class=\"mini_close link\" onclick=\"hideDiv('hillwalk_book'); hideDiv('hillwalk_transp')\"></div>";$("hillwalk_book").innerHTML=c;showDiv("hillwalk_book");showDiv("hillwalk_transp");this.bookNavi()};hillwalk.prototype.drawPage=function(d){var c=1;if(d%2==0){c=2}var b="";if(this.drawingsInStage[d]){if(in_array(d,this.data.data.book)){b+='<div class="drawing drawing'+d+'"></div>'}b+='<div class="page_count">'+d+"</div>";b+='<div class="headline">'+this.data.config.stages[this.drawingsInStage[d]].name+"</div>";for(var a in this.drawingsInStage){$("hillwalk_book_subnavi_"+this.drawingsInStage[a]).removeClassName("active")}$("hillwalk_book_subnavi_"+this.drawingsInStage[d]).addClassName("active")}$("hillwalk_book_page"+c).innerHTML=b};hillwalk.prototype.bookNavi=function(a){if(a){this.page+=(a*2)}if(this.page<1){this.page=1}if(this.page>this.drawingsCount){this.page=(Math.ceil(this.drawingsCount/2)*2)-1}this.drawPage(this.page);this.drawPage((this.page+1));showDiv("hillwalk_book_navi_left");showDiv("hillwalk_book_navi_right");if(this.page==1){hideDiv("hillwalk_book_navi_left")}if(this.page==(this.drawingsCount-1)){hideDiv("hillwalk_book_navi_right")}};hillwalk.prototype.bookEntry=function(a){for(var c=0;c<a.length;c++){var b=this.drawingsInStage[a[c]];this.bookEntryFly(b)}};hillwalk.prototype.bookEntryFly=function(a){html='<div id="flyer_bookentry'+a+'" class="bookentry stage'+a+'"></div>';$("hillwalk_stages").insert(html);setTimeout(function(){if($("flyer_bookentry"+a)){$("flyer_bookentry"+a).className="bookentry fly"}},300);setTimeout(function(){if($("flyer_bookentry"+a)){$("flyer_bookentry"+a).remove()}},1200)};hillwalk.prototype.hunt=function(){hideDiv("hillwalk_hunt");if(this.data.hunt){var c="";c+='<div id="hillwalk_hunt_tt" class="ttbox">'+this.data.config.hunt[this.data.hunt.id].name+"</div>";c+='<div class="target"><div class="target'+this.data.hunt.id+'"></div></div>';c+='<div class="meter">';for(var b=1;b<=this.data.config.hunt[this.data.hunt.id].steps;b++){var a="";if(b<=this.data.hunt.step){a="found"}c+='<div class="step '+a+'"></div>'}c+="</div>";$("hillwalk_hunt").innerHTML=c;showDiv("hillwalk_hunt")}};hillwalk.prototype.help=function(b){showDiv("hillwalk_transp");showDiv("hillwalk_help");hideDiv("hillwalk_helppage");hideDiv("hillwalk_achievements");$("hillwalk_navi_helppage").removeClassName("active");$("hillwalk_navi_achievements").removeClassName("active");if(!b){b="helppage"}showDiv("hillwalk_"+b);$("hillwalk_navi_"+b).addClassName("active");for(var a=0;a<this.data.achievements.achievements.length;a++){showDiv("hillwalk_help_achievement_ready"+this.data.achievements.achievements[a])}for(var a=0;a<this.data.achievements.hunts.length;a++){showDiv("hillwalk_help_hunt_ready"+this.data.achievements.hunts[a])}};hillwalk.prototype.helpClose=function(){hideDiv("hillwalk_transp");hideDiv("hillwalk_help")};hillwalk.prototype.showStats=function(){var a='<div id="hillwalk_stats">';a+='  <div class="select_line">';a+='    <select id="hillwalk_stats_select" onchange="hillwalk.stats()">';var b=["points","tours","stages","category2","category3","category4"];for(var c=0;c<b.length;c++){var d="";if(this.stats_select==b[c]){d="selected"}a+='<option value="'+b[c]+'" '+d+">"+t_hillwalk_stats[b[c]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_hillwalk_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select]);a+="</div>";globalBoxFlex("",a,0,0,1)};var infinitequestline=function(){this.data={};this.currentFarm=0;this.currentPosition=0;this.stats_cache={};this.stats_cache_delay={};this.stats_select="count"};infinitequestline.prototype.stats=function(){if($("infinitequestline_stats_select")){infinitequestline.stats_select=$("infinitequestline_stats_select").value}if(infinitequestline.stats_cache_delay[infinitequestline.stats_select]<=0||!infinitequestline.stats_cache[infinitequestline.stats_select]){infinitequestline.action("infinitequestline_stats",{type:infinitequestline.stats_select})}else{infinitequestline.showStats(infinitequestline.stats_select)}};infinitequestline.prototype.questEntry=function(a){infinitequestline.action("infinitequestline_questentry",{pid:a,amount:parseInt($("dialog_entryline_number").value)})};infinitequestline.prototype.stop=function(){infinitequestline.action("infinitequestline_stop")};infinitequestline.prototype.reroll=function(){infinitequestline.action("infinitequestline_reroll")};infinitequestline.prototype.speedup=function(){infinitequestline.action("infinitequestline_speedup")};infinitequestline.prototype.setbonus=function(b,a){infinitequestline.action("infinitequestline_setbonus",{farm:b,position:a})};infinitequestline.prototype.instantBuy=function(){infinitequestline.action("infinitequestline_instantbuy")};infinitequestline.prototype.action=function(a,b){ajaxAction("farm",a,b,infinitequestline.response)};infinitequestline.prototype.response=function(b,a,c){if(a=="infinitequestline_stop"){infinitequestline.stopCommit()}if(in_array(a,["infinitequestline_questentry","infinitequestline_reroll","infinitequestline_instantbuy"])){infinitequestline.open()}if(a=="infinitequestline_setbonus"){farmBuildPositions()}if(b.stats){infinitequestline.stats_cache_delay[infinitequestline.stats_select]=30;if(!infinitequestline.stats_cache[infinitequestline.stats_select]){infinitequestline.stats_cache[infinitequestline.stats_select]={}}infinitequestline.stats_cache[infinitequestline.stats_select]=b.stats;infinitequestline.showStats()}};infinitequestline.prototype.open=function(){var a="";a+='<div class="head">'+t_infinitequestline_name+"</div>";a+='<div class="desc">'+t_infinitequestline_desc+"</div>";a+='<div class="quest">';a+='  <div id="infinitequestline_quest_timer_show" class="timer_show">';a+='    <div id="infinitequestline_quest_timer" class="timer" style="position:relative; float:left; width:150px; margin-left:150px;">'+t_finitequestline_next_quest+"</div>";a+='    <div class="speedup production_slot_speedup link" style="position:relative; float:left; top:0px;" onclick="infinitequestline.speedupCommit()" onmouseover="showDiv(\'infinitequestline_quest_speedup_tt\')" onmouseout="hideDiv(\'infinitequestline_quest_speedup_tt\')">';a+='      <div id="infinitequestline_quest_speedup_tt" class="ttbox">'+t_infinitequestline_quest_speedup+"</div>";a+="    </div>";a+='    <div class="clear"></div>';a+="  </div>";a+='  <div id="infinitequestline_quest_quest_show" class="quest_show">';a+='    <div class="title2">';a+="      <div>"+t_infinitequestline_title.replace("%COUNT%",this.data.data.quest.questid)+"</div>";if(rackinfos[8]){a+='<div class="infobutton" onmouseover="showDiv(\'infinitequestline_infobutton_tt\')" onmouseout="hideDiv(\'infinitequestline_infobutton_tt\')">';a+='  <div id="infinitequestline_infobutton_tt" class="ttbox">'+t_buy_rack_infinitequestline2.replace("%AMOUNT%",rackinfos[8][5]).replace("%COUNT%",8)+"</div>";a+="</div>"}a+="    </div>";a+='    <div id="infinitequestline_products" class="products"></div>';a+='    <div id="infinitequestline_rewards" class="rewards"></div>';a+='    <div class="reroll link" onclick="infinitequestline.rerollCommit()" onmouseover="showDiv(\'infinitequestline_quest_reroll_tt\')" onmouseout="hideDiv(\'infinitequestline_quest_reroll_tt\')">';a+='      <div id="infinitequestline_quest_reroll_tt" class="ttbox">'+t_infinitequestline_quest_reroll+"</div>";a+="    </div>";a+="  </div>";a+="</div>";a+='<div id="infinitequestline_progress" class="progress"></div>';a+='<div class="statsbutton link" onclick="infinitequestline.stats()"></div>';a+='<div class="helpbutton_blue link" onclick="infinitequestline.openHelp()"></div>';a+='<div class="char"></div>';a+='<div class="mini_close link" onclick="infinitequestline.close();"></div>';$("infinitequestline_inner").innerHTML=a;showDiv("infinitequestline");this.buildProducts();this.buildRewards();this.buildProgress();this.timerUpdate()};infinitequestline.prototype.buildProducts=function(){var d="";var a={1:[],2:[],3:[]};for(var e in this.data.data.quest.products){if(in_array(e,[820,821,822,823,824])){a[1].push(e)}else{if(e>=825){a[2].push(e)}else{a[3].push(e)}}}for(var c in a){if(!a[c].length){continue}for(var b=0;b<a[c].length;b++){var e=a[c][b];var m=this.data.data.quest.products[e];var h=0;if(this.data.data.quest&&this.data.data.quest.data&&this.data.data.quest.data[e]){h=this.data.data.quest.data[e]}var l=((h*100)/m);var n="infinitequestline.questEntryCommit("+e+")";if(h>=m){n=""}d+='<div class="line">';d+='  <div class="pid kp'+e+'"></div>';d+='  <div class="bar" onclick="'+n+'" onmouseover="showDiv(\'infinitequestline_product'+e+"_tt')\" onmouseout=\"hideDiv('infinitequestline_product"+e+"_tt')\">";d+='    <div class="inner2" style="width:'+l+'%"></div>';d+='    <div id="infinitequestline_product'+e+'_tt" class="ttbox">'+produkt_name[e]+"</div>";d+="  </div>";d+='  <div class="amount">'+formatNumber(h)+"/"+formatNumber(m)+"</div>";d+='  <div class="clear"></div>';d+="</div>"}}d+='<div class="finishblock"><button class="finishbutton button_new link" onclick="infinitequestline.instantBuyCommit()">'+t_infinitequestline_quest_finish+"</button></div>";$("infinitequestline_products").innerHTML=d};infinitequestline.prototype.buildRewards=function(){var a="";a+='<div class="head2">'+t_vet_reward_head+"</div>";for(var b in this.data.data.quest.reward){a+='<div class="line">';a+='  <div class="'+b+'"></div>';a+='  <div class="amount">';if(b=="points"){a+=formatNumber(this.data.data.quest.reward[b])+" "+t_points}if(b=="money"){a+=formatPrice(this.data.data.quest.reward[b])}a+="  </div>";a+='  <div class="clear"></div>';a+="</div>"}$("infinitequestline_rewards").innerHTML=a};infinitequestline.prototype.questEntryCommit=function(b){for(var h in this.data.data.quest.products){if(b!=h){continue}var a=this.data.data.quest.products[b];var d=0;if(this.data.data.quest.data&&this.data.data.quest.data[b]){d=this.data.data.quest.data[b]}var c=Math.min(a,(a-d))}var e={pid:b};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(e),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("infinitequestline.checkQuestEntry("+b+", "+c+")");$("dialog_entryline_number").onkeyup=new Function("infinitequestline.checkQuestEntry("+b+", "+c+")");this.checkQuestEntry(b,c)};infinitequestline.prototype.checkQuestEntry=function(a,b){checkEntryLine({type:"product",stockamount:checkRackItem(a),rest:b,click:"infinitequestline.questEntry("+a+")"})};infinitequestline.prototype.speedupCommit=function(){var b=t_infinitequestline_quest_speedup;var a='<div style="width:300px;">'+t_infinitequestline_speedup_body.replace("%COST%","<b>"+this.data.config.speedup_cost+" "+t_coins+"</b>")+"</div>";var c="infinitequestline.speedup()";globalcommitbox(b,a,c)};infinitequestline.prototype.rerollCommit=function(){var e="infinitequestline.reroll()";var b="";if(parseInt(this.data.config.reroll_cost)>parseInt(user_coins)){e="";b="important"}var d=t_infinitequestline_quest_reroll;var a=t_infinitequestline_reroll_body.replace("%COST%",'<span style="font-weight:bold;" class="'+b+'">'+this.data.config.reroll_cost+" "+t_coins+"</span>");a+='<div style="margin-top:10px; background-color:#C3A75E; padding:10px; border-radius:5px;">'+t_infinitequestline_reroll_info+"</div>";var c="hideDiv('globaltransp'); hideDiv('globalbox');";globalcommitbox(d,a,e,c)};infinitequestline.prototype.buildProgress=function(){var c="";c+='<div class="head">'+t_infinitequestline_progress_head+"</div>";c+='<div class="bar">';c+='  <div class="cells">';for(var b=1;b<=this.data.config.max;b++){var a="";if(b>this.data.data.current){a="empty"}c+='<div class="cell '+a+'">';if(this.data.config.bonus.steps[b]){c+='<div class="reward reward'+this.data.config.bonus.steps[b]+'" onmouseover="showDiv(\'infinitequestline_progress_reward'+b+"')\" onmouseout=\"hideDiv('infinitequestline_progress_reward"+b+"')\">";c+='  <div id="infinitequestline_progress_reward'+b+'" class="ttbox">'+t_infinitequestline_bonus_tt.replace("%COUNT%",this.data.config.bonus.steps[b])+"</div>";c+="</div>"}c+="</div>"}c+="  </div>";c+='  <div class="front"></div>';c+='  <div id="infinitequestline_stop_button" class="stop link" onclick="infinitequestline.stopCommit()" onmouseover="showDiv(\'infinitequestline_stop_button_tt\')" onmouseout="hideDiv(\'infinitequestline_stop_button_tt\')">';c+='    <div id="infinitequestline_stop_button_tt" class="ttbox">';c+="      <div>"+t_infinitequestline_stop_head+"</div>";c+='      <div id="infinitequestline_stop_button_tt_timer"></div>';c+="    </div>";c+="  </div>";c+="</div>";c+='<div class="current">'+this.data.data.current+"/"+this.data.config.max+"</div>";var d="&nbsp;";if(this.data.data.current&&this.data.data.current>0){d=t_infinitequestline_reduce_cells.replace("%TIME%","<b>"+formatTime(this.data.data.reduction_remain)+"</b>")}c+='<div id="infinitequestline_reduction_timer" class="reduction">'+d+"</div>";$("infinitequestline_progress").innerHTML=c};infinitequestline.prototype.stopCommit=function(){var c=t_infinitequestline_stop_head;var e=0;if(this.data.data.stop&&this.data.data.stop.remain>0){e=1}var a='<div id="infinitequestline_stop_commit">';a+='  <div class="intro">'+t_infinitequestline_stop_intro+"</div>";a+='  <div class="box2">';if(e==1){a+='  <div class="info">'+t_infinitequestline_stop_active+"</div>";a+="  <div>"+t_infinitequestline_stop_resttime+":</div>";a+='  <div id="infinitequestline_stop_resttime" class="timer">'+formatTime(this.data.data.stop.remain)+"</div>";a+="</div>";a+='<div class="box2">';a+="  <div>"+t_infinitequestline_stop_extend.replace("%TIME%",this.data.config.stop.days)+"</div>"}else{a+="<div>"+t_infinitequestline_stop_desc.replace("%TIME%",this.data.config.stop.days)+"<div>"}var d="infinitequestline.stopCommitCommit("+e+")";var b="";if(user_coins<this.data.config.stop.coins){d="";b="off"}a+='    <div class="link coinsbutton_flex '+b+'" onclick="'+d+'">'+this.data.config.stop.coins+" "+t_coins+"</div>";a+="  </div>";a+="</div>";globalcommitbox(c,a,0,0,0,1)};infinitequestline.prototype.stopCommitCommit=function(d){var b=t_infinitequestline_stop_head;var a='<div id="infinitequestline_stop_commit">';var c="infinitequestline.stop()";if(d==1){a+="<div>"+t_infinitequestline_stop_extend.replace("%TIME%",this.data.config.stop.days)+"</div>"}else{a+="<div>"+t_infinitequestline_stop_desc.replace("%TIME%",this.data.config.stop.days)+"</div>"}a+='  <div class="price">'+cityadcost+" <b>"+this.data.config.stop.coins+" "+t_coins+"</b></div>";a+="</div>";globalcommitbox(b,a,c)};infinitequestline.prototype.setbonusCommit=function(h,b){this.currentFarm=h;this.currentPosition=b;var d=t_infinitequestline_setbonus_head;var a='<div id="infinitequestline_setbonus_commit">';var e="infinitequestline.setbonus("+h+", "+b+")";if(this.data.data.bonus){var c=0;if(this.data.data.bonus.farm==h&&this.data.data.bonus.position==b){c=1;e=""}if(!c){a+='<div style="margin-bottom:10px;">'+t_infinitequestline_setbonus_body+"</div>"}else{a+="<div>"+t_infinitequestline_setbonus_info2+'</div><div id="infinitequestline_setbonus_commit_bonus" class="bonus"></div>'}if(!c){a+='<div style="margin-bottom:10px;">'+t_infinitequestline_setbonus_info+"</div>"}if(!c){a+='<div class="add">';if(this.data.data.bonus.remain>0){a+='<div id="infinitequestline_setbonus_commit_timer" class="timer">';a+="  <div>"+t_infinitequestline_setbonus_cooldown+"</div>";a+='  <div id="infinitequestline_setbonus_commit_cooldown"></div>';a+="</div>"}a+='<div style="margin-bottom:-10px;">'+t_infinitequestline_bonus_change_tax+"</div>";var e="infinitequestline.setbonusCommitCommit("+h+", "+b+")";var m=this.data.config.bonus.change_cost+" "+t_coins;if(this.data.data.bonus.remain<=0){m=formatPrice(this.data.config.bonus.change_money)}a+='<div class="link coinsbutton_flex" onclick="'+e+'">'+m+"</div>";e="";a+="</div>"}var l=this.getCurrentBonus();if(c&&l<1){a+='<div class="notactive">'+t_infinitequestline_bonus_not_active+"</div>"}a+="</div>";globalcommitbox(d,a,0,0,1)}else{a+="  <div>"+t_infinitequestline_setbonus_body+"<div>";a+="<div>"}if(e!=""){globalcommitbox(d,a,e)}else{globalcommitbox(d,a,0,0,1)}};infinitequestline.prototype.setbonusCommitCommit=function(e,b){var h=this.data.config.bonus.change_cost+" "+t_coins;if(this.data.data.bonus.remain<=0){h=formatPrice(this.data.config.bonus.change_money)}var c=t_infinitequestline_setbonus_head;var a='<div id="infinitequestline_setbonus_commit">'+t_infinitequestline_setbonus_body2.replace("%COST%","<b>"+h+"</b>")+"</div>";var d="infinitequestline.setbonus("+e+", "+b+")";globalcommitbox(c,a,d)};infinitequestline.prototype.instantBuyCommit=function(){var h=0;for(var b in this.data.data.quest.products){var e=this.data.data.quest.products[b];if(this.data.data.quest.data&&this.data.data.quest.data[b]){e=(this.data.data.quest.products[b]-this.data.data.quest.data[b])}h+=(produkt_price[b]*e)}var l="infinitequestline.instantBuy()";addclass="";if(parseInt(this.data.config.instantbuy_cost)>parseInt(user_coins)){l="";addclass="important"}var d=t_infinitequestline_instantbuy_head;var a='<div id="infinitequestline_instantbuy_commit">';a+="  <div>"+t_infinitequestline_instantbuy_body.replace("%SUM%","<b>"+formatPrice(h)+"</b>")+"</div>";a+='  <div class="tax">'+t_infinitequestline_instantbuy_tax+': <span style="font-weight:bold;" class="'+addclass+'">'+this.data.config.instantbuy_cost+" "+t_coins+"</span></div>";a+="</div>";var c="hideDiv('globaltransp'); hideDiv('globalbox');";globalcommitbox(d,a,l,c)};infinitequestline.prototype.close=function(){hideDiv("infinitequestline")};infinitequestline.prototype.showStats=function(){var a='<div id="cowracing_stats">';a+='  <div class="select_line">';a+='    <select id="cowracing_stats_select" onchange="infinitequestline.stats()">';var b=["count"];for(var c=0;c<b.length;c++){var d="";if(this.stats_select==b[c]){d="selected"}a+='<option value="'+b[c]+'" '+d+">"+t_infinitequestline_stats[b[c]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_infinitequestline_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select]);a+="</div>";globalBoxFlex("",a,0,0,1)};infinitequestline.prototype.openHelp=function(){showDiv("infinitequestline_help");hideDiv("infinitequestline_inner");this.naviHelp("info")};infinitequestline.prototype.naviHelp=function(b){hideDiv("infinitequestline_help_info");hideDiv("infinitequestline_help_achievements");$("infinitequestline_help_navi_info").removeClassName("active");$("infinitequestline_help_navi_achievements").removeClassName("active");showDiv("infinitequestline_help_"+b);$("infinitequestline_help_navi_"+b).addClassName("active");if(b=="achievements"){for(var c in this.data.config.achievements){var a=this.data.config.achievements[c].giftid;if(in_array(a,this.data.data.achievements)){showDiv("infinitequestline_help_achievement"+c+"_ready")}}}};infinitequestline.prototype.closeHelp=function(){hideDiv("infinitequestline_help");showDiv("infinitequestline_inner")};infinitequestline.prototype.timer=function(){this.data.data.reduction_remain--;if(this.data.data.quest.block){this.data.data.quest.remain--}if(this.data.data.stop){this.data.data.stop.remain--}if(this.data.data.bonus){this.data.data.bonus.remain--}for(var a in this.stats_cache_delay){this.stats_cache_delay[a]--}this.timerUpdate()};infinitequestline.prototype.timerUpdate=function(){if(this.data.data.reduction_remain<=0){if(this.data.data.current>0){this.data.data.reduction_remain=this.data.config.delay;this.data.data.current--;if($("infinitequestline_progress")){this.buildProgress()}}}else{if($("infinitequestline_reduction_timer")&&this.data.data.current&&this.data.data.current>0){$("infinitequestline_reduction_timer").innerHTML=t_infinitequestline_reduce_cells.replace("%TIME%","<b>"+formatTime(this.data.data.reduction_remain)+"</b>")}}hideDiv("infinitequestline_quest_timer_show");showDiv("infinitequestline_quest_quest_show");hideDiv("quests_status_bar_infinite_cooldown");if(this.data.data.quest.block){if(this.data.data.quest.remain>0){if($("infinitequestline_quest_timer")){$("infinitequestline_quest_timer").innerHTML=t_finitequestline_next_quest.replace("%TIME%","<b>"+formatTime(this.data.data.quest.remain)+"</b>");showDiv("infinitequestline_quest_timer_show");hideDiv("infinitequestline_quest_quest_show")}if($("quests_status_bar_infinite_cooldown")){showDiv("quests_status_bar_infinite_cooldown")}}}if(this.data.data.stop){if($("infinitequestline_stop_resttime")){if(this.data.data.stop.remain>0){$("infinitequestline_stop_resttime").innerHTML=formatTime(this.data.data.stop.remain)}else{if(this.data.data.stop.remain==0){this.stopCommit()}}}if($("infinitequestline_stop_button")){if(this.data.data.stop.remain>0){if(!$("infinitequestline_stop_button").hasClassName("active")){$("infinitequestline_stop_button").addClassName("active")}$("infinitequestline_stop_button_tt_timer").innerHTML='<div style="width:140px; margin-top:5px;">'+t_infinitequestline_stop_resttime+": "+formatTime(this.data.data.stop.remain)+"</div>"}else{$("infinitequestline_stop_button").removeClassName("active");$("infinitequestline_stop_button_tt_timer").innerHTML=""}}}if(this.data.data.bonus){if($("infinitequestline_setbonus_commit_timer")){if(this.data.data.bonus.remain>0){$("infinitequestline_setbonus_commit_cooldown").innerHTML=formatTime(this.data.data.bonus.remain);showDiv("infinitequestline_setbonus_commit_timer")}else{if(this.data.data.bonus.remain==0){infinitequestline.setbonusCommit(this.currentFarm,this.currentPosition)}hideDiv("infinitequestline_setbonus_commit_timer")}}var d=this.getCurrentBonus();var c="farm_infinitequestlinebonus_tt"+this.data.data.bonus.farm+"_"+this.data.data.bonus.position+"_bonus";if($(c)){var a="";if(d>0){a=t_infinitequestline_bonus_active_tt.replace("%COUNT%",d)}else{a=t_infinitequestline_bonus_active_tt2}$(c).innerHTML=a}if($("infinitequestline_setbonus_commit_bonus")){var b="";if(d>0){b='<div style="margin-top:10px">'+t_infinitequestline_bonus_active_tt.replace("%COUNT%",d)+"</div>"}$("infinitequestline_setbonus_commit_bonus").innerHTML=b}}};infinitequestline.prototype.getCurrentBonus=function(){var b=0;if(this.data.data&&this.data.data.current&&this.data.data.current>0){for(var a in this.data.config.bonus.steps){if(this.data.data.current>=a){b=this.data.config.bonus.steps[a]}}}return b};infinitequestline.prototype.linkHover=function(a){if(a==1){showDiv("infinitequestline_link_tt");$("infinitequestline_link").addClassName("hover")}else{hideDiv("infinitequestline_link_tt");$("infinitequestline_link").removeClassName("hover")}};var infinitequestline=new infinitequestline();var insecthotel=function(){this.data={};this.fillSlot=0;this.fillProduct=0;this.fillAmount=0;this.fillBonusproduct=0;this.currentSlot=1;this.currentInfoNaviSlot=1;this.stats_options=["population1","population2","population3","population4","population5","population6","money"];this.stats_cache={};this.stats_cache_delay={};this.stats_select="population1";this.tutorialStep=0};insecthotel.prototype.speedupBonusproduct=function(a){insecthotel.action("insecthotel_speedup_bonusproduct")};insecthotel.prototype.buySlot=function(a){insecthotel.action("insecthotel_buyslot",{slot:a})};insecthotel.prototype.buySlot=function(a){insecthotel.action("insecthotel_buyslot",{slot:a})};insecthotel.prototype.setBonusproduct=function(){insecthotel.action("insecthotel_set_bonusproduct",{pid:insecthotel.fillBonusproduct})};insecthotel.prototype.finishTutorial=function(){insecthotel.action("insecthotel_finish_tutorial")};insecthotel.prototype.stats=function(){if($("insecthotel_stats_select")){if($("insecthotel_stats_select").value==0){return 1}insecthotel.stats_select=$("insecthotel_stats_select").value}if(insecthotel.stats_cache_delay[insecthotel.stats_select]<=0||!insecthotel.stats_cache[this.stats_select]){insecthotel.action("insecthotel_stats",{type:insecthotel.stats_select})}else{insecthotel.showStats(insecthotel.stats_select)}};insecthotel.prototype.setStockSlot=function(){if(this.fillSlot>0&&this.fillProduct>0&&this.fillAmount>0){insecthotel.action("insecthotel_set_stockslot",{slot:this.fillSlot,pid:this.fillProduct,amount:this.fillAmount})}};insecthotel.prototype.upgradeStockSlot=function(a){insecthotel.action("insecthotel_upgrade_stockslot",{slot:a})};insecthotel.prototype.deleteStockSlot=function(a){insecthotel.action("insecthotel_delete_stockslot",{slot:a})};insecthotel.prototype.buyStockSlot=function(a){insecthotel.action("insecthotel_buy_stockslot",{slot:a})};insecthotel.prototype.upgradeCheckout=function(){insecthotel.action("insecthotel_upgrade_checkout")};insecthotel.prototype.collectCheckout=function(){insecthotel.action("insecthotel_collect_checkout")};insecthotel.prototype.buyBooster=function(a,b){insecthotel.action("insecthotel_buy_booster",{name:a,id:b})};insecthotel.prototype.upgradeSlot=function(b,a){insecthotel.action("insecthotel_upgrade_slot",{slot:b,id:a})};insecthotel.prototype.buy=function(){insecthotel.action("insecthotel_buy")};insecthotel.prototype.silent=function(){insecthotel.action("insecthotel_silent")};insecthotel.prototype.init=function(){insecthotel.action("insecthotel_init")};insecthotel.prototype.action=function(a,b){ajaxAction("farm",a,b,insecthotel.response)};insecthotel.prototype.response=function(b,a,c){if(a=="insecthotel_silent"){insecthotel.beSilent()}else{insecthotel.build()}if(in_array(a,["insecthotel_buy_stockslot","insecthotel_set_stockslot","insecthotel_delete_stockslot","insecthotel_upgrade_stockslot"])){insecthotel.buildStock()}if(in_array(a,["insecthotel_upgrade_slot"])){insecthotel.slotInfo(insecthotel.currentSlot)}if(in_array(a,["insecthotel_collect_checkout","insecthotel_upgrade_checkout"])){insecthotel.buildCheckout()}if(in_array(a,["insecthotel_buy_booster"])){insecthotel.buildBooster()}if(in_array(a,["insecthotel_speedup_bonusproduct"])){insecthotel.buildProductbonus()}if(b.stats){insecthotel.stats_cache_delay[insecthotel.stats_select]=insecthotel.data.config.constants.stats_delay;if(!insecthotel.stats_cache[insecthotel.stats_select]){insecthotel.stats_cache[insecthotel.stats_select]={}}insecthotel.stats_cache[insecthotel.stats_select]=b.stats;insecthotel.showStats()}if(!(insecthotel.data.data&&insecthotel.data.data.tutorial>0)&&$("insecthotel_tutorial")){insecthotel.startTutorial()}if(a=="insecthotel_set_bonusproduct"){insecthotel.buildProductbonus()}};insecthotel.prototype.beSilent=function(){if($("insecthotel").style.display!="block"){return 1}this.buildSlots();if($("insecthotel_info")&&$("insecthotel_info").style.display=="block"){insecthotel.slotInfo(insecthotel.currentSlot)}if($("insecthotel_stock")&&$("insecthotel_stock").style.display=="block"){insecthotel.buildStock()}if($("insecthotel_checkout")&&$("insecthotel_checkout").style.display=="block"){insecthotel.buildCheckout()}if($("insecthotel_booster")&&$("insecthotel_booster").style.display=="block"){insecthotel.buildBooster()}if($("insecthotel_stats")){this.showStats()}};insecthotel.prototype.build=function(){if(this.data.data&&this.data.data.buy){this.buyCommit();return 1}var d="";d+='<div id="insecthotel_deco" class="deco"></div>';d+='<div id="insecthotel_slots" class="slots"></div>';d+='<div id="insecthotel_anis" class="anis"></div>';var h={checkout:t_insecthotel_checkout_head,stats:t_stats,stock:t_insecthotel_stock_head,booster:t_insecthotel_booster_head,productbonus:t_insecthotel_productbonus_head};d+='<div class="buttons">';for(var b in h){var e=b;if(b!="stats"){e="build"+b.charAt(0).toUpperCase()+b.substring(1)}d+='<div id="insecthotel_button_'+b+'" class="slot '+b+' link" onclick="insecthotel.'+e+'()" onmouseover="showDiv(\'insecthotel_button_'+b+"_tt')\" onmouseout=\"hideDiv('insecthotel_button_"+b+"_tt')\">";if(b=="checkout"&&this.data.data.checkout){if((this.data.data.checkout.money&&this.data.data.checkout.money>0)||(this.data.data.checkout.points&&this.data.data.checkout.points>0)){d+='<div class="cash"></div>'}}d+='  <div id="insecthotel_button_'+b+'_tt" class="ttbox">'+h[b]+"</div>";d+="</div>"}d+="</div>";var a=["stock","info","checkout","booster","productbonus"];for(var c=0;c<a.length;c++){d+='<div id="insecthotel_'+a[c]+'" class="'+a[c]+'">';d+='  <div class="transp"></div>';d+='  <div id="insecthotel_'+a[c]+'_inner" class="inner"></div>';d+="</div>"}d+='<div id="insecthotel_timeline" class="timeline">'+t_insecthotel_timeline+'&nbsp;<span id="insecthotel_timeline_time" class="tick"></span></div>';d+='<div id="insecthotel_tutorial" class="tutorial">';d+='  <div id="insecthotel_tutorial_transp" class="transp"></div>';d+='  <div id="insecthotel_tutorial_transp_half" class="transp_half"></div>';d+='  <div id="insecthotel_tutorial_char" class="char"></div>';d+='  <div id="insecthotel_tutorial_bubble" class="bubble"></div>';d+="</div>";d+='<div class="helpbutton_blue link" onclick="insecthotel.help();"></div>';d+='<div class="mini_close link" onclick="insecthotel.close();"></div>';$("insecthotel_inner").innerHTML=d;showDiv("insecthotel");setTimer("insecthotel");this.buildSlots();this.setAnis();this.timerUpdate()};insecthotel.prototype.setAnis=function(){var l="";var m="";for(var q in this.data.config.slots){var a=1;if(this.data.data.slots[q]&&this.data.data.slots[q].level){a=this.data.data.slots[q].level}l+='<div id="insecthotel_deco_slot'+q+'" class="pos pos'+q+" level"+a+'"></div>';if(this.data.data.slots[q]&&this.data.data.slots[q].population>0){var n=getRandom(50,500);var b=getRandom(1,30);var d=getRandom(10,25);m+='<div class="path path'+q+'" style="top:'+n+"px; animation-delay:"+(b/10)+"s; animation-duration:"+d+'s;">';m+='  <div class="ani ani'+q+'"></div>';m+="</div>"}}for(var h=1;h<=3;h++){m+='<div class="flower_flight set set'+h+'">';for(var e=1;e<=3;e++){for(var c=1;c<=3;c++){m+='<div class="flower'+c+'"></div>'}}m+="  </div>"}$("insecthotel_deco").innerHTML=l;$("insecthotel_anis").innerHTML=m};insecthotel.prototype.buyCommit=function(){var a='<div id="insecthotel_commit">'+t_insecthotel_buy_desc.replace("%COST%","<b>"+formatPrice(this.data.config.constants.cost)+"</b>")+"</div>";var b="insecthotel.buy()";globalcommitbox(t_insecthotel_buy_head,a,b)};insecthotel.prototype.opener=function(){var b="insecthotel.init()";$("map_insecthotel").onclick=new Function(b);hideDiv("map_insecthotel_cash");if(this.data.data.checkout){if((this.data.data.checkout.money&&this.data.data.checkout.money>0)||(this.data.data.checkout.points&&this.data.data.checkout.points>0)){showDiv("map_insecthotel_cash")}}var a="<div>"+t_insecthotel_name+"</div>";$("map_insecthotel_tt").innerHTML=a;if($("insecthotel_overview_link")){$("insecthotel_overview_link_tt").innerHTML=a}};insecthotel.prototype.buildSlots=function(){var c="";for(var h in this.data.config.slots){var n="insecthotel.slotInfo("+h+")";var d='<div class="name">'+this.data.config.slots[h].name+"</div>";var m="";var b=0;if(!this.data.data.slots[h]||!this.data.data.slots[h].unlock_time){b=1;n="";if(this.data.config.slots[h].money){var l="";if(player_money<this.data.config.slots[h].money){l="important"}d+='<div class="'+l+'" style="margin:5px 0px;">'+formatPrice(this.data.config.slots[h].money)+"</div>"}}var a=(parseInt(h)-1);if(this.data.config.slots[h].required_population&&this.data.config.slots[a]){if(b&&this.data.data["population"+a]<this.data.config.slots[h].required_population){d+='<div class="require important">'+t_insecthotel_unlock_slot.replace("%COUNT%",formatNumber(this.data.config.slots[h].required_population)).replace("%NAME%",this.data.config.slots[a].name)+"</div>"}else{if(b){b=2;n="insecthotel.buySlotCommit("+h+")"}}}if(!b){d+='<div class="require">'+t_insecthotel_slot_click_info+"</div>"}c+='<div id="insecthotel_slots_slot'+h+'" class="slot slot'+h+' link" onclick="'+n+'" onmouseover="showDiv(\'insecthotel_slots_slot'+h+"_tt')\" onmouseout=\"hideDiv('insecthotel_slots_slot"+h+"_tt')\">";if(b==1){c+='<div class="locked"></div>'}else{if(b==2){c+='<div class="unlocked"></div>'}else{c+='<div class="img"></div>';c+='<div class="animalimg animalimg'+h+'"></div>';var e=1;if(this.data.data.slots[h].happiness>this.data.config.slots[h].population_limit[0]){e=2}if(this.data.data.slots[h].happiness>this.data.config.slots[h].population_limit[1]){e=3}c+='<div class="mood mood'+e+'"></div>'}}c+='  <div id="insecthotel_slots_slot'+h+'_tt" class="ttbox '+m+'">'+d+"</div>";c+="</div>"}c+='<div class="clear"></div>';$("insecthotel_slots").innerHTML=c};insecthotel.prototype.buySlotCommit=function(c){var a='<div id="insecthotel_commit">';a+="  <div>"+t_insecthotel_buy_slot_desc.replace("%NAME%","<b>"+this.data.config.slots[c].name+"</b>").replace("%COST%","<b>"+formatPrice(this.data.config.slots[c].money)+"</b>")+"</div>";a+="</div>";var b="insecthotel.buySlot("+c+")";globalcommitbox(t_insecthotel_buy_slot_head,a,b)};insecthotel.prototype.slotInfo=function(c){hideDiv("globaltransp");hideDiv("globalbox");this.currentSlot=c;var r='<div class="head">'+this.data.config.slots[c].name+"</div>";var l=1;if(this.data.data.slots[c].happiness>this.data.config.slots[c].population_limit[0]){l=2}if(this.data.data.slots[c].happiness>this.data.config.slots[c].population_limit[1]){l=3}r+='<div class="animalinfo animalinfo'+c+'">';r+='  <div class="mood mood'+l+'"></div>';r+="</div>";var u=0;if(this.data.data.slots[c].population){u=this.data.data.slots[c].population}var D=this.data.config.slots_level[c][this.data.data.slots[c].level].population;var a=Math.min(100,(u*100)/D);r+='<div id="insecthotel_slotinfo_population" class="population">';r+='  <div class="name">'+t_insecthotel_info_population+"</div>";r+='  <div class="icon insecthotel_population"></div>';r+='  <div class="bar">';r+='    <div class="bar_inner" style="width:'+a+'%;"></div>';r+='    <div class="amount">'+formatNumber(u)+"/"+formatNumber(D)+"</div>";r+="  </div>";r+='  <div class="level">'+this.data.data.slots[c].level+"</div>";if(this.data.config.slots_level[c][(parseInt(this.data.data.slots[c].level)+1)]){r+='<div class="upgrade link" onclick="insecthotel.upgradeSlotCommit('+c+')" onmouseover="showDiv(\'insecthotel_info_population_upgrade_tt\')" onmouseout="hideDiv(\'insecthotel_info_population_upgrade_tt\')">';r+='  <div class="img"></div>';r+='  <div id="insecthotel_info_population_upgrade_tt" class="ttbox">'+t_insecthotel_rise_population_head+"</div>";r+="</div>"}r+='  <div class="clear"></div>';r+="</div>";var F=0;if(this.data.data.slots[c].happiness){F=this.data.data.slots[c].happiness}var D=100;var a=Math.min(100,(F*100)/D);r+='<div id="insecthotel_slotinfo_happiness" class="happiness">';r+='  <div class="name">'+t_insecthotel_info_happiness+"</div>";r+='  <div class="meter">';r+='    <div class="bar">';r+='      <div class="bar_inner" style="width:'+a+'%;"></div>';r+="    </div>";var v=0;var H={};H[1]={happiness:0,add:(-1*this.data.config.slots[c].population_loss)};H[2]={happiness:this.data.config.slots[c].population_limit[0],add:0};H[3]={happiness:this.data.config.slots[c].population_limit[1],add:this.data.config.slots[c].population_gain};var q=0;if(specialbonus){q=specialbonus.findBonus({key1:"insecthotel",key2:"population"})}for(var E in H){var w=(parseInt(E)+1);var d=v;var A=100;if(H[w]){A=H[w].happiness}r+='<div class="part part'+E+'" style="left:'+d+"%; width:"+(A-d)+'%">';if(E<3){r+='<div class="top">'+H[w].happiness+"</div>"}var n=H[E].add;var t="";var h="";if(n>0){n=H[E].add;var e=1;if(this.data.data.booster&&this.data.data.booster.population&&this.data.data.booster.population.remain>0){e+=this.data.config.booster.population[this.data.data.booster.population.id].percent}if(q&&q.population){e+=q.population}if(e>1){t='<div class="bonusadd">'+t_insecthotel_booster_bonus.replace("%PERCENT%",Math.round((e-1)*100))+"</div>";h="bonus"}n="+"+Math.round(n*e)}r+='  <div class="add">';r+='    <div class="amount2 '+h+'">'+n+t+"</div>";r+="  </div>";r+="</div>";if(H[w]){v=H[w].happiness}else{v=100}}r+="  </div>";r+='  <div class="amount">'+F.toFixed(2)+"</div>";r+='  <div class="clear"></div>';r+='  <div class="happinessinfo_button" onmouseover="showDiv(\'happinessinfo_button_tt\')" onmouseout="hideDiv(\'happinessinfo_button_tt\')">';r+="    <div>?</div>";r+='    <div id="happinessinfo_button_tt" class="ttbox">';r+='      <div style="font-weight:bold; margin-bottom:5px;">'+t_insecthotel_howto_happiness1+"</div>";r+="      <ul>";r+="        <li>"+t_insecthotel_howto_happiness2+"</li>";r+="        <li>"+t_insecthotel_howto_happiness3+"</li>";r+="        <li>"+t_insecthotel_howto_happiness4+"</li>";r+="      </ul>";r+="    </div>";r+="  </div>";r+="</div>";var B={};var G={};if(this.data.data.stock){for(var E in this.data.data.stock){B[this.data.data.stock[E].pid]=this.data.data.stock[E].amount;if(this.data.config.stock[E].rent&&this.data.data.stock[E].pid&&this.data.data.stock[E].remain<=0){G[this.data.data.stock[E].pid]=1}}}r+='<div id="insecthotel_slotinfo_plants" class="plants">';r+='  <div class="name">'+t_insecthotel_info_plants+"</div>";var m=1;var C=0;for(var s in this.data.config.slots[c].plants){var z=0;if(B[s]){z=B[s]}var t="";var h="";var b=this.data.config.slots[c].plants[s].happiness;var n=Math.ceil(Math.max(1,(this.data.config.slots[c].plants[s].amount*u)));if(this.data.data.booster&&this.data.data.booster.feed&&this.data.data.booster.feed.remain>0){var a=this.data.config.booster.feed[this.data.data.booster.feed.id].percent;t="&nbsp;"+t_insecthotel_booster_bonus.replace("%PERCENT%",Math.round(a*100));h="bonus";n=Math.round(n*(1-a))}var J="";if(parseInt(z)<parseInt(n)||G[s]){J="important"}else{C+=b}r+='<div class="slot slot'+m+'">';r+='  <div class="img tt'+s+'"></div>';r+='  <div class="info">';r+='    <div class="name">'+produkt_name[s]+"</div>";r+='    <div class="col col1 '+h+'">'+n+"x"+t+"</div>";r+='    <div class="arrow"></div>';r+='    <div class="col col2 insecthotel_happiness"></div>';r+='    <div class="col col3 '+J+'">+'+b+"</div>";r+='    <div class="clear"></div>';r+='    <div class="instock">'+t_insecthotel_info_in_stock+'&nbsp;<span class="'+J+'">'+formatNumber(z)+"</span></div>";r+="  </div>";r+='  <div class="clear"></div>';r+="</div>";m++}var I=(C-this.data.config.slots[c].happiness_decay).toFixed(2);if(I>0){I="+"+I}r+='  <div class="calcinfo">'+t_insecthotel_slotinfo_happiness_calc+"<br>("+C.toFixed(2)+" - "+this.data.config.slots[c].happiness_decay+") = <b>"+I+"</br></div>";r+="</div>";r+='<div id="insecthotel_info_navi_left" class="navi left link" onclick="insecthotel.infoNavi(-1)"></div>';r+='<div id="insecthotel_info_navi_right" class="navi right link" onclick="insecthotel.infoNavi(1)"></div>';r+='<div id="insecthotel_info_close" class="mini_close link" onclick="insecthotel.closeInfo();"></div>';$("insecthotel_info_inner").innerHTML=r;showDiv("insecthotel_info");this.timerUpdate();this.infoNavi(0);if(!this.data.tutorial&&this.tutorialStep==2){this.nextTutorialStep()}};insecthotel.prototype.upgradeSlotCommit=function(q){var h=specialbonus.findBonus({key1:"insecthotel",key2:"uppopslot"});var s="";var l="";var d=(parseInt(this.data.data.slots[q].level)+1);var e='<div id="insecthotel_commit" class="upgradeslot">';for(var c in this.data.config.slots_level[q][d].req){if(this.data.config.slots_level[q][d].req[c].money&&this.data.config.slots_level[q][d].req[c].money>0){var a=this.data.config.slots_level[q][d].req[c].money;var b=formatPrice(a)}if(this.data.config.slots_level[q][d].req[c].coins&&this.data.config.slots_level[q][d].req[c].coins>0){if(h){s=specialbonus.htmlBonusLine(h.uppopslot);l="bonus"}var t=this.data.config.slots_level[q][d].req[c].coins;if(h){t=Math.ceil(t*(1-h.uppopslot))}var b=t+"&nbsp;"+t_coins}var r="";var n="off";var m="important";if(parseInt(this.data.data.slots[q].population)>=parseInt(this.data.config.slots_level[q][d].req[c].population)){r="insecthotel.upgradeSlot("+q+", "+c+")";n="";m=""}e+='<div class="button_new link '+n+'" onclick="'+r+'">'+t_insecthotel_rise_population_body.replace("%AMOUNT%",formatNumber(this.data.config.slots_level[q][d].population)).replace("%COST%",'<b><span class="'+l+'">'+b+"</span></b>")+"</div>";e+='<div class="desc '+m+'">'+t_insecthotel_rise_population_info.replace("%COUNT%",formatNumber(this.data.config.slots_level[q][d].req[c].population))+"</div>"}if(s!=""){e+=s}e+="</div>";globalBoxFlex(t_insecthotel_rise_population_head,e,0,0,1)};insecthotel.prototype.infoNavi=function(a){var b=this.currentSlot;if(a!=0){b=(this.currentSlot+a);if(b<1){b=1}}showDiv("insecthotel_info_navi_left");showDiv("insecthotel_info_navi_right");if(b<=1){hideDiv("insecthotel_info_navi_left")}if(!this.data.data.slots[(b+1)]||!this.data.data.slots[(b+1)].unlock_time){hideDiv("insecthotel_info_navi_right")}if(a!=0){this.slotInfo(b)}};insecthotel.prototype.closeInfo=function(){hideDiv("insecthotel_info")};insecthotel.prototype.buildStock=function(){hideDiv("globaltransp");hideDiv("globalbox");var u="";var h="";var r=specialbonus.findBonus({key1:"insecthotel",key2:"rentslot"});if(r){u="bonus";h=specialbonus.htmlBonusLine(r.rentslot)}var l='<div class="head">'+t_insecthotel_stock_head+"</div>";l+='  <div class="desc">'+t_insecthotel_stock_desc+"</div>";l+='  <div class="list">';for(var t in this.data.config.stock){var w="insecthotel.setStockSlotCommit("+t+")";var d="";var q="";var s="";if(this.data.data.stock[t]&&this.data.data.stock[t].buy_time){if(this.data.data.stock[t]&&this.data.data.stock[t].pid){q+="<div>"+t_insecthotel_stock_slot_refill+"</div>"}else{q+="<div>"+t_insecthotel_stock_slot_click+"</div>"}}else{w="insecthotel.buyStockSlotCommit("+t+")";d="unlocked";if(this.data.config.stock[t].money&&this.data.config.stock[t].money>0){s="";var c=formatPrice(this.data.config.stock[t].money);if(user_bar<this.data.config.stock[t].money){s="important";w=""}}if(this.data.config.stock[t].coins&&this.data.config.stock[t].coins>0){s="";var c=this.data.config.stock[t].coins+"&nbsp;"+t_coins;if(user_coins<this.data.config.stock[t].coins){s="important";w=""}}q+='<div class="'+s+'">'+t_insecthotel_stock_buy_slot_desc.replace("%COST%",c)+"</div>"}if(this.data.config.stock[t].rent){if(!this.data.data.stock[t]||(this.data.data.stock[t].duration&&this.data.data.stock[t].remain<=0)){d="unlocked";w="insecthotel.buyStockSlotCommit("+t+")";s="";var z=this.data.config.stock[t].rent.coins;if(r){z=Math.ceil(z*(1-r.rentslot))}if(user_coins<z){s="important";w=""}q='<div class="'+s+'">'+t_insecthotel_stock_rent_slot_desc.replace("%COST%",'<b><span class="'+u+'">'+z+"&nbsp;"+t_coins+"</span></b>").replace("%TIME%",formatTime(this.data.config.stock[t].rent.duration))+"</div>";if(h!=""){q+="<div>"+h+"</div>"}}}var s="";if(t>=5){s="bottom"}var v="";if(q!=""){v="onmouseover=\"showDiv('insecthotel_stock_slot"+t+"_tt')\" onmouseout=\"hideDiv('insecthotel_stock_slot"+t+"_tt')\""}l+='<div class="slot">';if(this.data.data.stock[t]&&this.data.data.stock[t].pid){l+='<div class="remove link" onclick="insecthotel.deleteStockSlotCommit('+t+')" onmouseover="showDiv(\'insecthotel_stock_slot'+t+"_delete')\" onmouseout=\"hideDiv('insecthotel_stock_slot"+t+"_delete')\">";l+='  <div id="insecthotel_stock_slot'+t+'_delete" class="ttbox">'+t_insecthotel_stock_slot_delete+"</div>";l+="</div>"}l+='  <div class="col1" onclick="'+w+'" '+v+">";if(this.data.data.stock[t]&&this.data.data.stock[t].pid){l+='<div class="img tt'+this.data.data.stock[t].pid+'"></div>'}else{l+='<div class="drawplus"></div>'}if(d!=""){l+='<div class="'+d+'"></div>'}l+='    <div id="insecthotel_stock_slot'+t+'_tt" class="ttbox '+s+'">'+q+"</div>";l+="  </div>";l+='  <div class="col2">';var b="&nbsp;";var n=0;var m=0;var a=1;if(this.data.data.stock[t]){if(this.data.data.stock[t].pid){b=produkt_name[this.data.data.stock[t].pid];n=this.data.data.stock[t].amount;m=Math.min(100,((this.data.data.stock[t].amount*100)/this.data.config.stock_level[this.data.data.stock[t].level].capacity))}a=this.data.data.stock[t].level}l+='<div class="name">'+b+"</div>";if(this.data.data.stock[t]&&this.data.data.stock[t].buy_time){l+='<div class="bar">';l+='  <div class="bar_inner" style="width:'+m+'%"></div>';l+='  <div class="capacity">'+formatNumber(n)+"/"+formatNumber(this.data.config.stock_level[this.data.data.stock[t].level].capacity)+"</div>";l+="</div>";l+='<div class="level">'+a+"</div>"}l+='  <div id="insecthotel_stock_slot'+t+'_rent_timer" class="timer">'+t_insecthotel_stock_rent_duration+':&nbsp;<span id="insecthotel_stock_slot'+t+'_rent_timer_time"></span></div>';l+="  </div>";l+='  <div class="col3">';if(this.data.data.stock[t]&&d==""){var e=(parseInt(this.data.data.stock[t].level)+1);if(this.data.config.stock_level[e]){l+='<div class="upgrade link" onclick="insecthotel.upgradeStockSlotCommit('+t+')" onmouseover="showDiv(\'insecthotel_stock_slot'+t+"_upgrade_tt')\" onmouseout=\"hideDiv('insecthotel_stock_slot"+t+"_upgrade_tt')\">";l+='  <div class="img"></div>';l+='  <div id="insecthotel_stock_slot'+t+'_upgrade_tt" class="ttbox">'+t_insecthotel_stock_slot_upgrade+"</div>";l+="</div>"}}l+="  </div>";l+='  <div class="clear"></div>';l+="</div>"}l+='  <div class="clear"></div>';l+="</div>";l+='<div class="mini_close link" onclick="insecthotel.closeStock();"></div>';$("insecthotel_stock_inner").innerHTML=l;showDiv("insecthotel_stock");this.timerUpdate()};insecthotel.prototype.setStockSlotCommit=function(t){if(t){this.fillSlot=t;this.fillProduct=0;this.fillAmount=0;if(this.data.data.stock[this.fillSlot]&&this.data.data.stock[this.fillSlot].pid){this.fillProduct=this.data.data.stock[this.fillSlot].pid}}var n=[];if(this.data.data.stock[this.fillSlot]&&this.data.data.stock[this.fillSlot].pid){}else{for(var d in this.data.data.stock){if(this.data.data.stock[d].pid){n.push(this.data.data.stock[d].pid)}}}var c=[];if(!this.fillProduct||in_array(this.fillProduct,n)){for(d=0;d<this.data.data.products.length;d++){if(!in_array(this.data.data.products[d],n)){this.fillProduct=this.data.data.products[d];break}}}var s=this.data.config.stock_level[this.data.data.stock[this.fillSlot].level].capacity;var e=checkRackItem(this.fillProduct);var q=this.fillAmount;if(this.fillAmount==0&&e>0){q=Math.min(e,s)}var m=0;var l=0;var a=0;var b=0;if(this.data.data.stock[t]&&this.data.data.stock[t].pid){m=this.data.data.stock[t].amount;l=((this.data.data.stock[t].amount*100)/s);b=1}var h='<div id="insecthotel_commit">';h+='  <div style="margin-bottom:2px;">'+t_insecthotel_stock_slot_capacity+":</div>";h+='  <div class="bar">';h+='    <div id="insecthotel_setstockslot_inner2" class="bar_inner2"></div>';h+='    <div class="bar_inner" style="width:'+l+'%"></div>';h+="  </div>";h+='  <div style="margin-top:2px;"><span id="insecthotel_setstockslot_current">'+formatNumber(m)+"</span>/"+formatNumber(s)+"</div>";h+='  <div class="dropdown">';h+=htmlProductDropdown("insecthotel",n,c,b);h+="  </div>";h+='  <div class="border">';h+='    <input id="insecthotel_slot_number" class="input" type="number" value="'+q+'" onchange="insecthotel.setStockSlotCommitCheckAmount()" onkeyup="insecthotel.setStockSlotCommitCheckAmount()">';h+='    <div class="stock">'+t_inner_stock+"&nbsp;"+formatNumber(e)+"</div>";h+='    <button class="button_new link" onclick="insecthotel.setStockSlot()">'+t_inner_feedsubmit+"</button>";h+='    <div class="clear"></div>';h+="  </div>";h+='  <div class="info">'+t_insecthotel_stock_slot_fill_info+"</div>";h+="</div>";var r="insecthotel.buildStock()";globalBoxFlex(t_fuelstation_insert_dialog,h,0,r,1);this.setStockSlotCommitCheckAmount()};insecthotel.prototype.setStockSlotCommitCheckAmount=function(){var c=checkRackItem(this.fillProduct);var h=$("insecthotel_slot_number").value;var a=this.data.config.stock_level[this.data.data.stock[this.fillSlot].level].capacity;var b=0;if(this.data.data.stock[this.fillSlot]&&this.data.data.stock[this.fillSlot].pid){b=parseInt(this.data.data.stock[this.fillSlot].amount)}var d=parseInt(a-b);if(h>c){h=c}if(h>d){h=d}if(h<0){h=0}h=parseInt(h);var e=(((b+h)*100)/a);$("insecthotel_setstockslot_inner2").style.width=e+"%";$("insecthotel_setstockslot_current").innerHTML=(b+h);$("insecthotel_setstockslot_current").removeClassName("add");if(h>0){$("insecthotel_setstockslot_current").addClassName("add")}this.fillAmount=h;$("insecthotel_slot_number").value=h};insecthotel.prototype.setStockSlotCommitSetProduct=function(a){this.fillProduct=a;this.fillAmount=0;this.setStockSlotCommit()};insecthotel.prototype.buyStockSlotCommit=function(h){var l="";var n="";var c=specialbonus.findBonus({key1:"insecthotel",key2:"rentslot"});if(c){l="bonus";n=specialbonus.htmlBonusLine(c.rentslot)}var e=t_insecthotel_stock_buy_slot_head;var b=t_insecthotel_stock_buy_slot_desc;if(this.data.config.stock[h].money&&this.data.config.stock[h].money>0){b=b.replace("%COST%","<b>"+formatPrice(this.data.config.stock[h].money)+"</b>")}if(this.data.config.stock[h].coins&&this.data.config.stock[h].coins>0){b=b.replace("%COST%","<b>"+this.data.config.stock[h].coins+"&nbsp;"+t_coins+"</b>")}if(this.data.config.stock[h].rent){var q=this.data.config.stock[h].rent.coins;if(c){q=Math.ceil(q*(1-c.rentslot))}e=t_insecthotel_stock_rent_slot_head;b=t_insecthotel_stock_rent_slot_desc.replace("%COST%",'<b><span class="'+l+'">'+q+"&nbsp;"+t_coins+"</span></b>").replace("%TIME%",formatTime(this.data.config.stock[h].rent.duration))}var a='<div id="insecthotel_commit">'+b+"</div>";if(n!=""){a+='<div style="margin-top:5px;">'+n+"</div>"}var m="insecthotel.buyStockSlot("+h+")";var d="insecthotel.buildStock()";globalcommitbox(e,a,m,d)};insecthotel.prototype.deleteStockSlotCommit=function(d){var a='<div id="insecthotel_commit">'+t_insecthotel_stock_slot_delete_body+"</div>";var c="insecthotel.deleteStockSlot("+d+")";var b="insecthotel.buildStock()";globalcommitbox(t_insecthotel_stock_slot_delete,a,c,b)};insecthotel.prototype.upgradeStockSlotCommit=function(l){var m="";var q="";var c=(parseInt(this.data.data.stock[l].level)+1);if(this.data.config.stock_level[c].money){var a=this.data.config.stock_level[c].money;var b=formatPrice(a)}if(this.data.config.stock_level[c].coins){var e=specialbonus.findBonus({key1:"insecthotel",key2:"stock"});if(e){m="bonus";q=specialbonus.htmlBonusLine(e.stock)}var r=this.data.config.stock_level[c].coins;if(e){r=Math.ceil(r*(1-e.stock))}var b=r+"&nbsp;"+t_coins}var d='<div id="insecthotel_commit">';d+='  <div style="margin-bottom:10px;">'+t_insecthotel_stock_slot_capacity+":&nbsp;<b>"+this.data.config.stock_level[c].capacity+"</b></div>";d+="  <div>"+t_insecthotel_stock_slot_upgrade_body.replace("%COST%",'<b><span class="'+m+'">'+b+"</span></b>")+"</b></div>";if(q!=""){d+='<div style="margin-top:5px;">'+q+"</div>"}d+="</div>";var n="insecthotel.upgradeStockSlot("+l+")";var h="insecthotel.buildStock()";globalcommitbox(t_insecthotel_stock_slot_upgrade,d,n,h)};insecthotel.prototype.closeStock=function(){hideDiv("insecthotel_stock")};insecthotel.prototype.buildCheckout=function(){hideDiv("globaltransp");hideDiv("globalbox");var a=0;var n=0;if(this.data.data.checkout&&this.data.data.checkout.money){a=this.data.data.checkout.money}if(this.data.data.checkout&&this.data.data.checkout.points){n=this.data.data.checkout.points}var c='<div class="head">'+t_insecthotel_checkout_head+"</div>";c+='<div class="desc">'+t_insecthotel_checkout_desc+":</div>";c+='<div class="list">';var r={money:gamecurrency,points:t_points};var m="off";var q="";for(var b in r){var e=0;if(this.data.data.checkout&&this.data.data.checkout[b]){e=this.data.data.checkout[b]}if(e>0){m="";q="insecthotel.collectCheckout()"}var h=this.data.config.checkout_level[this.data.data.checkout.level].limit[b];var d=Math.min(100,(e*100)/h);c+='<div class="line">';c+='  <div class="col1 '+b+'"></div>';c+='  <div class="col2">';c+='    <div class="amount">'+formatNumber(e)+"/"+formatNumber(h)+"&nbsp;"+r[b]+"</div>";c+='    <div class="bar">';c+='      <div class="bar_inner" style="width:'+d+'%"></div>';c+="    </div>";c+="  </div>";c+='  <div class="clear"></div>';c+="</div>"}c+="</div>";c+='<div class="button_new link '+m+'" onclick="'+q+'">'+t_insecthotel_checkout_button+"</div>";if(this.data.config.checkout_level[(parseInt(this.data.data.checkout.level)+1)]){var q="insecthotel.upgradeCheckoutCommit()";var m="";c+='<div class="upgrade">';c+='  <div style="font-weight:bold; margin-bottom:5px;">'+t_scouts_skill_next_level+":</div>";c+='  <div class="line">';c+='    <div class="col1 money"></div>';var l=(this.data.config.checkout_level[(parseInt(this.data.data.checkout.level)+1)].limit.money-this.data.config.checkout_level[this.data.data.checkout.level].limit.money);c+='    <div class="col3">'+t_insecthotel_checkout_capacity+"&nbsp;+"+l+"</div>";c+='    <div class="clear"></div>';c+="  </div>";c+='  <div class="line">';c+='    <div class="col1 points"></div>';var l=(this.data.config.checkout_level[(parseInt(this.data.data.checkout.level)+1)].limit.points-this.data.config.checkout_level[this.data.data.checkout.level].limit.points);c+='    <div class="col3">'+t_insecthotel_checkout_capacity+"&nbsp;+"+l+"</div>";c+='    <div class="clear"></div>';c+="  </div>";c+='  <div class="button_new link '+m+'" onclick="'+q+'">'+t_insecthotel_checkout_upgrade_head+"</div>";c+="</div>"}c+='<div class="mini_close link" onclick="insecthotel.closeCheckout();"></div>';$("insecthotel_checkout_inner").innerHTML=c;showDiv("insecthotel_checkout");this.timerUpdate()};insecthotel.prototype.upgradeCheckoutCommit=function(){var l="";var n="";var c=(parseInt(this.data.data.checkout.level)+1);if(this.data.config.checkout_level[c].money&&this.data.config.checkout_level[c].money>0){var a=this.data.config.checkout_level[c].money;var b=formatPrice(a)}if(this.data.config.checkout_level[c].coins&&this.data.config.checkout_level[c].coins>0){var e=specialbonus.findBonus({key1:"insecthotel",key2:"checkout"});if(e){l="bonus";n=specialbonus.htmlBonusLine(e.checkout)}var q=this.data.config.checkout_level[c].coins;if(e){q=Math.ceil(q*(1-e.checkout))}var b=q+"&nbsp;"+t_coins}var d='<div id="insecthotel_commit">';d+="  <div>"+t_insecthotel_checkout_upgrade_desc.replace("%COST%",'<b><span class="'+l+'">'+b+"</span></b>")+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}d+="</div>";var m="insecthotel.upgradeCheckout()";var h="insecthotel.buildCheckout()";globalcommitbox(t_insecthotel_checkout_upgrade_head,d,m,h)};insecthotel.prototype.closeCheckout=function(){hideDiv("insecthotel_checkout")};insecthotel.prototype.buildBooster=function(){hideDiv("globaltransp");hideDiv("globalbox");var d=specialbonus.findBonus({key1:"insecthotel",key2:"booster"});var n="";var c='<div class="head">'+t_insecthotel_booster_head+"</div>";c+='<div class="desc">'+t_insecthotel_booster_desc+"</div>";for(var b in this.data.config.booster){var l=t_insecthotel_booster_info[b].replace("%PERCENT%",Math.round(this.data.config.booster[b][1].percent*100));c+='<div class="line">';c+="  <div>"+l+"</div>";for(var a in this.data.config.booster[b]){if(!this.data.config.booster[b][a].duration){continue}var h="";var e="";var q=this.data.config.booster[b][a].coins;if(d){q=Math.ceil(q*(1-d.booster));e="bonus";n='<div style="margin-bottom:10px;">'+specialbonus.htmlBonusLine(d.booster)+"</div>"}var m="insecthotel.buyBoosterCommit('"+b+"', "+a+")";if(parseInt(user_coins)<parseInt(q)){h="off";m=""}c+='  <div style="position:relative; float:left; width:290px;">';c+='    <div id="insecthotel_booster_'+b+"_"+a+'_button" class="link coinsbutton_flex '+h+'" onclick="'+m+'">'+t_insecthotel_booster_buy_button.replace("%TIME%",formatTime(this.data.config.booster[b][a].duration)).replace("%COST%",'<span class="'+e+'">'+q+"&nbsp;"+t_coins+"</span>")+"</div>";c+="  </div>"}c+='  <div class="clear"></div>';c+='  <div id="insecthotel_booster_'+b+'_timer" class="timer"></div>';c+="</div>"}if(n!=""){c+=n}c+='<div class="mini_close link" onclick="insecthotel.closeBooster();"></div>';$("insecthotel_booster_inner").innerHTML=c;showDiv("insecthotel_booster");this.timerUpdate()};insecthotel.prototype.buyBoosterCommit=function(a,b){var e=specialbonus.findBonus({key1:"insecthotel",key2:"booster"});var q="";var l="";var r=this.data.config.booster[a][b].coins;if(e){r=Math.ceil(r*(1-e.booster));l="bonus";q='<div style="margin-bottom:10px;">'+specialbonus.htmlBonusLine(e.booster)+"</div>"}var m=t_insecthotel_booster_info[a].replace("%PERCENT%",Math.round(this.data.config.booster[a][b].percent*100)).replace("%TIME%",formatTime(this.data.config.booster[a][b].duration));var c=t_insecthotel_booster_buy_button.replace("%TIME%",formatTime(this.data.config.booster[a][b].duration)).replace("%COST%",'<span class="'+l+'">'+r+"&nbsp;"+t_coins+"</span>");var d='<div id="insecthotel_commit">';d+="  <div>"+m+"</div>";d+='  <div style="margin-top:10px;">'+cityadcost+"</div>";d+='  <div style="font-weight:bold; margin-top:5px;">'+c+"</div>";if(q!=""){d+=q}d+="</div>";var n="insecthotel.buyBooster('"+a+"', "+b+")";var h="insecthotel.buildBooster()";globalcommitbox(t_insecthotel_booster_buy_head,d,n,h)};insecthotel.prototype.closeBooster=function(){hideDiv("insecthotel_booster")};insecthotel.prototype.buildProductbonus=function(){hideDiv("globaltransp");hideDiv("globalbox");if(!this.fillBonusproduct){if(this.data.data.bonus_pid&&this.data.data.bonus_pid.pid){this.fillBonusproduct=this.data.data.bonus_pid.pid}else{for(var d=0;d<this.data.data.bonusproducts.length;d++){this.fillBonusproduct=this.data.data.bonusproducts[d];break}}}var c='<div class="head">'+t_insecthotel_productbonus_head+"</div>";c+='<div class="desc">'+t_insecthotel_productbonus_desc+"</div>";c+='<div class="line2">';var a=0;if(this.data.data.bonus_pid.max){a=this.data.data.bonus_pid.max}if(this.data.data.bonus_pid&&this.data.data.bonus_pid.pid){c+='<div class="topic">'+t_insecthotel_productbonus_bonus_active+":</div>";c+='<div class="tt'+this.data.data.bonus_pid.pid+' pid"></div>'}else{c+='<div style="margin:10px 0px 20px 0px;">'+t_insecthotel_productbonus_bonus_none+"</div>"}c+='<div class="bonus">';for(var d=0;d<this.data.config.constants.bonusproduct_bonus.length;d++){var b="off";if(d==a){b="active"}if(d>0){c+='<div class="spacer off"></div>'}c+='<div class="point '+b+'">';c+='  <div class="amount">'+(this.data.config.constants.bonusproduct_bonus[d]*100)+"</div>";c+='  <div class="percent">%</div>';c+="</div>"}c+="</div>";c+='<div style="margin-top:5px;">'+t_insecthotel_productbonus_current_bonus.replace("%COUNT%",a)+"</div>";c+="</div>";c+='<div class="line2">';c+='  <div class="topic">'+t_insecthotel_productbonus_select+":</div>";c+=htmlProductDropdown("insecthotel2",[],[]);c+='  <div id="insecthotel_productbonus_button" class="button_new link" onclick="insecthotel.setBonusproductCommit()">'+t_insecthotel_productbonus_button+"</div>";c+='  <div id="insecthotel_productbonus_info1" class="info">'+t_insecthotel_productbonus_info2.replace("%TIME%",formatTime(this.data.config.constants.bonusproduct_cooldown))+"</div>";c+='  <div id="insecthotel_productbonus_info2" class="info">'+t_insecthotel_productbonus_info.replace("%TIME%",'<span id="insecthotel_productbonus_timer"></span>')+"</div>";c+='  <div id="insecthotel_productbonus_speedup" class="link coinsbutton_flex" onclick="insecthotel.speedupBonusproductCommit()">'+t_insecthotel_productbonus_speedup_head+"</div>";c+="</div>";c+='<div class="mini_close link" onclick="insecthotel.closeProductbonus();"></div>';$("insecthotel_productbonus_inner").innerHTML=c;showDiv("insecthotel_productbonus");this.timerUpdate()};insecthotel.prototype.speedupBonusproductCommit=function(){var d=this.data.data.productbonuscoins+"&nbsp;"+t_coins;var a='<div id="insecthotel_commit">'+t_insecthotel_productbonus_speedup_desc.replace("%COST%","<b>"+d+"</b>")+"</div>";var c="insecthotel.speedupBonusproduct()";var b="insecthotel.buildProductbonus()";globalcommitbox(t_insecthotel_productbonus_speedup_head,a,c,b)};insecthotel.prototype.setBonusproductSelect=function(a){this.fillBonusproduct=a;this.buildProductbonus()};insecthotel.prototype.setBonusproductCommit=function(){if($("insecthotel_productbonus_button").hasClassName("off")){return 1}this.setBonusproduct()};insecthotel.prototype.closeProductbonus=function(){hideDiv("insecthotel_productbonus")};insecthotel.prototype.showStats=function(){var a='<div id="insecthotel_stats">';a+='  <div class="select_line">';a+='    <select id="insecthotel_stats_select" onchange="insecthotel.stats()">';for(var b=0;b<this.stats_options.length;b++){if(this.stats_options[b]==""){a+='<option value="0">---</option>';continue}var c="";if(this.stats_select==this.stats_options[b]){c="selected"}a+='<option value="'+this.stats_options[b]+'" '+c+">"+t_insecthotel_stats[this.stats_options[b]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_insecthotel_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select],this.stats_select,"insecthotel");a+="</div>";globalBoxFlex("",a,0,0,1)};insecthotel.prototype.startTutorial=function(){this.tutorialStep=0;showDiv("insecthotel_tutorial");this.nextTutorialStep()};insecthotel.prototype.nextTutorialStep=function(){this.tutorialStep++;if(!t_insecthotel_tutorial_text[this.tutorialStep]){this.closeTutorial();return 1}var c="insecthotel.nextTutorialStep()";var b=t_continue;if(!t_insecthotel_tutorial_text[(this.tutorialStep+1)]){c="insecthotel.finishTutorial();";b=t_vineyard_tutorial_text_finish}var d=t_insecthotel_tutorial_text[this.tutorialStep];d=d.replace("%USERNAME%","<b>"+username+"</b>");this.resetTutorial();if(this.tutorialStep==2){$("insecthotel_deco_slot1").addClassName("tutorial_highlight").addClassName("pulse2");$("insecthotel_slots_slot1").addClassName("tutorial_highlight")}if(this.tutorialStep==3){$("insecthotel_slotinfo_plants").addClassName("tutorial_highlight").addClassName("pulse2")}if(this.tutorialStep==4){$("insecthotel_slotinfo_happiness").addClassName("tutorial_highlight").addClassName("pulse2")}if(this.tutorialStep==5){$("insecthotel_slotinfo_population").addClassName("tutorial_highlight").addClassName("pulse2")}if(this.tutorialStep==7){this.closeInfo();$("insecthotel_button_stock").addClassName("tutorial_highlight").addClassName("pulse")}if(this.tutorialStep==8){$("insecthotel_timeline").addClassName("tutorial_highlight").addClassName("pulse")}if(this.tutorialStep==9){$("insecthotel_button_checkout").addClassName("tutorial_highlight").addClassName("pulse")}var a=d;a+='<div id="insecthotel_tutorial_footer" class="footer"><button class="button_new link" onclick="'+c+'">'+b+"</button></div>";$("insecthotel_tutorial_bubble").innerHTML=a;$("insecthotel_tutorial").className="tutorial step"+this.tutorialStep;showDiv("insecthotel_tutorial_transp");hideDiv("insecthotel_tutorial_transp_half");showDiv("insecthotel_tutorial_footer");showDiv("insecthotel_info_close");if(this.tutorialStep==2){hideDiv("insecthotel_tutorial_footer")}if(in_array(this.tutorialStep,[3,4,5])){hideDiv("insecthotel_tutorial_transp");showDiv("insecthotel_tutorial_transp_half");hideDiv("insecthotel_info_close")}if(this.tutorialStep==6){hideDiv("insecthotel_info_close")}};insecthotel.prototype.resetTutorial=function(){if($("insecthotel_deco_slot1")){$("insecthotel_deco_slot1").removeClassName("tutorial_highlight").removeClassName("pulse2")}if($("insecthotel_slots_slot1")){$("insecthotel_slots_slot1").removeClassName("tutorial_highlight")}if($("insecthotel_slotinfo_plants")){$("insecthotel_slotinfo_plants").removeClassName("tutorial_highlight").removeClassName("pulse2")}if($("insecthotel_slotinfo_happiness")){$("insecthotel_slotinfo_happiness").removeClassName("tutorial_highlight").removeClassName("pulse2")}if($("insecthotel_slotinfo_population")){$("insecthotel_slotinfo_population").removeClassName("tutorial_highlight").removeClassName("pulse2")}if($("insecthotel_button_stock")){$("insecthotel_button_stock").removeClassName("tutorial_highlight").removeClassName("pulse")}if($("insecthotel_button_checkout")){$("insecthotel_button_checkout").removeClassName("tutorial_highlight").removeClassName("pulse")}if($("insecthotel_timeline")){$("insecthotel_timeline").removeClassName("tutorial_highlight").removeClassName("pulse")}};insecthotel.prototype.closeTutorial=function(){this.resetTutorial();hideDiv("insecthotel_tutorial")};insecthotel.prototype.help=function(){showDiv("insecthotel_help");this.naviHelp("info")};insecthotel.prototype.naviHelp=function(b){hideDiv("insecthotel_help_info");hideDiv("insecthotel_help_achievements");$("insecthotel_help_navi_info").removeClassName("active");$("insecthotel_help_navi_achievements").removeClassName("active");showDiv("insecthotel_help_"+b);$("insecthotel_help_navi_"+b).addClassName("active");if(b=="achievements"){for(var b in this.data.config.achievements){for(var c in this.data.config.achievements[b]){var a=this.data.config.achievements[b][c];if(in_array(a,this.data.data.achievements)){showDiv("insecthotel_help_achievement"+a+"_ready")}}}}};insecthotel.prototype.closeHelp=function(){hideDiv("insecthotel_help")};insecthotel.prototype.timer=function(){if(this.data.data){if(this.data.data){this.data.data.remain--}for(var b in this.data.config.stock){if(this.data.config.stock[b].rent&&this.data.data.stock&&this.data.data.stock[b]){this.data.data.stock[b].remain--}}if(this.data.data.booster){for(var a in this.data.data.booster){if(this.data.data.booster[a]){this.data.data.booster[a].remain--}}}if(this.data.data.bonus_pid&&this.data.data.bonus_pid.pid){this.data.data.bonus_pid.remain--}this.timerUpdate()}};insecthotel.prototype.timerUpdate=function(){if(this.data.data){if(this.data.data.remain==-1){this.data.data.remain-=2;this.silent()}if($("insecthotel_timeline_time")&&this.data.data.remain>=0){$("insecthotel_timeline_time").innerHTML=formatTime(this.data.data.remain)}}for(var c in this.data.config.stock){if(this.data.config.stock[c].rent&&this.data.data.stock&&this.data.data.stock[c]){hideDiv("insecthotel_stock_slot"+c+"_rent_timer");if(this.data.data.stock[c].remain>0){if($("insecthotel_stock_slot"+c+"_rent_timer")){$("insecthotel_stock_slot"+c+"_rent_timer_time").innerHTML=formatTime(this.data.data.stock[c].remain)}showDiv("insecthotel_stock_slot"+c+"_rent_timer")}if(this.data.data.stock[c].remain==-1){this.data.data.stock[c].remain--;this.buildStock()}}}if(this.data.data.booster){for(var a in this.data.data.booster){hideDiv("insecthotel_booster_"+a+"_timer");for(var b in this.data.config.booster[a]){showDiv("insecthotel_booster_"+a+"_"+b+"_button")}if(this.data.data.booster[a].remain>0){for(var b in this.data.config.booster[a]){hideDiv("insecthotel_booster_"+a+"_"+b+"_button")}showDiv("insecthotel_booster_"+a+"_timer");if($("insecthotel_booster_"+a+"_timer")){$("insecthotel_booster_"+a+"_timer").innerHTML=formatTime(this.data.data.booster[a].remain)}}}}showDiv("insecthotel_productbonus_info1");hideDiv("insecthotel_productbonus_info2");hideDiv("insecthotel_productbonus_speedup");if($("insecthotel_productbonus_button")){$("insecthotel_productbonus_button").removeClassName("off")}if(this.data.data.bonus_pid&&this.data.data.bonus_pid.pid&&$("insecthotel_productbonus_button")){if(this.data.data.bonus_pid.remain>0){hideDiv("insecthotel_productbonus_info1");showDiv("insecthotel_productbonus_info2");showDiv("insecthotel_productbonus_speedup");if($("insecthotel_productbonus_timer")){$("insecthotel_productbonus_timer").innerHTML=formatTime(this.data.data.bonus_pid.remain)}$("insecthotel_productbonus_button").addClassName("off")}}};insecthotel.prototype.close=function(){hideDiv("insecthotel")};var jamexchange=function(){this.data={};this.send={};this.fhelp;this.currentSlot=0};jamexchange.prototype.levelup=function(){jamexchange.action("jamexchange_levelup")};jamexchange.prototype.speedup=function(){jamexchange.action("jamexchange_speedup")};jamexchange.prototype.exchange=function(){jamexchange.action("jamexchange_exchange",{send:JSON.stringify(this.send)})};jamexchange.prototype.init=function(){jamexchange.action("jamexchange_init")};jamexchange.prototype.action=function(a,b){ajaxAction("city",a,b,jamexchange.response)};jamexchange.prototype.response=function(b,a,c){jamexchange.data=b;jamexchange.send={};if(a=="jamexchange_exchange"){jamexchange.showProducts(b.products)}else{jamexchange.build()}};jamexchange.prototype.build=function(l){var m=Math.min(100,this.data.data.level_percent);var a=t_jamexchange_next_level.replace("%POINTS%",this.data.data.level_rest);if(!this.data.config.level[(+this.data.data.level+1)]){a=t_jamexchange_max_level}var e='<div id="jamexchange_main">';e+='  <div class="bar">';e+='    <div class="bar_inner" style="width:'+m+'%"></div>';e+='    <div class="bar_front" onmouseover="showDiv(\'jamexchange_bar_tt\')" onmouseout="hideDiv(\'jamexchange_bar_tt\')"></div>';e+='    <div id="jamexchange_bar_tt" class="ttbox">';e+='      <div style="margin-bottom:10px;">'+a+"</div>";e+='      <div style="font-weight:bold;">'+t_jamexchange_level_current+"</div>";e+="      <div>"+t_jamexchange_level_max_amount.replace("%AMOUNT%",this.data.config.level[this.data.data.level].max)+"</div>";if(this.data.config.level[(+this.data.data.level+1)]){e+='<div style="font-weight:bold; margin-top:5px;">'+t_jamexchange_level_next+"</div>";e+="<div>"+t_jamexchange_level_max_amount.replace("%AMOUNT%",this.data.config.level[(+this.data.data.level+1)].max)+"</div>"}e+="    </div>";e+='    <div class="level">'+this.data.data.level+"</div>";if(this.data.config.level[(+this.data.data.level+1)]){e+='<div class="levelup button_new link" onclick="jamexchange.levelupCommit()">'+t_jamexchange_levelup_button+"</div>"}e+="  </div>";e+='  <div id="jamexchange_timer" class="timer">';e+="    <div>"+t_jamexchange_time+"</div>";e+='    <div id="jamexchange_timer_timer" class="counter"></div>';e+='    <div id="jamexchange_timer_button" class="button_new link" onclick="jamexchange.speedupCommit()">'+t_jamexchange_time_button+"</div>";e+="  </div>";var q="";if(this.send.pid){q="filled"}var r="jamexchange.openSelection()";if(this.send.pid){r=""}e+='  <div id="jamexchange_select" class="select '+q+'">';e+="    <div>"+t_jamexchange_select+"</div>";e+='    <div class="slot link" onclick="'+r+'">';if(this.send.pid){var n=this.data.config.level[this.data.data.level].max;var h=checkRackItem(this.send.pid);var d=1;if(this.send&&this.send.amount){d=this.send.amount}e+='<div class="pid tt'+this.send.pid+'" onclick="jamexchange.openSelection()"></div>';e+='<div id="jamexchange_select_remove" class="link close_mini_white" onclick="jamexchange.removeJam()"></div>';e+='<div class="data">';e+='  <div class="name">'+produkt_name[this.send.pid]+"</div>";e+='  <div style="position:relative;">';e+='    <input id="jamexchange_select_input" type="number" value="'+d+'" onchange="jamexchange.checkSelectInput()" onkeyup="jamexchange.checkSelectInput()">';e+='    <div class="max">/&nbsp;'+formatNumber(n)+"</div>";e+="  </div>";e+='  <div class="stockamount">'+t_inner_stock+"&nbsp;"+formatNumber(h)+"</div>";e+="</div>"}e+="    </div>";e+='    <div id="jamexchange_selection" class="selection">';for(var c in this.data.config.products){var q="";if(!checkRackItem(c)){q="off"}e+='<div class="slot link" onclick="jamexchange.selectJam('+c+')" onmouseover="showDiv(\'jamexchange_selection_'+c+"_tt')\" onmouseout=\"hideDiv('jamexchange_selection_"+c+"_tt')\">";e+='  <div class="pid tt'+c+" "+q+'"></div>';e+='  <div id="jamexchange_selection_'+c+'_tt" class="ttbox">'+produkt_name[c]+"</div>";e+="</div>"}e+="    </div>";e+="  </div>";q="";if(l==1){q="expand"}e+='  <div id="jamexchange_slots" class="slots '+q+'">';e+='    <div class="container flex-center-all">';var s=0;var n=this.data.config.max_slots;if(this.send.wish){n=1}for(i=1;i<=n;i++){q="";if(this.send.wish){q="filled"}e+='<div class="slot link '+q+'" onclick="jamexchange.openWishSelection('+i+')">';if(this.send.wish){e+='<div class="pid tt'+this.send.wish+'"></div>';e+='<div id="jamexchange_select_wish'+i+'_remove" class="link close_mini_white" onclick="jamexchange.removeWish('+i+')"></div>';s+=this.data.config.wish_coins}e+='  <div id="jamexchange_wish_amount" class="amount">?</div>';e+='  <div id="jamexchange_select_wish'+i+'_arrow" class="arrow"></div>';e+="</div>"}e+='      <div id="jamexchange_wish_selection" class="selection-wish"></div>';e+="    </div>";e+='    <div class="info">'+t_jamexchange_wish_info.replace("%COST%",this.data.config.wish_coins+"&nbsp;"+t_coins)+"</div>";var b=t_jamexchange_button;if(s>0){b=t_jamexchange_button2.replace("%COST%",s+"&nbsp;"+t_coins)}e+='    <div id="jamexchange_button" class="button_new link" onclick="jamexchange.exchangeCommit('+s+')">'+b+"</div>";e+="  </div>";e+='  <div class="help helpbutton_blue link" onclick="jamexchange.helpOpen(\'general\')"></div>';e+='  <div class="transp"></div>';e+="</div>";globalBoxFlex(t_jamexchange_name,e,0,0,1);$("globalbox").style.top="65px";this.timerUpdate();if(this.send.wish){this.checkSelectInput()}for(i=1;i<=this.data.config.max_slots;i++){if($("jamexchange_select_wish"+i+"_remove")){$("jamexchange_select_wish"+i+"_remove").observe("click",function(t){t.preventDefault();t.stopPropagation();return 1})}}if($("jamexchange_select_remove")){$("jamexchange_select_remove").observe("click",function(t){t.preventDefault();t.stopPropagation();return 1})}};jamexchange.prototype.exchangeCommit=function(a){this.send.amount=+$("jamexchange_select_input").value;if(a>0){var c='<div id="jamexchange_commit">';c+="  <div>"+t_jamexchange_exchange_desc.replace("%NAME%",'<span style="font-size:12px; font-weight:bold;">'+produkt_name[this.send.pid]+"</span>").replace("%COST%",'<span style="font-size:12px; font-weight:bold;">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";c+="</div>";var d="jamexchange.exchange()";var b="jamexchange.build()";globalcommitbox(t_jamexchange_exchange_head,c,d,b)}else{this.exchange()}};jamexchange.prototype.openSelection=function(){if($("jamexchange_selection").style.display=="flex"){hideDiv("jamexchange_selection")}else{$("jamexchange_selection").style.display="flex";hideDiv("jamexchange_select_remove");hideDiv("jamexchange_wish_selection");for(i=1;i<=this.data.config.max_slots;i++){hideDiv("jamexchange_select_wish"+i+"_arrow")}}};jamexchange.prototype.selectJam=function(a){if(!checkRackItem(a)){return 1}hideDiv("jamexchange_selection");this.send.pid=a;this.build();setTimeout(function(){$("jamexchange_slots").addClassName("expand")},100);$("jamexchange_select_input").focus()};jamexchange.prototype.removeJam=function(){this.send={};this.build(1);setTimeout(function(){$("jamexchange_slots").removeClassName("expand")},100)};jamexchange.prototype.checkSelectInput=function(){var d=checkRackItem(this.send.pid);var a=this.data.config.level[this.data.data.level].max;var b=+$("jamexchange_select_input").value;if(b<1){b=1}if(b>d){b=d}if(b>a){b=a}$("jamexchange_select_input").value=b;this.send.amount=b;if(this.send.wish){var c=b*produkt_price[this.send.pid];c=Math.ceil(c/produkt_price[this.send.wish]);$("jamexchange_wish_amount").innerHTML=c}};jamexchange.prototype.openWishSelection=function(l){if(l==this.currentSlot&&$("jamexchange_wish_selection").style.display=="block"){hideDiv("jamexchange_select_wish"+this.currentSlot+"_arrow");hideDiv("jamexchange_wish_selection");this.currentSlot=0;return 1}this.currentSlot=l;var h=[];if(this.send.wish){h.push(this.send.wish)}for(c=1;c<=this.data.config.max_slots;c++){hideDiv("jamexchange_select_wish"+c+"_arrow")}showDiv("jamexchange_select_wish"+l+"_arrow");var d='<div class="flex-center-all" style="flex-wrap:wrap; gap:10px;">';for(var c=0;c<this.data.config.products[this.send.pid].pool.length;c++){var b=this.data.config.products[this.send.pid].pool[c];var a="";var e="jamexchange.selectWish("+l+", "+b+")";if(in_array(b,h)){a="off";e=""}d+='<div class="slot link" onclick="'+e+'" onmouseover="showDiv(\'jamexchange_wish_selectiom_pid'+b+"')\" onmouseout=\"hideDiv('jamexchange_wish_selectiom_pid"+b+"')\">";d+='  <div class="pid tt'+b+" "+a+'"></div>';d+='  <div id="jamexchange_wish_selectiom_pid'+b+'" class="ttbox">'+produkt_name[b]+"</div>";d+="</div>"}d+="</div>";$("jamexchange_wish_selection").innerHTML=d;showDiv("jamexchange_wish_selection")};jamexchange.prototype.selectWish=function(b,a){this.send.wish=a;this.build(1)};jamexchange.prototype.removeWish=function(a){delete this.send.wish;this.build(1)};jamexchange.prototype.speedupCommit=function(){var a=Math.ceil(this.data.data.remain/this.data.config.cooldown_coin_duration);var c='<div id="jamexchange_commit">';c+="  <div>"+t_jamexchange_speedup_desc.replace("%COST%",'<span style="font-size:12px; font-weight:bold;">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";c+="</div>";var d="jamexchange.speedup()";var b="jamexchange.build()";globalcommitbox(t_jamexchange_speedup_head,c,d,b)};jamexchange.prototype.levelupCommit=function(){var a=Math.ceil(this.data.data.level_rest/this.data.config.level_coin_rest);var c='<div id="jamexchange_commit">';c+="  <div>"+t_jamexchange_levelup_desc.replace("%COST%",'<span style="font-size:12px; font-weight:bold;">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";c+="</div>";var d="jamexchange.levelup()";var b="jamexchange.build()";globalcommitbox(t_jamexchange_levelup_head,c,d,b)};jamexchange.prototype.timer=function(){if(this.data.data&&this.data.data.remain){this.data.data.remain--}this.timerUpdate()};jamexchange.prototype.timerUpdate=function(){if(city==1&&$("jamexchange_link")){showDiv("jamexchange_link")}else{hideDiv("jamexchange_link")}if($("jamexchange_main")){hideDiv("jamexchange_timer");hideDiv("jamexchange_select");hideDiv("jamexchange_slots");if(this.data.data.remain>0){$("jamexchange_timer_timer").innerHTML=formatTime(this.data.data.remain);showDiv("jamexchange_timer")}else{showDiv("jamexchange_select");showDiv("jamexchange_slots")}}};jamexchange.prototype.showProducts=function(d){this.send={};if(d){var b='<div id="jamexchange_commit">';b+='<div style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";b+='<div class="flex-center-all">';b+="  <div>";for(var a in d){b+='<div class="line">'+htmlProductBody(a,d[a])+"</div>"}b+="  </div>";b+="</div>";var c="jamexchange.build()";globalcommitbox(t_jamexchange_name,b,c);hideDiv("globalbox_button2")}};jamexchange.prototype.helpOpen=function(a){fhelp.init({type:"jamexchange",insert:"garten_komplett",flex:1,navi:["general","products"]});fhelp.open(a)};jamexchange.prototype.helpPage=function(c){var b="";if(c=="general"){b+='<div class="line headline">'+t_jamexchange_help1_head+"</div>";b+='<div class="line">'+t_jamexchange_help1_line1+"</div>";b+='<div class="line">'+t_jamexchange_help1_line2+"</div>";b+='<div class="line">'+t_jamexchange_help1_line3.replace("%COUNT%",this.data.config.max_slots)+"</div>";b+='<div class="line tipp">'+t_jamexchange_help1_line4.replace("%COST%",this.data.config.wish_coins+"&nbsp;"+t_coins)+"</div>";b+='<div class="line">'+t_jamexchange_help1_line5.replace("%DURATION%",formatTime(this.data.config.cooldown))+"</div>";b+='<div class="line">'+t_jamexchange_help1_line6+"</div>";b+='<div class="line">'+t_jamexchange_help1_line7+"</div>"}else{if(c=="products"){b+='<div class="line headline">'+t_jamexchange_help2_head+"</div>";b+='<div class="list">';for(pid in this.data.config.products){b+='<div class="line flex-center-all">';b+='  <div class="col1 flex-center-all">';b+='    <div class="pid tt'+pid+'" onmouseover="showDiv(\'jamexchange_help_products_line'+pid+"_tt')\" onmouseout=\"hideDiv('jamexchange_help_products_line"+pid+"_tt')\">";b+='      <div id="jamexchange_help_products_line'+pid+'_tt" class="ttbox">'+produkt_name[pid]+"</div>";b+="    </div>";b+="  </div>";b+='  <div class="col2 flex-center-all">';for(var a=0;a<this.data.config.products[pid].pool.length;a++){b+='<div class="slot" onmouseover="showDiv(\'jamexchange_help_products_line'+pid+"_pid"+this.data.config.products[pid].pool[a]+"_tt')\" onmouseout=\"hideDiv('jamexchange_help_products_line"+pid+"_pid"+this.data.config.products[pid].pool[a]+"_tt')\">";b+='  <div class="pid tt'+this.data.config.products[pid].pool[a]+'">';b+='    <div id="jamexchange_help_products_line'+pid+"_pid"+this.data.config.products[pid].pool[a]+'_tt" class="ttbox">'+produkt_name[this.data.config.products[pid].pool[a]]+"</div>";b+="  </div>";b+="</div>"}b+="  </div>";b+="</div>"}b+="</div>"}}return b};function jobTeaser(){var b="";b+='<div style="margin-bottom:5px;">'+t_guildjob_teaser_intro+"</div>";b+='<div style="margin-bottom:5px;">';b+='  <div class="job_overview_link" style="float:left; margin-right:5px;"></div>';b+='  <div style="float:left; font-weight:bold; margin-top:3px;">'+t_guildjob_teaser_block1+"</div>";b+='  <div class="clear"></div>';b+="</div>";for(var a in job_data.config.jobs){b+='<div class="job_jobsymbol_mini job_jobsymbol'+a+'_mini" style="position:relative; float:left; margin:2px;"></div>'}b+='<div class="clear"></div>';b+='<div class="button_new link" style="width:200px; margin:0 auto;" onclick="showJobOverview()">'+t_guildjob_start_need_job_button+"</div>";b+='<div style="float:left; margin-right:30px; background-size:100%; width:40px; height:55px; margin-left:-20px;" class="guild_job_difficulty1"></div>';b+='<div style="float:left; font-weight:bold; margin-top:30px; margin-bottom:5px;">'+t_guildjob_teaser_block2+"</div>";b+='<div class="clear"></div>';if(player_guild>0){b+='<div class="button_new link" style="width:200px; margin:0 auto; margin-top:-30px;" onclick="initGuild()">'+t_go2guild+"</div>"}globalBoxFlex(t_guildjob_teaser_head,b,0,0,1)}function jobAchievements(){var b='<div style="width:440px; height:380px; text-align:left;">';for(var a in job_data.config.achievements){var c=t_guildjob_job_achievement[job_data.config.achievements[a].type];if(job_data.config.achievements[a].key){c=t_guildjob_job_achievement[job_data.config.achievements[a].key]}c=str_replace("%COUNT%",job_data.config.achievements[a].count,c);b+='<div style="position:relative; float:left; width:200px; margin:10px;">';b+='  <img src="'+imgpath+"gifts/"+job_data.config.achievements[a].giftid+'.gif" align="left" hspace="5" style="width:50px;">'+c;if(job_data.config.achievements[a].done){b+='<div style="display:block; right:auto; left:0px;" class="megafield_product_ready"></div>'}b+="</div>"}b+="</div>";click2="hideDiv('globalbox'); hideDiv('globaltransp'); showJobOverview();";globalBoxFlex(t_guildjob_job_achievements,b,0,click2,1);$("globalbox").style.top="50px"}function jobHelp(h){var d="";d+='<div style="width:500px; height:400px; margin-top:-30px; overflow:auto;">';d+='  <div id="jobhelp_navi">';for(var c=1;c<=4;c++){d+='<div id="jobhelp_navi'+c+'" class="link brown_tab" onclick="jobHelpNavi('+c+')">'+t_guildjob_help[c]+"</div>"}d+='    <div class="clear"></div>';d+="  </div>";d+='  <div class="brown_tab_content" style="text-align:left;">';for(var c=1;c<=4;c++){d+='<div id="jobhelp_content'+c+'">';if(c==1){d+='<div style="margin-bottom:10px;" class="headline">'+t_guildjob_help["1_1"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["1_2"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["1_3"]+"</div>";d+='<div style="margin-bottom:10px; padding:10px; border:2px solid #6C441D; border-radius:5px;">';d+='  <ol style="margin:0px; padding:0px 15px;">';d+='    <li style="margin-bottom:10px;">';d+="      <div>";d+="        <div>"+t_guildjob_help["1_4"]+"</div>";for(var e=1;e<=3;e++){var m=t_difficulty[e];if(e==1){m=t_difficulty[3]}if(e==3){m=t_difficulty[1]}d+='<div style="float:left; width:97px; height:120px; border-radius:5px; background-color:#C3A75E; margin-right:5px;">';d+='  <div style="text-align:center; margin:5px 0px -35px; font-weight:bold;">'+m+"</div>";d+='  <div class="guild_job_difficulty'+e+'" style="transform:scale(0.5); margin-top:-5px; margin-left:-30px;"></div>';d+="</div>"}d+='        <div class="clear"></div>';d+="      </div>";d+="    </li>";d+='    <li style="margin-bottom:10px;">'+t_guildjob_help["1_5"]+'<br><span style="margin-top:5px; display:block; color:navy; font-weight:bold;">'+t_guildjob_help["1_6"]+"</span></li>";d+='    <li style="margin-bottom:10px;">'+t_guildjob_help["1_7"]+"</li>";d+='    <li style="margin-bottom:10px;">'+t_guildjob_help["1_8"]+"</li>";d+="    <li>";d+="      <div>"+t_guildjob_help["1_9"]+"</div>";d+='      <div style="float:left; position:relative; border-radius:5px; margin:5px 0px;" class="l1"><div class="guildjob_orderpoints" style="right:-5px; top:-5px; position:absolute;"></div></div>';d+='      <div style="float:left; width:330px; margin-left:5px; margin-top:15px;" class="guild_job_bar">';d+='        <div style="position:absolute; top:0px; left:0px; background-color:#transparent; border-right:1px dashed #fff; height:20px; width:90%"></div>';d+="      </div>";d+='      <div style="float:left;"></div>';d+='      <div class="clear"></div>';d+="    </li>";d+="  </ol>";d+="</div>";d+='<div style="margin-bottom:10px; margin-top:15px;" class="headline">'+t_guildjob_help["1_10"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["1_20"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["1_12"]+"</div>";d+='<div style="margin-bottom:10px; margin-top:15px;" class="headline">'+t_guildjob_help["1_13"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["1_14"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["1_15"]+"</div>";d+='<div style="margin-bottom:10px;">';d+='  <ul style="margin:0px; padding:0px 15px;">';d+='    <li style="margin-bottom:10px;">'+t_guildjob_help["1_16"]+"</li>";d+='    <li style="margin-bottom:10px;">'+t_guildjob_help["1_17"]+"</li>";d+='    <li style="margin-bottom:10px;">'+t_guildjob_help["1_18"]+"</li>";d+='    <li style="margin-bottom:10px;">'+t_guildjob_help["1_19"]+"</li>";d+="  </ul>";d+="</div>"}if(c==2){d+='<div style="margin-bottom:10px;" class="headline">'+t_guildjob_help["2_1"]+"</div>";d+='<div style="margin-bottom:10px;">';d+='  <div style="float:left; margin-right:15px; border-radius:5px;" class="tt1">';d+='    <div class="guildjob_orderpoints" style="position:absolute; top:-5px; right:-10px;"></div>';d+="  </div>";d+='  <div style="float:left; width:400px;">'+t_guildjob_help["2_2"]+"</div>";d+='  <div class="clear"></div>';d+="</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["2_3"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["2_4"]+"</div>";d+='<div style="margin-bottom:10px; margin-top:15px;" class="headline">'+t_guildjob_help["2_5"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["2_6"]+"</div>";d+='<div style="margin-bottom:10px; font-weight:bold;">'+t_guildjob_help["2_7"]+"</div>";d+='<div style="margin-bottom:10px; padding:10px; border:2px solid #6C441D; border-radius:5px;">';d+='  <div style="margin-bottom:10px;">'+t_guildjob_help["2_8"]+"</div>";d+="  <div>"+t_guildjob_help["2_9"]+"</div>";d+="</div>";d+='<div style="margin-bottom:10px; margin-top:15px;" class="headline">'+t_guildjob_help["2_10"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["2_11"]+"</div>"}if(c==3){d+='<div style="margin-bottom:10px;" class="headline">'+t_guildjob_help["3_1"]+"</div>";d+='<div style="margin-bottom:10px;">';d+='  <div style="float:left; background:url('+imgpath+'reallocate_symbol7.png); background-position:0px -83px; width:20px; height:20px; margin-right:5px;" class="link" onclick="showJobOverview();"></div>';d+='  <div style="float:left; width:440px;">'+t_guildjob_help["3_2"]+"</div>";d+='  <div class="clear"></div>';d+="</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["3_3"]+"</div>";d+='<div style="margin-bottom:10px; margin-top:15px;" class="headline">'+t_guildjob_help["3_4"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["3_5"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["3_6"]+"</div>";d+='<div style="margin-top:15px;">';d+='  <div style="margin-bottom:10px;" class="headline">'+t_guildjob_help["3_7"]+"</div>";var a=8;for(var b=1;b<=2;b++){var n={};n[1]={data:job_data.config.tools,"class":"f_symbol",head:t_tool_name};n[2]={data:job_data.config.boosts,"class":"job_boost",head:t_booster_name};d+='<div style="margin-bottom:10px; padding:10px; border:2px solid #6C441D; border-radius:5px;">';d+='  <div style="float:left; width:120px; margin-right:5px;">';for(id in n[b].data){d+='<div class="'+n[b]["class"]+id+'" style="float:left; margin:2px;"></div>'}d+="  </div>";d+='  <div style="float:left; width:315px;">';d+='    <div class="headline">'+n[b].head+"</div>";d+='    <div style="margin-bottom:10px;">'+t_guildjob_help["3_"+a]+"</div>";a++;d+="    <div>"+t_guildjob_help["3_"+a]+"</div>";a++;d+="  </div>";d+='  <div class="clear"></div>';d+="</div>"}d+="</div>"}if(c==4){d+='<div style="margin-bottom:10px;" class="headline">'+t_guildjob_help[4]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["4_1"]+"</div>";d+='<div style="margin-bottom:10px;">'+t_guildjob_help["4_2"]+"</div>";d+='<div style="padding:10px; border:2px solid #6C441D; border-radius:5px;">';d+='  <div style="margin-bottom:5px;" class="headline">'+t_guildjob_help["4_3"]+"</div>";var n={};n[1]={style:"background-color:coral;","class":"locked",text:t_guildjob_help["4_4"]};n[2]={style:"background-color:cornflowerblue;","class":"unlocked",text:t_guildjob_help["4_5"]};n[3]={style:"","class":"locked_plus",text:t_guildjob_help["4_6"]};n[4]={style:"background-color:white;","class":"",text:t_guildjob_help["4_7"]};for(var b=1;b<=4;b++){d+='<div style="margin-bottom:5px;">';d+='  <div style="width:50px; height:50px; border-radius:5px; float:left; margin-right:5px; '+n[b].style+'" class="'+n[b]["class"]+'"></div>';d+='  <div style="float:left; width:400px;">'+n[b].text+"</div>";d+='  <div class="clear"></div>';d+="</div>"}d+="</div>"}d+="</div>"}d+="  </div>";d+="</div>";var l="";if(h=="job"){l="hideDiv('globalbox'); hideDiv('globaltransp'); showJobOverview();"}globalBoxFlex(0,d,0,l,1);jobHelpNavi()}function jobHelpNavi(b){if(!b){b=1}for(var a=1;a<=4;a++){$("jobhelp_navi"+a).removeClassName("brown_tab_active");hideDiv("jobhelp_content"+a)}$("jobhelp_navi"+b).addClassName("brown_tab_active");showDiv("jobhelp_content"+b)}function showJobOverview(){if(currentuserlevel<guild_jobs_minlevel){return 1}closeBuildingInner();var b=t_guildjob_navi5;var a=htmlJobOverview();a+='<div id="job_overview_helpbutton" class="helpbutton_blue link" onclick="jobHelp(\'job\')"></div>';a+='<div id="job_overview_achievementbutton" class="achievementbutton link link" onclick="jobAchievements()"></div>';globalBoxFlex(b,a,0,0,1);$("globalbox").style.top="50px"}function jobTimer(){if(job_data.changeremain){job_data.changeremain--}if(job_data.tool){job_data.tool.remain--}if(job_data.boost){job_data.boost.remain--}if(job_data.guild_job_data&&job_data.guild_job_data.remain){job_data.guild_job_data.remain--}jobTimerContentUpdate()}function jobTimerContentUpdate(){if($("job_change_cooldown")){if(job_data.changeremain>0){$("job_change_cooldown").innerHTML=t_guildjob_memberjob_change_cooldown+"&nbsp;"+formatTime(job_data.changeremain);showDiv("job_change_cooldown")}else{hideDiv("job_change_cooldown")}}if($("job_change_cooldown_dialog")){var d="";if(job_data.changeremain>0){d='<div style="margin-bottom:10px;">'+t_additionalcost+job_data.config.job_change_cooldown_coins+"&nbsp;"+t_coins+"</div>";d+='<div class="bonusinfo important">'+str_replace("%TIME%",formatTime(job_data.changeremain),t_guildjob_memberjob_change_cooldown_info)+"</div>";$("job_change_cooldown_dialog").innerHTML=d;showDiv("job_change_cooldown_dialog")}else{hideDiv("job_change_cooldown_dialog")}}for(var b=1;b<=2;b++){if(b==1){var a="tool"}if(b==2){var a="boost"}if($("job_"+a+"_img")){if(job_data[a]&&job_data[a].remain>0){$("job_"+a+"_timer").innerHTML=formatTime(job_data[a].remain);var c=100-((job_data[a].remain*100)/job_data.config[a+"s"][job_data[a].pid].duration);$("job_"+a+"_bar_inner").style.width=c+"%";if(a=="tool"){$("job_tool_img").className="ftool"+job_data.tool.pid}if(a=="boost"){$("job_boost_img").className="job_boost"+job_data.boost.pid}$("job_"+a+"_name").innerHTML=job_data.config[a+"s"][job_data[a].pid].name;showDiv("job_"+a+"_run");$("job_"+a+"_tt").innerHTML=htmlJobItemTT(a,job_data[a].pid);$("job_"+a+"_img").onmouseover=new Function("showDiv('job_"+a+"_tt')");$("job_"+a+"_img").onmouseout=new Function("hideDiv('job_"+a+"_tt')");$("job_"+a+"_img").onclick=new Function("");showDiv("job_"+a+"_production")}else{hideDiv("job_"+a+"_run");$("job_"+a+"_img").className="cross";$("job_"+a+"_img").onmouseover=new Function("");$("job_"+a+"_img").onmouseout=new Function("");$("job_"+a+"_img").onclick=new Function("jobDialog('show_"+a+"s')");hideDiv("job_"+a+"_production")}}}}function toogleJobDetails(a){if($("job_overview_boni"+a).style.display=="block"){$("job_overview_details"+a).removeClassName("arrow_black_small_bottom").addClassName("arrow_black_small_top")}else{$("job_overview_details"+a).removeClassName("arrow_black_small_top").addClassName("arrow_black_small_bottom")}toogleDiv("job_overview_boni"+a)}function htmlJobLevelBoni(l,m){var e="";if(job_data.config.level_boni[l]){for(var d=1;d<=m;d++){if(job_data.config.level_boni[l][d]){for(var c=0;c<job_data.config.level_boni[l][d].length;c++){var b="";e+='<div style="margin:5px 0px;">';for(var a=0;a<job_data.config.level_boni[l][d][c].products.length;a++){e+='<div class="kp'+job_data.config.level_boni[l][d][c].products[a]+'" style="float:left; margin-right:5px;"></div>';b=produkt_name[job_data.config.level_boni[l][d][c].products[a]]}var h=str_replace("%PERCENT%",(job_data.config.level_boni[l][d][c].chance*100),t_guildjob_job_harvest_bonus);e+='  <div style="text-align:left; float:left; width:180px;">'+b+":&nbsp;"+str_replace("%BONUS%",(job_data.config.level_boni[l][d][c].harvest*100),h)+"</div>";e+='  <div class="clear"></div>';e+="</div>"}}}}return e}function htmlJobOverview(){var n="";var b="";for(jobid in job_data.config.jobs){var d=getJobLevel(jobid);var l="";l+='<div style="position:relative; margin-top:5px;">';l+='  <div style="position:relative; float:left; margin-right:5px;" class="job_jobsymbol'+jobid+' job_jobsymbol"></div>';l+='  <div style="position:relative; float:left; width:425px;">';l+='    <div style="font-weight:bold; text-align:left; margin-bottom:5px; float:left;">'+job_data.config.jobs[jobid].name+"</div>";l+='    <div id="job_overview_details'+jobid+'" class="link arrow_black_small_top" style="position:relative; float:right;" onclick="toogleJobDetails('+jobid+');"></div>';l+='    <div class="clear"></div>';l+='    <div style="margin-bottom:5px;">';for(var e=0;e<job_data.config.jobs[jobid].products.length;e++){var m=job_data.config.jobs[jobid].products[e];l+='<div class="kp'+m+'" style="position:relative; margin-right:5px; float:left;" onmouseover="showDiv(\'job_jobproduct_tt'+m+"')\" onmouseout=\"hideDiv('job_jobproduct_tt"+m+"')\">";l+='  <div id="job_jobproduct_tt'+m+'" style="left:20px;" class="ttbox">'+produkt_name[m]+"</div>";l+="</div>"}l+='      <div class="clear"></div>';l+="    </div>";l+='    <div style="float:left; font-weight:bold; font-size:20px; margin-right:5px; margin-top:-2px;">'+d.level+"</div>";l+='    <div class="guild_job_bar" style="float:left;">';l+='      <div class="guild_job_bar_inner" style="width:'+d.percent+'%;"></div>';l+='      <div class="guild_job_bar_text">'+t_level_status+":&nbsp;"+Math.round(d.percent)+"%</div>";l+="    </div>";if(job_data.currentjob!=jobid){l+='<button class="button_new link" onclick="jobDialog(\'change\', '+jobid+')">'+t_guildjob_memberjob_change+"</button>"}l+='    <div class="clear"></div>';l+='      <div style="width:320px;">'+formatNumber(d.current)+"&nbsp;/&nbsp;"+formatNumber(d.next)+"</div>";l+='  <div id="job_overview_boni'+jobid+'" class="job_overview_boni" style="margin-top:5px;">';l+='    <div style="float:left; width:200px; background-color:#C3A75E; padding:5px; margin-right:5px; border-radius:5px;">';l+='      <div style="font-weight:bold; margin-bottom:5px;">'+t_guildjob_current_boni+"</div>";l+=htmlJobLevelBoni(jobid,d.level);l+="    </div>";if(job_data.config.level[(d.level+1)]){l+='<div style="float:left; width:200px; background-color:#C3A75E; padding:5px; border-radius:5px;">';l+='  <div style="font-weight:bold; margin-bottom:5px;">'+t_guildjob_next_level+"<br>"+t_vet_reward_head+"</div>";for(var c in job_data.config.level[(d.level+1)].reward){if(c=="points"){l+="<div>"+formatNumber(job_data.config.level[(d.level+1)].reward[c])+"&nbsp;"+t_points+"</div>"}if(c=="money"){l+="<div>"+formatPrice(job_data.config.level[(d.level+1)].reward[c])+"</div>"}}l+=htmlJobLevelBoni(jobid,(d.level+1));l+="</div>"}l+='    <div class="clear"></div>';l+="  </div>";l+="  </div>";l+='  <div class="clear"></div>';l+="</div>";if(job_data.currentjob==jobid){n+=l}else{b+=l}}if(n==""){n=t_job_nojob}var l="";l+='<div style="position:relative; height:430px; overflow:auto; width:550px;">';l+='  <div style="background-color:antiquewhite; padding:15px 10px; width:510px; border-radius:5px; margin-bottom:10px;">';l+="    <div>"+t_guildjob_level_job_info+"</div>";if(player_guild>0){l+='<div class="button_new link" style="position:relative; width:200px; margin:5px auto;" onclick="initGuild()">'+t_go2guild+"</div>"}l+="  </div>";l+='  <div class="guild_job_memberlist_item_head">'+t_guildjob_memberjob_select+"</div>";l+="  <div>"+n+"</div>";l+='  <div style="position:relative; margin:10px 0; background-color:#C3A75E; border-radius:5px; padding:5px; width:520px;">';l+='    <div style="margin-bottom:10px;">'+t_guildjob_tools_and_booster_warning+"</div>";for(var e=1;e<=2;e++){var a="tool";var h=t_tool_name;if(e==2){a="boost";h=t_booster_name}l+='<div style="float:left; margin-right:5px; margin-left:20px;">'+h+"</div>";l+='<div id="job_'+a+'_img" class="cross">';l+='  <div id="job_'+a+'_tt" class="ttbox"></div>';l+="</div>";l+='<div id="job_'+a+'_info">';l+='  <div id="job_'+a+'_run">';l+='    <div id="job_'+a+'_name"></div>';l+='    <div id="job_'+a+'_bar">';l+='      <div id="job_'+a+'_bar_inner"></div>';l+='      <div id="job_'+a+'_timer" style=""></div>';l+="    </div>";l+="  </div>";l+="</div>"}l+='    <div class="clear"></div>';l+="  </div>";l+='  <div class="guild_job_memberlist_item_head">';l+='    <div style="float:left;">'+t_guildjob_memberjob_other+"</div>";l+='    <div style="float:right" id="job_change_cooldown"></div>';l+='    <div class="clear"></div>';l+="  </div>";l+="  <div>"+b+"</div>";l+="</div>";return l}function getJobLevel(l){var d={level:1,percent:0,current:0,next:0};if(job_data.jobs&&job_data.jobs[l]){var c=0;var b=parseInt(job_data.jobs[l].points);for(var m in job_data.config.level){var a=parseInt(job_data.config.level[m].points);if(b>=a){d.level=parseInt(m);if(!job_data.config.level[(parseInt(m)+1)]){d.percent=100}else{c=job_data.config.level[(parseInt(m)+1)].points;var h=(job_data.config.level[(parseInt(m)+1)].points-a);var e=(b-a);d.percent=((e*100)/h)}}}d.current=b;d.next=c}else{d.current=0;d.next=job_data.config.level[2].points}return d}function jobDialog(d,a){if(d=="change"){var n=t_guildjob_memberjob_change;var l="<div>"+str_replace("%NEW%","<b>"+job_data.config.jobs[a].name+"</b>",t_guildjob_memberjob_change_body)+"</div>";var c=formatPrice(job_data.config.job_change_cost);if(!job_data.config.jobs[job_data.currentjob]){c=forfree}l+='<div style="margin-top:10px; margin-bottom:20px;">'+cityadcost+c+"</div>";l+='<div id="job_change_cooldown_dialog" class="job_change_cooldown_dialog"></div>';l+='<div style="margin-top:10px;">'+t_guildjob_memberjob_change_body_info2+"</div>";if(job_data.config.jobs[job_data.currentjob]){l+='<div class="bonusinfo">'+str_replace("%CURRENT%","<b>"+job_data.config.jobs[job_data.currentjob].name+"</b>",t_guildjob_memberjob_change_body_info)+"</div>"}var s="guildJobChangeMemberJob("+a+")";var q="showJobOverview()";globalcommitbox(n,l,s,q)}if(d=="show_tools"){var n=t_guildjob_add_tool_head;var l='<div style="width:350px; margin:0 auto; margin-top:-5px; margin-bottom:15px;">'+t_guildjob_add_tool_info+"</div>";l+='<div style="width:615px; height:330px; overflow:auto;">';var e=job_data.config.tools;for(var a in e){var s="";var m="opacity:0.5;";var h=checkForestryRackItem(a);if(h){s="guildJobSetToolCommit("+a+")";m=""}l+='<div class="link" onclick="'+s+'" style="position:relative; float:left; background-color:#C3A75E; border-radius:5px; padding:5px; width:180px; margin:3px; height:170px; '+m+'">';l+='  <div class="f_symbol'+a+'" style="float:left; margin-right:5px;"></div>';l+='  <div style="float:left; text-align:left; width:150px;">';l+='    <div style="font-weight:bold; margin-bottom:5px;">'+produkt_name_forestry[a]+"</div>";for(var b in e[a].bonus){if(e[a].bonus.harvest){var r=str_replace("%BONUS%",(e[a].bonus.harvest*100),t_guildjob_tool_harvest);l+="<div>"+str_replace("%TIME%",formatTime(e[a].duration),r)+"</div>"}}l+='    <div style="margin-top:5px;">';for(var b=0;b<e[a].jobs.length;b++){l+='<div class="job_jobsymbol'+e[a].jobs[b]+'_mini job_jobsymbol_mini" style="position:relative; float:left; margin-right:5px;" onmouseover="showDiv(\'guildjob_showtools'+a+"_"+e[a].jobs[b]+"_tt')\" onmouseout=\"hideDiv('guildjob_showtools"+a+"_"+e[a].jobs[b]+"_tt')\">";l+='  <div id="guildjob_showtools'+a+"_"+e[a].jobs[b]+'_tt" class="ttbox" style="left:50px;">'+job_data.config.jobs[e[a].jobs[b]].name+"</div>";l+="</div>"}l+='    <div class="clear"></div>';l+="    </div>";l+="  </div>";l+='  <div class="clear"></div>';l+="</div>"}l+='<div class="clear"></div>';l+="</div>";globalBoxFlex(n,l,0,"showJobOverview()",1)}if(d=="show_boosts"){var n=t_guildjob_add_boost_head;var l='<div style="width:350px; margin:0 auto; margin-top:-5px; margin-bottom:15px;">'+t_guildjob_add_boost_info+"</div>";var e=job_data.config.boosts;for(var a in e){var s="";var m="opacity:0.5;";if($("coins").innerHTML>=e[a].coins){s="guildJobSetBoostCommit("+a+")";m=""}l+='<div style="background-color:#C3A75E; border-radius:5px; margin-bottom:5px; padding:5px; '+m+'">';l+='  <div style="position:relative; float:left;" class="job_boost'+a+'"></div>';l+='  <div style="position:relative; float:left; width:190px; text-align:left; margin:0px 10px;">';l+='    <div style="font-weight:bold;">'+e[a].name+"</div>";for(var b in e[a].bonus){if(b=="points"){var r=str_replace("%PERCENT%",((e[a].bonus[b]-1)*100),t_guildjob_boost_points);l+="<div>"+str_replace("%TIME%",formatTime(e[a].duration),r)+"</div>"}}l+="  </div>";l+='  <div style="position:relative; float:left; font-size:11px;" class="link coinsbutton_flex" onclick="'+s+'">'+str_replace("%COINS%",e[a].coins,t_guildjob_add_boost_buy)+"</div>";l+='  <div class="clear"></div>';l+="</div>"}l+='<div class="clear"></div>';globalBoxFlex(n,l,0,"showJobOverview()",1)}}function guildJobSetBoostCommit(e){var a="";a+='<div style="position:relative; float:left;" class="job_boost'+e+'"></div>';a+='<div style="float:left; margin-left:10px; text-align:left; width:150px;">';a+='  <div style="font-weight:bold;">'+job_data.config.boosts[e].name+"</div>";for(var d in job_data.config.boosts[e].bonus){if(d=="points"){var c=str_replace("%PERCENT%",((job_data.config.boosts[e].bonus[d]-1)*100),t_guildjob_boost_points);a+="<div>"+str_replace("%TIME%",formatTime(job_data.config.boosts[e].duration),c)+"</div>"}}a+="</div>";a+='<div class="clear"></div>';a+='<div style="margin-top:10px;">'+str_replace("%COINS%",job_data.config.boosts[e].coins,t_guildjob_add_boost_buy)+"</div>";if(!guild_job||!guild_job.job){a+='<div style="width:95%; background-color:#C3A75E; border-radius:5px; padding:10px; margin-top:15px;">';a+="  <div>"+t_guildjob_tools_and_booster_warning+"</div>";a+='  <div style="margin-top:10px; font-weight:bold;">'+t_guildjob_no_current_job_commit+"</div>";a+="</div>"}var b="guildJobSetBoost("+e+")";globalcommitbox(t_guildjob_add_boost_head,a,b,"showJobOverview()")}function htmlJobItem(c,d,a){var b="";b+='<div id="job_'+c+'_production" class="job_'+c+d+' job_item_slot" style="position:relative;" onmouseover="showDiv(\'job_'+c+"_production"+d+"_tt')\" onmouseout=\"hideDiv('job_"+c+"_production"+d+"_tt')\">";if(c=="tool"){b+='<div class="ftool'+d+'"></div>'}b+='  <div id="job_'+c+"_production"+d+'_tt" class="job_item_tt_'+a+' ttbox">'+htmlJobItemTT(c,d)+"</div>";b+="</div>";return b}function htmlJobItemTT(c,l){if(c=="tool"){var e=job_data.config.tools}if(c=="boost"){var e=job_data.config.boosts}var b="";b+='<div style="font-weight:bold; margin-bottom:5px;">'+e[l].name+"</div>";if(e[l].jobs){for(var a=0;a<e[l].jobs.length;a++){b+='<div style="margin-bottom:2px;">'+job_data.config.jobs[e[l].jobs[a]].name+"</div>"}}b+="<div>&nbsp;</div>";for(var a in e[l].bonus){if(a=="points"){var d=e[l].bonus[a];if(c=="boost"){d=(d-1)*100}var h=str_replace("%PERCENT%",d,t_guildjob_boost_points);b+="<div>"+str_replace("%TIME%",formatTime(e[l].duration),h)+"</div>"}if(a=="harvest"){var h=str_replace("%BONUS%",(e[l].bonus[a]*100),t_guildjob_tool_harvest);b+="<div>"+str_replace("%TIME%",formatTime(e[l].duration),h)+"</div>"}}return b}var kniffel=function(){this.data={};this.set={};this.dir={}};kniffel.prototype.action=function(c,b){var a="";if(b){for(i in b){a+="&"+i+"="+encodeURIComponent(b[i])}}showGlobalWait(c);var d=createAjaxRequestObj();d.open("GET","ajax/kniffel.php?rid="+rid+"&mode="+c+a,true);d.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");d.onreadystatechange=function(){kniffel.response(d,c,b)};d.send(null)};kniffel.prototype.response=function(b,d,c){var a=_chkRequest(b);if(a!=0){hideGlobalWait();if(a[0]==0){globalerrorbox(a[1])}else{hideDiv("globaltransp");hideDiv("globalbox");this.data=a;this.set={"1":0,"2":0,"3":0,"4":0,"5":0};setTimer("kniffel");this.init();if(d=="kniffel_roll"){this.showRollAni()}}}};kniffel.prototype.init=function(){showDiv("kniffel");if(this.data.tutorial){showDiv("kniffel_help");showDiv("kniffel_transp")}hideDiv("kniffel_today");hideDiv("kniffel_start");showDiv("kniffel_roll_button");showDiv("kniffel_current_combo");hideDiv("kniffel_playtime_end");showDiv("kniffel_playtime");$("kniffel_sum_count").innerHTML=this.data.points;this.setPrizes();if(this.data.playtime<=0){hideDiv("kniffel_dices");hideDiv("kniffel_roll_button");hideDiv("kniffel_end_button");hideDiv("kniffel_playtime");showDiv("kniffel_playtime_end");return true}if(this.data.reward){var b=t_kniffel_reward;var a="";if(this.data.reward.points){a+='<div style="float:left; margin:7px 5px 0 65px; font-size:14px; font-weight:bold;">'+this.data.reward.points+'</div><div style="float:left;" class="kniffel_ball"></div><div class="clear"></div>'}if(this.data.reward.mainprize){a+='<div style="margin-top:10px;">'+str_replace("%POINTS%",formatNumber(this.data.reward.mainprize),t_got_points)+"</div>"}globalcommitbox(b,a)}if(this.data.round==0||this.data.finished){hideDiv("kniffel_dices");hideDiv("kniffel_prize");hideDiv("kniffel_end_button");hideDiv("kniffel_current_combo");if(this.data.finished){showDiv("kniffel_today");hideDiv("kniffel_roll_button")}else{showDiv("kniffel_start")}return true}else{showDiv("kniffel_dices");showDiv("kniffel_prize")}var c={};for(var d in this.data.set){if(d>0){$("kniffel_dice_img"+d).className="kniffel_dice_img";$("kniffel_dice_img"+d).addClassName("kniffel_dice"+this.data.set[d]);hideDiv("kniffel_dice_block"+d);if(!c[this.data.set[d]]){c[this.data.set[d]]=0}c[this.data.set[d]]++}}this.checkCombos(c)};kniffel.prototype.rollCommit=function(){if(this.data.round>=this.data.config.free_rounds){var a="<div>"+str_replace("%AMOUNT%",this.data.config.round_cost,t_kniffel_roll_body)+"</div>";if(this.data.config.coin_balls>0){a+='<div class="bonusinfo" style="float:left; margin-left:30px;">'+str_replace("%BALLS%",this.data.config.coin_balls+'</div><div class="kniffel_ball_mini" style="float:left;"></div>',t_kniffel_coin_balls);a+='<div class="clear"></div>'}globalcommitbox(t_kniffel_roll_head,a,"kniffel.roll()")}else{this.roll()}};kniffel.prototype.roll=function(){var a={set:'{"1":"'+this.set[1]+'", "2":"'+this.set[2]+'", "3":"'+this.set[3]+'", "4":"'+this.set[4]+'", "5":"'+this.set[5]+'"}'};this.action("kniffel_roll",a)};kniffel.prototype.prizeCommit=function(c){var a=str_replace("%COUNT%",parseInt($("kniffel_prize_balls"+c).innerHTML),t_kniffel_prize_body);var b="kniffel.prize("+c+")";globalcommitbox(t_kniffel_prize_head,a,b)};kniffel.prototype.prize=function(a){this.action("kniffel_prize",{prize:a})};kniffel.prototype.finish=function(){this.action("kniffel_end")};kniffel.prototype.buyBalls=function(a){this.action("kniffel_buy",{coins:a})};kniffel.prototype.clickDice=function(a){if(this.set[a]==1){this.set[a]=0;hideDiv("kniffel_dice_block"+a)}else{this.set[a]=1;showDiv("kniffel_dice_block"+a)}};kniffel.prototype.move=function(){if(this.dir=="left"){this.dir="right"}else{this.dir="left"}$("kniffel_area").className="kniffel_move_"+this.dir};kniffel.prototype.checkCombos=function(d){var e=[];var h=1;for(var b in d){if(d[b]==5){e.push("kniffel")}if(d[b]==4){e.push("4er")}if(d[b]==3){e.push("3er")}if(d[b]==2){e.push("2er")}if(d[b]!=1){h=0}}if(h==1){e.push("street")}for(var c in this.data.config.combos){$("kniffel_combo_"+c).removeClassName("kniffel_combo_active")}hideDiv("kniffel_end_button");for(var c in this.data.config.combos){var a="";if(c=="fullhouse"&&in_array("3er",e)&&in_array("2er",e)){a="fullhouse"}else{if(in_array(c,e)){a=c}}if(a!=""){$("kniffel_combo_"+a).addClassName("kniffel_combo_active");$("kniffel_current_combo").innerHTML='<div style="float:left; margin-left:62px;">'+t_kniffel_current_prize+this.data.config.combos[a].points+'</div><div style="float:left; margin-left:10px; margin-top:-5px;" class="kniffel_ball"></div><div class="clear"></div>';showDiv("kniffel_end_button");break}}};kniffel.prototype.showRollAni=function(){showDiv("kniffel_roll_ani");showDiv("kniffel_transp");$("kniffel_roll_ani").src=imgpath+"em/roll_ani.gif";window.setTimeout("hideDiv('kniffel_roll_ani'); $('kniffel_roll_ani').src = ''; hideDiv('kniffel_transp');",1600)};kniffel.prototype.setPrizes=function(){for(var a=1;a<=100;a++){if($("kniffel_prize"+a)){var b=parseInt($("kniffel_prize_balls"+a).innerHTML);if(b>parseInt(this.data.points)){$("kniffel_prize_balls"+a).addClassName("important");$("kniffel_prize"+a).removeClassName("link");$("kniffel_prize"+a).onclick=new Function("")}else{$("kniffel_prize_balls"+a).removeClassName("important");$("kniffel_prize"+a).addClassName("link");$("kniffel_prize"+a).onclick=new Function("kniffel.prizeCommit("+a+")")}}if(this.data.sheeps&&this.data.sheeps[a]){hideDiv("kniffel_prize"+a)}}};kniffel.prototype.buyBallsCommit=function(){var b="";for(var a in this.data.config.coins){var c=str_replace("%COUNT%",this.data.config.coins[a],t_kniffel_buy_body);c=str_replace("%AMOUNT%",a,c);b+='<div class="coinsbutton_flex link" style="margin-bottom:10px;" onclick="kniffel.buyBallsCommitCommit('+a+')">'+c+"</div>"}globalcommitbox(t_kniffel_buy_head,b,0,0,1)};kniffel.prototype.buyBallsCommitCommit=function(a){var b="kniffel.buyBalls("+a+")";var c=str_replace("%COUNT%",this.data.config.coins[a],t_kniffel_buy_body);c=str_replace("%AMOUNT%",a,c);globalcommitbox(t_kniffel_buy_head,c,b)};kniffel.prototype.timer=function(){if(this.data.playtime>0){this.data.playtime--;$("kniffel_playtime").innerHTML=str_replace("%TIME%",formatTime(this.data.playtime),t_kniffel_playtime)}if(this.data.exchangetime>0){this.data.exchangetime--;$("kniffel_playtime_end").innerHTML=str_replace("%TIME%",formatTime(this.data.exchangetime),t_kniffel_playtime_end)}else{hideDiv("kniffel_link");this.close()}};kniffel.prototype.close=function(){hideDiv("kniffel")};var laddergame=function(){this.data={};this.currentPos=1;this.freeRolls=0;this.tutorialStep=1};laddergame.prototype.cheat=function(a){laddergame.action("laddergame_cheat",{day:a})};laddergame.prototype.clickOption=function(a){laddergame.action("laddergame_option",{name:a})};laddergame.prototype.reroll=function(){laddergame.action("laddergame_reroll")};laddergame.prototype.extraRoll=function(){laddergame.action("laddergame_extra_roll")};laddergame.prototype.confirmRoll=function(){laddergame.action("laddergame_confirm_roll")};laddergame.prototype.rollDice=function(){$("laddergame_cube").removeClassName("off");hideDiv("laddergame_bt_rollit");laddergame.action("laddergame_roll_dice")};laddergame.prototype.init=function(){laddergame.action("laddergame_init")};laddergame.prototype.action=function(a,b){ajaxAction("farm",a,b,laddergame.response)};laddergame.prototype.response=function(b,a,d){if(b.data){laddergame.data=b}var c=0;if(laddergame.data.data.daily_rolls){c=laddergame.data.data.daily_rolls}laddergame.freeRolls=(laddergame.data.config.free_rolls-c);if(in_array(a,["laddergame_roll_dice","laddergame_reroll","laddergame_extra_roll"])){$("laddergame_roller").addClassName("isbig");laddergame.rollDiceResponse(laddergame.data.rolled)}else{if(in_array(a,["laddergame_confirm_roll"])){laddergame.move()}else{if(in_array(a,["laddergame_option"])){laddergame.optionSelected()}else{laddergame.build()}}}laddergame.buildEvents();$("laddergame_free_rolls").innerHTML=Math.max(0,laddergame.freeRolls);if(laddergame.data.consolation){laddergame.showConsolation(laddergame.data.consolation)}else{if(laddergame.data.extra){laddergame.showExtraDiscount()}}};laddergame.prototype.build=function(){var b={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six"};var d="";d+='<div id="laddergame_board" class="board"></div>';d+='<div id="laddergame_roller" class="roller">';d+='  <div class="footer">';d+='    <div class="transp"></div>';d+='    <div class="timer">'+t_event_resttime+':&nbsp;<span id="laddergame_timer"></span></div>';d+='    <div class="free_rolls">'+t_laddergame_free_rolls+':&nbsp;<span id="laddergame_free_rolls"></span></div>';d+='    <div id="laddergame_slide_warning" class="slide_warning">';d+='      <div class="flexit">';d+='        <div class="icon"></div>';d+='        <div class="info">'+t_laddergame_slide_warning+"</div>";d+="      </div>";d+="    </div>";d+='    <div class="buttons">';d+='      <div id="laddergame_bt_rollit" class="bt button_new link" onclick="laddergame.rollDice()">'+t_laddergame_bt_roll+"</div>";d+='      <div id="laddergame_bt_continue" class="bt"><div id="laddergame_bt_continue_text" class="button_new link" onclick="laddergame.startMove()">'+t_laddergame_bt_move.replace("%COUNT%",this.data.data.last_roll_number)+"</div></div>";d+='      <div id="laddergame_bt_reroll" class="bt"><div class="button_new link" onclick="laddergame.rerollCommit()">'+t_laddergame_bt_reroll+"</div></div>";d+='      <div id="laddergame_bt_extra" class="bt button_new link" onclick="laddergame.extraCommit()">'+t_laddergame_bt_extra+"</div>";d+='      <div class="clear"></div>';d+="    </div>";d+='    <div id="laddergame_options" class="options"></div>';d+='    <div id="laddergame_events" class="events"></div>';d+='    <div id="laddergame_is_finished" class="finished">'+t_laddergame_finished+"</div>";d+="  </div>";d+='  <div class="cube_box">';d+='    <div id="laddergame_cube" class="cube off">';for(var c=1;c<=6;c++){d+='<div class="side side-'+c+'">';if(c==6){d+='<div class="eventfield"></div>'}else{for(var a=1;a<=c;a++){d+='<div class="dot '+b[c]+"-"+a+'"></div>'}}d+="</div>"}d+="    </div>";d+='    <div id="laddergame_cube_multiplier" class="multiplier"></div>';d+="  </div>";d+="</div>";d+='<div id="laddergame_tutorial" class="tutorial">';d+='  <div class="transp"></div>';d+='  <div id="laddergame_tutorial_char" class="char"></div>';d+='  <div id="laddergame_tutorial_bubble" class="bubble"></div>';d+="</div>";if(devserver==1){d+='<div class="cheat">';for(var c in this.data.config.layouts){d+='<div class="link" onclick="laddergame.cheat('+c+')">'+c+"</div>"}d+="</div>"}d+='<div class="helpbutton_blue link" onclick="laddergame.help();"></div>';d+='<div class="mini_close link" onclick="laddergame.close();"></div>';$("laddergame_inner").innerHTML=d;showDiv("laddergame");$("laddergame_inner").addClassName("bounce");if(this.checkFinished()==1){showDiv("laddergame_is_finished")}else{if(this.data.data.pos<(this.data.config.x*this.data.config.y)){if(this.freeRolls>0){showDiv("laddergame_bt_rollit")}else{showDiv("laddergame_bt_extra")}}}setTimer("laddergame");this.buildBoard();this.timerUpdate();if(this.data.tutorial){this.tutorial()}};laddergame.prototype.buildBoard=function(){this.currentPos=this.data.data.pos;if(this.data.data.last_roll_number&&!this.data.data.last_roll_confirmed){this.currentPos=this.data.data.last_roll_prev_pos}var c="";c+='<div class="between"></div>';c+='<div id="laddergame_dirs" class="dirs">';for(var b=1;b<=5;b++){c+='<div class="dir"></div>'}c+="</div>";for(var b=1;b<=(this.data.config.x*this.data.config.y);b++){c+='<div id="laddergame_board_tile'+b+'" class="tile pos'+b+'">';c+='  <div id="laddergame_board_tile'+b+'_back" class="back"></div>';if(devserver==1){c+='<div class="number">'+b+"</div>"}c+="</div>"}for(var b=0;b<this.data.data.game.ladders.length;b++){c+='<div class="ladder pos'+this.data.data.game.ladders[b]+'">';c+='  <div id="laddergame_ladder_'+this.data.data.game.ladders[b]+'" class="img"></div>';c+="</div>"}for(var b=0;b<this.data.data.game.slides.length;b++){var a="";if(this.slidesOff()==1){a="off"}c+='<div class="slide pos'+this.data.data.game.slides[b]+'">';c+='  <div id="laddergame_slide_'+this.data.data.game.slides[b]+'" class="img '+a+'"></div>';c+="</div>"}c+='<div id="laddergame_board_rewards"></div>';c+='<div id="laddergame_hero" class="hero pos'+Math.min((this.data.config.x*this.data.config.y),this.currentPos)+'">';c+='  <div id="laddergame_hero_img" class="img"></div>';c+="</div>";$("laddergame_board").innerHTML=c;this.buildRewards();if(this.data.data.last_roll_number&&!this.data.data.last_roll_confirmed){this.rollDiceResponse(this.data.data.last_roll_number)}this.getLadderStart(this.data.data.pos)};laddergame.prototype.buildRewards=function(){var b="";for(var d in this.data.config.rewards){var n=Math.ceil(d/this.data.config.x);var m="";if(n%2!=0&&(d%10>=7||d%10==0)){m="right"}if(n%2==0&&(d%10<=3&&d%10!=0)){m="right"}var e="";e+='<div class="head2">'+t_vet_reward_head+"</div>";e+='<div class="list">';if(this.data.config.rewards[d].products){if(this.data.data.rewards&&this.data.data.rewards[d]&&this.data.data.rewards[d].products){for(var c in this.data.data.rewards[d].products){e+='<div class="line">'+htmlProductBody(c,this.data.data.rewards[d].products[c])+"</div>"}}else{e+='<div class="product_package size'+this.data.config.rewards[d].products+'"></div>';e+="<div>"+t_reward_products+"</div>"}}if(this.data.config.rewards[d].moneypackage){if(this.data.data.rewards&&this.data.data.rewards[d]&&this.data.data.rewards[d].moneypackage){e+="<div>"+formatPrice(this.data.data.rewards[d].moneypackage)+"</div>"}else{e+='<div class="money_package size'+this.data.config.rewards[d].moneypackage+'"></div>'}}if(this.data.config.rewards[d].giftid){var a=this.data.config.rewards[d].giftid[0];if(this.data.config.gift_upgrade_count&&this.data.data.gifts[a]){if(this.data.data.gifts[a]>this.data.config.gift_upgrade_count){a=this.data.config.rewards[d].giftid[1]}}e+='<img class="giftid" src="'+imgpath+"gifts/"+a+'.gif">';e+="<div>"+t_pan_item+"</div>"}if(this.data.config.rewards[d].farmhouse){e+='<img class="farmhouse" src="'+imgpath+"farmhouse/previews/"+this.data.config.rewards[d].farmhouse+'_1.jpg">'}if(this.data.config.rewards[d].powerup){e+='<div class="powerup">'+windmillarray[this.data.config.rewards[d].powerup][5][3]+"%</div>";e+="<div>"+t_pointsboost_unit+"</div>"}if(this.data.data.rewards&&this.data.data.rewards[d]){e+='<div class="ready"></div>'}e+="</div>";for(var h in this.data.config.rewards[d]){}var l="";if(this.data.data.rewards&&this.data.data.rewards[d]){l="opened"}b+='<div class="reward pos'+d+'" onmouseover="showDiv(\'laddergame_reward_'+d+"_tt')\" onmouseout=\"hideDiv('laddergame_reward_"+d+"_tt')\">";b+='  <div id="laddergame_reward_tile'+d+'_img" class="img img_'+h+" "+l+'"></div>';b+='  <div id="laddergame_reward_'+d+'_tt" class="ttbox '+m+'">'+e+"</div>";b+="</div>"}$("laddergame_board_rewards").innerHTML=b};laddergame.prototype.buildEvents=function(){hideDiv("laddergame_events");hideDiv("laddergame_cube_multiplier");var b="";if(this.data.data.events&&this.data.data.events.length){for(var a=0;a<this.data.data.events.length;a++){if(!this.data.data.events[a].duration){continue}if(!this.data.data.last_roll_confirmed&&this.data.data.events[a].type=="multi"&&this.data.data.events[a].duration<=1){continue}var c=t_laddergame_events[this.data.data.events[a].type];c=c.replace("%DURATION%",this.data.data.events[a].duration);if(this.data.data.events[a].multi){c=c.replace("%COUNT%",this.data.data.events[a].multi)}if(this.data.data.events[a].percent){c=c.replace("%PERCENT%",Math.round(this.data.data.events[a].percent*100))}b+='<div class="event event_'+this.data.data.events[a].type+'" onmouseover="showDiv(\'laddergame_events_event'+a+"')\" onmouseout=\"hideDiv('laddergame_events_event"+a+"')\">";b+='  <div class="inner2">';if(this.data.data.events[a].multi){b+=this.data.data.events[a].multi+"x"}if(this.data.data.events[a].percent){b+=Math.round(this.data.data.events[a].percent*100)+"%"}if(this.data.data.events[a].type=="slides"){b+='<div class="slide"><div class="img"></div></div>'}b+="  </div>";b+='  <div id="laddergame_events_event'+a+'" class="ttbox">'+c+"</div>";b+="</div>"}}if(b!=""){b+='<div class="clear"></div>';$("laddergame_events").innerHTML=b;showDiv("laddergame_events")}for(var a=0;a<this.data.data.game.slides.length;a++){$("laddergame_slide_"+this.data.data.game.slides[a]).removeClassName("off");if(this.slidesOff()==1){$("laddergame_slide_"+this.data.data.game.slides[a]).addClassName("off")}}};laddergame.prototype.buildOptions=function(){hideDiv("laddergame_options");if(!this.data.data.last_roll_confirmed&&this.data.data.options&&this.data.data.options.length>0){var b="";for(var a=0;a<this.data.data.options.length;a++){var d=t_laddergame_events_name[this.data.data.options[a]];var c=t_laddergame_events[this.data.data.options[a]];if(this.data.config.options[this.data.data.options[a]].multi){d=d.replace("%COUNT%",this.data.config.options[this.data.data.options[a]].multi);c=c.replace("%COUNT%",this.data.config.options[this.data.data.options[a]].multi)}if(this.data.config.options[this.data.data.options[a]].duration){d=d.replace("%DURATION%",this.data.config.options[this.data.data.options[a]].duration);c=c.replace("%DURATION%",this.data.config.options[this.data.data.options[a]].duration)}b+='<div class="button_new link" onclick="laddergame.clickOptionCommit(\''+this.data.data.options[a]+"')\" onmouseover=\"showDiv('laddergame_options_option"+a+"_tt')\" onmouseout=\"hideDiv('laddergame_options_option"+a+"_tt')\">";b+="  <div>"+d+"</div>";b+='  <div id="laddergame_options_option'+a+'_tt" class="ttbox">'+c+"</div>";b+="</div>"}$("laddergame_options").innerHTML=b;showDiv("laddergame_options")}};laddergame.prototype.clickOptionCommit=function(a){var c=t_laddergame_events_name[a];var e=t_laddergame_events[a];if(this.data.config.options[a].multi){c=c.replace("%COUNT%",this.data.config.options[a].multi);e=e.replace("%COUNT%",this.data.config.options[a].multi)}if(this.data.config.options[a].duration){c=c.replace("%DURATION%",this.data.config.options[a].duration);e=e.replace("%DURATION%",this.data.config.options[a].duration)}var b='<div id="laddergame_commit">';b+="  <div>"+t_laddergame_events_commit.replace("%OPTION%","<div class='option'>"+e+"</div>")+"</div>";b+='  <div class="warning">'+t_laddergame_events_info+"</div>";b+="</div>";var d="laddergame.clickOption('"+a+"')";globalcommitbox(c,b,d)};laddergame.prototype.checkFinished=function(){if(!this.data.data.rewards){return 0}for(var a in this.data.config.rewards){if(!this.data.data.rewards[a]){return 0}}return 1};laddergame.prototype.rollDiceResponse=function(b){hideDiv("laddergame_bt_rollit");hideDiv("laddergame_bt_extra");for(var a=1;a<=6;a++){this.rollDiceStart(a)}this.rollDiceStart(b,1);setTimeout(function(){laddergame.showDice()},500)};laddergame.prototype.rollDiceStart=function(a){var b=laddergame.findMulti();if(b>1){a=(a/b)}$("laddergame_cube").className="cube show-"+a};laddergame.prototype.showDice=function(){hideDiv("laddergame_slide_warning");var c=1;var h=(this.currentPos+1);var e=(this.currentPos+this.data.data.last_roll_number);var b=0;for(var a=h;a<=e;a++){this.markTile(a,c);c++}if(in_array(e,this.data.data.game.ladders)||in_array(e,this.data.data.game.slides)){setTimeout(function(){if($("laddergame_board_tile"+laddergame.data.data.pos+"_back")){$("laddergame_board_tile"+laddergame.data.data.pos+"_back").addClassName("mark")}},(c*150))}setTimeout(function(){$("laddergame_roller").removeClassName("isbig");showDiv("laddergame_bt_continue");$("laddergame_bt_continue_text").innerHTML=t_laddergame_bt_move.replace("%COUNT%",laddergame.data.data.last_roll_number);showDiv("laddergame_bt_reroll");laddergame.buildOptions()},((c+1)*150));if(in_array(e,this.data.data.game.slides)&&!this.slidesOff()){showDiv("laddergame_slide_warning")}hideDiv("laddergame_cube_multiplier");var d=this.findMulti();if(d>1){showDiv("laddergame_cube_multiplier");$("laddergame_cube_multiplier").innerHTML=d+"x"}};laddergame.prototype.markTile=function(b,a){setTimeout(function(){if($("laddergame_board_tile"+b+"_back")){$("laddergame_board_tile"+b+"_back").addClassName("mark")}},(a*150))};laddergame.prototype.startMove=function(){this.confirmRoll()};laddergame.prototype.extraCommit=function(){var a=this.data.config.extra_coins;var h=0;if(this.data.data.daily_rolls){h=(this.data.config.free_rolls-this.data.data.daily_rolls)}if(h>0){return 0}if(this.data.config.extra_coins_multi>0){h=(h*-1);for($i=1;$i<=h;$i++){a=(a*2)}}var e="";if(this.data.data.events&&this.data.data.events.length){for(var d=0;d<this.data.data.events.length;d++){if(this.data.data.events[d].type!="extra"){continue}a=Math.ceil(a*this.data.config.extra_discount);e="bonus";break}}var b="";if(parseInt(user_coins)<parseInt(a)){b="important"}var c='<div id="laddergame_commit">';c+="  <div>"+t_laddergame_extra_desc.replace("%COST%",'<span class="'+e+" "+b+'" style="font-weight:bold;">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";if(e!=""){c+='<div class="bonus bonus2">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(this.data.config.extra_discount*100))+")</div>"}c+="</div>";var l="laddergame.extraMove()";if(b!=""){var l="main.notEnoughCoinsCommit()"}globalcommitbox(t_laddergame_extra_head,c,l)};laddergame.prototype.extraMove=function(){hideDiv("laddergame_bt_extra");this.extraRoll()};laddergame.prototype.rerollCommit=function(){var a=this.data.config.reroll_coins;var e=0;if(this.data.data.reroll_count){e=this.data.data.reroll_count}if(this.data.config.reroll_coins_multi>0){for($i=1;$i<=e;$i++){a=(a*2)}}var b="";if(user_coins<a){b="important"}var c='<div id="laddergame_commit">';c+="  <div>"+t_laddergame_reroll_desc.replace("%COST%",'<span class="'+b+'" style="font-weight:bold;">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";c+="</div>";var d="laddergame.rerollMove()";if(b!=""){var d="main.notEnoughCoinsCommit()"}globalcommitbox(t_laddergame_reroll_head,c,d)};laddergame.prototype.rerollMove=function(){hideDiv("globalbox");hideDiv("globaltransp");hideDiv("laddergame_bt_reroll");hideDiv("laddergame_bt_continue");hideDiv("laddergame_options");hideDiv("laddergame_cube_multiplier");$("laddergame_cube").addClassName("off");hideDiv("laddergame_slide_warning");for(var a=1;a<(this.data.config.x*this.data.config.y);a++){if($("laddergame_board_tile"+a+"_back")){$("laddergame_board_tile"+a+"_back").removeClassName("mark")}}setTimeout(function(){$("laddergame_cube").removeClassName("off");laddergame.reroll()},500)};laddergame.prototype.move=function(){hideDiv("laddergame_bt_continue");hideDiv("laddergame_bt_reroll");hideDiv("laddergame_slide_warning");hideDiv("laddergame_options");hideDiv("laddergame_cube_multiplier");$("laddergame_cube").addClassName("off");var d=(this.data.data.pos-this.currentPos);if(this.data.data.pos>(this.data.config.x*this.data.config.y)){d=d-(this.data.data.pos-(this.data.config.x*this.data.config.y))}if(d>this.data.data.last_roll_number){d=this.data.data.last_roll_number}if(!this.slidesOff(1)&&in_array((this.data.data.last_roll_prev_pos+this.data.data.last_roll_number),this.data.data.game.slides)){d=(this.getSlideStart(this.data.data.pos)-this.currentPos)}$("laddergame_hero_img").addClassName("run");var c=500;for(var b=1;b<=d;b++){setTimeout(function(){laddergame.moveForward()},c);c+=600}setTimeout(function(){$("laddergame_hero_img").removeClassName("run")},c);var a=(500+(d*600));setTimeout(function(){if(in_array(laddergame.currentPos,laddergame.data.data.game.ladders)){laddergame.moveUp()}if(in_array(laddergame.currentPos,laddergame.data.data.game.slides)){laddergame.moveDown()}},a);setTimeout(function(){laddergame.buildRewards()},(c+a+1000))};laddergame.prototype.optionSelected=function(){hideDiv("laddergame_bt_continue");hideDiv("laddergame_bt_reroll");hideDiv("laddergame_slide_warning");hideDiv("laddergame_options");$("laddergame_cube").addClassName("off");for(var a=1;a<=(this.data.config.x*this.data.config.y);a++){$("laddergame_board_tile"+a+"_back").removeClassName("mark")}if(this.freeRolls>0){showDiv("laddergame_bt_rollit")}else{if(this.checkFinished()==1){showDiv("laddergame_is_finished")}else{showDiv("laddergame_bt_extra")}}};laddergame.prototype.moveForward=function(){this.currentPos++;$("laddergame_hero").className="hero pos"+this.currentPos;$("laddergame_board_tile"+(this.currentPos-1)+"_back").removeClassName("mark");if(this.currentPos==this.data.data.pos||this.currentPos==(this.data.config.x*this.data.config.y)){this.finishMove()}this.checkRewardTile(this.currentPos)};laddergame.prototype.checkRewardTile=function(b){for(var a in this.data.config.rewards){if(parseInt(this.currentPos)>=parseInt(a)){this.openRewardTile(a)}}};laddergame.prototype.openRewardTile=function(a){setTimeout(function(){if(!$("laddergame_reward_tile"+a+"_img").hasClassName("opened")){for(var d in laddergame.data.config.rewards[a]){}if(d=="moneypackage"){d="money_package size"+laddergame.data.config.rewards[a][d]}if(d=="products"){d="product_package size"+laddergame.data.config.rewards[a][d]}$("laddergame_reward_tile"+a+"_img").addClassName("opened");if(d=="giftid"){var b=laddergame.data.config.rewards[a].giftid[0];if(laddergame.data.config.gift_upgrade_count&&laddergame.data.data.gifts[b]){if(laddergame.data.data.gifts[b]>laddergame.data.config.gift_upgrade_count){b=laddergame.data.config.rewards[a].giftid[1]}}var c='<img class="flyer giftid" src="'+imgpath+"gifts/"+b+'.gif">'}else{var c='<div class="flyer '+d+'"></div>'}$("laddergame_reward_tile"+a+"_img").innerHTML=c}},300)};laddergame.prototype.moveUp=function(){this.currentPos=this.data.data.pos;$("laddergame_hero").className="hero pos"+this.currentPos;$("laddergame_board_tile"+this.getLadderStart(this.currentPos)+"_back").removeClassName("mark");this.finishMove()};laddergame.prototype.moveDown=function(){if(this.slidesOff(1)){return 1}this.currentPos=this.data.data.pos;$("laddergame_hero").className="hero pos"+this.currentPos;$("laddergame_board_tile"+this.getSlideStart(this.currentPos)+"_back").removeClassName("mark");this.finishMove()};laddergame.prototype.getLadderStart=function(c){var a=Math.floor((c-1)/this.data.config.x)+1;var b=(((a-1)*this.data.config.x)-(c-1)%this.data.config.x);return b};laddergame.prototype.getSlideStart=function(c){var a=Math.floor((c-1)/this.data.config.x)+1;var b=(((a+1)*this.data.config.x)-(c-1)%this.data.config.x);return b};laddergame.prototype.finishMove=function(){setTimeout(function(){if(laddergame.currentPos<(laddergame.data.config.x*laddergame.data.config.y)){if(laddergame.freeRolls>0){showDiv("laddergame_bt_rollit")}else{if(laddergame.checkFinished()==1){showDiv("laddergame_is_finished")}else{showDiv("laddergame_bt_extra")}}}$("laddergame_board_tile"+laddergame.currentPos+"_back").removeClassName("mark");laddergame.checkRewardTile(laddergame.currentPos)},500)};laddergame.prototype.findMulti=function(){if(laddergame.data.data.events&&laddergame.data.data.events){for(var a=0;a<laddergame.data.data.events.length;a++){if(!laddergame.data.data.events[a].multi||!laddergame.data.data.events[a].duration){continue}return laddergame.data.data.events[a].multi}}return 0};laddergame.prototype.slidesOff=function(a){if(laddergame.data.data.events&&laddergame.data.data.events){if(a==1&&laddergame.data.data.slides_ignore){return 1}for(var b=0;b<laddergame.data.data.events.length;b++){if(laddergame.data.data.events[b].type=="slides"&&laddergame.data.data.events[b].duration>=1){return 1}}}return 0};laddergame.prototype.showExtraDiscount=function(){var a='<div id="laddergame_commit">';a+='  <div style="margin-bottom:5px;">'+t_laddergame_consolation_desc+"</div>";a+='  <div style="font-weight:bold;">'+t_laddergame_events.extra.replace("%PERCENT%",Math.round(this.data.config.extra_discount*100))+"</div>";a+="</div>";var b="hideDiv('globaltransp'); hideDiv('globalbox')";globalcommitbox(t_laddergame_consolation_head,a,b,b);hideDiv("globalbox_button2")};laddergame.prototype.showConsolation=function(d){var b='<div id="laddergame_commit">';b+='  <div style="margin-bottom:5px;">'+t_laddergame_consolation_desc+"</div>";for(var a in d){b+='<div style="display:flex; justify-content:center;">'+htmlProductBody(a,d[a])+"</div>"}b+="</div>";var c=0;if(this.data.extra){c="laddergame.showExtraDiscount()"}globalcommitbox(t_laddergame_consolation_head,b,c,c);hideDiv("globalbox_button2")};laddergame.prototype.timer=function(){this.data.data.remain--;this.timerUpdate()};laddergame.prototype.timerUpdate=function(){if($("laddergame_timer")){$("laddergame_timer").innerHTML=formatTime(this.data.data.remain);if(this.data.data.remain<=0&&$("laddergame").style.display=="block"){this.close()}}};laddergame.prototype.tutorial=function(){$("laddergame_dirs").removeClassName("highlight");for(var b=0;b<this.data.data.game.ladders.length;b++){$("laddergame_ladder_"+this.data.data.game.ladders[b]).removeClassName("highlight").removeClassName("pulse")}for(var b=0;b<this.data.data.game.slides.length;b++){$("laddergame_slide_"+this.data.data.game.slides[b]).removeClassName("highlight").removeClassName("pulse")}for(var d in this.data.config.rewards){$("laddergame_reward_tile"+d+"_img").removeClassName("highlight").removeClassName("pulse")}if(!t_laddergame_tutorial_text[this.tutorialStep]){this.closeTutorial();return 1}showDiv("laddergame_tutorial");var c=t_continue;if(!t_laddergame_tutorial_text[(this.tutorialStep+1)]){c=t_vineyard_tutorial_text_finish}var a=t_laddergame_tutorial_text[this.tutorialStep].replace("%NAME%","<b>"+username+"</b>");a+='<div class="footer">';a+='  <button class="button_new link" onclick="laddergame.nextTutorialStep()">'+c+"</button>";a+="</div>";if(this.tutorialStep==2){$("laddergame_dirs").addClassName("highlight");for(var b=1;b<=(this.data.config.x*this.data.config.y);b++){this.tutorialMarkTile(b)}}if(this.tutorialStep==3){for(var b=0;b<this.data.data.game.ladders.length;b++){$("laddergame_ladder_"+this.data.data.game.ladders[b]).addClassName("highlight").addClassName("pulse")}setTimeout(function(){for(var e=0;e<laddergame.data.data.game.ladders.length;e++){if($("laddergame_ladder_"+laddergame.data.data.game.ladders[e])){$("laddergame_ladder_"+laddergame.data.data.game.ladders[e]).removeClassName("pulse")}}},1000)}if(this.tutorialStep==4){for(var b=0;b<this.data.data.game.slides.length;b++){$("laddergame_slide_"+this.data.data.game.slides[b]).addClassName("highlight").addClassName("pulse")}setTimeout(function(){for(var e=0;e<laddergame.data.data.game.slides.length;e++){if($("laddergame_slide_"+laddergame.data.data.game.slides[e])){$("laddergame_slide_"+laddergame.data.data.game.slides[e]).removeClassName("pulse")}}},1000)}if(this.tutorialStep==5){for(var d in this.data.config.rewards){$("laddergame_reward_tile"+d+"_img").addClassName("highlight").addClassName("pulse")}setTimeout(function(){for(var e in laddergame.data.config.rewards){if($("laddergame_reward_tile"+e+"_img")){$("laddergame_reward_tile"+e+"_img").removeClassName("pulse")}}},1000)}$("laddergame_tutorial_bubble").innerHTML=a};laddergame.prototype.tutorialMarkTile=function(a,b){setTimeout(function(){if($("laddergame_board_tile"+a)){$("laddergame_board_tile"+a).addClassName("highlight");laddergame.tutorialUnmarkTile(a)}},(a*50))};laddergame.prototype.tutorialUnmarkTile=function(a){setTimeout(function(){if($("laddergame_board_tile"+a)){$("laddergame_board_tile"+a).removeClassName("highlight")}},25)};laddergame.prototype.nextTutorialStep=function(){this.tutorialStep++;this.tutorial()};laddergame.prototype.closeTutorial=function(){hideDiv("laddergame_tutorial")};laddergame.prototype.help=function(){showDiv("laddergame_help")};laddergame.prototype.close=function(){hideDiv("laddergame_help");hideDiv("laddergame")};var loginbonus=function(){this.data={};this.currentDay=0;this.selectedProduct=0};loginbonus.prototype.getReward=function(){if(this.currentDay==7){if(!this.selectedProduct){return 1}this.action("loginbonus_setplant",{pid:this.selectedProduct})}else{this.action("loginbonus_getreward",{day:this.currentDay})}};loginbonus.prototype.action=function(a,b){ajaxAction("farm",a,b,loginbonus.response)};loginbonus.prototype.response=function(b,a,c){loginbonus.build()};loginbonus.prototype.build=function(){hideDiv("globaltransp");hideDiv("globalbox");for(var d in this.data.config.rewards){if(this.data.data.rewards&&this.data.data.rewards[d]&&d<=this.data.data.count){if(!this.data.data.rewards[d].done){showDiv("loginbonus_reward_slot"+d+"_new")}else{hideDiv("loginbonus_reward_slot"+d+"_new");showDiv("loginbonus_reward_slot"+d+"_ready")}}if(d==this.data.data.count){$("loginbonus_reward_slot"+d).addClassName("current")}if(d>this.data.data.count){$("loginbonus_reward_slot"+d).addClassName("next")}if(d==this.currentDay){$("loginbonus_reward_slot"+d).addClassName("selected")}else{$("loginbonus_reward_slot"+d).removeClassName("selected")}var c="<div>";if(this.data.data.rewards&&this.data.data.rewards[d]&&d<7){if(this.data.data.rewards[d].done&&this.data.data.rewards[d].done>0){c+='<div class="intro">'+t_specialoffer_message+"</div>";if(this.data.data.rewards[d].products){for(var a in this.data.data.rewards[d].products){c+=htmlProductBody(a,this.data.data.rewards[d].products[a])}}if(this.data.data.rewards[d].money){c+=formatPrice(this.data.data.rewards[d].money)}}else{c+="<div>"+t_loginbonus_reward_waiting+"</div>"}}else{c=t_loginbonus_reward_plant;if(this.data.config.rewards[d].type=="money"){c=t_loginbonus_reward_money}if(this.data.config.rewards[d].type=="products"){c=t_reward_products}}c+="</div>";$("loginbonus_reward_slot"+d+"_tt").innerHTML=c;if(d==7&&d==this.currentDay){hideDiv("loginbonus_reward_slot"+d+"_number");if(this.data.data.rewards&&this.data.data.rewards[7]&&this.data.data.rewards[7].done&&this.data.data.rewards[7].done>0){var c='<div class="intro">'+t_loginbonus_selected_product+"</div>";c+='<div class="line3">';c+='  <div class="plant kp'+this.data.data.rewards[7].pid+'"></div>';c+='  <div class="name">'+produkt_name[this.data.data.rewards[7].pid]+"</div>";c+='  <div class="clear"></div>';c+="</div>"}else{var h=1;if(this.selectedProduct>0){h=this.selectedProduct}var e=t_loginbonus_select.replace("%DURATION%",formatTime(this.data.config.bonus_duration));var c='<div class="intro">'+e.replace("%PERCENT%",Math.round(this.data.config.bonus*100))+"</div>";c+='<div class="select" id="loginbonus_select" onclick="loginbonus.expand()">';c+='  <div class="line">';c+='    <div class="plant kp'+h+'"></div>';c+='    <div class="name">'+produkt_name[h]+"</div>";c+='    <div class="clear"></div>';c+="  </div>";c+='  <div class="selector" id="loginbonus_selector">';c+="  </div>";c+='  <div class="clear"></div>';c+='  <div class="selectbox" id="loginbonus_selectbox">';for(var b in this.data.products){if(!produkt_name[this.data.products[b]]){continue}c+='<div class="line2" onclick="loginbonus.selectProduct('+this.data.products[b]+')">';c+='  <div class="plant kp'+this.data.products[b]+'"></div>';c+='  <div style="name">'+produkt_name[this.data.products[b]]+"</div>";c+='  <div class="clear"></div>';c+="</div>"}c+="  </div>";c+="</div>"}$("loginbonus_reward_slot"+d+"_content").innerHTML=c}}hideDiv("loginbonus_bonus");if(this.data.data.bonus&&this.data.data.bonus.pid&&this.data.data.bonus.remain>0){var c='<div class="headline intro">'+t_loginbonus_bonus_intro.replace("%PERCENT%",Math.round(this.data.config.bonus*100))+"</div>";c+='<div class="line4">';c+='  <div class="plant tt'+this.data.data.bonus.pid+'"></div>';c+='  <div class="name">'+produkt_name[this.data.data.bonus.pid]+"</div>";c+='  <div class="clear"></div>';c+="</div>";c+="<div>"+t_loginbonus_bonus_resttime+' <span class="timer" id="loginbonus_bonus_timer"></span></div>';$("loginbonus_bonus").innerHTML=c;showDiv("loginbonus_bonus")}hideDiv("loginbonus_button");if(this.data.data.rewards&&this.data.data.rewards[this.currentDay]&&!this.data.data.rewards[this.currentDay].done){showDiv("loginbonus_button")}showDiv("loginbonus_transp");showDiv("loginbonus");if($("loginbonus_select")){$("loginbonus_select").observe("click",function(l){l.preventDefault();l.stopPropagation();return 1})}};loginbonus.prototype.selectProduct=function(a){this.selectedProduct=a;this.build();this.expand()};loginbonus.prototype.expand=function(){this.currentDay=7;for(var a in this.data.config.rewards){if(a==this.data.data.count){$("loginbonus_reward_slot"+a).addClassName("current")}else{$("loginbonus_reward_slot"+a).removeClassName("current")}}if($("loginbonus_selectbox").style.display=="block"){hideDiv("loginbonus_selectbox");$("loginbonus_selector").style.backgroundImage="url("+imgpath+"market/sel_open.gif)"}else{showDiv("loginbonus_selectbox");$("loginbonus_selector").style.backgroundImage="url("+imgpath+"market/sel_close.gif)"}};loginbonus.prototype.clickSlot=function(a){if(a>this.data.data.count){return 1}if(this.data.data.rewards&&this.data.data.rewards[a]&&this.data.data.rewards[a].done&&this.data.data.rewards[a].done>0){return 1}this.currentDay=a;this.build()};loginbonus.prototype.timer=function(){if(this.data.data.bonus&&this.data.data.bonus.pid&&this.data.data.bonus.remain>0&&$("loginbonus_bonus_timer")){this.data.data.bonus.remain--;$("loginbonus_bonus_timer").innerHTML=formatTime(this.data.data.bonus.remain)}};loginbonus.prototype.help=function(){var b='<div id="loginbonus_help">'+t_loginbonus_help.replace("%PERCENT%",Math.round(this.data.config.bonus*100))+"</div>";var a="loginbonus.build()";globalcommitbox(t_loginbonus,b,0,a,1)};loginbonus.prototype.close=function(){hideDiv("loginbonus_transp");hideDiv("loginbonus")};var loginevent=function(){this.data={};this.click=0};loginevent.prototype.init=function(){loginevent.action("loginevent_init")};loginevent.prototype.setbonus=function(){loginevent.action("loginevent_setbonus",{pid:$("loginevent_select").value})};loginevent.prototype.getday=function(){loginevent.action("loginevent_getday")};loginevent.prototype.action=function(a,b){ajaxAction("farm",a,b,loginevent.response)};loginevent.prototype.response=function(b,a,c){if(b){loginevent.data=b;loginevent.build();if(a=="loginevent_init"){setTimer("loginevent")}if(loginevent.data.reward){loginevent.reward(loginevent.data.reward)}}};loginevent.prototype.build=function(){showDiv("loginevent_transp");showDiv("loginevent");hideDiv("loginevent_daily_button");for(var a in this.data.config.rewards){if(this.data.data.rewards&&this.data.data.rewards[a]){showDiv("loginevent_reward_slot"+a+"_ready");if(this.data.data.rewards[a].reward){$("loginevent_reward_slot"+a+"_tt").innerHTML=this.htmlReward(a)}$("loginevent_reward_slot"+a).removeClassName("off");$("loginevent_reward_slot"+a+"_icon").removeClassName("off")}else{var b="";if(this.data.config.rewards[a].money){b+="<div>"+gamecurrency+"</div>"}if(this.data.config.rewards[a].products){b+="<div>"+t_reward_products+"</div>"}if(this.data.config.rewards[a].powerup){b+="<div>"+t_pointsboost_unit+"<br>"+t_pointsboost.replace("%PERCENT%",this.data.config.rewards[a].percent)+"</div>"}if(this.data.config.rewards[a].giftid){b+="<div>"+t_pan_item+"</div>"}if(this.data.config.rewards[a].eventbonus){b+="<div>"+t_reward_eventbonus+"</div>"}$("loginevent_reward_slot"+a+"_tt").innerHTML=b;$("loginevent_reward_slot"+a).addClassName("off");$("loginevent_reward_slot"+a+"_icon").addClassName("off")}$("loginevent_reward_slot"+a).removeClassName("today");if(this.data.today==parseInt(a)){$("loginevent_reward_slot"+a).removeClassName("off").addClassName("today");$("loginevent_reward_slot"+a+"_icon").removeClassName("off");if(this.data.data.rewards&&this.data.data.rewards[a]){}else{showDiv("loginevent_daily_button")}}}hideDiv("loginevent_select_intro2");hideDiv("loginevent_select_bonus");hideDiv("loginevent_selected_bonus");$("loginevent_timer_pre").innerHTML=t_loginevent_timer_pre_login;if(this.data.data.success){if(this.data.data.bonus){$("loginevent_timer_pre").innerHTML=t_loginevent_timer_pre_bonus;$("loginevent_selected_bonus_pid").addClassName("tt"+this.data.data.bonus.pid);$("loginevent_selected_bonus_name").innerHTML=produkt_name[this.data.data.bonus.pid];showDiv("loginevent_selected_bonus")}else{$("loginevent_timer_pre").innerHTML=t_loginevent_timer_pre_select;showDiv("loginevent_select_bonus")}}else{showDiv("loginevent_select_intro2")}};loginevent.prototype.reward=function(a){html='<div id="loginevent_reward">';html+=this.htmlReward(a);html+="  <div class=\"button_yes link\" onclick=\"hideDiv('globaltransp'); hideDiv('globalbox')\"></div>";html+="</div>";globalcommitbox(t_vet_reward_head,html,0,0,1)};loginevent.prototype.htmlReward=function(b){var c="<div>"+t_specialoffer_message+"</div>";c+='<div class="price">';if(this.data.data.rewards[b].reward.money){c+="<div>"+formatPrice(this.data.data.rewards[b].reward.money)+"</div>"}if(this.data.data.rewards[b].reward.products){for(var a in this.data.data.rewards[b].reward.products){c+=htmlProductBody(a,this.data.data.rewards[b].reward.products[a])}}if(this.data.data.rewards[b].reward.powerup){c+=t_payment_pointsboost_info2.replace("%PERCENT%",windmillarray[this.data.data.rewards[b].reward.powerup][5][3])}if(this.data.data.rewards[b].reward.giftid){c+='<img src="'+imgpath+"gifts/"+this.data.data.rewards[b].reward.giftid+'.gif">'}c+="</div>";return c};loginevent.prototype.clickIt=function(){this.click++;if(this.click%5==0){$("loginevent_eyes").src=imgpath+"Dormouse_BG_01_Ani.gif"}};loginevent.prototype.timer=function(){this.data.data.remain--;if($("loginevent_timer")){$("loginevent_timer").innerHTML=formatTime(this.data.data.remain)}if(this.data.data.remain<0){clearTimer("loginevent");hideDiv("loginevent_link");this.close()}};loginevent.prototype.close=function(){hideDiv("loginevent_transp");hideDiv("loginevent")};var lottery=function(){this.data={};this.value=0;this.currentNumber=1;this.spinStop=0};lottery.prototype.keepLot=function(a){this.action("lottery_keep_lot")};lottery.prototype.getProductPackage=function(a){this.action("lottery_get_productpackage")};lottery.prototype.exchange=function(a){this.action("lottery_exchange",{prize:a})};lottery.prototype.spin=function(){$("lottery_inner").addClassName("disable");this.action("lottery_spin")};lottery.prototype.init=function(){this.action("lottery_init")};lottery.prototype.action=function(a,b){ajaxAction("farm",a,b,lottery.response)};lottery.prototype.response=function(c,b,d){lottery.data=c;if(b=="lottery_spin"){lottery.currentNumber=c.number;lottery.spinWheel()}else{setTimer("lottery");lottery.build();lottery.waiting();if(b=="lottery_keep_lot"){lottery.spinWheel()}}if(b=="lottery_exchange"){lottery.showPrizes();lottery.showReward()}if(lottery.data.products){html='<div id="lottery_commit">';html+='  <div style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";for(var a in lottery.data.products){html+='<div class="line">';html+='  <div class="kp'+a+'"></div>';html+='  <div class="amount">'+lottery.data.products[a]+"x "+produkt_name[a]+"</div>";html+="</div>"}html+="</div>";globalcommitbox("",html,0,0,1)}};lottery.prototype.waiting=function(){if(lottery.data.data.waiting){html='<div id="lottery_commit">';html+='  <div class="waiting lot lot'+this.data.config.slots[lottery.data.data.waiting].lot+'"></div>';html+="  <div>"+t_lottery_choice_desc+"</div>";html+='  <div class="buttons">';html+='    <div class="button_new link" onclick="lottery.keepLot()">'+t_lottery_choice_button1+"</div>";html+='    <div class="button_new link" onclick="lottery.getProductPackage()">'+t_lottery_choice_button2+"</div>";html+="  </div>";html+="</div>";var a="lottery.close(); hideDiv('globaltransp'); hideDiv('globalbox')";globalcommitbox(t_lottery_choice_head,html,0,a,1)}};lottery.prototype.build=function(){var b="";b+='<div id="lottery_wheel" class="wheelbox">';b+='  <div class="spin"></div>';b+='  <div id="lottery_wheel_wheel" class="wheel">';for(var a in this.data.config.slots){b+='<div class="number" style="--i:'+a+';">';b+="  <span>"+a+"</span>";if(this.data.config.slots[a].lot){b+='<div class="img lot'+this.data.config.slots[a].lot+'"></div>'}b+="</div>"}b+="  </div>";b+="</div>";var c=t_lottery_spin_button;if(this.data.today){c=t_lottery_spin_extra_head}b+='<div class="buttons">';b+='  <div id="lottery_wheel_button" class="button_new link spinButton" onclick="lottery.clickSpinCommit()">'+c+"</div>";b+="</div>";b+='<div id="lottery_lots" class="lots"></div>';b+='<div id="lottery_prizes" class="prizes"></div>';b+='<div class="prizes_link link" onclick="lottery.showPrizes();" onmouseover="showDiv(\'lottery_prizes_link_tt\')" onmouseout="hideDiv(\'lottery_prizes_link_tt\')">';b+='  <div id="lottery_prizes_link_tt" class="ttbox">'+t_lottery_shop_name+"</div>";b+="</div>";b+='<div class="info_link" onmouseover="showDiv(\'lottery_info_link_tt\')" onmouseout="hideDiv(\'lottery_info_link_tt\')">';b+='  <div id="lottery_info_link_tt" class="ttbox">';b+='    <div class="name">'+t_lottery_name+"</div>";b+="    <ul>";b+="      <li>"+t_lottery_info_text1+"</li>";b+="      <li>"+t_lottery_info_text2+"</li>";b+="      <li>"+t_lottery_info_text3+"</li>";b+="      <li>"+t_lottery_info_text4+"</li>";b+="    </ul>";b+="  </div>";b+="</div>";b+='<div class="mini_close link" onclick="lottery.close();"></div>';$("lottery_inner").innerHTML=b;showDiv("lottery");$("lottery_inner").addClassName("bounce");this.buildLots();this.buildPrizes()};lottery.prototype.buildLots=function(){var c="";for(var b in this.data.config.lots){var a=0;if(this.data.data.lots&&this.data.data.lots[b]){a=this.data.data.lots[b]}c+='<div id="lottery_lots_lot'+b+'" class="lot lot'+b+'">';c+='  <div class="amount">'+a+"</div>";c+="</div>"}$("lottery_lots").innerHTML=c};lottery.prototype.clickSpinCommit=function(){if(this.data.today){var a=parseInt(this.data.config.add_spin_coins);if(this.data.config.multi_spin_coins==1){var d=1;if(this.data.data.today_spin){d=this.data.data.today_spin}a=Math.pow(a,d)}var b='<div id="lottery_commit">';b+="  <div>"+t_lottery_spin_extra_desc.replace("%COST%","<b>"+a+"&nbsp;"+t_coins+"</b>")+"</div>";b+="</div>";var c="lottery.clickSpin()";globalcommitbox(t_lottery_spin_extra_head,b,c)}else{this.clickSpin()}};lottery.prototype.clickSpin=function(){if(this.spinStop==1){return 1}$("lottery_wheel_button").addClassName("off");this.spinStop=1;this.resetWheel();this.spin()};lottery.prototype.spinWheel=function(){for(var a in this.data.config.slots){}var b=(360/a);this.value=((b*(this.currentNumber-1))*-1)+3600;$("lottery_wheel_wheel").addClassName("start");$("lottery_wheel_wheel").style.transform="rotate("+this.value+"deg)";setTimeout(function(){lottery.spinStop=0;if($("lottery_wheel_button")){$("lottery_wheel_button").removeClassName("off")}if(!lottery.data.data.waiting){lottery.showNumber()}$("lottery_inner").removeClassName("disable");lottery.waiting()},5000)};lottery.prototype.resetWheel=function(){for(var a in this.data.config.slots){}var b=(360/a);this.value=this.value=((b*(this.currentNumber-1))*-1);$("lottery_wheel_wheel").removeClassName("start");$("lottery_wheel_wheel").style.transform="rotate("+this.value+"deg)"};lottery.prototype.showNumber=function(a){if(!a){a=this.data.config.slots[this.currentNumber].lot}var b='<div id="lottery_wheel_current_number">';b+='  <div class="lot lot'+a+'"></div>';b+="</div>";$("lottery_wheel").insert(b);$("lottery_wheel_current_number").addClassName("boom");setTimeout(function(){if($("lottery_wheel_current_number")){$("lottery_wheel_current_number").remove()}lottery.buildLots();if($("lottery_lots_lot"+lottery.currentNumber)){$("lottery_lots_lot"+lottery.currentNumber).addClassName("pulse");setTimeout(function(){$("lottery_lots_lot"+lottery.currentNumber).removeClassName("pulse")},1000)}},1500)};lottery.prototype.buildPrizes=function(){var h="";h+='<div class="transp"></div>';h+='<div id="lottery_prizes_inner" class="prizes_inner">';h+='  <div class="head">'+t_lottery_prizes_head+"</div>";h+='  <div class="desc">'+t_lottery_prizes_desc+"</div>";h+='  <div class="list">';var q="";var n="";var r="";var a="";for(var b in this.data.config.prizes){var m="";var c="";var t="";if(this.data.config.prizes[b].redeemed){t="isredeemed"}c+='<div class="line '+t+'">';c+='  <div class="col col1" onmouseover="showDiv(\'lottery_prize'+b+"_tt')\" onmouseout=\"hideDiv('lottery_prize"+b+"_tt')\">";if(this.data.config.prizes[b].products){c+='<div class="product_package size'+this.data.config.prizes[b].products+'"></div>';m=t_productpackage_size[this.data.config.prizes[b].products]}if(this.data.config.prizes[b].powerup){c+='<div class="powerup"></div>';m=windmillarray[this.data.config.prizes[b].powerup][5][3]+"%&nbsp;"+windmillarray[this.data.config.prizes[b].powerup][2]}if(this.data.config.prizes[b].farmhouse){c+='<img src="'+imgpath+"farmhouse/thumbs/"+this.data.config.prizes[b].farmhouse+'.jpg">';m=t_farmhouse_item}c+='    <div id="lottery_prize'+b+'_tt" class="ttbox">'+m+"</div>";c+="  </div>";if(!this.data.config.prizes[b].redeemed){c+='<div class="col col2">';var e=0;for(var s in this.data.config.prizes[b].lots){var d=parseInt(this.data.config.prizes[b].lots[s]);var l=0;if(this.data.data.lots[s]){l=parseInt(this.data.data.lots[s])}var t="";if(!l||l<d){e=1;t="important"}c+="<div>";c+='  <div class="amount '+t+'">'+l+"/"+d+"</div>";c+='  <div class="slot lot'+s+'"></div>';c+="</div>"}c+="</div>"}c+='  <div class="col col3">';if(this.data.config.prizes[b].redeemed){c+='<div class="redeemed"></div>'}else{var t="";if(e==1){t="off"}if(this.data.config.prizes[b].daily&&this.data.data.redeemed&&this.data.data.redeemed[b]&&this.data.data.redeemed[b]>=this.data.todaytime){t="off"}c+='<div class="button_new link '+t+'" onclick="lottery.exchangeCommit('+b+')">'+t_lottery_prizes_exchange_button+"</div>"}c+="  </div>";if(this.data.config.prizes[b].daily){var u=t_lottery_daily_info;if(this.data.data.redeemed&&this.data.data.redeemed[b]&&this.data.data.redeemed[b]>=this.data.todaytime){u=t_lottery_daily_info2}c+='<div class="col col4">'+u+"</div>"}c+='  <div class="clear"></div>';c+="</div>";if(this.data.config.prizes[b].powerup){q+=c}else{if(this.data.config.prizes[b].products){n+=c}else{if(this.data.config.prizes[b].redeemed){a+=c}else{r+=c}}}}h+=q+n+r+a;h+="  </div>";h+='  <div class="mini_close link" onclick="lottery.closePrizes();"></div>';h+="</div>";$("lottery_prizes").innerHTML=h};lottery.prototype.exchangeCommit=function(d){html='<div id="lottery_commit">';html+='  <div class="lots">';for(var a in this.data.config.prizes[d].lots){var b=parseInt(this.data.config.prizes[d].lots[a]);html+='<div class="col1">'+b+"</div>";html+='<div class="col2 lot'+a+'"></div>'}html+="  </div>";html+='  <div class="prize">';if(this.data.config.prizes[d].products){html+='<div class="product_package size'+this.data.config.prizes[d].products+'"></div>'}if(this.data.config.prizes[d].powerup){html+='<div class="powerup"></div>'}if(this.data.config.prizes[d].farmhouse){html+='<img src="'+imgpath+"farmhouse/thumbs/"+this.data.config.prizes[d].farmhouse+'.jpg">'}html+="  </div>";html+="  <div>"+t_lottery_exchange_desc+"</div>";html+="</div>";var c="lottery.exchange("+d+")";globalcommitbox(t_lottery_prizes_exchange_button,html,c)};lottery.prototype.showPrizes=function(){this.buildPrizes();$("lottery_prizes").style.display="flex";$("lottery_prizes_inner").addClassName("bounce")};lottery.prototype.closePrizes=function(){hideDiv("lottery_prizes");$("lottery_prizes_inner").removeClassName("bounce")};lottery.prototype.showReward=function(){if(!this.data.rewards){return 1}var c='<div id="lottery_commit">';c+='<div style="margin-bottom:10px;">'+t_specialoffer_message+"</div>";if(this.data.rewards.farmhouse){for(var b=0;b<this.data.rewards.farmhouse.length;b++){c+='<img src="'+imgpath+"farmhouse/thumbs/"+this.data.rewards.farmhouse[b]+'.jpg">'}}if(this.data.rewards.products){for(var a in this.data.rewards.products){amount=this.data.rewards.products[a];c+='<div style="display:flex; justify-content:center; align-items:center; margin-top:5px;">'+htmlProductBody(a,amount)+"</div>"}}if(this.data.rewards.powerup){for(var d in this.data.rewards.powerup){c+='<div style="display:flex; justify-content:center; align-items:center; margin-top:5px;">';c+="  <div>";c+='    <div class="powerup"></div>';c+='    <div style="margin-top:5px;">'+windmillarray[d][5][3]+"%&nbsp;"+windmillarray[d][2]+"</div>";c+="  </div>";c+="</div>"}}c+="</div>";globalcommitbox(t_lottery_prizes_exchange_button,c,0,0,1)};lottery.prototype.timer=function(){};lottery.prototype.close=function(){hideDiv("lottery")};var main=function(){this.data={}};main.prototype.gethostname=function(){main.action("gethostname")};main.prototype.buildingOverviewSetToken=function(){main.action("buildingoverview_settoken")};main.prototype.action=function(a,b){ajaxAction("farm",a,b,main.response)};main.prototype.response=function(b,a,c){};main.prototype.statsFlyer=function(m,e,q){var b={};b[1]={type:"points",current:user_points,compare:m};b[2]={type:"bar",current:user_bar,compare:e};b[3]={type:"coins",current:user_coins,compare:q};for(var c in b){var h=1;var a="main_"+b[c].type+"_flyer"+h;if($(a)){$(a).remove()}if(parseFloat(b[c].current)>0&&parseFloat(b[c].compare)!==parseFloat(b[c].current)){if($(a)){$(a).remove()}if(b[c].type==="bar"){var l=parseFloat(b[c].compare)-parseFloat(b[c].current)}else{var l=(parseInt(b[c].compare)-parseInt(b[c].current))}if(l<=0){var n=""}else{var n="+"}if(b[c].type==="bar"){l=formatPrice(l)}else{l=formatNumber(l)}var d='<div id="'+a+'" class="main_flyer '+b[c].type+'">'+n+l+"</div>";$("userinfoscontainer").insert(d);main.statsFlyerRemove(a)}}};main.prototype.statsFlyerRemove=function(a){setTimeout(function(){if($(a)){$(a).addClassName("fly")}},200);setTimeout(function(){if($(a)){$(a).remove()}},1400)};function roundDecimal(a){return Math.round(a*100)/100}currentBuildingOverviewNavi="list";buildingOverviewToken=0;main.prototype.buildingOverview=function(){var d=["list","buildings","animals"];var c='<div id="building_overview">';c+='  <div class="navi">';for(var b=0;b<d.length;b++){var a="";if(currentBuildingOverviewNavi==d[b]){a="active"}c+='<div class="tab link '+a+'" onclick="main.buildingOverviewNavi(\''+d[b]+"');\">"+t_building_overview_navi_tab[d[b]]+"</div>"}c+='    <div class="clear"></div>';c+="  </div>";c+='  <div class="headline">'+t_building_overview_navi_tab[currentBuildingOverviewNavi]+"</div>";c+='  <div id="building_overview_content"></div>';c+="</div>";globalBoxFlex("",c,0,0,1);$("globalbox").style.top="65px";if(!buildingOverviewToken){this.buildingOverviewSetToken();buildingOverviewToken=1}if(currentBuildingOverviewNavi=="list"){this.buildingOverviewList()}if(currentBuildingOverviewNavi=="buildings"){openReallocateBuilding(1)}if(currentBuildingOverviewNavi=="animals"){openReallocateAnimals(1)}};main.prototype.buildingOverviewList=function(){var n={};for(var a in farms_data.farms){for(var r in farms_data.farms[a]){var l=farms_data.farms[a][r];if(!parseInt(l.buildingid)||!parseInt(l.status)){continue}if(!n[l.buildingid]){n[l.buildingid]={}}if(!n[l.buildingid][a]){n[l.buildingid][a]={}}n[l.buildingid][a][r]=l}}var m="";m+='<div class="list">';for(var c in buildinginfos[0]){var b=buildinginfos[0][c][10];var q="<div>"+b+"</div>";var d="";if(c==6){}if(c==17&&!n[17]&&carpentry_data&&carpentry_data.data&&carpentry_data.data.level){d+="<div>"+t_building_overview_current_level.replace("%NAME%",b)+":&nbsp;"+carpentry_data.data.level+"</div>"}if(c==19&&!n[19]&&farms_data&&farms_data.megafield_level&&farms_data.megafield_level>0){d+="<div>"+t_building_overview_current_level.replace("%NAME%",b)+":&nbsp;"+farms_data.megafield_level+"</div>"}if(c==20&&!n[20]&&farms_data&&farms_data.fuelstation_level&&farms_data.fuelstation_level>0){d+="<div>"+t_building_overview_current_level.replace("%NAME%",b)+":&nbsp;"+farms_data.fuelstation_level+"</div>"}if(c==22&&!n[22]&&farms_data&&farms_data.hillwalk_level&&farms_data.hillwalk_level>0){d+="<div>"+t_building_overview_current_level.replace("%NAME%",b)+":&nbsp;"+farms_data.hillwalk_level+"</div>"}if(c==23&&!n[23]&&farms_data&&farms_data.sushibar_level&&farms_data.sushibar_level>0){d+="<div>"+t_building_overview_current_level.replace("%NAME%",b)+":&nbsp;"+farms_data.sushibar_level+"</div>"}addclass="";if(!n[c]){addclass="off"}m+='<div class="line" onmouseover="showDiv(\'building_overview_line'+c+"_tt')\" onmouseout=\"hideDiv('building_overview_line"+c+"_tt')\">";m+='  <div class="col1 bm'+c+" "+addclass+'"></div>';m+='  <div class="col2">';if(n[c]){for(var h in farms_data.farms){m+='<div class="farm link" onclick="mapGo2Location(\'farm\', '+h+')">';m+='  <div class="count">'+h+"</div>";for(var e=1;e<=6;e++){addclass="";if(n[c]&&n[c][h]&&n[c][h][e]){addclass="placed"}m+='<div class="pos '+addclass+'"></div>'}m+='  <div class="clear"></div>';m+="</div>"}m+='<div class="clear"></div>'}if(parseInt(buildinginfos[0][c][6])>parseInt(currentuserlevel)){m+='<div class="info failed">'+t_building_overview_require_level.replace("%LEVEL%",buildinginfos[0][c][6])+"</div>"}if(d!=""){m+='<div class="info">';m+=d;m+='  <div class="disclaimer">'+t_building_overview_destruct_info+"</div>";m+="</div>"}m+='    <div id="building_overview_line'+c+'_tt" class="ttbox">'+q+"</div>";m+="  </div>";m+='  <div class="clear"></div>';m+="</div>"}m+="</div>";$("building_overview_content").innerHTML=m};main.prototype.buildingOverviewNavi=function(a){currentBuildingOverviewNavi=a;this.buildingOverview()};main.prototype.notEnoughCoinsCommit=function(){var a='<div id="notenoughcoins_commit">';a+='  <div class="desc">'+t_not_enough_coins+"</div>";a+='  <div class="isbutton">';a+='    <a href="'+PAYMENTLINK+'" target="_blank"><button class="link coinsbutton_small" type="button">'+t_coins_buy_menu+"</button></a>";a+="  </div>";a+="</div>";globalcommitbox(errorheadline,a,0,0,1)};var timerWorker=new Worker("js/worker.js");var map_help_navi_select=0;var map_current_route=0;var map_current_vehicle=0;var map_current_vehicle_slot=0;var map_vehicle_cart={};var map_stock_overview_filter=["v","ex","e","o","alpin","tea"];if(activate8farm==1){map_stock_overview_filter=["v","ex","e","o","alpin","tea","water","sushi"]}if(activate10farm==1){map_stock_overview_filter=["v","ex","e","o","alpin","tea","water","sushi","spice","spicedried","spiceground"]}var map_fill_vehicle_slot_filter="v";var map_fill_vehicle_slot_page=1;var map_overview_filter="stock";var map_overview_vehicles_filter=1;var mapBlockzones={city2:{name:cityname2,level:8,unlock:0},forestry:{name:cityzone_quicknavi,level:20,unlock:1},picknick:{name:rack_foodworld,level:11,unlock:0},farmersmarket:{name:t_farmers_market,level:23,unlock:0}};setTimer("map");function mapHelpNavi(c){if(!c){map_help_navi_select=1}else{map_help_navi_select=c}for(var b=1;b<=8;b++){hideDiv("map_help_box_inner_"+b);if($("map_help_navi_tab_"+b)){$("map_help_navi_tab_"+b).removeClassName("white_tab_active")}}showDiv("map_help_box_inner_"+map_help_navi_select);$("map_help_navi_tab_"+map_help_navi_select).addClassName("white_tab_active");if(c==3){for(var b in farms_data.map.achievements){if(farms_data.map.achievements[b].solved){showDiv("map_achievement_blocker"+b)}else{hideDiv("map_achievement_blocker"+b)}}if(stall&&stall.data&&stall.data.achievements){for(var b=0;b<stall.data.achievements.length;b++){showDiv("map_achievement_blocker"+stall.data.achievements[b])}}}if(c==6){var a="";for(var b=0;b<farm7_productionsbonus_valid.length;b++){a+=buildinginfos[0][farm7_productionsbonus_valid[b]][10];if(b!=(farm7_productionsbonus_valid.length-1)){a+=", "}}if($("map_help_box_inner_6_buildings")){$("map_help_box_inner_6_buildings").innerHTML=a}}}function mapVehicleTours(){for(var h=1;h<=const_maxfarms;h++){if($("map_active_tour"+h)){hideDiv("map_active_tour"+h)}}for(var d in farms_data.map.vehicles){for(var l in farms_data.map.vehicles[d]){var c=farms_data.map.vehicles[d][l];if(c.remain>0){if(!$("map_active_tour_time"+d+"_"+l)){var e="";var b="";if(d==1&&c.current>1){b="mirrored"}if(d==2&&c.current==1){b="mirrored"}var a=(100-((c.remain*100)/c.duration_original));e+='<div style="float:left; margin-right:3px;" onmouseover="$(\'map_active_tour_time'+d+"_"+l+"').style.opacity=1\" onmouseout=\"$('map_active_tour_time"+d+"_"+l+"').style.opacity=0.5\" onclick=\"map_overview_filter='vehicles'; mapDialog('stock_overview')\">";e+='  <div class="map_vehicle'+c.type+"_mini_farm link "+b+"\" onclick=\"map_overview_filter='vehicles'; mapDialog('stock_overview')\"></div>";e+='  <div style="position:relative; margin-top:2px; width:65px; height:5px; background-color:black; border-radius:5px; overflow:hidden;">';e+='    <div style="position:absolute; top:0px; left:0px; width:'+a+'%; height:5px; background-color:lime;"></div>';e+="  </div>";e+='  <div id="map_active_tour_time'+d+"_"+l+'" class="map_active_tour_time route'+d+'">'+formatTime(c.remain)+"</div>";e+="</div>";e+='<div style="float:left; margin-top:10px;" class="speedupgardenbutton link" onclick="hideDiv(\'globalbox\'); globalSpeedupBox(\'map_tour\', 0, '+d+')"></div>';$("map_active_tour"+d).innerHTML=e}showDiv("map_active_tour"+d);$("map_active_tour_time"+d+"_"+l).innerHTML=formatTime(c.remain)}}}}function openMap(){if(farmersmarket_addon==1){mapBlockzones.farmersmarket2={name:t_farmers_market+"&nbsp;2",level:23,unlock:0}}if(visitor&&$("visitor_view")){visitor.close(1)}if(eventgarden&&$("eventgarden")){eventgarden.close()}if(greenhouse&&$("greenhouse")){greenhouse.close()}if(train&&$("train")){train.close()}showDiv("map_main");for(var b in farms_data.farms){var a="";for(var c in farms_data.farms[b]){a+='<div class="map_farm_bld map_farm_bld'+farms_data.farms[b][c].buildingid+'"></div>'}if($("map_farm"+b+"_buildings")){$("map_farm"+b+"_buildings").innerHTML=a}}updateMap();if(tutorial==4||tutorial==9){$("t_step1").className="nope";$("t_step2").className="highlight_tutorial_step";if(tutorial==4){hideDiv("tutorial7");showDiv("tutorial7_1")}if(tutorial==9){hideDiv("tutorial17");showDiv("tutorial17_1")}}if(currentuserlevel>=40){showDiv("map_help_link")}else{hideDiv("map_help_link")}}function updateMap(){for(var l in mapBlockzones){var e=0;var d=0;if(currentuserlevel<mapBlockzones[l].level){e=1;d=1}if((l=="farmersmarket"||l=="farmersmarket2")&&!farmersmarket_data){e=1}if(l=="forestry"&&!forestry_unlock){e=1}if(e==1){var b=t_requirements;if(mapBlockzones[l].unlock){b=t_requirements_unlock}var s=str_replace("%NAME%",mapBlockzones[l].name,b);s=str_replace("%LEVEL%",mapBlockzones[l].level,s);if((l=="farmersmarket"||l=="farmersmarket2")&&farms_data.count<2){var w="<div>"+str_replace("%FARM%",2,t_map_previous_farm_required)+"</div>";if(d==1){s+="<div>&nbsp;</div>"+w}else{s=w}}if(l=="forestry"){s+='<div style="margin-top:5px;">'+str_replace(":","",lotterylotsrequired)+t_quest_forestry1_tt+"&nbsp;/&nbsp;"+t_help_new_quest+"&nbsp;3</div>"}$("map_"+l+"_tt").innerHTML=s;showDiv("map_"+l+"_block");$("map_"+l).onclick=new Function("")}else{var u=l;var r=1;if(l=="city2"){u="city";r=2}hideDiv("map_"+l+"_block");$("map_"+l+"_tt").innerHTML=mapBlockzones[l].name;$("map_"+l).onclick=new Function("mapGo2Location('"+u+"', "+r+")")}}for(var q in farms_data.farms){if($("map_vehicle_shop"+(q-4))){showDiv("map_vehicle_shop"+(q-4))}hideDiv("map_farm"+q+"_block");hideDiv("map_farm"+q+"_buy");if($("map_farm"+q)){$("map_farm"+q).onclick=new Function("mapGo2Location('farm', "+q+")")}}for(var q in farms_data.blocked){if($("map_farm"+q)){var n=farmBuyOption(q);if(n.block){showDiv("map_farm"+q+"_block");var s=$("map_farm"+q+"_block_tt").innerHTML=n.tt;v=""}else{showDiv("map_farm"+q+"_buy");v="mapDialog('buy_farm', "+q+")"}$("map_farm"+q).onclick=new Function(v);if($("map_vehicle_shop"+(q-4))){hideDiv("map_vehicle_shop"+(q-4))}}}for(var t in farms_data.map.config.routes){var z={a:"",b:""};for(var c in farms_data.map.vehicles[t]){var h='<div style="float:left;" class="map_vehicles_mini map_vehicles_mini'+farms_data.map.vehicles[t][c].type+'"></div>';if(farms_data.map.vehicles[t][c].current==1){z.a+=h}else{z.b+=h}}var m='<div id="map_vehicle_shop_vehicles'+t+'_a">'+z.a+"</div>";m+='<div id="map_vehicle_shop_vehicles'+t+'_b">'+z.b+"</div>";$("map_vehicle_shop_vehicles"+t).innerHTML=m}var a="";var v="";if(farm>0){a="map_pin_farm"+farm;v="mapGo2Location('farm', "+farm+")"}if(city>0){a="map_pin_city"+city;v="mapGo2Location('city', "+city+")"}if(forestry_quicknavi>0){a="map_pin_forestry";v="mapGo2Location('forestry')"}if(foodworld_quicknavi>0){a="map_pin_foodworld";v="mapGo2Location('foodworld')"}$("map_pin").className="link "+a;$("map_pin").onclick=new Function(v)}function mapVehicleSheetNavi(a){$("map_vehiclesheet_navi1").removeClassName("brown_tab_active");$("map_vehiclesheet_navi2").removeClassName("brown_tab_active");$("map_vehiclesheet_navi"+a).addClassName("brown_tab_active");if(a==1){mapDialog("vehicleSheetTour")}if(a==2){mapDialog("vehicleSheetShop")}}function mapDialog(n,L,M){if(n=="send_vehicle"){var r=t_map_vehicle_start_tour;var B=t_map_vehicle_start_tour;var K="farmAction('map_sendvehicle', "+farms_data.map.vehicles[map_current_route][map_current_vehicle].current+", 1);";var Q="mapDialog('openVehicleSheet', "+map_current_route+")";globalcommitbox(r,B,K,Q)}if(n=="buy_farm"&&farms_data.blocked[L]){var r=t_building_hqbuyfarm;var B='<div style="width:350px;">'+$("map_farm"+L+"_buy_tt").innerHTML+"</div>";if(farms_data.blocked[L][2]&&farms_data.blocked[L][2]==1){B+='<div style="margin:10px 0px; border-radius:5px; padding:20px; background-color:#C3A75E;">'+t_map_buyfarm_premiuminfo+"</div>"}var K="farmAction('map_buyfarm', 1, 1, "+L+")";globalcommitbox(r,B,K)}if(n=="buy_vehicle"&&L>0){var r=t_megafield_vehicle_buy_head;if(farms_data.map.config.vehicles[L].money&&farms_data.map.config.vehicles[L].money>0){var d=formatPrice(farms_data.map.config.vehicles[L].money)}if(farms_data.map.config.vehicles[L].coins&&farms_data.map.config.vehicles[L].coins>0){var d=farms_data.map.config.vehicles[L].coins+"&nbsp;"+t_coins}if(farms_data.map.config.vehicles[L].unlock&&farms_data.map.config.vehicles[L].unlock>0){var d=Math.ceil(farms_data.map.config.routes[map_current_route].vehicle_multi*farms_data.map.config.vehicles[L].unlock)+"&nbsp;"+t_fuelstation_currency}var B=str_replace("%COST%",d,t_megafield_vehicle_buy_body);if(!farm){var ae=1}else{ae=farm}var K="farmAction('map_buyvehicle', "+ae+", 1, "+map_current_route+", "+L+")";globalcommitbox(r,B,K)}if(n=="vehicleSheetTour"){if($("map_vehiclesheet_inner")){var G="";var w=0;for(var t in farms_data.map.config.vehicles){if(farms_data.map.vehicles[map_current_route]&&farms_data.map.vehicles[map_current_route][t]){if(farms_data.map.vehicles[map_current_route][t].remain&&farms_data.map.vehicles[map_current_route][t].remain>0){w++}}}G+='<div style="margin-bottom:5px; border-bottom:1px solid #000; padding-bottom:5px;">';G+='  <div style="float:left; width:55px; font-weight:bold; text-align:left;">'+t_map_vehicle_current_location+"</div>";G+='  <div style="float:left; font-weight:bold; margin-left:210px; margin-top:12px;">'+t_map_vehicle_overview_cargo+"</div>";G+='  <div class="clear"></div>';G+="</div>";G+='<div style="position:relative; height:420px; overflow:auto;">';var U=0;for(var t in farms_data.map.config.vehicles){if(farms_data.map.vehicles[map_current_route]&&farms_data.map.vehicles[map_current_route][t]){var Z=0;if(farms_data.map.vehicles[map_current_route][t].remain&&farms_data.map.vehicles[map_current_route][t].remain>0){Z=1}var a=((mapGetCurrentCapacity(t)*100)/farms_data.map.config.vehicles[t].capacity);var Y=Math.ceil(farms_data.map.config.routes[map_current_route].fuel*farms_data.map.config.vehicles[t].fuel_multi);if(farms_data.map.vehicles[map_current_route][t].current>4){Y=0}var T=checkRackItem(farms_data.map.config.fuel_product);var C=Math.ceil(farms_data.map.config.routes[map_current_route].duration*farms_data.map.config.vehicles[t].duration_multi);var P="";var e="";if(Y>T){P="important";e='<div style="margin-top:5px;" class="important">'+str_replace("%AMOUNT%",(Y-T),t_fuel_need_info2)+"</div>"}G+='<div class="map_vehiclesheet_tour_item">';G+='  <a name="vehicle'+t+'"></a>';var h=farms_data.map.vehicles[map_current_route][t].current;if(h<=4){var u=t_map_stock_overview_mainstock}else{var u=str_replace("%FARM%",h,t_map_stock_overview_tempstock)}G+='  <div style="position:relative; float:left; margin-right:5px; width:106px; margin-top:-3px; margin-right:5px; padding-top:25px; height:40px; text-align:center; font-size:11px; font-weight:bold; color:#503300; background:url('+imgpath+'map_current_location2.png);">'+u+"</div>";G+='  <div style="position:relative; float:left; margin-right:5px; width:150px;">';G+='    <div style="font-weight:bold; margin-bottom:5px;">'+farms_data.map.config.vehicles[t].name+"</div>";G+='    <div class="map_vehicle'+t+'_mini" style="margin-bottom:5px;"></div>';if(!Z){G+='<div style="margin-top:5px;">'+str_replace(" ","",guildquestlist_duration)+":&nbsp;"+formatTime(C)+"</div>";if(farms_data.map.vehicles[map_current_route][t].current<=4){G+='<div style="margin-top:5px;">';G+='  <div style="float:left; margin:5px 5px 0px 0px;">'+production_require+"</div>";G+='  <div style="float:left; position:relative;" class="link" onmouseover="showDiv(\'map_vehiclesheet_tour_fuel_tt'+t+"')\" onmouseout=\"hideDiv('map_vehiclesheet_tour_fuel_tt"+t+"')\">";G+='    <div style="float:left;" class="fuel_barrel_mini"></div>';G+='    <div style="float:left; margin:5px 0px 0px 5px;" class="'+P+'">'+Y+"</div>";G+='    <div class="clear"></div>';G+='    <div id="map_vehiclesheet_tour_fuel_tt'+t+'" style="top:32px; width:120px;" class="ttbox">'+t_fuel_need_info+e+"</div>";G+="  </div>";G+='  <div class="clear"></div>';G+="</div>"}}G+="  </div>";G+='  <div style="position:relative; float:left; width:315px;">';var af=map_vehicle_cart[t];if(Z){var W={};var af=farms_data.map.vehicles[map_current_route][t].data;for(var ac=0;ac<af.length;ac++){W[(ac+1)]=af[ac]}af=W}for(var ac=1;ac<=farms_data.map.config.vehicles[t].products;ac++){var l=0;var O=0;var K="mapDialog('fillVehicleSlot', "+t+", "+ac+")";var H="onmouseover=\"showDiv('map_vehicle_"+t+"_sheet_current_slot"+ac+"_tt')\" onmouseout=\"hideDiv('map_vehicle_"+t+"_sheet_current_slot"+ac+"_tt')\"";if(af&&af[ac]){l=af[ac].amount;O=af[ac].pid;K="map_current_vehicle_slot="+ac+"; mapDialog('fillVehicleSlot_product', "+t+", "+O+")"}if(Z){K=""}if((mapGetCurrentCapacity(t)>=farms_data.map.config.vehicles[t].capacity&&O<=0)||Z){K="";H=""}G+='<div id="map_vehicle_sheet_current_slot'+ac+'" class="map_vehicle_sheet_current_slot" '+H+">";G+='  <div class="tt'+O+'" style="position:relative; margin-top:5px; border-radius:5px;"></div>';G+='  <div class="link" style="position:absolute; top:0px; left:0px; width:100%; height:100%;" onclick="'+K+'"></div>';if(l>0){G+='<div style="position:absolute; bottom:0px; width:50px; font-weight:bold; text-align:right; right:2px; bottom:2px;">'+l+"</div>"}if(O>0&&!Z){G+='<div class="link close_mini_white" onclick="mapRemoveVehicleCardItem('+t+", "+O+')"></div>'}if(in_array(ac%5,[0,4])){var ag="right"}else{var ag="left"}G+='  <div class="ttbox" id="map_vehicle_'+t+"_sheet_current_slot"+ac+'_tt" style="top:0; '+ag+':60px; width:75px;">'+t_map_vehicle_how_to_load+"</div>";G+="</div>"}G+='    <div class="clear"></div>';if(Z){G+='<div class="map_vehiclesheet_tour_item_timer" style="margin-bottom:5px; float:left;">'+t_building_time+'<span id="map_vehiclesheet_tour_item'+map_current_route+"_"+t+'timer"></span></div>';G+='<div style="float:left; margin-top:-5px; margin-left:5px;" class="speedupgardenbutton link" onclick="hideDiv(\'globalbox\'); globalSpeedupBox(\'map_tour\', 0, '+map_current_route+')"></div>';G+='<div class="clear"></div>'}else{G+='    <div style="margin-bottom:5px;">';G+='      <div style="float:left; margin-right:5px;">'+t_map_vehicle_capacity+":</div>";G+='      <div style="float:left; position:relative; height:15px; width:150px; background-color:black; border-radius:5px; overflow:hidden;">';G+='        <div style="position:absolute; top:0px; left:0px; height:15px; width:'+a+'%; background-color:lime;"></div>';G+="      </div>";G+='      <div style="float:left; margin-left:5px;">'+mapGetCurrentCapacity(t)+"/"+farms_data.map.config.vehicles[t].capacity+"</div>";G+='      <div class="clear"></div>';G+="    </div>"}G+="  </div>";G+='  <div class="clear"></div>';if(!Z&&w>0){G+='<div class="important" style="margin-left:265px; margin-bottom:5px;">'+t_map_vehicle_tour_info+"</div>"}else{if(!Z&&Y<=T){G+='<div class="button_new link" onclick="map_current_vehicle='+t+'; mapDialog(\'send_vehicle\')" style="position:relative; text-align:center; bottom:5px; margin-top:5px; width:100px; margin-left:265px;">'+marktschreiersubmit+"</div>"}}G+="</div>";U++}}G+="</div>";if(!U){G=t_map_tour_need_vehicles}$("map_vehiclesheet_inner").innerHTML=G;window.location.hash="#vehicle"+map_current_vehicle}}if(n=="vehicleSheetShop"){var I=M;if(!I){I=1}var G="";G+='<div id="map_vehicleslot_shop_arrowleft" class="link market_category_arrowleft" onclick="mapDialog(\'vehicleSheetShop\', '+ac+", "+(I-1)+')"></div>';G+='<div style="float:left; margin-left:35px;">';var s=I;var ai=(I+2);var U=1;var J=0;for(var ac in farms_data.map.config.vehicles){var ae=farms_data.map.config.routes[map_current_route].b;if(!in_array(ae,farms_data.map.config.vehicles[ac].farms)){continue}if(!(farms_data.map.vehicles[map_current_route]&&farms_data.map.vehicles[map_current_route][ac])){if((U>=s&&U<=ai)){var Y=Math.ceil(farms_data.map.config.routes[map_current_route].fuel*farms_data.map.config.vehicles[ac].fuel_multi);var C=Math.ceil(farms_data.map.config.routes[map_current_route].duration*farms_data.map.config.vehicles[ac].duration_multi);var P="";var K="mapDialog('buy_vehicle', "+ac+")";if(farms_data.map.config.vehicles[ac].unlock){var d=Math.ceil(farms_data.map.config.routes[map_current_route].vehicle_multi*farms_data.map.config.vehicles[ac].unlock);if(farms_data.map.config.fuelstation_currency<d){P="important";K=""}d=formatNumber(d)}if(farms_data.map.config.vehicles[ac].money){if(user_bar<farms_data.map.config.vehicles[ac].money){P="important";K=""}var d=formatPrice(farms_data.map.config.vehicles[ac].money)}if(farms_data.map.config.vehicles[ac].coins){if(user_coins<farms_data.map.config.vehicles[ac].coins){P="important";K=""}var d=farms_data.map.config.vehicles[ac].coins+"&nbsp;"+t_coins}G+='<div class="map_vehiclesheet_shop_item">';G+='  <div class="map_vehicle'+ac+'_big"></div>';G+='  <div style="margin-top:5px;">';G+='    <div style="font-weight:bold; margin-bottom:5px;">'+farms_data.map.config.vehicles[ac].name+"</div>";G+='      <div style="float:left; margin:5px 5px 0px 0px;">'+production_require+"</div>";G+='      <div style="float:left;" class="fuel_barrel_mini"></div>';G+='      <div style="float:left; margin:5px 0px 0px 5px;">'+Y+"</div>";G+='      <div class="clear"></div>';G+='      <div style="margin-top:5px;">'+str_replace(" ","",guildquestlist_duration)+":&nbsp;"+formatTime(C)+"</div>";G+='      <div style="margin-top:5px; margin-bottom:5px;">'+t_map_vehicle_capacity+":&nbsp;"+formatNumber(farms_data.map.config.vehicles[ac].capacity)+"</div>";for(var ab=1;ab<=farms_data.map.config.vehicles[ac].products;ab++){G+='<div style="float:left; width:20px; height:20px; background-color:#FFAF62; border-radius:4px; margin:0px 2px 2px 0;"></div>';if(ab>1&&ab%5==0){G+='<div class="clear"></div>'}}G+='    <div class="clear"></div>';G+='    <div class="button_new link" onclick="'+K+'" style="position:absolute; bottom:5px; width:152px; text-align:center;">';G+='      <div style="float:left; font-size:16px; text-align:center; width:100%;" class="'+P+'">'+d+"</div>";G+='      <div class="clear"></div>';G+="    </div>";G+="  </div>";G+="</div>"}U++;J++}}if(!J){G+='<div style="width:525px; text-align:center; margin:10px 0px;">'+t_map_vehicleshop_all_vehicles_bought+"</div>"}G+="</div>";G+='<div id="map_vehicleslot_shop_arrowright" class="link market_category_arrowright" onclick="mapDialog(\'vehicleSheetShop\', '+ac+", "+(I+1)+')"></div>';G+='<div style="clear:both;"></div>';$("map_vehiclesheet_inner").innerHTML=G;$("map_vehiclesheet_inner").removeClassName("map_vehiclesheet_inner_overflow");hideDiv("map_vehicleslot_shop_arrowleft");hideDiv("map_vehicleslot_shop_arrowright");if(I>1){showDiv("map_vehicleslot_shop_arrowleft")}if(I<(U-3)){showDiv("map_vehicleslot_shop_arrowright")}}if(n=="openVehicleSheet"){map_current_route=L;var r="";var B='<div style="margin-top:-30px;">';B+='  <div style="margin-bottom:15px; font-size:14px; font-weight:bold;">';B+='    <div style="float:left;">'+t_map_stock_overview_mainstock+"</div>";B+='    <div style="float:left; border-color:transparent #C3A75E transparent transparent; border-style:solid; border-width:10px; height:0px; width:0px; margin-right:5px;"></div>';B+='    <div style="float:left; border-color:transparent transparent transparent #C3A75E; border-style:solid; border-width:10px; height:0px; width:0px;"></div>';B+='    <div style="float:left;">';B+='    <select id="map_vehicles_select" style="border:0px; border-radius:5px; padding:2px;" onchange="mapVehiclesSelected()">';for(var ac in farms_data.farms){var ab=(ac-4);if(ab<=0){continue}var e="";if(+ab==+map_current_route){e="selected"}if(farms_data.map.config.routes&&farms_data.map.config.routes[ab]){B+='<option value="'+ab+'" '+e+">"+t_map_stock_overview_tempstock.replace("%FARM%",farms_data.map.config.routes[ab].b)+"</option>"}}B+="    </select>";B+="    </div>";B+='    <div class="clear"></div>';B+="  </div>";B+='  <div id="map_vehiclesheet_navi1" class="brown_tab link" onclick="mapVehicleSheetNavi(1)" style="margin-left:10px;">'+t_map_plan_tour+"</div>";B+='  <div id="map_vehiclesheet_navi2" class="brown_tab link" onclick="mapVehicleSheetNavi(2)">'+t_map_buy_vehicle+"</div>";B+='  <div class="clear"></div>';B+='  <div class="brown_tab_content">';B+='    <div id="map_vehiclesheet_inner"></div>';B+="  </div>";B+="</div>";globalcommitbox(r,B,0,0,1);$("globalbox_content").removeClassName("globalbox_content");$("globalbox_content").addClassName("globalbox_content_max_width");hideDiv("globalbox_char");hideDiv("globalbox_footer");var a=$("globalbox").getWidth();$("globalbox").style.marginLeft="-"+(a/2)+"px";$("globalbox").style.top="50px";var U=0;if(farms_data.map.vehicles[map_current_route]){for(var ac in farms_data.map.vehicles[map_current_route]){U++}}if(U>0){mapVehicleSheetNavi(1)}else{mapVehicleSheetNavi(2)}}if(n=="fillVehicleSlot"){map_current_vehicle=L;if(farms_data.map.vehicles[map_current_route]&&farms_data.map.vehicles[map_current_route][map_current_vehicle]){farm=farms_data.map.vehicles[map_current_route][map_current_vehicle].current;sortRackNew();var c=[];if(map_vehicle_cart[map_current_vehicle]){for(var ac in map_vehicle_cart[map_current_vehicle]){c.push(map_vehicle_cart[map_current_vehicle][ac].pid)}}if(M>0){map_current_vehicle_slot=M}var r=t_map_vehicle_fill;var B="";B+='<div style="margin-bottom:-1px;">';B+='  <div class="link map_vehicle_fill_slot_category white_tab cmenue_v" id="map_vehicle_fill_slot_category_v" style="margin-left:10px; width:16px; height:14px;" onclick="map_fill_vehicle_slot_page=1; map_fill_vehicle_slot_filter=\'v\'; mapDialog(\'fillVehicleSlot\', '+L+');"></div>';B+='<div class="link map_vehicle_fill_slot_category white_tab cmenue_ex" id="map_vehicle_fill_slot_category_ex" style="margin-left:10px; width:16px; height:14px;" onclick="map_fill_vehicle_slot_page=1; map_fill_vehicle_slot_filter=\'ex\'; mapDialog(\'fillVehicleSlot\', '+L+');"></div>';B+='<div class="link map_vehicle_fill_slot_category white_tab cmenue_alpin" id="map_vehicle_fill_slot_category_alpin" style="margin-left:10px; width:16px; height:14px;" onclick="map_fill_vehicle_slot_page=1; map_fill_vehicle_slot_filter=\'alpin\'; mapDialog(\'fillVehicleSlot\', '+L+');"></div>';if(activate8farm==1){B+='<div class="link map_vehicle_fill_slot_category white_tab cmenue_water" id="map_vehicle_fill_slot_category_water" style="margin-left:10px; width:16px; height:14px;" onclick="map_fill_vehicle_slot_page=1; map_fill_vehicle_slot_filter=\'water\'; mapDialog(\'fillVehicleSlot\', '+L+');"></div>'}if(activate10farm==1){B+='<div class="link map_vehicle_fill_slot_category white_tab cmenue_spice" id="map_vehicle_fill_slot_category_spice" style="margin-left:10px; width:16px; height:14px;" onclick="map_fill_vehicle_slot_page=1; map_fill_vehicle_slot_filter=\'spice\'; mapDialog(\'fillVehicleSlot\', '+L+');"></div>'}B+='  <div class="link map_vehicle_fill_slot_category white_tab cmenue_e" id="map_vehicle_fill_slot_category_e" style="margin-left:10px; width:16px; height:14px;" onclick="map_fill_vehicle_slot_page=1; map_fill_vehicle_slot_filter=\'e\'; mapDialog(\'fillVehicleSlot\', '+L+');"></div>';B+='  <div class="link map_vehicle_fill_slot_category white_tab cmenue_o" id="map_vehicle_fill_slot_category_o" style="margin-left:10px; width:16px; height:14px;" onclick="map_fill_vehicle_slot_page=1; map_fill_vehicle_slot_filter=\'o\'; mapDialog(\'fillVehicleSlot\', '+L+');"></div>';B+='  <div class="clear"></div>';B+="</div>";B+='<div class="white_tab_content" style="width:478px; height:345px;">';var ah=mapGetStockData();var S=36;var s=(((map_fill_vehicle_slot_page-1)*S)+1);var ai=(map_fill_vehicle_slot_page*S);var U=1;var A=[map_fill_vehicle_slot_filter];if(map_fill_vehicle_slot_filter=="alpin"){A=["alpin","tea"]}if(map_fill_vehicle_slot_filter=="water"){A=["water","sushi"]}if(map_fill_vehicle_slot_filter=="spice"){A=["spice","spicedried","spiceground"]}for(var O in ah){if(in_array(produkt_category[O],A)){if(U>=s&&U<=ai){var aj="sack";if(map_fill_vehicle_slot_filter=="e"){var aj="box"}if(map_fill_vehicle_slot_filter=="o"){var aj="bottle"}if(map_fill_vehicle_slot_filter=="tea"){var aj="box"}if(map_fill_vehicle_slot_filter=="spice"){if(in_array(produkt_category[O],["spicedried"])){aj="box"}if(in_array(produkt_category[O],["spiceground"])){aj="spiceglass"}}if(in_array(map_fill_vehicle_slot_filter,["sushi"])){var aj="box"}if(jam_products[O]){aj="jamglass"}var K="mapDialog('fillVehicleSlot_product', "+map_current_vehicle+", "+O+")";var q="";if(in_array(O,c)){q="opacity:0.50;";K=""}B+='<div class="map_vehicle_fill_slot_item '+aj+' link" style="'+q+'" onclick="'+K+'" onmouseover="showDiv(\'map_vehicle_fill_slot_item'+O+"_tt')\" onmouseout=\"hideDiv('map_vehicle_fill_slot_item"+O+"_tt')\">";B+='  <div class="e'+O+" img_"+aj+'"></div>';B+='  <div class="tklein2 counter_box">'+formatNumber(ah[O].number)+"</div>";B+='  <div id="map_vehicle_fill_slot_item'+O+'_tt" style="bottom:55px;" class="ttbox">'+produkt_name[O]+"</div>";B+="</div>"}U++}}B+='  <div class="clear"></div>';B+='  <div id="map_vehicle_fill_slot_arrow_left" class="link big_red_arrow_left" onclick="map_fill_vehicle_slot_page -= 1; mapDialog(\'fillVehicleSlot\', '+L+", "+M+')"></div>';B+='  <div id="map_vehicle_fill_slot_arrow_right" class="link big_red_arrow_right" onclick="map_fill_vehicle_slot_page += 1; mapDialog(\'fillVehicleSlot\', '+L+", "+M+')"></div>';B+="</div>";var w=farms_data.map.vehicles[map_current_route][map_current_vehicle].current;if(map_transfer_rest[w]&&map_transfer_rest[w][map_fill_vehicle_slot_filter]){B+='<div class="important">'+str_replace("%COUNT%",map_transfer_rest[w][map_fill_vehicle_slot_filter],t_farmtransfer_rest_warning)+"</div>"}var Q="mapDialog('openVehicleSheet', "+map_current_route+")";globalcommitbox(r,B,0,Q,1);$("globalbox_content").removeClassName("globalbox_content");$("globalbox_content").addClassName("globalbox_content_flex");hideDiv("globalbox_char");hideDiv("globalbox_footer");var a=$("globalbox").getWidth();$("globalbox").style.marginLeft="-"+(a/2)+"px";$("globalbox").style.top="50px";if($("map_vehicle_fill_slot_category_"+map_fill_vehicle_slot_filter)){$("map_vehicle_fill_slot_category_"+map_fill_vehicle_slot_filter).addClassName("white_tab_active")}hideDiv("map_vehicle_fill_slot_arrow_left");hideDiv("map_vehicle_fill_slot_arrow_right");if(map_fill_vehicle_slot_page>1){showDiv("map_vehicle_fill_slot_arrow_left")}if(map_fill_vehicle_slot_page<Math.ceil(U/S)){showDiv("map_vehicle_fill_slot_arrow_right")}}}if(n=="fillVehicleSlot_product"){map_current_vehicle=L;var O=M;var R=farms_data.map.config.vehicles[map_current_vehicle];var ah=mapGetStockData();var r=t_map_vehicle_fill;var B="";var F=0;if(map_vehicle_cart[map_current_vehicle]){for(var ac in map_vehicle_cart[map_current_vehicle]){if(map_vehicle_cart[map_current_vehicle][ac].pid==O){F=map_vehicle_cart[map_current_vehicle][ac].amount}}}B+='<div class="dialog_input_line" style="min-width:300px;">';B+='  <div class="kp'+O+'" style="float:left; margin:2px 5px 0 0;"></div>';B+='  <input type="text" id="map_vehicle_slot_fill_input" value="'+F+'" class="dialog_input" style="float:left; width:65px;" onchange="mapCalcVehicleSlot('+O+');" onkeyup="mapCalcVehicleSlot('+O+');">';B+='  <div style="float:left; margin:2px 0 0 5px;">'+t_inner_stock+"&nbsp;"+formatNumber(ah[O].number)+"</div>";B+='  <button class="button_new link" style="float:right; margin-left:10px;" onclick="mapSetVehicleSlot('+O+')">'+t_map_vehicle_fill+"</button>";B+='  <div class="clear"></div>';B+="</div>";B+="<div>"+t_map_vehicle_fill_restspace+"&nbsp;"+mapGetCurrentCapacity()+"/"+R.capacity+"</div>";var w=farms_data.map.vehicles[map_current_route][map_current_vehicle].current;if(map_transfer_rest[w]&&map_transfer_rest[w][map_fill_vehicle_slot_filter]&&!in_array(produkt_category[O],["tea","sushi","spicedried","spiceground"])){B+='<div class="important" style="margin-top:5px;">'+str_replace("%COUNT%",map_transfer_rest[w][map_fill_vehicle_slot_filter],t_farmtransfer_rest_warning2)+"</div>"}var Q="mapDialog('fillVehicleSlot', "+map_current_vehicle+", "+map_current_vehicle_slot+")";globalcommitbox(r,B,0,Q,1);$("map_vehicle_slot_fill_input").focus()}if(n=="stock_overview"){var V=["products","main"];if(farms_data.count>4){for(var ab in this.farms_data.farms){if(ab<=4||!this.farms_data.farms[ab][1]){continue}V.push(ab)}}var m=[];var ad={main:{}};for(var ab in rackCache[1]){for(var aa in rackCache[1][ab]){var O=rackCache[1][ab][aa].pid;ad.main[O]=rackCache[1][ab][aa].amount;m.push(O)}}var U=0;if(farms_data.count>4){for(var ab in this.farms_data.farms){if(ab<=4||!this.farms_data.farms[ab][1]||!rackCache[ab]){continue}for(var X in rackCache[ab]){for(var aa in rackCache[ab][X]){var O=rackCache[ab][X][aa].pid;if(!ad[ab]){ad[ab]={}}ad[ab][O]=rackCache[ab][X][aa].amount;m.push(O)}}U++}}var a=(270+(U*100));var z=[];var W={};var b=[];var U=0;for(var ac in produkt_name){if(ac>0&&in_array(produkt_category[ac],map_stock_overview_filter)){if(in_array(produkt_category[ac],["water","sushi"])){W[ac]=1;b.push(U)}z.push(ac);U++}}W=sushibar.sortProductsAppear(W);var U=0;for(var ac in W){var O=parseInt(ac.replace("a_",""));var I=b[U];z[I]=O;U++}var r="";var B="";B+='<div style="position:absolute; margin-top:-25px; z-index:10;">';B+='  <div id="map_overview_tab_stock" class="link brown_tab" style="margin-left:5px;" onclick="map_overview_filter=\'stock\'; mapDialog(\'stock_overview\');">'+t_map_stock_overview_head+"</div>";B+='  <div id="map_overview_tab_vehicles" class="link brown_tab" style="margin-left:-1px;" onclick="map_overview_filter=\'vehicles\'; mapDialog(\'stock_overview\');">'+t_map_vehicles_overview_head+"</div>";B+='  <div class="clear"></div>';B+="</div>";B+='<div id="map_vehicle_overview" class="brown_tab_content">';var D="";if(map_overview_vehicles_filter==1){D="checked"}B+='  <div style="background:#C3A75E; border-radius:5px; padding:2px; margin-bottom:5px;">';B+='    <input type="checkbox" style="float:left;" '+D+' onclick="mapSetVehicleOverviewFilter()"><div style="float:left; margin:2px 10px 0 0;">'+t_map_vehicle_overview_active_tours+'</div><div class="clear"></div>';B+="  </div>";B+='  <div style="float:left; font-weight:bold; width:120px;">&nbsp;</div>';B+='  <div style="float:left; font-weight:bold; width:50px;">'+t_map_vehicle_overview_start+"</div>";B+='  <div style="float:left; font-weight:bold; width:200px;">&nbsp;</div>';B+='  <div style="float:left; font-weight:bold; width:50px;">'+t_map_vehicle_overview_target+"</div>";B+='  <div style="float:left; font-weight:bold; width:80px; text-align:left;">'+t_map_vehicle_overview_duration+"</div>";B+='  <div style="float:left; font-weight:bold; width:100px; text-align:left;">'+t_map_vehicle_overview_cargo+"</div>";B+='  <div class="clear"></div>';B+='  <div id="map_vehicle_overview_inner"></div>';B+="</div>";var N=["v","ex","e","o","alpin","tea"];var N=["v","ex","e","o","alpin","tea"];if(activate8farm==1){var N=["v","ex","e","o","alpin","tea","water","sushi"]}if(activate10farm==1){var N=["v","ex","e","o","alpin","tea","water","sushi","spice","spicedried","spiceground"]}B+='<div id="map_stock_overview" class="brown_tab_content">';B+='  <div style="background:#C3A75E; border-radius:5px; padding:2px; margin-bottom:5px;">';B+='    <div class="tab"><input id="map_stockoverview_checkbox_v" type="checkbox" onclick="setMapstockOverviewFilter(\'v\')">'+t_category_plants+"</div>";B+='    <div class="tab"><input id="map_stockoverview_checkbox_ex" type="checkbox" onclick="setMapstockOverviewFilter(\'ex\')">'+t_help_new_products_ex_head+"</div>";B+='    <div class="tab"><input id="map_stockoverview_checkbox_e" type="checkbox" onclick="setMapstockOverviewFilter(\'e\')">'+t_category_animals+"</div>";B+='    <div class="tab"><input id="map_stockoverview_checkbox_o" type="checkbox" onclick="setMapstockOverviewFilter(\'o\')">'+t_category_oils+"</div>";B+='    <div class="tab"><input id="map_stockoverview_checkbox_alpin" type="checkbox" onclick="setMapstockOverviewFilter(\'alpin\')">'+t_category_alpin_tea+"</div>";if(activate8farm==1){B+='<div class="tab"><input id="map_stockoverview_checkbox_water" type="checkbox" onclick="setMapstockOverviewFilter(\'water\')">'+t_category_water_sushi+"</div>"}if(activate10farm==1){B+='<div class="tab"><input id="map_stockoverview_checkbox_spice" type="checkbox" onclick="setMapstockOverviewFilter(\'spice\')">'+t_category_spice+"</div>"}B+='    <div class="clear"></div>';B+="  </div>";B+='  <div class="map_stock_overview_list" style="">';if(activate10farm==1){B+="<div>";B+='  <div style="position:relative; float:left; width:150px; border-right:2px solid black; height:16px; padding:2px; border-bottom:2px solid black;">&nbsp;</div>';B+='  <div style="position:relative; width:calc(100% - 172px); overflow:hidden;">';B+='    <div id="map_stock_overview_list_farm_header" style="position:relative; width:calc(7 * 100px); display:flex; justify-content:left; align-items:center; gap:5px; height:16px; padding:2px; border-bottom:2px solid black;">';for(var ab=0;ab<V.length;ab++){if(in_array(V[ab],["products"])){continue}var E=str_replace("%FARM%",V[ab],t_map_stock_overview_tempstock);if(V[ab]=="main"){E=t_map_stock_overview_mainstock}B+='<div style="position:relative; width:100px; font-weight:bold; text-align:right;">'+E+"</div>"}B+="    </div>";B+="  </div>";B+='  <div class="clear"></div>';B+="</div>";B+='<div style="position:relative;">';B+='  <div id="map_stock_overview_list_products" style="position:relative; float:left; height:370px; width:100%; overflow-x:hidden; overflow-y:auto;">';for(var aa=0;aa<z.length;aa++){var O=z[aa];if(O>0&&in_array(produkt_category[O],map_stock_overview_filter)&&in_array(O,m)){B+='<div id="map_stock_overview_list_products_'+O+'" style="position:relative; width:150px; display:flex; justify-content:left; align-items:center; gap:5px; height:16px; padding:2px; border-right:2px solid black; border-bottom:1px solid black;" onmouseover="mapStockOverviewListHover(\''+O+"', 1);\" onmouseout=\"mapStockOverviewListHover('"+O+"', 0);\">";B+='  <div class="kp'+O+'"></div>';B+='  <div style="width:calc(100% - 20px); text-align:left; text-wrap:nowrap; overflow:hidden;">'+produkt_name[O]+"</div>";B+="</div>"}}B+='    <div style="position:relative; height:16px; padding:2px; border-right:1px solid transparent;">&nbsp;</div>';B+="  </div>";B+='  <div id="map_stock_overview_list_farms" style="position:absolute; left:156px; top:0px; width:calc(100% - 171px); height:370px; overflow-x:auto; overflow-y:hidden;">';for(var aa=0;aa<z.length;aa++){var O=z[aa];if(O>0&&in_array(produkt_category[O],map_stock_overview_filter)&&in_array(O,m)){B+='<div id="map_stock_overview_list_farms_'+O+'" style="position:relative; width:calc(7 * 100px); display:flex; justify-content:left; align-items:center; gap:5px; height:16px; padding:2px; border-bottom:1px solid black;" onmouseover="mapStockOverviewListHover(\''+O+"', 1);\" onmouseout=\"mapStockOverviewListHover('"+O+"', 0);\">";for(var ab=0;ab<V.length;ab++){if(in_array(V[ab],["products"])){continue}var l=0;if(ad[V[ab]]&&ad[V[ab]][O]){l=ad[V[ab]][O]}B+='<div style="position:relative; width:100px;">';B+='  <div style="text-align:right;">'+formatNumber(l)+"</div>";B+="</div>"}B+="</div>"}}B+='    <div style="position:relative; height:16px; padding:2px; border-right:1px solid transparent;">&nbsp;</div>';B+="  </div>";B+='  <div class="clear"></div>';B+="</div>"}else{B+='<div class="header" style="width:'+a+'px">';for(var ab=0;ab<V.length;ab++){var E=str_replace("%FARM%",V[ab],t_map_stock_overview_tempstock);if(V[ab]=="main"){E=t_map_stock_overview_mainstock}if(V[ab]=="products"){E="&nbsp;"}B+='<div class="col '+V[ab]+'">'+E+"</div>"}B+='  <div class="clear"></div>';B+="</div>";B+='<div class="body" style="width:'+a+'px">';for(var aa=0;aa<z.length;aa++){var ac=z[aa];if(ac>0&&in_array(produkt_category[ac],map_stock_overview_filter)&&in_array(ac,m)){B+='<div class="line">';for(var ab=0;ab<V.length;ab++){if(V[ab]=="products"){B+='<div class="col '+V[ab]+'">'+htmlProductBody(ac)+"</div>"}else{var l=0;if(!in_array(V[ab],["products",1,2,3,4])&&ad[V[ab]]&&ad[V[ab]][ac]){l=ad[V[ab]][ac]}B+='<div class="col">'+formatNumber(l)+"</div>"}}B+='  <div class="clear"></div>';B+="</div>"}}B+="</div>"}B+="  </div>";B+="</div>";globalcommitbox(r,B,0,0,1);$("globalbox_content").removeClassName("globalbox_content");$("globalbox_content").addClassName("globalbox_content_max_width");hideDiv("globalbox_char");hideDiv("globalbox_footer");var a=$("globalbox").getWidth();$("globalbox").style.marginLeft="-"+(a/2)+"px";$("globalbox").style.top="50px";if(activate10farm==1){$("map_stock_overview_list_products").addEventListener("scroll",function(){$("map_stock_overview_list_farms").scrollTop=$("map_stock_overview_list_products").scrollTop});$("map_stock_overview_list_farms").addEventListener("scroll",function(){$("map_stock_overview_list_farm_header").style.marginLeft=($("map_stock_overview_list_farms").scrollLeft*-1)+"px"})}for(var ac=0;ac<map_stock_overview_filter.length;ac++){if(in_array(map_stock_overview_filter[ac],N)&&$("map_stockoverview_checkbox_"+map_stock_overview_filter[ac])){$("map_stockoverview_checkbox_"+map_stock_overview_filter[ac]).checked=true}}if(map_overview_filter=="stock"){showDiv("map_stock_overview");$("map_overview_tab_stock").addClassName("brown_tab_active")}else{showDiv("map_vehicle_overview");$("map_overview_tab_vehicles").addClassName("brown_tab_active")}mapTimerUpdate()}}function mapVehiclesSelected(){var a=$("map_vehicles_select").value;mapDialog("openVehicleSheet",a)}function mapStockOverviewListHover(b,a){if(a==1){$("map_stock_overview_list_products_"+b).style.backgroundColor="gold";$("map_stock_overview_list_farms_"+b).style.backgroundColor="gold"}else{$("map_stock_overview_list_products_"+b).style.backgroundColor="transparent";$("map_stock_overview_list_farms_"+b).style.backgroundColor="transparent"}}function mapShowTourInfo(){map_overview_filter="vehicles";mapDialog("stock_overview")}function mapGetStockData(){var b={};if(map_current_route>0&&map_current_vehicle>0){var e=farms_data.map.vehicles[map_current_route][map_current_vehicle].current;for(var d in rackCache[e]){for(var h in rackCache[e][d]){var a=rackCache[e][d][h].pid;var c=rackCache[e][d][h].amount;b[a]={};b[a].number=c}}}return b}function mapSetVehicleSlot(a){var b=$("map_vehicle_slot_fill_input").value;if(b<=0){return false}if(!map_vehicle_cart[map_current_vehicle]){map_vehicle_cart[map_current_vehicle]={}}if(!map_vehicle_cart[map_current_vehicle][map_current_vehicle_slot]){map_vehicle_cart[map_current_vehicle][map_current_vehicle_slot]={}}map_vehicle_cart[map_current_vehicle][map_current_vehicle_slot].pid=a;map_vehicle_cart[map_current_vehicle][map_current_vehicle_slot].amount=b;hideDiv("globaltransp");hideDiv("globalbox");mapDialog("openVehicleSheet",map_current_route)}function mapCalcVehicleSlot(d){var h=$("map_vehicle_slot_fill_input").value;h=parseInt(h);if(h<1){h=0}if(h!=""&&isNaN(h)){h=0}var e=mapGetStockData();var b=0;if(e[d]){b=e[d].number}var m=farms_data.map.vehicles[map_current_route][map_current_vehicle].current;if(map_transfer_rest[m]&&map_transfer_rest[m][map_fill_vehicle_slot_filter]&&!in_array(produkt_category[d],["tea","sushi","spicedried","spiceground"])){b=(b-map_transfer_rest[m][map_fill_vehicle_slot_filter])}var c=mapGetCurrentCapacity();var a=farms_data.map.config.vehicles[map_current_vehicle].capacity;var l=(a-c);if(map_vehicle_cart[map_current_vehicle]&&map_vehicle_cart[map_current_vehicle][map_current_vehicle_slot]){var m=map_vehicle_cart[map_current_vehicle][map_current_vehicle_slot].amount;l+=parseInt(m)}if(h>l){h=l}if(h>b){h=b}$("map_vehicle_slot_fill_input").value=h}function mapGetCurrentCapacity(b){if(!b){b=map_current_vehicle}var a=0;for(var c in map_vehicle_cart[b]){a+=parseInt(map_vehicle_cart[b][c].amount)}return a}function mapRemoveVehicleCardItem(c,a){map_current_vehicle=c;for(var b in map_vehicle_cart[map_current_vehicle]){if(map_vehicle_cart[map_current_vehicle][b].pid==a){delete map_vehicle_cart[map_current_vehicle][b]}}mapDialog("openVehicleSheet",map_current_route)}function setMapstockOverviewFilter(b){if(in_array(b,map_stock_overview_filter)){for(var a=0;a<map_stock_overview_filter.length;a++){if(b==map_stock_overview_filter[a]){delete map_stock_overview_filter[a];break}}map_stock_overview_filter.sort}else{map_stock_overview_filter.push(b)}mapDialog("stock_overview");if(b=="alpin"){setMapstockOverviewFilter("tea")}if(b=="water"){setMapstockOverviewFilter("sushi")}}function mapSetVehicleOverviewFilter(){if(map_overview_vehicles_filter==1){map_overview_vehicles_filter=0}else{map_overview_vehicles_filter=1}mapDialog("stock_overview")}function mapCloseVehicleSheet(){map_current_route=0}function closeMap(){hideDiv("map_main")}function mapTimer(){if(farms_data.map&&farms_data.map.vehicles){for(var a in farms_data.map.vehicles){for(var b in farms_data.map.vehicles[a]){farms_data.map.vehicles[a][b].remain--}}}mapTimerUpdate()}function mapTimerUpdate(){if(farms_data.map&&farms_data.map.vehicles){if($("map_vehicle_sheet_current_time")){hideDiv("map_vehicle_sheet_current_time");if(farms_data.map.vehicles[map_current_route]&&farms_data.map.vehicles[map_current_route][map_current_vehicle]){if(farms_data.map.vehicles[map_current_route][map_current_vehicle].remain){$("map_vehicle_sheet_current_time").innerHTML=formatTime(farms_data.map.vehicles[map_current_route][map_current_vehicle].remain);showDiv("map_vehicle_sheet_current_time")}}}for(var n in farms_data.map.vehicles){for(var a in farms_data.map.vehicles[n]){var m=farms_data.map.vehicles[n][a];if($("map_vehiclesheet_tour_item"+n+"_"+a+"timer")){if(m.remain>=0){$("map_vehiclesheet_tour_item"+n+"_"+a+"timer").innerHTML=formatTime(m.remain)}}if(!farm){f=1}else{f=farm}if(m.remain==-1){farmAction("map_update",f,0)}}}if($("map_vehicle_overview")){var e="";for(var n in farms_data.map.vehicles){for(var a in farms_data.map.vehicles[n]){var m=farms_data.map.vehicles[n][a];var h=farms_data.map.config.routes[n].a;if(m.current==h){h=farms_data.map.config.routes[n].b}var b="";var l=0;if(m.remain>0){b=formatTime(m.remain);l=(((m.duration_original-m.remain)*100)/m.duration_original)}var c=1;if(map_overview_vehicles_filter==1&&!m.remain){c=0}if(c==1){e+='<div class="map_vehicle_overview_line">';e+='  <div style="float:left; width:120px; height:45px;"><div style="margin:0 auto;" class="map_vehicle'+a+'_mini"></div></div>';e+='  <div style="float:left; width:50px; font-size:18px; font-weight:bold; color:#C3A75E;">'+m.current+"</div>";e+='  <div style="float:left; position:relative; width:180px; height:12px; border-radius:5px; margin-top:6px; background-color:#C3A75E; overflow:hidden;">';e+='    <div style="position:relative; top:0; left:0; width:'+l+'%; height:12px; background-color:#a88f52;">&nbsp;</div>';e+="  </div>";e+='  <div style="float:left; width:50px; font-size:18px; font-weight:bold; color:#C3A75E;">'+h+"</div>";e+='  <div style="float:left; width:80px; margin-top:5px; text-align:left;">';e+="    <div>"+b+"</div>";if(m.remain>0){e+='<div style="margin-top:5px;" class="speedupgardenbutton link" onclick="hideDiv(\'globalbox\'); globalSpeedupBox(\'map_tour\', 0, '+n+')"></div>'}e+="  </div>";if(m.data){e+='<div style="float:left; width:100px; margin-top:5px; text-align:left;">';for(var d=0;d<m.data.length;d++){e+=htmlProductBody(m.data[d].pid,m.data[d].amount)}e+="</div>"}e+='  <div class="clear"></div>';e+="</div>"}}}$("map_vehicle_overview_inner").innerHTML=e}mapVehicleTours()}}var travel_box_timer_start=0;var travel_box_type="";var travel_box_count="";var travel_destination="";function mapGo2Location(b,d,c,a){travel_box_type=b;travel_box_count=d;if(a!=""&&typeof a!="undefined"){travel_destination=a}hideDiv("lager_info_button");if(train){train.close()}hideDiv("farmdeco_builder");if(b!="farm"&&farmdeco){farmdeco.closeFarmdeco()}else{showDiv("farmdeco_builder")}if(premium||!travelad||c==1||((farm>0&&b=="farm")||(city==d&&b=="city"))){if(b=="forestry"){if(!forestry_unlock||currentuserlevel<mapBlockzones.forestry.level){return false}farm=0;city=0;forestry_quicknavi=1;initForestry()}if(b=="picknick"){if(currentuserlevel<mapBlockzones.picknick.level){return false}farm=0;city=0;foodworld_quicknavi=1;foodworldAction("foodworld_init")}if(b=="city"){if(d==2&&currentuserlevel<mapBlockzones.city2.level){return false}farm=1;city=d;initCity(d)}if(b=="farm"){farm=d;showMain();farmMove(d);hideDiv("farm_speedlinks_farm_list")}if(b=="farmersmarket"){if(!farmersmarket_data||currentuserlevel<mapBlockzones.farmersmarket.level){return false}farm=99;showMain();farmMove(99)}if(b=="farmersmarket2"){if(!farmersmarket_data||currentuserlevel<mapBlockzones.farmersmarket.level){return false}farm=100;showMain();farmMove(100)}if(b=="megafield"){showMain();farm=0;city=0;inguild=0;buildMegafield()}if(b=="guild"){inguild=1;showMain();farmMove(1);initGuild()}if(train&&b=="train"){showMain();farm=0;city=0;train.init()}closeMap();if(!rackCache[farm]&&farm>0){farmAction("updater",farm,1)}else{var e=0;if(farm==5){e=1}sortRackNew(e)}if(travel_destination!=""){if(travel_destination=="cropaction"){cityTravelCropaction()}if(travel_destination=="easterevent"){cityTravelEasterevent()}travel_destination=""}}else{mapTravelStart()}}function cityTravelCropaction(){setTimeout(function(){showDiv("transp3");cropActionAction("cropactioninit")},"500")}function cityTravelEasterevent(){setTimeout(function(){easterevent.init()},"500")}function mapTravelStart(){if(travelad==1){travel_box_timer_start=gametimer_runtime;setTimer("travelbox");var b="city";if(farm>0){b="farm"}setBlockMain(2);showDiv("blockmainnavi");showDiv("globaltransp");showDiv("travel_box");$("travel_box_back").className="travel_"+b+"back min";$("travel_box_timer").innerHTML=formatTime(5);$("travel_box_bus").className="travel_box_bus_"+b+"start min";setTimeout(function(){$("travel_box_bus").addClassName("travel_box_bus_"+b+"move")},100);hideDiv("travel_box_premium");hideDiv("travel_box_ad");if(!tutorial){var a=getRandom(1,3);if(isSteam()){a=1}if(a==1){showDiv("travel_box_premium")}else{showDiv("travel_box_ad")}}}}function mapTravelEnd(){setBlockMain(1);hideDiv("blockmainnavi");clearTimer("travelbox");hideDiv("globaltransp");hideDiv("travel_box");hideDiv("blockmainnavi");mapGo2Location(travel_box_type,travel_box_count,1)}function mapTravelStop(){clearTimer("travelbox");return true}function mapTravelAd(a,b){if(a==1||a==3){if(a==3){b="del_me"}var c={hash:encodeURIComponent(b)};generalAction("watchtravelad",c)}}function mapHelpOpen(){showDiv("map_help_box_transp");showDiv("map_help_box");mapHelpNavi()}function mapHelpClose(){hideDiv("map_help_box_transp");hideDiv("map_help_box")}function mapRackTransfer(){var a=(farm-4);var b=0;if(farms_data.map&&farms_data.map.vehicles&&farms_data.map.vehicles[a]){for(var c in farms_data.map.vehicles[a]){if(farms_data.map.vehicles[a][c].current==farm){b++}}}if(!b){globalerrorbox(str_replace("%FARM%",farm,t_map_transfer_to_main),"mapDialog('openVehicleSheet', "+a+")")}else{mapDialog("openVehicleSheet",a)}}var market_minshop_line=0;function marketAction(d,c,l){if(!c){c=0}if(d=="marketinit"){market_comp=1;market_filter_pid=-1;market_filter_name="";market_filter_own=0;market_guild_filter=0;market_main_navi=1;market_navi=1;hideDiv("marketfilterdelbutton")}if(d=="marketcreateoffer"){var m=market_filter_pid;var h=$("marketnewoffer_amount").value;var q=$("marketnewoffer_price1").value+"."+$("marketnewoffer_price2").value}if(d=="marketupdate"||d=="marketdeloffer"){if(market_filter_pid>-1){m=market_filter_pid}}if(d=="marketcreateoffer_coins"){var m=0;var h=$("marketnewoffer_amount_coins").value;var q=$("marketnewoffer_price_coins").value;var r=market_coinstype}else{if(d=="marketsearch"){var b=$("marketsearch").value}else{if(d=="marketbuyoffer"){if(market_filter_pid>-1){m=market_filter_pid}if(market_offer_id<1){return false}c=market_offer_id;var h=$("marketbuyofferamount").value}else{if(d=="marketfilter"){if(market_filter_name!=""){var b=market_filter_name}if(market_filter_pid>-1){var m=market_filter_pid}else{m=-1}if(market_guild_filter>0){var e=market_guild_filter}if(market_filter_own>0){var s=market_filter_own}}}}}var a="ajax/city.php?rid="+rid+"&mode="+d+"&id="+c;if(m){a+="&pid="+m}if(h){a+="&amount="+h}if(q){a+="&price="+q}if(r){a+="&type="+r}if(e){a+="&guildid="+e}if(b){a+="&name="+encodeURIComponent(b)}if(s){a+="&own="+s}a+="&comp="+market_comp;showGlobalWait(d);var n=createAjaxRequestObj();n.open("GET",a,true);n.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");n.onreadystatechange=function(){marketActionResponse(n,d,c,l)};n.send(null)}function marketActionResponse(c,d,e,b){var a=_chkRequest(c);if(a!=0){hideGlobalWait();market_comp=1;if(a[0]==0){globalerrorbox(a[1])}else{if(a[1]["offers"]){market_offers=a[1]["offers"]}if(a[1]["products"]){market_products=a[1]["products"]}if(a[1]["guild"]){market_guildid=a[1]["guild"]}if(a[1]["bar"]){market_current_bar=a[1]["bar"]}if(a[1]["count"]){market_user_entries=a[1]["count"]}if(a[1]["transfer"]){if(a[1]["transfer"]["msg"]){globalerrorbox(a[1]["transfer"]["msg"])}}if(d=="marketupdate"){if($("marketoffers").style.display=="block"){showOffers(marketlist_currentpage)}}else{showDiv("transp3");showDiv("market");closeMarketNewOffer();showDiv("market_navi");showDiv("marketoffers");hideDiv("market_categories");hideDiv("marketcategories");hideDiv("marketbuyoffer");if(d!="marketfilter"){setMarketNavi(1)}market_offer_id=0;showOffers();if(b>0){market_filter_pid=e;market_filter_own=0;market_guild_filter=0;openMarketNewOffer()}if(d=="marketdeloffer"||d=="marketbuyoffer"||d=="marketcreateoffer"||d=="marketcreateoffer_coins"){}}$("naviitem_tt3").innerHTML=str_replace("%COUNT%",market_user_entries,market_mainnavi3);startMarketTimer()}}return true}function setMarketNavi(b){market_main_navi=b;for(var a=1;a<=6;a++){if($("market_navi"+a)){$("market_navi"+a).removeClassName("market_navi"+a+"_active")}}$("market_navi"+b).addClassName("market_navi"+b+"_active")}var markettimerrun=0;function startMarketTimer(){markettimerrun=0;if(!market_timer.update){market_timer.update=window.setInterval("marketTimer()",1000)}}function marketTimer(){markettimerrun++;if(markettimerrun>=45){markettimerrun=0;$("market_updater_bar").style.left="-100px";marketAction("marketupdate")}else{var a=((markettimerrun/45)*100);$("market_updater_bar").style.left="-"+(100-a)+"px"}}function clearMarketTimer(){if(market_timer){for(var a in market_timer){if(market_timer[a]){window.clearInterval(market_timer[a]);market_timer[a]=0}}}}function closeMarket(){clearMarketTimer();hideDiv("transp3");hideDiv("market")}function showMarketCategory(s,a){if(market_navi==6){market_filter_pid==-1;hideDiv("marketfilterdelbutton");s=1}if(!a){page=1}else{page+=a}if(!s||typeof s=="undefined"){s=market_navi}else{market_navi=s}var e={"1":["v","hr","ex"],"2":["e"],"3":["o"],"4":["fw"],"5":["z"],"6":[0],"7":["fl","fla","md","breed","cow","fish","scouts"],"8":["alpin","tea"],"9":["water","sushi"],"10":["spice","spicedried","spiceground"]};showDiv("market_navi");hideDiv("marketoffers");showDiv("market_categories");showDiv("marketcategories");hideDiv("market_category_arrowright");hideDiv("market_category_arrowleft");var l=0;for(var c in e){l++}for(var c=1;c<=l;c++){if($("market_navi_cat"+c)){$("market_navi_cat"+c).removeClassName("market_cat"+c+"_active")}}$("market_navi_cat"+s).addClassName("market_cat"+s+"_active");if(s==6){market_filter_pid=0;filterMarket();return false}var d="";var r=0;for(var h in market_products){if(in_array(produkt_category[h],e[s])){r++}}var u=0;var t=r;if(r>40){if(page==1||(page*40)<r){showDiv("market_category_arrowright")}if(page>1){u=((page-1)*40);showDiv("market_category_arrowleft")}$("marketcategories").removeClassName("marketcategories").addClassName("marketcategories_pages");t=(page*40)}else{$("marketcategories").removeClassName("marketcategories_pages").addClassName("marketcategories")}var n=market_products;if(s==9&&sushibar){n=sushibar.sortProductsAppear(n)}var l=1;var m=1;for(var h in n){if(h.indexOf("a_")>-1){h=h.replace("a_","")}if(in_array(produkt_category[h],e[s])){if(m>u&&m<=t){var q=checkRackItem(h);d+='<div class="market_pframe link" style="float:left; position:relative; margin-right:3px; margin-bottom:3px;" ';d+='onclick="market_navi='+s+"; market_filter_pid="+h+'; filterMarket();" ';d+="onmouseover=\"showDiv('market_catitem"+h+"')\" onmouseout=\"hideDiv('market_catitem"+h+"')\">";d+='  <div style="position:absolute; top:7px; left:8px;" class="tt'+h+'">';var b="left";if(r<=40&&(l%8==0||l%9==0)){b="right"}else{if(r>40&&(l%7==0||l%8==0)){b="right"}}d+='  <div style="z-index:100; display:none; position:absolute; top:60px; '+b+':0px; white-space:nowrap;" class="ttbox" id="market_catitem'+h+'">';d+=produkt_name[h]+" ("+formatNumber(q?q:0)+")</div>";d+="  </div>";d+="</div>";if((r<40&&l==9)||(r>40&&l==8)){l=1}else{l++}}m++}}d+='<div style="clear:both;"></div>';$("marketcategories").innerHTML=d}function sortOffers(){var c=new Array;if(market_filter_pid>-1){for(var b=0;b<market_offers.length;b++){var a=market_offers[b];if(market_filter_pid==a.p){c.push(a)}}c.sort(function(e,d){if(e.pr==d.pr){return e.id-d.id}return e.pr-d.pr});return c}else{return market_offers}}function showOffers(r){if(market_filter_pid>-1||market_filter_own>0||market_filter_name!=""||market_guild_filter>0){showDiv("marketfilterdelbutton")}if(!r){r=1}marketlist_currentpage=r;var u=((r-1)*marketlist_maxsize);var v=(r*marketlist_maxsize);showDiv("market_navi");showDiv("marketoffers");hideDiv("market_categories");hideDiv("marketcategories");hideDiv("marktoffers_navi_prev");hideDiv("marktoffers_navi_next");hideDiv("market_category_arrowright");hideDiv("market_category_arrowleft");var l="";var q=0;var z=sortOffers();if(z.length<1){$("marktoffers_rows").innerHTML='<div style="text-align:center; padding-top:20px">'+no_offers+"</div>";return false}var e="left";if(setarab){e="right"}hideDiv("marktoffers_self_sum");var w=0;if(market_filter_own==1){for(var h=0;h<z.length;h++){if(z[h].s){w+=(z[h].pr*z[h].a)}}if(w>0){$("marktoffers_self_sum_in").innerHTML=formatPrice(w);showDiv("marktoffers_self_sum")}}for(var h=0;h<z.length;h++){var a=z[h];var c=0;if(market_guild_filter==1){if(a.g!=market_guildid){continue}}if(market_filter_pid>-1){if(a.p==market_filter_pid){c=1}else{c=0}}else{c=1}if(market_filter_name!=""){if(a.no==market_filter_name){c=1}else{c=0}}else{c=1}if(market_filter_own==1){if(!a.s){c=0}}if(c==1){if(q>=u&&q<v){l+='<div style="padding:2px;" onmouseover="this.addClassName(\'market_mark\')" onmouseout="this.removeClassName(\'market_mark\')">';var b=produkt_name[a.p];var n="";if(produkt_price&&produkt_price[a.p]&&market_minshop_line==1){var t=(parseFloat(a.pr)-parseFloat(produkt_price[a.p]*1.1));if(t>0){n=" color:orangered;"}}if(a.p>0){l+='  <div class="kp'+a.p+'" style="float:'+e+';"></div>'}else{l+='<img style="height:15px; width:15px; float:'+e+';" src="'+imgpath+'menu/coins.gif">';b=t_coins}if(a.b){n=" color:orangered;"}l+='  <div title="'+b+'" class="market_product underline link" onclick="market_filter_name=\'\'; market_filter_pid='+a.p+'; filterMarket();" style="'+n+'">'+b+"</div>";var s="";if(a.b){s="important2"}l+='  <div class="market_price '+s+'" onmouseover="showDiv(\'market_price_tt'+a.id+"');\" onmouseout=\"hideDiv('market_price_tt"+a.id+"');\">"+formatPrice(a.pr);if(a.sb){s="important"}l+='    <div id="market_price_tt'+a.id+'" style="z-index:100; border-radius:5px; display:none; position:absolute; top:20px; right:0px; white-space:nowrap;" class="ttbox">'+market_sum+': <span class="'+s+'" style="font-weight:bold">'+formatPrice(a.pr*a.a)+"</span></div>";l+="  </div>";l+='  <div class="market_amount" onmouseover="showDiv(\'market_amount_tt'+a.id+"');\" onmouseout=\"hideDiv('market_amount_tt"+a.id+"');\">"+formatNumber(a.a)+"&nbsp;";l+='    <div id="market_amount_tt'+a.id+'" style="z-index:100; border-radius:5px; display:none; position:absolute; top:20px; right:0px; white-space:nowrap;" class="ttbox">'+market_sum+': <span class="'+s+'" style="font-weight:bold">'+formatPrice(a.pr*a.a)+"</span></div>";l+="  </div>";l+='  <div class="market_seller">&nbsp;<span class="underline link" onclick="market_filter_pid=-1; market_filter_name=\''+a.no+"'; filterMarket();\">"+a.n+"</span>";if(!isSteam()){l+='&nbsp;<img class="link" onclick="window.open(\'schaugarten/index.php?mode=view&user='+a.u+'\')" src="'+imgpath+'stadt/stats_sf.gif">'}l+="</div>";var A="";var d=market_buy;var s="market_carticon";if(a.s){d=market_del;s="market_delicon";A="onclick=\"marketAction('marketdeloffer',"+a.id+')"'}else{if(a.b){s="market_noicon";d=market_block}else{A='onclick="buyMarketOffer('+a.id+')"'}}l+='  <div class="market_buy '+s+' link" '+A+"></div>";l+='  <div style="clear:both;"></div>';l+="</div>"}q++}}$("marktoffers_rows").innerHTML=l;if(r>1){showDiv("marktoffers_navi_prev");$("marktoffers_navi_prev").onclick=new Function("showOffers("+(r-1)+")")}if(r>=market_comp_page){market_comp=0}if(r<market_comp_page){market_comp=1}if(r<Math.ceil(q/marketlist_maxsize)){showDiv("marktoffers_navi_next");$("marktoffers_navi_next").onclick=new Function("showOffers("+(r+1)+")")}}function filterMarket(){if(1==1){marketAction("marketfilter")}else{showOffers()}}function delMarketFilter(){if(1==1){marketAction("marketinit")}else{market_filter_pid=-1;market_filter_own=0;market_filter_name="";market_guild_filter=0;hideDiv("marketfilterdelbutton");showOffers();setMarketNavi(1)}}function openMarketNewOffer(){showOffers();showDiv("market_navi");hideDiv("market_categories");showDiv("market_transp");showDiv("marketnewoffer");hideDiv("market_new_block");hideDiv("market_new_block_coins");hideDiv("marketnewoffersel");hideDiv("marketnewofferlimitreached");showDiv("marketnewoffer_setup");$("marketnewoffer_img").onclick=new Function();$("marketnewoffer_name").onclick=new Function();$("marketnewoffer_img").innerHTML="";$("marketnewoffer_img").className="";hideDiv("marketnewoffer_minprice_block");hideDiv("marketnewoffer_maxprice_block");var c=0;for(var b=0;b<market_offers.length;b++){if(market_offers[b].s){c++}if(c>=20){marketOffersLimitReached();return false}}var d=checkRackItem(market_filter_pid);if(market_filter_pid==0){showDiv("market_new_block_coins");calcMarketPrice()}else{if(!(d>0)){startMarketSelect()}else{showDiv("market_new_block");calcMarketFee();$("marketcreateoffer_stockamount").innerHTML=formatNumber(d);$("marketnewoffer_amount").value=d;$("marketnewoffer_img").className="tt"+market_filter_pid;$("marketnewoffer_name").innerHTML=produkt_name[market_filter_pid];$("marketnewoffer_price1").value=0;$("marketnewoffer_price2").value=0;$("marketnewoffer_fee").innerHTML=0;$("marketnewoffer_img").onclick=new Function("startMarketSelect()");$("marketnewoffer_name").onclick=new Function("startMarketSelect()");$("marketnewoffer_amount").focus()}}var a=produkt_regulation[market_filter_pid];if(a&&a.min>0){$("marketnewoffer_minprice").innerHTML=formatPrice(a.min);showDiv("marketnewoffer_minprice_block")}if(a&&a.max>0){$("marketnewoffer_maxprice").innerHTML=formatPrice(a.max);showDiv("marketnewoffer_maxprice_block")}}function clearMarketFilter(){market_filter_pid=-1;market_filter_own=0;market_filter_name="";market_guild_filter=0;market_main_navi=1}function setMarketFilter(a){if(a=="guild"){if(market_guild_filter==1){market_guild_filter=0;setMarketNavi(1)}else{setMarketNavi(4);market_filter_pid=-1;market_filter_own=0;market_guild_filter=1}}if(a=="own"){if(market_filter_own==1){market_filter_own=0;setMarketNavi(1)}else{setMarketNavi(3);market_guild_filter=0;market_filter_pid=-1;market_filter_own=1}}if(1==1){filterMarket()}else{showOffers()}}function createMarketSel(){html="";var d=0;var c=0;for(var a in market_products){if(checkRackItem(a)&&market_products[a]==1){if(c==0){d=a}c++}}if(c==0&&current_coins<1){$("marketnewoffersel_select").innerHTML='<div style="margin-top:60px; padding:20px">'+market_new_nothingtosell+"</div>";return false}if(market_filter_pid>=0){if(market_filter_pid==0){d=market_filter_pid}else{if(checkRackItem(market_filter_pid)>0){d=market_filter_pid}}}var b=produkt_name[d];if(d==0){b=t_coins}html+='<div style="position:absolute; top:65px; left:50px;">';html+='  <div class="link" onclick="marketControlDiv(\'market_select_list\');" style="float:left; padding:2px; width:185px; border-bottom:1px solid #000; background-color:#fff; color:#000;">';if(d==0){html+='<div style="float:left; margin-right:5px;"><img src="'+imgpath+'menu/coins.gif" style="height:15px; height:15px;"></div>'}else{html+='<div style="float:left; margin-right:5px;" class="kp'+d+'"></div>'}html+='    <div style="float:left;">'+b+"</div>";html+='    <div style="clear:both;"></div>';html+="  </div>";html+='  <div id="market_select_control" class="link" onclick="marketControlDiv(\'market_select_list\');" style="float:left; width:15px; height:20px; background:url('+imgpath+'market/sel_open.gif) no-repeat; background-color:#000;">&nbsp;</div>';html+='  <div style="clear:both;"></div>';html+="</div>";html+='<div style="display:none; position:absolute; top:85px; left:50px; width:204px; height:135px; overflow:auto;" id="market_select_list">';for(var a in market_products){if((checkRackItem(a)>0&&market_products[a]==1)||a==0){var b=produkt_name[a];if(a==0){b=t_coins}html+='<div style="background-color:#fff; padding:2px; color:#000;" onmouseover="this.style.backgroundColor=\'#B39056\'" onmouseout="this.style.backgroundColor=\'#fff\'" onclick="selectMarketProduct('+a+')">';if(a==0){html+='  <img src="'+imgpath+'menu/coins.gif" style="float:left; margin-right:5px; height:15px; width:15px;">'}else{html+='  <div style="float:left; margin-right:5px;" class="kp'+a+'"></div>'}html+='  <div style="float:left;">'+b+"</div>";html+='  <div style="clear:both;"></div>';html+="</div>"}}html+="</div>";$("marketnewoffersel_select").innerHTML=html;hideDiv("marketnewoffer_minprice_block");hideDiv("marketnewoffer_maxprice_block")}function selectMarketProduct(a){market_filter_pid=a;openMarketNewOffer()}function startMarketSelect(){createMarketSel();hideDiv("marketnewofferlimitreached");showDiv("marketnewoffersel");hideDiv("marketnewoffer_setup")}function marketOffersLimitReached(){showDiv("marketnewofferlimitreached");hideDiv("marketnewoffersel");hideDiv("marketnewoffer_setup")}function marketControlDiv(a){if($(a)){if($(a).style.display=="block"){$(a).style.display="none"}else{$(a).style.display="block"}if(a=="market_select_list"){if($(a).style.display=="block"){$("market_select_control").style.backgroundImage="url("+imgpath+"market/sel_close.gif)"}else{$("market_select_control").style.backgroundImage="url("+imgpath+"market/sel_open.gif)"}}}}function calcMarketFee(){if(market_filter_pid<0){}else{var d=market_filter_pid;var c=$("marketnewoffer_amount").value;var n=$("marketnewoffer_price1").value;var m=$("marketnewoffer_price2").value;if(c[0]==0){c=c.substring(1,c.length)}c=parseInt(c);var l=checkRackItem(d);if(l){$("marketcreateoffer_stockamount").innerHTML=formatNumber(l)}if(c>0&&Number(c)){if(c>l){c=l}$("marketnewoffer_amount").removeClassName("market_correctme")}else{$("marketnewoffer_amount").addClassName("market_correctme");c=0}$("marketnewoffer_amount").value=c;var a=n+"."+m;var h=(c*((parseInt(a*1000)/10000)));h=(Math.ceil(h*100)/100);if(isNaN(h)){h=0}$("marketnewoffer_fee").innerHTML=h;var e=0;$("marketnewoffer_minprice").removeClassName("important");$("marketnewoffer_maxprice").removeClassName("important");var b=produkt_regulation[market_filter_pid];if(b){if(b.min>0&&a<b.min){e=1;$("marketnewoffer_minprice").addClassName("important")}if(b.max>0&&a>b.max){e=1;$("marketnewoffer_maxprice").addClassName("important")}}if(h>0&&c>0&&a>0&&!e){showDiv("market_new_button");$("market_new_button").onclick=new Function("closeMarketNewOffer(); marketAction('marketcreateoffer')")}else{hideDiv("market_new_button");$("market_new_button").onclick=new Function()}}}function calcMarketPrice(){var c=$("marketnewoffer_price_coins").value;var h=(c/100)*10;var b=2;market_coinstype=b;if(b==2){if(!isNaN(c)&&parseInt(c)>=parseInt(COINS2KT)){var a=parseInt(c);if(a<18875){var e=a-(a*(a-COINS2KT)*0.00002)}else{var e=0.25*a+7125.31}h=(((a/110)*100)/100)*10;var d=c-e;if(h>d){e=c-h}$("market_new_userprice").innerHTML=Math.round(e)}else{$("market_new_userprice").innerHTML=0}}else{if(!isNaN(c)&&parseInt(c)>=parseInt(COINS2KT)){var a=parseInt(c);if(a<11844){var e=25125-Math.pow(631265625-(a/0.00002),0.5)}else{var e=4*(a-7125.31)}var d=e-a;if(h>d){e=a+h}$("market_new_marketprice").innerHTML=Math.round(e);$("market_new_userprice").innerHTML=Math.round(a)}else{$("market_new_marketprice").innerHTML=0;$("market_new_userprice").innerHTML=0}}if(parseInt(c)>=parseInt(COINS2KT)&&$("marketnewoffer_amount_coins").value>0){showDiv("market_new_button_coins");$("market_new_button_coins").onclick=new Function("marketAction('marketcreateoffer_coins')")}else{hideDiv("market_new_button_coins");$("market_new_button_coins").onclick=new Function()}}function closeMarketNewOffer(){hideDiv("market_transp");hideDiv("marketnewoffer")}function buyMarketOffer(b){for(var a=0;a<market_offers.length;a++){if(b==market_offers[a].id){market_offer_id=b;if(market_offers[a].p>0){$("marketbuyoffer_img").className="tt"+market_offers[a].p;showDiv("marketbuyoffer_productimage");$("marketbuyoffer_name").innerHTML=produkt_name[market_offers[a].p];$("marketbuyoffer_name").style.marginTop="0px"}else{hideDiv("marketbuyoffer_productimage");$("marketbuyoffer_name").innerHTML=t_coins;$("marketbuyoffer_name").style.marginTop="20px"}$("marketbuyoffermarketprice").innerHTML=number_format(market_offers[a].pr,2,set_komma,set_tausender);showDiv("market_transp");showDiv("marketbuyoffer");$("marketbuyofferamount").value=market_offers[a].a;$("marketbuyofferamount").select();calcMarketOfferCost();break}}}function calcMarketOfferCost(){for(var b=0;b<market_offers.length;b++){if(market_offer_id==market_offers[b].id){var a=$("marketbuyofferamount").value;if(parseInt(a)>parseInt(market_offers[b]["a"])){a=market_offers[b]["a"]}$("marketbuyofferprice").innerHTML=formatPrice(market_offers[b]["pr"]*a);$("marketbuyofferamount").value=a;if(a>0&&((a*market_offers[b]["pr"])<=market_current_bar)){$("marketbuyofferbutton").onclick=new Function("closeMarketBuyOffer(); marketAction('marketbuyoffer');");showDiv("marketbuyofferbutton")}else{$("marketbuyofferbutton").onclick=new Function("");hideDiv("marketbuyofferbutton")}}}}function closeMarketBuyOffer(){hideDiv("market_transp");hideDiv("marketbuyoffer")}var mastermind_log=[];var mastermind_buy=[];var mastermind_found=[];var mastermind_remain=0;var mastermind_set=[-1,-1,-1,-1,-1,-1,-1];var mastermind_pos=-1;var mastermind_theme="";function mastermindAction(d){var a="ajax/mastermind.php?";var c="rid="+rid+"&mode="+d;if(d=="check"){for(var b=0;b<mastermind_set.length;b++){if(mastermind_set[b]==-1){globalerrorbox(t_mastermind_chk_all);return false}}var h="";for(var b=0;b<mastermind_set.length;b++){h+=mastermind_set[b]+","}c+="&set="+h;mastermind_set=[-1,-1,-1,-1,-1,-1,-1]}if(d=="buy"){c+="&pos="+mastermind_pos}var e=createAjaxRequestObj();e.open("GET",a+c,true);e.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");e.onreadystatechange=function(){mastermindActionResponse(e,d)};e.send(null)}function mastermindActionResponse(a,h){var q=_chkRequest(a,h);if(q!=0){if(!q[0]){globalerrorbox(q[1])}else{hideDiv("globaltransp");hideDiv("globalbox");if(h=="buy"){mastermindChangeItem(q[1].id);$("mastermind_line_item"+mastermind_pos).innerHTML='<div class="mastermind_log_item_right"></div>';mastermind_buy=q[1].buy;if($("mastermind_buy_coins")){$("mastermind_buy_coins").innerHTML=mastermindGetBuyCoins()}}else{mastermind_set=[-1,-1,-1,-1,-1,-1,-1];mastermind_log=q[1].log;mastermind_theme=q[1].theme;mastermind_remain=q[1].remain;mastermind_buy=q[1].buy;if(q[1].found){mastermind_found=q[1].found}$("mastermind_balls_count").innerHTML=q[1].balls;mastermindStart();if(q[1].reward){var m=t_mastermind_reward_head;var l=t_mastermind_reward_intro;if(q[1].reward.powerup){m=t_mastermind_reward_win_head;l=t_mastermind_reward_win_intro;l+='<div style="margin-top:10px;">'+t_payment_pointsboost_info2.replace("%PERCENT%",2)+"</div>"}if(q[1].reward.points){m=t_mastermind_reward_win_head;l=t_mastermind_reward_win_intro;l+='<div style="margin-top:10px;">'+formatNumber(q[1].reward.points)+"&nbsp;"+t_points+"</div>"}if(q[1].reward.balls_detail){var c=[1,2,0];for(var b=0;b<c.length;b++){var d=c[b];if(q[1].reward.balls_detail[d]){var n="mastermind_log_item_wrong";if(d==1){n="mastermind_log_item_right"}if(d==2){n="mastermind_log_item_ok"}l+='<div style="position:relative; margin:0 auto; width:100px;">';l+=' <div style="float:left; position:relative; margin-right:5px;" class="'+n+'"></div>';l+=' <div style="float:left; margin-top:20px;">';l+='  <div class="mastermind_balls_img '+mastermind_theme+'" style="float:left;"></div>';l+='  <div style="float:left;">&nbsp;'+q[1].reward.balls_detail[d]+"</div>";l+='  <div class="clear"></div>';l+=" </div>";l+=' <div class="clear"></div>';l+="</div>"}}}globalBox(m,l,0,0,1)}hideDiv("mastermind_popup");if(q[1].remain>0){hideDiv("mastermind_popup_solution");if(q[1].set){var e='<div style="margin-bottom:5px; text-align:center;">'+t_mastermind_solution+"</div>";for(var d=0;d<q[1].set.length;d++){e+='<div class="mastermind_log_item mastermind_select_item'+q[1].set[d]+'"></div>'}e+='<div class="clear"></div>';$("mastermind_popup_solution").innerHTML=e;showDiv("mastermind_popup_solution")}showDiv("mastermind_popup")}}if(mastermind_remain>0){hideDiv("mastermind_line");$("mastermind_cooldown_timer").innerHTML=formatTime(mastermind_remain);showDiv("mastermind_cooldown");setTimer("mastermind")}else{showDiv("mastermind_line");hideDiv("mastermind_cooldown");clearTimer("mastermind")}if(q[1].first){mastermindOpenHelp()}}}}function mastermindOpenSelect(){if(mastermind_found[mastermind_pos]&&mastermind_found[mastermind_pos]>0){return false}showDiv("mastermind_select");for(var a=0;a<20;a++){if($("mastermind_line_item"+a+"_active")){hideDiv("mastermind_line_item"+a+"_active")}}showDiv("mastermind_line_item"+mastermind_pos+"_active")}function mastermindCloseSelect(){hideDiv("mastermind_select");for(var a=0;a<20;a++){if($("mastermind_line_item"+a+"_active")){hideDiv("mastermind_line_item"+a+"_active")}}}function mastermindTimer(){mastermind_remain--;if(mastermind_remain<0){mastermindClose()}else{hideDiv("mastermind_line");showDiv("mastermind_cooldown");$("mastermind_cooldown_timer").innerHTML=formatTime(mastermind_remain)}}function mastermindStart(){html="";if(mastermind_log&&mastermind_log.length){for(var c=0;c<mastermind_log.length;c++){html+='<div class="mastermind_log_line">';for(var b=0;b<mastermind_log[c].length;b++){html+='<div class="mastermind_log_item mastermind_select_item'+mastermind_log[c][b].id+'">';var a="mastermind_log_item_wrong";if(mastermind_log[c][b].check==1){a="mastermind_log_item_right"}if(mastermind_log[c][b].check==2){a="mastermind_log_item_ok"}html+='  <div class="'+a+'"></div>';html+="</div>"}html+='<div class="clear"></div>';html+="</div>"}}$("mastermind_log").innerHTML=html;for(var c=0;c<20;c++){if($("mastermind_line_item"+c)){if(mastermind_found&&mastermind_found[c]>-1){mastermind_pos=c;mastermindChangeItem(mastermind_found[c]);$("mastermind_line_item"+c).innerHTML='<div class="mastermind_log_item_right"></div>';$("mastermind_line_item"+c).className="mastermind_line_item link mastermind_select_item"+mastermind_found[c]}else{$("mastermind_line_item"+c).innerHTML='<div id="mastermind_line_item'+c+'_active" class="mastermind_line_item_active"></div>';$("mastermind_line_item"+c).className="mastermind_line_item mastermind_select_item-1 link"}}}mastermind_pos=-1;showDiv("mastermind");showDiv("mastermind_transp");if($("mastermind_buy_coins")){$("mastermind_buy_coins").innerHTML=mastermindGetBuyCoins()}}function mastermindDialog(e){if(e=="buy"){var b=mastermindGetBuyCoins();var d=t_mastermind_buy_position_head;var a=str_replace("%COINS%",b,t_mastermind_buy_position_body);var c="mastermindAction('buy')"}globalcommitbox(d,a,c)}function mastermindGetBuyCoins(){var a=mastermind_coins;if(mastermind_coins_add>0){var c=0;for(var b in mastermind_buy){if(mastermind_buy[b]>-1){c++}}a+=(c*mastermind_coins_add)}return a}function mastermindClose(){hideDiv("mastermind");hideDiv("mastermind_transp")}function mastermindChangeItem(a){$("mastermind_line_item"+mastermind_pos).className="mastermind_line_item link mastermind_select_item"+a;mastermind_set[mastermind_pos]=a;mastermindCloseSelect()}function mastermindOpenHelp(){showDiv("mastermind_help_transp");showDiv("mastermind_help")}function mastermindCloseHelp(){hideDiv("mastermind_help_transp");hideDiv("mastermind_help")}function mastermindOpenShop(){mastermindClose();if(!city){initCity(1)}cityAction("wm_init")}var megafield_data={};var megafield_plant_pid=0;var megafield_plant_cache={};var megafield_cache_time=0;var megafield_vehicle_id=0;var megafield_vehicle_tour=[];var next_possible_tour_tiles=[];var megafield_tour_type="harvest";var megafield_job_remember=0;var megafield_tutorial_remember=0;var megafield_move_position=1;var megafield_stats={};var megafield_stats_cache={};var drive_pos=1;var drive_dir="r";var megafield_insert_block=0;var megafield_tutorial_step=1;var megafield_reward_list_shown=0;var buy_license_block=0;var unlock_bunny=0;var megafield_stats_delay=0;function showTutorialMegafield(){if(megafield_tutorial_step<8){var c=["megafield_vehicle_select_slot","megafield_vehicle1","megafield_tile1","megafield_tile2","megafield_tile3","megafield_tile4","megafield_tile12","megafield_tile13","megafield_tile14","megafield_tile15","megafield_tile_tt1","megafield_tile_tt2","megafield_tile_tt3","megafield_tile_tt4","megafield_tile_tt12","megafield_tile_tt13","megafield_tile_tt14","megafield_tile_tt15","megafield_vehicle_go1","megafield_product0"];for(var b=0;b<c.length;b++){if($(c[b])){$(c[b]).style.zIndex=null}}$("megafield_tutorial_arrow").className="";$("megafield_vehicle_select_slot").onclick=new Function("moveMegafield(1)");$("megafield_vehicle_go1").onclick=new Function("fireTourMegafield()");if($("megafield_product0")){$("megafield_product0").onclick=new Function("setPlantProductMegafield(1)")}$("megafield_tutorial").style.width="100%";$("megafield_tutorial").style.height="100%";var d=t_megafield_tutorial_text[megafield_tutorial_step];if(megafield_tutorial_step==1){$("megafield_vehicle_select_slot").style.zIndex=1000;$("megafield_vehicle_select_slot").onclick=new Function("addTutorialStepMegafield(); moveMegafield(1)")}else{if(megafield_tutorial_step==2){$("megafield_vehicle1").style.zIndex=1000}else{if(megafield_tutorial_step==3){d+="<br>"+str_replace("%COUNT%",megafield_data.vehicle_slots[megafield_vehicle_id].range,t_megafield_tutorial3_2);var e=[1,2,3,4,12,13,14,15];var a=1008;for(var b=0;b<e.length;b++){if($("megafield_tile"+e[b])){$("megafield_tile"+e[b]).style.zIndex=a}if($("megafield_tile_tt"+e[b])){$("megafield_tile_tt"+e[b]).style.zIndex=a}a--}$("megafield_vehicle_go1").style.zIndex=1000}else{if(megafield_tutorial_step==4){$("megafield_tutorial").style.width=0;$("megafield_tutorial").style.height=0}else{if(megafield_tutorial_step==5){$("megafield_product0").style.zIndex=1000;$("megafield_product0").onclick=new Function("addTutorialStepMegafield(), setPlantProductMegafield(1)")}else{if(megafield_tutorial_step==6){megafield_move_position=2;moveMegafield();$("megafield_tutorial").style.width=0;$("megafield_tutorial").style.height=0}else{if(megafield_tutorial_step==7){$("megafield_tutorial").style.width=0;$("megafield_tutorial").style.height=0;d+='<button type="button" class="button_new link" onclick="addTutorialStepMegafield()">'+t_megafield_tutorial_end+"</button>";setTimeout(addTutorialStepMegafield,10000)}}}}}}}$("megafield_tutorial_arrow").className="megafield_tutorial_arrow"+megafield_tutorial_step;$("megafield_tutorial_instructor_bubble").innerHTML=d;showDiv("megafield_tutorial")}else{hideDiv("megafield_tutorial")}}function addTutorialStepMegafield(){megafield_tutorial_step++;if(megafield_tutorial_step==8){farmAction("megafield_closetutorial",1,1)}else{showTutorialMegafield()}}function openHelpMegafield(){showDiv("megafield_transp");showDiv("megafield_help");helpNaviMegafield()}function closeHelpMegafield(){hideDiv("megafield_transp");hideDiv("megafield_help")}function helpNaviMegafield(a){if(!a){a=1}hideDiv("megafield_help1");hideDiv("megafield_help2");hideDiv("megafield_help3");showDiv("megafield_help"+a);$("megafield_help_navi1").removeClassName("megafield_help_navi_active");$("megafield_help_navi2").removeClassName("megafield_help_navi_active");$("megafield_help_navi3").removeClassName("megafield_help_navi_active");$("megafield_help_navi"+a).addClassName("megafield_help_navi_active")}function drive(a){$("vehicle").className="";$("vehicle").addClassName("vehicle_"+megafield_data.tour.vid);$("vehicle").addClassName("vehicle_drive"+drive_pos);$("vehicle").addClassName("vehicle_dir_"+drive_dir)}function moveMegafield(a){if(a==1&&megafield_move_position==2){return false}if(megafield_move_position==1){$("megafield_carpool").removeClassName("megafield_carpool_right");$("megafield_carpool").addClassName("megafield_carpool_left");$("megafield_back").removeClassName("megafield_move_l");$("megafield_back").addClassName("megafield_move_r");megafield_move_position=2}else{$("megafield_carpool").removeClassName("megafield_carpool_left");$("megafield_carpool").addClassName("megafield_carpool_right");$("megafield_back").removeClassName("megafield_move_r");$("megafield_back").addClassName("megafield_move_l");megafield_move_position=1}}function jobEndMegafield(){farmAction("megafield_update",1,1)}function buildMegafield(){if(megafield_data.block){return false}var n="";for(var l=1;l<=99;l++){var u="";var s="";if(!megafield_data.area_free[l]){u="megafield_tile_block"}if(megafield_data.next_tiles&&in_array(l,megafield_data.next_tiles.tiles)){u="megafield_tile_next_unlock";s=str_replace("%COST%",formatNumber(megafield_data.next_tiles.cost),t_megafield_next_tile_tt)}n+='<div id="megafield_tile'+l+'" class="link megafield_tile '+u+'">';n+='  <div id="megafield_tile_cursor'+l+'" class="link"></div>';n+='  <div id="megafield_tile_flyer'+l+'" class="megafield_tile_flyer"></div>';n+='  <div id="megafield_tile_img'+l+'"></div>';n+='  <div id="megafield_tile_tour_arrow'+l+'"></div>';n+='  <div id="megafield_tile_tour'+l+'"></div>';n+='  <div id="megafield_tile_tt'+l+'" class="megafield_tile_tt ttbox">'+s+"</div>";n+="</div>";if(l>1&&l%11==0){n+='<div class="clear"></div>'}}n+='<div id="vehicle"></div>';n+='<div id="megafield_harvest_all_blocker"></div>';$("megafield_area").innerHTML=n;var a=0;if(megafield_data.tour&&megafield_data.tour.remain>0){var q=1;if(megafield_data.vehicle_slots[megafield_data.tour.vid].size==4){q=2}var v=parseInt(megafield_data.tour.duration/megafield_data.tour.count);var t=parseInt(megafield_data.tour.duration-megafield_data.tour.remain);var b=Math.ceil(t/v);var e=0;for(var h=0;h<megafield_data.tour.steps.length;h++){if(b==megafield_data.tour.steps.length){b=(megafield_data.tour.steps.length-1);e=1}if(h==b){var d=h;if(h>0&&!e){d=(h-1)}for(var r in megafield_data.tour.steps[d]){r=parseInt(r);drive_pos=r;var c=drive_dir;if(b<megafield_data.tour.steps.length){for(var m in megafield_data.tour.steps[(d+1)]){if(r+(q*1)==m){c="r"}else{if(r-(q*1)==m){c="l"}else{if(r-(q*11)==m){c="t"}else{if(r+(q*11)==m){c="d"}}}}drive_dir=c;break}}$("vehicle").className="vehicle_"+megafield_data.tour.vid+" vehicle_drive"+r+" vehicle_dir_"+c;showDiv("vehicle");a=1;break}}if(a){break}}if(!megafield_plant_pid&&!megafield_vehicle_id){megafield_vehicle_id=megafield_data.tour.vid}}else{hideDiv("vehicle")}$("megafield_level_number").innerHTML=megafield_data.level;$("megafield_level_bar_inner").style.width=megafield_data.level_percent+"%";$("megafield_level_bar_inner_tt").innerHTML='<div style="font-weight:bold; margin-bottom:5px;">'+t_megafield_level+"</div><div>"+str_replace("%COUNT%",megafield_data.level_rest,t_megafield_require4levelup)+"</div>";showDiv("megafield_level_plus");if(!megafield_data.level_rest){hideDiv("megafield_level_plus");$("megafield_level_bar").onmouseover=new Function("");$("megafield_level_bar").onmouseout=new Function("")}$("megafield_count_number").innerHTML=formatNumber(megafield_data.count);if(megafield_data.job_start==0){if(!megafield_job_remember){dialogMegafield("show_job")}megafield_job_remember=1}setProductsMegafield();setVehiclesMegafield();timerContentMegafield();if(megafield_data.reward){dialogMegafield("reward")}if(!inguild){showDiv("megafield")}showMegafieldHarvestAll();if(megafield_tutorial_step<=99){showTutorialMegafield()}moveBunny();speedLinks();if(megafield_data.achievements){for(var l in megafield_data.achievements){if($("megafield_help_achievement"+l+"_ready")){showDiv("megafield_help_achievement"+l+"_ready")}}}}function closeMegafield(){hideDiv("megafield")}function tileTTMegafield(b,a){if(a){if(megafield_data.area[b]||(megafield_data.next_tiles&&in_array(b,megafield_data.next_tiles.tiles))){showDiv("megafield_tile_tt"+b)}if(!megafield_data.area[b]&&megafield_data.area_free[b]&&megafield_plant_pid>0){$("megafield_tile_cursor"+b).addClassName("megafield_cursor_plant")}if(megafield_vehicle_id>0){$("megafield_tile_cursor"+b).addClassName("megafield_tile_vehicle_size"+megafield_data.vehicle_slots[megafield_vehicle_id].size)}}else{if(megafield_data.area[b]||(megafield_data.next_tiles&&in_array(b,megafield_data.next_tiles.tiles))){hideDiv("megafield_tile_tt"+b)}if(!megafield_data.area[b]&&megafield_data.area_free[b]){$("megafield_tile_cursor"+b).removeClassName("megafield_cursor_plant")}if(megafield_vehicle_id>0){$("megafield_tile_cursor"+b).removeClassName("megafield_tile_vehicle_size"+megafield_data.vehicle_slots[megafield_vehicle_id].size)}}}function timerMegafield(){if(megafield_data){if(megafield_data.area){for(var a=1;a<=99;a++){if(megafield_data.area[a]){megafield_data.area[a].remain--}}}if(megafield_data.harvest_all_remain){megafield_data.harvest_all_remain--}if(megafield_data.tour){megafield_data.tour.remain--}if(megafield_data.job&&megafield_data.job.remain){megafield_data.job.remain--}if($("megafield_tile1")){timerContentMegafield()}}}function timerContentMegafield(){if(megafield_data.tour&&megafield_data.tour.remain<0){megafield_data.tour=0}next_possible_tour_tiles=[];var c=0;for(var J=1;J<=99;J++){$("megafield_tile"+J).onclick=new Function("plantProductMegafield("+J+")");$("megafield_tile"+J).onmouseover=new Function("tileTTMegafield("+J+", 1)");$("megafield_tile"+J).onmouseout=new Function("tileTTMegafield("+J+")");$("megafield_tile_img"+J).className="";$("megafield_tile_flyer"+J).innerHTML="";$("megafield_tile_tour"+J).className="";$("megafield_tile_tour_arrow"+J).className="";$("megafield_tile_tour"+J).innerHTML="";if(megafield_plant_cache[J]){$("megafield_tile_img"+J).className="megafield_tile_loading"}if(megafield_data.area[J]){var M=megafield_data.area[J];var s="<div>"+produkt_name[M.pid]+"</div>";if(M.remain>0){s+=formatTime(M.remain)}else{s+=statusProductionComplete}if(!megafield_vehicle_id){s+='<div class="bonusinfo">'+t_megafield_harvest_need_vehicle+"</div>"}$("megafield_tile_tt"+J).innerHTML=s;var C=M.remain;if(C<0){C=0}var b=(100-((C*100)/M.duration));var w="";if(b>75){w="_3"}else{if(b>35){w="_2"}}$("megafield_tile_img"+J).className="megafield_area_product"+M.pid+w;$("megafield_tile"+J).onclick=new Function("")}if(megafield_data.next_tiles&&in_array(J,megafield_data.next_tiles.tiles)){$("megafield_tile"+J).onclick=new Function("dialogMegafield('buy_tile', "+J+")")}if(!megafield_plant_pid&&megafield_vehicle_id>0){var K=1;if(megafield_data.vehicle_slots[megafield_vehicle_id].size==4){K=2}if(megafield_data.vehicle_slots[megafield_vehicle_id].size==9){K=3}var G=checkTourTileMegafield(J);if(!megafield_vehicle_tour.length&&G==1&&!megafield_data.tour){$("megafield_tile_tour"+J).className="megafield_area_tour_possible";$("megafield_tile"+J).onclick=new Function("setTourTileMegafield("+J+")");next_possible_tour_tiles.push(J)}else{for(var H=0;H<megafield_vehicle_tour.length;H++){if(in_array(J,megafield_vehicle_tour[H])){$("megafield_tile_tour"+J).className="megafield_area_tour";if(megafield_vehicle_tour[(H-1)]){for(var F=0;F<megafield_vehicle_tour[(H-1)].length;F++){var h=megafield_vehicle_tour[(H-1)][F];if((parseInt(J)+(K*1))==h){var B="l"}if((parseInt(J)-(K*1))==h){var B="r"}else{if((parseInt(J)+(K*11))==h){var B="t"}else{if((parseInt(J)-(K*11))==h){var B="d"}}}$("megafield_tile_tour_arrow"+J).className="megafield_tile_tour_arrow_prev_"+B}}$("megafield_tile_tour"+J).innerHTML=(H+1);$("megafield_tile"+J).onclick=new Function("unsetTourTileMegafield("+J+")");break}}}}if(megafield_plant_cache[J]){c++}}if(!megafield_plant_pid&&megafield_vehicle_id>0&&megafield_vehicle_tour.length>0&&!megafield_data.tour){var E=parseInt(megafield_data.vehicle_slots[megafield_vehicle_id].size);if(megafield_data.vehicles[megafield_vehicle_id].durability-E>=0&&megafield_data.vehicles[megafield_vehicle_id].range>0){var n=(megafield_vehicle_tour.length-1);var A=getNextTourTilesMegafield(n);for(var J=0;J<A.length;J++){$("megafield_tile_tour"+A[J]).className="megafield_area_tour_possible";$("megafield_tile"+A[J]).onclick=new Function("setTourTileMegafield("+A[J]+")");next_possible_tour_tiles.push(A[J])}}}if(megafield_data.tour){var d={};if(megafield_data.tour.remain>0){var u=parseInt(megafield_data.tour.duration/megafield_data.tour.count);var a=parseInt(megafield_data.tour.duration-megafield_data.tour.remain);var l=Math.ceil(a/u);$("megafield_vehicle_select_slot_time_time").innerHTML=formatTime(megafield_data.tour.remain);showDiv("megafield_vehicle_select_slot_time");var K=1;if(megafield_data.vehicle_slots[megafield_data.tour.vid].size==4){K=2}if(megafield_data.vehicle_slots[megafield_data.tour.vid].size==9){K=3}for(var I=0;I<megafield_data.tour.steps.length;I++){if((I+1)>=l){var r=0;for(var L in megafield_data.tour.steps[I]){$("megafield_tile_tour"+L).className="megafield_area_tour_next";if(megafield_data.tour.steps[I][L].pid){$("megafield_tile_img"+L).className="megafield_area_product"+megafield_data.tour.steps[I][L].pid;if(!d[megafield_data.tour.steps[I][L].pid]){d[megafield_data.tour.steps[I][L].pid]=1}else{d[megafield_data.tour.steps[I][L].pid]++}}if((I+1)==l){$("megafield_tile_tour"+L).className="megafield_area_tour_current";if((a+1)%u==0){if(megafield_data.tour.steps[I][L].pid&&!megafield_data.area[L]){var O=megafield_data.tour.steps[I][L].pid;tileFlyerMegafield(L,O)}if(!r){if(l<megafield_data.tour.steps.length){for(var q in megafield_data.tour.steps[(I+1)]){drive_pos=parseInt(q);if((parseInt(L)-(K*1))==parseInt(q)){var B="l"}if((parseInt(L)+(K*1))==parseInt(q)){var B="r"}else{if((parseInt(L)-(K*11))==parseInt(q)){var B="t"}else{if((parseInt(L)+(K*11))==parseInt(q)){var B="d"}}}drive_dir=B;drive();r++;break}}}}}if(megafield_data.tour.steps[(I+1)]){for(var q in megafield_data.tour.steps[(I+1)]){if((parseInt(L)-(K*1))==q){var B="l"}if((parseInt(L)+(K*1))==q){var B="r"}else{if((parseInt(L)-(K*11))==q){var B="t"}else{if((parseInt(L)+(K*11))==q){var B="d"}}}$("megafield_tile_tour_arrow"+L).addClassName("megafield_tile_tour_arrow_"+B);break}}}}else{megafield_data.tour.steps[I]={}}}}else{hideDiv("megafield_vehicle_select_slot_time");megafield_data.tour=0;buildMegafield()}if(megafield_data.job_start&&megafield_data.job.products&&megafield_data.job.products.length){var z=1;for(var J=0;J<megafield_data.job.products.length;J++){var M=megafield_data.job.products[J];if(megafield_data.tour.remain>0){if(d[M.pid]&&megafield_data.vehicle_slots[megafield_data.tour.vid].type=="harvest"){$("megafield_product_have"+M.pid).innerHTML=(M.have-d[M.pid])}}else{$("megafield_product_have"+M.pid).innerHTML=M.have}var N=parseInt($("megafield_product_have"+M.pid).innerHTML);if(M.need<=N){showDiv("megafield_product_ready"+J)}else{hideDiv("megafield_product_ready"+J)}if(N!=M.need){z=0}}if(z==1){jobEndMegafield()}}}else{if(megafield_tutorial_step==4){addTutorialStepMegafield()}}for(var J in megafield_data.vehicle_slots){var t=megafield_data.vehicle_slots[J];var e="";if(t.block){var D=""}else{if(t.unlockable){var D="dialogMegafield('vehicle_unlock', 0, "+J+");"}else{if(!megafield_data.vehicles||!megafield_data.vehicles[J]){var D="dialogMegafield('vehicle_buy', 0, "+J+");";e="<div>"+t_megafield_tt_buy_vehicle+"</div>"}else{if(megafield_data.vehicles&&megafield_data.vehicles[J]){if(megafield_data.tour&&megafield_data.tour.remain>0){if(megafield_data.tour.vid==J){e=t_megafield_tt_tour_resttime+formatTime(megafield_data.tour.remain)}else{e=t_megafield_tt_tour_block}var D=""}else{e=t_megafield_tt_start_tour;var D="setTourVehicleMegafield("+J+");"}}}}}if(megafield_tutorial_step==2&&J==1){D+=" addTutorialStepMegafield();"}$("megafield_vehicle"+J).onclick=new Function(D);if(e!=""){$("megafield_vehicle_tt_bonus"+J).innerHTML=e}}if(megafield_tutorial_step!=1){$("megafield_vehicle_select_slot").onclick=new Function("moveMegafield(1)")}if(megafield_vehicle_id>0){if(megafield_plant_pid>0){showDiv("megafield_vehicle_select_slot_x");$("megafield_vehicle_select_slot").onclick=new Function("megafield_plant_pid=0; setProductsMegafield(); timerContentMegafield();")}else{hideDiv("megafield_vehicle_select_slot_x")}}else{hideDiv("megafield_vehicle_select_slot_x")}if(megafield_data.job){if(megafield_data.job.remain&&megafield_data.job.remain>0){showDiv("megafield_reward_icon");$("megafield_job_timer_inner").innerHTML=formatTime(megafield_data.job.remain);if($("megafield_job_reward_info_timer")){$("megafield_job_reward_info_timer").innerHTML=formatTime(megafield_data.job.remain)}}else{hideDiv("megafield_reward_icon");$("megafield_job_timer_inner").innerHTML=t_megafield_data_job_timeout;if(megafield_data.job.remain==0){jobEndMegafield()}}}if(megafield_tutorial_step==3){if(megafield_vehicle_tour.length>0){$("megafield_tutorial_arrow").className="megafield_tutorial_arrow3_2"}else{$("megafield_tutorial_arrow").className="megafield_tutorial_arrow3"}}if(megafield_data.harvest_all_remain>0){showDiv("megafield_harvest_all_blocker");$("megafield_harvest_all_blocker").innerHTML=formatTime(megafield_data.harvest_all_remain)}else{hideDiv("megafield_harvest_all_blocker")}if(c>0){if(megafield_cache_time>=1){fireCacheMegafield();megafield_cache_time=0}megafield_cache_time++}}function tileFlyerMegafield(b,a){setTimeout(function(){$("megafield_tile_flyer"+b).innerHTML='<div class="kp'+a+'"></div>';$("megafield_tile_flyer"+b).addClassName("megafield_tile_flyer_out");if(megafield_tutorial_step==4){addTutorialStepMegafield()}},1000)}function chkInsertAmountMegafield(a,b){var c={stockamount:checkRackItem(a),rest:b,click:"farmAction('megafield_insert', 1, 1, "+a+")"};checkEntryLine(c)}function dialogMegafield(B,J,H,z,v){var b=0;var m=0;if(B=="fertilize_all"){var c=t_megafield_fertilize_all_head;var l="<div>"+str_replace("%COINS%",megafield_data.harvest_fertilize_coins,t_megafield_fertilize_all_body)+"</div>";l+='<div style="margin-top:10px;">'+str_replace("%TIME%",formatTime(megafield_data.constants.fertilize_all_duration),t_megafield_fertilize_all_info)+"</div>";var w="farmAction('megafield_fertilize_all', 1, 1)"}if(B=="harvest_all"){var c=crop_all_tttext;var l="<div>"+str_replace("%COINS%",megafield_data.harvest_all_coins,t_megafield_harvest_all_body)+"</div>";l+='<div style="margin-top:10px;">'+str_replace("%TIME%",formatTime(megafield_data.constants.harvest_all_duration),t_megafield_harvest_all_info)+"</div>";var w="farmAction('megafield_harvest_all', 1, 1)"}if(B=="insert"){var s=0;for(var E=0;E<megafield_data.job.products.length;E++){if(megafield_data.job.products[E].pid==v){s=(megafield_data.job.products[E]["need"]-megafield_data.job.products[E]["have"])}}var I={pid:v};globalcommitbox(t_inner_feedsubmit,htmlEntryLine(I),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("chkInsertAmountMegafield("+v+", "+s+")");$("dialog_entryline_number").onkeyup=new Function("chkInsertAmountMegafield("+v+", "+s+")");chkInsertAmountMegafield(v,s);return false}if(B=="reward"||B=="reward_list"){if(B=="reward"&&megafield_reward_list_shown>0){return false}var c=t_megafield_new_jobs_reward_head;var l="";if(B=="reward"){var K=megafield_data.reward}else{var K=megafield_data.reward_info}var D=(K.points-(K.difficultybonus_points+K.timebonus_points));var L=(K.money-(K.difficultybonus_money+K.timebonus_money));var n=(K.license-(K.difficultybonus_license+K.timebonus_license));var d=(K.points-D);var F=(K.money-L);var h=(K.license-n);if(d>0||F>0||h>0){l+='<div style="font-weight:bold;">'+t_megafield_reward_basic+"</div>";l+='<div style="padding:5px;">';l+='  <div class="megafield_points_icon" style="float:left;"></div><div style="float:left; margin-top:15px; margin-right:20px; width:120px;">'+formatNumber(D)+"&nbsp;"+t_points+"</div>";l+='  <div class="megafield_money_icon" style="float:left;"></div><div style="float:left; margin-top:15px; margin-right:20px; width:120px;">'+formatPrice(L)+"</div>";l+='  <div class="megafield_license_icon" style="float:left;"></div><div style="float:left; margin-top:15px; width:120px;">'+formatNumber(n)+"&nbsp;"+t_megafield_currency+"</div>";l+='  <div class="clear"></div>';l+="</div>";l+='<div style="margin-top:10px; font-weight:bold;">'+t_megafield_reward_bonus+"</div>";l+='<div style="padding:5px;">';l+='  <div class="megafield_points_icon" style="float:left;"></div><div style="float:left; margin-top:15px; margin-right:20px; width:120px;">'+formatNumber(d)+"&nbsp;"+t_points+"</div>";l+='  <div class="megafield_money_icon" style="float:left;"></div><div style="float:left; margin-top:15px; margin-right:20px; width:120px;">'+formatPrice(F)+"</div>";l+='  <div class="megafield_license_icon" style="float:left;"></div><div style="float:left; margin-top:15px; width:120px;">'+formatNumber(h)+"&nbsp;"+t_megafield_currency+"</div>";l+='  <div class="clear"></div>';l+="</div>"}l+='<div style="margin-top:10px; font-weight:bold;">'+t_megafield_reward_sum+"</div>";l+='<div style="background-color:#C3A75E; border-radius:5px; padding:5px;">';l+='  <div class="megafield_points_icon" style="float:left;"></div><div style="float:left; margin-top:15px; margin-right:20px; width:120px;">'+formatNumber(K.points)+"&nbsp;"+t_points+"</div>";l+='  <div class="megafield_money_icon" style="float:left;"></div><div style="float:left; margin-top:15px; margin-right:20px; width:120px;">'+formatPrice(K.money)+"</div>";l+='  <div class="megafield_license_icon" style="float:left;"></div><div style="float:left; margin-top:15px; width:120px;">'+formatNumber(K.license)+"&nbsp;"+t_megafield_currency+"</div>";l+='  <div class="clear"></div>';l+="</div>";if(B=="reward"){megafield_reward_list_shown=1;var w="dialogMegafield('show_job')";var m="dialogMegafield('show_job')"}}if(B=="vehicle_unlock"){var c=t_megafield_vehicle_unlock_head;var l=str_replace("%AMOUNT%",megafield_data.vehicle_slots[H].unlock,t_megafield_vehicle_unlock_body);var w="farmAction('megafield_vehicle_unlock', 1, 1, "+H+")"}if(B=="vehicle_buy"){var c=t_megafield_vehicle_buy_head;if(megafield_data.vehicle_slots[H].coins){var G=megafield_data.vehicle_slots[H].coins+"&nbsp;"+t_coins}if(megafield_data.vehicle_slots[H].money){var G=formatPrice(megafield_data.vehicle_slots[H].money)}if(megafield_data.vehicle_slots[H].license){var G=megafield_data.vehicle_slots[H].license+"&nbsp;"+t_megafield_currency}var l='<div style="margin-bottom:5px;">'+str_replace("%COST%",G,t_megafield_vehicle_buy_body)+"</div>";if(megafield_data.vehicle_slots[H].products){l+='<div style="margin-bottom:5px;">'+lotterylotsrequired+"</div>";for(var v in megafield_data.vehicle_slots[H].products){l+='<div style="margin-bottom:5px; margin-left:30px;">';l+='  <div class="kp'+v+'" style="float:left; margin-right:5px;"></div>';l+='  <div style="float:left;">'+megafield_data.vehicle_slots[H].products[v]+"x&nbsp;"+produkt_name[v]+"</div>";l+='  <div class="clear"></div>';l+="</div>"}}var w="farmAction('megafield_vehicle_buy', 1, 1, "+H+")"}if(B=="buy_license"||B=="buy_license_confirm"){if(!buy_license_block){var c=t_megafield_buy_license_head;var t=str_replace("%COINS%",megafield_data.exchangecoins,t_megafield_buy_license_body);t=str_replace("%AMOUNT%",(megafield_data.constants.exchange_licences*megafield_data.level),t);var l=t;var w="farmAction('megafield_buylicense', 1, 1);"}}if(B=="level_plus"){var c=t_megafield_level_plus_head;var l=htmlLevelAddDialog("megafield");var w=0;b=1}if(B=="buy_tile"){var c=t_megafield_buytile_head;var l=str_replace("%AMOUNT%",formatNumber(megafield_data.next_tiles.cost),t_megafield_buytile_body);var w="farmAction('megafield_buytile', 1, 1, "+J+")"}if(B=="show_job"){var c="";var l='<div style="position:relative; height:365px;">';l+='  <div class="headline" style="margin-top:-20px;">'+t_farmersmarket_job_select_products+"</div>";for(var E=0;E<megafield_data.job.options[1].length;E++){var K=megafield_data.job.options[1][E];l+='<div style="position:relative; float:left; margin-right:10px;" class="market_pframe">';l+='  <div style="position:absolute; top:6px; left:8px;" class="tt'+K.pid+'" onmouseover="showDiv(\'megafield_showjob_p'+K.pid+"');\" onmouseout=\"hideDiv('megafield_showjob_p"+K.pid+"');\">";l+='    <div id="megafield_showjob_p'+K.pid+'" class="ttbox" style="left:-5px; top:60px; width:95px;">';l+='      <div style="font-weight:bold;">'+produkt_name[K.pid]+"</div>";if(K.duration){l+="<div>"+formatTime(K.duration)+"</div>";var r=str_replace("%AMOUNT%",K.amount,t_megafield_one_field_needs);r=str_replace("%PRODUCT%",produkt_name[K.pid],r);l+='      <div style="margin-top:5px;">'+r+"</div>"}l+='<div style="margin-top:5px;">';for(var C=3;C>=1;C--){for(var A=0;A<megafield_data.job.options[C].length;A++){if(megafield_data.job.options[C][A].pid==K.pid){l+='<div style="margin-bottom:2px;">'+t_difficulty[C]+": "+megafield_data.job.options[C][A].need+"x</div>"}}}l+="</div>";l+="    </div>";l+="  </div>";l+="</div>"}l+='  <div style="float:left; margin-left:20px; width:111px; text-align:center; height:19px; background:url('+imgpath+'megafield_jobtimer_box.png); padding:13px 0 0 0;">'+formatTime(megafield_data.constants.job_duration)+"</div>";l+='  <div style="float:right;" class="megafield_job_gamble link" onclick="dialogMegafield(\'gamblejob\')" onmouseover="showDiv(\'megafield_job_gamble_tt\');" onmouseout="hideDiv(\'megafield_job_gamble_tt\');">';l+='    <div id="megafield_job_gamble_tt" class="ttbox">'+str_replace("%COINS%",megafield_data.constants.gamble_jobs,t_megafield_data_get_new_jobs)+"</div>";l+="  </div>";l+='  <div class="clear"></div>';l+='  <div class="headline" style="margin-top:20px;">'+t_farmersmarket_job_select_difficulty+"</div>";for(var q=3;q>=1;q--){l+='<div style="position:relative; float:left; margin-right:15px; width:150px;">';l+='  <div class="headline">'+t_difficulty[q]+"</div>";l+='  <div style="background-color:#C3A75E; border-radius:10px; padding:10px;">';l+='    <div class="megafield_money_icon" style="float:left; margin-right:5px;"></div><div style="float:left; margin-top:15px; width:75px;">'+formatPrice(megafield_data.job.reward[q].money)+'</div><div class="clear"></div>';l+='    <div class="megafield_points_icon" style="float:left; margin-right:5px;"></div><div style="float:left; margin-top:15px; width:75px;">'+formatNumber(megafield_data.job.reward[q].points)+"&nbsp;"+t_points+'</div><div class="clear"></div>';l+='    <div class="megafield_license_icon" style="float:left; margin-right:5px;"></div><div style="float:left; margin-top:15px; width:75px;">'+formatNumber(megafield_data.job.reward[q].license)+"&nbsp;"+t_megafield_currency+'</div><div class="clear"></div>';l+='    <div class="megafield_job_ok_button link" onclick="farmAction(\'megafield_selectjob\', 1, 1, '+q+')">'+t_megafield_job_select+"</div>";l+="  </div>";l+="</div>"}l+='  <div class="clear"></div>';l+="</div>";var w="";b=1}if(B=="gamblejob"){var c=t_megafield_new_jobs_head;var l=str_replace("%COINS%",megafield_data.constants.gamble_jobs,t_megafield_data_get_new_jobs);var w="farmAction('megafield_gamblejob', 1, 1)";m="dialogMegafield('show_job')"}if(B=="tutorial"){var c="TUTORIAL";var l="WAS MACH ICH DENN HIER?";m="dialogMegafield('show_job')";b=1;megafield_tutorial_remember=1}if(B=="stats"){var e="";e+='<div id="megafield_stats_select_line">';e+='  <select id="megafield_stats_select" onchange="openStatsMegafield()">';var a=["license","job3","job2","job1","tiles"];for(var E=0;E<a.length;E++){var u="";if(z==a[E]){u="selected"}e+='<option value="'+a[E]+'" '+u+">"+t_megafield_stats[a[E]].opt+"</option>"}e+="  </select>";e+="</div>";e+='<div class="headline" style="margin-top:10px;">'+t_megafield_stats[z].head+"</div>";e+='<div id="megafield_stats_ranking">';e+=htmlStatsContent(megafield_stats.ranking);$("megafield_stats_inner").innerHTML=e;showDiv("megafield_transp");showDiv("megafield_stats");return false}if(B=="autoplant"){var c=autoplant_headline;var l='<div style="margin:0 auto; margin-bottom:5px;" class="tt'+v+'"></div>';l+="<div>"+autoplant_select+"</div>";var w="farmAction('megafield_autoplant', 1, 1, "+v+")"}globalcommitbox(c,l,w,m,b);if(B=="show_job"||B=="reward_list"||B=="reward"){globalBoxFlex(c,l,w,m,b);if(B=="show_job"){$("globalbox").style.top="45px"}}else{globalcommitbox(c,l,w,m,b)}}function megafieldCheckLevelAdd(){var a=$("megafield_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>megafield_data.count){a=megafield_data.count}$("megafield_dialog_leveladd_insert").value=a}function openStatsMegafield(){if(!$("megafield_stats_select")){var a="license"}else{var a=$("megafield_stats_select").value}if(megafield_stats_cache[a]){megafield_stats=megafield_stats_cache[a]}if(megafield_stats_delay<=0||!megafield_stats_cache[a]){farmAction("megafield_stats",1,1,a)}else{dialogMegafield("stats",0,0,a)}}function setProductsMegafield(){var c="";if(megafield_data.job_start&&megafield_data.job.products&&megafield_data.job.products.length){for(var b=0;b<megafield_data.job.products.length;b++){var e=megafield_data.job.products[b];var d="";if(checkRackItem(e.pid)>=e.amount){d="setPlantProductMegafield("+e.pid+")"}if(!e.duration){d="dialogMegafield('insert', 0, 0, 0, "+e.pid+")"}var a="";if(megafield_plant_pid==e.pid){a="megafield_product_select"}if(e.need<=e.have){d=""}c+='<div id="megafield_product'+b+'" class="megafield_product link" onmouseover="showDiv(\'megafield_product_tt'+b+"')\" onmouseout=\"hideDiv('megafield_product_tt"+b+'\')" onclick="'+d+'">';c+='  <div style="position:absolute; top:7px; left:8px; width:44px; height:46px; overflow:hidden;">';c+='    <div style="position:absolute; top:-3px; left:-5px; width:50px; height:50px;" class="tt'+e.pid+'"></div>';c+="  </div>";c+='  <div id="megafield_product_ready'+b+'" class="megafield_product_ready"></div>';c+='  <div style="position:absolute; top:0px; left:0px;" class="link '+a+'"></div>';c+='  <div style="z-index:20; position:absolute; top:25px; left:65px; width:70px; text-align:center;"><span id="megafield_product_have'+e.pid+'">'+e.have+"</span>/"+e.need+"</div>";c+='  <div id="megafield_product_tt'+b+'" class="megafield_product_tt ttbox">';c+='    <div style="font-weight:bold;">'+produkt_name[e.pid]+"</div>";if(e.duration){c+='    <div style="margin:5px 0;">'+formatTime(e.duration)+"</div>";var h=str_replace("%AMOUNT%",e.amount,t_megafield_one_field_needs);h=str_replace("%PRODUCT%",produkt_name[e.pid],h)}else{h=t_megafield_noplant_info}if(checkRackItem(e.pid)<e.amount){h+='<div class="important" style="margin-top:5px;">'+str_replace("%PRODUCT%",produkt_name[e.pid],t_megafield_plant_need_product)+"</div>"}c+="    <div>"+h+"</div>";c+="  </div>";if(checkRackItem(e.pid)>=e.amount&&e.duration&&premium==1){c+='<div style="position:absolute; bottom:10px; right:77px;" class="autoplantbutton link" onclick="dialogMegafield(\'autoplant\', 0, 0, 0, '+e.pid+');"></div>'}c+="</div>"}c+='<div class="clear"></div>';showDiv("megafield_job_timer")}else{c+='<div class="link" id="megafield_new_job" onmouseover="showDiv(\'megafield_new_job_tt\')" onmouseout="hideDiv(\'megafield_new_job_tt\')" onclick="dialogMegafield(\'show_job\')">';c+='  <div id="megafield_new_job_tt" class="ttbox">'+t_megafield_new_job_tt+"</div>";c+="</div>";hideDiv("megafield_job_timer")}$("megafield_products").innerHTML=c;if(megafield_data.job_start&&megafield_data.job.products&&megafield_data.job.products.length){for(var b=0;b<megafield_data.job.products.length;b++){var e=megafield_data.job.products[b];if(e.have==e.need){showDiv("megafield_product_ready"+b)}}}}function setPlantProductMegafield(a){if(!a||megafield_plant_pid==a){megafield_plant_pid=0}else{for(var b=0;b<megafield_data.job.products.length;b++){if(megafield_data.job.products[b].pid==a&&megafield_data.job.products[b].need<=megafield_data.job.products[b].have){return false}}megafield_plant_pid=a}fireCacheMegafield();setProductsMegafield();timerContentMegafield()}function plantProductMegafield(e){if(megafield_plant_pid>0&&!megafield_plant_cache[e]&&megafield_data.area_free[e]){if(megafield_data.tour&&megafield_data.tour.steps){for(var d=0;d<megafield_data.tour.steps.length;d++){for(var l in megafield_data.tour.steps[d]){if(l==e){return false}}}}var q=0;for(var c in megafield_plant_cache){q++}for(var d=0;d<megafield_data.job.products.length;d++){if(megafield_data.job.products[d].pid==megafield_plant_pid){var h=megafield_data.job.products[d].amount;if(!(checkRackItem(megafield_plant_pid)>=h)){megafield_plant_pid=0;setProductsMegafield();return false}var s=0;for(var b in megafield_data.area){if(megafield_data.area[b].pid==megafield_plant_pid){s++}}var a=(megafield_data.job.products[d].need-(megafield_data.job.products[d].have+s+q));if(a<=0){megafield_plant_pid=0;setProductsMegafield();globalerrorbox(t_megafield_no_plant_necassary);return false}var r=checkRackItem(megafield_plant_pid);r--;setRackItem(megafield_plant_pid,r);megafield_plant_cache[e]=megafield_plant_pid;$("megafield_tile_img"+e).className="megafield_tile_loading";break}}}}function fireCacheMegafield(){if(megafield_tutorial_step==6){var b=0;for(var a in megafield_plant_cache){b++}if(b>0){addTutorialStepMegafield()}}farmAction("megafield_plant",1,1);megafield_plant_cache={}}function setVehiclesMegafield(){var d="";$("megafield_vehicle_select_slot_durability").innerHTML="";for(var b in megafield_data.vehicle_slots){var n=megafield_data.vehicle_slots[b];var h='<div style="font-weight:bold">'+n.name+"</div>";h+='<div style="margin:5px 0;" class="bonusinfo">'+t_megafield_vehicle_info[megafield_data.vehicle_slots[b].type]+"</div>";var u="";var q="";var e="";var a=n.durability;var m=100;if(megafield_data.vehicles&&megafield_data.vehicles[b]){a=megafield_data.vehicles[b].durability;m=((a*100)/n.durability);q='<span id="megafield_vehicle_durability'+b+'">'+megafield_data.vehicles[b].durability+"<span>/";e='<span id="megafield_vehicle_range'+b+'">'+megafield_data.vehicles[b].range+"<span>/"}q+=n.durability;var r="";var t="margin:0 auto;";if(megafield_vehicle_id==b&&m<=50){t=""}r+='<div style="position:relative; left:2px; width:115px; margin-top:2px;">';r+='  <div style="width:80px; height:10px; background-color:#000; border-radius:4px; overflow:hidden; '+t+'">';r+='    <div style="width:'+m+"%; height:10px; background:url("+imgpath+'blue_bar.jpg) 0px 18px;"></div>';r+="  </div>";r+="</div>";if(megafield_vehicle_id==b){if(m<=50){r+='<div id="megafield_vehicles_fuel_button" class="fuel" onclick="fuelVehicleMegafield()" onmouseover="showDiv(\'megafield_fuel_vehicle_tt\')" onmouseout="hideDiv(\'megafield_fuel_vehicle_tt\')">';r+="  <div>+</div>";r+='  <div id="megafield_fuel_vehicle_tt" class="ttbox">'+t_megafield_fuel_vehicle+"</div>";r+="</div>"}$("megafield_vehicle_select_slot_durability").innerHTML=r}e+=n.range;if(megafield_data.vehicle_slots[b].duration){h+="<div>"+t_megafield_drivetime+"&nbsp;"+formatTime(megafield_data.vehicle_slots[b].duration)+"</div>"}h+="<div>"+t_megafield_vehicle_range+e+"</div>";h+='<div style="float:left; margin-right:5px;">'+t_megafield_vehicle_durability+"</div>";h+='<div style="float:left; width:100px; height:10px; background-color:#000; border-radius:4px; overflow:hidden; margin-top:2px;">';h+='  <div style="width:'+m+"%; height:10px; background:url("+imgpath+'blue_bar.jpg) 0px 18px;"></div>';h+="</div>";h+='<div style="float:left; margin-left:5px;">'+q+"</div>";h+='<div class="clear"></div>';h+="<div>"+t_megafield_vehicle_size+n.size+"</div>";if(megafield_data.vehicle_slots[b].reduce){h+="<div>"+t_pony_speedup_dialog_speeduptime+"&nbsp;"+formatTime(megafield_data.vehicle_slots[b].reduce)+"</div>"}h+='<div style="float:left;">'+cityadcost+'</div><div style="margin-left:5px; float:left;">';if(megafield_data.vehicle_slots[b].coins){h+="<div>"+megafield_data.vehicle_slots[b].coins+"&nbsp;"+t_coins+"</div>"}if(megafield_data.vehicle_slots[b].money){h+="<div>"+formatPrice(megafield_data.vehicle_slots[b].money)+"</div>"}if(megafield_data.vehicle_slots[b].license){h+="<div>"+megafield_data.vehicle_slots[b].license+"&nbsp;"+t_megafield_currency+"</div>"}if(megafield_data.vehicle_slots[b].products){for(var c in megafield_data.vehicle_slots[b].products){h+='<div style="margin-top:2px;">';h+='  <div style="float:left; margin-right:5px;" class="kp'+c+'"></div>';h+='  <div style="float:left;">'+megafield_data.vehicle_slots[b].products[c]+"x&nbsp;"+produkt_name[c]+"</div>";h+='  <div class="clear"></div>';h+="</div>"}}h+='</div><div class="clear"></div>';var l="megafield_vehicle_pos"+b;if(megafield_vehicle_id==b){l="megafield_vehicle_selected"}d+='<div class="'+l+'">';d+='  <div id="megafield_vehicle'+b+'" class="link megafield_vehicle'+b+'" onmouseover="showDiv(\'megafield_vehicle_tt'+b+"')\" onmouseout=\"hideDiv('megafield_vehicle_tt"+b+"')\">";if(n.block){d+='<div class="megafield_vehicle_block"></div>';u+='<div class="important" style="margin-top:10px;">'+str_replace("%LEVEL%",n.level,t_megafield_unlockable_level)+"</div>";u+='<div style="margin-top:10px;">'+str_replace("%AMOUNT%",n.unlock,t_megafield_need_license)+"</div>"}else{if(n.unlockable){d+='<div class="megafield_vehicle_unlock"></div>';u+='<div style="margin-top:10px;">'+str_replace("%AMOUNT%",n.unlock,t_megafield_unlockable)+"</div>"}else{if(!megafield_data.vehicles||!megafield_data.vehicles[b]){d+='<div class="megafield_lock_open lock_open"></div>';u+="<div>"+t_megafield_tt_buy_vehicle+"</div>"}else{if(megafield_data.tour&&megafield_data.tour.remain>0){u=t_megafield_tt_tour_block}if((megafield_data.tour&&(megafield_data.tour.remain<=0||!megafield_data.tour.remain))){u=t_megafield_tt_start_tour}}}}d+='    <div id="megafield_vehicle_tt'+b+'" class="ttbox megafield_vehicle_tt">'+h+'<div id="megafield_vehicle_tt_bonus'+b+'" class="bonusinfo">'+u+"</div></div>";d+="  </div>";var s="fireTourMegafield();";if(megafield_tutorial_step==3&&b==1){s+=" addTutorialStepMegafield();"}d+='  <div id="megafield_vehicle_go'+b+'" class="megafield_vehicle_go link" onmouseover="showDiv(\'megafield_vehicle_go_tt'+b+"')\" onmouseout=\"hideDiv('megafield_vehicle_go_tt"+b+'\')" onclick="'+s+'">';d+='    <div id="megafield_vehicle_go_tt'+b+'" class="megafield_vehicle_go_tt ttbox">'+t_megafield_vehicle_go_tt+"</div>";d+="  </div>";d+='  <div id="megafield_vehicle_cancel'+b+'" class="megafield_vehicle_cancel link" onmouseover="showDiv(\'megafield_vehicle_cancel_tt'+b+"')\" onmouseout=\"hideDiv('megafield_vehicle_cancel_tt"+b+'\')" onclick="setTourVehicleMegafield(0)">';d+='    <div id="megafield_vehicle_cancel_tt'+b+'" class="megafield_vehicle_cancel_tt ttbox">'+t_megafield_vehicle_cancel_tt+"</div>";d+="  </div>";d+="</div>"}$("megafield_vehicles").innerHTML=d;for(var b in megafield_data.vehicle_slots){hideDiv("megafield_vehicle_go"+b);hideDiv("megafield_vehicle_cancel"+b)}if(megafield_vehicle_tour.length>0&&megafield_vehicle_id>0){showDiv("megafield_vehicle_go"+megafield_vehicle_id);showDiv("megafield_vehicle_cancel"+megafield_vehicle_id)}if(megafield_vehicle_id>0){if(megafield_vehicle_tour.length>0){hideDiv("megafield_vehicles_fuel_button")}else{showDiv("megafield_vehicles_fuel_button")}}}function fuelVehicleMegafield(){if(megafield_vehicle_id>0){var d=0;if(megafield_data.vehicle_slots[megafield_vehicle_id].money){d=formatPrice(megafield_data.vehicle_slots[megafield_vehicle_id].money)}if(megafield_data.vehicle_slots[megafield_vehicle_id].coins){d=megafield_data.vehicle_slots[megafield_vehicle_id].coins+"&nbsp;"+t_coins}if(megafield_data.vehicle_slots[megafield_vehicle_id].license){d=formatNumber(megafield_data.vehicle_slots[megafield_vehicle_id].license)+"&nbsp;"+t_megafield_currency}var b=t_megafield_fuel_vehicle;var a="<div>"+t_megafield_fuel_vehicle_body.replace("%AMOUNT%",d)+"</div>";var c="farmAction('megafield_fuel', 1, 1);";globalBox(b,a,c)}}function setTourVehicleMegafield(b){if(!b){if(megafield_vehicle_id>0){megafield_data.vehicles[megafield_vehicle_id].durability+=megafield_vehicle_tour.length;megafield_data.vehicles[megafield_vehicle_id].range+=megafield_vehicle_tour.length;megafield_vehicle_id=0}megafield_vehicle_tour=[];$("megafield_vehicle_select_slot").removeClassName("megafield_vehicle_select_slot");$("megafield_vehicle_select_slot").addClassName("megafield_vehicle_select_slot_add");setVehiclesMegafield();timerContentMegafield()}else{moveMegafield()}if(megafield_data.vehicle_slots[b]){var a=megafield_data.vehicle_slots[b];if(!a.block&&!a.unlockable){if(megafield_vehicle_id==b){megafield_data.vehicles[megafield_vehicle_id].durability+=megafield_vehicle_tour.length;megafield_data.vehicles[megafield_vehicle_id].range+=megafield_vehicle_tour.length;megafield_vehicle_id=0;$("megafield_vehicle_select_slot").removeClassName("megafield_vehicle_select_slot");$("megafield_vehicle_select_slot").addClassName("megafield_vehicle_select_slot_add")}else{megafield_vehicle_id=b;$("megafield_vehicle_select_slot").removeClassName("megafield_vehicle_select_slot_add");$("megafield_vehicle_select_slot").addClassName("megafield_vehicle_select_slot")}megafield_vehicle_tour=[];if(megafield_data.vehicle_slots[megafield_vehicle_id]){megafield_tour_type=megafield_data.vehicle_slots[megafield_vehicle_id].type}setVehiclesMegafield();setPlantProductMegafield(0);timerContentMegafield()}}}function setTourTileMegafield(e){if(megafield_vehicle_id>0){var c=getNeighborsTileMegafield(e);if(!c){return false}if(megafield_vehicle_tour&&megafield_vehicle_tour.length>0){for(var d=0;d<c.length;d++){for(var b=0;b<megafield_vehicle_tour.length;b++){if(in_array(c[d],megafield_vehicle_tour[b])){return false}}}}var a=parseInt(megafield_data.vehicle_slots[megafield_vehicle_id].size);if(megafield_data.vehicles[megafield_vehicle_id]&&(megafield_data.vehicles[megafield_vehicle_id].durability-a)<0||megafield_data.vehicles[megafield_vehicle_id].range==0){return false}megafield_data.vehicles[megafield_vehicle_id].durability-=a;megafield_data.vehicles[megafield_vehicle_id].range--;megafield_vehicle_tour.push(c);setVehiclesMegafield();timerContentMegafield()}}function getTilesMegafield(d,q){var m=[];var a=0;var c=d;var n=Math.ceil(d/11);for(var h=0;h<q;h++){var b=((n-1)*11);var e=(n*11);for(var l=0;l<q;l++){c=(d+a+l);if(c>b&&c<=e&&c<=99){m.push(c)}}a+=11;n=Math.ceil((d+a)/11)}return m}function getNeighborsTileMegafield(e){var d=Math.sqrt(megafield_data.vehicle_slots[megafield_vehicle_id].size);var a=getTilesMegafield(e,d);var c=[];for(var b=0;b<a.length;b++){var h=a[b];if(checkTourTileMegafield(h)&&in_array(h,next_possible_tour_tiles)){c.push(h)}}a=c;if(a.length!=megafield_data.vehicle_slots[megafield_vehicle_id].size){return 0}return a}function unsetTourTileMegafield(d){var a=0;var b=0;var c=[];var e=-1;for(i=0;i<megafield_vehicle_tour.length;i++){if(in_array(d,megafield_vehicle_tour[i])){e=i}if(e>-1){a+=megafield_vehicle_tour[i].length;b++}else{c.push(megafield_vehicle_tour[i])}}megafield_data.vehicles[megafield_vehicle_id].durability+=a;megafield_data.vehicles[megafield_vehicle_id].range+=b;megafield_vehicle_tour=c;setVehiclesMegafield();timerContentMegafield()}function checkTourTileMegafield(b){var a=0;if(!in_array(b,megafield_vehicle_tour)){if(megafield_tour_type=="harvest"){if(megafield_data.area[b]){if(megafield_data.area[b].remain<=0){a=1}}else{if(megafield_data.area_free[b]){a=1}}}if(megafield_tour_type=="fertilize"){if(megafield_data.area_free[b]&&(!megafield_data.area[b]||(megafield_data.area[b]&&megafield_data.area[b].remain>0))){a=1}}}return a}function checkNextTourTilesMegafield(l,d,e){var c=getTilesMegafield(l,d);var a=[];for(var b=0;b<c.length;b++){var h=c[b];if(h<=99&&checkTourTileMegafield(h)&&!in_array(h,e)){a.push(h)}}return a}function getNextTourTilesMegafield(a){var t=parseInt(megafield_data.vehicle_slots[megafield_vehicle_id].size);var q=[];for(var h=0;h<megafield_vehicle_tour.length;h++){for(var d=0;d<megafield_vehicle_tour[h].length;d++){q.push(megafield_vehicle_tour[h][d])}}var r={};var m=[];for(var h=0;h<megafield_vehicle_tour[a].length;h++){if(h==0){var l=megafield_vehicle_tour[a][h];var t=Math.sqrt(megafield_data.vehicle_slots[megafield_vehicle_id].size);var s=Math.ceil(l/11);var n=(l+t);var e=checkNextTourTilesMegafield(n,t,q);if(e.length==megafield_data.vehicle_slots[megafield_vehicle_id].size&&(parseInt(Math.ceil(n/11))==parseInt(s))){r.right=e}n=(l-t);var e=checkNextTourTilesMegafield(n,t,q);if(e.length==megafield_data.vehicle_slots[megafield_vehicle_id].size&&(parseInt(Math.ceil(n/11))==parseInt(s))){r.left=e}n=(l-(t*11));var e=checkNextTourTilesMegafield(n,t,q);if(e.length==megafield_data.vehicle_slots[megafield_vehicle_id].size){r.top=e}n=(l+(t*11));var e=checkNextTourTilesMegafield(n,t,q);if(e.length==megafield_data.vehicle_slots[megafield_vehicle_id].size){r.bottom=e}for(var b in r){for(var c=0;c<r[b].length;c++){m.push(r[b][c])}}}}return m}function fireTourMegafield(){if(megafield_vehicle_tour.length>0){farmAction("megafield_tour",1,1);megafield_vehicle_tour=[];if(megafield_data.vehicles[megafield_vehicle_id].durability<=0){setTourVehicleMegafield(0)}else{setVehiclesMegafield();setPlantProductMegafield(0);timerContentMegafield()}}}function showMegafieldHarvestAll(){if(!megafield_data.constants.harvest_all_active||currentuserlevel<megafield_data.constants.harvest_all_level){hideDiv("megafield_harvest_all");hideDiv("megafield_fertilize_all")}else{showDiv("megafield_harvest_all");$("megafield_harvest_all").onclick=new Function("dialogMegafield('harvest_all')");showDiv("megafield_fertilize_all");$("megafield_fertilize_all").onclick=new Function("dialogMegafield('fertilize_all')")}}function moveBunny(){if(!unlock_bunny){return 0}var a=10;document.onkeydown=function(b){var d=$("megafield_bunny").style.top;d=parseInt(str_replace("px","",d));var c=$("megafield_bunny").style.left;c=parseInt(str_replace("px","",c));if(b.keyCode==65){c-=a;if(c<0){return false}if(c<720&&megafield_move_position==2){moveMegafield()}$("megafield_bunny").className="megafield_bunny_left"}if(b.keyCode==83){d+=a;if((d+a)>(640-50)){return false}$("megafield_bunny").className="megafield_bunny_bottom"}if(b.keyCode==87){d-=a;if(d<0){return false}$("megafield_bunny").className="megafield_bunny_top"}if(b.keyCode==68){c+=a;if((c+a)>(1200-50)){return false}if(c>=720&&megafield_move_position==1){moveMegafield()}$("megafield_bunny").className="megafield_bunny_right"}$("megafield_bunny").style.top=d+"px";$("megafield_bunny").style.left=c+"px"}}function openMemory(){generalAction("memoryinit")}function openMemoryResponse(q){memoryblock=0;memoryset=q[1];initMemorySet();memorycurrentround=q[2];$("memory_rounds").innerHTML=q[2];var h=0;if(q[2]<memoryfreerounds){var h=(memoryfreerounds-q[2])}$("memory_roundsfree").innerHTML=h;memoryroundpart=q[3];memory_remain=q[9];if(q[8]){flipMemoryCardAnimation(q[8],q[4])}if(q[7]){showDiv("memory_ready")}else{hideDiv("memory_ready")}if(q[4]){for(var e in q[4]){if($("memorycard"+e)){$("memorycard"+e).className+=" mcard"+q[4][e];$("memorycard"+e).onclick=new Function("")}}}if(q[5]){showDiv("memory_block");var c="";if(q[5][0]){c+="<div>"+t_memory_rounds_win_yes+"</div>"}else{c+="<div>"+t_memory_rounds_win_no+"</div>"}if(q[5][1][0]){c+='<div style="float:left; width:15px; margin-right:5px; margin-left:70px;" class="kp'+q[5][1][0][0]+'"></div>';c+='<div style="float:left;"><b>'+q[5][1][0][1]+"x "+produkt_name[q[5][1][0][0]]+"</b></div>";c+='<div class="clear"></div>'}else{if(q[5][1][1]>0){c+="<div><b>"+q[5][1][1]+"&nbsp;"+gamecurrency+"</b></div>"}else{if(q[5][1][2]>0){c+="<div><b>"+q[5][1][2]+"&nbsp;"+t_points+"</b></div>"}else{if(q[5][1][3]>0){c+='<div><img src="'+imgpath+"gifts/"+q[5][1][3]+'.gif" border="0"></div>'}else{if(q[5][1][5]>0){var m=q[5][1][5];var n="";var b="";if(q[5][1].chkwin&&q[5][1].chkwin.bonus){n+='<div style="color:green;">('+t_farmhouse_bonus_incl.replace("%PERCENT%",(q[5][1].chkwin.bonus*100))+")</div>";b="color:green;";m=q[5][1].chkwin.points}c+='<div style="'+b+'">';c+='  <div style="font-weight:bold;">'+m+"&nbsp;"+t_coloredeggs+"</div>";c+=n;c+="</div>"}}}}}if(q[5][2]){c+='<div style="margin-top:10px; margin-bottom:10px;">'+t_memory_rounds_win_yes_add+"</div>";c+="<div><b>"+t_payment_pointsboost_info2.replace("%PERCENT%",2)+"</b></div>"}$("memory_prize_inner").innerHTML=c;setTimeout(function(){showDiv("memory_prize")},500)}showDiv("memory_transp");showDiv("memory_container");if(q[6]){openMemoryInfo()}hideDiv("memory_help_farmhouse_bonus");var d=checkFarmhouseBonus(memory_token);if(d&&d.points){$("memory_help_farmhouse_bonus").innerHTML="**&nbsp;"+t_farmhouse_bonus_incl.replace("%PERCENT%",(d.points*100));showDiv("memory_help_farmhouse_bonus")}for(var a=0;a<=memory_prizes.length;a++){if(!$("memory_help_eventitem"+a)||!memory_prizes[a][5]){continue}var l=memory_prizes[a][5];if(d&&d.points){l=Math.round(l*(1+d.points))+"**"}$("memory_help_eventitem"+a).innerHTML=l}setTimer("memory")}function flipMemoryCardAnimation(h,l){if(!h.pos||!h.card){return 1}var e=0;var d=0;var a=0;for(var c in l){if(!e){e=l[c]}else{if(e==l[c]){a=1}}d++}if(d==2&&a==1){}else{for(var c=1;c<=20;c++){if($("memory_card"+c+"_flip")){if($("memory_card"+c+"_flip").hasClassName("flip")){$("memory_card"+c+"_flip").remove()}}}}var b='<div id="memory_card'+h.pos+'_flip" class="flip">';b+='  <div class="front memorycard mcard0"></div>';b+='  <div class="backk memorycard mcard'+h.card+'"></div>';b+="</div>";$("memorycard"+h.pos).innerHTML=b;$("memorycard"+h.pos).className="link memorycard mempty";flipMemoryCardAnimationDoIt(h.pos)}function flipMemoryCardAnimationDoIt(a){setTimeout(function(){$("memory_card"+a+"_flip").addClassName("flipit")},50)}function flipMemoryCard(d){if(d>0){if(memoryfreerounds<=memorycurrentround&&memoryroundpart==0){var b="<div>"+cityadcost+'<img width="12" height="12" border="0" src="'+imgpath+'menu/coins.gif">&nbsp;1&nbsp;'+t_coins+"</div>";b+="<div>"+t_memory_coins_content+"</div>";var a="flipMemoryCardExecute("+d+");";var c="hideDiv('globalbox');hideDiv('globaltransp');";globalcommitbox(t_memory_coins_headline,b,a,c)}else{flipMemoryCardExecute(d)}}}function flipMemoryCardExecute(b){if(b>0&&memoryblock==0){memoryblock=1;var a={pos:b};generalAction("memoryflip",a)}}function initMemorySet(a){for(var b in memoryset){$("memorycard"+b).className="memorycard link mcard0";if(memoryset[b]==1){$("memorycard"+b).onclick=new Function("flipMemoryCard("+b+")")}else{$("memorycard"+b).className+=" mempty";$("memorycard"+b).onclick=new Function("")}if(a==1&&$("memory_card"+b+"_flip")){$("memory_card"+b+"_flip").remove()}}}function closeMemoryPrize(){hideDiv("memory_block");hideDiv("memory_prize");initMemorySet();$("memory_prize_inner").innerHTML="";initMemorySet(1)}function closeMemory(){hideDiv("memory_container");hideDiv("memory_transp")}function openMemoryInfo(){showDiv("memory_info")}function closeMemoryInfo(){hideDiv("memory_info")}function timerMemory(){memory_remain--;if($("memory_timeline_time")){$("memory_timeline_time").innerHTML=formatTime(memory_remain)}}function resetMemory(){var a=createAjaxRequestObj();a.open("GET","../lib/memory.php?rid="+rid+"&reset=1",true);a.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");a.onreadystatechange=function(){openMemoryResponse(a)};a.send(null)}function showMemoryPrizes(){if($("memory_prizes").style.display=="block"){$("memory_prizes").style.display="none"}else{$("memory_prizes").style.display="block"}}function gotoCityEasterEvent(){closeMemory();mapGo2Location("city",1,0,"easterevent")}var merchant=function(){this.data={};this.currentNaviTab="gifts"};merchant.prototype.gambleItems=function(){merchant.action("merchant_gamble_items",{type:this.currentNaviTab})};merchant.prototype.buy=function(a){merchant.action("merchant_buy",{id:a,type:this.currentNaviTab})};merchant.prototype.action=function(a,b){ajaxAction("city",a,b,merchant.response)};merchant.prototype.response=function(b,a,c){merchant.data=b;merchant.open()};merchant.prototype.timer=function(){if(this.data.remain){this.data.remain--}if(this.data.remain>0){if(city==1&&$("merchant_link")){showDiv("merchant_link")}else{hideDiv("merchant_link")}if($("merchant_timer")){$("merchant_timer").innerHTML=t_merchant_resttime.replace("%TIME%","<b>"+formatTime(this.data.remain)+"</b>")}}else{this.hide()}};merchant.prototype.clickNaviTab=function(b){if(b){this.currentNaviTab=b;this.open()}for(var a=0;a<this.data.config.tabs.length;a++){hideDiv("merchant_"+this.data.config.tabs[a])}showDiv("merchant_"+this.currentNaviTab)};merchant.prototype.open=function(){var d=t_merchant_intro;d=t_merchant_intro2;var c='<div id="merchant">';c+='  <div class="back"></div>';c+='  <div class="intro">'+d+"</div>";c+='  <div id="merchant_timer" class="timer">&nbsp;</div>';c+='<div class="navi">';for(var b=0;b<this.data.config.tabs.length;b++){if(this.data.config.tabs[b]=="cinema"&&!this.data.cinema){continue}var a="";if(this.currentNaviTab==this.data.config.tabs[b]){a="active"}c+='  <div class="tab link '+a+" tab_"+this.data.config.tabs[b]+'" onclick="merchant.clickNaviTab(\''+this.data.config.tabs[b]+"')\">"+t_merchant_navi_tab[this.data.config.tabs[b]]+"</div>"}c+='  <div class="clear"></div>';c+="</div>";c+=this.buildView();c+="</div>";globalBoxFlex(t_merchant_name,c,0,0,1);$("globalbox").style.marginLeft="-315px";$("globalbox").style.top="50px"};merchant.prototype.buildView=function(){var a=[];var h={};if(this.currentNaviTab=="gifts"){a=this.data.valid_gifts;h=this.data.gifts}if(this.currentNaviTab=="house"){a=this.data.valid_house;h=this.data.house}if(this.currentNaviTab=="cinema"){for(var l in this.data.valid_cinema){a.push({giftid:l})}for(var l=0;l<this.data.cinema.length;l++){h[this.data.cinema[l].giftid]=this.data.cinema[l]}}var m="";m+='<div id="merchant_'+this.currentNaviTab+'" class="block">';if(a){m+='<div class="infobutton is'+this.currentNaviTab+'" onmouseover="showDiv(\'merchant_'+this.currentNaviTab+"_infobutton_tt')\" onmouseout=\"hideDiv('merchant_"+this.currentNaviTab+"_infobutton_tt')\">";m+='  <div id="merchant_'+this.currentNaviTab+'_infobutton_tt" class="ttbox">';m+='    <div class="head">'+t_cinema_valid_items+":</div>";if(this.currentNaviTab=="gifts"){for(var l in a){var n="";if(l==this.data.current_month){n="active"}m+='<div class="'+n+'">';m+='  <div style="text-align:left;">'+t_eventgarden_monthly[l]+"</div>";for(var d=0;d<a[l].length;d++){var b=a[l][d].giftid;m+=this.viewSlotTT(b)}m+='  <div class="clear"></div>';m+="</div>"}}else{if(a.length){for(var l=0;l<a.length;l++){if(this.currentNaviTab=="house"){m+=this.viewSlotTT(a[l])}else{var b=a[l].giftid;m+=this.viewSlotTT(b)}}}}m+='    <div class="clear"></div>';m+="  </div>";m+="</div>"}m+='  <div class="items">';if(h){for(var l in h){var c=0;if(h[l].coins){c=h[l].coins}if(this.currentNaviTab=="cinema"){c=Math.ceil(h[l].points/this.data.config.cinema_exchange)}var n="";if(in_array(l,this.data.user_gifts)){n="off"}if(this.currentNaviTab=="house"){var r="jpg";if(in_array(l,this.data.config.house_suffix_png)){r="png"}var e='<img src="'+imgpath+"farmhouse/previews/"+l+"_1."+r+'" class="'+n+'">';if(this.data.house[l].pet){c=this.data.config.house_pet_coins}}else{var e=l;if(presents_hack[l]){e=presents_hack[l]}var e='<img src="'+imgpath+"gifts/"+e+'.gif" class="'+n+'">'}m+='<div class="item">';m+=e;if((in_array(this.currentNaviTab,["gifts","cinema"])&&in_array(l,this.data.user_gifts))||(this.currentNaviTab=="house"&&in_array(l,this.data.user_house))){var q=t_merchant_item_blocked;if(this.currentNaviTab!="house"){q=t_merchant_block.replace("%NAME%",h[l].name)}m+='<div class="info">'+q+"</div>"}else{var n="";var s="merchant.buyCommit("+l+")";if(parseInt(user_coins)<parseInt(c)){n="important";s=""}m+='<div class="coinsbutton_flex link '+n+'" onclick="'+s+'">'+t_buy_it_default.replace("%AMOUNT%",c+"&nbsp;"+t_coins)+"</div>"}m+="</div>"}m+='<div class="gamble link" onclick="merchant.gambleItemsCommit()" onmouseover="showDiv(\'merchant_gamble_link_tt\')" onmouseout="hideDiv(\'merchant_gamble_link_tt\')">';m+="  <div>&circlearrowright;</div>";m+='  <div id="merchant_gamble_link_tt" class="ttbox">'+t_cinema_gamble_items+"</div>";m+="</div>"}m+="  </div>";m+="</div>";return m};merchant.prototype.viewSlotTT=function(e){var a="";if(in_array(this.currentNaviTab,["gifts","cinema"])){var b=e;if(presents_hack[e]){b=presents_hack[e]}b=imgpath+"gifts/"+b+".gif";if(in_array(e,this.data.user_gifts)){a="off"}}else{var d="jpg";if(in_array(e,this.data.config.house_suffix_png)){d="png"}var b=imgpath+"farmhouse/previews/"+e+"_1."+d;if(in_array(e,this.data.user_house)){a="off"}}var c='<div class="slot">';c+='  <img class="'+a+'" src="'+b+'">';if(a!=""){c+='<div class="ready"></div>'}c+="</div>";return c};merchant.prototype.buyCommit=function(b){if(this.currentNaviTab=="house"){var d=t_merchant_navi_tab.house;var a=this.data.config.house_coins;if(this.data.house[b].pet){a=this.data.config.house_pet_coins}var l="jpg";if(in_array(b,this.data.config.house_suffix_png)){l="png"}var c="farmhouse/previews/"+b+"_1."+l}else{var c=b;if(presents_hack[b]){c=presents_hack[b]}c="gifts/"+c+".gif";if(this.data.gifts[b]){var d=this.data.gifts[b].name;var a=this.data.gifts[b].coins}else{for(var h=0;h<this.data.cinema.length;h++){if(this.data.cinema[h].giftid==b){var d=this.data.cinema[h].name;var a=Math.ceil(this.data.cinema[h].points/this.data.config.cinema_exchange)}}}}var m=t_merchant_buy.replace("%NAME%","<b>"+d+"</b>");var e='<img src="'+imgpath+c+'" style="margin-top:-12px;">';e+='<div style="margin-top:10px;">'+m.replace("%COST%",a+"&nbsp;"+t_coins)+"</div>";globalcommitbox("",e,"merchant.buy("+b+")","merchant.open()")};merchant.prototype.gambleItemsCommit=function(){var a=this.data.config.gamble[this.currentNaviTab];var c=t_merchant_navi_tab[this.currentNaviTab];var e="merchant.gambleItems()";var b="";if(user_coins<a){e="";b="important"}var d='<div id="merchant_commit">'+t_merchant_gamble_desc.replace("%NAME%","<b>"+c+"</b>").replace("%COST%",'<span class="'+b+'" style="font-weight:bold;">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";globalcommitbox(t_merchant_gamble_head,d,e,"merchant.open()")};merchant.prototype.gotoCity=function(){goto_merchant=1;mapGo2Location("city",1)};merchant.prototype.hide=function(){hideDiv("merchant_link")};var blocklist=[];var messages_block=0;var messages_write_block=0;var messages_navi=["in","out","system","new","contact"];var messages_data=[];var messages_select=[];var messages_category="";function messagesClose(){hideDiv("messages_transp");hideDiv("messages_main")}function messagesAction(h,m,d){var e="mode="+h+"&rid="+rid;if(h=="delete"){if(!messages_select.length){return false}e+="&category="+messages_category+"&del="+messages_select.join(",")}if(h=="contact_del"){e+="&unr="+m}if(h=="contact_add"){if(!$("messages_contacts_inner_left_input").value){return false}e+="&name="+encodeURIComponent($("messages_contacts_inner_left_input").value)}if(h=="blocklist_add"){if(!$("messages_contacts_inner_right_input").value){return false}e+="&name="+encodeURIComponent($("messages_contacts_inner_right_input").value)}if(h=="blocklist_del"){e+="&unr="+m}if(h=="send"){if(messages_block==1){return false}messages_block=1;var b=$("messages_view_name").value;var c=$("messages_view_subject").value;var a=$("messages_view_body").value;$("messages_view_name").style.border="";$("messages_view_subject").style.border="";if(b==""){$("messages_view_name").focus();$("messages_view_name").style.border="2px solid #f00";messages_block=0}else{if(c==""){$("messages_view_subject").focus();$("messages_view_subject").style.border="2px solid #f00";messages_block=0}}if(b!=""&&c!=""){e+="&name="+encodeURIComponent(b)+"&subject="+encodeURIComponent(c)+"&body="+encodeURIComponent(a)}else{return false}}if(h=="unread"){e+="&id="+messages_data[m].nnr}var l=createAjaxRequestObj();if(h=="send"){l.open("POST","ajax/messages.php",true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.setRequestHeader("Content-type","application/x-www-form-urlencoded");l.onreadystatechange=function(){messagesActionResponse(l,h,m)};l.send(e)}else{l.open("GET","ajax/messages.php?"+e,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.onreadystatechange=function(){messagesActionResponse(l,h,m)};l.send(null)}}function messagesActionResponse(c,d,e){messages_block=0;var a=_chkRequest(c,d);if(a!=0){if(!a[0]){if(a[1]){globalerrorbox(a[1])}}else{$("messages_list_checkbox").checked=false;if(a[1].contacts){contacts=a[1].contacts}else{contacts={}}if(a[1].blocklist){blocklist=a[1].blocklist}else{blocklist=[]}if(a[1].counts){if(a[1].counts["in"]){var b="&nbsp;("+a[1].counts["in"]+")"}else{var b=""}$("messages_navi_in_count").innerHTML=b;if(a[1].counts.system){var b="&nbsp;("+a[1].counts.system+")"}else{var b=""}$("messages_navi_system_count").innerHTML=b}if(d=="open"){showDiv("messages_transp");showDiv("messages_main")}if(d=="unread"){$("messages_list_subject"+messages_data[e].nnr).removeClassName("messages_list_unread");$("messages_list_subject"+messages_data[e].nnr).onclick=new Function("messagesRead("+e+")");return 1}if(in_array(d,["open","in","out","system","send","delete"])){hideDiv("messages_view");hideDiv("messages_contacts");messages_data=a[1].list;messages_write_block=a[1].block;showDiv("messages_list");messagesList()}else{hideDiv("messages_list")}if(in_array(d,["contact","contact_add","contact_del","blocklist_add","blocklist_del"])){d="contact";messagesContacts()}if(d=="send"){d="in"}messagesNavi(d)}}}function messagesNavi(c){messages_select=[];if(c=="delete"){c=messages_category}if(c=="open"){c="in"}messages_category=c;for(var a=0;a<messages_navi.length;a++){if($("messages_navi_"+messages_navi[a])){$("messages_navi_"+messages_navi[a]).removeClassName("messages_navi_item_active")}}if($("messages_navi_"+c)){$("messages_navi_"+c).addClassName("messages_navi_item_active")}hideDiv("messages_info");$("messages_list_inner").removeClassName("messages_list_inner");$("messages_list_inner").addClassName("messages_list_inner_withoutinfo");if(c=="in"||c=="new"){var b=getRandom(0,2);$("messages_info").innerHTML=messages_info[b];showDiv("messages_info");$("messages_list_inner").addClassName("messages_list_inner");$("messages_list_inner").removeClassName("messages_list_inner_withoutinfo")}}function messagesList(){var e="";if(messages_data){for(var d=0;d<messages_data.length;d++){var b=messages_data[d];e+='<div class="messages_list_item">';e+='  <div class="messages_list_date">'+b.time+"</div>";var a="messagesAction('unread', "+d+")";var c="messages_list_unread";if(b.read==1){a="";c=""}e+='  <div id="messages_list_subject'+b.nnr+'" class="messages_list_subject link '+c+'" onclick="messagesRead('+d+"); "+a+'">'+b.subject+"</div>";if(b.admin==1){c="admin_icon"}e+='  <div class="messages_list_status '+c+'">&nbsp;</div>';if(b.name){e+='  <div class="messages_list_contract addcontact_icon link" onclick="addMessagesContact(\''+b.name+"');\"></div>";e+="  <div class=\"messages_list_contract contract_icon link\" onclick=\"showPage('contracts', '"+b.name+"');\"></div>";e+='  <div class="messages_list_name">'+b.name+"</div>"}e+='  <input type="checkbox" id="messages_list_check'+d+'" value="'+d+'" class="messages_list_check link" onclick="messagesDel('+d+", "+b.nnr+')">';e+='  <div class="clear"></div>';e+='  <div class="messages_list_body" id="messages_list_body'+d+'"></div>';e+="</div>"}}$("messages_list_inner").innerHTML=e}function messagesRead(c){var a=messages_data[c];if($("messages_list_body"+c)){if($("messages_list_body"+c).style.display=="block"){hideDiv("messages_list_body"+c);$("messages_list_body"+c).innerHTML=""}else{a.body=str_replace("\\'","'",a.body);var b="";b+='<div class="messages_list_body_text">'+a.body+"</div>";b+='<div class="messages_list_body_navi">';if(a.from!="0"){b+='  <button type="button" class="link button_new" onclick="messageDetail('+c+')">'+t_msg_reply+"</button>"}b+='  <button type="button" class="link button_new" onclick="messagesDel(-1, '+a.nnr+"); messagesAction('delete')\">"+t_msg_delete+"</button>";if(youthprotection_active==1&&a.from!="0"){b+='  <button type="button" class="link button_new youthprotection" onclick="youthprotection.report(\'messages\', '+a.nnr+')">'+t_youthprotection_report+"</button>"}b+='  <div class="link messages_close_message" onclick="messagesRead('+c+');"></div>';b+="</div>";$("messages_list_body"+c).innerHTML=b;showDiv("messages_list_body"+c)}}}function messageDetail(b){if(messages_write_block==1){showDiv("messages_view_info");hideDiv("messages_view_form")}else{hideDiv("messages_view_info");showDiv("messages_view_form")}if(b<0){hideDiv("messages_view_blocklist_info");$("messages_view_name").value="";$("messages_view_subject").value="";$("messages_view_body").value=""}else{var a=messages_data[b];$("messages_view_name").value=a.name;$("messages_view_subject").value=t_msg_reply_subject_add+a.subject;$("messages_view_body").value=""}hideDiv("messages_list");hideDiv("messages_contacts");showDiv("messages_view");messagesNavi("new");messagesCalcBody()}function messagesCalcBody(){var a=$("messages_view_body").value;var b=parseInt(a.length);if(b>1500){a=a.substring(0,1500);$("messages_view_body").value=a}$("messages_view_body_letters").innerHTML=(1500-parseInt(a.length))}function messagesDel(e,c){var d=0;if(e<0){messages_select=[];d=1}else{if($("messages_list_check"+e)&&$("messages_list_check"+e).checked==true){d=1}}if(d==1){messages_select.push(c)}else{var b=[];for(var a=0;a<messages_select.length;a++){if(messages_select[a]!=c){b.push(messages_select[a])}}messages_select=b}}function messagesShowContactsList(){var b="";for(var a=0;a<contacts.length;a++){b+='<div class="messages_contacts_link_item link" onclick="messagesSetName(\''+contacts[a].uname+"')\">"+contacts[a].uname+"</div>"}$("messages_contacts_link_inner").innerHTML=b;showDiv("messages_contacts_link")}function messagesSetName(a,b){if(b==1){messageDetail(-1)}$("messages_view_name").value=a;if($("messages_contacts_link")){hideDiv("messages_contacts_link")}messagesCheckNameBlocklist()}function addMessagesContact(a){showDiv("messages_transp");showDiv("messages_main");messagesAction("contact");$("messages_contacts_inner_left_input").value=a}function messagesContacts(){var b="";if(contacts){for(var a=0;a<contacts.length;a++){b+='<div class="messages_contacts_addressbook_line">';b+='  <div style="float:left; width:16px; margin-top:-2px;" class="mail_icon link" onclick="messagesSetName(\''+contacts[a].uname+"', 1)\"></div>";b+='  <div style="float:left; width:16px; margin-top:-1px;" class="contract_icon link" onclick="showPage(\'contracts\', \''+contacts[a].uname+"');\"></div>";b+='  <div style="float:left; width:100px; margin-top:1px; margin-right:5px;">'+contacts[a].uname+"&nbsp;";if(!isSteam()){b+='<img src="'+imgpath+'stadt/stats_sf_black.gif" class="link" onclick="window.open(\''+http_host+"schaugarten/index.php?mode=view&user="+contacts[a].unr+"')\">"}b+="  </div>";b+='  <div style="float:right; width:16px;" class="delete_icon link" onclick="messagesAction(\'contact_del\', \''+contacts[a].unr+"')\"></div>";b+='  <div style="clear:both;"></div>';b+="</div>"}}$("messages_contacts_inner_left_inner").innerHTML=b;var b="";if(blocklist){for(var a=0;a<blocklist.length;a++){b+='<div class="messages_contacts_addressbook_line">';b+='  <div style="float:left;">'+blocklist[a].name+"</div>";b+='  <div style="float:right; width:16px;" class="delete_icon link" onclick="messagesAction(\'blocklist_del\', \''+blocklist[a].unr+"')\"></div>";b+='  <div style="clear:both;"></div>';b+="</div>"}}$("messages_contacts_inner_right_inner").innerHTML=b;hideDiv("messages_info");hideDiv("messages_list");hideDiv("messages_view");showDiv("messages_contacts")}function messagesSelectAll(){if($("messages_list_checkbox").checked==true){var b=true}else{var b=false}if(messages_data){for(var c=0;c<messages_data.length;c++){var a=messages_data[c];if(b==false){messages_select=[]}else{messages_select.push(messages_data[c].nnr)}if($("messages_list_check"+c)){$("messages_list_check"+c).checked=b}}}}function messagesOpen(a){showDiv("messages_transp");showDiv("messages_main");messageDetail(-1);$("messages_view_name").value=a}function messagesCheckNameBlocklist(){var a=$("messages_view_name").value;hideDiv("messages_view_blocklist_info");if(a==""){return 1}for(var b=0;b<blocklist.length;b++){if(blocklist[b].name==a){showDiv("messages_view_blocklist_info");break}}}var npcbonus=function(){this.data={};this.currentPage=1};npcbonus.prototype.insertGifts=function(a){var c=$("npcbonus_insert").value;var b=this.getNPCByPage();npcbonus.action("npcbonus_insertgifts",{npc:b,amount:c})};npcbonus.prototype.buyPoints=function(a){npcbonus.action("npcbonus_buypoints",{coins:a})};npcbonus.prototype.action=function(a,b){ajaxAction("farm",a,b,npcbonus.response)};npcbonus.prototype.response=function(b,a,c){npcbonus.data=b;npcbonus.build()};npcbonus.prototype.build=function(a){var e=this.data.data.points;var c="";c+='<div class="head">'+t_npcbonus_head+"</div>";c+='<div class="desc">'+t_npcbonus_desc+"</div>";c+='<div class="points">';c+='  <div class="current">'+e+"</div>";c+='  <div class="plus2 link" onclick="npcbonus.buyPointsCommit()" onmouseover="showDiv(\'npcbonus_points_tt\')" onmouseout="hideDiv(\'npcbonus_points_tt\')">';c+='    <div id="npcbonus_points_tt" class="ttbox">'+t_npcbonus_buy_points+"</div>";c+="  </div>";c+="</div>";c+='<div id="npcbonus_navi" class="navi"></div>';c+='<div class="content">';c+='  <div id="npcbonus_pages" class="pages">';var d=1;for(var b in this.data.config.npcs){c+='<div id="npcbonus_page_'+b+'" class="page page'+d+'"></div>';d++}c+="  </div>";c+="</div>";c+='<div id="npcbonus_navi_arrow_left" class="arrow left link" onclick="npcbonus.scrollNavi(-1)"></div>';c+='<div id="npcbonus_navi_arrow_right" class="arrow right link" onclick="npcbonus.scrollNavi(1)"></div>';c+='<div class="mini_close link" onclick="npcbonus.close()"></div>';c+='<div class="helpbutton_blue link" onclick="npcbonus.help()"></div>';$("npcbonus_inner").innerHTML=c;showDiv("npcbonus");$("npcbonus_inner").addClassName("bounce");this.buildPages();this.setNavi(0)};npcbonus.prototype.buildPages=function(){for(var a in this.data.config.npcs){this.buildPage(a)}};npcbonus.prototype.buildPage=function(d){var h=0;if(this.data.data.npc&&this.data.data.npc[d]&&this.data.data.npc[d].points){h=this.data.data.npc[d].points}var l=((h*100)/this.data.config.npcs[d].max);var m=0;for(var b in this.data.config.npcs[d].rewards){if(h>=b){m=b}}var e="";e+='<div class="row row1">';e+='  <div id="npcbonus_'+d+'_bubble" class="bubble">'+t_npcbonus_npc_bubble[d]+"</div>";e+='  <div id="npcbonus_'+d+'_npc" class="npc">';if(this.data.config.npcs[d].unlock&&!this.isNPCUnlocked(this.data.config.npcs[d].unlock)){e+='<div class="locked"></div>'}e+="  </div>";e+="</div>";e+='<div class="row row2">';e+='  <div class="bar">';e+='    <div class="front">';e+='      <div class="inner2" style="height:'+l+'%;"></div>';e+="    </div>";for(var b in this.data.config.npcs[d].rewards){var q="";var a="";if(m==b){q="reached";a="npcbonus_"+d+"_npc_reached"}var n=Math.round(this.data.config.npcs[d].rewards[b]*100)+"%";l=((b*100)/this.data.config.npcs[d].max);e+='<div class="reward" style="bottom:'+l+'%">';e+='  <div id="'+a+'" class="percent '+q+'">'+n+"</div>";e+='  <div class="amount">'+b+"</div>";e+="</div>"}e+="  </div>";var c=0;if(this.data.config.npcs[d].unlock&&!this.isNPCUnlocked(this.data.config.npcs[d].unlock)){c=1}if(!c){e+='<div class="progress">';e+="  <div>"+h+"/"+this.data.config.npcs[d].max+"</div>";e+='  <button class="button_new link insert" onclick="npcbonus.insertGiftsCommit()">'+t_npcbonus_button+"</button>";e+="</div>"}e+="</div>";e+='<div class="clear"></div>';$("npcbonus_page_"+d).innerHTML=e};npcbonus.prototype.isNPCUnlocked=function(a){if(this.data.data.npc[a]&&this.data.data.npc[a].maxed){return 1}return 0};npcbonus.prototype.buildNavi=function(){var d="";var h=1;for(var c in this.data.config.npcs){var l=0;if(this.data.data.npc&&this.data.data.npc[c]&&this.data.data.npc[c].points){l=this.data.data.npc[c].points}var e=t_npcbonus_npc_name[c];var a="";if(h==this.currentPage){a="active"}if(h>=3){a+=" right"}d+='<div class="img '+a+' link" onclick="npcbonus.setNavi('+h+')" onmouseover="showDiv(\'npcbonus_navi_'+c+"_tt')\" onmouseout=\"hideDiv('npcbonus_navi_"+c+"_tt')\">";if(this.data.config.npcs[c].unlock&&!this.isNPCUnlocked(this.data.config.npcs[c].unlock)){d+='<div class="locked"></div>';e+='<div class="islocked">'+t_npcbonus_npc_need_unlocked.replace("%NAME%",t_npcbonus_npc_name[this.data.config.npcs[c].unlock])+"</div>"}d+='  <div id="npcbonus_navi_'+c+'_tt" class="ttbox">'+e+"</div>";d+='  <div id="npcbonus_navi_stars_'+c+'" class="stars">';for(var b in this.data.config.npcs[c].rewards){a="off";if(l>=b){a=""}d+='<div class="foodworld_star '+a+'"></div>'}d+="  </div>";d+="</div>";if(this.currentPage==h){$("npcbonus_page_"+c).removeClassName("fadeout").addClassName("fadein")}else{$("npcbonus_page_"+c).removeClassName("fadein").addClassName("fadeout")}h++}$("npcbonus_navi").innerHTML=d;$("npcbonus_pages").className="pages pos"+this.currentPage;hideDiv("npcbonus_navi_arrow_left");hideDiv("npcbonus_navi_arrow_right");if(this.currentPage>1){showDiv("npcbonus_navi_arrow_left")}if(this.currentPage<(h-1)){showDiv("npcbonus_navi_arrow_right")}setTimeout(function(){npcbonus.npcBounce()},200)};npcbonus.prototype.setNavi=function(a){if(a!=0){this.currentPage=a}this.buildNavi()};npcbonus.prototype.scrollNavi=function(c){var a=0;for(var b in this.data.config.npcs){a++}if(c!=0){this.currentPage+=c}if(this.currentPage<=0){this.currentPage=1}if(this.currentPage>a){this.currentPage=a}this.buildNavi()};npcbonus.prototype.buyPointsCommit=function(){var b='<div id="npcbonus_commit">';for(var a in this.data.config.buy){var c=this.data.config.buy[a];var d=a+"&nbsp;"+t_coins;b+='<div class="coinsbutton_flex link" onclick="npcbonus.buyPoints('+a+')">'+t_npcbonus_buy_points_button.replace("%COUNT%",c).replace("%COST%",d)+"</div>"}b+="</div>";globalcommitbox(t_npcbonus_buy_points,b,0,0,1)};npcbonus.prototype.insertGiftsCommit=function(){var a=this.getNPCByPage();name=t_npcbonus_insert_gift_head.replace("%NAME%",t_npcbonus_npc_name[a]);var b='<div id="npcbonus_commit">';b+='  <div class="desc">'+t_npcbonus_insert_gift_body+"</div>";b+='  <input id="npcbonus_insert" value="0" type="number" onchange="npcbonus.checkInsertGifts()" onkeyup="npcbonus.checkInsertGifts()">';b+='  <div class="points">';b+='    <div class="img"></div>';b+="    <div>"+formatNumber(this.data.data.points)+"</div>";b+="  </div>";b+="</div>";var c="npcbonus.insertGifts()";globalcommitbox(name,b,c);$("npcbonus_insert").focus()};npcbonus.prototype.checkInsertGifts=function(){var b=this.getNPCByPage();var a=this.data.data.points;var e=0;if(this.data.data.npc&&this.data.data.npc[b]&&this.data.data.npc[b].points){e=this.data.data.npc[b].points}var d=(this.data.config.npcs[b].max-e);var c=$("npcbonus_insert").value;if(isNaN(c)||c<0){c=0}if(c>d){c=d}if(c>a){c=a}$("npcbonus_insert").value=c};npcbonus.prototype.getNPCByPage=function(){var b=1;for(var a in this.data.config.npcs){if(b==this.currentPage){return a}b++}};npcbonus.prototype.npcBounce=function(){var c=1;for(var b in this.data.config.npcs){$("npcbonus_"+b+"_bubble").removeClassName("bounce");$("npcbonus_"+b+"_npc").removeClassName("bounce");if(c==this.currentPage){var a=b}c++}$("npcbonus_"+a+"_bubble").addClassName("bounce");$("npcbonus_"+a+"_npc").addClassName("bounce");$("npcbonus_navi_stars_"+a).addClassName("bounce");if($("npcbonus_"+a+"_npc_reached")){$("npcbonus_"+a+"_npc_reached").addClassName("bounce");setTimeout(function(){$("npcbonus_"+a+"_npc_reached").removeClassName("bounce")},1000)}};npcbonus.prototype.timer=function(){};npcbonus.prototype.help=function(){};npcbonus.prototype.close=function(){hideDiv("npcbonus")};var nutcracker=function(){this.data={};this.currentCategory=""};nutcracker.prototype.send=function(b,a){var c=$("nutcracker_sendcommit_amount").value;nutcracker.action("nutcracker_send",{pid:b,amount:c,forestry:a})};nutcracker.prototype.buyBonus=function(a){nutcracker.action("nutcracker_buybonus",{coins:a})};nutcracker.prototype.init=function(){nutcracker.action("nutcracker_init")};nutcracker.prototype.action=function(a,b){ajaxAction("farm",a,b,nutcracker.response)};nutcracker.prototype.response=function(b,a,c){nutcracker.data=b;nutcracker.build();if(a=="nutcracker_send"){nutcracker.feedAni()}};nutcracker.prototype.build=function(){var q=0;if(this.data.sum){q=parseInt(this.data.sum)}var u=this.data.info.max;var r=(Math.min(100,((q*100)/u))).toFixed(5);var v=0;var d=0;var a=0;if(this.data.own&&this.data.own>0){v=this.data.own;d=((v*100)/this.data.config.participation.need);a=((v*100)/u);a=(Math.floor(a*100)/100).toFixed(2);a.replace(".",",")}var l="";l+='<div class="infos">';l+='  <div class="head">'+t_nutcracker_event_name+"</div>";l+='  <div class="desc">'+t_nutcracker_event_desc+"</div>";l+='  <div class="entry">';l+='    <div class="desc">'+t_nutcracker_player_part+"</div>";l+='    <div class="amount">';l+='      <div class="nutcrackerimg"></div>';l+="      <div>"+formatNumber(v)+"</div>";l+="    </div>";l+='<div class="send link button_new" onclick="nutcracker.selection()">'+t_nutcracker_selection_entry_head+"</div>";l+="  </div>";l+='  <div class="participation">';l+='    <div class="head">'+t_nutcracker_participation_gift+"</div>";l+='    <div class="img">';if(d>=100){l+='<div class="ready"></div>'}l+="    </div>";l+='    <div class="bar">';l+='      <div class="inner" style="width:'+Math.min(100,d)+'%;"></div>';l+="    </div>";l+='    <div class="progress">';l+='      <div class="nutcrackerimg"></div>';l+="      <div>"+formatNumber(Math.min(v,this.data.config.participation.need))+"/"+formatNumber(this.data.config.participation.need)+"</div>";l+="    </div>";l+="  </div>";if(q<parseInt(this.data.info.max)){l+='<div class="buff">';l+='  <div class="head">'+t_nutcracker_bonus_head+"</div>";l+='  <div class="desc">'+t_nutcracker_bonus_desc.replace("%PERCENT%",(this.data.config.buff.bonus*100))+"</div>";if(this.data.bonus&&this.data.bonus.count){l+='<div class="rest">';l+="  <div>"+t_nutcracker_bonus_info+"</div>";l+='  <div class="amount">'+formatNumber(this.data.bonus.count)+"</div>";l+="</div>"}l+='  <div class="coinsbutton_flex link" onclick="nutcracker.buyBonusCommit()">'+t_nutcracker_bonus_button+"</div>";l+="</div>"}l+='  <div class="timer">'+t_event_resttime+':&nbsp;<span id="nutcracker_timer">'+formatTime(this.data.remain)+"</span></spab></div>";l+="</div>";l+='<div class="nutcracker">';l+='  <div id="nutcracker_back" class="char back"></div>';l+='  <div id="nutcracker_front" class="char front" style="height:'+r+'%"></div>';var m=1;for(var h in this.data.config.bonus){var e="";var n="";for(var s in this.data.config.bonus[h]){if(s=="bonus"){var c="";if(h==20){c="rackcat25"}if(h==40){c="racksort_breed"}if(h==60){c="racksort_cow"}if(h==80){c="racksort_md"}if(h==100){c="racksort_fish"}e+='<div class="category '+c+'">';e+='  <div class="bonus_star"><div class="attention">!</div></div>';e+="</div>";if(specialbonus.config[this.data.config.bonus[h].bonus.id]){for(var t in specialbonus.config[this.data.config.bonus[h].bonus.id]){if(t_feature_name[t]){n+='<div style="font-weight:bold; margin-bottom:5px;">'+t_feature_name[t]+"</div>"}}}n+="<div>"+specialbonus.getName(this.data.config.bonus[h].bonus.id)+"</div>";n+="<div>"+t_nutcracker_add_time.replace("%TIME%",formatTime(this.data.config.bonus[h][s]["duration"]))+"</div>"}if(s=="logingift"){e+='<div class="logingift"></div>';n+='<div class="pluss">+</div>';n+="<div>"+t_pan_item+"</div>"}}l+='<div class="bonus" style="bottom:'+h+'%;">';l+='  <div class="percent">'+h+"%</div>";l+='  <div class="info" onmouseover="showDiv(\'nutcracker_bonus'+h+"_tt')\" onmouseout=\"hideDiv('nutcracker_bonus"+h+"_tt')\">";l+='    <div class="img">'+e+"</div>";l+='    <div id="nutcracker_bonus'+h+'_tt" class="ttbox">'+n+"</div>";if(this.data.info&&this.data.info.bonus&&this.data.info.bonus[h]){l+='<div class="ready"></div>'}l+="  </div>";l+="</div>";m++}var r=(Math.min(100,((q*100)/u)));if(r>100){r=100}else{r=(Math.floor(r*100)/100).toFixed(2)}l+='  <div class="counter" onmouseover="showDiv(\'nutcracker_nutcracker_counter_tt\')" onmouseout="hideDiv(\'nutcracker_nutcracker_counter_tt\')">';l+="    <div>"+r.replace(".",",")+"%</div>";l+='    <div id="nutcracker_nutcracker_counter_tt" class="ttbox">';l+='      <div style="font-weight:bold;">'+t_nutcracker_spend_points+"</div>";l+='      <div class="flex">';l+='        <div class="nutcrackerimg"></div>';l+='        <div style="margin-top:4px;">'+formatNumber(Math.min(u,q))+"</div>";l+="      </div>";l+='      <div style="font-weight:bold; margin-top:10px;">'+t_nutcracker_need_points+"</div>";l+='      <div class="flex">';l+='        <div class="nutcrackerimg"></div>';l+='        <div style="margin-top:4px;">'+formatNumber(u)+"</div>";l+="      </div>";l+="    </div>";l+="  </div>";l+="</div>";l+='<div class="stats_link link" onclick="nutcracker.showRanking()"></div>';l+='<div class="help helpbutton_blue link" onmouseover="showDiv(\'nutcracker_help_tt\')" onmouseout="hideDiv(\'nutcracker_help_tt\')">';l+='  <div id="nutcracker_help_tt" class="ttbox">';l+="    <div>"+t_nutcracker_help1+"</div>";l+='    <div style="margin-top:10px;">'+t_nutcracker_help2+"</div>";l+="    <ul><li>"+t_nutcracker_help3.replace("%DAYS%",formatTime(this.data.config.bonus[20].bonus.duration))+"</li>";l+="    <li>"+t_nutcracker_help4+"</li></ul>";l+="    <div>"+t_nutcracker_help5.replace("%AMOUNT%",formatNumber(this.data.config.participation.need))+"</div>";l+='    <div style="margin-top:10px; font-style:italic;">'+t_nutcracker_help6.replace("%DAYS%",formatTime(this.data.config.bonus[100].logingift.duration))+"</div>";l+="  </div>";l+="</div>";l+='<div class="mini_close link" onclick="nutcracker.close()"></div>';$("nutcracker_main").innerHTML=l;showDiv("nutcracker")};nutcracker.prototype.buyBonusCommit=function(){var c='<div id="nutcracker_buybonus_commit">';c+='<div class="desc">'+t_nutcracker_bonus_desc.replace("%PERCENT%",(this.data.config.buff.bonus*100))+"</div>";for(var a in this.data.config.buff.packages){var b="";var d="nutcracker.buyBonusCommitCommit("+a+")";if(parseInt(a)>parseInt(user_coins)){b="off";d=""}c+='<div class="coinsbutton_flex link '+b+'" onclick="'+d+'">'+t_nutcracker_bonus_button2.replace("%AMOUNT%",formatNumber(this.data.config.buff.packages[a])).replace("%COINS%",a)+"</div>"}c+="</div>";globalBoxFlex(t_nutcracker_bonus_head,c,0,0,1)};nutcracker.prototype.buyBonusCommitCommit=function(a){var c='<div id="nutcracker_buybonus_commit_commit">';c+='  <div style="margin-bottom:10px;"><img src="'+imgpath+'menu/coins.gif" width="10" height="10">&nbsp;'+a+"&nbsp;"+t_coins+"</div>";c+="  <div>"+t_nutcracker_bonus_buy_commit.replace("%AMOUNT%",formatNumber(this.data.config.buff.packages[a])).replace("%PERCENT%",(this.data.config.buff.bonus*100)).replace("%COINS%",a)+"</div>";c+="</div>";var d="nutcracker.buyBonus("+a+")";var b="hideDiv('globaltransp'); hideDiv('globalbox'); nutcracker.buyBonusCommit();";globalcommitbox(t_nutcracker_bonus_head,c,d,b)};nutcracker.prototype.selection=function(){if(this.currentCategory==""){start:for(var r in this.data.valid){for(var l in this.data.valid[r]){this.currentCategory=this.data.valid[r][l].category;break start}}}var h='<div id="nutcracker_selection">';h+='  <div class="head">'+t_nutcracker_selection_head+"</div>";h+='  <div class="desc">'+t_nutcracker_selection_desc+"</div>";h+='  <div class="products">';var s={};for(var r in this.data.valid){var q=this.data.valid[r];var n=1;for(var l in q){var b=q[l].category;var m=[b];if(in_array(b,["fl","fla"])){m=["fl","fla"]}if(in_array(b,["tea","alpin"])){m=["tea","alpin"]}if(in_array(b,["water","sushi"])){m=["water","sushi"]}if(q[l].amount>0&&in_array(this.currentCategory,m)){var e=0;if(b=="forestry"){e=1}var d="tt"+l;if(e==1){d="forestry f_symbol"+l;var a=produkt_name_forestry[l]}else{var a=produkt_name[l]}var t="";var u=q[l].points;if(this.data.bonus&&this.data.bonus.count&&this.data.bonus.count>0){t="isbonus";u=Math.round(u*(1+this.data.config.buff.bonus))}h+='<div class="slot nuts link" onclick="nutcracker.sendCommit('+l+", "+e+')" onmouseover="showDiv(\'nutcracker_selection_slot'+l+"_"+e+"_tt')\" onmouseout=\"hideDiv('nutcracker_selection_slot"+l+"_"+e+"_tt')\">";h+='  <div class="img '+d+'"></div>';h+='  <div class="points '+t+'">'+formatNumber(u)+"</div>";h+='  <div class="amount">'+formatNumber(q[l].amount)+"</div>";var t="";if(n%6==0){t="right"}h+='  <div id="nutcracker_selection_slot'+l+"_"+e+'_tt" class="ttbox '+t+'">'+a+"</div>";h+="</div>";n++}if(in_array(b,["fl","fla"])){b="fl"}if(in_array(b,["tea","alpin"])){b="alpin"}if(in_array(b,["water","sushi"])){b="water"}s[b]=1}}h+='    <div class="clear"></div>';h+="  </div>";h+='  <div class="navi">';for(var c in s){var t="";if(this.currentCategory==c){t="active"}h+='<div class="slot '+t+' link" onclick="nutcracker.setCategory(\''+c+"')\">";h+='  <div id="cmenue_'+c+'" class="img"></div>';h+="</div>"}h+="  </div>";h+="</div>";globalBoxFlex("",h,0,0,1);$("globalbox").style.top="50px"};nutcracker.prototype.setCategory=function(a){this.currentCategory=a;this.selection()};nutcracker.prototype.sendCommit=function(c,a){if(a==1){var m=this.data.valid.forestry[c]}else{var m=this.data.valid.farm[c]}if(!m){return 1}var b="tt"+c;if(a==1){b="f_symbol"+c;var e=produkt_name_forestry[c]}else{var e=produkt_name[c]}var l=t_nutcracker_selection_entry_head;var h='<div id="nutcracker_selection_commit">';h+='  <div class="img '+b+'"></div>';h+='  <div class="name">'+e+"</div>";h+='  <div class="line">';h+='    <input type="number" id="nutcracker_sendcommit_amount" min="1", value="1" onkeyup="nutcracker.checkSend('+c+", "+a+')" onchange="nutcracker.checkSend('+c+", "+a+')">';h+='    <div class="stockamount">'+t_in_stock+"&nbsp;"+formatNumber(m.amount)+"</div>";h+='    <div class="link button_new" onclick="nutcracker.send('+c+", "+a+')">'+t_inner_feedsubmit+"</div>";h+='    <div class="clear"></div>';h+="  </div>";h+='  <div class="exchanged">';h+="    <div>"+t_nutcracker_points_exchanged+"</div>";h+='    <div class="nutcrackerimg"></div>';h+='    <div><span class="points" id="nutcracker_sendcommit_points">0</span>&nbsp;'+t_nutcracker_points+"</div>";h+="  </div>";if(this.data.bonus&&this.data.bonus.count&&this.data.bonus.count>0){h+='<div class="buff">';h+='  <div class="head">'+t_nutcracker_bonus_head+"</div>";h+="  <div>"+t_nutcracker_bonus_info+'&nbsp;<span id="nutcracker_selection_commit_buff_rest"></span></div>';h+="</div>"}h+="</div>";var d="hideDiv('globaltransp'); hideDiv('globalbox'); nutcracker.selection();";globalcommitbox(l,h,0,d,1);$("nutcracker_sendcommit_amount").focus();this.checkSend(c,a)};nutcracker.prototype.checkSend=function(d,a){if(a==1){var l=this.data.valid.forestry[d]}else{var l=this.data.valid.farm[d]}var m=$("nutcracker_sendcommit_amount").value;if(!m||isNaN(m)){m=1}else{if(m>parseInt(l.amount)){m=parseInt(l.amount)}}$("nutcracker_sendcommit_amount").value=m;var c=m;var b=0;if(this.data.bonus&&this.data.bonus.count&&this.data.bonus.count>0){var h=this.data.bonus.count;if(m>0){if(m>=h){b=h}else{b=m}h-=m;$("nutcracker_selection_commit_buff_rest").innerHTML=formatNumber(Math.max(0,h))}}c=c-b;var e=0;e+=(c*l.points);e+=(b*(l.points*(1+this.data.config.buff.bonus)));$("nutcracker_sendcommit_points").innerHTML=formatNumber(e)};nutcracker.prototype.showRanking=function(){var a='<div id="nutcracker_stats">';a+='  <div class="headline">'+t_nutcracker_stats_head+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.data.ranking,"nutcracker");a+="</div>";globalBoxFlex("",a,0,0,1)};nutcracker.prototype.timer=function(){this.data.remain--;if($("nutcracker_timer")){$("nutcracker_timer").innerHTML=formatTime(this.data.remain)}if(this.data.remain<=0){hideDiv("nutcracker_link");this.close()}};nutcracker.prototype.feedAni=function(){$("nutcracker_back").addClassName("feed");$("nutcracker_front").addClassName("feed");setTimeout(function(){if($("nutcracker_back")){$("nutcracker_back").removeClassName("feed");$("nutcracker_front").removeClassName("feed")}},1000)};nutcracker.prototype.close=function(){hideDiv("nutcracker")};var oktoberfest=function(){this.data={};this.currentSheep=0;this.max=16;this.tutorialStep=0};oktoberfest.prototype.cheat=function(a){var a=$("oktoberfest_cheat_id").value;oktoberfest.action("oktoberfest_cheat",{id:a})};oktoberfest.prototype.unsetSheep=function(a,b){if(this.currentSheep>0&&this.currentSheep!=a){this.setSheep(b)}else{oktoberfest.action("oktoberfest_unset_sheep",{sheep:a})}};oktoberfest.prototype.speedup=function(){oktoberfest.action("oktoberfest_speedup")};oktoberfest.prototype.buy=function(a){oktoberfest.action("oktoberfest_buy",{coins:a})};oktoberfest.prototype.shuffle=function(){oktoberfest.action("oktoberfest_shuffle")};oktoberfest.prototype.finish=function(){oktoberfest.action("oktoberfest_finish")};oktoberfest.prototype.setSheep=function(a){oktoberfest.action("oktoberfest_set_sheep",{slot:a,sheep:this.currentSheep})};oktoberfest.prototype.init=function(a){oktoberfest.action("oktoberfest_init")};oktoberfest.prototype.action=function(a,b){ajaxAction("farm",a,b,oktoberfest.response)};oktoberfest.prototype.response=function(b,a,c){oktoberfest.data=b;oktoberfest.build();if(oktoberfest.data.data.starttutorial){oktoberfest.startTutorial()}if(oktoberfest.data.login){oktoberfest.login()}if(a=="oktoberfest_init"&&$("oktoberfest_inner")){$("oktoberfest_inner").addClassName("window_wobble");oktoberfest.unWobble()}if(a=="oktoberfest_buy"){oktoberfest.toogleRewardBox()}};oktoberfest.prototype.unWobble=function(){setTimeout(function(){if($("oktoberfest_inner")){$("oktoberfest_inner").removeClassName("window_wobble")}},1000)};oktoberfest.prototype.login=function(){var b="hideDiv('globaltransp'); hideDiv('globalbox');";var a='<div id="oktoberfest_dialog">';a+="  <div>"+t_oktoberfest_daily_login.replace("%AMOUNT%",this.data.config.daily_points)+"</div>";a+='  <div class="reward">';a+='    <div class="col1 "></div>';a+='    <div class="col2">'+this.data.config.daily_points+"x</div>";a+="  </div>";a+='  <div class="button_yes link" onclick="'+b+'"></div>';a+="</div>";globalcommitbox(t_oktoberfest_name,a,0,b,1);hideDiv("globalbox_footer")};oktoberfest.prototype.build=function(){this.currentSheep=0;var d="";d+='<div class="head">'+t_oktoberfest_name+"</div>";d+='<div id="oktoberfest_slots" class="slots"></div>';d+='<div id="oktoberfest_sheeps" class="sheeps"></div>';d+='<div id="oktoberfest_info" class="info">';d+='  <div class="line">';d+='    <div class="col2">';d+='      <div style="float:left;">'+t_vet_reward_head+":&nbsp;</div>";d+='      <div class="oktoberfest_points2_icon" style="float:left; margin-right:2px; margin-top:-3px;"></div>';d+='      <div id="oktoberfest_info_reward" style="float:left;"></div>';d+='      <div class="info_button" onmouseover="showDiv(\'oktoberfest_info_button_tt\')" onmouseout="hideDiv(\'oktoberfest_info_button_tt\')">';d+='        <div id="oktoberfest_info_button_tt" class="ttbox"></div>';d+="      </div>";d+='      <div class="clear"></div>';d+="    </div>";d+="  </div>";d+='  <div id="oktoberfest_info_finish" class="button_new finish link" onclick="oktoberfest.finishCommit()">'+t_oktoberfest_button_finish+"</div>";d+="</div>";var l=0;if(this.data.data.points2){l=((this.data.data.points2*100)/this.data.config.max)}d+='<div id="oktoberfest_reward_box" class="reward_box">';d+='  <div class="reward">';d+='    <div class="bar">';d+='      <div class="bar_inner" style="height:'+l+'%"></div>';d+="    </div>";var b=1;for(var c in this.data.config.rewards){var l=((this.data.config.rewards[c].points*100)/this.data.config.max);d+='<div class="price" style="bottom:'+l+'%" onmouseover="showDiv(\'oktoberfest_rewards_price'+c+"_tt')\" onmouseout=\"hideDiv('oktoberfest_rewards_price"+c+"_tt')\">";var q="";var m="";if(this.data.config.rewards[c].powerup){var l=0;for(var a in this.data.config.rewards[c].powerup){if(!formulas[0][a]){break}l=formulas[0][a][5][3]}d+='<div class="powerup"></div>';q="ispowerup";m="<div>"+formulas[0][a][5][3]+"%&nbsp;"+t_pointsboost_unit+"</div>"}if(this.data.config.rewards[c].giftid||this.data.config.rewards[c].products||this.data.config.rewards[c].moneypackage){if(m!=""){m+='<div style="margin:5px 0px; width:100%; text-align:center;">+</div>'}d+='<div class="bubble">';d+='  <div class="back"></div>';if(this.data.config.rewards[c].products){d+='<div class="product_package size'+this.data.config.rewards[c].products+'"></div>';m+="<div>"+t_reward_products+"</div>";if(this.data.data.reward&&this.data.data.reward[c]){m+='<div style="margin-top:5px;">';for(var e in this.data.data.reward[c]){m+=htmlProductBody(e,this.data.data.reward[c][e])}m+="</div>"}}if(this.data.config.rewards[c].moneypackage){d+='<div class="money_package size'+this.data.config.rewards[c].moneypackage+'"></div>';m+="<div>"+t_moneypackage_size[this.data.config.rewards[c].moneypackage]+"</div>";if(this.data.data.reward&&this.data.data.reward[c]){m+='<div style="margin-top:5px;">';m+="  <div>"+formatPrice(this.data.data.reward[c])+"</div>";m+="</div>"}}if(this.data.config.rewards[c].giftid){d+='<div class="giftid giftid'+this.data.config.rewards[c].giftid+'"></div>';m+="<div>"+t_pan_item+"</div>"}d+="</div>"}d+='  <div class="amount">'+formatNumber(this.data.config.rewards[c].points)+"</div>";if(this.data.data.reward&&this.data.data.reward[c]){d+='<div class="ready megafield_product_ready '+q+'"></div>'}else{b=0}d+='  <div id="oktoberfest_rewards_price'+c+'_tt" class="ttbox '+q+'">'+m+"</div>";d+="</div>"}d+="  </div>";var h=0;if(this.data.data.points2){h=this.data.data.points2}var n=this.data.config.max;d+='  <div class="points2">';d+="    <div>"+formatNumber(h)+"/"+formatNumber(n)+"</div>";if(parseInt(h)<parseInt(n)){d+='<div class="buy link" onclick="oktoberfest.buyCommit()" onmouseover="showDiv(\'oktoberfest_buy_tt\')" onmouseout="hideDiv(\'oktoberfest_buy_tt\')">';d+='  <div id="oktoberfest_buy_tt" class="ttbox">'+t_tinkergame_buyitem_head.replace("%NAME%",t_oktoberfest_item_name)+"</div>";d+="</div>"}d+="  </div>";d+='  <div id="oktoberfest_reward_box_opener" class="opener link" onclick="oktoberfest.toogleRewardBox()" onmouseover="showDiv(\'oktoberfest_rewardbox_opener_tt\')" onmouseout="hideDiv(\'oktoberfest_rewardbox_opener_tt\')">';d+='    <div class="arrow"></div>';d+='    <div class="star"></div>';d+='    <div id="oktoberfest_rewardbox_opener_tt" class="ttbox">'+t_oktoberfest_goto_reward+"</div>";d+="  </div>";d+="</div>";d+='<div class="timer">'+t_event_resttime+':&nbsp;<span id="oktoberfest_timer"></span></div>';d+='<div id="oktoberfest_cooldown" class="cooldown">';d+='  <div class="transp"></div>';d+='  <div class="cooldown_timer">';d+="    <div>"+t_oktoberfest_cooldown_timer+"</div>";d+='    <div class="counter" id="oktoberfest_cooldown_timer"></div>';d+='    <div class="link coinsbutton_flex link" onclick="oktoberfest.speedupCommit()">'+t_oktoberfest_speedup_button+"</div>";if(b){d+="<div>"+t_oktoberfest_cooldown_all_prizes+"</div>"}d+="  </div>";d+="</div>";d+='<div id="oktoberfest_tutorial" class="tutorial">';d+='  <div class="transp"></div>';d+='  <div id="oktoberfest_tutorial_char" class="char"></div>';d+='  <div id="oktoberfest_tutorial_bubble" class="bubble"></div>';d+="</div>";d+='<div class="helpbutton_blue link" onclick="oktoberfest.help();"></div>';d+='<div class="mini_close link" onclick="oktoberfest.close();"></div>';$("oktoberfest_inner").innerHTML=d;this.buildSlots();this.buildSheeps();showDiv("oktoberfest");setTimer("oktoberfest");this.timerUpdate();if($("oktoberfest_cheat_id")){$("oktoberfest_cheat_id").value=this.data.data.setup}};oktoberfest.prototype.toogleRewardBox=function(){if($("oktoberfest_reward_box").hasClassName("open")){$("oktoberfest_reward_box").removeClassName("open")}else{$("oktoberfest_reward_box").addClassName("open")}};oktoberfest.prototype.buyCommit=function(){var b=t_tinkergame_buyitem_head.replace("%NAME%",t_oktoberfest_item_name);var a=t_tinkergame_buyitem_line.replace("%NAME%",t_oktoberfest_item_name);events.buyCommit({name:"oktoberfest",buydata:this.data.config.buy,fn:"oktoberfest.buy",head:b,line:a})};oktoberfest.prototype.finishCommit=function(){if($("oktoberfest_info_finish").hasClassName("off")){return 1}else{this.finish()}};oktoberfest.prototype.speedupCommit=function(){var e=Math.round((this.data.data.cooldown_remain*100)/this.data.config.cooldown_timer);var a=Math.ceil(this.data.config.cooldown_max_coins*(e/100));var d="oktoberfest.speedup()";var b="";if(parseInt(a)>parseInt(user_coins)){d="hideDiv('globalbox'); hideDiv('globaltransp');";b="important"}var c='<div class="oktoberfest_commit">';c+="  <div>"+t_oktoberfest_speedup_body.replace("%COST%",'<span class="'+b+'" style="font-weight:bold;">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";c+="</div>";globalcommitbox(t_oktoberfest_speedup_head,c,d);if(b!=""){hideDiv("globalbox_button1")}};oktoberfest.prototype.buildSlots=function(){var h={};for(var c in this.data.data.sheeps){if(!this.data.data.sheeps[c].slot){continue}h[this.data.data.sheeps[c].slot]=c}var d=this.max;var b="";for(var c=1;c<=d;c++){var a="";if(c>(d/2)){a="bottom"}var e="oktoberfest.selectSlot("+c+")";if(h[c]){e="";a+=" placed"}b+='<div id="oktoberfest_slot'+c+'" class="slot '+a+'" onclick="'+e+'">';b+='  <div id="oktoberfest_slot'+c+'_shadow" class="shadow"></div>';if(h[c]){b+=this.showSheep(h[c],c,1)}if(c%(d/2)!=0){b+='<div id="oktoberfest_connect_'+c+'" class="connect">';b+="</div>"}if(c<=(d/2)){b+='<div id="oktoberfest_connect2_'+c+'" class="connect2">';b+="</div>"}b+="</div>"}b+='<div class="clear"></div>';$("oktoberfest_slots").innerHTML=b;this.checkConnections()};oktoberfest.prototype.showSheep=function(h,l,e){if(e){var d="oktoberfest.unsetSheep("+h+", "+l+")"}else{var d="oktoberfest.selectSheep("+h+")"}var a=1;if(!e){a=this.data.data.sheeps[h].pos1}else{if(l<=8){a=this.data.data.sheeps[h].pos2}else{a=this.data.data.sheeps[h].pos3}}var c="";c+='<div class="char char'+a+'" onclick="'+d+'">';c+='  <div class="interests">';for(var b=0;b<this.data.data.sheeps[h].interests.length;b++){c+='<div class="interest interest'+this.data.data.sheeps[h].interests[b]+'"></div>'}c+="  </div>";c+="</div>";return c};oktoberfest.prototype.buildSheeps=function(){var a=this.max;var c="";for(var b=1;b<=a;b++){c+='<div id="oktoberfest_sheep'+b+'" class="sheep">';if(this.data.data.sheeps&&this.data.data.sheeps[b]){if(!this.data.data.sheeps[b].slot){c+=this.showSheep(b)}}c+='  <div class="shadow"></div>';c+="</div>"}c+='<div class="clear"></div>';$("oktoberfest_sheeps").innerHTML=c};oktoberfest.prototype.selectSheep=function(b){var c=[];for(var a in this.data.data.sheeps){$("oktoberfest_slot"+a).removeClassName("placeable");$("oktoberfest_sheep"+a).removeClassName("selected");if(this.data.data.sheeps[a].slot){c.push(this.data.data.sheeps[a].slot)}}if(this.currentSheep==b){this.currentSheep=0;return 1}for(var a=1;a<=this.max;a++){if(in_array(a,c)){continue}$("oktoberfest_slot"+a).addClassName("placeable")}this.currentSheep=b;$("oktoberfest_sheep"+b).addClassName("selected")};oktoberfest.prototype.selectSlot=function(b){if(this.currentSheep>0){for(var a in this.data.data.sheeps){if(this.data.data.sheeps[a].slot==b){return 1}}this.setSheep(b)}};oktoberfest.prototype.checkConnections=function(){var l=0;var r={};for(var b in this.data.data.sheeps){if(!this.data.data.sheeps[b].slot){continue}r[this.data.data.sheeps[b].slot]=b;l++}var w=0;for(var b=1;b<=this.max;b++){if($("oktoberfest_connect_"+b)){$("oktoberfest_connect_"+b).removeClassName("okay")}if($("oktoberfest_connect2_"+b)){$("oktoberfest_connect2_"+b).removeClassName("okay")}var u=(b+1);if(!in_array(b,[(this.max/2),this.max])&&r[b]&&r[u]){for(var a in this.data.data.sheeps[r[b]].interests){var c=this.data.data.sheeps[r[b]].interests[a];if(isNaN(c)){continue}if(in_array(c,this.data.data.sheeps[r[u]].interests)){if($("oktoberfest_connect_"+b)){$("oktoberfest_connect_"+b).addClassName("okay");w++}break}}}var u=(b+(this.max/2));if(b<=(this.max/2)&&r[b]&&r[u]){for(var a in this.data.data.sheeps[r[b]].interests){var c=this.data.data.sheeps[r[b]].interests[a];if(isNaN(c)){continue}if(in_array(c,this.data.data.sheeps[r[u]].interests)){if($("oktoberfest_connect2_"+b)){$("oktoberfest_connect2_"+b).addClassName("okay");w++}break}}}}if(w>=22){var d='<div id="oktoberfest_confetti" class="confetti"></div>';$("oktoberfest_slots").insert(d);this.stopConfetti()}var t=(parseInt(w)*parseInt(this.data.config.points_per_connection));var q=Math.round(0.6*Math.pow(w,2));var v=(t+q);var s="";var e=1;var n=checkFarmhouseBonus(this.data.config.token);if(n&&n.points){e+=n.points;s="bonus"}v=Math.ceil(v*e);var m="";m+='<div class="lline"><div class="coll1">'+t_eventgarden_eventitem.brezels+'</div><div class="coll2">'+formatNumber(t)+'</div><div class="clear"></div></div>';m+='<div class="lline"><div class="coll1">'+t_oktoberfest_info_bonus+'</div><div class="coll2">+'+formatNumber(q)+'</div><div class="clear"></div></div>';m+='<div class="lline"><div class="coll1">'+t_megafield_reward_sum+'</div><div class="coll2 '+s+'">'+formatNumber(v)+'</div><div class="clear"></div></div>';if(e>1){m+='<div class="lline bonus">'+t_pentecostevent_farmhouse_bonus.replace("%PERCENT%",Math.round(n.points*100))+"</div>"}$("oktoberfest_info_button_tt").innerHTML=m;$("oktoberfest_info_finish").removeClassName("off");$("oktoberfest_info_reward").innerHTML=formatNumber(v);if(parseInt(l)<parseInt(this.data.config.min_placed)){$("oktoberfest_info_finish").addClassName("off")}};oktoberfest.prototype.stopConfetti=function(){setTimeout(function(){if($("oktoberfest_confetti")){$("oktoberfest_confetti").remove()}},1000)};oktoberfest.prototype.help=function(){showDiv("oktoberfest_help")};oktoberfest.prototype.closeHelp=function(){hideDiv("oktoberfest_help")};oktoberfest.prototype.startTutorial=function(){this.tutorialStep=0;showDiv("oktoberfest_tutorial");this.nextTutorialStep()};oktoberfest.prototype.nextTutorialStep=function(){this.tutorialStep++;if(!t_oktoberfest_tutorial_text[this.tutorialStep]){this.closeTutorial();return 1}var d="oktoberfest.nextTutorialStep()";var c=t_continue;if(!t_oktoberfest_tutorial_text[(this.tutorialStep+1)]){d="oktoberfest.closeTutorial();";c=t_vineyard_tutorial_text_finish}var e=t_oktoberfest_tutorial_text[this.tutorialStep];e=e.replace("%USERNAME%","<b>"+username+"</b>");this.resetTutorial();if(this.tutorialStep==2){$("oktoberfest_sheeps").addClassName("istutorial");for(var b=1;b<=this.max;b++){$("oktoberfest_sheep"+b).addClassName("pulse")}}if(this.tutorialStep==3){$("oktoberfest_slots").addClassName("istutorial");for(var b=1;b<=this.max;b++){$("oktoberfest_slot"+b).addClassName("pulse");$("oktoberfest_slot"+b+"_shadow").addClassName("white")}}if(this.tutorialStep==5){$("oktoberfest_info").addClassName("istutorial").addClassName("pulse")}if(this.tutorialStep==6){$("oktoberfest_reward_box").addClassName("istutorial");oktoberfest.toogleRewardBox()}if(this.tutorialStep==7){oktoberfest.toogleRewardBox()}var a="";if(this.tutorialStep==4){a+='<div class="example" style="float:left;"></div>';a+='<div style="float:left; width:155px; margin-left:5px;">'+e+"</div>";a+='<div class="clear"></div>'}else{a+=e}a+='<div id="oktoberfest_tutorial_footer" class="footer"><button class="button_new link" onclick="'+d+'">'+c+"</button></div>";$("oktoberfest_tutorial_bubble").innerHTML=a;$("oktoberfest_tutorial").className="tutorial step"+this.tutorialStep};oktoberfest.prototype.resetTutorial=function(){$("oktoberfest_sheeps").removeClassName("istutorial");$("oktoberfest_slots").removeClassName("istutorial");$("oktoberfest_info").removeClassName("istutorial").removeClassName("pulse");$("oktoberfest_reward_box").removeClassName("istutorial").removeClassName("pulse");for(var a=1;a<=this.max;a++){$("oktoberfest_slot"+a).removeClassName("pulse");$("oktoberfest_sheep"+a).removeClassName("pulse");$("oktoberfest_slot"+a+"_shadow").removeClassName("white")}};oktoberfest.prototype.closeTutorial=function(){this.resetTutorial();hideDiv("oktoberfest_tutorial")};oktoberfest.prototype.flyer=function(b){var a='<div class="img oktoberfest_item_flyer"></div>';a+='<div class="amount">'+b+"x</div>";a+='<div class="clear"></div>';events.flyer({id:"oktoberfest_link",name:"oktoberfest",html:a,idle:"idle",move:"up"})};oktoberfest.prototype.timer=function(){this.data.data.remain--;if(this.data.data.cooldown){this.data.data.cooldown_remain--}this.timerUpdate()};oktoberfest.prototype.timerUpdate=function(){if($("oktoberfest_timer")){$("oktoberfest_timer").innerHTML=formatTime(this.data.data.remain)}hideDiv("oktoberfest_cooldown");if($("oktoberfest_cooldown")&&this.data.data.cooldown){if(this.data.data.cooldown_remain>0){$("oktoberfest_cooldown_timer").innerHTML=formatTime(this.data.data.cooldown_remain);showDiv("oktoberfest_cooldown");hideDiv("oktoberfest_slots");hideDiv("oktoberfest_sheeps")}else{if(this.data.data.cooldown_remain==-1){this.data.data.cooldown=0;this.build()}}}};oktoberfest.prototype.close=function(){hideDiv("oktoberfest")};var anzahl,w_zeit,global_x,global_y,regal_leer,kategorie,iKategorie;var mode=0;var stadt=false;var wasserinterval=null;var selected=null;var cache_actions=5;var cache_fire=1000;var cache_timeout=null;var cache=new Array();var timeoutKundeGeht=null;var timeoutBlaseGeht=null;var neuerKundeLaeuft=null;var timeoutKundeLaeuft=null;var timeoutKundeRutscht=null;var neu_lastLeft=null;var letzterKunde;var to_letzterKunde;var to_lastLeft;var to_letztesPic;var kunden=new Array();var pfeile=new Array();var busLeft;var cars=new Array();var carCount=0;var lastCar=-1;var pLeer=false;Array.prototype.contains=function(b){var a;for(a=0;a<this.length;a++){if(this[a]===b){return true}}return false};function createAjaxRequestObj(){var d=null;var a=new Array("MSXML2.XMLHttp.6.0","MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp");if(document.getElementById&&window.XMLHttpRequest){d=new XMLHttpRequest()}if(window.ActiveXObject){for(var c=0;c<a.length;c++){try{d=new ActiveXObject(a[c])}catch(b){}}}return d}function show_built(e,b){var u=new Array();var h=new Array();if(farm<=4){f=1}else{f=farm}var a=farm_garden_products[f];if(b=="over"){var q=produkt_category[garten_prod[e]];if((q=="v"||q=="ex"||q=="alpin"||q=="hr"||q=="water"||q=="spice")&&gartenshortinfo==1){gardenShowPlantInfo(e)}if(mode==1){var r=garten_x[e];var n=garten_y[e];var m=garten_max_x[e];var t=garten_max_y[e];u=berechneFelder(e,r,n,m,t);for(d=0;d<u.length;d++){if(garten_prod[u[d]]!=0){if(m==1&&t==1){h[0]="cursors/cursor_ernten"}else{if(m==2&&t==1){h[d]="cursors/ernten2_"+(d+1)}else{h[d]="cursors/ernten_"+(d+1)}}}else{h[d]="cursors/no"}}}else{if(mode==2){var r=garten_x[e];var n=garten_y[e];var m=garten_max_x[e];var t=garten_max_y[e];jsTimeStamp=Zeit.Client-Zeit.Verschiebung;letztesWasser=jsTimeStamp-(24*60*60);u=berechneFelder(e,r,n,m,t);for(d=0;d<u.length;d++){if(garten_prod[u[d]]==0){h[d]="cursors/no"}else{if(garten_zeit[u[d]]<=jsTimeStamp){h[d]="cursors/no"}else{if(garten_wasser[u[d]]>=letztesWasser){h[d]="cursors/no"}else{if(!in_array(garten_kategorie[u[d]],["v","ex","alpin","hr","water","spice"])){h[d]="cursors/no"}else{if(m==1&&t==1){h[0]="cursors/cursor_giessen"}else{if(m==2&&t==1){h[d]="cursors/giessen2_"+(d+1)}else{h[d]="cursors/giessen_"+(d+1)}}}}}}}}else{if(mode==0){if(regal_leer==1){u=berechneFelder(e,1,1,1,1);h[0]="cursors/no"}else{if(selected>0){l=selected;max_x=produkt_x[l];max_y=produkt_y[l];u=berechneFelder(e,1,1,max_x,max_y);r=1;n=1;for(d=0;d<u.length;d++){if(u[d]==false){continue}else{if(u.contains(false)){h[d]="cursors/no"}else{if(garten_prod[u[d]]==0){if(max_x==1&&max_y==1){if(in_array(iKategorie,a)){h[0]="cursors/cursor_saat";if(iKategorie=="z"){h[0]="cursors/cursor_zier"}}else{h[0]="cursors/cursor_forbidden"}}else{if(max_x==2&&max_y==1){if(in_array(iKategorie,a)){h[d]="cursors/pflanzer2_"+(d+1);if(iKategorie=="z"){h[d]="cursors/zierer2_"+(d+1)}}else{h[d]="cursors/forbidden2_"+(d+1)}}else{if(in_array(iKategorie,a)){h[d]="cursors/pflanzer_"+(d+1);if(iKategorie=="z"){h[d]="cursors/zierer_"+(d+1)}}else{h[d]="cursors/forbidden_"+(d+1)}}}}else{h[d]="cursors/no"}}}if(r==max_x){r=1;n++}else{r++}}}}}else{if(mode==-1){max_x=produkt_x[selected];max_y=produkt_y[selected];u=berechneFelder(e,1,1,max_x,max_y);for(d=0;d<u.length;d++){h[d]="0"}}}}}}else{if(b=="out"){if(gartenshortinfo==1){hideGardenRemainTimeTitle()}if(mode==1){r=garten_x[e];n=garten_y[e];max_x=garten_max_x[e];max_y=garten_max_y[e];u=berechneFelder(e,r,n,max_x,max_y);for(d=0;d<u.length;d++){h[d]="0"}}else{if(mode==2){r=garten_x[e];n=garten_y[e];max_x=garten_max_x[e];max_y=garten_max_y[e];u=berechneFelder(e,r,n,max_x,max_y);for(d=0;d<u.length;d++){h[d]="0"}}else{if(mode==0){if(regal_leer==1){u=berechneFelder(e,1,1,1,1);h[0]="0"}else{if(regal_leer==0){if(selected){var l=selected;max_x=produkt_x[l];max_y=produkt_y[l]}else{max_x=global_x;max_y=global_y}u=berechneFelder(e,1,1,max_x,max_y);for(d=0;d<u.length;d++){h[d]="0"}}}}else{if(mode==-1){max_x=produkt_x[selected];max_y=produkt_y[selected];u=berechneFelder(e,1,1,max_x,max_y);for(d=0;d<u.length;d++){h[d]="0"}}}}}}}var s=false;for(var d=0;d<cache.length;d++){elem=cache[d]["felder"];for(var c=0;c<elem.length;c++){if(u.contains(elem[c])){s=true;break}}if(s==true){break}}if(!s){for(d=0;d<u.length;d++){if(u[d]==false){continue}else{document.getElementById("b"+u[d]).src=_GFX+h[d]+".gif"}}}}function cache_me(E,u,C,r){clearTimeout(cache_timeout);var z=0;for(z;z<cache_actions;z++){if(cache[z]==null){if(u>0){switch(mode){case -1:var b=new Array();break;case 0:var b=berechneFelder(u,1,1,global_x,global_y);break;case 1:var m=garten_x[u];var l=garten_y[u];var D=garten_max_x[u];var A=garten_max_y[u];var b=berechneFelder(u,m,l,D,A);break;case 2:var m=garten_x[u];var l=garten_y[u];var D=garten_max_x[u];var A=garten_max_y[u];var b=berechneFelder(u,m,l,D,A);break}var n=true;if(b.contains(false)){n=false}if(in_cache(b)){n=false}if(r=="u"){document.getElementById("raeumFeld").value=u;document.getElementById("raeumFeldPosition").value=E;var F="raeumeFeld(document.getElementById('raeumFeldPosition').value,document.getElementById('raeumFeld').value)";var v="";v+=str_replace("%COST%","<b>"+formatPrice(garten_entf[u])+"</b>",gardenremoveweed);commitboxgarden(removeweedheadline,v,F,2);n=false}else{letztesWasser=Zeit.Client-Zeit.Verschiebung-(24*60*60);for(var w=0;w<b.length;w++){switch(mode){case -1:n=false;break;case 0:if(selected){if(garten_prod[b[w]]!=0){n=false}break}else{n=false}case 1:var B=document.getElementById("b"+u).alt;var h=garten_prod[u];var c=(parseInt(garten_zeit[u])+parseInt(Zeit.Verschiebung))-parseInt(Zeit.Client);if(garten_prod[b[w]]==0){n=false}else{if(c>=0&&garten_kategorie[u]!="z"){document.getElementById("ernteFeld").value=u;document.getElementById("ernteFeldPosition").value=E;document.getElementById("ernteProd").value=h;var v=gardennonecrop;var F="document.getElementById('ernteJa').value='ernteJa';top.ernteFeld(document.getElementById('ernteFeldPosition').value,document.getElementById('ernteFeld').value);document.getElementById('erntepopup').style.display='none';document.getElementById('glock').style.display='none';";commitboxgarden(errorheadline,v,F,2);n=false}}break;case 2:if(garten_prod[b[w]]==0){n=false}else{if(garten_zeit[b[w]]<=jsTimeStamp){n=false}else{if(garten_wasser[b[w]]>=letztesWasser){n=false}else{if(!in_array(garten_kategorie[b[w]],["v","ex","alpin","hr","water","spice"])){n=false}}}}break}}}if(n==true){var t=1;if(selected&&mode==0){if(farm<=4){f=1}else{f=farm}var e=farm_garden_products[f];if(!in_array(iKategorie,e)){t=0}}if(t==1){cache[z]=new Object();cache[z]["feld"]=u;cache[z]["produkt"]=C;cache[z]["kategorie"]=r;if(mode==1){cache[z]["pflanze"]=h}else{cache[z]["pflanze"]=selected}cache[z]["mode"]=mode;cache[z]["felder"]=b;if(mode==0){var a=checkRackItem(selected,farm);if(a){var d=0;for(var s=0;s<cache.length;s++){if(cache[s]["pflanze"]==selected){d++}}if(d>=a){save_actions(E);selected=0;selectMode(1)}}}for(var w=0;w<b.length;w++){$("b"+b[w]).src=_GFX+"loading.gif";$("f"+b[w]).addClassName("plant_pulse")}}}}break}}if(z==(cache_actions-1)){save_actions(E)}else{cache_timeout=setTimeout("save_actions("+E+")",cache_fire)}}function save_actions(a){var l=new Array();var b="";var h="";var d="";for(var e=0;e<cache.length;e++){switch(cache[e]["mode"]){case 0:if(cache[e]["pflanze"]===null||cache[e]["pflanze"]===-1){continue}b=b+"&pflanze[]="+cache[e]["pflanze"]+"&feld[]="+cache[e]["feld"]+"&felder[]="+cache[e]["felder"];break;case 1:if(cache[e]["pflanze"]===null||cache[e]["pflanze"]===-1){continue}h=h+"&pflanze[]="+cache[e]["pflanze"]+"&feld[]="+cache[e]["feld"]+"&felder[]="+cache[e]["felder"];break;case 2:d=d+"&feld[]="+cache[e]["feld"]+"&felder[]="+cache[e]["felder"];break}for(var c=0;c<cache[e]["felder"].length;c++){document.getElementById("b"+cache[e]["felder"][c]).src=_GFX+"0.gif"}}if(b.length>0){b=b.substring(1,b.length);farmAction("garden_plant",farm,a,b,wasserinterval)}if(h.length>0){h=h.substring(1,h.length);farmAction("garden_harvest",farm,a,h)}if(d.length>0){waterFunc(farm,a,d)}cache=new Array()}function waterFunc(b,a,c){c=c.substring(1,c.length);farmAction("garden_water",b,a,c)}function in_cache(a){for(var c=0;c<a.length;c++){for(var b=0;b<cache.length;b++){if(cache[b]["felder"].contains(a[c])){return true}}}return false}function berechneFelder(d,q,m,n,s){d=parseInt(d,10);q=parseInt(q,10);m=parseInt(m,10);n=parseInt(n,10);s=parseInt(s,10);var a;if(s==1){a=0}else{if(q==1&&m==1){a=0}else{a=(m-s+1)*maxfieldsx}}var h=d-q-Math.abs(a);var t=new Array();var r=h;var l=0;var e=0;for(var c=0;c<s;c++){e=r+n;for(var b=0;b<n;b++){r++;if(t[l]==null){if(r>fieldsamount){t[l]=false}else{if((r%maxfieldsx)==0){if(n==1){t[l]=parseInt(r,10)}else{if(r<e){t[l]=parseInt(r,10);anz_err=e-r;for(k=1;k<=anz_err;k++){t[l+k]=false}}else{t[l]=parseInt(r,10)}}}else{t[l]=parseInt(r,10)}}}l++}r=h+((c+1)*maxfieldsx)}return t}function show_page(d,a){gclr();var b;if(d=="msg"){b="nachrichten/inbox.php"}else{if(d=="cont"){b="vertraege/overview.php"}else{if(d=="prof"){b="nutzer/profil.php"}else{if(d=="help"){b="hilfe.php"}else{if(d=="muede"){b="muede.php"}else{if(d=="coins"){openCoinsBox();return false}}}}}}var c=0;while(document.getElementById("kunde"+c)){document.getElementById("kunde"+c).style.display="none";c++}g("multiframe").src=b;g("multiframe").style.display="block"}function gclr(){}function close_page(){gclr();var a=0;while(document.getElementById("kunde"+a)){document.getElementById("kunde"+a).style.display="block";a++}g("multiframe").src="";g("multiframe").style.display="none";if(mode==0&&stadt==false){g("lagerlock").style.display="none"}}function startTutorialPart2(){increaseTutorialStep();tutorial=7;showDiv("blockmainnavi");setBlockMain();$("continuetutorial").style.backgroundImage="url("+imgpath+"tutorial_continue.gif)";showDiv("continuetutorial")}function continueTutorial(){hideDiv("continuetutorial");hideDiv("gardenmaincontainer");hideDiv("transp");hideDiv("blockmainnavi");setBlockMain(1);showDiv("blockmainnavi");setBlockMain(2);setTutorialLine();showTutorial(12,1)}function AbrissResponse(a){if(a.success==1){hideDiv("globalbox");hideDiv("globaltransp");hideDiv("transp8");document.getElementById("f"+a.feld).style.background="url("+_GFX+"0.gif)";document.getElementById("b"+a.feld).alt="";document.getElementById("b"+a.feld).src=_GFX+"0.gif";document.getElementById("w"+a.feld).src=_GFX+"0.gif";document.getElementById("unkrautpopup").style.display="none";document.getElementById("glock").style.display="none";garten_prod[a.feld]=0;garten_x[a.feld]=1;garten_y[a.feld]=1;garten_max_x[a.feld]=1;garten_max_y[a.feld]=1;garten_gttpic[a.feld]="";garten_zeit[a.feld]=0;garten_ernte[a.feld]="";garten_wasser[a.feld]="";garten_kategorie[a.feld]="";garten_entf[a.feld]="";gclr();if(a.fund==1){document.getElementById("fundpopupbetrag").innerHTML=a.betrag;document.getElementById("glock").style.display="block";document.getElementById("fundpopup").style.display="block"}}else{if(a.bot==1||a.session_tot==1){document.location.href="main.php?page=logout"}if(a.muede==1){document.getElementById("unkrautpopup").style.display="none";document.getElementById("glock").style.display="none";show_page("muede")}else{document.getElementById("unkrautpopup").style.display="none";errorboxgarden(a[1])}}}function raeumeFeld(a,b){farmAction("garden_removeweed",farm,a,b)}function ernteFeld(c,b){var a=garten_prod[b];var h=produkt_x[a];var n=produkt_y[a];var l=garten_x[b];var e=garten_y[b];var q=berechneFelder(b,l,e,h,n);var d=document.getElementById("ernteProd").value;var m=document.getElementById("ernteJa").value;farmAction("garden_harvest",farm,c,d,q[0],q,m)}function endTutorial(){var a=createAjaxRequestObj();a.open("GET","tutorial/endtutorial.php?rid="+rid,true);a.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");a.onreadystatechange=function(){document.getElementById("tutorial_div").style.display="none"};a.send(null)}function close_tutorial(){if(document.getElementById("current_step").value==4){endTutorial()}else{document.getElementById("tutorial_div").style.display="none"}}function checkWasser(){var a=Zeit.Client-Zeit.Verschiebung-(24*60*60);for(x in water){if(water[x]<=a){if(document.getElementById("w"+x)){document.getElementById("w"+x).src=_GFX+"0.gif";water[x]=undefined}}}}function deleteCursor(){var b=document.getElementById("b1");if(b){for(var a=1;a<=fieldsamount;a++){document.getElementById("b"+a).src=_GFX+"0.gif"}}else{setTimeout("deleteCursor()",1000)}}var tutorial_plant_timeout=0;var tutorial_plant_timeout_time=0;function wachse(A,e,h,B){if(tutorial==3){h=30}var n=parseInt(produkt_x[e]);var m=parseInt(produkt_y[e]);var a=berechneFelder(A,1,1,n,m);window.clearTimeout(to[a[0]]);var q=garten_kategorie[a[0]];if(in_array(q,["v","hr","ex","alpin","water","spice"])){var t=20}else{if(q=="z"){var t=0}}var z=Zeit.Client-Zeit.Verschiebung;var b=z-B;var F=(h-t)/3;var w=null;if(q=="z"){var d=4;var w=null}else{if(b<t){var d=0;w=Math.ceil(t-b)}else{if(b>=t&&b<(t+F)){var d=1;w=Math.ceil((t+F)-b)}else{if(b>=(t+F)&&b<(t+(F*2))){var d=2;w=Math.ceil((t+(F*2))-b)}else{if(b>=(t+(F*2))&&b<(t+(F*3))){var d=3;w=Math.ceil((t+(F*3))-b)}else{var d=4;if(tutorial==3){hideDiv("tutorial4_1");hideDiv("tutorial5");hideDiv("transp8");hideDiv("globalbox");hideDiv("globaltransp");showTutorial(5,2)}}}}}}var u=0;u=produkt_img[e].slice(0,-1)+d;var l="";var v;if(document.getElementById("w"+A)){v=document.getElementById("w"+A).src}if(d==4){l=parseInt(produkt_ernte[e],10);v=_GFX+"0.gif"}if(d==0){if(n==1&&m==1){var D="buddler"}else{if(n==2&&m==2){var D="buddler2"}else{if(n==2&&m==1){var D="buddler3"}}}}var C=0;for(var s=1;s<=m;s++){for(var E=1;E<=n;E++){if(n==1&&m==1){if(d==0){document.getElementById("f"+a[C]).style.background="url("+_GFX+"produkte/"+D+".gif)"}else{document.getElementById("f"+a[C]).style.background="url("+_GFX+"produkte/"+u+".gif)"}}else{if(d==0){document.getElementById("f"+a[C]).style.background="url("+_GFX+"produkte/"+D+"."+s+"."+E+".gif)"}else{document.getElementById("f"+a[C]).style.background="url("+_GFX+"produkte/"+u+"."+s+"."+E+".gif)"}}document.getElementById("b"+a[C]).alt=l;document.getElementById("w"+a[C]).src=v;C++}}if(d<4){to[a[0]]=window.setTimeout("wachse( "+A+", "+e+", "+h+", "+B+" )",w*1000);if(tutorial==3){tutorial_plant_timeout_time=((parseInt(B)+parseInt(h))-parseInt(z));window.clearInterval(tutorial_plant_timeout);tutorial_plant_timeout=window.setInterval("specialTutorialTimer()",1000)}}else{if(tutorial==3){window.clearInterval(tutorial_plant_timeout)}}}function specialTutorialTimer(){tutorial_plant_timeout_time--;if($("tutorial_pid_timer")){$("tutorial_pid_timer").innerHTML=formatTime(tutorial_plant_timeout_time)}}function clearWachseTimeouts(){for(x in to){window.clearTimeout(to[x])}}function updatePlayerInfo(d,a,c,h,e,b){if(c){c=parseInt(c,10)}if(d){g("bar").innerHTML=d}if(a){g("coins").innerHTML=a}if(c){g("pkt").innerHTML=c.format()}if(h){g("level").innerHTML=h}if(b){g("username").innerHTML=b}}function updateMenuImages(b,a,d,c){$("mainmenue2_tt").innerHTML=d;$("mainmenue3_tt").innerHTML=c;lng_t_msg=d;lng_t_con=c}var updatemenue_data={};function updateMenu(){farmAction("updater",farm,1)}function questTutorial(){setTimeout(function(){showMain();questbarstatus=0;setQuestbarControl();showDiv("blockmainnavi");setBlockMain(2);var a="";a+='<div class="step_quest tutorial_box">';a+="  <div class=\"step_click link\" onclick=\"questAction('init',0,0,1,1); hideDiv('tutorial'); setBlockMain(1); hideDiv('blockmainnavi');\"></div>";a+='  <div class="step_animation tutorial_ani"></div>';a+='  <div class="step_quest_text tutorial_text">'+t_tutorial_step_quests+"</div>";a+="</div>";$("tutorial").innerHTML=a;showDiv("tutorial");$("tutorial").style.zIndex=200},500)}var carpentry_bonus=0;var user_points=0;var user_bar=0;var user_coins=0;var user_premium_bis="";var donkey_isset=0;var farmdog_isset=0;var farmdog_harvest=0;var reallocatebuilding_status=0;var reallocateanimals_status=0;var paymentitem_remain=0;var disable_autologout=0;function updateMenuGo(){var b=updatemenue_data;hideDiv("mainmenue2_incoming");hideDiv("mainmenue3_incoming");if(b.mail>0){showDiv("mainmenue2_incoming")}if(b.contracts>0){showDiv("mainmenue3_incoming")}if(b.forestry_unlock){forestry_unlock=1}if(parseInt($("levelnum").innerHTML)==2&&b.levelnum==3){questTutorial()}if(b.levelnum&&b.levelnum>currentuserlevel&&(t_level_array[b.levelnum])){levelupAlert(b.levelnum,t_level_array[b.levelnum],1)}if(b.levelnum){$("levelnum").innerHTML=b.levelnum}currentuserlevel=b.levelnum;if(currentuserlevel>=2){showDiv("sub_friendlist")}else{hideDiv("sub_friendlist")}if(currentuserlevel<questline_show_minlevel){hideDiv("questbarcontrol")}else{showDiv("questbarcontrol")}if(!b.main_flyer){main.statsFlyer(b.points,b.bar,b.coins)}hideDiv("collectevent_link");if(collectevent&&collectevent.data){if(collectevent.data.data&&collectevent.data.data.points&&collectevent.data.data.points>0){var m=(b.collectevent.data.points-collectevent.data.data.points);if(m>0){collectevent.flyer(m)}}collectevent.data=b.collectevent;if(collectevent.data.daily){collectevent.daily(collectevent.data.daily)}setTimer("collectevent");showDiv("collectevent_link")}hideDiv("tinkergame_link");if(tinkergame&&tinkergame.data){if(tinkergame.data.data&&tinkergame.data.data.items){var h={};for(var d=1;d<=10;d++){if(tinkergame.data.data.items[d]){var m=(b.tinkergame.data.items[d]-tinkergame.data.data.items[d]);if(m>0){h[d]=m}}}tinkergame.flyer(h)}tinkergame.data=b.tinkergame;setTimer("tinkergame");showDiv("tinkergame_link")}if(deliveryevent&&deliveryevent.data){if(deliveryevent.data.data&&deliveryevent.data.data.points&&deliveryevent.data.data.points>0){var m=(b.deliveryevent.data.points-deliveryevent.data.data.points);if(m>0){deliveryevent.flyer(m)}}deliveryevent.data=b.deliveryevent}if(oktoberfest&&oktoberfest.data){if(oktoberfest.data.data&&oktoberfest.data.data.points2&&oktoberfest.data.data.points2>0){var m=(b.oktoberfest.data.points2-oktoberfest.data.data.points2);if(m>0){oktoberfest.flyer(m)}}oktoberfest.data=b.oktoberfest}if(rainbowevent&&rainbowevent.data){if(rainbowevent.data.data&&rainbowevent.data.data.points&&rainbowevent.data.data.points>0){var m=(b.rainbowevent.data.points-rainbowevent.data.data.points);if(m>0){rainbowevent.flyer(m)}}rainbowevent.data=b.rainbowevent}if(coinsevent&&coinsevent.data){if(coinsevent.data.data&&coinsevent.data.data.coins&&coinsevent.data.data.coins>0){var m=(b.coinsevent.data.coins-coinsevent.data.data.coins);if(m>0){coinsevent.flyer(m)}}coinsevent.data=b.coinsevent}if(pentecostevent&&pentecostevent.data){var m={};if(pentecostevent.data.data){if(pentecostevent.data.data.water&&pentecostevent.data.data.water>0){m.water=(b.pentecostevent.data.water-pentecostevent.data.data.water)}if(pentecostevent.data.data.fertilizer&&pentecostevent.data.data.fertilizer>0){m.fertilizer=(b.pentecostevent.data.fertilizer-pentecostevent.data.data.fertilizer)}}pentecostevent.flyer(m);pentecostevent.data=b.pentecostevent}if(nutcracker&&b.nutcracker){nutcracker.data=b.nutcracker;setTimer("nutcracker")}updatePlayerInfo(formatPrice(b.bar),b.coins,b.points,b.level,0,b.uname);player_money=b.bar;var l=(b.points-b.levelcurrentlimit);var a=(b.levellimit-b.levelcurrentlimit);var e=Math.floor(l*100/a);if(e==0){e=1}var c=(165/100);$("player_pointsbar_inner").style.width=((e*c)+10)+"px";$("player_pointsbar_tt").innerHTML=t_level_status+"&nbsp;"+e+"%";remainpts=parseInt(b.levellimit)-parseInt(b.points);gclr();if(b.guildid){player_guild=b.guildid}if(b.guildmemberstatus){player_guildmemberstatus=b.guildmemberstatus}if(b.guildshort){$("guild").innerHTML="&nbsp;["+b.guildshort+"]"}else{$("guild").innerHTML=""}hideDiv("cropbonus_symbol");if(b.cropbonus){showCropBonus(b.cropbonus)}if(b.donkey){donkey_isset=1;showDonkey(b.donkey)}farmdog_isset=0;farmdog_harvest=0;if(b.farmdog){farmdog_isset=1}if(b.farmdog_harvest){farmdog_harvest=1}if(!b.no_farmslide){farm_move=1;farmBuildPositions()}else{farm_move=0}if(b.animalghosts){ghost_visible=1}else{ghost_visible=0}if(b.disable_autologout){disable_autologout=1}else{disable_autologout=0}hideDiv("carpentrybonus_symbol");if(b.carpentry_bonus){showCarpentryBonus(b.carpentry_bonus)}if(b.carpentrybonus_data){carpentry_data=b.carpentrybonus_data;if(carpentry_data.data.remain>0){gametimer.carpentrytimer=1}}hideDiv("sub_premium_info");hideDiv("sub_notepad");if(b.premium){premium=1;showDiv("sub_premium_info");$("premium_endtime").innerHTML=b.premium_bis;showDiv("sub_notepad")}hideDiv("reallocatebuilding_symbol");reallocatebuilding_status=0;if(b.reallocatebuilding){if(currentuserlevel>=reallocatebuildinglevel){if(farm>0&&!city){showDiv("reallocatebuilding_symbol")}else{hideDiv("reallocatebuilding_symbol")}reallocatebuilding_status=1}}hideDiv("reallocateanimals_symbol");reallocateanimals_status=0;if(b.reallocateanimals){if(currentuserlevel>=reallocatebuildinglevel){if(farm>0&&!city){showDiv("reallocateanimals_symbol")}else{hideDiv("reallocateanimals_symbol")}reallocateanimals_status=1}}user_points=b.points;user_bar=b.bar;user_coins=b.coins;user_premium_bis=b.premium_bis;paymentitem_remain=b.paymentitem_remain;if(b.tutorial){tutorial=b.tutorial}if(tutorial>0){showDiv("blockmainnavi")}else{hideDiv("blockmainnavi")}if(specialoffer&&b.specialoffer&&$("specialoffer_link")){specialoffer.data=b.specialoffer;setTimer("specialoffer");hideDiv("specialoffer_link");if(b.specialoffer&&b.specialoffer.active){showDiv("specialoffer_link");if(b.specialoffer.today){specialoffer.init(1)}}}if(specialbonus&&b.specialbonus){specialbonus.data=b.specialbonus;specialbonus.init()}if(b.guildjob){guildjob_quickview=b.guildjob;setTimeout(function(){guildJobQuickView()},1500)}else{hideDiv("guildjob_quickview")}if(b.giftevent&&giftevent){giftevent.data=b.giftevent;setTimer("giftevent")}if(b.teaser){teaser.data=b.teaser;teaser.build()}if(b.loginevent){loginevent.data=b.loginevent;setTimer("loginevent");if(loginevent.data.firstdailyvisit){loginevent.build()}}if(b.loginbonus){loginbonus.data=b.loginbonus;loginbonus.currentDay=loginbonus.data.data.count;setTimer("loginbonus");if(loginbonus.data.firstdailyvisit){loginbonus.build()}}if(b.premiumdiscount){premiumdiscount.data=b.premiumdiscount;setTimer("premiumdiscount");if(premiumdiscount.data.data&&premiumdiscount.data.data.daily&&premiumdiscount.data.data.remain>0){premiumdiscount.init()}}if(b.news){if(b.lastaction&&in_array(b.lastaction,["newlot","lotgetprize","buynewlot"])){}else{news=b.news;currentnews=1;showNews()}}showDiv("reallocatebuilding_symbol_alert");if(b.buildingOverviewToken){buildingOverviewToken=b.buildingOverviewToken;if(buildingOverviewToken){hideDiv("reallocatebuilding_symbol_alert")}}events.speedlinks();updateMenuImages(b.mail,b.contracts,b.lng_mail,b.lng_con);Zeit.init(b.time);servertimetime=b.servertime}var Zeit={Client:0,Server:0,Verschiebung:0,UpdateInterval:null,SyncRequest:null,init:function(a){this.Client=Math.round(new Date().getTime()/1000);this.Server=a;this.Verschiebung=this.Client-this.Server},update:function(){Zeit.Server++;Zeit.Client++}};var ginfo_interval=null;function ginfo(m,l,c,e,b,d){clearInterval(ginfo_interval);ginfo_interval=null;$("bubble_adtext").style.display="none";var a="";if(b=="z"){a+='<div style="position:absolute; top:10px; left:0px; width:200px;">';a+='  <font class="tnormal"><b>'+c+"</b></font><br>";a+='  <font class="tklein">'+lng_t_tt_zierwarnung+"</font><br>";a+="</div>"}else{if(b=="u"){a+='<div style="position:absolute; top:10px; left:0px; width:200px;">';a+='  <div class="tt'+l+'" style="float:left;margin-top:5px;margin-right:5px; border:2px solid #f00"></div>';a+='  <font class="tnormal"><b>'+c+"</b></font><br>";a+='  <font class="tklein">'+lng_t_tt_unkraut1+"</font><br>";a+='  <font class="tklein">'+lng_t_tt_unkraut2+"</font><br>";a+='  <font class="tklein">'+lng_t_tt_unkraut3+"&nbsp;"+formatPrice(d)+"</font><br>";a+="</div>"}else{a+='<div style="position:absolute; top:10px; left:0px; width:200px;">';a+='  <div class="tt'+l+'" style="float:left;margin-top:5px;margin-right:5px;"></div>';a+='  <font class="tnormal"><b>'+c+"</b></font><br>";a+='  <font class="tklein">'+lng_t_tt_ertragfertig+"&nbsp;"+e+"</font>";if(produkt_ernte_bonus[l]){a+='&nbsp;<span class="rack_cropbonus">+'+produkt_ernte_bonus[l]+"</span>"}if(specialbonus){var h=specialbonus.findBonus({key1:"products",key2:"harvest"});if(h&&h.group==produkt_category[l]){a+='&nbsp;<span class="rack_cropbonus">+'+h.harvest+"</span>"}}a+="  <br>";a+='  <font class="tklein">'+lng_t_tt_remaining+'&nbsp;<span id="gtt_zeit">'+lng_t_tt_berechne+"</span></font><br>";a+="</div>"}}g("bubble_infotext").innerHTML=a;if(b!="u"){calcTime(m,e);ginfo_interval=window.setInterval("calcTime("+m+","+e+")",1000)}}function calcTime(d,b){kategorie=garten_kategorie[d];if(Zeit.Server==0){g("gtt_zeit").innerHTML=lng_t_tt_berechne}else{var c=(parseInt(garten_zeit[d])+parseInt(Zeit.Verschiebung))-parseInt(Zeit.Client);var a=b;if(c<=0){c=0;if(interval!=null){clearInterval(interval)}if(kategorie!="z"){g("gtt_zeit").innerHTML=lng_t_fertig}}else{a=0;if(kategorie!="z"){g("gtt_zeit").innerHTML=formatTime(c)}}}return c}function gclr(){document.getElementById("bubble_adtext").style.display="block";var a="";if(remainpts==1){var b=pts2nextlevel_1}else{var b=pts2nextlevel}if(tutorial==0){if(currentuserlevel==highestuserlevel){a+="<br>"+level_congratulations}else{a+=str_replace("%POINTS%",'<span style="font-weight:bold;" id="remainpoints">'+remainpts.format()+"</span>",b)}}else{a+=introtutorial}g("bubble_infotext").innerHTML=a;clearInterval(ginfo_interval);ginfo_interval=null;zeit=null}function g(a){return document.getElementById(a)}Number.prototype.format=function(e,c,r){if(!c){c=set_komma}if(typeof r=="undefined"){r=set_tausender}if(!e){e=0}var d=(this<0)?"-":"";var s=Math.pow(10,e);var q=Math.round((Math.abs(this)*s))/s;var h=q.toString().indexOf(".");if(h==-1){h=q.toString().length}var n=q.toString().substring(h+1);var a=q.toString().substring(0,h);var m=a.length;var l=0;var b="";do{b=a.charAt(m)+b;if(l==3&&m>0){b=r+b;l=0}l++}while(m--);s=s.toString().substring(1);n=(n+s).substring(0,e);if(n!=""){b=b+c+n}return d+b};var olympia=function(){this.data={};this.timeline_pos=1;this.timeline_scroll_steps=[350,700,1050,1400];this.timeline_start_offset=200;this.timeline_x=0;this.energy=0;this.interval=0;this.maxWidth=0};olympia.prototype.action=function(a,b){ajaxAction("main",a,b,olympia.response)};olympia.prototype.response=function(b,a,c){olympia.data=b;olympia.init()};olympia.prototype.buyBerries=function(a){this.action("olympia_buy_berries",{coins:a})};olympia.prototype.hitchhiker=function(){this.action("olympia_hitchhiker")};olympia.prototype.conservation=function(){this.action("olympia_conservation")};olympia.prototype.entry=function(a){this.action("olympia_entry",{amount:a})};olympia.prototype.init=function(){this.timeline_x=this.data.x;this.energy=this.data.energy;this.interval=this.data.interval;showDiv("olympia_transp");showDiv("olympia_box");setTimer("olympia");this.scroll();this.stars();var c=0;if(this.data.data.berries){c=formatNumber(this.data.data.berries)}$("olympia_berries").innerHTML=c;if(this.data.reward){this.dialog("reward",this.data.reward)}if(this.data.first){this.help()}if(!$("olympia_event_timeline")){$("olympia_box").insert('<div id="olympia_event_timeline">'+events.buildTimeline("olympia")+"</div>")}var b=0;for(var a in this.data.config.stages){b++}this.maxWidth=(b*100)+200};olympia.prototype.checkEntry=function(){var c=0;if(this.data.data.berries){c=this.data.data.berries}var a=Math.ceil((100-this.energy)/(100/this.data.config.berries_full));var b={stockamount:c,rest:a,click:"olympia.entry()"};checkEntryLine(b)};olympia.prototype.dialog=function(l,c){if(l=="reward"){var e='<div style="margin-bottom:10px;">'+windmill_out+"</div>";for(var d=0;d<c.length;d++){if(c[d].powerup){e+='<div style="margin-bottom:5px;">'+t_payment_pointsboost_info2.replace("%PERCENT%",windmillarray[c[d].powerup][5][3])+"</div>"}if(c[d].points){e+='<div style="margin-bottom:5px;">'+formatNumber(c[d].points)+"&nbsp;"+t_points+"</div>"}if(c[d].sheep){e+='<div style="margin-bottom:5px;">'+str_replace("%NAME%","",t_olympia_unlocked_sheep)+"</div>"}}globalcommitbox(t_olympia_stage_goal,e,"off")}if(l=="feed"){var b=Math.ceil((100-this.energy)/(100/this.data.config.berries_full));var q=[10,50,100];var e="";for(var d=0;d<q.length;d++){var a=(q[d]/(100/this.data.config.berries_full));var m=str_replace("%PERCENT%",q[d],t_olympia_feed_select);m=str_replace("%AMOUNT%",a,m);var n="";var h="opacity:0.5;";if(this.data.data.berries>=a&&a<=b){n="olympia.entry("+q[d]+")";h=""}e+='<div class="button_new link" style="margin-bottom:10px; padding:5px; '+h+'" onclick="'+n+'">'+m+"</div>"}globalcommitbox(t_olympia_feed_info,e,0,0,1)}if(l=="buy_berries"){var e="";for(var d in this.data.config.buy_berries){var m=str_replace("%COINS%",d,t_olympia_option3_desc);e+='<div class="coinsbutton_flex link" style="margin-bottom:10px;" onclick="olympia.dialog(\'buy_berries_commit\', '+d+')">'+str_replace("%AMOUNT%",this.data.config.buy_berries[d],m)+"</div>"}globalcommitbox(t_olympia_option3,e,0,0,1)}if(l=="buy_berries_commit"){var m=str_replace("%COINS%",c,t_olympia_option3_desc);var e="<div>"+str_replace("%AMOUNT%",this.data.config.buy_berries[c],m)+"</div>";var n="olympia.buyBerries("+c+")";globalcommitbox(t_olympia_option3,e,n)}if(l=="hitchhiker"){var m=str_replace("%COINS%",this.data.config.hitchhiker_cost,t_olympia_option2_desc);var e='<div style="margin-bottom:10px;">'+str_replace("%DISTANCE%",this.data.config.hitchhiker_distance,m)+"</div>";e+="<div>"+cityadcost+'<img src="'+imgpath+'menu/coins.gif" style="width:12px; margin-right:3px;">'+this.data.config.hitchhiker_cost+"&nbsp;"+t_coins+"</div>";globalcommitbox(t_olympia_option2,e,"olympia.hitchhiker()")}if(l=="conservation"){var m=str_replace("%TIME%",formatTime(this.data.config.conservation_duration),t_olympia_option1_desc);var e='<div style="margin-bottom:10px;">'+str_replace("%COINS%",this.data.config.conservation_cost,m)+"</div>";e+="<div>"+cityadcost+'<img src="'+imgpath+'menu/coins.gif" style="width:12px; margin-right:3px;">'+this.data.config.conservation_cost+"&nbsp;"+t_coins+"</div>";globalcommitbox(t_olympia_option1,e,"olympia.conservation()")}if(l=="finder"){var e='<div class="olympia_chocolate_berry"></div><div>'+c.amount+"x</div>";globalcommitbox(t_olympia_acai_berry,e,"off")}};olympia.prototype.scroll=function(){var a=1;for(var b=0;b<this.timeline_scroll_steps.length;b++){if(this.timeline_x>=this.timeline_scroll_steps[b]){a++}}this.timeline_pos=a;this.moveTimeline(0)};olympia.prototype.stars=function(){for(var a in this.data.config.stages){if(windmillarray[this.data.config.stages[a].powerup]){$("olympia_stage_star"+a+"_tt").innerHTML=windmillarray[this.data.config.stages[a].powerup][5][3]+"%&nbsp;"+t_pointsboost_unit;$("olympia_stage_star"+a).onmouseover=new Function("showDiv('olympia_stage_star"+a+"_tt')");$("olympia_stage_star"+a).onmouseout=new Function("hideDiv('olympia_stage_star"+a+"_tt')")}if(a<(Math.floor(this.timeline_x/100)+1)){$("olympia_stage_star"+a+"_img").removeClassName("olympia_stage_star_off").addClassName("olympia_stage_star_on");if(this.data.data.stages&&this.data.data.stages[a]){showDiv("olympia_stage_prize_ready"+a)}}}};olympia.prototype.timer=function(){this.data.conservation_remain--;this.data.remain--;this.data.data.remain_exchange--;if(this.data.data.remain_exchange<=0){this.close}if(this.data.remain>0){$("olympia_eventtime").innerHTML=t_event_resttime+":&nbsp;<b>"+formatTime(this.data.remain)+"</b>"}else{$("olympia_eventtime").innerHTML=t_tinkergame_exchange_resttime+":&nbsp;<b>"+formatTime(this.data.data.remain_exchange)+"</b>"}this.currentEnergy();this.timeline_x+=this.data.dps*(this.energy/100);var a=Math.round(this.timeline_x+this.timeline_start_offset);if(a>this.maxWidth){a=this.maxWidth}if(this.energy<100&&a<this.maxWidth){showDiv("olympia_sheep_feed");$("olympia_sheep_energy").onclick=new Function("olympia.dialog('feed')")}else{hideDiv("olympia_sheep_feed");$("olympia_sheep_energy").onclick=new Function("")}$("olympia_sheep").style.left=a+"px";if(this.energy>50){$("olympia_sheep_energy").removeClassName("low").removeClassName("empty").addClassName("high");$("olympia_sheep_feed").removeClassName("low").removeClassName("empty").addClassName("high");$("olympia_sheep").className="olympia_sheep1"}else{if(this.energy>0){$("olympia_sheep_energy").removeClassName("high").removeClassName("empty").addClassName("low");$("olympia_sheep_feed").removeClassName("high").removeClassName("empty").addClassName("low");$("olympia_sheep").className="olympia_sheep2"}else{$("olympia_sheep_energy").removeClassName("low").removeClassName("high").addClassName("empty");$("olympia_sheep_feed").removeClassName("low").removeClassName("high").addClassName("empty");$("olympia_sheep").className="olympia_sheep3"}}if(a==this.maxWidth){$("olympia_sheep").className="olympia_sheep_hooray";hideDiv("olympia_buy_hitchhiker");hideDiv("olympia_conservation");hideDiv("olympia_buy_berries");hideDiv("olympia_sheep_energy");showDiv("olympia_victory")}var c=Math.round(((this.data.dps*3600)*(this.energy/100))*10)/10;$("olympia_timeline_pointer_percent").innerHTML=c+"&nbsp;"+t_speed_currency;$("olympia_timeline_pointer_distance").innerHTML=(a-this.timeline_start_offset)+"&nbsp;"+t_distance_currency;$("olympia_timeline_fill").style.width=a+"px";$("olympia_timeline_pointer").style.left=a+"px";$("olympia_sheep_energy_inner").style.height=((100/100)*this.energy)+"px";$("olympia_sheep_energy_percent").innerHTML=this.energy+"%";if(in_array(Math.round(this.timeline_x),this.timeline_scroll_steps)){this.scroll()}if(a%100){this.stars()}if(Math.round(this.timeline_x)%100==0){var b=Math.floor(Math.round(this.timeline_x)/100);if(b>0&&!(this.data.data.stages&&this.data.data.stages[b])){this.action("olympia_init")}}if(this.data.conservation_remain>0){showDiv("olympia_conservation_timer");hideDiv("olympia_conservation_button");showDiv("olympia_conservation_ready");$("olympia_conservation_timer").innerHTML=formatTime(this.data.conservation_remain)}else{hideDiv("olympia_conservation_timer");showDiv("olympia_conservation_button");hideDiv("olympia_conservation_ready")}events.timerTimeline("olympia")};olympia.prototype.currentEnergy=function(){var a=this.data.config.energy_reduction_duration;if(this.data.conservation_remain>0){a=(a*2)}if(parseInt(this.interval)>=parseInt(a)){this.interval=1;this.energy=Math.max(this.energy-10,0)}else{this.interval++}};olympia.prototype.moveTimeline=function(b){var a=0;for(var d in this.data.config.stages){a++}var c="stages_count"+a;this.timeline_pos+=parseInt(b);if(this.timeline_pos>5){this.timeline_pos=5}if(this.timeline_pos<1){this.timeline_pos=1}$("olympia_timeline").className="olympia_timeline_pos"+this.timeline_pos+" "+c;hideDiv("olympia_navi_left");hideDiv("olympia_navi_right");if(this.timeline_pos>1){showDiv("olympia_navi_left")}if(this.timeline_pos<5){showDiv("olympia_navi_right")}};olympia.prototype.finder=function(a){this.dialog("finder",{amount:a})};olympia.prototype.help=function(){showDiv("olympia_help_transp");showDiv("olympia_help")};olympia.prototype.openPan=function(){showMain();initFarmhouse();showPan();setTimeout(function(){pan_site=24;buildSheeps("expedition")},500)};olympia.prototype.close=function(){hideDiv("olympia_transp");hideDiv("olympia_box");clearTimer("olympia")};var panscenes=function(){this.config={};this.data={};this.scenePage=1;this.sceneName=""};panscenes.prototype.buildNavi=function(){var d="";d+='<div class="arrow left link" onclick="panscenes.scrollNavi(-1)"></div>';d+='<div class="current link" onclick="panscenes.toogleNaviList()">';if(this.sceneName==""){d+='<div class="none">---</div>'}d+='  <div class="icon icon-'+this.sceneName+'"></div>';d+="</div>";d+='<div class="selector link" onclick="panscenes.toogleNaviList()">';d+='  <div id="panscenes_navi_selector" class="img down"></div>';d+="</div>";d+='<div class="arrow right link" onclick="panscenes.scrollNavi(1)"></div>';d+='<div id="panscenes_navi_list_transp" class="transp" onclick="panscenes.toogleNaviList()"></div>';d+='<div id="panscenes_navi_list" class="list">';for(var b in this.config.scenes){d+='<div class="row">';d+='  <div class="icon icon-'+b+' link" onclick="panscenes.initScene(\''+b+"')\"></div>";if(this.config.scenes[b][2]){d+='<div class="pages">';for(var c in this.config.scenes[b]){var a="";if(in_array(b,this.config.only_numbers)){a="is-counter"}d+='<div class="col flex-center-all link '+a+'" onclick="panscenes.initScene(\''+b+"', "+c+')">';d+='<div class="icon icon-'+this.config.scenes[b][c].data+'"></div>';if(a!=""){d+='<div class="count">'+c+"</div>"}d+="</div>"}d+="</div>"}d+="</div>"}d+="</div>";d+='<div id="panscenes_navi_tt" class="ttbox">'+t_pan_main_navi2+"</div>";$("panscenes_navi").innerHTML=d};panscenes.prototype.scrollNavi=function(b){var d={};var c=0;var e=0;for(var a in this.config.scenes){c++;d[c]=a;if(a==this.sceneName){e=c}}e+=b;if(e<1){e=c}if(!d[e]){e=1}panscenes.initScene(d[e])};panscenes.prototype.toogleNaviList=function(){if($("panscenes_navi_list").style.display=="block"){if($("panscenes_page_navi")){showDiv("panscenes_page_navi")}hideDiv("panscenes_navi_list_transp");hideDiv("panscenes_navi_list");$("panscenes_navi_selector").removeClassName("up").addClassName("down")}else{if($("panscenes_page_navi")){hideDiv("panscenes_page_navi")}showDiv("panscenes_navi_list_transp");showDiv("panscenes_navi_list");$("panscenes_navi_selector").removeClassName("down").addClassName("up")}};panscenes.prototype.initScene=function(a,b){if(!b){b=1}this.scenePage=b;this.sceneName=a;this.buildScene();this.buildNavi()};panscenes.prototype.buildScene=function(){if($("panscenes_page")){$("panscenes_page").remove()}var a=this.config.scenes[this.sceneName][this.scenePage].data;var c='<div id="panscenes_page" class="is-'+a+" is-"+this.sceneName+" page"+this.scenePage+'">';if(this.config.scenes[this.sceneName][this.scenePage].fullani){c+=this.fullAni(a)}else{for(var b=this.config.scenes[this.sceneName][this.scenePage].start;b<=this.config.scenes[this.sceneName][this.scenePage].end;b++){if(!this.data[a]||!this.data[a][b]){continue}c+='<div class="sheep '+a+"_sheep"+b+'" onmouseover="showDiv(\'panscenes_page_'+a+"_sheep"+b+"_tt')\" onmouseout=\"hideDiv('panscenes_page_"+a+"_sheep"+b+"_tt')\">";if(t_panscenes_sheep_name[a+b]){c+='<div id="panscenes_page_'+a+"_sheep"+b+'_tt" class="ttbox">'+t_panscenes_sheep_name[a+b]+"</div>"}c+="</div>"}for(var b=1;b<=5;b++){c+='<div class="add-ani '+a+"_add-ani"+b+'"></div>'}}c+=this.buildSceneNavi();c+="</div>";$("pancontainer").insert(c)};panscenes.prototype.fullAni=function(a){var c="";if(a=="xmassheeps10"){c+='<div id="pan_sledgeride_box" style="display:block;">';c+='  <div class="back"></div>';c+='  <div id="pan_sledgeride_cloud">';c+='    <div class="inner"></div>';c+="  </div>";c+='  <div id="pan_sledgeride_cloud2">';c+='    <div class="inner"></div>';c+="  </div>";c+='  <div id="pan_sledgeride_sledge">';c+='    <div class="packages"></div>';for(var b=1;b<=4;b++){if(!this.data[a]||!this.data[a][b]){continue}c+='<div class="sheep '+a+"_sheep"+b+'"></div>'}c+='    <div class="lightchain"></div>';c+='    <div id="pan_sledgeride_horses">';c+='      <div class="horsebutt"></div>';c+='      <div class="horse">';if(this.data[a]&&this.data[a][b]){c+='<div class="sheep '+a+'_sheep5"></div>'}c+="      </div>";c+='      <div class="strained"></div>';c+="    </div>";c+="  </div>";c+="</div>"}if(a=="xmassheeps11"){c+='<div id="pan_bobsleigh_box" style="display:block;">';c+='  <div class="back"></div>';c+='  <div class="banners"></div>';if(this.data[a]&&this.data[a][b]){c+='<div class="sheep '+a+'_sheep5"></div>'}c+='  <div class="bobsleigh">';for(var b=1;b<=4;b++){if(!this.data[a]||!this.data[a][b]){continue}c+='<div class="sheep '+a+"_sheep"+b+'"></div>'}c+='    <div class="flyingsnow"></div>';c+="  </div>";c+='  <div class="snowwall"></div>';c+="</div>"}if(a=="xmassheeps12"){c+='<div id="xmassheep12_back" style="display:block;">';for(var b=1;b<=5;b++){if(!this.data[a]||!this.data[a][b]){continue}c+='<div class="sheep '+a+"_sheep"+b+'"></div>'}c+="</div>"}return c};panscenes.prototype.buildSceneNavi=function(){var a=0;for(var d in this.config.scenes[this.sceneName]){a++}if(a<=1){return""}var c='<div id="panscenes_page_navi" class="navi">';for(var d in this.config.scenes[this.sceneName]){var b="";if(d==this.scenePage){b="active"}c+='<div class="tab '+b+' link" onclick="panscenes.naviScene('+d+')"><div class="count">'+d+"</div></div>"}c+="</div>";return c};panscenes.prototype.naviScene=function(a){this.scenePage=a;this.buildScene()};panscenes.prototype.redirectPansetShop=function(e){if(e=="birthday"){e="birthdaysheeps"}for(var d in this.config.scenes){for(var c in this.config.scenes[d]){if(this.config.scenes[d][c].data!=e){continue}this.initScene(d,c);break}}};panscenes.prototype.close=function(){this.sceneName="";this.scenePage=1;if($("panscenes_page")){$("panscenes_page").remove()}};var panscenes=new panscenes();var pansetshop=function(){this.data={};this.currentSet="birthday"};pansetshop.prototype.buy=function(a){pansetshop.action("pansetshop_buy",{set:this.currentSet,id:a})};pansetshop.prototype.init=function(){pansetshop.action("pansetshop_init")};pansetshop.prototype.action=function(a,b){ajaxAction("farm",a,b,pansetshop.response)};pansetshop.prototype.response=function(b,a,c){pansetshop.data=b;if(a=="pansetshop_init"){pansetshop.currentSet="birthday"}pansetshop.build();setTimer("pansetshop")};pansetshop.prototype.build=function(){var a="";a+='<div class="headline">'+t_pansetshop_name+"</div>";a+='<div id="pansetshop_set" class="set"></div>';a+='<div id="pansetshop_navi" class="navi"></div>';a+='<div id="pansetshop_timer" class="timer"></div>';a+='<div class="help helpbutton_blue link" onmouseover="showDiv(\'pansetshop_help_tt\')" onmouseout="hideDiv(\'pansetshop_help_tt\')">';a+='  <div id="pansetshop_help_tt" class="ttbox">'+t_pansetshop_desc+"</div>";a+="</div>";a+='<div class="mini_close link" onclick="pansetshop.close()"></div>';$("pansetshop_main").innerHTML=a;this.buildSet();this.buildNavi();showDiv("pansetshop")};pansetshop.prototype.buildSet=function(){var c="";if(in_array(this.currentSet,["xmassheeps11"])){c+='<div class="overflowbox '+this.currentSet+'">';c+='  <div class="back '+this.currentSet+'"></div>';c+='  <div class="banners"></div>';c+='  <div id="sheep_'+this.currentSet+'_5_buy" class="sheep '+this.currentSet+'_5"></div>';c+='  <div class="bobsleigh">';for(var b in this.data.config[this.currentSet]){if(b==5){continue}c+='<div id="sheep_'+this.currentSet+"_"+b+'_buy" class="sheep '+this.currentSet+"_"+b+'"></div>'}c+='    <div class="flyingsnow"></div>';c+="  </div>";c+='  <div class="snowwall"></div>';c+="</div>"}else{c+='<div class="back '+this.currentSet+'"></div>';for(var b in this.data.config[this.currentSet]){c+='<div id="sheep_'+this.currentSet+"_"+b+'_buy" class="sheep '+this.currentSet+"_"+b+'"></div>'}}c+='<div class="panlink link" onclick="pansetshop.openPan()" onmouseover="showDiv(\'pansetshop_panlink_tt\')" onmouseout="hideDiv(\'pansetshop_panlink_tt\')">';c+='  <div id="pansetshop_panlink_tt" class="ttbox">'+t_pansetshop_panlink+"</div>";c+="</div>";$("pansetshop_set").innerHTML=c;for(var b in this.data.config[this.currentSet]){if(this.data.data.sets[this.currentSet]&&in_array(b,this.data.data.sets[this.currentSet])){continue}$("sheep_"+this.currentSet+"_"+b+"_buy").addClassName("off");var h="";var e=["top","bottom","left","right","width","height"];for(var a=0;a<e.length;a++){var d=parseInt($("sheep_"+this.currentSet+"_"+b+"_buy").getStyle(e[a]));if(isNaN(d)){continue}h+=e[a]+":"+d+"px;"}var c='<div class="buybutton buy_'+this.currentSet+" buy_"+this.currentSet+"_"+b+'" style="'+h+'">';c+='  <div class="button_new link" onclick="pansetshop.buyCommit('+b+')" onmouseover="pansetshop.hoverSheep('+b+', 1)" onmouseout="pansetshop.hoverSheep('+b+', 0)">'+t_pansetshop_buy_button+"</div>";c+="</div>";$("pansetshop_set").insert(c)}};pansetshop.prototype.hoverSheep=function(b,a){if(a==1){$("sheep_"+this.currentSet+"_"+b+"_buy").removeClassName("off")}else{$("sheep_"+this.currentSet+"_"+b+"_buy").addClassName("off")}};pansetshop.prototype.buyCommit=function(b){var a='<div style="width:300px;">'+t_pansetshop_buy_body.replace("%COST%",this.data.config[this.currentSet][b].coins+"&nbsp;"+t_coins)+"</div>";var c="pansetshop.buy("+b+")";globalcommitbox(t_pansetshop_name,a,c)};pansetshop.prototype.buildNavi=function(){var d="";for(var c in this.data.config){var e=1;if(this.data.data.sets[c]){for(var b in this.data.config[c]){if(!in_array(b,this.data.data.sets[c])){e=0}}}else{e=0}var a="";if(this.currentSet==c){a="active"}d+='<div class="item link '+a+'" onclick="pansetshop.changeSet(\''+c+"')\">";d+='  <div class="img '+c+'"></div>';if(e==1){d+='<div class="ready" onmouseover="showDiv(\'pansetshop_set_'+c+"_ready_tt')\" onmouseout=\"hideDiv('pansetshop_set_"+c+"_ready_tt')\">";d+='  <div id="pansetshop_set_'+c+'_ready_tt" class="ttbox">'+t_pansetshop_complete+"</div>";d+="</div>"}d+="</div>"}d+='<div class="clear"></div>';$("pansetshop_navi").innerHTML=d};pansetshop.prototype.changeSet=function(a){this.currentSet=a;this.buildSet();this.buildNavi()};pansetshop.prototype.openPan=function(){showMain();initFarmhouse();showPan();pan_site=0;setTimeout(function(){panscenes.redirectPansetShop(pansetshop.currentSet)},500)};pansetshop.prototype.timer=function(){this.data.data.remain--;$("pansetshop_timer").innerHTML=t_pansetshop_timer+formatTime(this.data.data.remain)};pansetshop.prototype.close=function(){hideDiv("pansetshop")};var paymentitemcollection=function(){this.data={};this.type="";this.requestBlocker=0;this.ispublic=0};paymentitemcollection.prototype.bonus=function(){paymentitemcollection.action("paymentitemcollection_bonus",{type:this.type})};paymentitemcollection.prototype.buyPackage=function(){paymentitemcollection.action("paymentitemcollection_buypackage",{type:this.type})};paymentitemcollection.prototype.openPackage=function(){paymentitemcollection.action("paymentitemcollection_openpackage",{type:this.type})};paymentitemcollection.prototype.shredder=function(a){paymentitemcollection.action("paymentitemcollection_shredder",{type:this.type,id:a})};paymentitemcollection.prototype.action=function(a,b){if(this.requestBlocker==1){return 1}this.requestBlocker=1;ajaxAction("farm",a,b,paymentitemcollection.response)};paymentitemcollection.prototype.response=function(c,b,d){paymentitemcollection.requestBlocker=0;paymentitemcollection.data=c;if(c.found){var a='<div id="paymentitem_collection_preview">';a+='  <div class="transp"></div>';a+='  <div id="paymentitem_collection_preview_box" class="package"></div>';a+='  <div class="item '+paymentitemcollection.type+' static preview link">';a+='    <div id="paymentitem_collection_preview_img" class="opened img item'+c.found+' static off"></div>';a+="  </div>";a+="</div>";$("paymentitem_collection").insert(a);setTimeout(function(){$("paymentitem_collection_preview_box").addClassName(paymentitemcollection.type).addClassName("unbox")},500);setTimeout(function(){$("paymentitem_collection_preview_img").removeClassName("off").addClassName("on")},1750);setTimeout(function(){$("paymentitem_collection_preview_box").removeClassName(paymentitemcollection.type).removeClassName("unbox")},2500);setTimeout(function(){$("paymentitem_collection_preview_img").onclick=new Function("paymentitemcollection.closePreview()")},2500)}else{paymentitemcollection.update()}if(c.transfer){if(c.transfer.points){globalerrorbox(formatNumber(c.transfer.points)+"&nbsp;"+t_get_points)}}};paymentitemcollection.prototype.closePreview=function(){$("paymentitem_collection_preview").remove();paymentitemcollection.update();if(this.data.doubleitem){globalerrorbox(t_paymentitemcollection_double_item)}};paymentitemcollection.prototype.update=function(e){if(!e){e=this.type}this.type=e;showDiv("paymentitem_collection");var h=0;if(this.data.packages&&this.data.packages[e]){h=formatNumber(this.data.packages[e])}var l=0;if(this.data.shreddered){l=this.data.shreddered}var d=0;if(this.data.config&&this.data.config.collection&&this.data.config.collection[e]){var d=1;for(var c in this.data.config.collection[e]){if(!this.data.collections||!this.data.collections[e]||!this.data.collections[e][c]){d=0}}}var a=1;if(this.data.lastbonus&&this.data.lastbonus[e]&&this.data.lastbonus[e]>=this.data.today){a=0}var b="";b+='<div class="header">';if(!this.ispublic){b+='  <div class="slot help helpbutton_blue link" onclick="paymentitemcollection.help()"></div>';b+='  <div class="slot packages '+e+' button_new link" onclick="paymentitemcollection.openPackageCommit()">';b+="    <div>"+t_open+"</div>";b+='    <div class="amount">'+h+"</div>";b+="  </div>";b+='  <div class="slot shreddered link">'+formatNumber(l)+"</div>";b+='<div class="slot buy '+e+' button_new link" onclick="paymentitemcollection.buyPackageCommit()">'+market_buy+"</div>";if(a==1&&d==1){b+='<div class="slot bonus button_new link" onclick="paymentitemcollection.bonus()">'+t_paymentitemcollection_bonus+"</div>"}b+='  <div class="clear"></div>'}b+="</div>";if(!this.ispublic){b+='<div id="paymentitem_collection_timer" class="timer"></div>'}b+='<div class="items">';for(var c=1;c<=12;c++){b+='<div id="paymentitem_collection_item'+c+'" class="'+this.type+' item">';b+='  <div class="img item'+c+'"></div>';b+="</div>"}b+="</div>";$("paymentitem_collection").addClassName(e).innerHTML=b;for(var c=1;c<=12;c++){if(!this.data.collections||!this.data.collections[e]||!this.data.collections[e][c]){continue}var b='<div id="paymentitem_collection_item'+c+'_img" class="img item'+c+'"></div>';if(!this.ispublic){b+='<div class="amount link '+e+'" onclick="paymentitemcollection.shredderCommit('+c+')" onmouseover="paymentitemcollection.shredderStatus('+c+', 1)" onmouseout="paymentitemcollection.shredderStatus('+c+', 0)">';b+='  <div id="paymentitem_collection_item'+c+'_amount">'+this.data.collections[e][c]+"</div>";b+='  <div id="paymentitem_collection_item'+c+'_amount_tt" class="ttbox">'+t_paymentitemcollection_shredder_body.replace("%COUNT%",formatNumber(this.data.config.collection[e][c].shredder))+"</div>";b+="</div>"}b+='<div id="paymentitem_collection_item'+c+'_tt" class="ttbox">'+this.data.config.collection[this.type][c].name+"</div>";$("paymentitem_collection_item"+c).innerHTML=b;$("paymentitem_collection_item"+c).addClassName("static");$("paymentitem_collection_item"+c+"_img").addClassName("static");$("paymentitem_collection_item"+c).onmouseover=new Function("paymentitemcollection.showAnimation("+c+", 1)");$("paymentitem_collection_item"+c).onmouseout=new Function("paymentitemcollection.showAnimation("+c+", 0)")}this.timerUpdate()};paymentitemcollection.prototype.shredderStatus=function(a,b){if(b==1){hideDiv("paymentitem_collection_item"+a+"_amount");showDiv("paymentitem_collection_item"+a+"_amount_tt")}else{showDiv("paymentitem_collection_item"+a+"_amount");hideDiv("paymentitem_collection_item"+a+"_amount_tt")}};paymentitemcollection.prototype.showAnimation=function(a,b){if(b==1){showDiv("paymentitem_collection_item"+a+"_tt");$("paymentitem_collection_item"+a+"_img").addClassName("hover")}else{hideDiv("paymentitem_collection_item"+a+"_tt");$("paymentitem_collection_item"+a+"_img").removeClassName("hover")}};paymentitemcollection.prototype.openPackageCommit=function(){if(this.data.packages&&this.data.packages[this.type]){this.openPackage()}};paymentitemcollection.prototype.buyPackageCommit=function(){if(!this.data.config){return 0}var b=0;if(this.data.shreddered){b=this.data.shreddered}var a='<div style="position:relative; width:300px;">'+t_paymentitemcollection_buy_body.replace("%COUNT%",formatNumber(this.data.config.blindbox_cost))+"</div>";var c="paymentitemcollection.buyPackage()";if(this.data.config.blindbox_cost>b){globalcommitbox(t_paymentitemcollection_buy_head,'<div class="important">'+a+"</div>",0,0,1)}else{globalcommitbox(t_paymentitemcollection_buy_head,a,c)}};paymentitemcollection.prototype.shredderCommit=function(b){var c="paymentitemcollection.shredder("+b+")";var a='<div style="position:relative; width:300px;">'+t_paymentitemcollection_shredder_body.replace("%COUNT%",formatNumber(this.data.config.collection[this.type][b].shredder))+"</div>";globalcommitbox(t_paymentitemcollection_shredder_head,a,c)};paymentitemcollection.prototype.openPan=function(a){showMain();messagesClose();initFarmhouse();showPan(1);setTimeout(function(){pan_site=a;panBuildCollection(a)},800)};paymentitemcollection.prototype.help=function(){var a='<div class="paymentitemcollection_help">';a+="  <ul>";a+="    <li>"+t_paymentitemcollection_help1+"</li>";a+="    <li>"+t_paymentitemcollection_help2+"</li>";a+="    <li>"+t_paymentitemcollection_help3+"</li>";a+="    <li>"+t_paymentitemcollection_help4+"</li>";a+="    <li>"+t_paymentitemcollection_help5+"</li>";a+="  </ul>";a+="</div>";globalcommitbox(t_paymentitemcollection_name,a,0,0,1)};paymentitemcollection.prototype.timer=function(){if(this.data&&this.data.remain){for(var a in this.data.remain){this.data.remain[a]--}paymentitemcollection.timerUpdate()}};paymentitemcollection.prototype.timerUpdate=function(){if(this.data&&this.data.remain){for(var a in this.data.remain){if(a==this.type&&$("paymentitem_collection_timer")){showDiv("paymentitem_collection_timer");$("paymentitem_collection_timer").innerHTML=t_paymentitemcollection_event_end;if(this.data.remain[a]>0){$("paymentitem_collection_timer").innerHTML=t_cropaction_resttime+formatTime(this.data.remain[a]);showDiv("paymentitem_collection_timer")}}}}};var pentecostevent=function(){this.data={};this.finderData={}};pentecostevent.prototype.careSpeedup=function(a){pentecostevent.action("pentecostevent_care_speedup",{type:a})};pentecostevent.prototype.care=function(a){pentecostevent.action("pentecostevent_care",{type:a})};pentecostevent.prototype.buyCollect=function(b,a){pentecostevent.action("pentecostevent_buy_collect",{type:b,coins:a})};pentecostevent.prototype.init=function(){pentecostevent.action("pentecostevent_init")};pentecostevent.prototype.action=function(a,b){ajaxAction("farm",a,b,pentecostevent.response)};pentecostevent.prototype.response=function(e,d,h){pentecostevent.data=e;pentecostevent.build();if(pentecostevent.data.daily){var b="";var a='<div id="pentecostevent_commit" style="width:300px;">';a+="  <div>"+t_specialoffer_message+"</div>";a+='  <div style="display:flex; justify-content:center; align-items:center; gap:10px;">';for(var c in pentecostevent.data.daily){a+="<div>";a+='  <div class="icon '+c+'"></div>';a+='  <div style="font-weight:bold; font-size:14px;">'+pentecostevent.data.daily[c]+"x</div>";a+="</div>"}a+="  </div>";a+="</div>";globalcommitbox(b,a,0,0,1)}};pentecostevent.prototype.build=function(){var h=1;if(this.data.data&&this.data.data.current){h=this.data.data.current}var a=(h-1);if(this.data.data.points>=this.data.config.maxpoints){a=6}var e="";e+='<div class="head">'+t_pentecostevent_name+"</div>";e+='<div class="desc">'+t_pentecostevent_desc+"</div>";var d=["water","fertilizer"];for(var c=0;c<d.length;c++){e+='<div class="collect '+d[c]+'">';e+='  <div class="icon"></div>';e+='  <div class="amount" onmouseover="showDiv(\'pentecostevent_collect_'+d[c]+"_tt')\" onmouseout=\"hideDiv('pentecostevent_collect_"+d[c]+"_tt')\">"+formatNumber(this.data.data[d[c]])+"</div>";e+='  <div class="buy link" onclick="pentecostevent.buyCollectCommit(\''+d[c]+"')\" onmouseover=\"showDiv('pentecostevent_collect_"+d[c]+"_buy_tt')\" onmouseout=\"hideDiv('pentecostevent_collect_"+d[c]+"_buy_tt')\">";e+='    <div id="pentecostevent_collect_'+d[c]+'_buy_tt" class="ttbox">'+t_pentecostevent_buy_collect_head.replace("%NAME%",t_pentecostevent_collect_type[d[c]])+"</div>";e+="  </div>";e+='  <div id="pentecostevent_collect_'+d[c]+'_tt" class="ttbox">';e+="    <div>"+t_pentecostevent_list_products.replace("%NAME%","<b>"+t_pentecostevent_collect_type[d[c]]+"</b>")+"</div>";e+='    <div class="list">';if(eventgarden.data.config.events.pentecostevent.start){for(var b in eventgarden.data.config.events.pentecostevent.start){if(!eventgarden.data.config.products[b].drop[d[c]]){continue}e+='<div class="line">';e+='  <div class="eventgarden_product '+b+' col1"></div>';e+='  <div class="col2">'+eventgarden.data.config.products[b].name+"</div>";e+="</div>"}}e+="    </div>";e+="  </div>";e+="</div>"}e+='<div id="pentecostevent_buttons" class="buttons"></div>';e+='<div class="img phase'+a+'"></div>';e+='<div id="pentecostevent_slots" class="slots"></div>';e+=events.buildTimeline("pentecostevent");e+='<div class="helpbutton_blue link" onclick="pentecostevent.help();"></div>';e+='<div class="mini_close link" onclick="pentecostevent.close();"></div>';$("pentecostevent_inner").innerHTML=e;showDiv("pentecostevent");$("pentecostevent_inner").addClassName("bounce");setTimer("pentecostevent");this.buildButtons();this.buildSlots();this.timerUpdate()};pentecostevent.prototype.buildButtons=function(){var d=["water","fertilizer"];var c="";for(var b=0;b<d.length;b++){var e=this.data.data[d[b]];var h=this.data.config.exchange[d[b]].amount;var m=this.data.config.exchange[d[b]].points;var a=this.data.config.exchange[d[b]].cooldown;var q="pentecostevent.careCommit('"+d[b]+"')";var l="";if(e<h){q="";l+=" off"}if(this.data.data[d[b]+"_start"]&&this.data.data[d[b]+"_remain"]>0){q="";l+=" off2"}c+='<div class="btn '+d[b]+" link "+l+'" onmouseover="showDiv(\'pentecostevent_btn_'+d[b]+"_icon_tt')\" onmouseout=\"hideDiv('pentecostevent_btn_"+d[b]+"_icon_tt')\">";c+='  <div class="icon" onclick="'+q+'">';l="";var n="";if(this.data.config.farmhouse_bonus){l="bonus";n='<div class="bonus">'+t_pentecostevent_farmhouse_bonus.replace("%PERCENT%",Math.round(this.data.config.farmhouse_bonus*100))+"</div>"}c+="  </div>";c+='  <div id="pentecostevent_btn_'+d[b]+'_icon_tt" class="ttbox">';c+="    <div>"+t_pentecostevent_btn_info[d[b]].replace("%POINTS%",'<span class="'+l+'">'+formatNumber(m)+"</span>")+"</div>";if(n!=""){c+=n}c+="    <div>"+t_pentecostevent_duration_info.replace("%TIME%",formatTime(a))+"</div>";c+='    <div class="add">';c+='      <div style="float:left;">'+t_needs+':&nbsp;<span class="need">'+formatNumber(h)+"</span></div>";c+='      <div class="type '+d[b]+'"></div>';c+='      <div class="clear"></div>';c+="    </div>";c+="  </div>";c+='  <div id="pentecostevent_btn_'+d[b]+'_timer" class="timer">';c+='    <div id="pentecostevent_btn_'+d[b]+'_timer_time"></div>';c+='    <div class="speedup" onclick="pentecostevent.careSpeedupCommit(\''+d[b]+"')\" onmouseover=\"showDiv('pentecostevent_btn_"+d[b]+"_speedup_tt')\" onmouseout=\"hideDiv('pentecostevent_btn_"+d[b]+"_speedup_tt')\">";c+='      <div id="pentecostevent_btn_'+d[b]+'_speedup_tt" class="ttbox">'+t_pentecostevent_cooldown_speedup_head+"</div>";c+="    </div>";c+="  </div>";c+="</div>"}$("pentecostevent_buttons").innerHTML=c};pentecostevent.prototype.buildSlots=function(){var h=1;if(this.data.data&&this.data.data.current){h=this.data.data.current}var c="";for(var n in this.data.config.slots){var l=this.data.data.percent;var r="";if(n>h){l=0;r="off"}if(n==h){r="active"}if(n<h){l=100}var q="";if(n>3){q="right"}var d=0;for(var m in this.data.config.slots[n].reward){d++}if(d>1){q+=" double"}c+='<div class="slot">';c+='  <div class="ring" onmouseover="pentecostevent.hoverSlot('+n+', 1);" onmouseout="pentecostevent.hoverSlot('+n+', 0);">';c+='    <div class="overflow '+r+'">';c+='      <div class="fill" style="height:'+l+'%;"></div>';c+='      <div id="pentecostevent_slot'+n+'_percent" class="text"></div>';c+="    </div>";c+='    <div id="pentecostevent_slot'+n+'_tt" class="ttbox '+q+'">';c+='      <div class="header">'+t_pentecostevent_phase.replace("%COUNT%",n)+"</div>";c+='      <div id="pentecostevent_slot'+n+'_tt_current"></div>';c+="    </div>";c+="  </div>";if(n==h&&this.data.data.points<this.data.config.maxpoints){c+='<div class="buy link '+q+'" onclick="pentecostevent.buyCollectCommit(\'points\')" onmouseover="showDiv(\'pentecostevent_slot'+n+"_buy')\" onmouseout=\"hideDiv('pentecostevent_slot"+n+"_buy')\">";c+='  <div id="pentecostevent_slot'+n+'_buy" class="ttbox">'+t_pentecostevent_buy_collect_head.replace("%NAME%",t_pentecostevent_collect_type.points)+"</div>";c+="</div>"}c+='  <div class="reward '+q+'">';c+='    <div class="pics">';for(var m in this.data.config.slots[n].reward){c+='<div class="pic" onmouseover="showDiv(\'pentecostevent_slot'+n+"_reward_type"+m+"_tt')\" onmouseout=\"hideDiv('pentecostevent_slot"+n+"_reward_type"+m+"_tt')\">";var e="";if(m=="powerup"){c+='<div class="pic_inner powerup"></div>';for(var a in this.data.config.slots[n].reward.powerup){e+="<div>"+formulas[0][a][5][3]+"%&nbsp;"+t_pointsboost_unit+"</div>";if(this.data.data.reward&&this.data.data.reward[n]){e="<div>"+t_payment_pointsboost_info2.replace("%PERCENT%",formulas[0][a][5][3])+"</div>"}}}if(m=="gift"){for(var b=0;b<this.data.config.slots[n].reward.gift.length;b++){var a=this.data.config.slots[n].reward.gift[b];c+='<div class="pic_inner gift gift'+a+'"></div>'}e+="<div>"+t_pan_item+"</div>"}if(m=="moneypackage"){c+='<div class="pic_inner moneypackage"></div>';e="<div>"+t_loginbonus_reward_money+"</div>";if(this.data.data.reward&&this.data.data.reward[n]){e=formatPrice(this.data.data.reward[n].value)}}if(m=="farmhouse"){for(var b=0;b<this.data.config.slots[n].reward.farmhouse.length;b++){var a=this.data.config.slots[n].reward.farmhouse[b];c+='<div class="pic_inner farmhouse farmhouse'+a+'"></div>';e+="<div>"+t_farmhouse_item+"</div>";e+='<div style="font-style:italic;">('+t_farmhouse_category[farmhouseitems_config[a][0]]+")</div>"}}c+='  <div id="pentecostevent_slot'+n+"_reward_type"+m+'_tt" class="ttbox">'+e+"</div>";c+="</div>"}c+='      <div class="clear"></div>';c+='      <div id="pentecostevent_slot'+n+'_reward_ready" class="ready megafield_product_ready"></div>';c+="    </div>";c+="  </div>";c+="</div>"}$("pentecostevent_slots").innerHTML=c;for(var n in this.data.config.slots){if(n<h){this.showSlotPercent(n)}else{if(this.data.data.points>=this.data.config.maxpoints&&parseInt(h)==parseInt(n)){this.showSlotPercent(n)}else{this.showSlotAmount(n)}}hideDiv("pentecostevent_slot"+n+"_reward_ready");if(this.data.data.reward&&this.data.data.reward[n]){showDiv("pentecostevent_slot"+n+"_reward_ready")}}};pentecostevent.prototype.showSlotAmount=function(h,c){h=parseInt(h);if(c!=1){$("pentecostevent_slot"+h+"_percent").removeClassName("percent").addClassName("amount")}if(h<this.data.data.current){var b=(this.data.config.slots[(h+1)].points-this.data.config.slots[h].points);var e=b}if(h>=this.data.data.current){var d=(this.data.config.maxpoints-this.data.config.slots[h].points);if(this.data.config.slots[(h+1)]){d=(this.data.config.slots[(h+1)].points-this.data.config.slots[h].points)}var b=d;var e=Math.min(d,Math.max(0,(this.data.data.points-this.data.config.slots[h].points)))}var a=e+"/"+b;if(c==1){return a+"&nbsp;"+t_pentecostevent_collect_type.points}$("pentecostevent_slot"+h+"_percent").innerHTML=a};pentecostevent.prototype.showSlotPercent=function(b){$("pentecostevent_slot"+b+"_percent").removeClassName("amount").addClassName("percent");var a=this.data.data.percent;if(b>this.data.data.current){a=0}if(b<this.data.data.current){a=100}$("pentecostevent_slot"+b+"_percent").innerHTML=a+"<span>%</span>"};pentecostevent.prototype.hoverSlot=function(b,a){if(a==1){showDiv("pentecostevent_slot"+b+"_tt");if(b<this.data.data.current){this.showSlotAmount(b)}else{this.showSlotPercent(b)}if(this.data.data.points>=this.data.config.maxpoints&&b==this.data.data.current){if(b<this.data.data.current){this.showSlotPercent(b)}else{this.showSlotAmount(b)}}if($("pentecostevent_slot"+b+"_tt_current")){$("pentecostevent_slot"+b+"_tt_current").innerHTML=this.showSlotAmount(b,1)}}else{hideDiv("pentecostevent_slot"+b+"_tt");if(b<this.data.data.current){this.showSlotPercent(b)}else{this.showSlotAmount(b)}if(this.data.data.points>=this.data.config.maxpoints&&b==this.data.data.current){if(b<this.data.data.current){this.showSlotAmount(b)}else{this.showSlotPercent(b)}}}};pentecostevent.prototype.buyCollectCommit=function(d){var e=this.data.config.buy[d];var b=t_pentecostevent_collect_type[d];var c=t_pentecostevent_buy_collect_head.replace("%NAME%",b);var a='<div id="pentecostevent_commit">';for(coins in e){var h=t_pentecostevent_buy_collect_desc.replace("%AMOUNT%",e[coins]).replace("%NAME%",b).replace("%COST%","<b>"+coins+"&nbsp;"+t_coins+"</b>");a+='<div class="coinsbutton_flex link" onclick="pentecostevent.buyCollectCommitCommit(\''+d+"', "+coins+')">'+h+"</div>"}a+="</div>";globalBoxFlex(c,a,0,0,1)};pentecostevent.prototype.buyCollectCommitCommit=function(d,n){var b=this.data.config.buy[d];var a=t_pentecostevent_collect_type[d];var h=t_pentecostevent_buy_collect_head.replace("%NAME%",a);var l=t_pentecostevent_buy_collect_desc2.replace("%AMOUNT%",b[n]).replace("%NAME%",a).replace("%COST%","<b>"+n+"&nbsp;"+t_coins+"</b>");var c="<div>"+l+"</div>";var m="pentecostevent.buyCollect('"+d+"', "+n+")";var e="pentecostevent.buyCollectCommit('"+d+"')";globalcommitbox(h,c,m,e)};pentecostevent.prototype.careCommit=function(a){if(this.data.data[a+"_start"]&&this.data.data[a+"_remain"]>0){return 0}this.care(a)};pentecostevent.prototype.careSpeedupCommit=function(d){var h=this.data.data[d+"_remain"];var b=Math.ceil(h/this.data.config.cooldown_speedup);var c=t_pentecostevent_cooldown_speedup_head;var a=t_pentecostevent_cooldown_speedup_desc.replace("%COST%","<b>"+b+"&nbsp;"+t_coins+"</b>");var e="pentecostevent.careSpeedup('"+d+"')";globalcommitbox(c,a,e)};pentecostevent.prototype.timer=function(){this.data.data.remain--;this.data.data.remain_exchange--;var b=["water","fertilizer"];for(var a=0;a<b.length;a++){if(!this.data.data[b[a]+"_start"]){continue}this.data.data[b[a]+"_remain"]--}this.timerUpdate()};pentecostevent.prototype.timerUpdate=function(){var b=["water","fertilizer"];for(var a=0;a<b.length;a++){if(!this.data.data[b[a]+"_start"]){continue}hideDiv("pentecostevent_btn_"+b[a]+"_timer");if(this.data.data[b[a]+"_remain"]>0){showDiv("pentecostevent_btn_"+b[a]+"_timer");if($("pentecostevent_btn_"+b[a]+"_timer_time")){$("pentecostevent_btn_"+b[a]+"_timer_time").innerHTML=formatTime(this.data.data[b[a]+"_remain"])}}if(this.data.data[b[a]+"_remain"]==-1){this.buildButtons()}}events.timerTimeline("pentecostevent")};pentecostevent.prototype.finder=function(c){if(c){this.finderData=c}var a='<div id="pentecosteventevent_finder">';for(var b in this.finderData){a+='<div class="type '+b+'"></div>';a+='<div class="amount">'+this.finderData[b]+"x</div>";a+='<div class="clear"></div>'}a+="</div>";globalcommitbox(t_cropaction_found,a,"off")};pentecostevent.prototype.flyer=function(d){var b="";var c=0;for(var a in d){if(d[a]<=0){continue}b+='<div class="type '+a+'"></div>';b+='<div class="amount">'+d[a]+"x</div>";b+='<div class="clear"></div>';c++}if(c>0){events.flyer({id:"pentecostevent_link",name:"pentecostevent",html:b,idle:"idle",move:"up"})}};pentecostevent.prototype.help=function(){var e=["water","fertilizer"];var d=t_pentecostevent_name;var a='<div id="pentecostevent_help">';a+='  <div style="margin-bottom:5px;">'+t_pentecostevent_help1+"</div>";a+='  <div style="display:flex; justify-content:center;">';for(var c=0;c<e.length;c++){a+='<div class="block '+e[c]+'">';a+='  <div class="type '+e[c]+'"></div>';if(eventgarden.data.config.events.pentecostevent.start){for(var b in eventgarden.data.config.events.pentecostevent.start){if(!eventgarden.data.config.products[b].drop[e[c]]){continue}a+='<div class="line">';a+='  <div class="eventgarden_product '+b+' img"></div>';a+='  <div class="amount">'+eventgarden.data.config.products[b].name+"</div>";a+="</div>"}}a+="  </div>"}a+="  </div>";a+='  <div style="margin:5px 0px;">'+t_pentecostevent_help2+"</div>";a+='  <div style="display:flex; justify-content:center;">';for(var c=0;c<e.length;c++){a+='<div class="block '+e[c]+'">';a+='  <div class="btn '+e[c]+'">';a+='    <div class="icon"></div>';a+="  </div>";a+='  <div style="margin-top:10px;">'+t_pentecostevent_btn_info[e[c]].replace("%POINTS%",formatNumber(this.data.config.exchange[e[c]].points))+"</div>";a+='  <div style="margin-top:10px;">'+t_pentecostevent_duration_info.replace("%TIME%",formatTime(this.data.config.exchange[e[c]].cooldown))+"</div>";a+='  <div style="margin-top:10px; display:flex; justify-content:center; align-items:center;">';a+='    <div style="margin-left:15px; margin-bottom:5px;">'+t_needs+"&nbsp;"+formatNumber(this.data.config.exchange[e[c]].amount)+"</div>";a+='    <div class="infloat type '+e[c]+'"></div>';a+="  </div>";a+="</div>"}a+="  </div>";a+='  <div style="margin-top:5px;">'+t_pentecostevent_help3+"</div>";a+="</div>";globalBoxFlex(d,a,0,0,1);$("globalbox").style.top="65px"};pentecostevent.prototype.close=function(){hideDiv("pentecostevent")};var pepeevent=function(){this.data={};this.scroller=0;this.visibleCompleteSteps=3};pepeevent.prototype.inputPoints=function(){var a=$("pepeevent_input").value;if(a>0){pepeevent.action("pepeevent_input_points",{amount:a})}};pepeevent.prototype.buyPoints=function(a){pepeevent.action("pepeevent_buy_points",{coins:a})};pepeevent.prototype.init=function(){pepeevent.action("pepeevent_init")};pepeevent.prototype.action=function(a,b){ajaxAction("farm",a,b,pepeevent.response)};pepeevent.prototype.response=function(b,a,c){pepeevent.data=b;pepeevent.build()};pepeevent.prototype.build=function(){var l=parseInt(this.data.data.points);var a=0;for(var e in this.data.config.steps[this.data.config.pid]){a=this.data.config.steps[this.data.config.pid][e].points}var d='<div class="content">';d+='  <div class="head">'+t_pepeevent_name+"</div>";d+='  <div class="flex-left" style="margin-top:5px;">';d+='  <div class="entry">';d+='    <div class="flex-center">';d+='      <div style="margin-right:10px;">';d+='        <div class="name">'+produkt_name[this.data.config.pid]+"</div>";d+='        <div class="img pid'+this.data.config.pid+'"></div>';d+="      </div>";d+='      <div style="display:flex; align-items:center;">';d+='        <div class="flex-center-all">';d+="          <div>";d+='            <div id="pepeevent_amount" class="amount"><span class="current">'+formatNumber(l)+"</span>/"+formatNumber(a)+"</div>";d+='            <div style="text-align:center;"><input id="pepeevent_input" type="number" value="1" onchange="pepeevent.checkInput()" onkeyup="pepeevent.checkInput()"></div>';d+='            <div style="text-align:center;"><button id="pepeevent_input_button" class="button_new link" onclick="pepeevent.inputPoints()">'+t_pepeevent_insert_points_button+"</button></div>";d+="          </div>";d+="        </div>";d+="      </div>";d+="    </div>";var c=checkRackItem(this.data.config.pid);if(parseInt(c)<=parseInt(this.data.config.amount)){c='<span class="important">'+formatNumber(c)+"</span>"}else{c=formatNumber(c)}d+='    <div style="text-align:center; margin-top:5px;">'+t_inner_stock+"&nbsp;"+c+"&nbsp;("+t_pepeevent_min_instock+":&nbsp;"+this.data.config.amount+")</span></div>";d+="  </div>";d+='  <div class="desc">'+t_pepeevent_desc.replace("%NAME%","<b>"+produkt_name[this.data.config.pid]+"</b>")+"</div>";d+="  </div>";d+='  <div class="cols flex-left">';d+='    <div class="col1 flex-center-all"><div id="pepeevent_arrow_left" class="arrow left link" onclick="pepeevent.scrollLine(-1)"></div></div>';d+='    <div id="pepeevent_steps" class="col2 steps flex-align"></div>';d+='    <div class="col3 flex-center-all"><div id="pepeevent_arrow_right" class="arrow right link" onclick="pepeevent.scrollLine(1)"></div></div>';d+="  </div>";var b="";if(parseInt(this.data.data.points)>=parseInt(a)){b="off"}d+='  <div class="buy flex-center-all">';d+='    <button class="button_new link '+b+'" onclick="pepeevent.buyPointsCommit()">'+t_pepeevent_buy_points_button2+"</button>";d+="  </div>";d+='  <div class="timeline">';d+='    <div id="pepeevent_timeline_marker" class="marker"></div>';d+='    <div class="timer">'+t_event_resttime+':&nbsp;<span id="pepeevent_timer"></span></div>';d+="  </div>";d+='  <div class="mini_close link" onclick="pepeevent.close()"></div>';d+='  <div class="helpbutton_blue link" onmouseover="showDiv(\'pepeevent_helpbutton_tt\')" onmouseout="hideDiv(\'pepeevent_helpbutton_tt\')">';d+='    <div id="pepeevent_helpbutton_tt" class="ttbox">';d+="      <ul>";d+="        <li>"+t_pepeevent_help1.replace("%COUNT%",this.data.config.amount).replace("%NAME%",produkt_name[this.data.config.pid])+"</li>";d+="        <li>"+t_pepeevent_help2+"</li>";d+="        <li>"+t_pepeevent_help3.replace("%COUNT%",this.data.config.amount)+"</li>";d+="        <li>"+t_pepeevent_help4.replace("%NAME%","<b>"+this.data.config.powerup[2]+"</b>")+"</li>";d+="      </ul>";d+="    </div>";d+="  </div>";d+="</div>";$("pepeevent_content").innerHTML=d;$("pepeevent_content").addClassName("bounce");$("pepeevent").style.display="flex";$("pepeevent").addClassName("is-"+this.data.config.pid);$("pepeevent_input").focus();this.buildSteps();setTimer("pepeevent");this.timerUpdate();this.checkInput();var h=500;if(this.data.spend){h=0}setTimeout(function(){pepeevent.scrollLine(0)},h);if(this.data.spend){if($("pepeevent_flyer")){$("pepeevent_flyer").remove()}var d='<div id="pepeevent_flyer">';d+='  <div class="flex-center-all flex-left">';d+='    <div class="kp'+this.data.config.pid+'"></div>';d+='    <div style="margin-left:2px;">+'+formatNumber(this.data.spend)+"</div>";d+="  </div>";d+="</div>";$("pepeevent_amount").insert(d);setTimeout(function(){$("pepeevent_flyer").addClassName("move")},1000)}};pepeevent.prototype.scrollLine=function(b){showDiv("pepeevent_arrow_left");showDiv("pepeevent_arrow_right");var c=0;for(var a in this.data.config.steps[this.data.config.pid]){if(this.data.data.points>=this.data.config.steps[this.data.config.pid][a].points){c=a}}a-=this.visibleCompleteSteps;if(b!=0){this.scroller=parseInt(this.scroller)+parseInt(b)}else{this.scroller=c}if(this.scroller<=0||a<=0){this.scroller=0;hideDiv("pepeevent_arrow_left")}if(this.scroller>=a){this.scroller=a;hideDiv("pepeevent_arrow_right")}$("pepeevent_steps_line").style.setProperty("--pepeevent-scroller",this.scroller)};pepeevent.prototype.checkInput=function(){var m=0;for(var d in this.data.config.steps[this.data.config.pid]){m=this.data.config.steps[this.data.config.pid][d].points}var n=(parseInt(m)-parseInt(this.data.data.points));var e=$("pepeevent_input").value;var c=checkRackItem(this.data.config.pid);c-=this.data.config.amount;if(e>c){e=c}if(e>n){e=n}if(c<=0){e=0}if(e<0){e=0}$("pepeevent_input").value=e;$("pepeevent_input_button").addClassName("off");if(e>0){$("pepeevent_input_button").removeClassName("off")}var l=this.data.config.steps[this.data.config.pid];var q=(parseInt(this.data.data.points)+parseInt(e));for(var d in l){var h=0;if(parseInt(q)>=parseInt(l[d].points)){h=100}else{var b=0;if(l[(d-1)]){var b=parseInt(l[(d-1)].points)}var n=(parseInt(l[d].points)-b);var a=(parseInt(q)-b);if(a>0){h=((a*100)/n)}}$("pepeevent_bar"+d+"_inner2").style.width=h+"%"}};pepeevent.prototype.buildSteps=function(){var b=this.data.config.steps[this.data.config.pid];var d="";d+='<div id="pepeevent_steps_line" class="line flex-center">';for(var c in b){var l=0;if(parseInt(this.data.data.points)>=parseInt(b[c].points)){l=100}else{var h=0;if(b[(c-1)]){var h=parseInt(b[(c-1)].points)}var m=(parseInt(b[c].points)-h);var e=(parseInt(this.data.data.points)-h);if(e>0){l=((e*100)/m)}}var a=b[c].giftid;if(presents_hack[b[c].giftid]){a=presents_hack[b[c].giftid]}d+='<div class="step">';d+='  <div class="bar_inner" style="width:'+l+'%"></div>';d+='  <div id="pepeevent_bar'+c+'_inner2" class="bar_inner2"></div>';d+='  <div class="reward flex-center-all">';d+='    <img src="'+imgpath+"/gifts/"+a+'.gif">';if(l>=100){d+='<div class="ready"></div>'}d+="  </div>";d+='  <div class="amount">'+formatNumber(b[c].points)+"</div>";d+="</div>"}d+="</div>";$("pepeevent_steps").innerHTML=d;$("pepeevent_steps_line").style.width="calc(var(--pepeevent-step-width) * "+c+")";if(c<=this.visibleCompleteSteps){$("pepeevent_steps_line").addClassName("flex-left")}};pepeevent.prototype.buyPointsCommit=function(){var c=produkt_name[this.data.config.pid];var e=t_pepeevent_buy_points_head.replace("%NAME%",c);var d='<div id="pepeevent_commit">';d+='<div class="pid tt'+this.data.config.pid+'"></div>';for(var a in this.data.config.buy){var b="";if(parseInt(a)>parseInt(user_coins)){b="off"}d+='<div class="link coinsbutton_flex '+b+'" onclick="pepeevent.buyPointsCommitCommit('+a+')">'+t_pepeevent_buy_points_button.replace("%AMOUNT%",formatNumber(this.data.config.buy[a])).replace("%NAME%",c).replace("%COST%",a+"&nbsp;"+t_coins)+"</div>"}d+='  <div style="font-style:italic;">'+t_pepeevent_buy_points_info+"</div>";d+="</div>";globalcommitbox(e,d,0,0,1)};pepeevent.prototype.buyPointsCommitCommit=function(a){var c=produkt_name[this.data.config.pid];var e=t_pepeevent_buy_points_head.replace("%NAME%",c);var d='<div id="pepeevent_commit">';d+='<div class="pid tt'+this.data.config.pid+'"></div>';d+="  <div>"+t_pepeevent_buy_points_ask.replace("%AMOUNT%","<b>"+formatNumber(this.data.config.buy[a])+"x</b>").replace("%NAME%",c).replace("%COST%","<b>"+a+"&nbsp;"+t_coins+"</b>")+"</div>";d+="</div>";var h="pepeevent.buyPoints("+a+")";var b="pepeevent.buyPointsCommit()";globalcommitbox(e,d,h,b)};pepeevent.prototype.timer=function(){this.data.data.remain--;this.timerUpdate();if(this.data.data.remain<=0){this.close()}};pepeevent.prototype.timerUpdate=function(){if($("pepeevent_timer")){var b=((this.data.data.remain*100)/this.data.config.eventtime);var a="";if(b>=50){a="right"}$("pepeevent_timer").innerHTML=formatTime(this.data.data.remain);$("pepeevent_timeline_marker").style.width=b+"%";$("pepeevent_timeline_marker").removeClassName("right");if(b>=50){$("pepeevent_timeline_marker").addClassName("right")}}};pepeevent.prototype.close=function(){hideDiv("pepeevent")};var pets=function(){this.data={};this.needs=["food","toy","plushy"];this.page=1;this.rarity=1;this.happiness_reduction={};this.production_slot=0;this.production_selection_page=1;this.production_selection_sort="";this.need_selection_page=1;this.need_selection_slot=0;this.care_need="";this.care_set={};this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.cardsCount=0;this.cardsFlipped=0;this.cardsFlying={}};pets.prototype.init=function(){pets.action("pets_init")};pets.prototype.finish=function(){pets.action("pets_finish_breed")};pets.prototype.partsBuyFire=function(b,a){pets.action("pets_buy_parts",{id:b,amount:a})};pets.prototype.startProduction=function(a){pets.action("pets_start_production",{slot:pets.production_slot,pid:a})};pets.prototype.speedupProduction=function(b,a){pets.action("pets_speedup_production",{slot:b,coins:a})};pets.prototype.harvestProduction=function(b,a){pets.action("pets_harvest_production",{slot:b,position:a})};pets.prototype.buyProductionSlot=function(a){pets.action("pets_buy_production_slot",{slot:a})};pets.prototype.addLevel=function(){pets.action("pets_add_level",{amount:$("pets_dialog_leveladd_insert").value})};pets.prototype.buyAddLevel=function(){pets.action("pets_buy_add_level")};pets.prototype.startBreed=function(a){pets.action("pets_start_breed",{id:a})};pets.prototype.care=function(){pets.action("pets_care",{set:pets.care_set[1]+","+pets.care_set[2]+","+pets.care_set[3]})};pets.prototype.openPack=function(a){pets.action("pets_open_pack",{type:a})};pets.prototype.questEntry=function(a){pets.action("pets_quest_entry",{pid:a,amount:parseInt($("dialog_entryline_number").value)})};pets.prototype.completeAnimal=function(a){pets.action("pets_complete_animal",{animal:a})};pets.prototype.buyPharmacist=function(){pets.action("pets_buypharmacist")};pets.prototype.rememberPharmacist=function(){pets.action("pets_rememberpharmacist")};pets.prototype.stats=function(){if($("pets_stats_select")){pets.stats_select=$("pets_stats_select").value}if(pets.stats_cache_delay[pets.stats_select]<=0||!pets.stats_cache[this.stats_select]){pets.action("pets_stats",{type:pets.stats_select})}else{pets.showStats(pets.stats_select)}};pets.prototype.action=function(a,b){ajaxAction("farm",a,b,pets.response)};pets.prototype.response=function(b,a,c){this.care_set={};if(a=="pets_speedup_production"){global_speedup_block=0}if(in_array(a,["pets_buy_parts"])){pets.partsBuy()}if(in_array(a,["pets_init","pets_add_level","pets_buy_add_level","pets_start_breed","pets_finish_breed","pets_care"])){pets.build()}if(in_array(a,["pets_start_production","pets_speedup_production","pets_harvest_production","pets_buypharmacist"])){pets.buildProductionSlots()}if(in_array(a,["pets_quest_entry"])){pets.showQuest()}if(in_array(a,["pets_buy_parts","pets_harvest_production"])){pets.updateGeneral()}if(in_array(a,["pets_complete_animal"])){pets.parts()}if(b.add){pets.surprise(b.add)}if(b.reward){pets.reward(b.reward,1)}if(b.stats){pets.stats_cache_delay[pets.stats_select]=30;if(!pets.stats_cache[pets.stats_select]){pets.stats_cache[pets.stats_select]={}}pets.stats_cache[pets.stats_select]=b.stats;pets.showStats()}};pets.prototype.build=function(){var b='<div id="pets" class="move1">';b+='  <div id="pets_pet" class="pet">';b+='    <div id="pets_pet_tt" class="ttbox"></div>';b+='    <div id="pets_pet_start" class="start link" onclick="pets.startSelection()" onmouseover="showDiv(\'pets_pet_start_tt\')" onmouseout="hideDiv(\'pets_pet_start_tt\')">';b+='      <div class="bottle"></div>';b+='      <div id="pets_pet_start_tt" class="ttbox">'+t_pets_breed_doit+"</div>";b+="    </div>";b+='    <div id="pets_pet_finish" class="finish link" onclick="pets.finish()" onmouseover="showDiv(\'pets_pet_finish_tt\')" onmouseout="hideDiv(\'pets_pet_finish_tt\')">';b+='      <div id="pets_pet_finish_tt" class="ttbox">'+t_pets_breed_finish+"</div>";b+="    </div>";b+="  </div>";b+='  <div id="pets_pet_needs" class="needs">';for(var a=0;a<this.needs.length;a++){b+='<div id="pets_need_'+this.needs[a]+'" class="item link" onclick="pets.care_set={}; pets.needSlot(\''+this.needs[a]+"')\">";b+='  <div class="img '+this.needs[a]+'"></div>';b+='  <div id="pets_need_'+this.needs[a]+'_timer" class="timer">';b+='    <div id="pets_need_'+this.needs[a]+'_timer_inner" class="inner"></div>';b+='    <div id="pets_need_'+this.needs[a]+'_timer_amount" class="amount"></div>';b+="  </div>";b+='  <div id="pets_need_'+this.needs[a]+'_timer_reduction" class="timer_reduction" onmouseover="showDiv(\'pets_need_'+this.needs[a]+"_timer_reduction_tt')\" onmouseout=\"hideDiv('pets_need_"+this.needs[a]+"_timer_reduction_tt')\">";b+='    <div id="pets_need_'+this.needs[a]+'_timer_reduction_inner" class="inner"></div>';b+='    <div id="pets_need_'+this.needs[a]+'_timer_reduction_amount" class="amount"></div>';b+='    <div id="pets_need_'+this.needs[a]+'_timer_reduction_tt" class="ttbox">'+str_replace("%POINTS%",this.data.config.reduction_amount,t_pets_need_happy_reduction)+"</div>";b+="  </div>";b+="</div>"}b+="  </div>";b+='  <div id="pets_happiness" class="happiness" onmouseover="showDiv(\'pets_happiness_tt\')" onmouseout="hideDiv(\'pets_happiness_tt\')">';b+='  	 <div id="pets_happiness_tt" class="ttbox"></div>';b+='    <div id="pets_happiness_percent" class="percent"></div>';b+='    <div class="inner"><div id="pets_happiness_inner"></div></div>';b+="  </div>";b+='  <div id="pets_mover" class="right mover link" onclick="pets.move()"></div>';b+='  <div class="parts link" onclick="pets.parts()" onmouseover="showDiv(\'pets_inner_parts_link_tt\')" onmouseout="hideDiv(\'pets_inner_parts_link_tt\')">';b+='    <div id="pets_inner_parts_link_tt" class="ttbox">'+t_pets_parts_link+"</div>";b+="  </div>";b+='  <div id="pets_pharmacist" class="link" onmouseover="showDiv(\'pets_pharmacist_tt\')" onmouseout="hideDiv(\'pets_pharmacist_tt\')">';b+='    <div id="pets_pharmacist_timer"></div>';b+='    <div id="pets_pharmacist_tt" class="ttbox"><div>'+t_pharmacist_pets_buy_head+'</div><div class="bonusinfo">'+t_pharmacist_pets_info+"</div></div>";b+='    <div class="pets_pharmacist"></div>';b+='    <div id="pets_pharmacist_unlocked" class="unlocked"></div>';b+="  </div>";b+='  <div id="pets_slots"></div>';b+="</div>";b+='<div id="pets_timer_box" class="pets_timer"><div id="pets_timer" class="inner"></div><div id="pets_timer_text" class="time"></div></div>';b+=htmlLevelBar("pets");b+=htmlCountBar("pets");b+='  <div id="pets_stats_link" class="link" onclick="pets.stats()"></div>';b+='  <div id="pets_reward_button" class="link" onclick="pets.reward()"></div>';b+='  <div id="pets_quests_link" class="link" onclick="pets.showQuest()"></div>';b+='<div class="help helpbutton_blue link" onclick="openFarmersMarketHowTo(\'pets\', 1);"></div>';b+='<div class="mini_close link" onclick="pets.close()"></div>';$("farmersmarket_pos4_inner").innerHTML=b;showDiv("transp");showDiv("farmersmarket_pos4_inner");this.updateGeneral();this.update();this.buildProductionSlots();this.production_slot=0;this.production_selection_page=1;this.production_selection_sort=""};pets.prototype.updateGeneral=function(){if($("pets_levelbar_number")){$("pets_levelbar_number").innerHTML=this.data.data.level;$("pets_countbar_inner").innerHTML='<div class="breedpoints_icon"></div><div>'+this.data.data.count+"</div><br>";$("pets_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var b=t_reached_maxlevel;hideDiv("pets_levelbar_plus")}else{var b=str_replace("%AMOUNT%",this.data.data.level_rest,t_pets_level_line);$("pets_levelbar_plus").onclick=new Function("pets.addLevelCommit()");$("pets_levelbar_plus_tt").innerHTML=t_pets_leveladd_tt}$("pets_levelbar_tt").innerHTML=b;$("pets_countbar_plus_tt").innerHTML=t_pets_levelitem_buy;$("pets_countbar_plus").onclick=new Function("pets.buyAddLevelCommit()")}this.happiness_reduction={};if(this.data.breed&&this.data.breed.care_remains){for(var a=0;a<this.needs.length;a++){if(!this.data.breed.care_remains[this.needs[a]]||this.data.breed.care_remains[this.needs[a]]<=0){if(this.data.breed.happiness_interval&&this.data.breed.happiness_interval[this.needs[a]]){this.happiness_reduction[this.needs[a]]=this.data.breed.happiness_interval[this.needs[a]]}}}}};pets.prototype.addLevelCommit=function(){var b=t_pets_dialog_leveladd_head;var a=htmlLevelAddDialog("pets");globalcommitbox(b,a,0,0,1)};pets.prototype.addLevelCheck=function(){var a=$("pets_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>pets.data.data.count){a=pets.data.data.count}$("pets_dialog_leveladd_insert").value=a};pets.prototype.buyAddLevelCommit=function(b){var e=pets.data.data.exchangeamount;var d=specialbonus.findBonus({key1:"pets",key2:"buypoints"});var m="";var l="";if(d&&d.buypoints){e=Math.ceil(e*(1+d.buypoints));m="color:green; font-weight:bold;";l='<div style="margin-top:5px;">'+specialbonus.htmlBonusLine(d.buypoints)+"</div>"}var c=t_pets_levelitem_buy;txt=t_pets_levelitem_buy_dialog.replace("%COINS%",pets.data.data.exchangecoins).replace("%AMOUNT%",'<span style="'+m+'">'+e+"</span>");if(!b){var a='<div style="width:300px;">';a+='  <div class="link coinsbutton_flex" style="font-size:12px; font-weight:normal;" onclick="pets.buyAddLevelCommit(1)">'+txt+"</div>";if(l!=""){a+=l}a+="</div>";globalcommitbox(c,a,0,0,1)}else{var a='<div style="width:300px;">';a+=txt;if(l!=""){a+=l}a+="</div>";var h="pets.buyAddLevel()";globalcommitbox(c,a,h)}};pets.prototype.update=function(){production.buildOuterProductionLine("pets");if($("pets")){hideDiv("pets_happiness");hideDiv("pets_pet_needs");if(this.data.breed){$("pets_pet").className="pet pets_pet"+this.data.breed.animal;if(this.data.breed.remain>0){this.breed()}else{this.finishBreed()}if(this.data.breed.care_remains){for(var b=0;b<this.needs.length;b++){if(this.data.breed.care_remains[this.needs[b]]>0){$("pets_need_"+this.needs[b]).addClassName("block");showDiv("pets_need_"+this.needs[b]+"_timer");$("pets_need_"+this.needs[b]+"_timer_amount").innerHTML=formatTime(this.data.breed.care_remains[this.needs[b]]);var c=0;for(var a in this.data.breed.care){if(this.data.breed.care[a].type==this.needs[b]){c=((this.data.breed.care_remains[this.needs[b]]*100)/this.data.breed.care[a].duration)}}$("pets_need_"+this.needs[b]+"_timer_inner").style.width=Math.max(c,0)+"%"}else{hideDiv("pets_need_"+this.needs[b]+"_timer");$("pets_need_"+this.needs[b]).removeClassName("block")}}}this.calcHappiness()}else{showDiv("pets_pet_start")}for(var e=1;e<=4;e++){var d=this.getCurrentProductionPosition(e);pets.updateProductionSlot(e,d)}if(this.data.quest&&!this.data.quest.end){if(this.data.quest.remain>0){showDiv("pets_quest_timer");hideDiv("pets_quest_data");if($("pets_quest_timer")){$("pets_quest_timer").innerHTML=formatTime(this.data.quest.remain)}}else{hideDiv("pets_quest_timer");showDiv("pets_quest_data")}}}};pets.prototype.timer=function(){if(this.data.data){if(this.data.breed){this.data.breed.remain--;if(this.data.breed.care_remains){for(var h=0;h<this.needs.length;h++){if(this.data.breed.care_remains[this.needs[h]]){this.data.breed.care_remains[this.needs[h]]--;if(this.data.breed.care_remains[this.needs[h]]==1){this.happiness_reduction[this.needs[h]]=1}}}}}if(this.data.data.pets_queue_active&&this.data.data.queue_remain){this.data.data.queue_remain--;if($("pets_pharmacist")){showDiv("pets_pharmacist");var a="pets.buyPharmacistCommit()";if(this.data.data.queue_remain>0){$("pets_pharmacist_timer").innerHTML=formatTime(this.data.data.queue_remain);showDiv("pets_pharmacist_timer");hideDiv("pets_pharmacist_unlocked");a=""}else{hideDiv("pets_pharmacist_timer");showDiv("pets_pharmacist_unlocked")}var d=0;for(var e=1;e<=4;e++){var m=0;var l=0;for(var b=1;b<=3;b++){if(this.data.production[e]&&this.data.production[e][b]){l++}}if(this.data.data.queue_remain<=0&&(!l||l<=1)){hideDiv("pets_pharmacist_slots"+e)}else{d++;showDiv("pets_pharmacist_slots"+e)}for(var b=1;b<=3;b++){if(this.data.production[e]&&this.data.production[e][b]){var s=this.getCurrentProductionPos(e);m+=parseInt(this.data.production[e][b].duration);var c="harvest";t="pets.harvestProduction("+e+", "+b+")";if(this.data.production[e]["gone"]<m){c="next";var t=""}if(s==b&&this.data.production[e]["gone"]<m){c="running";var t=""}$("pets_pharmacist_slot_img"+e+"_"+b).className="pets_pharmacist_slot_img tt"+this.data.production[e][b].pid;$("pets_pharmacist_slot_status"+e+"_"+b).className="pets_pharmacist_slot_status "+c;var n=produkt_name[this.data.production[e][b].pid]}else{if(this.data.data.queue_remain>0){var t="pets.productionSelection("+e+")";var n=t_pharmacist_free_slot}else{var t="";var n=t_pharmacist_pets_free_slot_block}}$("pets_pharmacist_slot_tt"+e+"_"+b).innerHTML=n;$("pets_pharmacist_slot"+e+"_"+b).onclick=new Function(t)}}if(d>0){$("pets_slots").className="pets_production_slots_spacer";for(var h=1;h<=4;h++){$("pets_productionslot"+h).className="slot pets_production_slot_spacer"}}else{$("pets_slots").className="pets_production_slots_normal"}$("pets_pharmacist").onclick=new Function(a)}}for(var r=1;r<=4;r++){var q=this.getCurrentProductionPosition(r);if(this.data.production[r]){this.data.production[r]["gone"]++;if(this.data.production[r][q]){this.data.production[r][q].remain--}}if(this.data.data.slots&&this.data.data.slots[r]&&this.data.data.slots[r].rent_remain){this.data.data.slots[r].rent_remain--;if(!this.data.data.slots[r].rent_remain){this.data.data.slots[r].rent_remain--}}}if(this.data.quest&&this.data.quest.remain){this.data.quest.remain--}for(var h in this.stats_cache_delay){this.stats_cache_delay[h]--}this.update()}};pets.prototype.buyPharmacistCommit=function(a){production.buyQueueCommit("pets",a)};pets.prototype.getCurrentProductionPos=function(a){return production.currentQueueSlot("pets",a)};pets.prototype.breed=function(){var b='<div class="intro">'+t_pets_fav_list+"</div>";for(var a=0;a<this.needs.length;a++){b+='<div class="item tt'+this.data.breed["fav_"+this.needs[a]]+'"></div>'}b+='<div class="clear"></div>';b+='<div class="bonusinfo">'+str_replace("%PERCENT%",(this.data.config.fav_bonus*100),t_pets_fav_info)+"</div>";$("pets_pet_tt").innerHTML=b;$("pets_pet").onmouseover=new Function("showDiv('pets_pet_tt')");$("pets_pet").onmouseout=new Function("hideDiv('pets_pet_tt')");showDiv("pets_happiness");showDiv("pets_pet_needs");showDiv("pets_timer_box");$("pets_timer").style.width=100-((this.data.breed.remain*100)/this.data.config.duration)+"%";$("pets_timer_text").innerHTML=str_replace("%TIME%",formatTime(this.data.breed.remain),t_pets_breed_resttime)};pets.prototype.calcHappiness=function(){if(this.data.breed){for(var c=0;c<this.needs.length;c++){hideDiv("pets_need_"+this.needs[c]+"_timer_reduction");if(this.happiness_reduction[this.needs[c]]){this.happiness_reduction[this.needs[c]]++;$("pets_need_"+this.needs[c]+"_timer_reduction_amount").innerHTML=formatTime(this.data.config.reduction_duration-this.happiness_reduction[this.needs[c]]);var d=100-((this.happiness_reduction[this.needs[c]]*100)/this.data.config.reduction_duration);$("pets_need_"+this.needs[c]+"_timer_reduction_inner").style.width=d+"%";showDiv("pets_need_"+this.needs[c]+"_timer_reduction")}if(this.happiness_reduction[this.needs[c]]>=this.data.config.reduction_duration){this.data.breed.happiness=Math.max(parseInt(this.data.breed.happiness)-parseInt(this.data.config.reduction_amount),0);this.happiness_reduction[this.needs[c]]=1}}var d=Math.round(this.data.breed.happiness*100/this.data.config.max_happiness);$("pets_happiness_inner").style.height=d+"%";$("pets_happiness_percent").innerHTML=d+"%";var a=((this.data.breed.happiness*100)/this.data.config.max_happiness);var e=roundDecimal((Math.pow(a,1.8)/4000)*100);var b="<div>"+t_pets_happiness+"<br>"+formatNumber(this.data.breed.happiness)+"/"+formatNumber(this.data.config.max_happiness)+"</div>";b+='<div style="margin-top:10px;">'+t_calc_happiness_bonus+e+"%</div>";$("pets_happiness_tt").innerHTML=b}};pets.prototype.finishBreed=function(){hideDiv("pets_timer_box");showDiv("pets_pet_finish")};pets.prototype.startSelection=function(){var m="addon";var a='<div id="pets_start_selection" class="'+m+'">';a+='  <div class="animals">';count=1;for(var d in this.data.config.animals){var c=0;if(this.data.parts&&this.data.parts[d]&&this.data.parts[d].complete>0){c=this.data.parts[d].complete}var b="block";var l="";var h="";if(c>0){b="";l="pets.startBreed("+d+")";h="onmouseover=\"showDiv('pets_start_selection"+d+"_tt')\" onmouseout=\"hideDiv('pets_start_selection"+d+"_tt')"}a+='<div class="item link pets_parts_base'+d+" "+b+'" '+h+'" onclick="'+l+'">';a+='  <div class="rarity rarity'+this.data.config.animals[d].rarity+'"></div>';a+='  <div class="amount">'+c+"</div>";var e="";if(count%6==0){e="right"}a+='  <div id="pets_start_selection'+d+'_tt" class="ttbox '+e+'">';a+='    <div class="name">'+this.data.config.animals[d].name+"</div>";a+="    <div>"+t_pets_multi.points+":&nbsp;"+Math.round((this.data.config.animals[d].points_multi-1)*100)+"%</div>";a+="    <div>"+t_pets_multi.money+":&nbsp;"+Math.round((this.data.config.animals[d].money_multi-1)*100)+"%</div>";a+="  </div>";a+="</div>";count++}a+="  </div>";a+="</div>";globalBoxFlex(t_pets_breed_doit,a,0,0,1);$("globalbox").style.top="50px"};pets.prototype.needSlot=function(l){if(!l){l=this.care_need}else{this.care_need=l}this.need_selection_slot=0;this.need_selection_page=1;if(this.data.breed.care_remains&&this.data.breed.care_remains[l]>0){return false}var d='<div id="pets_need_slot">';d+='<div class="head"><div class="img '+this.care_need+'"></div></div>';d+='<div class="intro">'+t_pets_need_slot_info+"</div>";var b=0;var m=0;var a=0;var h=0;for(var c=1;c<=3;c++){d+='<div class="slot link" onclick="pets.needSelection('+c+')" onmouseover="showDiv(\'pets_need_slot'+c+"')\" onmouseout=\"hideDiv('pets_need_slot"+c+"')\">";if(this.care_set[c]){d+='<div class="img pets_item'+this.care_set[c]+'"></div>'}d+='	<div id="pets_need_slot'+c+'" class="ttbox tt">'+t_pets_need_slot+"</div>";if(this.care_set[c]){var n="";var q=this.data.config.tools[this.care_set[c]].happiness;if(this.data.breed["fav_"+l]==this.care_set[c]){q=Math.ceil(q*(1+this.data.config.fav_bonus));n="bonus";h++}d+='<div class="info">';d+='  <div class="name">'+produkt_name[this.care_set[c]]+"</div>";d+="  <div>"+t_duration+":&nbsp;"+formatTime(this.data.config.tools[this.care_set[c]].happy_duration)+"</div>";d+="  <div>"+t_pets_happiness+':&nbsp;<span class="'+n+'">'+q+"</span></div>";d+="</div>";b+=this.data.config.tools[this.care_set[c]].happy_duration;m+=q}else{a=1}d+="</div>"}if(b>0){b+=this.data.config.time_base[l]}d+='  <div class="clear"></div>';if(m>0){d+='<div class="sum">';d+='  <div class="info">'+t_pets_need_sum+"</div>";d+="  <div>"+t_pets_need_sum_duration+":&nbsp;"+formatTime(b)+"</div>";d+="  <div>"+t_pets_happiness+":&nbsp;"+m+"</div>";if(!a){d+='<div class="button_new link" onclick="pets.care()">'+t_inner_feedsubmit+"</div>"}d+="</div>"}if(h>0){d+='<div class="bonus">'+t_pets_fav_bonus+"</div>"}d+="</div>";var e="pets.care_set={}; hideDiv('globalbox'); hideDiv('globaltransp');";globalBoxFlex("",d,0,e,1)};pets.prototype.needSelection=function(r){if(!r){r=this.need_selection_slot}this.need_selection_slot=r;var w={};for(var c in this.care_set){if(!w[this.care_set[c]]){w[this.care_set[c]]=1}else{w[this.care_set[c]]+=1}}var e='<div id="pets_need_slot_selection">';var s=((this.need_selection_page-1)*6)+1;var t=(this.need_selection_page*6);var h=1;var m=this.toolsSort();for(var a in m){for(var c=0;c<m[a].length;c++){var b=m[a][c];var v="pets.needSelectionSet("+b.id+")";var l="";var d=checkRackItem(b.id);if(w[b.id]){d-=w[b.id]}if(d<1){l="opacity:0.5";v=""}if(b.type!=this.care_need){continue}if(h>=s&&h<=t){var q="";var u=b.happiness;if(this.data.breed["fav_"+b.type]==b.id){u=Math.ceil(u*(1+this.data.config.fav_bonus));q="bonus"}e+='<div class="slot link '+q+'" style="'+l+'" onclick="'+v+'">';e+='  <div class="img tt'+b.id+'"></div>';e+='  <div class="info">';e+='    <div class="name">'+produkt_name[b.id]+"</div>";e+="    <div>"+t_pets_happy_duration+":&nbsp;"+formatTime(b.happy_duration)+"</div>";e+="    <div>"+t_points+":&nbsp;"+formatNumber(b.points_care)+"</div>";e+="    <div>"+t_money+":&nbsp;"+formatPrice(b.money_care)+"</div>";e+="    <div>"+t_pets_points+":&nbsp;"+formatNumber(b.breedpoints_care)+"</div>";e+="    <div>"+t_pets_happiness+':&nbsp;<span class="'+q+'">'+formatNumber(u)+"</span></div>";if(q!=""){e+='<div class="bonus">'+t_pets_fav_bonus+"</div>"}e+="  </div>";e+='  <div class="amount">'+d+"</div>";e+='  <div class="clear"></div>';e+="</div>"}h++}}e+='  <div id="pets_need_selection_navi_up" class="link" onclick="pets.needSelectionNavi(-1, '+h+')"></div>';e+='  <div id="pets_need_selection_navi_down" class="link" onclick="pets.needSelectionNavi(1, '+h+')"></div>';e+="</div>";var n="pets.needSlot()";globalBoxFlex(t_pets_need_slot_selection,e,0,n,1);$("globalbox").style.top="50px"};pets.prototype.needSelectionSet=function(a){this.care_set[this.need_selection_slot]=a;this.needSlot()};pets.prototype.needSelectionNavi=function(b,c){var a=parseInt(Math.ceil(c/6));this.need_selection_page+=b;if(this.need_selection_page<1){this.need_selection_page=1}if(this.need_selection_page>a){this.need_selection_page=a}this.needSelection();hideDiv("pets_need_selection_navi_up");hideDiv("pets_need_selection_navi_down");if(this.need_selection_page>1){showDiv("pets_need_selection_navi_up")}if(this.need_selection_page<a){showDiv("pets_need_selection_navi_down")}};pets.prototype.buildProductionSlots=function(){var a="";for(var b=1;b<=4;b++){a+=production.buildSlot("pets",b)}$("pets_slots").innerHTML=a;this.update()};pets.prototype.updateProductionSlot=function(l,d){if($("pets_productionslot"+l)){var r="pets.productionSelection("+l+")";var a=t_start_production;if(this.data.production[l]&&this.data.production[l][d]){var c=parseInt(this.data.production[l][d].amount);var q="";var m="";if(specialbonus){var h=specialbonus.findBonus({key1:"pets",key2:"production_harvest"});if(h){c+=h.production_harvest;q='<div class="specialbonus">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+h.production_harvest)+")</div>";m="specialbonus"}}a='<div class="name '+m+'">'+formatNumber(c)+"x&nbsp;"+produkt_name[this.data.production[l][d].pid]+"</div>";$("pets_productionslot"+l+"_img").addClassName("pets_item"+this.data.production[l][d].pid);if(this.data.production[l][d].remain>0){a+=formatTime(this.data.production[l][d].remain);showDiv("pets_productionslot"+l+"_cancel");showDiv("pets_productionslot"+l+"_speedup");r="";if(this.data.data.queue_remain>0){for(var b=1;b<=3;b++){if(!this.data.production[l][b]){r="pets.productionSelection("+l+")";break}}}}else{a+='<div class="ready">'+click4products+"</div>";r="pets.harvestProduction("+l+", "+d+")"}if(q!=""){a+=q}}hideDiv("pets_productionslot"+l+"_block");if(this.data.data.slots[l]&&this.data.data.slots[l].block){hideDiv("pets_productionslot"+l+"_cancel");hideDiv("pets_productionslot"+l+"_speedup");showDiv("pets_productionslot"+l+"_block");r="pets.buyProductionSlotCommit("+l+")";if(this.data.data.slots[l].rent_duration){var s=this.data.data.slots[l].coins;var e="";var q="";var n=0;var h=specialbonus.findBonus({key1:"pets",key2:"rentslot"});if(h&&h.rentslot){n=h.rentslot}var h=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(h&&in_array("pets",h.types)){n=h.discount}if(n>0){s=Math.ceil(s*(1-n));e="color:green; font-weight:bold;";q=specialbonus.htmlBonusLine(n,1)}a=str_replace("%TIME%",formatTime(this.data.data.slots[l].rent_duration),t_rent_slot);a=str_replace("%COINS%",'<span style="'+e+'">'+s+"&nbsp;"+t_coins+"</span>",a);if(q!=""){a+=q}}else{if(this.data.data.slots[l].money){a=str_replace("%MONEY%",formatPrice(this.data.data.slots[l].money),t_buy_slot)}if(this.data.data.slots[l].coins){a=str_replace("%MONEY%",this.data.data.slots[l].coins+"&nbsp;"+t_coins,t_buy_slot)}}a='<div id="pets_productionslot_info'+l+'" class="ready">'+a+"</div>"}$("pets_productionslot"+l+"_info").innerHTML=a;$("pets_productionslot"+l+"_click").onclick=new Function(r);hideDiv("pets_productionslot"+l+"_rent_timer");if(this.data.data.slots[l]&&this.data.data.slots[l].rent_remain){if(this.data.data.slots[l].rent_remain>0){showDiv("pets_productionslot"+l+"_rent_timer");$("pets_productionslot"+l+"_rent_timer").innerHTML=formatTime(this.data.data.slots[l].rent_remain)}else{this.data.data.slots[l].block=1}}}};pets.prototype.getCurrentProductionPosition=function(d){var b=0;if(this.data.production[d]){if(this.data.production[d]["gone"]>=this.data.production[d]["duration"]){for(var a=1;a<=3;a++){if(this.data.production[d][a]){b=a}}}else{var c=0;for(var a=1;a<=3;a++){if(this.data.production[d][a]){c+=parseInt(this.data.production[d][a].duration);if(c>this.data.production[d]["gone"]){b=a;break}}}}}return b};pets.prototype.buyProductionSlotCommit=function(d){var b=click4buyslot;if(this.data.data.slots[d].rent_duration){b=click4rentslot}var a=$("pets_productionslot_info"+d).innerHTML;var c="pets.buyProductionSlot("+d+")";globalcommitbox(b,a,c)};pets.prototype.productionSelectionCommit=function(b){if(!this.data.config.tools[b]){return 0}var d="pets.startProduction("+b+")";var c="pets.productionSelection()";var a='<div id="pets_production_selection_commit">';a+='  <div class="img tt'+b+'"></div>';a+='  <div class="name">'+produkt_name[b]+"</div>";if(this.data.config.tools[b].money){var e=formatPrice(this.data.config.tools[b].money)}if(this.data.config.tools[b].coins){var e=this.data.config.tools[b].coins+"&nbsp;"+t_coins}a+="  <div>"+cityadcost+e+"</div>";a+="</div>";globalcommitbox(t_start_production,a,d,c)};pets.prototype.productionSelection=function(t){if(!t){t=this.production_slot}else{this.production_slot=t}var l=[];var u=((this.production_selection_page-1)*4)+1;var v=(this.production_selection_page*4);var m='<div id="pets_production_selection">';var n=1;var q=this.toolsSort();for(var a in q){for(var d=0;d<q[a].length;d++){data=q[a][d];if(this.production_selection_sort!=""&&data.type!=this.production_selection_sort){continue}if(n>=u&&n<=v){var c=0;var z="";var h=data.amount;var w="";var s="";if(specialbonus){var r=specialbonus.findBonus({key1:"pets",key2:"production_harvest"});if(r){h+=r.production_harvest;w='<div style="color:green;">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+r.production_harvest)+")</div>";s="specialbonus"}}m+='<div id="pets_production_selection_slot'+data.id+'" class="slot link" onclick="pets.productionSelectionCommit('+data.id+')">';m+='  <div class="img tt'+data.id+'"></div>';m+='  <div class="info">';m+='    <div class="name '+s+'">'+formatNumber(h)+"x "+produkt_name[data.id]+"</div>";m+="    <div>"+t_points+":&nbsp;"+formatNumber(data.points)+"</div>";m+="    <div>"+t_pets_points+":&nbsp;"+formatNumber(data.breedpoints_production)+"</div>";if(w!=""){m+=w}m+='    <div class="infoadd" onmouseover="showDiv(\'pets_production_selection'+data.id+"_info')\" onmouseout=\"hideDiv('pets_production_selection"+data.id+"_info')\">i";m+='      <div id="pets_production_selection'+data.id+'_info" class="ttbox">';m+='        <div class="intro">'+t_pets_addinfo+"</div>";m+="        <div>"+t_pets_happy_duration+":&nbsp;"+formatTime(data.happy_duration)+"</div>";m+="        <div>"+t_points+":&nbsp;"+formatNumber(data.points_care)+"</div>";m+="        <div>"+t_money+":&nbsp;"+formatPrice(data.money_care)+"</div>";m+="        <div>"+t_pets_points+":&nbsp;"+formatNumber(data.breedpoints_care)+"</div>";m+="        <div>"+t_pets_happiness+":&nbsp;"+formatNumber(data.happiness)+"</div>";m+="      </div>";m+="    </div>";m+="  </div>";m+='  <div class="clear"></div>';m+='  <div class="needs">';if(this.data.data.level<data.breedlevel){m+='<div class="block important">'+str_replace("%LEVEL%",data.breedlevel,t_pets_need_level)+"</div>";c=1}else{var s="";if(data.money){if(data.money>user_bar){s="important";c=1}var b=formatPrice(data.money)}if(data.coins){if(data.coins>user_coins){s="important";c=1}var b=data.coins+"&nbsp;"+t_coins}m+='<div class="intro">'+t_needs+":</div>";m+='<div class="intro_block">';m+="  <div>"+formatTime(data.duration)+"</div>";m+='  <div class="cost '+s+'">'+b+"</div>";m+="</div>";m+='<div class="clear"></div>';for(var e in data.needs){var s="";if(data.needs[e]>checkRackItem(e)){s="important";c=1}m+='<div class="product" onmouseover="showDiv(\'pets_production_selection_need_product'+data.id+"_"+e+"')\" onmouseout=\"hideDiv('pets_production_selection_need_product"+data.id+"_"+e+"')\">";m+='  <div class="l'+e+'" style="border-radius:5px;"></div>';m+='  <div class="'+s+'" style="font-weight:bold;">'+data.needs[e]+"x</div>";m+='  <div id="pets_production_selection_need_product'+data.id+"_"+e+'" class="product_tt ttbox">'+produkt_name[e]+"</div>";m+="</div>"}}m+="  </div>";m+="</div>";if(c){l.push(data.id)}}n++}}m+='  <div id="pets_production_selection_navi_up" class="link" onclick="pets.productionSelectionNavi(-1, '+n+')"></div>';m+='  <div id="pets_production_selection_navi_down" class="link" onclick="pets.productionSelectionNavi(1, '+n+')"></div>';m+='  <div class="sort">';for(var d=0;d<this.needs.length;d++){var w="";if(this.production_selection_sort==this.needs[d]){w="active"}m+='<div id="pets_production_selection_sort_'+this.needs[d]+'" class="type link '+w+'" onclick="pets.productionSelectionSort(\''+this.needs[d]+"')\">";m+='  <div class="img '+this.needs[d]+'"></div>';m+="</div>"}m+="  </div>";m+="</div>";globalBoxFlex(t_choose_to_produce,m,0,0,1);$("globalbox").style.top="40px";this.productionSelectionNavi(0,n);for(var d=0;d<l.length;d++){$("pets_production_selection_slot"+l[d]).onclick=new Function("")}};pets.prototype.productionSelectionSort=function(a){if(this.production_selection_sort==a){this.production_selection_sort=""}else{this.production_selection_sort=a}this.production_selection_page=1;this.productionSelection()};pets.prototype.productionSelectionNavi=function(b,c){var a=parseInt(Math.ceil(c/4));this.production_selection_page+=b;if(this.production_selection_page<1){this.production_selection_page=1}if(this.production_selection_page>a){this.production_selection_page=a}if(b){this.productionSelection()}hideDiv("pets_production_selection_navi_up");hideDiv("pets_production_selection_navi_down");if(this.production_selection_page>1){showDiv("pets_production_selection_navi_up")}if(this.production_selection_page<a){showDiv("pets_production_selection_navi_down")}};pets.prototype.parts=function(){var e='<div id="pets_parts">';e+='  <div class="intro">'+t_pets_parts_intro+"</div>";e+='  <div class="rarity">';var m=3;if(pets_addon==1){m=4}for(var c=1;c<=m;c++){var n="";if(this.rarity==c){n="active"}e+='<div id="pets_parts_rarity'+c+'" class="item rarity'+c+" link "+n+'" onclick="pets.rarity='+c+'; pets.parts();" onmouseover="showDiv(\'pets_parts_rarity'+c+"_tt')\" onmouseout=\"hideDiv('pets_parts_rarity"+c+"_tt')\">";e+='  <div id="pets_parts_rarity'+c+'_tt" class="ttbox pets_parts_rarity_tt">'+t_pets_rarity[c]+"</div>";e+="</div>"}e+="  </div>";e+='  <div class="pets">';for(var c in this.data.config.animals){if(this.rarity==this.data.config.animals[c].rarity){var h=0;if(this.data.parts[c]&&this.data.parts[c].complete){h=parseInt(this.data.parts[c].complete)}e+='<div class="item">';e+='  <div class="name">'+this.data.config.animals[c].name+"</div>";e+='  <div class="img">';e+='    <div class="set">';var a=0;var d=0;for(var b=1;b<=this.data.config.default_parts;b++){if(this.data.parts[c]&&this.data.parts[c][b]&&parseInt(this.data.parts[c][b])>h){a=1}}for(var b=1;b<=this.data.config.default_parts;b++){var l="shadow";if(h>=1||this.data.collected[c]||(this.data.breed&&this.data.breed.animal==c)){l="grey"}if(this.data.parts[c]&&this.data.parts[c][b]&&((!a&&h>0)||(a&&parseInt(this.data.parts[c][b])>h))){l="color"}e+='<div class="pets_parts_'+l+c+" pets_part pets_part"+b+'"></div>';if(b%3==0){e+='<div class="clear"></div>'}if((h<1&&(!this.data.parts[c]||!this.data.parts[c][b]))){d++}if(h>=1&&parseInt(this.data.parts[c][b])<=h){d++}}e+="    </div>";e+="  </div>";e+='  <div class="info" onmouseover="showDiv(\'pets_parts_item_info'+c+"_tt')\" onmouseout=\"hideDiv('pets_parts_item_info"+c+"_tt')\">i";e+='    <div id="pets_parts_item_info'+c+'_tt" class="ttbox tt">';e+="      <div>"+t_pets_multi.points+":&nbsp;"+Math.round((this.data.config.animals[c].points_multi-1)*100)+"%</div>";e+="      <div>"+t_pets_multi.money+":&nbsp;"+Math.round((this.data.config.animals[c].money_multi-1)*100)+"%</div>";e+="    </div>";e+="  </div>";if(this.data.config.complete[d]){e+='<div class="complete link" onclick="pets.completeAnimalCommit('+c+", "+d+')" onmouseover="showDiv(\'pets_parts_completebutton'+c+"')\" onmouseout=\"hideDiv('pets_parts_completebutton"+c+"')\">";e+='  <div id="pets_parts_completebutton'+c+'" class="ttbox">'+t_pets_buy_animal_head+"</div>";e+="</div>"}if(h>0&&this.data.data&&!this.data.breed&&!this.data.block){e+='<div class="breedbutton link" onclick="pets.startBreed('+c+')" onmouseover="showDiv(\'pets_parts_breedbutton'+c+"')\" onmouseout=\"hideDiv('pets_parts_breedbutton"+c+"')\">";e+='  <div class="bottle"></div>';e+='  <div id="pets_parts_breedbutton'+c+'" class="ttbox">'+t_pets_breed_doit+"</div>";e+="</div>"}e+='  <div class="amount">'+h+"</div>";e+="</div>"}}e+="  </div>";e+='  <div class="packs">';for(var l in this.data.packs){if(l>0){e+='<div class="item pets_package'+l+' link" onclick="pets.openPack('+l+')">';e+='  <div class="amount">'+this.data.packs[l]+"</div>";e+="</div>"}}e+='    <div class="clear"></div>';e+='    <div class="buy link" onclick="pets.partsBuy()" onmouseover="showDiv(\'pets_parts_rarity_buy_tt\')" onmouseout="hideDiv(\'pets_parts_rarity_buy_tt\')">';e+='      <div id="pets_parts_rarity_buy_tt" class="ttbox">'+t_pets_parts_buy_head+"</div>";e+="    </div>";e+="  </div>";e+="  <div class=\"help helpbutton_blue link\" onclick=\"hideDiv('globaltransp'); hideDiv('globalbox'); openFarmersMarketHowTo('pets');\"></div>";e+="</div>";globalBoxFlex(t_pets_parts,e,0,0,1);$("globalbox").style.top="50px"};pets.prototype.completeAnimalCommit=function(l,d){var a=this.data.config.complete[d][this.data.config.animals[l].rarity];var h=str_replace("%ANIMAL%",this.data.config.animals[l].name,t_pets_buy_animal);h=str_replace("%COINS%",a,h);var c='<div id="pets_complete_animal_commit">';c+='  <div class="img pets_parts_base'+l+'"></div>';c+="  <div>"+h+"</div>";c+="</div>";var e="pets.completeAnimal("+l+")";var b="pets.parts()";globalcommitbox(t_pets_buy_animal_head,c,e,b)};pets.prototype.partsBuy=function(){var n="addon";var c='<div id="pets_parts_buy" class="'+n+'">';for(var b in this.data.config.parts_packages){c+='<div class="item '+n+" pets_package"+b+'">';c+='  <div class="info">';for(var a in this.data.config.parts_packages[b].content){c+="<div>"+this.data.config.parts_packages[b].content[a]+"x&nbsp;"+t_pets_rarity[a]+"</div>";if(b==1){var m=t_pets_buy_pack1_info;if(!this.data.daily){this.data.config.parts_packages[b].coins=this.data.config.parts_packages[b].altcoins;delete this.data.config.parts_packages[b].money}c+='<div class="bonusinfo">'+m+"</div>"}}c+="  </div>";var l="";var q="pets.partsBuyCommit("+b+")";if(b==1){q="pets.partsBuyCommit("+b+", 1)"}var d="";if(this.data.config.parts_packages[b].coins){d=this.data.config.parts_packages[b].coins[1];if(specialbonus){var e=specialbonus.findBonus({key1:"pets",key2:"packagediscount"});if(e&&e.type=="coins"){d=Math.round(d*(1-e.packagediscount));c+='<div class="bonus_star pulse">';c+='  <div class="inner">';c+='    <div class="percent">'+(e.packagediscount*100)+"%</div>";c+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";c+="  </div>";c+="</div>"}}if(user_coins<d){q=""}d+=" "+t_coins}if(this.data.config.parts_packages[b].money){d=this.data.config.parts_packages[b].money[1]+" "+gamecurrency;if(user_bar<this.data.config.parts_packages[b].money[1]){q=""}}if(this.data.config.parts_packages[b].breedpoints){d=this.data.config.parts_packages[b].breedpoints[1]+" "+t_pets_points;if(!this.data.data||parseInt(this.data.data.count)<this.data.config.parts_packages[b].breedpoints[1]){q=""}}if(q==""){l="important"}c+='<div class="buy coinsbutton_flex '+n+" link "+l+'" onclick="'+q+'">'+str_replace("%AMOUNT%",d,t_buy_it_default)+"</div>";c+="</div>"}c+="</div>";var h="pets.parts()";globalBoxFlex(t_pets_parts_buy_head,c,0,h,1);$("globalbox").style.top="50px"};pets.prototype.partsBuyCommit=function(c,d){var m=0;if(specialbonus){m=specialbonus.findBonus({key1:"pets",key2:"packagediscount"})}var n="pets.partsBuy()";var e='<div id="pets_parts_buy_packages">';e+='  <div class="item pets_package'+c+'">';if(m){e+='<div class="bonus_star pulse">';e+='  <div class="inner">';e+='    <div class="percent">'+(m.packagediscount*100)+"%</div>";e+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";e+="  </div>";e+="</div>"}e+="  </div>";if(d>0){var s="pets.partsBuyFire("+c+", "+d+")";if(this.data.config.parts_packages[c].coins){var t=this.data.config.parts_packages[c].coins[d];if(m&&m.type=="coins"){t=Math.round(t*(1-m.packagediscount))}var a=t+"&nbsp;"+t_coins}if(this.data.config.parts_packages[c].money){var a=this.data.config.parts_packages[c].money[d]+"&nbsp;"+gamecurrency}if(this.data.config.parts_packages[c].breedpoints){var a=this.data.config.parts_packages[c].breedpoints[d]+"&nbsp;"+t_pets_points}e+=d+"&nbsp;"+str_replace("%COST%",a,t_pets_parts_buy_body);e+="</div>";globalcommitbox(t_pets_parts_buy_head,e,s,n)}else{var h=["coins","breedpoints"];for(var b=0;b<h.length;b++){if(this.data.config.parts_packages[c][h[b]]){var l=this.data.config.parts_packages[c][h[b]];for(var d in l){if(h[b]=="coins"){var t=l[d];if(m&&m.type==h[b]){t=Math.round(t*(1-m.packagediscount))}}var q="";var s="pets.partsBuyCommit("+c+", "+d+")";if((h[b]=="coins"&&user_coins<t)||(h[b]=="breedpoints"&&(!this.data.data||parseInt(this.data.data.count)<l[d]))){s=""}if(s==""){q="important"}var r=str_replace("%COUNT%",d,t_pets_buy_packages);if(h[b]=="coins"){r=str_replace("%AMOUNT%",formatNumber(t)+"&nbsp"+t_coins,r)}if(h[b]=="breedpoints"){r=str_replace("%AMOUNT%",formatNumber(l[d])+"&nbsp"+t_pets_points,r)}e+='<div class="buy coinsbutton_flex link '+q+'" onclick="'+s+'">'+r+"</div>"}}}e+="</div>";globalBoxFlex(t_pets_parts_buy_head,e,0,n,1)}};pets.prototype.showQuest=function(){var l=str_replace("%QUEST%",this.data.quest.questid,t_pets_quest_head);var c='<div id="pets_quest">';c+='  <div class="intro">'+t_pets_quest_body+"</div>";c+='  <div id="pets_quest_data">';c+='    <div class="need">';for(var b in this.data.quest.products){var d=0;if(this.data.quest.data&&this.data.quest.data[b]){d=this.data.quest.data[b]}var e=((d*100)/this.data.quest.products[b]);var n="";var m="important";if(checkRackItem(b)>0){var n="pets.questEntryCommit("+b+")";var m=""}if(d>=this.data.quest.products[b]){n=""}c+='<div class="item">';c+='  <div class="kp'+b+'"></div>';c+='  <div class="bar link" onclick="'+n+'" onmouseover="showDiv(\'pets_quest_need_item'+b+"')\" onmouseout=\"hideDiv('pets_quest_need_item"+b+"')\">";c+='    <div class="inner" style="width:'+e+'%"></div>';c+='    <div id="pets_quest_need_item'+b+'" class="ttbox">'+produkt_name[b]+"</div>";c+="  </div>";c+='  <div class="amount '+m+'">'+formatNumber(d)+"/"+formatNumber(this.data.quest.products[b])+"</div>";c+="  <br>";c+="</div>"}c+="    </div>";c+="    <div>"+t_megafield_reward_basic+"</div>";c+='    <div class="reward">';for(var h in this.data.quest.reward){if(h=="points"){var m="megafield_points_icon";var a=formatNumber(this.data.quest.reward[h])+"&nbsp;"+t_points}if(h=="package"){var m="package pets_package"+this.data.quest.reward[h];var a="1x"}c+='<div class="img '+m+'"></div>';c+='<div class="amount">'+a+"</div>";c+="<br>"}c+="    </div>";c+="  </div>";c+='  <div id="pets_quest_timer" class="timer"></div>';c+="</div>";if(this.data.quest.end){l=str_replace("%QUEST%.","",t_pets_quest_head);c=t_pets_out_of_quests}globalcommitbox(l,c,0,0,1)};pets.prototype.questEntryCommit=function(c){for(var h in this.data.quest.products){if(h==c){var d=this.data.quest.products[c];if(this.data.quest.data&&this.data.quest.data[c]){var d=(d-this.data.quest.data[c])}break}}var a=checkRackItem(c);var b="kp"+c;if(a>d){a=d}var e={pid:c};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(e),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("pets.checkQuestEntry("+c+", "+d+")");$("dialog_entryline_number").onkeyup=new Function("pets.checkQuestEntry("+c+", "+d+")");this.checkQuestEntry(c,d)};pets.prototype.checkQuestEntry=function(a,c){var e=checkRackItem(a);var b="product";var d={type:b,stockamount:e,rest:c,click:"pets.questEntry("+a+")"};checkEntryLine(d)};pets.prototype.showStats=function(){var a='<div id="pets_stats">';a+='  <div class="select_line">';a+='    <select id="pets_stats_select" onchange="pets.stats()">';var b=["points","breeds","food","toy","plushy","quests","parts1","parts2","parts3"];if(pets_addon==1){b.push("parts4")}for(var c=0;c<b.length;c++){var d="";if(this.stats_select==b[c]){d="selected"}a+='<option value="'+b[c]+'" '+d+">"+t_pets_stats[b[c]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_pets_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select]);a+="</div>";globalBoxFlex("",a,0,0,1)};pets.prototype.surprise=function(c){this.cardsFlipped=0;this.cardsCount=0;this.cardsFlying=c;var b='<div id="pets_surprise">';b+='<div class="intro">'+t_pets_surprise_body+"</div>";for(var d in c){for(var a in c[d]){this.cardsCount++;b+='<div id="pets_surprise_slot'+this.cardsCount+'" class="slot link slot'+this.cardsCount+'" onclick="pets.surpriseFlip('+this.cardsCount+')">';b+='  <div class="front rarity'+this.data.config.animals[d].rarity+'"></div>';b+='  <div class="back pets_parts_color'+d+" pets_part"+a+'">';b+='    <div id="pets_surprise_amount'+this.cardsCount+'" class="amount">'+c[d][a]+"</div>";b+="  </div>";b+='  <div id="pets_surprise_name'+this.cardsCount+'" class="name">'+this.data.config.animals[d].name+"</div>";b+="</div>"}}b+='  <div id="pets_surprise_commit" class="commit button_yes link" onclick="pets.parts(); pets.surpriseFly()"></div>';b+="</div>";globalBoxFlex(t_pets_surprise_head,b,0,0,1);setTimeout(function(){hideDiv("pets_surprise_confetti")},1000);hideDiv("globalbox_close")};pets.prototype.surpriseFlip=function(a){$("pets_surprise_slot"+a).addClassName("flipped");setTimeout(function(){showDiv("pets_surprise_name"+a)},400);this.cardsFlipped++;if(this.cardsFlipped>=this.cardsCount){showDiv("pets_surprise_commit")}else{hideDiv("pets_surprise_commit")}};pets.prototype.surpriseFly=function(){var d='<div id="pets_surprise_fly">';var e=1;var c=[];for(var h in this.cardsFlying){for(var b in this.cardsFlying[h]){d+='<div id="pets_surprise_fly'+e+'" class="slot slot'+e+" pets_parts_color"+h+" pets_part"+b+' idle"></div>';e++;c.push(h)}}d+="</div>";$("pets_parts").insert(d);if($("pets_surprise_fly1")){setTimeout(function(){if($("pets_surprise_fly1")){$("pets_surprise_fly1").removeClassName("idle").addClassName("fly"+pets.data.config.animals[c[0]].rarity)}},300);setTimeout(function(){if($("pets_surprise_fly1")){$("pets_surprise_fly1").remove()}},1200)}if($("pets_surprise_fly2")){setTimeout(function(){if($("pets_surprise_fly2")){$("pets_surprise_fly2").removeClassName("idle").addClassName("fly"+pets.data.config.animals[c[1]].rarity)}},100);setTimeout(function(){if($("pets_surprise_fly2")){$("pets_surprise_fly2").remove()}},1000)}if($("pets_surprise_fly3")){setTimeout(function(){if($("pets_surprise_fly3")){$("pets_surprise_fly3").removeClassName("idle").addClassName("fly"+pets.data.config.animals[c[2]].rarity)}},500);setTimeout(function(){if($("pets_surprise_fly3")){$("pets_surprise_fly3").remove()}},1400)}setTimeout(function(){this.cardsFlying={}},1300)};pets.prototype.toolsSort=function(){var b={};for(var a in this.data.config.tools){this.data.config.tools[a].id=a;if(!b[this.data.config.tools[a].breedlevel]){b[this.data.config.tools[a].breedlevel]=[]}b[this.data.config.tools[a].breedlevel].push(this.data.config.tools[a])}return b};pets.prototype.helpNavi=function(a){hideDiv("pets_help_page1");hideDiv("pets_help_page2");showDiv("pets_help_page"+a);$("farmersmarket_howto_inner_pets_navi1").removeClassName("active");$("farmersmarket_howto_inner_pets_navi2").removeClassName("active");$("farmersmarket_howto_inner_pets_navi"+a).addClassName("active")};pets.prototype.reward=function(b,q){if(!b){b=this.data.breed.reward}if(!q){this.calcHappiness();b.parts={};var l=0;for(var m in this.data.config.diamant_parts){if(Math.ceil((this.data.breed.happiness*100)/this.data.config.max_happiness)>=m){l=this.data.config.diamant_parts[m]}}if(l>0){for(var d=1;d<=l;d++){b.parts[d]={1:1}}}}var h='<div id="pets_reward">';h+="  <div>"+t_pets_reward_list+"</div>";h+='  <div class="list">';if(b){for(var d in b){var e=b[d];var r="";if(q&&in_array(d,["money","points"])){var c=Math.ceil(e*b.happiness_multi);if(d=="money"){r='<div class="add">'+t_pets_fav_bonus+":&nbsp;"+formatPrice(c-e)+"</div>"}if(d=="points"){r='<div class="add">'+t_pets_fav_bonus+":&nbsp;"+formatNumber(c-e)+"</div>"}e=c}if(d=="breedpoints"){h+='<div class="breedpoints_icon left"></div><div class="left2">'+formatNumber(e)+"&nbsp;"+t_pets_points+"</div><br>"}if(d=="money"){h+='<div class="megafield_money_icon left"></div><div class="left2">'+formatPrice(e)+"&nbsp;"+r+"</div><br>"}if(d=="points"){h+='<div class="megafield_points_icon left"></div><div class="left2">'+formatNumber(e)+"&nbsp;"+t_points+"&nbsp;"+r+"</div><br>"}if(d=="parts"){var r="";if(!q){r="front";h+="<div>"+t_pets_reward_happiness_diamond_parts+"</div>"}h+='<div class="parts_line '+r+'">';for(var a in b[d]){for(var n in b[d][a]){var r="pets_parts_color"+a+" pets_part"+n;if(!q){r="front"}h+='<div class="parts '+r+'">';if(q){h+='<div class="name">'+this.data.config.animals[a].name+"</div>"}h+="</div>"}}h+='  <div class="clear"></div>';h+="</div>"}}}h+="  </div>";if(!q){h+='<div class="bonusinfo">'+t_pets_reward_info+"</div>"}h+="</div>";globalBox(t_vet_reward_head,h)};pets.prototype.teaser=function(){var a='<div id="pets_teaser">';a+='  <div class="intro">'+t_pets_teaser_intro+"</div>";a+='  <div class="block">';a+='    <div class="head">'+t_pets_teaser_intro1+"</div>";a+="    <div>"+t_pets_teaser_list1_1+"</div>";a+="    <ul>";a+="    <li>"+t_pets_teaser_list1_2+"</li>";a+="    <li>"+t_pets_teaser_list1_3+"</li>";a+="    <li>"+t_pets_teaser_list1_4+"</li>";a+="    </ul>";a+='    <div class="bottle"></div>';a+="  </div>";a+='  <div class="block">';a+='    <div class="head">'+t_pets_teaser_intro2+"</div>";a+="    <div>"+t_pets_teaser_list2_1+"</div>";a+="    <div>"+t_pets_teaser_list2_2+"</div>";a+="    <ul>";a+="    <li>"+t_pets_teaser_list2_3+"</li>";a+="    <li>"+t_pets_teaser_list2_4+"</li>";a+="    </ul>";a+='    <div class="parts"></div>';a+="  </div>";a+='  <div class="clear"></div>';a+='  <div class="hedgehog"></div>';a+='  <div class="commit link coinsbutton_flex coinsbutton_flex_link" onclick="pets.parts()">'+t_pets_teaser_commit+"</div>";a+="</div>";globalBoxFlex(t_pets_teaser_head,a,0,0,1);hideDiv("globalbox_close");$("globalbox").style.top="50px"};pets.prototype.move=function(){if(this.page==1){if(this.data.data.pets_queue_active&&this.data.data.queue_remain<0&&!this.data.data.pharmacist_remember_box){this.buyPharmacistCommit(1);this.data.data.pharmacist_remember_box=1}this.page=2;$("pets_mover").removeClassName("right").addClassName("left")}else{this.page=1;$("pets_mover").removeClassName("left").addClassName("right")}$("pets").className="move"+this.page};pets.prototype.close=function(){hideDiv("transp");hideDiv("farmersmarket_pos4_inner")};var premiumdiscount=function(){this.data={};this.selectBoxValue=0};premiumdiscount.prototype.init=function(){var b=Math.round(this.data.config.discount*100)+"%";var e=texteffect.set(b,"wave");var c=t_premium_discount_discount.replace("<b>",'<span class="mark-1">').replace("</b>","</span>").replace("%PERCENT%",e);var d=t_premium_discount_desc.replace("%DISCOUNT%",'<div class="mark flex-center-all">'+c+"</div>").replace("<b>",'<span class="mark">').replace("</b>","</span>");var a="";a+='<div class="head">'+t_premium_discount_name+"</div>";a+='<div class="char" onclick="premiumdiscount.gotoPremium()">';a+='  <div class="bubble flex-center-all">';a+="    <div>";a+='      <div class="info" onmouseover="showDiv(\'premiumdiscount_info_tt\')" onmouseout="hideDiv(\'premiumdiscount_info_tt\')">';a+='        <div id="premiumdiscount_info_tt" class="coins_box_premium_info right">';a+="          <div>"+t_payment_premium_info2+"<ul>"+t_payment_premiumlist_info+"</ul></div>";a+="        </div>";a+="      </div>";a+="      <div>"+d+"</div>";a+='      <div class="button-coins buttoneffect-shine link">'+t_premium_discount_button+"</div>";a+="    </div>";a+="  </div>";a+="</div>";a+='<div id="premiumdiscount_timer" class="timer"></div>';a+='<div class="mini_close link" onclick="premiumdiscount.close()"></div>';$("premiumdiscount_main").innerHTML=a;$("premiumdiscount").style.display="flex";$("premiumdiscount_main").addClassName("bounce")};premiumdiscount.prototype.gotoPremium=function(){this.close();show_page("coins")};premiumdiscount.prototype.updateCoinsBox=function(){if(!$("coins_box_premium")||$("premiumdiscount_selectbox")){return 1}var a='<div id="premiumdiscount_selectbox" style="position:relative;"></div>';$("coins_box_premium").insert(a);this.buildSelectBox()};premiumdiscount.prototype.buildSelectBox=function(){var b="";b+='<div class="selectbox">';b+='  <div class="line first link" onclick="premiumdiscount.toogledSelectBox()">';b+=this.buildSelectBoxLine(this.selectBoxValue);b+='    <div id="premiumdiscount_selectbox_selector" class="selector down"></div>';b+="  </div>";b+='  <div id="premiumdiscount_selectbox_list" class="list">';b+='    <div class="line link" onclick="premiumdiscount.clickSelectBox(0)">---</div>';for(var a in premiummonth){var e=t_month_plural;if(a==1){e=t_month_singular}var l=Math.round(a*premiummonth[a][0]);var d=Math.round(l*(1-this.data.config.discount));b+='<div class="line link" onclick="premiumdiscount.clickSelectBox('+a+')">'+this.buildSelectBoxLine(a)+"</div>"}b+="  </div>";b+="</div>";b+='<div id="premiumdiscount_selectbox_button" class="link coinsbutton_flex" onclick="premiumdiscount.selectBoxCommit()">'+t_coins_buy_premium_button+"</div>";var c=Math.round(this.data.config.discount*100)+"%";var h=texteffect.set(c,"wave");b+='<div id="premiumdiscount_selectbox_discount_marker" class="marker">';b+='  <div class="bubble">';b+='    <div class="bonus_star"></div>';b+='    <div style="z-index:1;">'+t_premium_discount_discount.replace("<b>",'<div class="mark">').replace("</b>","</div>").replace("%PERCENT%",h)+"</div>";b+="  </div>";b+="</div>";$("premiumdiscount_selectbox").innerHTML=b;hideDiv("premiumdiscount_selectbox_button");if(this.selectBoxValue>0){showDiv("premiumdiscount_selectbox_button")}};premiumdiscount.prototype.buildSelectBoxLine=function(a){if(!a){return"<div>---</div>"}var d=t_month_plural;if(a==1){d=t_month_singular}var e=Math.round(a*premiummonth[a][0]);var c=Math.round(e*(1-this.data.config.discount));var b="<div>"+a+"&nbsp;"+d+"&nbsp;=&nbsp;<s>"+e+'</s>&nbsp;<span class="discount">'+c+"</span>&nbsp;"+t_coins+"</div>";return b};premiumdiscount.prototype.clickSelectBox=function(a){this.selectBoxValue=a;this.buildSelectBox()};premiumdiscount.prototype.toogledSelectBox=function(){if($("premiumdiscount_selectbox_list").style.display=="block"){$("premiumdiscount_selectbox_selector").removeClassName("up").addClassName("down");hideDiv("premiumdiscount_selectbox_list")}else{$("premiumdiscount_selectbox_selector").removeClassName("down").addClassName("up");showDiv("premiumdiscount_selectbox_list")}};premiumdiscount.prototype.selectBoxCommit=function(){coinsBoxDialog("premium",1)};premiumdiscount.prototype.timer=function(){this.data.data.remain--;if(this.data.data.remain>0){this.updateCoinsBox();hideDiv("coins_premium_months");if($("premiumdiscount_timer")){$("premiumdiscount_timer").innerHTML=t_premium_discount_timer.replace("%TIME%",'<span class="mark-2">'+formatTime(this.data.data.remain)+"</span>")}}else{if($("premiumdiscount_selectbox")){$("premiumdiscount_selectbox").remove()}this.close();showDiv("coins_premium_months")}};premiumdiscount.prototype.close=function(){hideDiv("premiumdiscount")};var texteffect=function(){};texteffect.prototype.set=function(d,c){var b='<span class="texteffect-'+c+'">';for(var a=0;a<d.length;a++){b+='<span style="--texteffect-'+c+":"+(parseInt(a)+1)+'">'+d[a]+"</span>"}b+="</span>";return b};var texteffect=new texteffect();var production=function(){this.data={}};production.prototype.buildSlot=function(c,d){var b="";b+='<div id="'+c+"_productionslot"+d+'" class="slot">';b+='  <div id="'+c+"_productionslot"+d+'_img" class="img"></div>';b+='  <div id="'+c+"_productionslot"+d+'_info" class="info"></div>';b+='  <div id="'+c+"_productionslot"+d+'_block" class="block"></div>';b+='  <div id="'+c+"_productionslot"+d+'_click" class="click link"></div>';b+='  <div id="'+c+"_productionslot"+d+'_speedup" class="link production_slot_speedup" onclick="globalSpeedupBox(\''+c+"_production_slot_speedup', 1, "+d+');"></div>';b+='  <div id="'+c+"_pharmacist_slots"+d+'" class="'+c+'_pharmacist_slots">';for(var a=1;a<=3;a++){b+='<div id="'+c+"_pharmacist_slot"+d+"_"+a+'" class="link '+c+'_pharmacist_slot" onmouseover="showDiv(\''+c+"_pharmacist_slot_tt"+d+"_"+a+"')\" onmouseout=\"hideDiv('"+c+"_pharmacist_slot_tt"+d+"_"+a+"')\">";b+='  <div id="'+c+"_pharmacist_slot_img"+d+"_"+a+'" class="'+c+'_pharmacist_slot_img"></div>';b+='  <div id="'+c+"_pharmacist_slot_status"+d+"_"+a+'" class="'+c+'_pharmacist_slot_status"></div>';b+='  <div id="'+c+"_pharmacist_slot_tt"+d+"_"+a+'" class="ttbox '+c+'_pharmacist_slot_tt"></div>';b+="</div>"}b+="</div>";b+='  <div id="'+c+"_productionslot"+d+'_rent_timer" class="rent_timer"></div>';b+="</div>";return b};production.prototype.updateSlot=function(n,r,h,d){var s=d.production;var l=d.data.slots;var b=0;if(d.data.queue_remain){b=d.data.queue_remain}if($(n+"_productionslot"+r)){var u=n+".productionSelection("+r+")";var a=t_start_production;if(s[r]&&s[r][h]){var e=parseInt(s[r][h].amount);var t="";var q="";if(specialbonus){var m=specialbonus.findBonus({key1:n,key2:"harvest"});if(m){e+=m.harvest;t='<div class="specialbonus">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+m.harvest)+")</div>";q="specialbonus"}}a='<div class="name '+q+'">'+formatNumber(e)+"x&nbsp;"+produkt_name[s[r][h].pid]+"</div>";$(n+"_productionslot"+r+"_img").addClassName(n+"_item"+s[r][h].pid);if(s[r][h].remain>0){a+=formatTime(s[r][h].remain);showDiv(n+"_productionslot"+r+"_cancel");showDiv(n+"_productionslot"+r+"_speedup");u="";if(b>0){for(var c=1;c<=3;c++){if(!s[r][c]){u=n+".productionSelection("+r+")";break}}}}else{a+='<div class="ready">'+click4products+"</div>";u=n+".harvestProduction("+r+", "+h+")";hideDiv(n+"_productionslot"+r+"_speedup")}if(t!=""){a+=t}}hideDiv(n+"_productionslot"+r+"_block");if(l[r]&&l[r].block){var q="";var t="";if(l[r].coins){var v=l[r].coins;if(specialbonus){var m=specialbonus.findBonus({key1:n,key2:"buyproductionslot"});if(m&&m.buyproductionslot){v=Math.ceil(v*(1-m.buyproductionslot));q="bonus";t=specialbonus.htmlBonusLine(m.buyproductionslot,1)}}}hideDiv(n+"_productionslot"+r+"_cancel");hideDiv(n+"_productionslot"+r+"_speedup");showDiv(n+"_productionslot"+r+"_block");u=n+".buyProductionSlotCommit("+r+")";if(l[r].rent_duration){a=str_replace("%TIME%",formatTime(l[r].rent_duration),t_rent_slot);a=str_replace("%COINS%",'<span class="'+q+'">'+v+"&nbsp;"+t_coins+"</span>",a);if(specialbonus){var m=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(m&&in_array(n,m.types)){a+='<div id="'+n+"_productionslot"+r+'_bonus_star" class="production_slot bonus_star pulse">';a+='  <div class="inner">';a+='    <div class="percent">'+(m.discount*100)+"%</div>";a+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";a+="  </div>";a+="</div>"}}}else{if(l[r].money){a=str_replace("%MONEY%",formatPrice(l[r].money),t_buy_slot)}if(l[r].coins){a=t_buy_slot.replace("%MONEY%",'<span class="'+q+'">'+v+"&nbsp;"+t_coins+"</span>")}}a='<div id="'+n+"_productionslot_info"+r+'" class="ready">'+a+t+"</div>"}$(n+"_productionslot"+r+"_info").innerHTML=a;$(n+"_productionslot"+r+"_click").onclick=new Function(u);hideDiv(n+"_productionslot"+r+"_rent_timer");if(l[r]&&l[r].rent_remain){if(l[r].rent_remain>0){showDiv(n+"_productionslot"+r+"_rent_timer");$(n+"_productionslot"+r+"_rent_timer").innerHTML=formatTime(l[r].rent_remain)}else{l[r].block=1}}}};production.prototype.buySlotCommit=function(d,h,a){var n="";var l="";if(a.coins){var q=a.coins;if(specialbonus){var c=specialbonus.findBonus({key1:d,key2:"buyproductionslot"});if(c&&c.buyproductionslot){q=Math.ceil(q*(1-c.buyproductionslot));l="bonus";n=specialbonus.htmlBonusLine(c.buyproductionslot)}}}var e=click4buyslot;if(a.rent_duration){e=click4rentslot}var b="";if(a.rent_duration){info=str_replace("%TIME%",formatTime(a.rent_duration),t_rent_slot);info=str_replace("%COINS%",'<span class="cost '+l+'">'+q+"&nbsp;"+t_coins+"</span>",info)}else{if(a.money){info=str_replace("%MONEY%",formatPrice(a.money),t_buy_slot)}if(a.coins){info=str_replace("%MONEY%",'<span class="cost '+l+'">'+q+"&nbsp;"+t_coins+"</span>",t_buy_slot)}}b='<div id="production_commit" class="ready" style="width:300px;">'+info+n+"</div>";var m=d+".buyProductionSlot("+h+")";globalcommitbox(e,b,m);if($(d+"_productionslot"+h+"_bonus_star")){$(d+"_productionslot"+h+"_bonus_star").remove()}};production.prototype.buyQueueCommit=function(d,c){var a={};a.pets={head:t_pharmacist_pets_buy_head,head_remember:t_pharmacist_pets_buy_head2,body:t_pharmacist_pets_buy_body,info:t_pharmacist_pets_info,duration:pets.data.config.queue_duration,cost:pets.data.config.queue_coins};if(cowracing&&cowracing.data&&cowracing.data.config){a.cowracing={head:t_pharmacist_cowracing_buy_head,head_remember:t_pharmacist_cowracing_buy_head2,body:t_pharmacist_cowracing_buy_body,info:t_pharmacist_cowracing_info,duration:cowracing.data.config.queue_duration,cost:cowracing.data.config.queue_coins}}if(fishing&&fishing.data&&fishing.data.config){a.fishing={head:t_fishing_pharmacist_buy_head,head_remember:t_fishing_pharmacist_buy_head2,body:t_fishing_pharmacist_buy_body,info:t_fishing_pharmacist_info,duration:fishing.data.config.constants.queue_duration,cost:fishing.data.config.constants.queue_coins}}if(sushibar&&sushibar.data&&sushibar.data.config){a.sushibar={head:t_sushibar_pharmacist_buy_head,head_remember:t_sushibar_pharmacist_buy_head2,body:t_sushibar_pharmacist_buy_body,info:t_sushibar_pharmacist_info,duration:sushibar.data.config.constants.queue_duration,cost:sushibar.data.config.constants.queue_coins}}if(scouts&&scouts.data&&scouts.data.config){a.scouts={head:t_scouts_pharmacist_buy_head,head_remember:t_scouts_pharmacist_buy_head2,body:t_scouts_pharmacist_buy_body,info:t_scouts_pharmacist_info,duration:scouts.data.config.constants.queue_duration,cost:scouts.data.config.constants.queue_coins}}if(!a[d]){return 1}var m="";var e=0;if(specialbonus){e=specialbonus.findBonus({key1:d,key2:"pharmacist"})}var q=a[d].cost;if(e&&e.pharmacist){q=Math.ceil(q*(1-e.pharmacist));m="bonus"}var l=a[d].head;if(c==1){l=a[d].head_remember}var b='<div id="production_queue_commit">';b+='  <div style="margin-bottom:10px;">'+a[d].info+"</div>";b+='  <div class="cost">'+a[d].body.replace("%TIME%",formatTime(a[d].duration)).replace("%COINS%",'<span class="'+m+'">'+q+"</span>")+"</div>";if(e&&e.pharmacist){b+='<div class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(e.pharmacist*100))+")</div>"}b+="</div>";var n=d+".buyPharmacist()";var h=0;if(c==1){h=d+".rememberPharmacist(); hideDiv('globaltransp'); hideDiv('globalbox')"}globalcommitbox(l,b,n,h)};production.prototype.currentQueueSlot=function(d,h){var e=0;if(d=="pets"){e=pets.data.production}if(d=="cowracing"){e=cowracing.data.production}if(d=="fishing"&&fishing&&fishing.data){e=fishing.data.production}if(d=="sushibar"&&sushibar&&sushibar.data){e=sushibar.data.production}if(d=="scouts"&&scouts&&scouts.data){e=scouts.data.production}var b=0;if(e&&e[h]){if(e[h]["gone"]>=e[h]["duration"]){for(var a=1;a<=3;a++){if(e[h][a]){b=a}}}else{var c=0;for(var a=1;a<=3;a++){if(e[h][a]){c+=parseInt(e[h][a].duration);if(c>e[h]["gone"]){b=a;break}}}}}return b};production.prototype.updateQueue=function(q){if(q=="fishing"&&fishing&&fishing.data){var e=fishing.data}if(q=="sushibar"&&sushibar&&sushibar.data){var e=sushibar.data}if(q=="scouts"&&scouts&&scouts.data){var e=scouts.data}var s={};s.fishing={block:t_fishing_pharmacist_free_slot_block};s.sushibar={block:t_sushibar_pharmacist_free_slot_block};s.scouts={block:t_scouts_pharmacist_free_slot_block};if(e.data&&$(q+"_pharmacist")){showDiv(q+"_pharmacist");var a=q+".buyPharmacistCommit()";if(e.data.queue&&e.data.queue_remain>0){$(q+"_pharmacist_timer").innerHTML=formatTime(e.data.queue_remain);showDiv(q+"_pharmacist_timer");a=""}else{hideDiv(q+"_pharmacist_timer")}var n=0;if(e.data.queue){for(d=1;d<=4;d++){var l=0;var h=0;for(c=1;c<=3;c++){if(e.production[d]&&e.production[d][c]){h++}}if(e.data.queue_remain<=0&&(!h||h<=1)){hideDiv(q+"_pharmacist_slots"+d)}else{n++;showDiv(q+"_pharmacist_slots"+d)}for(var c=1;c<=3;c++){if(e.production[d]&&e.production[d][c]){var r=this.currentQueueSlot(q,d);l+=parseInt(e.production[d][c].duration);var b="harvest";var t=q+".harvestProduction("+d+", "+c+")";if(e.production[d]["gone"]<l){b="next";var t=""}if(r==c&&e.production[d]["gone"]<l){b="running";var t=""}$(q+"_pharmacist_slot_img"+d+"_"+c).className=q+"_pharmacist_slot_img tt"+e.production[d][c].pid;$(q+"_pharmacist_slot_status"+d+"_"+c).className=q+"_pharmacist_slot_status "+b;var m=produkt_name[e.production[d][c].pid]}else{if(e.data.queue_remain>0){var t=q+".productionSelection("+d+")";var m=t_pharmacist_free_slot}else{var t="";var m=s[q].block}}$(q+"_pharmacist_slot_tt"+d+"_"+c).innerHTML=m;$(q+"_pharmacist_slot"+d+"_"+c).onclick=new Function(t)}}}if(n>0){$(q+"_slots").className=q+"_production_slots_spacer";for(var d=1;d<=4;d++){$(q+"_productionslot"+d).className="slot "+q+"_production_slot_spacer"}}else{$(q+"_slots").className=q+"_production_slots_normal"}$(q+"_pharmacist").onclick=new Function(a)}};production.prototype.buildOuterProductionLine=function(n){var b={};if(vet_data){b.vet={data:vet_data,marketpos:5,farmchecker:99}}if(pets&&pets.data){b.pets={data:pets.data,marketpos:4,farmchecker:99,noprogress:1}}if(cowracing&&cowracing.data){b.cowracing={data:cowracing.data,marketpos:8,farmchecker:100}}if(fishing&&fishing.data){b.fishing={data:fishing.data,marketpos:9,farmchecker:100}}if(scouts&&scouts.data){b.scouts={data:scouts.data,marketpos:11,farmchecker:100}}if(sushibar&&sushibar.data){b.sushibar={data:sushibar.data}}if(!b[n]){return 1}if(b[n].marketpos){var a="farmersmarket_pos"+b[n].marketpos;var s=a}else{if(!b[n].data.data){return 1}var a="farm_production_display"+b[n].data.data.farm+"_"+b[n].data.data.position;var s="farm_production_display"+b[n].data.data.buildingid;b[n].farmchecker=b[n].data.data.farm;b[n].marketpos=b[n].data.data.position}var t=0;var c=-1;if(b[n].data.production){for(var r in b[n].data.production){var l=1;if(!b[n].data.production[r][l]){continue}if(c==-1||b[n].data.production[r][l].remain<c){c=b[n].data.production[r][l].remain;t={pid:b[n].data.production[r][l].pid,slot:r,position:l}}}}if(t&&t.pid){if(!$(a+"_timer")){var q="";if(xmastime){q="xmas"}var h='<div id="'+a+'_timer" class="farm_production_timer '+q+'"></div>';h+='<div id="'+a+'_progress" class="farm_production_display'+b[n].data.data.buildingid+'_progress"></div>';$("farm"+b[n].data.data.farm+"_pos"+b[n].data.data.position).insert(h)}if(!b[n].noprogress){showDiv(a+"_progress")}$(a+"_progress").removeClassName(s+"_progress_ready").addClassName(s+"_progress_active");var m='<div class="kp'+t.pid+'" style="float:left; margin-right:5px;"></div>';if(b[n].data.production[t.slot][t.position].remain>0){m+='<div style="float:left;">'+formatTime(b[n].data.production[t.slot][t.position].remain)+"</div>"}else{m+=statusProductionComplete;$(a+"_progress").removeClassName(s+"_progress_active").addClassName(s+"_progress_ready");found2=0;for(var e=0;e<farm_checker.length;e++){if(farm_checker[e].farm==b[n].farmchecker&&farm_checker[e].position==b[n].marketpos){found2++}}if(!found2){var d={pid:t.pid,farm:b[n].farmchecker,position:b[n].marketpos};farm_checker.push(d)}}$(a+"_timer").innerHTML=m+'<div class="clear"></div>'}else{if($(a+"_timer")){$(a+"_timer").innerHTML=""}hideDiv(a+"_progress")}};function profilAction(c,h,e){var a="ajax/profil.php?";var d="";if(!h){h={}}h.action=c;h.rid=rid;if(h){for(var b in h){d+="&"+b+"="+encodeURIComponent(h[b])}}d=d.substring(1,d.length);if(c!="init"){$("profil_save_info").style.display="block"}showGlobalWait(c);var l=createAjaxRequestObj();l.open("GET",a+d,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.onreadystatechange=function(){profilActionResponse(l,c,e)};l.send(null)}function profilActionResponse(c,d,e){if(d!="init"){$("profil_save_info").fade({duration:2,from:0.7,to:0,afterFinish:function(h){}})}var a=_chkRequest(c,mode);if(a!=0){hideGlobalWait();if(a[0]==0){var b="hideDiv('globalbox'); hideDiv('globaltransp'); profilUpdate();";globalerrorbox(a[1],b)}else{hideDiv("globalbox");hideDiv("globaltransp");if(a.player){profil_data=a.player}if(d=="init"){profilInit()}if(d=="save"){profilUpdate()}if(d=="reset"||d=="delete"){location.href="main.php"}if(e==1){profilCanvassInit()}}}}var profil_data={};var profil_valid=["uname","email","pass","pass2"];var profil_valid_chkbx=["animation","plantinfo","farmslide","animalghosts","touch_detection","pan_privacy","main_flyer","disable_autologout"];function profilInit(){profilUpdate();showDiv("profil_main_transp");showDiv("profil_main");showDiv("profil_settings");hideDiv("profil_canvass_main")}function profilUpdate(){$("profil_name").innerHTML=profil_data.name;$("profil_id").innerHTML=profil_data.unr;$("profil_register").innerHTML=profil_data.registerdate;$("profil_uname").value=profil_data.uname;if($("profil_email")){$("profil_email").value=profil_data.email}if(profil_data.animation=="1"){$("profil_animation").checked=true}else{$("profil_animation").checked=false}if(profil_data.gardeninfo=="1"){$("profil_plantinfo").checked=true}else{$("profil_plantinfo").checked=false}if(profil_data.tokens.NO_FARMSLIDE=="1"){$("profil_farmslide").checked=true}else{$("profil_farmslide").checked=false}if(profil_data.tokens.ANIMALGHOSTS=="1"){$("profil_animalghosts").checked=true}else{$("profil_animalghosts").checked=false}if(profil_data.tokens.DISABLE_AUTOLOGOUT=="1"){$("profil_disable_autologout").checked=true}else{$("profil_disable_autologout").checked=false}if(profil_data.tokens.AUTOTOUCH=="1"){$("profil_touch_detection").checked=true}else{$("profil_touch_detection").checked=false}if(profil_data.tokens.MAIN_FLYER=="1"){$("profil_main_flyer").checked=true}else{$("profil_main_flyer").checked=false}if(profil_data.tokens.PAN_PRIVACY=="1"){$("profil_pan_privacy").checked=true}else{$("profil_pan_privacy").checked=false}for(var b=0;b<profil_valid.length;b++){if(profil_valid[b]!="email"){hideDiv("profil_save_"+profil_valid[b])}}if($("profil_canvass")){if(profil_data.confirmed=="1"){showDiv("profil_canvass")}else{hideDiv("profil_canvass")}}if(profil_data.confirmed!="1"){var a=profil_data.email;if(profil_data.tempmail!=""){a=profil_data.tempmail}if(profil_data.email.indexOf(const_emailoff)>-1){$add=""}else{a="<br>"+str_replace("%EMAIL%",'<span style="font-weight:bold;">'+a+"</span>",t_emailconfirm_thismail)}$("profil_email_confirm").innerHTML=a;showDiv("profil_email_unconfirmed")}else{hideDiv("profil_email_unconfirmed")}if(profil_data.pkt>20000){hideDiv("profil_reset")}}function profilSendConfirmationMail(){profilAction("send")}function profilCheck(b){for(var a=0;a<profil_valid.length;a++){if(profil_valid[a]!="email"){hideDiv("profil_save_"+profil_valid[a])}}if($("profil_"+b)){if(b=="pass"){if($("profil_pass").value!=""&&$("profil_pass2").value!=""){if($("profil_pass").value==$("profil_pass2").value){showDiv("profil_save_"+b)}}}else{if($("profil_"+b).value!=""&&$("profil_"+b).value!=profil_data[b]){showDiv("profil_save_"+b)}}}}function profilSave(d){if(isSteam()==1){profilFire(d);return 1}var c="";var a=t_password_info;a+='<br><br><input type="password" id="profil_secure">';var e="profilFire('"+d+"')";var b="hideDiv('globalbox'); hideDiv('globaltransp'); profilUpdate();";globalBox(c,a,e,b)}function profilFire(b){var c="";if($("profil_secure")){c=$("profil_secure").value}if(isSteam()==1){c="steam"}if(c!=""){if(b=="delete"||b=="reset"){var d={secure:c};profilAction(b,d)}else{if(in_array(b,profil_valid)){var d={secure:c,key:b,value:encodeURIComponent($("profil_"+b).value)};profilAction("save",d)}else{if(in_array(b,profil_valid_chkbx)){var a=0;if($("profil_"+b).checked==true){a=1}d={secure:c,key:b,value:a};profilAction("save",d)}}}}}function profilClose(){hideDiv("profil_main_transp");hideDiv("profil_main")}function profilCanvassInit(){showDiv("profil_main_transp");showDiv("profil_main");hideDiv("profil_settings");showDiv("profil_canvass_main");hideDiv("profil_canvass_error");$("profil_canvass_email").value="";$("profil_canvass_message").value="";$("profil_canvass_letters").innerHTML=str_replace("%LETTERS%",parseInt(canvassletters),marktschreierletters)}function profilCanvassLetters(){var a=$("profil_canvass_message").value;if(a.length>canvassletters){a=a.substring(0,canvassletters);$("profil_canvass_message").value=a}$("profil_canvass_letters").innerHTML=str_replace("%LETTERS%",(parseInt(canvassletters)-parseInt(a.length)),marktschreierletters)}function profilCanvassSend(){var a=$("profil_canvass_email").value;var b=$("profil_canvass_message").value;if(a!=""&&b!=""){params={mail:encodeURIComponent(a),msg:encodeURIComponent(b)};generalAction("sendcanvass",params)}}function profilCanvassSendResponse(){profilCanvassInit();showDiv("profil_canvass_error");$("profil_canvass_error").innerHTML=profilcanvasssend}var Prototype={Version:"1.7_rc3",Browser:(function(){var b=navigator.userAgent;var a=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!a,Opera:a,WebKit:b.indexOf("AppleWebKit/")>-1,Gecko:b.indexOf("Gecko")>-1&&b.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(b)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var a=window.Element||window.HTMLElement;return !!(a&&a.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=="undefined"){return true}var c=document.createElement("div"),b=document.createElement("form"),a=false;if(c.__proto__&&(c.__proto__!==b.__proto__)){a=true}c=b=null;return a})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Abstract={};var Try={these:function(){var c;for(var b=0,d=arguments.length;b<d;b++){var a=arguments[b];try{c=a();break}catch(h){}}return c}};var Class=(function(){var d=(function(){for(var e in {toString:1}){if(e==="toString"){return false}}return true})();function a(){}function b(){var m=null,l=$A(arguments);if(Object.isFunction(l[0])){m=l.shift()}function e(){this.initialize.apply(this,arguments)}Object.extend(e,Class.Methods);e.superclass=m;e.subclasses=[];if(m){a.prototype=m.prototype;e.prototype=new a;m.subclasses.push(e)}for(var h=0,n=l.length;h<n;h++){e.addMethods(l[h])}if(!e.prototype.initialize){e.prototype.initialize=Prototype.emptyFunction}e.prototype.constructor=e;return e}function c(r){var l=this.superclass&&this.superclass.prototype,h=Object.keys(r);if(d){if(r.toString!=Object.prototype.toString){h.push("toString")}if(r.valueOf!=Object.prototype.valueOf){h.push("valueOf")}}for(var e=0,m=h.length;e<m;e++){var q=h[e],n=r[q];if(l&&Object.isFunction(n)&&n.argumentNames()[0]=="$super"){var s=n;n=(function(t){return function(){return l[t].apply(this,arguments)}})(q).wrap(s);n.valueOf=s.valueOf.bind(s);n.toString=s.toString.bind(s)}this.prototype[q]=n}return this}return{create:b,Methods:{addMethods:c}}})();(function(){var J=Object.prototype.toString,I="Null",v="Undefined",D="Boolean",h="Number",B="String",N="Object",F="[object Boolean]",l="[object Number]",s="[object String]",m="[object Array]",n=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";function r(P){switch(P){case null:return I;case (void 0):return v}var O=typeof P;switch(O){case"boolean":return D;case"number":return h;case"string":return B}return N}function G(O,Q){for(var P in Q){O[P]=Q[P]}return O}function L(O){try{if(c(O)){return"undefined"}if(O===null){return"null"}return O.inspect?O.inspect():String(O)}catch(P){if(P instanceof RangeError){return"..."}throw P}}function K(O){return M("",{"":O},[])}function M(X,U,V){var W=U[X],T=typeof W;if(r(W)===N&&typeof W.toJSON==="function"){W=W.toJSON(X)}var Q=J.call(W);switch(Q){case l:case F:case s:W=W.valueOf()}switch(W){case null:return"null";case true:return"true";case false:return"false"}T=typeof W;switch(T){case"string":return W.inspect(true);case"number":return isFinite(W)?String(W):"null";case"object":for(var P=0,O=V.length;P<O;P++){if(V[P]===W){throw new TypeError()}}V.push(W);var S=[];if(Q===m){for(var P=0,O=W.length;P<O;P++){var R=M(P,W,V);S.push(typeof R==="undefined"?"null":R)}S="["+S.join(",")+"]"}else{var Y=Object.keys(W);for(var P=0,O=Y.length;P<O;P++){var X=Y[P],R=M(X,W,V);if(typeof R!=="undefined"){S.push(X.inspect(true)+":"+R)}}S="{"+S.join(",")+"}"}V.pop();return S}}function E(O){return JSON.stringify(O)}function q(O){return $H(O).toQueryString()}function w(O){return O&&O.toHTML?O.toHTML():String.interpret(O)}function A(O){if(r(O)!==N){throw new TypeError()}var P=[];for(var Q in O){if(O.hasOwnProperty(Q)){P.push(Q)}}return P}function d(O){var P=[];for(var Q in O){P.push(O[Q])}return P}function H(O){return G({},O)}function C(O){return !!(O&&O.nodeType==1)}function t(O){return J.call(O)===m}var b=(typeof Array.isArray=="function")&&Array.isArray([])&&!Array.isArray({});if(b){t=Array.isArray}function e(O){return O instanceof Hash}function a(O){return typeof O==="function"}function u(O){return J.call(O)===s}function z(O){return J.call(O)===l}function c(O){return typeof O==="undefined"}G(Object,{extend:G,inspect:L,toJSON:n?E:K,toQueryString:q,toHTML:w,keys:Object.keys||A,values:d,clone:H,isElement:C,isArray:t,isHash:e,isFunction:a,isString:u,isNumber:z,isUndefined:c})})();Object.extend(Function.prototype,(function(){var r=Array.prototype.slice;function d(v,s){var u=v.length,t=s.length;while(t--){v[u+t]=s[t]}return v}function n(t,s){t=r.call(t,0);return d(t,s)}function l(){var s=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return s.length==1&&!s[0]?[]:s}function m(u){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var s=this,t=r.call(arguments,1);return function(){var v=n(t,arguments);return s.apply(u,v)}}function h(u){var s=this,t=r.call(arguments,1);return function(w){var v=d([w||window.event],t);return s.apply(u,v)}}function q(){if(!arguments.length){return this}var s=this,t=r.call(arguments,0);return function(){var u=n(t,arguments);return s.apply(this,u)}}function e(u){var s=this,t=r.call(arguments,1);u=u*1000;return window.setTimeout(function(){return s.apply(s,t)},u)}function a(){var s=d([0.01],arguments);return this.delay.apply(this,s)}function c(t){var s=this;return function(){var u=d([s.bind(this)],arguments);return t.apply(this,u)}}function b(){if(this._methodized){return this._methodized}var s=this;return this._methodized=function(){var t=d([this],arguments);return s.apply(null,t)}}return{argumentNames:l,bind:m,bindAsEventListener:h,curry:q,delay:e,defer:a,wrap:c,methodize:b}})());(function(c){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function a(){return this.toISOString()}if(!c.toISOString){c.toISOString=b}if(!c.toJSON){c.toJSON=a}})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(b,a){this.callback=b;this.frequency=a;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=false;throw a}}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(replacement){if(Object.isFunction(replacement)){return replacement}var template=new Template(replacement);return function(match){return template.evaluate(match)}}function gsub(pattern,replacement){var result="",source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern)){pattern=RegExp.escape(pattern)}if(!(pattern.length||pattern.source)){replacement=replacement("");return replacement+source.split("").join(replacement)+replacement}while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result}function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})}function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this)}function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img"),matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character]}return"\\u00"+character.charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"}function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,"$1")}function isJSON(){var str=this;if(str.blank()){return false}str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(str)}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.test(json)){json=json.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json)}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern){return this.lastIndexOf(pattern,0)===0}function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.indexOf(pattern,d)===d}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}})());var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements)){a=a.toTemplateReplacements()}return this.template.gsub(this.pattern,function(d){if(a==null){return(d[1]+"")}var h=d[1]||"";if(h=="\\"){return d[2]}var b=a,l=d[3],e=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;d=e.exec(l);if(d==null){return h}while(d!=null){var c=d[1].startsWith("[")?d[2].replace(/\\\\]/g,"]"):d[1];b=b[c];if(null==b||""==d[3]){break}l=l.substring("["==d[3]?d[1].length:d[0].length);d=e.exec(l)}return h+String.interpret(b)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function c(H,G){var F=0;try{this._each(function(J){H.call(G,J,F++)})}catch(I){if(I!=$break){throw I}}return this}function A(I,H,G){var F=-I,J=[],K=this.toArray();if(I<1){return K}while((F+=I)<K.length){J.push(K.slice(F,F+I))}return J.collect(H,G)}function b(H,G){H=H||Prototype.K;var F=true;this.each(function(J,I){F=F&&!!H.call(G,J,I);if(!F){throw $break}});return F}function n(H,G){H=H||Prototype.K;var F=false;this.each(function(J,I){if(F=!!H.call(G,J,I)){throw $break}});return F}function q(H,G){H=H||Prototype.K;var F=[];this.each(function(J,I){F.push(H.call(G,J,I))});return F}function C(H,G){var F;this.each(function(J,I){if(H.call(G,J,I)){F=J;throw $break}});return F}function m(H,G){var F=[];this.each(function(J,I){if(H.call(G,J,I)){F.push(J)}});return F}function l(I,H,G){H=H||Prototype.K;var F=[];if(Object.isString(I)){I=new RegExp(RegExp.escape(I))}this.each(function(K,J){if(I.match(K)){F.push(H.call(G,K,J))}});return F}function a(F){if(Object.isFunction(this.indexOf)){if(this.indexOf(F)!=-1){return true}}var G=false;this.each(function(H){if(H==F){G=true;throw $break}});return G}function z(G,F){F=Object.isUndefined(F)?null:F;return this.eachSlice(G,function(H){while(H.length<G){H.push(F)}return H})}function s(F,H,G){this.each(function(J,I){F=H.call(G,F,J,I)});return F}function E(G){var F=$A(arguments).slice(1);return this.map(function(H){return H[G].apply(H,F)})}function w(H,G){H=H||Prototype.K;var F;this.each(function(J,I){J=H.call(G,J,I);if(F==null||J>=F){F=J}});return F}function u(H,G){H=H||Prototype.K;var F;this.each(function(J,I){J=H.call(G,J,I);if(F==null||J<F){F=J}});return F}function e(I,G){I=I||Prototype.K;var H=[],F=[];this.each(function(K,J){(I.call(G,K,J)?H:F).push(K)});return[H,F]}function h(G){var F=[];this.each(function(H){F.push(H[G])});return F}function d(H,G){var F=[];this.each(function(J,I){if(!H.call(G,J,I)){F.push(J)}});return F}function t(G,F){return this.map(function(I,H){return{value:I,criteria:G.call(F,I,H)}}).sort(function(K,J){var I=K.criteria,H=J.criteria;return I<H?-1:I>H?1:0}).pluck("value")}function v(){return this.map()}function B(){var G=Prototype.K,F=$A(arguments);if(Object.isFunction(F.last())){G=F.pop()}var H=[this].concat(F).map($A);return this.map(function(J,I){return G(H.pluck(I))})}function r(){return this.toArray().length}function D(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:c,eachSlice:A,all:b,every:b,any:n,some:n,collect:q,map:q,detect:C,findAll:m,select:m,filter:m,grep:l,include:a,member:a,inGroupsOf:z,inject:s,invoke:E,max:w,min:u,partition:e,pluck:h,reject:d,sortBy:t,toArray:v,entries:v,zip:B,size:r,inspect:D,find:C}})();function $A(c){if(!c){return[]}if("toArray" in Object(c)){return c.toArray()}var b=c.length||0,a=new Array(b);while(b--){a[b]=c[b]}return a}function $w(a){if(!Object.isString(a)){return[]}a=a.strip();return a?a.split(/\s+/):[]}Array.from=$A;(function(){var A=Array.prototype,t=A.slice,v=A.forEach;function b(E){for(var D=0,F=this.length;D<F;D++){E(this[D])}}if(!v){v=b}function s(){this.length=0;return this}function d(){return this[0]}function l(){return this[this.length-1]}function n(){return this.select(function(D){return D!=null})}function C(){return this.inject([],function(E,D){if(Object.isArray(D)){return E.concat(D.flatten())}E.push(D);return E})}function m(){var D=t.call(arguments,0);return this.select(function(E){return !D.include(E)})}function h(D){return(D===false?this.toArray():this)._reverse()}function r(D){return this.inject([],function(G,F,E){if(0==E||(D?G.last()!=F:!G.include(F))){G.push(F)}return G})}function w(D){return this.uniq().findAll(function(E){return D.detect(function(F){return E===F})})}function z(){return t.call(this,0)}function q(){return this.length}function B(){return"["+this.map(Object.inspect).join(", ")+"]"}function a(F,D){D||(D=0);var E=this.length;if(D<0){D=E+D}for(;D<E;D++){if(this[D]===F){return D}}return -1}function u(E,D){D=isNaN(D)?this.length:(D<0?this.length+D:D)+1;var F=this.slice(0,D).reverse().indexOf(E);return(F<0)?F:D-F-1}function c(){var I=t.call(this,0),G;for(var E=0,F=arguments.length;E<F;E++){G=arguments[E];if(Object.isArray(G)&&!("callee" in G)){for(var D=0,H=G.length;D<H;D++){I.push(G[D])}}else{I.push(G)}}return I}Object.extend(A,Enumerable);if(!A._reverse){A._reverse=A.reverse}Object.extend(A,{_each:v,clear:s,first:d,last:l,compact:n,flatten:C,without:m,reverse:h,uniq:r,intersect:w,clone:z,toArray:z,size:q,inspect:B});var e=(function(){return[].concat(arguments)[0][0]!==1})(1,2);if(e){A.concat=c}if(!A.indexOf){A.indexOf=a}if(!A.lastIndexOf){A.lastIndexOf=u}})();function $H(a){return new Hash(a)}var Hash=Class.create(Enumerable,(function(){function e(w){this._object=Object.isHash(w)?w.toObject():Object.clone(w)}function h(z){for(var w in this._object){var A=this._object[w],B=[w,A];B.key=w;B.value=A;z(B)}}function q(w,z){return this._object[w]=z}function c(w){if(this._object[w]!==Object.prototype[w]){return this._object[w]}}function t(w){var z=this._object[w];delete this._object[w];return z}function v(){return Object.clone(this._object)}function u(){return this.pluck("key")}function s(){return this.pluck("value")}function l(z){var w=this.detect(function(A){return A.value===z});return w&&w.key}function n(w){return this.clone().update(w)}function d(w){return new Hash(w).inject(this,function(z,A){z.set(A.key,A.value);return z})}function b(w,z){if(Object.isUndefined(z)){return w}return w+"="+encodeURIComponent(String.interpret(z))}function a(){return this.inject([],function(A,B){var z=encodeURIComponent(B.key),w=B.value;if(w&&typeof w=="object"){if(Object.isArray(w)){return A.concat(w.map(b.curry(z)))}}else{A.push(b(z,w))}return A}).join("&")}function r(){return"#<Hash:{"+this.map(function(w){return w.map(Object.inspect).join(": ")}).join(", ")+"}>"}function m(){return new Hash(this)}return{initialize:e,_each:h,set:q,get:c,unset:t,toObject:v,toTemplateReplacements:v,keys:u,values:s,index:l,merge:n,update:d,toQueryString:a,inspect:r,toJSON:v,clone:m}})());Hash.from=$H;Object.extend(Number.prototype,(function(){function d(){return this.toPaddedString(2,16)}function b(){return this+1}function m(q,n){$R(0,this,true).each(q,n);return this}function l(r,q){var n=this.toString(q||10);return"0".times(r-n.length)+n}function a(){return Math.abs(this)}function c(){return Math.round(this)}function e(){return Math.ceil(this)}function h(){return Math.floor(this)}return{toColorPart:d,succ:b,times:m,toPaddedString:l,abs:a,round:c,ceil:e,floor:h}})());function $R(c,a,b){return new ObjectRange(c,a,b)}var ObjectRange=Class.create(Enumerable,(function(){function b(h,d,e){this.start=h;this.end=d;this.exclusive=e}function c(d){var e=this.start;while(this.include(e)){d(e);e=e.succ()}}function a(d){if(d<this.start){return false}if(this.exclusive){return d<this.end}return d<=this.end}return{initialize:b,_each:c,include:a}})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){if(!this.include(a)){this.responders.push(a)}},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(d,b,c,a){this.each(function(h){if(Object.isFunction(h[d])){try{h[d].apply(h,[b,c,a])}catch(l){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,a){$super(a);this.transport=Ajax.getTransport();this.request(b)},request:function(b){this.url=b;this.method=this.options.method;var d=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){d+=(d?"&":"")+"_method="+this.method;this.method="post"}if(d){if(this.method=="get"){this.url+=(this.url.include("?")?"&":"?")+d}else{if(/Konqueror|Safari|KHTML/.test(navigator.userAgent)){d+="&_="}}}this.parameters=d.toQueryParams();try{var a=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(a)}Ajax.Responders.dispatch("onCreate",this,a);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||d):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;if(a>1&&!((a==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){e.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var c=this.options.requestHeaders;if(Object.isFunction(c.push)){for(var b=0,d=c.length;b<d;b+=2){e[c[b]]=c[b+1]}}else{$H(c).each(function(h){e[h.key]=h.value})}}for(var a in e){this.transport.setRequestHeader(a,e[a])}},success:function(){var a=this.getStatus();return !a||(a>=200&&a<300)},getStatus:function(){try{return this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){var c=Ajax.Request.Events[a],b=new Ajax.Response(this);if(c=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(d){this.dispatchException(d)}var h=b.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&h&&h.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+c]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+c,this,b,b.headerJSON)}catch(d){this.dispatchException(d)}if(c=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return !a||(a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(a){try{return this.transport.getResponseHeader(a)||null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(c){this.request=c;var d=this.transport=c.transport,a=this.readyState=d.readyState;if((a>2&&!Prototype.Browser.IE)||a==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(d.responseText);this.headerJSON=this._getHeaderJSON()}if(a==4){var b=d.responseXML;this.responseXML=Object.isUndefined(b)?null:b;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a){return null}a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||(a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,a,c,b){this.container={success:(a.success||a),failure:(a.failure||(a.success?null:a))};b=Object.clone(b);var d=b.onComplete;b.onComplete=(function(e,h){this.updateContent(e.responseText);if(Object.isFunction(d)){d(e,h)}}).bind(this);$super(c,b)},updateContent:function(d){var c=this.container[this.success()?"success":"failure"],a=this.options;if(!a.evalScripts){d=d.stripScripts()}if(c=$(c)){if(a.insertion){if(Object.isString(a.insertion)){var b={};b[a.insertion]=d;c.insert(b)}else{a.insertion(c,d)}}else{c.update(d)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,a,c,b){$super(b);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=a;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(a){if(this.options.decay){this.decay=(a.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(b){if(arguments.length>1){for(var a=0,d=[],c=arguments.length;a<c;a++){d.push($(arguments[a]))}return d}if(Object.isString(b)){b=document.getElementById(b)}return Element.extend(b)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(h,a){var c=[];var e=document.evaluate(h,$(a)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var b=0,d=e.snapshotLength;b<d;b++){c.push(Element.extend(e.snapshotItem(b)))}return c}}if(!Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(c){var b=(function(){try{var d=document.createElement('<input name="x">');return d.tagName.toLowerCase()==="input"&&d.name==="x"}catch(e){return false}})();var a=c.Element;c.Element=function(h,e){e=e||{};h=h.toLowerCase();var d=Element.cache;if(b&&e.name){h="<"+h+' name="'+e.name+'">';delete e.name;return Element.writeAttribute(document.createElement(h),e)}if(!d[h]){d[h]=Element.extend(document.createElement(h))}var l=("type" in e)?document.createElement(h):d[h].cloneNode(false);return Element.writeAttribute(l,e)};Object.extend(c.Element,a||{});if(a){c.Element.prototype=a.prototype}})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(b){var a=b._prototypeUID;if(a){Element.stopObserving(b);b._prototypeUID=void 0;delete Element.Storage[a]}};Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:(function(){var b=(function(){var e=document.createElement("select"),h=true;e.innerHTML='<option value="test">test</option>';if(e.options&&e.options[0]){h=e.options[0].nodeName.toUpperCase()!=="OPTION"}e=null;return h})();var a=(function(){try{var h=document.createElement("table");if(h&&h.tBodies){h.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var m=typeof h.tBodies[0]=="undefined";h=null;return m}}catch(l){return true}})();var d=(function(){var h=document.createElement("script"),m=false;try{h.appendChild(document.createTextNode(""));m=!h.firstChild||h.firstChild&&h.firstChild.nodeType!==3}catch(l){m=true}h=null;return m})();function c(m,n){m=$(m);var e=Element._purgeElement;var q=m.getElementsByTagName("*"),l=q.length;while(l--){e(q[l])}if(n&&n.toElement){n=n.toElement()}if(Object.isElement(n)){return m.update().insert(n)}n=Object.toHTML(n);var h=m.tagName.toUpperCase();if(h==="SCRIPT"&&d){m.text=n;return m}if(b||a){if(h in Element._insertionTranslations.tags){while(m.firstChild){m.removeChild(m.firstChild)}Element._getContentFromAnonymousElement(h,n.stripScripts()).each(function(r){m.appendChild(r)})}else{m.innerHTML=n.stripScripts()}}else{m.innerHTML=n.stripScripts()}n.evalScripts.bind(n).defer();return m}return c})(),replace:function(b,c){b=$(b);if(c&&c.toElement){c=c.toElement()}else{if(!Object.isElement(c)){c=Object.toHTML(c);var a=b.ownerDocument.createRange();a.selectNode(b);c.evalScripts.bind(c).defer();c=a.createContextualFragment(c.stripScripts())}}b.parentNode.replaceChild(c,b);return b},insert:function(c,e){c=$(c);if(Object.isString(e)||Object.isNumber(e)||Object.isElement(e)||(e&&(e.toElement||e.toHTML))){e={bottom:e}}var d,h,b,l;for(var a in e){d=e[a];a=a.toLowerCase();h=Element._insertionTranslations[a];if(d&&d.toElement){d=d.toElement()}if(Object.isElement(d)){h(c,d);continue}d=Object.toHTML(d);b=((a=="before"||a=="after")?c.parentNode:c).tagName.toUpperCase();l=Element._getContentFromAnonymousElement(b,d.stripScripts());if(a=="top"||a=="after"){l.reverse()}l.each(h.curry(c));d.evalScripts.bind(d).defer()}return c},wrap:function(b,c,a){b=$(b);if(Object.isElement(c)){$(c).writeAttribute(a||{})}else{if(Object.isString(c)){c=new Element(c,a)}else{c=new Element("div",c)}}if(b.parentNode){b.parentNode.replaceChild(c,b)}c.appendChild(b);return c},inspect:function(b){b=$(b);var a="<"+b.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(h){var e=h.first(),c=h.last(),d=(b[e]||"").toString();if(d){a+=" "+c+"="+d.inspect(true)}});return a+">"},recursivelyCollect:function(a,c,d){a=$(a);d=d||-1;var b=[];while(a=a[c]){if(a.nodeType==1){b.push(Element.extend(a))}if(b.length==d){break}}return b},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){a=$(a).firstChild;while(a&&a.nodeType!=1){a=a.nextSibling}return $(a)},immediateDescendants:function(b){var a=[],c=$(b).firstChild;while(c){if(c.nodeType===1){a.push(Element.extend(c))}c=c.nextSibling}return a},previousSiblings:function(a,b){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(b,a){b=$(b);if(Object.isString(a)){return Prototype.Selector.match(b,a)}return a.match(b)},up:function(b,d,a){b=$(b);if(arguments.length==1){return $(b.parentNode)}var c=Element.ancestors(b);return Object.isNumber(d)?c[d]:Prototype.Selector.find(c,d,a)},down:function(b,c,a){b=$(b);if(arguments.length==1){return Element.firstDescendant(b)}return Object.isNumber(c)?Element.descendants(b)[c]:Element.select(b,c)[a||0]},previous:function(b,c,a){b=$(b);if(Object.isNumber(c)){a=c,c=false}if(!Object.isNumber(a)){a=0}if(c){return Prototype.Selector.find(b.previousSiblings(),c,a)}else{return b.recursivelyCollect("previousSibling",a+1)[a]}},next:function(b,d,a){b=$(b);if(Object.isNumber(d)){a=d,d=false}if(!Object.isNumber(a)){a=0}if(d){return Prototype.Selector.find(b.nextSiblings(),d,a)}else{var c=Object.isNumber(a)?a+1:1;return b.recursivelyCollect("nextSibling",a+1)[a]}},select:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){a=$(a);var b=Element.readAttribute(a,"id");if(b){return b}do{b="anonymous_element_"+Element.idCounter++}while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(c,a){c=$(c);if(Prototype.Browser.IE){var b=Element._attributeTranslations.read;if(b.values[a]){return b.values[a](c,a)}if(b.names[a]){a=b.names[a]}if(a.include(":")){return(!c.attributes||!c.attributes[a])?null:c.attributes[a].value}}return c.getAttribute(a)},writeAttribute:function(e,c,h){e=$(e);var b={},d=Element._attributeTranslations.write;if(typeof c=="object"){b=c}else{b[c]=Object.isUndefined(h)?true:h}for(var a in b){c=d.names[a]||a;h=b[a];if(d.values[a]){c=d.values[a](e,h)}if(h===false||h===null){e.removeAttribute(c)}else{if(h===true){e.setAttribute(c,c)}else{e.setAttribute(c,h)}}}return e},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(!(a=$(a))){return}var c=a.className;return(c.length>0&&(c==b||new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)))},addClassName:function(a,b){if(!(a=$(a))){return}if(!Element.hasClassName(a,b)){a.className+=(a.className?" ":"")+b}return a},removeClassName:function(a,b){if(!(a=$(a))){return}a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a},toggleClassName:function(a,b){if(!(a=$(a))){return}return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(b){b=$(b);var c=b.firstChild;while(c){var a=c.nextSibling;if(c.nodeType==3&&!/\S/.test(c.nodeValue)){b.removeChild(c)}c=a}return b},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(b,a){b=$(b),a=$(a);if(b.compareDocumentPosition){return(b.compareDocumentPosition(a)&8)===8}if(a.contains){return a.contains(b)&&a!==b}while(b=b.parentNode){if(b==a){return true}}return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(b,c){b=$(b);c=c=="float"?"cssFloat":c.camelize();var d=b.style[c];if(!d||d=="auto"){var a=document.defaultView.getComputedStyle(b,null);d=a?a[c]:null}if(c=="opacity"){return d?parseFloat(d):1}return d=="auto"?null:d},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(b,c){b=$(b);var e=b.style,a;if(Object.isString(c)){b.style.cssText+=";"+c;return c.include("opacity")?b.setOpacity(c.match(/opacity:\s*(\d?\.?\d*)/)[1]):b}for(var d in c){if(d=="opacity"){b.setOpacity(c[d])}else{e[(d=="float"||d=="cssFloat")?(Object.isUndefined(e.styleFloat)?"cssFloat":"styleFloat"):d]=c[d]}}return b},setOpacity:function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;return a},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=$(a);if(a._overflow){return a}a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden"){a.style.overflow="hidden"}return a},undoClipping:function(a){a=$(a);if(!a._overflow){return a}a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},clonePosition:function(b,d){var a=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});d=$(d);var e=Element.viewportOffset(d),h=[0,0],c=null;b=$(b);if(Element.getStyle(b,"position")=="absolute"){c=Element.getOffsetParent(b);h=Element.viewportOffset(c)}if(c==document.body){h[0]-=document.body.offsetLeft;h[1]-=document.body.offsetTop}if(a.setLeft){b.style.left=(e[0]-h[0]+a.offsetLeft)+"px"}if(a.setTop){b.style.top=(e[1]-h[1]+a.offsetTop)+"px"}if(a.setWidth){b.style.width=d.offsetWidth+"px"}if(a.setHeight){b.style.height=d.offsetHeight+"px"}return b}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(d,b,c){switch(c){case"left":case"top":case"right":case"bottom":if(d(b,"position")==="static"){return null}case"height":case"width":if(!Element.visible(b)){return null}var e=parseInt(d(b,c),10);if(e!==b["offset"+c.capitalize()]){return e+"px"}var a;if(c==="height"){a=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{a=["border-left-width","padding-left","padding-right","border-right-width"]}return a.inject(e,function(h,l){var m=d(b,l);return m===null?h:h-parseInt(m,10)})+"px";default:return d(b,c)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(c,a,b){if(b==="title"){return a.title}return c(a,b)})}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(a,b){a=$(a);b=(b=="float"||b=="cssFloat")?"styleFloat":b.camelize();var c=a.style[b];if(!c&&a.currentStyle){c=a.currentStyle[b]}if(b=="opacity"){if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(c[1]){return parseFloat(c[1])/100}}return 1}if(c=="auto"){if((b=="width"||b=="height")&&(a.getStyle("display")!="none")){return a["offset"+b.capitalize()]+"px"}return null}return c};Element.Methods.setOpacity=function(b,e){function h(l){return l.replace(/alpha\([^\)]*\)/gi,"")}b=$(b);var a=b.currentStyle;if((a&&!a.hasLayout)||(!a&&b.style.zoom=="normal")){b.style.zoom=1}var d=b.getStyle("filter"),c=b.style;if(e==1||e===""){(d=h(d))?c.filter=d:c.removeAttribute("filter");return b}else{if(e<0.00001){e=0}}c.filter=h(d)+"alpha(opacity="+(e*100)+")";return b};Element._attributeTranslations=(function(){var b="className",a="for",c=document.createElement("div");c.setAttribute(b,"x");if(c.className!=="x"){c.setAttribute("class","x");if(c.className==="x"){b="class"}}c=null;c=document.createElement("label");c.setAttribute(a,"x");if(c.htmlFor!=="x"){c.setAttribute("htmlFor","x");if(c.htmlFor==="x"){a="htmlFor"}}c=null;return{read:{names:{"class":b,className:b,"for":a,htmlFor:a},values:{_getAttr:function(d,e){return d.getAttribute(e)},_getAttr2:function(d,e){return d.getAttribute(e,2)},_getAttrNode:function(d,h){var e=d.getAttributeNode(h);return e?e.value:""},_getEv:(function(){var d=document.createElement("div"),h;d.onclick=Prototype.emptyFunction;var e=d.getAttribute("onclick");if(String(e).indexOf("{")>-1){h=function(l,m){m=l.getAttribute(m);if(!m){return null}m=m.toString();m=m.split("{")[1];m=m.split("}")[0];return m.strip()}}else{if(e===""){h=function(l,m){m=l.getAttribute(m);if(!m){return null}return m.strip()}}}d=null;return h})(),_flag:function(d,e){return $(d).hasAttribute(e)?e:null},style:function(d){return d.style.cssText.toLowerCase()},title:function(d){return d.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function a(e){var b=e.getElementsByTagName("*"),d=[];for(var c=0,h;h=b[c];c++){if(h.tagName!=="!"){d.push(h)}}return d}Element.Methods.down=function(c,d,b){c=$(c);if(arguments.length==1){return c.firstDescendant()}return Object.isNumber(d)?a(c)[d]:Element.select(c,d)[b||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1)?0.999999:(b==="")?"":(b<0.00001)?0:b;return a}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=(b==1||b==="")?"":(b<0.00001)?0:b;if(b==1){if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;a.width--}else{try{var d=document.createTextNode(" ");a.appendChild(d);a.removeChild(d)}catch(c){}}}return a}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(c,e){c=$(c);if(e&&e.toElement){e=e.toElement()}if(Object.isElement(e)){c.parentNode.replaceChild(e,c);return c}e=Object.toHTML(e);var d=c.parentNode,b=d.tagName.toUpperCase();if(Element._insertionTranslations.tags[b]){var h=c.next(),a=Element._getContentFromAnonymousElement(b,e.stripScripts());d.removeChild(c);if(h){a.each(function(l){d.insertBefore(l,h)})}else{a.each(function(l){d.appendChild(l)})}}else{c.outerHTML=e.stripScripts()}e.evalScripts.bind(e).defer();return c}}Element._returnOffset=function(b,c){var a=[b,c];a.left=b;a.top=c;return a};Element._getContentFromAnonymousElement=function(d,c){var e=new Element("div"),b=Element._insertionTranslations.tags[d];if(b){e.innerHTML=b[0]+c+b[1];for(var a=b[2];a--;){e=e.firstChild}}else{e.innerHTML=c}return $A(e.childNodes)};Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,c){c=Element._attributeTranslations.has[c]||c;var b=$(a).getAttributeNode(c);return !!(b&&b.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}a=null})(document.createElement("div"));Element.extend=(function(){function c(l){if(typeof window.Element!="undefined"){var n=window.Element.prototype;if(n){var r="_"+(Math.random()+"").slice(2),m=document.createElement(l);n[r]="x";var q=(m[r]!=="x");delete n[r];m=null;return q}}return false}function b(m,l){for(var q in l){var n=l[q];if(Object.isFunction(n)&&!(q in m)){m[q]=n.methodize()}}}var d=c("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(d){return function(m){if(m&&typeof m._extendedByPrototype=="undefined"){var l=m.tagName;if(l&&(/^(?:object|applet|embed)$/i.test(l))){b(m,Element.Methods);b(m,Element.Methods.Simulated);b(m,Element.Methods.ByTag[l.toUpperCase()])}}return m}}return Prototype.K}var a={},e=Element.Methods.ByTag;var h=Object.extend(function(n){if(!n||typeof n._extendedByPrototype!="undefined"||n.nodeType!=1||n==window){return n}var l=Object.clone(a),m=n.tagName.toUpperCase();if(e[m]){Object.extend(l,e[m])}b(n,l);n._extendedByPrototype=Prototype.emptyFunction;return n},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(a,Element.Methods);Object.extend(a,Element.Methods.Simulated)}}});h.refresh();return h})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(a,b){return a.hasAttribute(b)}}else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute}Element.addMethods=function(c){var n=Prototype.BrowserFeatures,d=Element.Methods.ByTag;if(!c){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var b=c;c=arguments[1]}if(!b){Object.extend(Element.Methods,c||{})}else{if(Object.isArray(b)){b.each(l)}else{l(b)}}function l(r){r=r.toUpperCase();if(!Element.Methods.ByTag[r]){Element.Methods.ByTag[r]={}}Object.extend(Element.Methods.ByTag[r],c)}function a(t,s,r){r=r||false;for(var v in t){var u=t[v];if(!Object.isFunction(u)){continue}if(!r||!(v in s)){s[v]=u.methodize()}}}function e(u){var r;var t={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(t[u]){r="HTML"+t[u]+"Element"}if(window[r]){return window[r]}r="HTML"+u+"Element";if(window[r]){return window[r]}r="HTML"+u.capitalize()+"Element";if(window[r]){return window[r]}var s=document.createElement(u),v=s.__proto__||s.constructor.prototype;s=null;return v}var m=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(n.ElementExtensions){a(Element.Methods,m);a(Element.Methods.Simulated,m,true)}if(n.SpecificElementExtensions){for(var q in Element.Methods.ByTag){var h=e(q);if(Object.isUndefined(h)){continue}a(d[q],h.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(b){var l=Prototype.Browser,e=document,c,d={};function a(){if(l.WebKit&&!e.evaluate){return document}if(l.Opera&&window.parseFloat(window.opera.version())<9.5){return document.body}return document.documentElement}function h(m){if(!c){c=a()}d[m]="client"+m;b["get"+m]=function(){return c[d[m]]};return b["get"+m]()}b.getWidth=h.curry("Width");b.getHeight=h.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(b){if(!(b=$(b))){return}var a;if(b===window){a=0}else{if(typeof b._prototypeUID==="undefined"){b._prototypeUID=Element.Storage.UID++}a=b._prototypeUID}if(!Element.Storage[a]){Element.Storage[a]=$H()}return Element.Storage[a]},store:function(b,a,c){if(!(b=$(b))){return}if(arguments.length===2){Element.getStorage(b).update(a)}else{Element.getStorage(b).set(a,c)}return b},retrieve:function(c,b,a){if(!(c=$(c))){return}var e=Element.getStorage(c),d=e.get(b);if(Object.isUndefined(d)){e.set(b,a);d=a}return d},clone:function(c,a){if(!(c=$(c))){return}var e=c.cloneNode(a);e._prototypeUID=void 0;if(a){var d=Element.select(e,"*"),b=d.length;while(b--){d[b]._prototypeUID=void 0}}return Element.extend(e)},purge:function(c){if(!(c=$(c))){return}var a=Element._purgeElement;a(c);var d=c.getElementsByTagName("*"),b=d.length;while(b--){a(d[b])}return null}});(function(){function l(C){var B=C.match(/^(\d+)%?$/i);if(!B){return null}return(Number(B[1])/100)}function t(M,N,C){var F=null;if(Object.isElement(M)){F=M;M=F.getStyle(N)}if(M===null){return null}if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(M)){return window.parseFloat(M)}var H=M.include("%"),D=(C===document.viewport);if(/\d/.test(M)&&F&&F.runtimeStyle&&!(H&&D)){var B=F.style.left,L=F.runtimeStyle.left;F.runtimeStyle.left=F.currentStyle.left;F.style.left=M||0;M=F.style.pixelLeft;F.style.left=B;F.runtimeStyle.left=L;return M}if(F&&H){C=C||F.parentNode;var E=l(M);var I=null;var G=F.getStyle("position");var K=N.include("left")||N.include("right")||N.include("width");var J=N.include("top")||N.include("bottom")||N.include("height");if(C===document.viewport){if(K){I=document.viewport.getWidth()}else{if(J){I=document.viewport.getHeight()}}}else{if(K){I=$(C).measure("width")}else{if(J){I=$(C).measure("height")}}}return(I===null)?0:I*E}return 0}function h(B){if(Object.isString(B)&&B.endsWith("px")){return B}return B+"px"}function n(C){var B=C;while(C&&C.parentNode){var D=C.getStyle("display");if(D==="none"){return false}C=$(C.parentNode)}return true}var d=Prototype.K;if("currentStyle" in document.documentElement){d=function(B){if(!B.currentStyle.hasLayout){B.style.zoom=1}return B}}function e(B){if(B.include("border")){B=B+"-width"}return B.camelize()}Element.Layout=Class.create(Hash,{initialize:function($super,C,B){$super();this.element=$(C);Element.Layout.PROPERTIES.each(function(D){this._set(D,null)},this);if(B){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(C,B){return Hash.prototype.set.call(this,C,B)},set:function(C,B){throw"Properties of Element.Layout are read-only."},get:function($super,C){var B=$super(C);return B===null?this._compute(C):B},_begin:function(){if(this._prepared){return}var F=this.element;if(n(F)){this._prepared=true;return}var H={position:F.style.position||"",width:F.style.width||"",visibility:F.style.visibility||"",display:F.style.display||""};F.store("prototype_original_styles",H);var I=F.getStyle("position"),B=F.getStyle("width");var C=(I==="fixed")?document.viewport:F.parentNode;F.setStyle({position:"absolute",visibility:"hidden",display:"block"});var D=F.getStyle("width");var E;if(B&&(D===B)){E=t(F,"width",C)}else{if(I==="absolute"||I==="fixed"){E=t(F,"width",C)}else{var J=F.parentNode,G=$(J).getLayout();E=G.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}}F.setStyle({width:E+"px"});this._prepared=true},_end:function(){var C=this.element;var B=C.retrieve("prototype_original_styles");C.store("prototype_original_styles",null);C.setStyle(B);this._prepared=false},_compute:function(C){var B=Element.Layout.COMPUTATIONS;if(!(C in B)){throw"Property not found."}return this._set(C,B[C].call(this,this.element))},toObject:function(){var B=$A(arguments);var C=(B.length===0)?Element.Layout.PROPERTIES:B.join(" ").split(" ");var D={};C.each(function(E){if(!Element.Layout.PROPERTIES.include(E)){return}var F=this.get(E);if(F!=null){D[E]=F}},this);return D},toHash:function(){var B=this.toObject.apply(this,arguments);return new Hash(B)},toCSS:function(){var B=$A(arguments);var D=(B.length===0)?Element.Layout.PROPERTIES:B.join(" ").split(" ");var C={};D.each(function(E){if(!Element.Layout.PROPERTIES.include(E)){return}if(Element.Layout.COMPOSITE_PROPERTIES.include(E)){return}var F=this.get(E);if(F!=null){C[e(E)]=F+"px"}},this);return C},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(D){if(!this._preComputing){this._begin()}var B=this.get("border-box-height");if(B<=0){if(!this._preComputing){this._end()}return 0}var E=this.get("border-top"),C=this.get("border-bottom");var G=this.get("padding-top"),F=this.get("padding-bottom");if(!this._preComputing){this._end()}return B-E-C-G-F},width:function(D){if(!this._preComputing){this._begin()}var C=this.get("border-box-width");if(C<=0){if(!this._preComputing){this._end()}return 0}var G=this.get("border-left"),B=this.get("border-right");var E=this.get("padding-left"),F=this.get("padding-right");if(!this._preComputing){this._end()}return C-G-B-E-F},"padding-box-height":function(C){var B=this.get("height"),E=this.get("padding-top"),D=this.get("padding-bottom");return B+E+D},"padding-box-width":function(B){var C=this.get("width"),D=this.get("padding-left"),E=this.get("padding-right");return C+D+E},"border-box-height":function(C){if(!this._preComputing){this._begin()}var B=C.offsetHeight;if(!this._preComputing){this._end()}return B},"border-box-width":function(B){if(!this._preComputing){this._begin()}var C=B.offsetWidth;if(!this._preComputing){this._end()}return C},"margin-box-height":function(C){var B=this.get("border-box-height"),D=this.get("margin-top"),E=this.get("margin-bottom");if(B<=0){return 0}return B+D+E},"margin-box-width":function(D){var C=this.get("border-box-width"),E=this.get("margin-left"),B=this.get("margin-right");if(C<=0){return 0}return C+E+B},top:function(B){var C=B.positionedOffset();return C.top},bottom:function(B){var E=B.positionedOffset(),C=B.getOffsetParent(),D=C.measure("height");var F=this.get("border-box-height");return D-F-E.top},left:function(B){var C=B.positionedOffset();return C.left},right:function(D){var F=D.positionedOffset(),E=D.getOffsetParent(),B=E.measure("width");var C=this.get("border-box-width");return B-C-F.left},"padding-top":function(B){return t(B,"paddingTop")},"padding-bottom":function(B){return t(B,"paddingBottom")},"padding-left":function(B){return t(B,"paddingLeft")},"padding-right":function(B){return t(B,"paddingRight")},"border-top":function(B){return t(B,"borderTopWidth")},"border-bottom":function(B){return t(B,"borderBottomWidth")},"border-left":function(B){return t(B,"borderLeftWidth")},"border-right":function(B){return t(B,"borderRightWidth")},"margin-top":function(B){return t(B,"marginTop")},"margin-bottom":function(B){return t(B,"marginBottom")},"margin-left":function(B){return t(B,"marginLeft")},"margin-right":function(B){return t(B,"marginRight")}}});if("getBoundingClientRect" in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{right:function(C){var D=d(C.getOffsetParent());var E=C.getBoundingClientRect(),B=D.getBoundingClientRect();return(B.right-E.right).round()},bottom:function(C){var D=d(C.getOffsetParent());var E=C.getBoundingClientRect(),B=D.getBoundingClientRect();return(B.bottom-E.bottom).round()}})}Element.Offset=Class.create({initialize:function(C,B){this.left=C.round();this.top=B.round();this[0]=this.left;this[1]=this.top},relativeTo:function(B){return new Element.Offset(this.left-B.left,this.top-B.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function w(C,B){return new Element.Layout(C,B)}function b(B,C){return $(B).getLayout().get(C)}function s(C){C=$(C);var G=Element.getStyle(C,"display");if(G&&G!=="none"){return{width:C.offsetWidth,height:C.offsetHeight}}var D=C.style;var B={visibility:D.visibility,position:D.position,display:D.display};var F={visibility:"hidden",display:"block"};if(B.position!=="fixed"){F.position="absolute"}Element.setStyle(C,F);var E={width:C.offsetWidth,height:C.offsetHeight};Element.setStyle(C,B);return E}function q(B){if(c(B)){return $(document.body)}var C=(Element.getStyle(B,"display")==="inline");if(!C&&B.offsetParent){return $(B.offsetParent)}if(B===document.body){return $(B)}while((B=B.parentNode)&&B!==document.body){if(Element.getStyle(B,"position")!=="static"){return(B.nodeName==="HTML")?$(document.body):$(B)}}return $(document.body)}function A(C){var B=0,D=0;if(C.parentNode){do{B+=C.offsetTop||0;D+=C.offsetLeft||0;C=C.offsetParent}while(C)}return new Element.Offset(D,B)}function u(C){var D=C.getLayout();var B=0,F=0;do{B+=C.offsetTop||0;F+=C.offsetLeft||0;C=C.offsetParent;if(C){if(r(C)){break}var E=Element.getStyle(C,"position");if(E!=="static"){break}}}while(C);F-=D.get("margin-top");B-=D.get("margin-left");return new Element.Offset(F,B)}function a(C){var B=0,D=0;do{B+=C.scrollTop||0;D+=C.scrollLeft||0;C=C.parentNode}while(C);return new Element.Offset(D,B)}function z(F){var B=0,E=0,D=document.body;var C=F;do{B+=C.offsetTop||0;E+=C.offsetLeft||0;if(C.offsetParent==D&&Element.getStyle(C,"position")=="absolute"){break}}while(C=C.offsetParent);C=F;do{if(C!=D){B-=C.scrollTop||0;E-=C.scrollLeft||0}}while(C=C.parentNode);return new Element.Offset(E,B)}function v(B){B=$(B);if(Element.getStyle(B,"position")==="absolute"){return B}var F=q(B);var E=B.viewportOffset(),C=F.viewportOffset();var G=E.relativeTo(C);var D=B.getLayout();B.store("prototype_absolutize_original_styles",{left:B.getStyle("left"),top:B.getStyle("top"),width:B.getStyle("width"),height:B.getStyle("height")});B.setStyle({position:"absolute",top:G.top+"px",left:G.left+"px",width:D.get("width")+"px",height:D.get("height")+"px"});return B}function m(C){C=$(C);if(Element.getStyle(C,"position")==="relative"){return C}var B=C.retrieve("prototype_absolutize_original_styles");if(B){C.setStyle(B)}return C}if(Prototype.Browser.IE){q=q.wrap(function(D,C){C=$(C);if(c(C)){return $(document.body)}var B=C.getStyle("position");if(B!=="static"){return D(C)}C.setStyle({position:"relative"});var E=D(C);C.setStyle({position:B});return E});u=u.wrap(function(E,C){C=$(C);if(!C.parentNode){return new Element.Offset(0,0)}var B=C.getStyle("position");if(B!=="static"){return E(C)}var D=C.getOffsetParent();if(D&&D.getStyle("position")==="fixed"){d(D)}C.setStyle({position:"relative"});var F=E(C);C.setStyle({position:B});return F})}else{if(Prototype.Browser.Webkit){A=function(C){var B=0,D=0;do{B+=C.offsetTop||0;D+=C.offsetLeft||0;if(C.offsetParent==document.body){if(Element.getStyle(C,"position")=="absolute"){break}}C=C.offsetParent}while(C);return new Element.Offset(D,B)}}}Element.addMethods({getLayout:w,measure:b,getDimensions:s,getOffsetParent:q,cumulativeOffset:A,positionedOffset:u,cumulativeScrollOffset:a,viewportOffset:z,absolutize:v,relativize:m});function r(B){return B.nodeName.toUpperCase()==="BODY"}function c(B){return B!==document.body&&!Element.descendantOf(B,document.body)}if("getBoundingClientRect" in document.documentElement){Element.addMethods({viewportOffset:function(B){B=$(B);if(c(B)){return new Element.Offset(0,0)}var C=B.getBoundingClientRect(),D=document.documentElement;return new Element.Offset(C.left-D.clientLeft,C.top-D.clientTop)}})}})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};Prototype.Selector=(function(){function a(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function c(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function d(r,s,m){m=m||0;var l=Prototype.Selector.match,q=r.length,h=0,n;for(n=0;n<q;n++){if(l(r[n],s)&&m==h++){return Element.extend(r[n])}}}function e(m){for(var h=0,l=m.length;h<l;h++){Element.extend(m[h])}return m}var b=Prototype.K;return{select:a,match:c,find:d,extendElements:(Element.extend===b)?b:e,extendElement:Element.extend}})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var z=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,q=0,d=Object.prototype.toString,v=false,n=true;[0,0].sort(function(){n=false;return 0});var b=function(N,D,K,F){K=K||[];var e=D=D||document;if(D.nodeType!==1&&D.nodeType!==9){return[]}if(!N||typeof N!=="string"){return K}var L=[],M,I,R,Q,J,C,B=true,G=w(D),P=N;while((z.exec(""),M=z.exec(P))!==null){P=M[3];L.push(M[1]);if(M[2]){C=M[3];break}}if(L.length>1&&r.exec(N)){if(L.length===2&&h.relative[L[0]]){I=l(L[0]+L[1],D)}else{I=h.relative[L[0]]?[D]:b(L.shift(),D);while(L.length){N=L.shift();if(h.relative[N]){N+=L.shift()}I=l(N,I)}}}else{if(!F&&L.length>1&&D.nodeType===9&&!G&&h.match.ID.test(L[0])&&!h.match.ID.test(L[L.length-1])){var S=b.find(L.shift(),D,G);D=S.expr?b.filter(S.expr,S.set)[0]:S.set[0]}if(D){var S=F?{expr:L.pop(),set:a(F)}:b.find(L.pop(),L.length===1&&(L[0]==="~"||L[0]==="+")&&D.parentNode?D.parentNode:D,G);I=S.expr?b.filter(S.expr,S.set):S.set;if(L.length>0){R=a(I)}else{B=false}while(L.length){var E=L.pop(),H=E;if(!h.relative[E]){E=""}else{H=L.pop()}if(H==null){H=D}h.relative[E](R,H,G)}}else{R=L=[]}}if(!R){R=I}if(!R){throw"Syntax error, unrecognized expression: "+(E||N)}if(d.call(R)==="[object Array]"){if(!B){K.push.apply(K,R)}else{if(D&&D.nodeType===1){for(var O=0;R[O]!=null;O++){if(R[O]&&(R[O]===true||R[O].nodeType===1&&m(D,R[O]))){K.push(I[O])}}}else{for(var O=0;R[O]!=null;O++){if(R[O]&&R[O].nodeType===1){K.push(I[O])}}}}}else{a(R,K)}if(C){b(C,e,K,F);b.uniqueSort(K)}return K};b.uniqueSort=function(B){if(c){v=n;B.sort(c);if(v){for(var e=1;e<B.length;e++){if(B[e]===B[e-1]){B.splice(e--,1)}}}}return B};b.matches=function(e,B){return b(e,null,null,B)};b.find=function(H,e,I){var G,E;if(!H){return[]}for(var D=0,C=h.order.length;D<C;D++){var F=h.order[D],E;if((E=h.leftMatch[F].exec(H))){var B=E[1];E.splice(1,1);if(B.substr(B.length-1)!=="\\"){E[1]=(E[1]||"").replace(/\\/g,"");G=h.find[F](E,e,I);if(G!=null){H=H.replace(h.match[F],"");break}}}}if(!G){G=e.getElementsByTagName("*")}return{set:G,expr:H}};b.filter=function(K,J,N,D){var C=K,P=[],H=J,F,e,G=J&&J[0]&&w(J[0]);while(K&&J.length){for(var I in h.filter){if((F=h.match[I].exec(K))!=null){var B=h.filter[I],O,M;e=false;if(H==P){P=[]}if(h.preFilter[I]){F=h.preFilter[I](F,H,N,P,D,G);if(!F){e=O=true}else{if(F===true){continue}}}if(F){for(var E=0;(M=H[E])!=null;E++){if(M){O=B(M,F,E,H);var L=D^!!O;if(N&&O!=null){if(L){e=true}else{H[E]=false}}else{if(L){P.push(M);e=true}}}}}if(O!==undefined){if(!N){H=P}K=K.replace(h.match[I],"");if(!e){return[]}break}}}if(K==C){if(e==null){throw"Syntax error, unrecognized expression: "+K}else{break}}C=K}return H};var h=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(H,e,G){var E=typeof e==="string",I=E&&!/\W/.test(e),F=E&&!I;if(I&&!G){e=e.toUpperCase()}for(var D=0,C=H.length,B;D<C;D++){if((B=H[D])){while((B=B.previousSibling)&&B.nodeType!==1){}H[D]=F||B&&B.nodeName===e?B||false:B===e}}if(F){b.filter(e,H,true)}},">":function(G,B,H){var E=typeof B==="string";if(E&&!/\W/.test(B)){B=H?B:B.toUpperCase();for(var C=0,e=G.length;C<e;C++){var F=G[C];if(F){var D=F.parentNode;G[C]=D.nodeName===B?D:false}}}else{for(var C=0,e=G.length;C<e;C++){var F=G[C];if(F){G[C]=E?F.parentNode:F.parentNode===B}}if(E){b.filter(B,G,true)}}},"":function(D,B,F){var C=q++,e=A;if(!/\W/.test(B)){var E=B=F?B:B.toUpperCase();e=u}e("parentNode",B,C,D,E,F)},"~":function(D,B,F){var C=q++,e=A;if(typeof B==="string"&&!/\W/.test(B)){var E=B=F?B:B.toUpperCase();e=u}e("previousSibling",B,C,D,E,F)}},find:{ID:function(B,C,D){if(typeof C.getElementById!=="undefined"&&!D){var e=C.getElementById(B[1]);return e?[e]:[]}},NAME:function(C,F,G){if(typeof F.getElementsByName!=="undefined"){var B=[],E=F.getElementsByName(C[1]);for(var D=0,e=E.length;D<e;D++){if(E[D].getAttribute("name")===C[1]){B.push(E[D])}}return B.length===0?null:B}},TAG:function(e,B){return B.getElementsByTagName(e[1])}},preFilter:{CLASS:function(D,B,C,e,G,H){D=" "+D[1].replace(/\\/g,"")+" ";if(H){return D}for(var E=0,F;(F=B[E])!=null;E++){if(F){if(G^(F.className&&(" "+F.className+" ").indexOf(D)>=0)){if(!C){e.push(F)}}else{if(C){B[E]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(B,e){for(var C=0;e[C]===false;C++){}return e[C]&&w(e[C])?B[1]:B[1].toUpperCase()},CHILD:function(e){if(e[1]=="nth"){var B=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]=="even"&&"2n"||e[2]=="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(B[1]+(B[2]||1))-0;e[3]=B[3]-0}e[0]=q++;return e},ATTR:function(E,B,C,e,F,G){var D=E[1].replace(/\\/g,"");if(!G&&h.attrMap[D]){E[1]=h.attrMap[D]}if(E[2]==="~="){E[4]=" "+E[4]+" "}return E},PSEUDO:function(E,B,C,e,F){if(E[1]==="not"){if((z.exec(E[3])||"").length>1||/^\w/.test(E[3])){E[3]=b(E[3],null,null,B)}else{var D=b.filter(E[3],B,C,true^F);if(!C){e.push.apply(e,D)}return false}}else{if(h.match.POS.test(E[0])||h.match.CHILD.test(E[0])){return true}}return E},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(C,B,e){return !!b(e[3],C).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toUpperCase()==="BUTTON"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(B,e){return e===0},last:function(C,B,e,D){return B===D.length-1},even:function(B,e){return e%2===0},odd:function(B,e){return e%2===1},lt:function(C,B,e){return B<e[3]-0},gt:function(C,B,e){return B>e[3]-0},nth:function(C,B,e){return e[3]-0==B},eq:function(C,B,e){return e[3]-0==B}},filter:{PSEUDO:function(G,C,D,H){var B=C[1],E=h.filters[B];if(E){return E(G,D,C,H)}else{if(B==="contains"){return(G.textContent||G.innerText||"").indexOf(C[3])>=0}else{if(B==="not"){var F=C[3];for(var D=0,e=F.length;D<e;D++){if(F[D]===G){return false}}return true}}}},CHILD:function(e,D){var G=D[1],B=e;switch(G){case"only":case"first":while((B=B.previousSibling)){if(B.nodeType===1){return false}}if(G=="first"){return true}B=e;case"last":while((B=B.nextSibling)){if(B.nodeType===1){return false}}return true;case"nth":var C=D[2],J=D[3];if(C==1&&J==0){return true}var F=D[0],I=e.parentNode;if(I&&(I.sizcache!==F||!e.nodeIndex)){var E=0;for(B=I.firstChild;B;B=B.nextSibling){if(B.nodeType===1){B.nodeIndex=++E}}I.sizcache=F}var H=e.nodeIndex-J;if(C==0){return H==0}else{return(H%C==0&&H/C>=0)}}},ID:function(B,e){return B.nodeType===1&&B.getAttribute("id")===e},TAG:function(B,e){return(e==="*"&&B.nodeType===1)||B.nodeName===e},CLASS:function(B,e){return(" "+(B.className||B.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(F,D){var C=D[1],e=h.attrHandle[C]?h.attrHandle[C](F):F[C]!=null?F[C]:F.getAttribute(C),G=e+"",E=D[2],B=D[4];return e==null?E==="!=":E==="="?G===B:E==="*="?G.indexOf(B)>=0:E==="~="?(" "+G+" ").indexOf(B)>=0:!B?G&&e!==false:E==="!="?G!=B:E==="^="?G.indexOf(B)===0:E==="$="?G.substr(G.length-B.length)===B:E==="|="?G===B||G.substr(0,B.length+1)===B+"-":false},POS:function(E,B,C,F){var e=B[2],D=h.setFilters[e];if(D){return D(E,C,B,F)}}}};var r=h.match.POS;for(var t in h.match){h.match[t]=new RegExp(h.match[t].source+/(?![^\[]*\])(?![^\(]*\))/.source);h.leftMatch[t]=new RegExp(/(^(?:.|\r|\n)*?)/.source+h.match[t].source)}var a=function(B,e){B=Array.prototype.slice.call(B,0);if(e){e.push.apply(e,B);return e}return B};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(s){a=function(E,D){var B=D||[];if(d.call(E)==="[object Array]"){Array.prototype.push.apply(B,E)}else{if(typeof E.length==="number"){for(var C=0,e=E.length;C<e;C++){B.push(E[C])}}else{for(var C=0;E[C];C++){B.push(E[C])}}}return B}}var c;if(document.documentElement.compareDocumentPosition){c=function(B,e){if(!B.compareDocumentPosition||!e.compareDocumentPosition){if(B==e){v=true}return 0}var C=B.compareDocumentPosition(e)&4?-1:B===e?0:1;if(C===0){v=true}return C}}else{if("sourceIndex" in document.documentElement){c=function(B,e){if(!B.sourceIndex||!e.sourceIndex){if(B==e){v=true}return 0}var C=B.sourceIndex-e.sourceIndex;if(C===0){v=true}return C}}else{if(document.createRange){c=function(D,B){if(!D.ownerDocument||!B.ownerDocument){if(D==B){v=true}return 0}var C=D.ownerDocument.createRange(),e=B.ownerDocument.createRange();C.setStart(D,0);C.setEnd(D,0);e.setStart(B,0);e.setEnd(B,0);var E=C.compareBoundaryPoints(Range.START_TO_END,e);if(E===0){v=true}return E}}}}(function(){var B=document.createElement("div"),C="script"+(new Date).getTime();B.innerHTML="<a name='"+C+"'/>";var e=document.documentElement;e.insertBefore(B,e.firstChild);if(!!document.getElementById(C)){h.find.ID=function(E,F,G){if(typeof F.getElementById!=="undefined"&&!G){var D=F.getElementById(E[1]);return D?D.id===E[1]||typeof D.getAttributeNode!=="undefined"&&D.getAttributeNode("id").nodeValue===E[1]?[D]:undefined:[]}};h.filter.ID=function(F,D){var E=typeof F.getAttributeNode!=="undefined"&&F.getAttributeNode("id");return F.nodeType===1&&E&&E.nodeValue===D}}e.removeChild(B);e=B=null})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){h.find.TAG=function(B,F){var E=F.getElementsByTagName(B[1]);if(B[1]==="*"){var D=[];for(var C=0;E[C];C++){if(E[C].nodeType===1){D.push(E[C])}}E=D}return E}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){h.attrHandle.href=function(B){return B.getAttribute("href",2)}}e=null})();if(document.querySelectorAll){(function(){var e=b,C=document.createElement("div");C.innerHTML="<p class='TEST'></p>";if(C.querySelectorAll&&C.querySelectorAll(".TEST").length===0){return}b=function(G,F,D,E){F=F||document;if(!E&&F.nodeType===9&&!w(F)){try{return a(F.querySelectorAll(G),D)}catch(H){}}return e(G,F,D,E)};for(var B in e){b[B]=e[B]}C=null})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}h.order.splice(1,0,"CLASS");h.find.CLASS=function(B,C,D){if(typeof C.getElementsByClassName!=="undefined"&&!D){return C.getElementsByClassName(B[1])}};e=null})()}function u(B,G,F,K,H,J){var I=B=="previousSibling"&&!J;for(var D=0,C=K.length;D<C;D++){var e=K[D];if(e){if(I&&e.nodeType===1){e.sizcache=F;e.sizset=D}e=e[B];var E=false;while(e){if(e.sizcache===F){E=K[e.sizset];break}if(e.nodeType===1&&!J){e.sizcache=F;e.sizset=D}if(e.nodeName===G){E=e;break}e=e[B]}K[D]=E}}}function A(B,G,F,K,H,J){var I=B=="previousSibling"&&!J;for(var D=0,C=K.length;D<C;D++){var e=K[D];if(e){if(I&&e.nodeType===1){e.sizcache=F;e.sizset=D}e=e[B];var E=false;while(e){if(e.sizcache===F){E=K[e.sizset];break}if(e.nodeType===1){if(!J){e.sizcache=F;e.sizset=D}if(typeof G!=="string"){if(e===G){E=true;break}}else{if(b.filter(G,[e]).length>0){E=e;break}}}e=e[B]}K[D]=E}}}var m=document.compareDocumentPosition?function(B,e){return B.compareDocumentPosition(e)&16}:function(B,e){return B!==e&&(B.contains?B.contains(e):true)};var w=function(e){return e.nodeType===9&&e.documentElement.nodeName!=="HTML"||!!e.ownerDocument&&e.ownerDocument.documentElement.nodeName!=="HTML"};var l=function(e,H){var D=[],E="",F,C=H.nodeType?[H]:H;while((F=h.match.PSEUDO.exec(e))){E+=F[0];e=e.replace(h.match.PSEUDO,"")}e=h.relative[e]?e+"*":e;for(var G=0,B=C.length;G<B;G++){b(e,C[G],D)}return b.filter(E,D)};window.Sizzle=b})();(function(c){var d=Prototype.Selector.extendElements;function a(e,h){return d(c(e,h||document))}function b(h,e){return c.matches(e,[h]).length==1}Prototype.Selector.engine=c;Prototype.Selector.select=a;Prototype.Selector.match=b})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(m,d){if(typeof d!="object"){d={hash:!!d}}else{if(Object.isUndefined(d.hash)){d.hash=true}}var e,l,a=false,h=d.submit,b,c;if(d.hash){c={};b=function(n,q,r){if(q in n){if(!Object.isArray(n[q])){n[q]=[n[q]]}n[q].push(r)}else{n[q]=r}return n}}else{c="";b=function(n,q,r){return n+(n?"&":"")+encodeURIComponent(q)+"="+encodeURIComponent(r)}}return m.inject(c,function(n,q){if(!q.disabled&&q.name){e=q.name;l=$(q).getValue();if(l!=null&&q.type!="file"&&(q.type!="submit"||(!a&&h!==false&&(!h||e==h)&&(a=true)))){n=b(n,e,l)}}return n})}};Form.Methods={serialize:function(b,a){return Form.serializeElements(Form.getElements(b),a)},getElements:function(e){var h=$(e).getElementsByTagName("*"),d,a=[],c=Form.Element.Serializers;for(var b=0;d=h[b];b++){a.push(d)}return a.inject([],function(l,m){if(c[m.tagName.toLowerCase()]){l.push(Element.extend(m))}return l})},getInputs:function(l,c,d){l=$(l);var a=l.getElementsByTagName("input");if(!c&&!d){return $A(a).map(Element.extend)}for(var e=0,m=[],h=a.length;e<h;e++){var b=a[e];if((c&&b.type!=c)||(d&&b.name!=d)){continue}m.push(Element.extend(b))}return m},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(b){var c=$(b).getElements().findAll(function(d){return"hidden"!=d.type&&!d.disabled});var a=c.findAll(function(d){return d.hasAttribute("tabIndex")&&d.tabIndex>=0}).sortBy(function(d){return d.tabIndex}).first();return a?a:c.find(function(d){return/^(?:input|select|textarea)$/i.test(d.tagName)})},focusFirstElement:function(a){a=$(a);a.findFirstElement().activate();return a},request:function(b,a){b=$(b),a=Object.clone(a||{});var d=a.parameters,c=b.readAttribute("action")||"";if(c.blank()){c=window.location.href}a.parameters=b.serialize(true);if(d){if(Object.isString(d)){d=d.toQueryParams()}Object.extend(a.parameters,d)}if(b.hasAttribute("method")&&!a.method){a.method=b.method}return new Ajax.Request(c,a)}};Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();if(a.select&&(a.tagName.toLowerCase()!="input"||!(/^(?:button|reset|submit)$/i.test(a.type)))){a.select()}}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(a,b){switch(a.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(a,b);default:return Form.Element.Serializers.textarea(a,b)}},inputSelector:function(a,b){if(Object.isUndefined(b)){return a.checked?a.value:null}else{a.checked=!!b}},textarea:function(a,b){if(Object.isUndefined(b)){return a.value}else{a.value=b}},select:function(c,h){if(Object.isUndefined(h)){return this[c.type=="select-one"?"selectOne":"selectMany"](c)}else{var b,d,l=!Object.isArray(h);for(var a=0,e=c.length;a<e;a++){b=c.options[a];d=this.optionValue(b);if(l){if(d==h){b.selected=true;return}}else{b.selected=h.include(d)}}}},selectOne:function(b){var a=b.selectedIndex;return a>=0?this.optionValue(b.options[a]):null},selectMany:function(d){var a,e=d.length;if(!e){return null}for(var c=0,a=[];c<e;c++){var b=d.options[c];if(b.selected){a.push(this.optionValue(b))}}return a},optionValue:function(a){return Element.extend(a).hasAttribute("value")?a.value:a.text}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,a,b,c){$super(c,b);this.element=$(a);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type){switch(a.type.toLowerCase()){case"checkbox":case"radio":Event.observe(a,"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var H={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var e=document.documentElement;var I="onmouseenter" in e&&"onmouseleave" in e;var v=(window.attachEvent&&!window.addEventListener);var A;if(v){var n={0:1,1:4,2:2};A=function(K,J){return K.button===n[J]}}else{if(Prototype.Browser.WebKit){A=function(K,J){switch(J){case 0:return K.which==1&&!K.metaKey;case 1:return K.which==1&&K.metaKey;default:return false}}}else{A=function(K,J){return K.which?(K.which===J+1):(K.button===J)}}}function D(J){return A(J,0)}function C(J){return A(J,1)}function u(J){return A(J,2)}function c(L){L=H.extend(L);var K=L.target,J=L.type,M=L.currentTarget;if(M&&M.tagName){if(J==="load"||J==="error"||(J==="click"&&M.tagName.toLowerCase()==="input"&&M.type==="radio")){K=M}}if(K.nodeType==Node.TEXT_NODE){K=K.parentNode}return Element.extend(K)}function w(K,L){var J=H.element(K);if(!L){return J}while(J){if(Object.isElement(J)&&Prototype.Selector.match(J,L)){return Element.extend(J)}J=J.parentNode}}function B(J){return{x:b(J),y:a(J)}}function b(L){var K=document.documentElement,J=document.body||{scrollLeft:0};return L.pageX||(L.clientX+(K.scrollLeft||J.scrollLeft)-(K.clientLeft||0))}function a(L){var K=document.documentElement,J=document.body||{scrollTop:0};return L.pageY||(L.clientY+(K.scrollTop||J.scrollTop)-(K.clientTop||0))}function z(J){H.extend(J);J.preventDefault();J.stopPropagation();J.stopped=true}H.Methods={isLeftClick:D,isMiddleClick:C,isRightClick:u,element:c,findElement:w,pointer:B,pointerX:b,pointerY:a,stop:z};var F=Object.keys(H.Methods).inject({},function(J,K){J[K]=H.Methods[K].methodize();return J});if(v){function m(K){var J;switch(K.type){case"mouseover":J=K.fromElement;break;case"mouseout":J=K.toElement;break;default:return null}return Element.extend(J)}Object.extend(F,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});H.extend=function(K,J){if(!K){return false}if(K._extendedByPrototype){return K}K._extendedByPrototype=Prototype.emptyFunction;var L=H.pointer(K);Object.extend(K,{target:K.srcElement||J,relatedTarget:m(K),pageX:L.x,pageY:L.y});return Object.extend(K,F)}}else{H.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(H.prototype,F);H.extend=Prototype.K}function t(N,M,O){var L=Element.retrieve(N,"prototype_event_registry");if(Object.isUndefined(L)){d.push(N);L=Element.retrieve(N,"prototype_event_registry",$H())}var J=L.get(M);if(Object.isUndefined(J)){J=[];L.set(M,J)}if(J.pluck("handler").include(O)){return false}var K;if(M.include(":")){K=function(P){if(Object.isUndefined(P.eventName)){return false}if(P.eventName!==M){return false}H.extend(P,N);O.call(N,P)}}else{if(!I&&(M==="mouseenter"||M==="mouseleave")){if(M==="mouseenter"||M==="mouseleave"){K=function(Q){H.extend(Q,N);var P=Q.relatedTarget;while(P&&P!==N){try{P=P.parentNode}catch(R){P=N}}if(P===N){return}O.call(N,Q)}}}else{K=function(P){H.extend(P,N);O.call(N,P)}}}K.handler=O;J.push(K);return K}function l(){for(var J=0,K=d.length;J<K;J++){H.stopObserving(d[J]);d[J]=null}}var d=[];if(Prototype.Browser.IE){window.attachEvent("onunload",l)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var s=Prototype.K,h={mouseenter:"mouseover",mouseleave:"mouseout"};if(!I){s=function(J){return(h[J]||J)}}function E(M,L,N){M=$(M);var K=t(M,L,N);if(!K){return M}if(L.include(":")){if(M.addEventListener){M.addEventListener("dataavailable",K,false)}else{M.attachEvent("ondataavailable",K);M.attachEvent("onlosecapture",K)}}else{var J=s(L);if(M.addEventListener){M.addEventListener(J,K,false)}else{M.attachEvent("on"+J,K)}}return M}function r(O,M,P){O=$(O);var L=Element.retrieve(O,"prototype_event_registry");if(!L){return O}if(!M){L.each(function(R){var Q=R.key;r(O,Q)});return O}var N=L.get(M);if(!N){return O}if(!P){N.each(function(Q){r(O,M,Q.handler)});return O}var K=N.find(function(Q){return Q.handler===P});if(!K){return O}if(M.include(":")){if(O.removeEventListener){O.removeEventListener("dataavailable",K,false)}else{O.detachEvent("ondataavailable",K);O.detachEvent("onlosecapture",K)}}else{var J=s(M);if(O.removeEventListener){O.removeEventListener(J,K,false)}else{O.detachEvent("on"+J,K)}}L.set(M,N.without(K));return O}function G(M,L,K,J){M=$(M);if(Object.isUndefined(J)){J=true}if(M==document&&document.createEvent&&!M.dispatchEvent){M=document.documentElement}var N;if(document.createEvent){N=document.createEvent("HTMLEvents");N.initEvent("dataavailable",J,true)}else{N=document.createEventObject();N.eventType=J?"ondataavailable":"onlosecapture"}N.eventName=L;N.memo=K||{};if(document.createEvent){M.dispatchEvent(N)}else{M.fireEvent(N.eventType,N)}return H.extend(N)}H.Handler=Class.create({initialize:function(L,K,J,M){this.element=$(L);this.eventName=K;this.selector=J;this.callback=M;this.handler=this.handleEvent.bind(this)},start:function(){H.observe(this.element,this.eventName,this.handler);return this},stop:function(){H.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(K){var J=K.findElement(this.selector);if(J){this.callback.call(this.element,K,J)}}});function q(L,K,J,M){L=$(L);if(Object.isFunction(J)&&Object.isUndefined(M)){M=J,J=null}return new H.Handler(L,K,J,M).start()}Object.extend(H,H.Methods);Object.extend(H,{fire:G,observe:E,stopObserving:r,on:q});Element.addMethods({fire:G,observe:E,stopObserving:r,on:q});Object.extend(document,{fire:G.methodize(),observe:E.methodize(),stopObserving:r.methodize(),on:q.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,H)}else{window.Event=H}})();(function(){var d;function a(){if(document.loaded){return}if(d){window.clearTimeout(d)}document.loaded=true;document.fire("dom:loaded")}function c(){if(document.readyState==="complete"){document.stopObserving("readystatechange",c);a()}}function b(){try{document.documentElement.doScroll("left")}catch(h){d=b.defer();return}a()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",a,false)}else{document.observe("readystatechange",c);if(window==top){d=b.defer()}}Event.observe(window,"load",a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(b,a,c){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(b,a,c)}this.xcomp=a;this.ycomp=c;this.offset=Element.cumulativeOffset(b);return(c>=this.offset[1]&&c<this.offset[1]+b.offsetHeight&&a>=this.offset[0]&&a<this.offset[0]+b.offsetWidth)},withinIncludingScrolloffsets:function(b,a,d){var c=Element.cumulativeScrollOffset(b);this.xcomp=a+c[0]-this.deltaX;this.ycomp=d+c[1]-this.deltaY;this.offset=Element.cumulativeOffset(b);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+b.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+b.offsetWidth)},overlap:function(b,a){if(!b){return 0}if(b=="vertical"){return((this.offset[1]+a.offsetHeight)-this.ycomp)/a.offsetHeight}if(b=="horizontal"){return((this.offset[0]+a.offsetWidth)-this.xcomp)/a.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(b,c,a){a=a||{};return Element.clonePosition(c,b,a)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(b){function a(c){return c.blank()?null:"[contains(concat(' ', @class, ' '), ' "+c+" ')]"}b.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(c,e){e=e.toString().strip();var d=/\s/.test(e)?$w(e).map(a).join(""):a(e);return d?document._getElementsByXPath(".//*"+d,c):[]}:function(e,h){h=h.toString().strip();var l=[],m=(/\s/.test(h)?$w(h):null);if(!m&&!h){return l}var c=$(e).getElementsByTagName("*");h=" "+h+" ";for(var d=0,q,n;q=c[d];d++){if(q.className&&(n=" "+q.className+" ")&&(n.include(h)||(m&&m.all(function(r){return !r.toString().blank()&&n.include(" "+r+" ")})))){l.push(Element.extend(q))}}return l};return function(d,c){return $(c||document.body).getElementsByClassName(d)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){if(this.include(a)){return}this.set($A(this).concat(a).join(" "))},remove:function(a){if(!this.include(a)){return}this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(h,l){var a=Prototype.Selector.match,d=[];for(var c=0,e=h.length;c<e;c++){var b=h[c];if(a(b,l)){d.push(Element.extend(b))}}return d},findElement:function(h,l,b){b=b||0;var a=0,d;for(var c=0,e=h.length;c<e;c++){d=h[c];if(Prototype.Selector.match(d,l)&&b===a++){return Element.extend(d)}}},findChildElements:function(b,c){var a=c.toArray().join(", ");return Prototype.Selector.select(a,b||document)}})})();function questAction(d,c,b,a,h,m){var e="&campaign="+h;if(c){e+="&product="+c}if(b){e+="&amount="+b}if(!farm){farm=1}e+="&farm="+farm;if(d=="insert"){$("dialog_entryline_number").value=0}showGlobalWait(d);var l=createAjaxRequestObj();l.open("GET","ajax/quest.php?rid="+rid+"&action="+d+e,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.onreadystatechange=function(){questInitResponse(l,d,a,h,m)};l.send(null)}function questInitResponse(c,d,b,e,h){var a=_chkRequest(c);if(a!=0){hideGlobalWait();if(a[0]==0){globalerrorbox(a[1])}else{questInitGo(a,d,b,e,h)}}}function questInitGo(q,d,l,b,a){if(q[1]){questdata=q[1];var n=1;for(var h in questdata){if(!questdata[h]["end"]){n=0}}if(q[1][1].levelup&&q[1][1].levelup.level){levelupAlert(q[1][1].levelup.level,q[1][1].levelup.leveltitle)}if(n==1){closeQuestBox();hideDiv("questboxline");return false}else{showQuestBoxLine();hideDiv("globalbox");hideDiv("globaltransp");if(d=="insert"||l==1){if(farm>4&&farm!=99){mapGo2Location("farm",1,1)}showQuestBox(b);farmAction("rackupdate",farm)}else{if(d=="init"){for(var h in questdata){if(questdata[h]["remain"]>0){var m="nextquest"+h;startQuestTimer(m,setQuestRemain.bind(h))}}}}}if((q[2]&&q[2].pid>0&&q[2].farm>0&&q[2].amount>0)||(q[3]&&q[3]>0)){var e="";if(q[2]&&q[2].pid>0&&q[2].farm>0&&q[2].amount>0){e+='<div style="margin:0 auto;" class="market_pframe">';e+='  <div style="top:7px; left:7px;" class="tt'+q[2].pid+'"></div>';e+="</div>";e+='<div style="margin-bottom:5px;">'+q[2].amount+"x "+produkt_name[q[2].pid]+"</div>";e+='<div style="margin-bottom:15px;">'+str_replace("%PRODUCT%",produkt_name[q[2].pid],t_quests_unlock_product)+"</div>";e=str_replace("%FARM%",q[2].farm,e)}if(q[3]&&q[3]>0){if(q[3]==23){e+='<div style="background-image:url('+imgpath+'bo_sushibar.png); width:64px; height:64px; background-size:100%; margin:0 auto;"></div>'}else{if(q[3]==24){e+='<div style="background-image:url('+imgpath+'Farm10_building_64x64.png); width:64px; height:64px; background-size:100%; margin:0 auto;"></div>'}else{e+='<img src="'+imgpath+"building"+q[3]+'.gif" style="position:relative; width:64px; height:64px; margin:0 auto;">'}}e+='<div style="margin-top:5px;">'+t_quest_reward_building.replace("%NAME%",buildinginfos[0][q[3]][10])+"</div>"}globalerrorbox(e)}}else{hideDiv("questbarcontrol");hideDiv("questboxline")}}function showQuestBoxLine(){hideDiv("questboxline");return false}function setQuestRemain(d){var b=str_replace("nextquest","",d);var a="nextquest"+b;if(questdata[b]["remain"]){questdata[b]["remain"]--;if($("questline_remain"+b)){$("questline_remain"+b).innerHTML=formatTime(questdata[b]["remain"])}if(questdata[b]["remain"]<1){questClearTimer[a];if($("peoplezones")){$("peoplezones").innerHTML=""}showQuestBoxLine()}}}function showQuestBox(C){if(questdata[C]["end"]==1){closeQuestBox();return false}else{if(questdata[C]["remain"]>0){closeQuestBox();var E="nextquest"+C;startQuestTimer(E,setQuestRemain.bind(C));return false}else{$("questboxtitle").innerHTML=questdata[C].questid+".&nbsp;"+questdata[C]["data"][6];$("questboxcontent").innerHTML=questdata[C]["data"][7];var r="";var w=new Array;var e=0;for(var u in questdata[C]["data"][1][0]){if(typeof questdata[C]["data"][1][0][u]=="object"){var D=new Array;var m=1;for(var A in questdata[C]["data"][1][0][u]){var t="";if(m==2){t=questbox_product_alternative}r+='<div class="questboxobj questboxalternative" id="questboxobj'+A+'">';r+='<div class="main_float_left kp'+A+'" style="width:15px;"></div>';r+='<div id="questboxobj_bar'+A+'" class="main_float_left" style="position:relative;" onmouseover="showDiv(\'questboxtip'+A+"')\" onmouseout=\"hideDiv('questboxtip"+A+"')\">";r+='<div class="blackbox" id="questboxtip'+A+'" style="display:none; position:absolute; top:-25px; left:5px;">'+t+produkt_name[A]+"</div>";r+='<div class="questboxbarout">';r+='<div class="questboxbarin" id="questboxbarin'+A+'"></div>';r+="</div>";r+='<div id="questboxobj_notavailable'+A+'" class="important" style="display:none; margin-left:5px;">'+product_notavailable_info+"</div>";r+="</div>";r+='<div class="main_float_left" style="margin-left:5px;" id="questboxobj'+A+'_current">0</div>';r+='<div class="main_float_left">/</div>';r+='<div class="main_float_left">'+formatNumber(questdata[C]["data"][1][0][u][A])+'<span id="questboxobj'+A+'_need" style="display:none;">'+questdata[C]["data"][1][0][u][A]+"</span></div>";r+='<div class="clear"></div>';if(m==1){r+='<div id="questbox_alternative_info" class="link" onclick="showQuestboxInfo()"></div>'}r+="</div>";w.push(A);D.push(A);m++;e++}}else{if(isNumeric(u)){hideDiv("questbox_info");hideDiv("questbox_info_transp");r+='<div class="questboxobj" id="questboxobj'+u+'">';r+='<div class="main_float_left kp'+u+'" style="width:15px;"></div>';r+='<div id="questboxobj_bar'+u+'" class="main_float_left" style="position:relative;" onmouseover="showDiv(\'questboxtip'+u+"')\" onmouseout=\"hideDiv('questboxtip"+u+"')\">";r+='<div class="ttbox" id="questboxtip'+u+'" style="top:25px; left:5px;"><b>'+produkt_name[u]+'</b><div style="font-style:italic; margin-top:5px;">'+t_xmasgame_button_entry+"</div></div>";r+='<div class="questboxbarout">';r+='<div class="questboxbarin" id="questboxbarin'+u+'"></div>';r+="</div>";r+='<div id="questboxobj_notavailable'+u+'" class="important" style="display:none; margin-left:5px;">'+product_notavailable_info+"</div>";r+="</div>";r+='<div class="main_float_left" style="margin-left:5px;" id="questboxobj'+u+'_current">0</div>';r+='<div class="main_float_left">/</div>';r+='<div class="main_float_left">'+formatNumber(questdata[C]["data"][1][0][u])+'<span id="questboxobj'+u+'_need" style="display:none;">'+questdata[C]["data"][1][0][u]+"</span></div>";r+='<div class="clear"></div>';r+="</div>";w.push(u);e++}}}$("questboxobjects").innerHTML=r;for(var B=0;B<w.length;B++){var u=w[B];var d=checkRackItem(u);if(d){if(d>0&&$("questboxobj"+u)&&$("questboxobj_notavailable"+u)){hideDiv("questboxobj_notavailable"+u);$("questboxobj_bar"+u).addClassName("link");$("questboxobj_bar"+u).onclick=new Function("buildQuestBoxEntry("+u+", "+C+")")}else{showDiv("questboxobj_notavailable"+u);e++}}else{showDiv("questboxobj_notavailable"+u);e++}}var v=0;for(var u in questdata[C]["entries"]){if($("questboxobj"+u)){if(D){if(in_array(u,D)&&!v){for(var B=0;B<D.length;B++){hideDiv("questboxobj"+D[B]);$("questboxobj"+D[B]).removeClassName("questboxalternative");hideDiv("questbox_alternative_info")}e--;showDiv("questboxobj"+u);v=1}}var q=parseInt($("questboxobj"+u+"_need").innerHTML);var z=(200/100);var b=(((questdata[C]["entries"][u]*100)/q));b=(200-Math.floor(z*b));$("questboxbarin"+u).style.left="-"+b+"px";$("questboxobj"+u+"_current").innerHTML=formatNumber(questdata[C]["entries"][u])}}if(e==2){$("questboxinfos").style.height="309px"}else{if(e==3){$("questboxinfos").style.height="295px"}else{if(e==4){$("questboxinfos").style.height="282px"}else{$("questboxinfos").style.height="289px"}}}var a="";for(var B=0;B<questdata[C]["data"][2].length;B++){if(questdata[C]["data"][2][B]){a+="";if(B==0){a+='<div class="questreward_obj"><img height="15" src="'+imgpath+'points.gif">&nbsp;'+formatNumber(questdata[C]["data"][2][B])+"&nbsp;"+t_points+"</div>"}if(B==1){a+='<div class="questreward_obj"><img height="15" src="'+imgpath+'money.gif">&nbsp;'+questdata[C]["data"][2][B]+"&nbsp;"+gamecurrency+"</div>"}if(B==3){if(questdata[C]["questid"]==1||questdata[C]["questid"]==18){var s=quest_2te_rack}if(questdata[C]["questid"]==31){var s=quest_3te_rack}a+='<div class="questreward_obj">'+s+"</div>"}if(B==4){if(C==1){if(questdata[C]["questid"]==1||questdata[C]["questid"]==23){var s=quest_2te_farm}if(questdata[C]["questid"]==35){var s=quest_3te_farm}}else{if(C==2){var s=quest_unlock_4th_farm}}a+='<div class="questreward_obj">'+s+"</div>"}if(B==5){a+='<div class="questreward_obj">';a+='<div style="float:left;" class="kp'+questdata[C]["data"][2][B]+'"></div>';a+='<div style="float:left;">&nbsp;'+produkt_name[questdata[C]["data"][2][B]]+"</div>";a+='<div style="clear:both;"></div>';a+="</div>"}if(B==6){a+='<div class="questreward_obj">';a+='<div style="float:left;"><img src="'+imgpath+"farmhouse/thumbs/"+questdata[C]["data"][2][B]+'.jpg"></div>';a+='<div style="float:left; margin-top:12px;">&nbsp;'+quest_reward_6+"</div>";a+='<div style="clear:both;"></div>';a+="</div>"}if(B==7){a+='<div class="questreward_obj">';a+='<div style="float:left;" class="kp'+questdata[C]["data"][2][B]+'"></div>';a+='<div style="float:left;">&nbsp;'+str_replace("%PRODUCT%",produkt_name[questdata[C]["data"][2][B]],quest_unlock_product)+"</div>";a+='<div style="clear:both;"></div>';a+="</div>"}if(B==8){a+='<div class="questreward_obj">'+str_replace("%POSITION%",questdata[C]["data"][2][B][1],quest_unlock_position)+"</div>"}if(B==9){a+='<div class="questreward_obj">'+decorack_unlock+"</div>"}if(B==10){a+='<div class="questreward_obj">'+t_quest_reward_building.replace("%NAME%",buildinginfos[0][questdata[C]["data"][2][B]][10])+"</div>"}}}if(C>=3&&questdata[C].farmunlocks){var n=(C+2);if(C>=5){n=(C+3)}if(questdata[C].farmunlocks[n]){for(var h in questdata[C].farmunlocks[n]){if(!questdata[C].farmunlocks[n][h][3]||questdata[C].farmunlocks[n][h][3][0]!=C||questdata[C].farmunlocks[n][h][3][1]!=questdata[C].questid){continue}a+='<div class="questreward_obj">'+t_help_new_quests_unlock_farm_position.replace("%FARM%",n).replace("%POSITION%",h)+"</div>"}}}if(questdata[C]["data"][10]){a+='<div class="questreward_obj">';a+='<div style="float:left;" class="kp'+questdata[C]["data"][10][0]+'"></div>';a+='<div style="float:left;">&nbsp;'+formatTime(questdata[C]["data"][10][1])+"&nbsp;"+quest_producttimebonus+"</div>";a+='<div style="clear:both;"></div>';a+="</div>"}if(questdata[C]["data"][11]){a+='<div class="questreward_obj">';var u=questdata[C]["data"][11].pid;var l=questdata[C]["data"][11].amount;a+=htmlProductBody(u,l)}if(questdata[C]["data"][9]){a+='<div class="questreward_obj">'+quest_hq_deko+"</div>"}if(questdata[C]["farmi"]){a+='<div class="questreward_obj">'+str_replace("%AMOUNT%",1,quest_addfarmi_singular)+"</div>"}$("questboxrewards_inner").innerHTML=a;showDiv("questboxtransp");showDiv("questbox")}}}function buildQuestBoxEntry(a,d){var b=parseInt($("questboxobj"+a+"_need").innerHTML);if(questdata[d]["entries"]&&questdata[d]["entries"][a]){b=(b-questdata[d]["entries"][a])}var c={pid:a};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(c),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("chkQuestBoxEntry("+a+", "+b+", "+d+")");$("dialog_entryline_number").onkeyup=new Function("chkQuestBoxEntry("+a+", "+b+", "+d+")");chkQuestBoxEntry(a,b,d)}function chkQuestBoxEntry(a,b,d){var c={stockamount:checkRackItem(a),rest:b,click:"questBoxEntry("+a+", "+d+")"};checkEntryLine(c)}function questBoxEntry(a,b){if(a&&$("dialog_entryline_number").value){amount=parseInt($("dialog_entryline_number").value);if(amount>0){questAction("insert",a,amount,0,b)}}}function closeQuestBox(){hideDiv("questbox");hideDiv("questboxtransp")}function showQuestboxInfo(){showDiv("questbox_info");showDiv("questbox_info_transp")}function closeQuestboxInfo(){hideDiv("questbox_info");hideDiv("questbox_info_transp")}function startQuestTimer(a,b){if(!qtimer[a]){if(typeof b=="function"){qtimer[a]=window.setInterval(function(){b(a)},1000)}}}function questClearTimer(a){if(qtimer[a]){window.clearInterval(qtimer[a]);qtimer[a]=0}}var racksort=1;var rackobj=new Object;var racklocks=new Object;var rackbonis={};var racktemp={};var rackfarm=1;var racksubsort="";var racksort_previous=0;var rackCache={};var racknavi_position=1;var racknavi_displayed=5;if(activate10farm==1){racknavi_displayed=4}function updateRack(b,a){if(b){racksort=b}generalAction("rackupdate",0,a)}function updateRackGo(h){rackElement=new Object;if(!farm){var d=1}else{var d=farm}for(var e in rackCache[d]){for(var b=1;b<=200;b++){if(rackCache[d][e][b]){var c=rackCache[d][e][b];setRackItem(c.pid,c.amount,d)}}}produkt_ernte_bonus={};if(rackbonis){for(var a in rackbonis){if(rackbonis[a].cropbonus){if(!produkt_ernte_bonus[a]){produkt_ernte_bonus[a]=0}produkt_ernte_bonus[a]=rackbonis[a].cropbonus}}}if($("foodworld")&&foodworld_quicknavi){createFoodworldFarmis()}sortRackNew(0,h)}function hoverRackItem(a){if(!$("lager_zeit"+a)){return 1}if(!farm){var e=rackCache[1]}else{var e=rackCache[farm]}var d=0;for(var c in e){for(var h in e[c]){if(e[c][h].pid!=a){continue}d=e[c][h]}}if(!d){return 1}var b=formatTime(d.duration);if(farms_data.weather&&farms_data.weather.today&&farms_data.weather.remain>0&&in_array(a,farms_data.weather.today.set)&&$("lager_zeit"+a)){b=formatTime(d.oldtime);b+='<br><span class="rack_cropbonus" style="font-size:10px;">'+formatTime(d.duration)+'<br><span style="font-size:10px;">(-'+farms_data.weather.constants.reduction+"%&nbsp;"+t_weather_link+")</span></span>"}$("lager_zeit"+a).innerHTML=b}function sortRackNew(ah,aa){if(ah&&ah!=racksort){racknavi_position=1}if(!ah){ah=racksort}else{racksort=ah}var n=0;var X="left";var w="left";if(setarab==1){w="right"}var J="";var D=[1,2,3,4,5,6,7,8,25,26,27,28,30,31,32,33,34,35,36,37];if(insecthotel_active==1){D=[1,2,3,4,5,6,7,8,9,25,26,27,28,30,31,32,33,34,35,36,37,38]}if(activate10farm==1){D=[1,2,3,4,5,6,7,8,9,10,25,26,27,28,30,31,32,33,34,35,36,37,38]}if(!farm){var S=rackCache[1]}else{var S=rackCache[farm]}var V={};var a={};var F=[];for(var ab=1;ab<=20;ab++){if(!S[ab]){continue}var T=S[ab];for(var ad=1;ad<=20;ad++){if(!T[ad]||!T[ad]["pid"]){continue}if(in_array(produkt_category[T[ad]["pid"]],["water","sushi"])){V[T[ad]["pid"]]=1;a[T[ad]["pid"]]=T[ad];F.push({j:ab,i:ad})}}}V=sushibar.sortProductsAppear(V);U=0;for(var ad in V){var P=ad.replace("a_","");if(a[P]){S[F[U].j][F[U].i]=a[P];U++}}if(S[ah]){if(in_array(ah,D)&&racksubsort!=""){var O=0;var M=0;var V=new Array;var C=20;if(racksubsort=="z"){C=10}for(var W=0;W<D.length;W++){var ad=D[W];for(var ab=1;ab<=20;ab++){if(S[ad]&&S[ad][ab]){var m=0;if(produkt_category[S[ad][ab]["pid"]]==racksubsort){m=1}if(racksubsort=="alpin"&&in_array(produkt_category[S[ad][ab]["pid"]],["alpin","tea"])){m=1}if(racksubsort=="water"&&in_array(produkt_category[S[ad][ab]["pid"]],["water","sushi"])){m=1}if(racksubsort=="spice"&&in_array(produkt_category[S[ad][ab]["pid"]],["spice","spicedried","spiceground"])){m=1}if(racksubsort.indexOf("fw")>-1){if(foodworld_categories[S[ad][ab]["pid"]]==parseInt(str_replace("fw","",racksubsort))){m=1}}if(m==1){O++;var v=ah;if(in_array(ah,[25,30])){v=1}if(in_array(ah,[26,31])){v=2}if(in_array(ah,[27,32])){v=3}if(in_array(ah,[28,34])){v=4}if(in_array(ah,[29,35])){v=5}var q=(((v-1)*C)+1);var ag=(v*C);if(O>=q&&O<=ag){M++;V[M]=S[ad][ab]}}}}}T=V}else{var T=S[ah]}var U=0;for(var ad=1;ad<=20;ad++){if(T[ad]&&T[ad]["pid"]){if(ad==1){n=T[ad]["pid"]}var K="sack";if(produkt_category[T[ad]["pid"]]=="z"){K="karton"}else{if(produkt_category[T[ad]["pid"]]=="e"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="o"){K="bottle"}else{if(produkt_category[T[ad]["pid"]]=="fw"){K="tupper"}else{if(produkt_category[T[ad]["pid"]]=="fl"){K="sack"}else{if(produkt_category[T[ad]["pid"]]=="fla"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="md"){K="flask"}else{if(produkt_category[T[ad]["pid"]]=="breed"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="cow"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="tea"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="fish"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="sushi"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="scouts"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="spice"){K="sack"}else{if(produkt_category[T[ad]["pid"]]=="spicedried"){K="box"}else{if(produkt_category[T[ad]["pid"]]=="spiceground"){K="spiceglass"}}}}}}}}}}}}}}}}if(T[ad]["pid"]==fuel_product){K="barrel"}if(jam_products[T[ad]["pid"]]){K="jamglass"}var R="";var A="tklein2";if(ad>16){R="rackitem_tt_bottom"}if(T[ad]["amount"]>999999){A="rackminiamount"}J+='<div id="rackitem'+T[ad]["pid"]+'" class="'+K+' link" style="position:relative; float:'+X+'; margin-right:5px; margin-bottom:24px;" onmouseover="showDiv(\'rackitem'+T[ad]["pid"]+"_tt'); hoverRackItem("+T[ad]["pid"]+')" onmouseout="hideDiv(\'rackitem'+T[ad]["pid"]+"_tt')\" ";J+='onclick="selectRackItem('+T[ad]["pid"]+')"';J+=">";J+='  <div class="e'+T[ad]["pid"]+" img_"+K+'"></div>';J+='  <div class="'+A+" counter_"+K+'">'+T[ad]["amount"]+"</div>";J+='  <div id="rackitem'+T[ad]["pid"]+'_tt" class="rackitem_tt_'+K+" "+R+'">';J+='	 <div class="headline">'+produkt_name[T[ad]["pid"]]+"</div>";J+='	 <div style="margin:-5px 0px 5px 0px;">'+t_market_new_instock+"&nbsp;"+formatNumber(T[ad]["amount"])+"</div>";if(sushibar&&sushibar.data&&sushibar.data.config&&produkt_category[T[ad]["pid"]]=="sushi"){var l=sushibar.data.config.products[T[ad]["pid"]].category;var B=sushibar.data.config.products[T[ad]["pid"]].eattime;J+='<div class="rackItems_eattime">';J+="  <div>"+t_sushibar_eattime+" "+formatTime(B)+"</div>";J+='  <div class="rackItems_category '+l+'"></div>';J+="</div>"}J+='    <div style="float:'+w+';" class="l'+T[ad]["pid"]+'"></div>';J+='    <div style="float:'+X+'">';if(T[ad]["duration"]>0&&T[ad]["pid"]!=fuel_product){produkt_zeit[T[ad]["pid"]]=T[ad]["duration"];var e=formatTime(T[ad]["duration"]);J+='<div id="lager_wachsezeit"></div>';J+='<div id="lager_ist1" class="tnormal">=</div>';J+='<div id="lager_zeit'+T[ad]["pid"]+'" class="tnormal lager_zeit">'+e+"</div>";J+='<div style="clear:both;"></div>'}if(produkt_ernte[T[ad]["pid"]]>0&&T[ad]["pid"]!=fuel_product){J+='<div id="lager_ertrag"></div>';J+='<div id="lager_ist2" class="tnormal">=</div>';J+='<div id="lager_ernte" class="tnormal">'+produkt_ernte[T[ad]["pid"]];if(T[ad]["cropbonus"]){J+='&nbsp;<span class="rack_cropbonus">+'+T[ad]["cropbonus"]+"</span>"}if(specialbonus){var N=specialbonus.findBonus({key1:"products",key2:"harvest"});if(N&&N.group==produkt_category[T[ad]["pid"]]){J+='&nbsp;<span class="rack_cropbonus">+'+N.harvest+"</span>"}}J+="</div>";J+='<div style="clear:both;"></div>'}if(T[ad]["points"]){J+='<img src="'+imgpath+'points.gif" style="float:'+w+'; height:15px; width:15px; margin:4px 0 0 5px;">';J+='<div id="lager_ist2" class="tnormal">=</div>';J+='<div id="lager_zeit" class="tnormal">'+T[ad]["points"];if(T[ad]["pointbonus"]){J+='&nbsp;<span class="rack_cropbonus">+'+T[ad]["pointbonus"]+"</span>"}if(rackbonis&&rackbonis[T[ad]["pid"]]&&rackbonis[T[ad]["pid"]].pointbonus){J+='&nbsp;<span class="rack_cropbonus">+'+rackbonis[T[ad]["pid"]].pointbonus+"</span>"}J+="</div>";J+='<div style="clear:both;"></div>'}J+="    </div>";J+='    <div style="clear:both;"></div>';var b=["e","fw","fla","md","breed","cow","fish","sushi","scouts","spicedried","spiceground"];if(!in_array(produkt_category[T[ad]["pid"]],b)&&!in_array(T[ad]["pid"],flowerarea_dropitems)){J+='  <div style="margin-top:10px;">'+t_felder+"&nbsp;"+(produkt_x[T[ad]["pid"]]*produkt_y[T[ad]["pid"]])+"</div>"}if(in_array(T[ad]["pid"],flowerarea_dropitems)){J+="<div>"+t_info_unique_flower+"</div>"}if(T[ad]["need"]){J+='<div style="margin-top:5px; margin-bottom:5px;">';J+="  <div>"+t_rack_need_products+"</div>";for(var Q=0;Q<T[ad].need.length;Q++){J+='<div style="margin-top:2px;">';if(T[ad].need[Q].trove&&t_fishing_trove_name[T[ad].need[Q].pid]){J+='  <div class="fishing_trove fishing_trove'+T[ad].need[Q].pid+'" style="float:left; margin-right:4px;"></div>';J+='  <div style="float:left; margin-right:10px;">'+T[ad].need[Q].amount+"&nbsp;"+t_fishing_trove_name[T[ad].need[Q].pid]+"</div>"}else{J+='  <div class="kp'+T[ad].need[Q].pid+'" style="float:left; margin-right:4px;"></div>';J+='  <div style="float:left; margin-right:10px;">'+T[ad].need[Q].amount+"&nbsp;"+produkt_name[T[ad].need[Q].pid]+"</div>"}J+='  <div class="clear"></div>';J+="</div>"}J+="</div>"}if(produkt_category[T[ad]["pid"]]=="fla"&&nursery_products[T[ad]["pid"]]){J+='<div style="margin-bottom:2px;">'+t_fla_lifetime+formatTime(nursery_products[T[ad]["pid"]].lifetime)+"</div>";if(nursery_products[T[ad]["pid"]].watertime>0){var t=formatTime(nursery_products[T[ad]["pid"]].watertime)}else{var t=t_none}J+='<div style="margin-bottom:2px;">'+t_fla_watertime+t+"</div>";J+="<div>"+t_fla_farmipoints+formatNumber((nursery_products[T[ad]["pid"]].farmipoints*12))+"</div>"}if(farm>=5&&(farm!=99&&farm!=100)){J+='<div style="margin-top:10px; text-decoration:underline;" class="link" onclick="openMap(); mapRackTransfer();">'+t_map_rack_transfer_info+"</div>"}else{if(!T[ad]["block"]&&premium){J+='<div style="margin-top:10px; text-decoration:underline;" class="link" onclick="openMarketFromRack('+T[ad]["pid"]+')">'+product2market+"</div>";if(in_array(produkt_category[T[ad]["pid"]],["v","fl","hr"])&&!in_array(T[ad]["pid"],flowerarea_dropitems)){J+='<div style="margin-top:10px; text-decoration:underline;" class="link" onclick="shopFillForm('+T[ad]["pid"]+')">'+t_buyshoplink+"</div>"}}if(produkt_category[T[ad]["pid"]]=="ex"){J+='<div style="margin-top:10px;" class="bonusinfo">'+str_replace("%FARM%",5,t_rack_info_only_farm)+"</div>"}if(produkt_category[T[ad]["pid"]]=="alpin"){J+='<div style="margin-top:10px;" class="bonusinfo">'+str_replace("%FARM%",6,t_rack_info_only_farm)+"</div>"}if(produkt_category[T[ad]["pid"]]=="water"){J+='<div style="margin-top:10px;" class="bonusinfo">'+str_replace("%FARM%",8,t_rack_info_only_farm)+"</div>"}if(produkt_category[T[ad]["pid"]]=="spice"){J+='<div style="margin-top:10px;" class="bonusinfo">'+str_replace("%FARM%",10,t_rack_info_only_farm)+"</div>"}}if(pepeevent_active==1&&in_array(T[ad]["pid"],eventproducts)){J+='<div class="pepeevent_rack_info">'+t_pepeevent_rack_product_info+"</div>"}J+="  </div>";J+="</div>"}U++;if(U%4==0){J+='<div style="clear:both"></div>'}}}else{hideDiv("lager_info")}var s='<div id="rack_top_navi" style="z-index:100; position:absolute; top:-65px; left:-43px; width:265px;">';var w="left:-50px;";if(setarab==1){w="right:0px;"}var c='<div id="rack_left_navi" style="z-index:100; position:absolute; top:-32px; '+w+'">';if(farm>4&&(farm!=99&&farm!=100)){var u={"1":{name:rack_normal,pages:[1,2,3,4,5,6,7]},"10":{name:rack_oil,pages:[10,11,12]}}}else{var u={"1":{name:rack_normal,pages:[1,2,3,4,5,6,7,8]},"10":{name:rack_oil,pages:[10,11,12]},"15":{name:rack_deco,pages:[15,16,17,18,19,20,21]},"25":{name:rack_foodworld,pages:[25,26,27,28]},"30":{name:rack_flower,pages:[30,31,32,33,34,35,36,37]}}}if(insecthotel_active==1){if(u[1]){u[1].pages=[1,2,3,4,5,6,7,8,9]}if(u[30]){u[30].pages=[30,31,32,33,34,35,36,37,38]}}if(activate10farm==1){if(u[1]){u[1].pages=[1,2,3,4,5,6,7,8,9,10]}if(u[10]){delete u[10];u[11]={name:rack_oil,pages:[11,12,13]}}}for(var ad in u){s+='<div id="rackcat'+ad+'" style="position:relative; width:53px; height:39px; float:'+X+';">';if(ad==1){s+='<div id="invisible_rack_info"></div>'}if(ad==30){s+='<div id="invisible_rack2_info"></div>'}s+='  <div id="rackcat'+ad+'_img">';s+='    <div id="rackcat'+ad+'_lock" class="rack_lock link" style="height:48px;"></div>';s+="  </div>";var w="left";if(setarab==1){w="right"}s+='  <div id="rackcat'+ad+'_tt" class="ttbox" style="z-index:100; display:none; position:absolute; top:40px; '+w+':25px; min-width:120px; max-width:250px;"></div>';s+="</div>";if(in_array(ah,u[ad].pages)){for(var ab=0;ab<u[ad].pages.length;ab++){var Y=(parseInt(ad)+parseInt(ab));if(ad==1||S[Y]){c+='<div id="rackswitch'+Y+'" class="rackswitch_box">';c+='  <div id="rackswitch'+Y+'_img" class="rackswitch">';c+='    <div class="counter">'+(ab+1)+"</div>";c+='    <div id="rackswitch'+Y+'_lock" class="rack_lock_page link" style="z-index:100; position:absolute; top:0px; left:0px;"></div>';c+="  </div>";c+='  <div id="rackswitch'+Y+'_tt" class="ttbox" style="z-index:100; display:none; position:absolute; bottom:50px; '+w+':0px; width:150px;"></div>';c+="</div>"}}}}c+="</div>";s+='</div><div style="clear:both;"></div>';var h="";if(in_array(ah,D)){var H=new Object;for(var W=0;W<D.length;W++){var ad=D[W];if(S[ad]){for(var ab=1;ab<=50;ab++){if(S[ad][ab]){var G=8;if(insecthotel_active==1){G=9}if(activate10farm==1){G=10}if(ah<=G){if(produkt_category[S[ad][ab]["pid"]]=="v"){H.v=1}if(produkt_category[S[ad][ab]["pid"]]=="e"){H.e=1}if(produkt_category[S[ad][ab]["pid"]]=="z"){H.z=1}if(produkt_category[S[ad][ab]["pid"]]=="hr"){H.hr=1}if(produkt_category[S[ad][ab]["pid"]]=="ex"){H.ex=1}if(in_array(produkt_category[S[ad][ab]["pid"]],["alpin","tea"])){H.alpin=1;H.tea=1}if(in_array(produkt_category[S[ad][ab]["pid"]],["water","sushi"])){H.water=1;H.sushi=1}if(in_array(produkt_category[S[ad][ab]["pid"]],["spice","spicedried","spiceground"])){H.spice=1;H.spicedried=1;H.spiceground=1}}else{if(ah>=25&&ah<=28){if(foodworld_categories[S[ad][ab]["pid"]]==1){H.fw1=1}if(foodworld_categories[S[ad][ab]["pid"]]==2){H.fw2=1}if(foodworld_categories[S[ad][ab]["pid"]]==3){H.fw3=1}if(foodworld_categories[S[ad][ab]["pid"]]==4){H.fw4=1}}else{if(produkt_category[S[ad][ab]["pid"]]=="fl"){H.fl=1}if(produkt_category[S[ad][ab]["pid"]]=="fla"){H.fla=1}if(produkt_category[S[ad][ab]["pid"]]=="md"){H.md=1}if(produkt_category[S[ad][ab]["pid"]]=="breed"){H.breed=1}if(produkt_category[S[ad][ab]["pid"]]=="cow"){H.cow=1}if(produkt_category[S[ad][ab]["pid"]]=="fish"){H.fish=1}if(produkt_category[S[ad][ab]["pid"]]=="scouts"){H.scouts=1}}}}}}}var w="left:-53px;";var E="left:50px;";if(setarab==1){w="right:-26px;";E="right:40px;"}var R="";if(rackinfos[8]){R="eightrack"}h+='<div id="rack_subnavi" style="'+w+'" class="'+R+'">';var L=0;var d=0;for(var Y in H){L++;if(!in_array(Y,["tea","sushi","spicedried","spiceground"])){d++}}if(L>1){if(d>racknavi_displayed){h+='<div id="rack_subnavi_arrow_top" class="navi_arrow top off link" onclick="rackNaviMove(-1, '+d+", '"+ah+"')\"></div>"}var q=racknavi_position;var ag=(q+(racknavi_displayed-1));var ac=0;for(var Y in H){if(in_array(Y,["tea","sushi","spicedried","spiceground"])){continue}ac++;if(ac<q||ac>ag){continue}var af=racksort_v;if(Y=="e"){af=racksort_e}if(Y=="z"){af=racksort_z}if(Y=="hr"){af=racksort_hr}if(Y=="fl"){af=racksort_fl}if(Y=="fla"){af=racksort_fla}if(Y=="breed"){af=racksort_breed}if(Y=="cow"){af=racksort_cow}if(Y=="fish"){af=racksort_fish}if(Y=="scouts"){af=racksort_scouts}if(Y=="md"){af=racksort_md}if(Y=="ex"){af=racksort_ex}if(Y=="alpin"){af=racksort_alpin}if(Y=="water"){af=racksort_water}if(Y=="spice"){af=racksort_spice}if(Y=="fw1"){af=t_foodworld_pos1}if(Y=="fw2"){af=t_foodworld_pos2}if(Y=="fw3"){af=t_foodworld_pos4}if(Y=="fw4"){af=t_foodworld_pos3}h+='<div style="position:relative;" class="racksort_'+Y;if(racksubsort==Y){h+="_active "}h+=' link" onclick="racksubsort=\''+Y+"'; sortRackNew();\" onmouseover=\"showDiv('racksort_"+Y+"_tt')\" onmouseout=\"hideDiv('racksort_"+Y+"_tt')\">";h+='  <div id="racksort_'+Y+'_tt" class="ttbox" style="z-index:100; display:none; position:absolute; top:10px; '+E+' width:150px;">'+af+"</div>";h+="</div>"}if(d>racknavi_displayed){h+='<div id="rack_subnavi_arrow_bottom" class="navi_arrow bottom link" onclick="rackNaviMove(1, '+d+", '"+ah+"')\"></div>"}}h+="</div>"}$("rackItems").innerHTML=J+s+c+h;if(d>racknavi_displayed){rackNaviMove(0,d,ah)}for(var ad in u){$("rackcat"+ad).onmouseover=new Function("showDiv('rackcat"+ad+"_tt')");$("rackcat"+ad).onmouseout=new Function("hideDiv('rackcat"+ad+"_tt')");$("rackcat"+ad+"_tt").innerHTML=u[ad].name;$("rackcat"+ad+"_img").className="link rackcat"+ad;hideDiv("rackcat"+ad+"_lock");if(in_array(ah,u[ad].pages)){$("rackcat"+ad+"_img").className="link rackcat"+ad+"_active"}if(racklocks&&racklocks[ad]){$("rackcat"+ad+"_tt").innerHTML+="<br><br>"+racklocks[ad].text;showDiv("rackcat"+ad+"_lock");if(racklocks[ad].house==1){var Z=0;if(ad==15){Z=1}$("rackcat"+ad).onclick=new Function("buyRackCommit("+ad+", "+Z+")");$("rackcat"+ad+"_img").addClassName("maketransp");$("rackcat"+ad+"_lock").removeClassName("rack_lock").addClassName("unlocked")}}else{$("rackcat"+ad).onclick=new Function("racksubsort=''; sortRackNew("+ad+");")}for(var ab=0;ab<u[ad].pages.length;ab++){var Y=(parseInt(ad)+parseInt(ab));if($("rackswitch"+Y)){hideDiv("rackswitch"+Y);if(S[Y]||in_array(ah,u[1].pages)){if(in_array(ah,u[ad].pages)){if(ah==Y){$("rackswitch"+Y+"_img").className="rackswitch_active"}if(racklocks&&racklocks[Y]){$("rackswitch"+Y).onmouseover=new Function("showDiv('rackswitch"+Y+"_tt')");$("rackswitch"+Y).onmouseout=new Function("hideDiv('rackswitch"+Y+"_tt')");$("rackswitch"+Y+"_tt").innerHTML+=racklocks[Y].text;showDiv("rackswitch"+Y+"_lock");if(racklocks[Y].house==1){$("rackswitch"+Y).onclick=new Function("buyRackCommit("+Y+", 0)");$("rackswitch"+Y+"_img").addClassName("maketransp");$("rackswitch"+Y+"_lock").removeClassName("rack_lock_page").addClassName("unlocked")}else{$("rackswitch"+Y).onclick=new Function("")}}else{$("rackswitch"+Y+"_img").addClassName("link");$("rackswitch"+Y).onclick=new Function("sortRackNew("+Y+");");hideDiv("rackswitch"+Y+"_lock")}showDiv("rackswitch"+Y)}}}}}if(!n){selectMode(-1)}else{if(selected){if(!checkRackItem(selected,farm)){selectMode(1)}}else{if(aa&&n){selectRackItem(n,1)}else{if(tutorial){selectRackItem(n)}else{hideDiv("lager_info")}}}}if(S[99]&&S[99].length>0){var J=htmlInvisibleRack(S[99],99);$("invisible_rack_info").innerHTML=J}if(S[100]&&S[100].length>0){var J=htmlInvisibleRack(S[100],100);$("invisible_rack2_info").innerHTML=J}if(!farm){var ae=1}else{var ae=farm}var I=farmname+ae;if(ae<5||ae==99||ae==100){I=t_map_stock_overview_mainstock}if($("rackBottomRackInfo")){$("rackBottomRackInfo").innerHTML=I}if(ae==5){$("lager").className="lager_ex"}else{if(ae==8){$("lager").className="lager_water"}else{$("lager").className="lager_normal"}}if(ae>4&&typeof S.length!="undefined"&&S.length==0){showDiv("lager_vehicle_info")}else{hideDiv("lager_vehicle_info")}}function rackNaviMove(b,a,c){if(b!=0){racknavi_position+=b}if(racknavi_position>(a-(racknavi_displayed-1))){racknavi_position=(a-(racknavi_displayed-1))}if(racknavi_position<=0){racknavi_position=1}if(b!=0){sortRackNew(c)}$("rack_subnavi_arrow_top").removeClassName("off");$("rack_subnavi_arrow_bottom").removeClassName("off");if(racknavi_position==1){$("rack_subnavi_arrow_top").addClassName("off")}if(racknavi_position==(a-(racknavi_displayed-1))){$("rack_subnavi_arrow_bottom").addClassName("off")}}function htmlInvisibleRack(c,e){var d="left:15px;";if(e==100){d="right:15px;"}var b='<div style="position:absolute; top:0; right:0; width:27px; height:43px; background:url('+imgpath+'stock_warning2.png);" onmouseover="showDiv(\'invisible_rack'+e+"_info_tt')\" onmouseout=\"hideDiv('invisible_rack"+e+"_info_tt')\">";b+='  <div id="invisible_rack'+e+'_info_tt" style="z-index:200; top:15px; '+d+'" class="ttbox">';b+='    <div style="margin-bottom:5px;">'+t_invisiblestock+"</div>";for(var a=0;a<c.length;a++){b+='<div style="margin-bottom:2px; width:240px;">';b+='  <div style="float:left; margin-right:5px;" class="kp'+c[a].pid+'"></div>';b+='  <div style="float:left; width:220px;">'+c[a].amount+" "+produkt_name[c[a].pid]+"</div>";b+='  <div class="clear"></div>';b+="</div>"}b+="</div>";return b}function buyRackCommit(e,d){var b=infoheadquarterbuyrack;var a=racklocks[e].text;if(racklocks[e].premium&&racklocks[e].premium==1){a+='<div style="margin:10px 0px; border-radius:5px; padding:20px; background-color:#C3A75E;">'+t_buyrack_premiuminfo+"</div>"}var c="farmAction('createnewrack', "+farm+", 0, "+d+")";globalcommitbox(b,a,c)}function openMarketFromRack(a){if(!city||city>1){mapGo2Location("city",1)}market_filter_pid=a;marketAction("marketfilter",a,1)}function selectRackItem(d,c){hideDiv("erntewasserpic");showDiv("lager_pic");$("bedientext").innerHTML=t_setzen;$("lager_pic").className="l"+d;$("lager_name").innerHTML="<b>"+produkt_name[d]+"</b>";if(!in_array(produkt_category[d],["v","ex","alpin","water","fl","hr","spice"])){hideDiv("lager_info")}else{if(produkt_category[d]!="e"){showDiv("lager_info")}$("lager_zeit").innerHTML=formatTime(produkt_zeit[d]);var a=produkt_ernte[d];if(produkt_ernte_bonus[d]){a+='&nbsp;<span class="rack_cropbonus">+'+produkt_ernte_bonus[d]+"</span>"}if(specialbonus){var b=specialbonus.findBonus({key1:"products",key2:"harvest"});if(b&&b.group==produkt_category[d]){a+='&nbsp;<span class="rack_cropbonus">+'+b.harvest+"</span>"}}$("lager_ernte").innerHTML=a}if(sushibar&&$("sushibar")&&$("sushibar").style.display=="block"&&sushibar.currentView=="bar"){sushibar.clickRackItem(d)}if(!c){mode=0;selected=d;flowerarea_modus="plant";autoplantselected=d;if(autoplantposition>0&&$("autoplantselectbox")){autoPlantCommit(autoplantposition)}if(!in_array(d,flowerarea_dropitems)){flowerarea_autoplant_select=d}if($("flowerarea_autoplantselector")){dialogFlowerArea("autoplant",1)}regal_leer=0;global_x=produkt_x[d];global_y=produkt_y[d];iKategorie=produkt_category[d];kategorie=iKategorie}}var rainbowevent=function(){this.data={}};rainbowevent.prototype.buy=function(a){rainbowevent.action("rainbowevent_buy",{coins:a})};rainbowevent.prototype.init=function(){rainbowevent.action("rainbowevent_init")};rainbowevent.prototype.action=function(a,b){ajaxAction("farm",a,b,rainbowevent.response)};rainbowevent.prototype.response=function(b,a,c){rainbowevent.data=b;rainbowevent.build();if(rainbowevent.data.login){rainbowevent.finder(rainbowevent.data.login)}};rainbowevent.prototype.build=function(){var b=0;if(this.data.data.points){b=this.data.data.points}var a="";a+='<div class="head">'+t_rainbowevent_name+"</div>";a+='<div class="flex-left">';a+='  <div class="deco"></div>';a+='  <div class="desc">'+t_rainbowevent_desc.replace("%ITEM%","<b>"+t_rainbowevent_item_name+"</b>")+"</div>";a+="</div>";a+='<div class="bar">';a+='  <div id="rainbowevent_steps" class="steps flex-center"></div>';a+='  <div class="points">';a+='    <div class="amount">'+formatNumber(b)+"</div>";if(b<this.data.config.maxpoints){a+='<div class="buy link" onclick="rainbowevent.buyCommit()" onmouseover="showDiv(\'rainbowevent_buy_tt\')" onmouseout="hideDiv(\'rainbowevent_buy_tt\')">';a+='  <div id="rainbowevent_buy_tt" class="ttbox">'+t_tinkergame_buyitem_head.replace("%NAME%",t_rainbowevent_item_name)+"</div>";a+="</div>"}a+="  </div>";a+="</div>";a+=events.buildTimeline("rainbowevent");a+='<div class="mini_close link" onclick="rainbowevent.close();"></div>';$("rainbowevent_inner").innerHTML=a;$("rainbowevent_inner").addClassName("bounce");$("rainbowevent").addClassName("flex-center-all");setTimer("rainbowevent");this.buildSteps()};rainbowevent.prototype.buildSteps=function(){var l=0;if(this.data.data.points){l=this.data.data.points}var n=this.data.config.rewards;var e="";e+='<div id="rainbowevent_steps_line" class="line flex-center">';for(var c in n){var m=0;if(parseInt(this.data.data.points)>=parseInt(n[c].points)){m=100}else{var b=0;if(n[(c-1)]){var b=parseInt(n[(c-1)].points)}var q=(parseInt(n[c].points)-b);var a=(parseInt(this.data.data.points)-b);if(a>0){m=((a*100)/q)}}e+='<div class="step">';e+='  <div class="bar_inner" style="width:'+m+'%"></div>';e+='  <div class="reward flex-center-all" onmouseover="showDiv(\'rainbowevent_reward'+c+"_tt')\" onmouseout=\"hideDiv('rainbowevent_reward"+c+"_tt')\">";var h="";if(n[c].rewards.products){e+='<div class="img product_package size'+n[c].rewards.products+'"></div>';h+="<div>"+t_productpackage_size[n[c].rewards.products]+"</div>";if(this.data.data.rewards&&this.data.data.rewards[c]&&this.data.data.rewards[c].products){h+='<div style="background-color:beige; padding:5px; margin:-4px; margin-top:5px; border-bottom-left-radius:5px; border-bottom-right-radius:5px;">';for(var d in this.data.data.rewards[c].products){h+='<div class="flex-center">'+htmlProductBody(d,this.data.data.rewards[c].products[d])+"</div>"}h+="</div>"}}if(n[c].rewards.powerup){e+='<div class="img powerup"></div>';h+="<div>"+formulas[0][n[c].rewards.powerup][5][3]+"% "+t_rainbowevent_reward_types.powerup+"</div>"}if(n[c].rewards.moneypackage){e+='<div class="img money_package size'+n[c].rewards.moneypackage+'"></div>';h+="<div>"+t_moneypackage_size[n[c].rewards.moneypackage]+"</div>";if(this.data.data.rewards&&this.data.data.rewards[c]&&this.data.data.rewards[c].money){h+=formatPrice(this.data.data.rewards[c].money)}}if(n[c].rewards.farmhouse){e+='<div class="img farmhouse" style="background-image:url('+imgpath+"farmhouse/thumbs/"+n[c].rewards.farmhouse+'.jpg);"></div>';if(h!=""){h+="<div>+</div>"}h+="<div>"+t_farmhouse_item+"</div>";h+='<div style="font-style:italic;">('+t_farmhouse_category[farmhouseitems_config[n[c].rewards.farmhouse][0]]+")</div>"}if(m>=100){e+='<div class="ready"></div>'}e+='    <div id="rainbowevent_reward'+c+'_tt" class="ttbox">'+h+"</div>";e+='    <div class="amount">'+formatNumber(n[c].points)+"</div>";e+="  </div>";e+="</div>"}e+="</div>";$("rainbowevent_steps").innerHTML=e;$("rainbowevent_steps_line").style.width="calc(var(--rainbowevent-step-width) * "+c+")"};rainbowevent.prototype.buyCommit=function(){var b=t_tinkergame_buyitem_head.replace("%NAME%",t_rainbowevent_item_name);var a=t_tinkergame_buyitem_line.replace("%NAME%",t_rainbowevent_item_name);events.buyCommit({name:"rainbowevent",buydata:this.data.config.buy,fn:"rainbowevent.buy",head:b,line:a})};rainbowevent.prototype.timer=function(){this.data.data.remain--;this.data.data.remain_exchange--;events.timerTimeline("rainbowevent")};rainbowevent.prototype.flyer=function(b){var a='<div class="img rainbowevent_collectitem"></div>';a+='<div class="amount">'+b+"x</div>";a+='<div class="clear"></div>';events.flyer({id:"rainbowevent_link",name:"rainbowevent",html:a,idle:"idle",move:"up"})};rainbowevent.prototype.finder=function(b){var a='<div id="rainbowevent_finder">';a+='  <div class="img rainbowevent_collectitem"></div>';a+='  <div class="amount">'+b+"x</div>";a+="</div>";globalcommitbox(t_cropaction_found,a,"off")};rainbowevent.prototype.close=function(){$("rainbowevent").removeClassName("flex-center-all");hideDiv("rainbowevent")};var scouts=function(){this.data={};this.currentView="map";this.currentScoutSlot=0;this.currentTask=0;this.currentTaskSlot=0;this.currentTaskScoutId=0;this.productionSlot=0;this.productionSelectionPage=1;this.productionSelectionFilter="none";this.stats_options=["points","quests","tasks","retired","cook"];this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.feedProduct=0;this.currentBookPage=1;this.tutorialStep=1;this.rewardData={};this.tmpSetup={};this.filters=[]};scouts.prototype.retireScout=function(a){scouts.action("scouts_retirescout",{scoutid:a})};scouts.prototype.increaseTaskLimit=function(){scouts.action("scouts_increase_task_limit")};scouts.prototype.speedupTask=function(a){scouts.action("scouts_speedup_task",{taskid:a})};scouts.prototype.setTutorial=function(a){scouts.action("scouts_settutorial",{type:a})};scouts.prototype.stats=function(){if($("scouts_stats_select")){if($("scouts_stats_select").value==0){return 1}scouts.stats_select=$("scouts_stats_select").value}if(scouts.stats_cache_delay[scouts.stats_select]<=0||!scouts.stats_cache[this.stats_select]){scouts.action("scouts_stats",{type:scouts.stats_select})}else{scouts.showStats(scouts.stats_select)}};scouts.prototype.questEntry=function(a){scouts.action("scouts_quest_entry",{pid:a,amount:parseInt($("dialog_entryline_number").value)})};scouts.prototype.finishTask=function(){scouts.action("scouts_finish_task",{taskid:scouts.currentTask})};scouts.prototype.startTask=function(a){data=JSON.stringify(scouts.data.tasks[this.currentTask].data);scouts.action("scouts_start_task",{taskid:this.currentTask,data:data})};scouts.prototype.shopBuy=function(a){scouts.action("scouts_shop_buy",{name:a})};scouts.prototype.feedScout=function(){if(scouts.currentTask>0){scouts.tmpSetup={};if(scouts.data.tasks[scouts.currentTask]&&scouts.data.tasks[scouts.currentTask].data){if(scouts.data.tasks[scouts.currentTask].data.scouts){for(var c in scouts.data.tasks[scouts.currentTask].data.scouts){var a=scouts.data.tasks[scouts.currentTask].data.scouts[c];if(!scouts.tmpSetup.scouts){scouts.tmpSetup.scouts={}}scouts.tmpSetup.scouts[c]=a}}if(scouts.data.tasks[scouts.currentTask].data.itemid){scouts.tmpSetup.itemid=scouts.data.tasks[scouts.currentTask].data.itemid}}}var b=0;if($("scouts_feed_amount")){b=$("scouts_feed_amount").value}if(b<=0){return 1}scouts.action("scouts_feedscout",{pid:scouts.feedProduct,amount:b,slot:scouts.currentScoutSlot})};scouts.prototype.addSkill=function(a){scouts.action("scouts_addskill",{skill:a,slot:scouts.currentScoutSlot})};scouts.prototype.denyScout=function(a){scouts.action("scouts_denyscout",{id:a})};scouts.prototype.acceptScout=function(a){scouts.action("scouts_acceptscout",{slot:scouts.currentScoutSlot,id:a})};scouts.prototype.rerollScout=function(a){scouts.action("scouts_rerollscout",{id:a})};scouts.prototype.buyScoutSlot=function(a){scouts.action("scouts_buyscoutslot",{slot:a})};scouts.prototype.startProduction=function(a){scouts.action("scouts_startproduction",{slot:scouts.productionSlot,pid:a})};scouts.prototype.speedupProduction=function(b,a){scouts.action("scouts_speedupproduction",{slot:b,coins:a})};scouts.prototype.harvestProduction=function(b,a){scouts.action("scouts_harvestproduction",{slot:b,position:a})};scouts.prototype.buyProductionSlot=function(a){scouts.action("scouts_buyproductionslot",{slot:a})};scouts.prototype.buyAddLevel=function(){scouts.action("scouts_buy_add_level")};scouts.prototype.addLevel=function(){scouts.action("scouts_add_level",{amount:$("scouts_dialog_leveladd_insert").value})};scouts.prototype.buyPharmacist=function(){scouts.action("scouts_buypharmacist")};scouts.prototype.rememberPharmacist=function(){scouts.action("scouts_rememberpharmacist")};scouts.prototype.init=function(){scouts.action("scouts_init")};scouts.prototype.action=function(a,b){ajaxAction("farm",a,b,scouts.response)};scouts.prototype.response=function(d,c,b){if(in_array(c,["scouts_speedupproduction"])){global_speedup_block=0}if(in_array(c,["scouts_rememberpharmacist","scouts_settutorial"])){return 1}if(in_array(c,["scouts_quest_entry"])){scouts.showQuest()}if(in_array(c,["scouts_start_task"])){scouts.currentTask=0}if(in_array(c,["scouts_shop_buy"])&&scouts.currentTask>0&&scouts.currentTaskSlot>0&&scouts.currentTaskScoutId>0&&scouts.data.tasks[scouts.currentTask]){if(!scouts.data.tasks[scouts.currentTask].data){scouts.data.tasks[scouts.currentTask].data={}}if(!scouts.data.tasks[scouts.currentTask].data.scouts){scouts.data.tasks[scouts.currentTask].data.scouts={}}scouts.data.tasks[scouts.currentTask].data.scouts[scouts.currentTaskSlot]=scouts.currentTaskScoutId}scouts.build();if(in_array(c,["scouts_startproduction","scouts_speedupproduction","scouts_harvestproduction","scouts_buyproductionslot","scouts_buypharmacist"])){scouts.setView("production")}if(in_array(c,["scouts_rerollscout","scouts_denyscout"])){scouts.buildScoutsList()}if(in_array(c,["scouts_addskill"])){scouts.scoutInfo(scouts.currentScoutSlot)}if(in_array(c,["scouts_shop_buy"])){scouts.buildShop()}if(d.stats){scouts.stats_cache_delay[scouts.stats_select]=30;if(!scouts.stats_cache[scouts.stats_select]){scouts.stats_cache[scouts.stats_select]={}}scouts.stats_cache[scouts.stats_select]=d.stats;scouts.showStats()}if(in_array(c,["scouts_feedscout"])&&scouts.currentTask>0){if(scouts.tmpSetup){if(scouts.tmpSetup.scouts){for(var l in scouts.tmpSetup.scouts){var m=scouts.tmpSetup.scouts[l];if(!scouts.data.tasks[scouts.currentTask].data){scouts.data.tasks[scouts.currentTask].data={}}if(!scouts.data.tasks[scouts.currentTask].data.scouts){scouts.data.tasks[scouts.currentTask].data.scouts={}}scouts.data.tasks[scouts.currentTask].data.scouts[l]=m}}if(scouts.tmpSetup.itemid){scouts.data.tasks[scouts.currentTask].data.itemid=scouts.tmpSetup.itemid}}scouts.openTaskInfo(scouts.currentTask)}if(c=="scouts_finish_task"&&d.reward){scouts.rewardData=d;scouts.showReward()}if(c=="scouts_retirescout"){for(var a in scouts.data.config.retire_reward.powerup){var h=windmillarray[a][5][3]}var e='<div id="scouts_reward" style="width:300px;">';e+='  <div style="font-weight:bold;">'+t_scouts_retired_reward_body+"</div>";e+='  <div style="margin-top:5px;">'+h+"%&nbsp;"+t_pointsboost_unit+"</div>";e+='  <div style="margin-top:5px;">'+scouts.data.config.retire_reward.popularity+"&nbsp;"+t_scouts_popularity+"</div>";e+='  <div class="button_yes link" style="margin-top:20px; margin-bottom:auto;" onclick="hideDiv(\'globalbox\'); hideDiv(\'globaltransp\');"></div>';e+="</div>";var n="";globalBoxFlex(t_scouts_retired_reward_head,e,0,0,1)}if(c=="scouts_acceptscout"&&scouts.data.data.stats&&scouts.data.data.stats.scouts_accepted==1){if(!scouts.data.data.tutorial||!scouts.data.data.tutorial.start){scouts.closeTutorial();scouts.setTutorialStep("start")}scouts.showTutorial("newscout")}if(c=="scouts_start_task"&&scouts.data.data.stats&&scouts.data.data.stats.tasks_started==1){scouts.showTutorial("started")}};scouts.prototype.showReward=function(){var l="hideDiv('globalbox'); hideDiv('globaltransp'); scouts.showFound()";var d='<div id="scouts_reward">';d+='<div class="scouts_badge '+this.rewardData.reward.skill+'"></div>';d+='<div style="margin:10px; font-weight:bold;">'+t_scouts_reward_success+"</div>";d+='<div class="rewards">';d+='  <div class="line" style="font-weight:bold;">'+t_farmersmarket_rewards+"</div>";if(this.rewardData.reward.scoutspoints){d+='<div class="line">'+formatNumber(this.rewardData.reward.scoutspoints)+" "+t_scouts_points;if(this.rewardData.reward.scoutspoints_bonus&&this.rewardData.reward.scoutspoints_bonus!=1){var h=Math.round((this.rewardData.reward.scoutspoints_bonus-1)*100);d+='&nbsp;<span class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",h)+")</span>"}d+="</div>"}if(this.rewardData.reward.points){d+='<div class="line">'+formatNumber(this.rewardData.reward.points)+" "+t_points;if(this.rewardData.reward.points_bonus&&this.rewardData.reward.points_bonus!=1){var h=Math.round((this.rewardData.reward.points_bonus-1)*100);d+='&nbsp;<span class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",h)+")</span>"}d+="</div>"}if(this.rewardData.reward.money){d+='<div class="line">'+formatPrice(this.rewardData.reward.money);if(this.rewardData.reward.money_bonus&&this.rewardData.reward.money_bonus!=1){var h=Math.round((this.rewardData.reward.money_bonus-1)*100);d+='&nbsp;<span class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",h)+")</span>"}d+="</div>"}if(this.rewardData.reward.popularity){d+='<div class="line">'+formatNumber(this.rewardData.reward.popularity)+" "+t_scouts_popularity;if(this.rewardData.reward.popularity_bonus&&this.rewardData.reward.popularity_bonus!=1){var h=Math.round((this.rewardData.reward.popularity_bonus-1)*100);d+='&nbsp;<span class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",h)+")</span>"}d+="</div>"}if(this.rewardData.reward.scouts){var c=0;for(var b in this.rewardData.reward.scouts){c++}var e=1;d+='<div class="scouts">';for(var b in this.rewardData.reward.scouts){var a=this.data.scouts[b];d+='<div class="scout" onmouseover="showDiv(\'scouts_reward_scout'+a.id+"_tt')\" onmouseout=\"hideDiv('scouts_reward_scout"+a.id+"_tt')\">";d+='  <div class="img">'+this.buildScoutImg(a.img)+"</div>";d+='  <div class="line name">'+a.name+"</div>";d+='  <div class="line">+'+formatNumber(this.rewardData.reward.scouts[b].xp)+" "+t_scouts_xp;if(this.rewardData.reward.scouts[b].xp_bonus&&this.rewardData.reward.scouts[b].xp_bonus!=1){var h=Math.round((this.rewardData.reward.scouts[b].xp_bonus-1)*100);d+='<br><span class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",h)+")</span>"}d+="  </div>";d+='  <div class="line">+'+formatNumber(this.rewardData.reward.scouts[b].skillxp)+" "+t_scouts_skillxp;if(this.rewardData.reward.scouts[b].skillxp_bonus&&this.rewardData.reward.scouts[b].skillxp_bonus!=1){var h=Math.round((this.rewardData.reward.scouts[b].skillxp_bonus-1)*100);d+='<br><span class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",h)+")</span>"}d+="  </div>";d+='  <div class="level">'+a.level+"</div>";if(e==c){d+='<div class="bubble">'+t_scouts_scoutlist_shout["success"+getRandom(1,4)]+"</div>"}d+='  <div id="scouts_reward_scout'+a.id+'_tt" class="ttbox">'+this.scoutsTT(a.id)+"</div>";d+="</div>";e++}d+='  <div class="clear"></div>';d+="</div>"}d+="  </div>";d+='  <div class="button_yes link" onclick="'+l+'"></div>';d+="</div>";globalBoxFlex("",d,0,l,1);$("globalbox").style.top="60px"};scouts.prototype.showFound=function(){if(!this.rewardData.reward.found){scouts.showDestroyed();return 1}var a='<div id="scouts_commit" class="found">';a+='  <div class="name">'+t_scouts_reward_found_head+"</div>";a+='  <div style="margin:10px 0px;">'+t_scouts_reward_found_body+"</div>";a+='  <div class="img scouts_animal_'+this.rewardData.reward.found+'"></div>';a+='  <div class="name">'+this.data.config.animals[this.rewardData.reward.found].name+"</div>";a+="</div>";var b="hideDiv('globalbox'); hideDiv('globaltransp'); scouts.showDestroyed();";globalcommitbox("",a,b,b);hideDiv("globalbox_button2")};scouts.prototype.showDestroyed=function(){var b=this.rewardData.destroyed;if(!b){this.showNewScout();return 1}var a='<div id="scouts_commit" class="destroyed">';a+="  <div>"+t_fishing_expired_head+"</div>";a+='  <div class="img scouts_item_'+b+'"></div>';a+='  <div class="name">'+this.data.config.items[b].name+"</div>";a+="</div>";var c="hideDiv('globalbox'); hideDiv('globaltransp'); scouts.showNewScout();";globalcommitbox("",a,c,c);hideDiv("globalbox_button2")};scouts.prototype.showNewScout=function(){if(!this.rewardData.reward.newscout){this.finishReward();return 1}var a=this.data.scouts[this.rewardData.reward.newscout];var b='<div id="scouts_commit" class="newscout">';b+="  <div>"+t_scouts_new_scout_arrived+"</div>";b+='  <div class="img">'+this.buildScoutImg(a.img)+"</div>";b+='  <div class="name">'+a.name+"</div>";b+="</div>";var c="hideDiv('globalbox'); hideDiv('globaltransp'); scouts.finishReward();";globalcommitbox("",b,c);hideDiv("globalbox_button2")};scouts.prototype.finishReward=function(){if(!this.data.data.stats||!this.data.data.stats.tasks_finished||parseInt(this.data.data.stats.tasks_finished)!=1){return 1}this.showTutorial("finished")};scouts.prototype.build=function(){if(!this.data.config){return 0}var a='<div id="scouts">';a+='  <div id="scouts_view" class="view map">';a+='    <div id="scouts_map" class="map"></div>';a+='    <div id="scouts_production" class="production"></div>';a+="  </div>";a+='  <div id="scouts_book"></div>';a+=htmlLevelBar("scouts");a+=htmlCountBar("scouts");a+='  <div class="shop_link link" onclick="scouts.buildShop()" onmouseover="showDiv(\'scouts_shop_link_tt\')" onmouseout="hideDiv(\'scouts_shop_link_tt\')">';a+='    <div id="scouts_shop_link_tt" class="ttbox">'+t_scouts_shop_name+"</div>";a+="  </div>";a+='  <div class="newtask_timer" onmouseover="showDiv(\'scouts_newtasks_timer_tt\')" onmouseout="hideDiv(\'scouts_newtasks_timer_tt\')">';a+='    <div id="scouts_newtasks_timer"></div>';a+='    <div class="tasklimit_link link" onclick="scouts.increaseTaskLimitCommit()" onmouseover="showDiv(\'tasklimit_link_tt\')" onmouseout="hideDiv(\'tasklimit_link_tt\')">';a+='      <div id="tasklimit_link_tt" class="ttbox">'+t_scouts_increase_task_limit_head+"</div>";a+="    </div>";a+='    <div class="ttbox" id="scouts_newtasks_timer_tt">'+t_scouts_newtasks_timer+"</div>";a+="  </div>";a+='  <div id="scouts_quests_link" class="link" onclick="scouts.showQuest()"></div>';a+='  <div id="scouts_stats_link" class="link" onclick="scouts.stats()"></div>';a+='  <div id="scouts_book_link" class="link" onclick="scouts.buildBook()" onmouseover="showDiv(\'scouts_book_link_tt\')" onmouseout="hideDiv(\'scouts_book_link_tt\')">';a+='    <div id="scouts_book_link_tt" class="ttbox">'+t_scouts_book_name+"</div>";a+="  </div>";a+='  <div id="scouts_tutorial_char" class="tutorial_char">';a+='    <div id="scouts_tutorial_char_img" class="char"></div>';a+='    <div id="scouts_tutorial_char_bubble" class="bubble"></div>';a+="  </div>";a+='  <div id="scouts_tutorial" class="tutorial">';a+='    <div class="transp"></div>';a+='    <div id="scouts_tutorial_npc" class="npc">';a+='      <div class="img"></div>';a+='      <div id="scouts_tutorial_bubble" class="bubble"></div>';a+="    </div>";a+="  </div>";a+='  <div class="mini_close link" onclick="scouts.close()"></div>';a+='  <div class="help helpbutton_blue link" onclick="scouts.help()"></div>';a+="</div>";$("farmersmarket_pos11_inner").innerHTML=a;showDiv("transp");showDiv("farmersmarket_pos11_inner");this.buildMap();this.buildProduction();$("scouts_levelbar_number").innerHTML=this.data.data.level;$("scouts_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var b=t_reached_maxlevel;hideDiv("scouts_levelbar_plus")}else{var b=t_scouts_level_line.replace("%AMOUNT%",this.data.data.level_rest).replace("%NAME%",t_scouts_points);$("scouts_levelbar_plus").onclick=new Function("scouts.addLevelCommit()");$("scouts_levelbar_plus_tt").innerHTML=t_scouts_leveladd_tt.replace("%NAME%",t_scouts_points)}b+='<div style="margin-top:10px;">'+t_scouts_level_tasks.replace("%COUNT%",this.data.config.levels[this.data.data.level].tasks)+"</div>";$("scouts_levelbar_tt").innerHTML=b;$("scouts_countbar_inner").innerHTML='<div class="scouts_points"></div><div>'+formatNumber(this.data.data.count)+"</div><br>";$("scouts_countbar_plus_tt").innerHTML=t_scouts_levelitem_buy.replace("%NAME%",t_scouts_points);$("scouts_countbar_plus").onclick=new Function("scouts.buyAddLevelCommit()");this.setView(this.currentView);this.timerUpdate();if(this.data.data.queue&&this.data.data.queue.start&&this.data.data.queue_remain<0&&this.data.data.queue_remember){this.buyPharmacistCommit(1)}if(!scouts.data.data.stats||!scouts.data.data.stats.scouts_accepted){this.showTutorial("start")}};scouts.prototype.setView=function(a){this.currentView=a;$("scouts_view").className="view "+a;if(a=="production"&&(!this.data.data.tutorial||!this.data.data.tutorial.production)){this.showTutorial("production")}};scouts.prototype.addLevelCommit=function(){var b=t_scouts_dialog_leveladd_head.replace("%NAME%",t_scouts_points);var a=htmlLevelAddDialog("scouts");globalcommitbox(b,a,0,0,1);$("scouts_dialog_leveladd_insert").focus()};scouts.prototype.addLevelCheck=function(){var a=$("scouts_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>scouts.data.data.count){a=scouts.data.data.count}$("scouts_dialog_leveladd_insert").value=a};scouts.prototype.buyAddLevelCommit=function(c){var d=t_scouts_levelitem_buy.replace("%NAME%",t_scouts_points);var b=t_scouts_levelitem_buy_dialog.replace("%COINS%",scouts.data.data.exchangecoins).replace("%AMOUNT%",scouts.data.data.exchangeamount).replace("%NAME%",t_scouts_points);if(!c){var a='<div class="link coinsbutton_flex" onclick="scouts.buyAddLevelCommit(1)" style="width:350px;">'+b+"</div>";globalcommitbox(d,a,0,0,1)}else{var a='<div style="width:350px;">'+b+"</div>";var e="scouts.buyAddLevel()";globalcommitbox(d,a,e)}};scouts.prototype.increaseTaskLimitCommit=function(){var a=this.data.data.task_limit_coins;var b='<div id="scouts_commit">'+t_scouts_increase_task_limit_body.replace("%COUNT%",1).replace("%COINS%",a)+"</div>";var c="scouts.increaseTaskLimit();";globalcommitbox(t_scouts_increase_task_limit_head,b,c)};scouts.prototype.buildMap=function(){var a="";a+='<div id="scouts_tasks" class="tasks"></div>';var b=(this.data.config.constants.new_scout_points-(this.data.data.popularity%this.data.config.constants.new_scout_points));var c=100-((b*100)/this.data.config.constants.new_scout_points);a+='<div id="scouts_popularitymeter" class="popularitymeter">';a+='  <div class="bar" onmouseover="showDiv(\'popularitymeter_tt\')" onmouseout="hideDiv(\'popularitymeter_tt\')">';a+='    <div class="inner" style="height:'+c+'%"></div>';a+="  </div>";a+='  <div id="popularitymeter_tt" class="ttbox meter">';a+='    <div class="name">'+t_scouts_popularity_meter_name+"</div>";a+='    <div class="desc">'+t_scouts_popularity_meter_desc.replace("%COUNT%",formatNumber(b))+"</div>";a+="  </div>";a+='  <div class="list" onclick="scouts.buildScoutsList(-1)" onmouseover="showDiv(\'popularitymeter_list_tt\')" onmouseout="hideDiv(\'popularitymeter_list_tt\')">';a+='    <div id="popularitymeter_list_tt" class="ttbox">'+t_scouts_scoutslist_head+"</div>";a+="  </div>";a+="</div>";a+='<div id="scouts_scoutslots" class="slots"></div>';a+='<div id="scouts_scoutinfo">';a+='  <div class="transp"></div>';a+='  <div class="boxit">';a+='    <div class="globalbox_scale globalbox_scale_t">';a+='      <div class="globalbox_scale globalbox_scale_l">';a+='        <div class="globalbox_scale globalbox_scale_r">';a+='          <div class="globalbox_scale globalbox_scale_b">';a+='            <div id="scouts_scoutinfo_main" class="main"></div>';a+="          </div>";a+="        </div>";a+="      </div>";a+="    </div>";a+='    <div class="globalbox_edge globalbox_edge_tl"></div>';a+='    <div class="globalbox_edge globalbox_edge_tr"></div>';a+='    <div class="globalbox_edge globalbox_edge_bl"></div>';a+='    <div class="globalbox_edge globalbox_edge_br"></div>';a+="  </div>";a+="</div>";a+='<div id="scouts_taskinfo">';a+='  <div class="transp"></div>';a+='  <div class="boxit">';a+='    <div class="globalbox_scale globalbox_scale_t">';a+='      <div class="globalbox_scale globalbox_scale_l">';a+='        <div class="globalbox_scale globalbox_scale_r">';a+='          <div class="globalbox_scale globalbox_scale_b">';a+='            <div id="scouts_taskinfo_main" class="main"></div>';a+="          </div>";a+="        </div>";a+="      </div>";a+="    </div>";a+='    <div class="globalbox_edge globalbox_edge_tl"></div>';a+='    <div class="globalbox_edge globalbox_edge_tr"></div>';a+='    <div class="globalbox_edge globalbox_edge_bl"></div>';a+='    <div class="globalbox_edge globalbox_edge_br"></div>';a+="  </div>";a+="</div>";a+='<div class="scroller right link" onclick="scouts.setView(\'production\')" onmouseover="showDiv(\'scouts_scroller_map_tt\')" onmouseout="hideDiv(\'scouts_scroller_map_tt\')">';a+='  <div id="scouts_scroller_map_tt" class="ttbox">'+t_scouts_goto_production+"</div>";a+="</div>";$("scouts_map").innerHTML=a;this.buildTasks();this.buildScoutSlots()};scouts.prototype.buildTasks=function(){var m={};for(var l in this.data.tasks){m[this.data.tasks[l].pos]=l}var d="";for(i=1;i<=this.data.config.constants.tasks_pos;i++){var a="empty";var c="";if(in_array((i%6),[0,5])){c="right"}if(i>=19){c+=" bottom"}var h="";if(m[i]){h="scouts.openTaskInfo("+m[i]+", 1)";a=""}d+='<div id="scouts_task'+i+'" class="task '+a+' link" onclick="'+h+'" onmouseover="scouts.hoverTask('+i+', 1)" onmouseout="scouts.hoverTask('+i+', 0)">';if(m[i]){var b=this.data.tasks[m[i]];d+='<div class="img scouts_badge '+this.data.tasks[m[i]].type+'"></div>';d+='<div id="scouts_tasks_task'+i+'_tt" class="ttbox '+c+'">';d+='  <div class="name">'+t_scouts_skill_name[b.type]+"</div>";d+='  <div class="line"><div class="col1">'+t_scouts_task_info_scouts+'</div><div class="col2">'+b.scouts+'</div><div class="clear"></div></div>';if(b.type=="charity"){for(var e in b.need){}d+='<div class="line"><div class="col1">'+t_scouts_task_info_product+'</div><div class="col2">'+b.need[e]+"x "+t_scouts_product_category[e]+'</div><div class="clear"></div></div>'}else{d+='<div class="line"><div class="col1">'+t_scouts_task_info_item+'</div><div class="col2">1</div><div class="clear"></div></div>'}d+='  <div class="line"><div class="col1">'+t_scouts_task_info_energy+'</div><div class="col2">'+b.energy+'</div><div class="clear"></div></div>';d+='  <div class="line"><div class="col1">'+t_scouts_task_info_duration+'</div><div class="col2">'+formatTime(b.duration)+'</div><div class="clear"></div></div>';d+="</div>"}d+='  <div id="scouts_task'+m[i]+'_timer" class="timer"></div>';if(m[i]){d+='<div id="scouts_task'+m[i]+'_speedup" class="speedup speedupgardenbutton link" onclick="scouts.speedupTaskCommit('+b.id+')"></div>'}d+='  <div id="scouts_task'+m[i]+'_ready" class="ready"></div>';d+="</div>"}d+='<div class="clear"></div>';$("scouts_tasks").innerHTML=d;for(var l in this.data.tasks){if(!$("scouts_task"+l+"_speedup")){continue}$("scouts_task"+l+"_speedup").observe("click",function(n){n.preventDefault();n.stopPropagation();return 1})}};scouts.prototype.hoverTask=function(b,a){if(a==1){showDiv("scouts_tasks_task"+b+"_tt");$("scouts_task"+b).addClassName("hover")}else{hideDiv("scouts_tasks_task"+b+"_tt");$("scouts_task"+b).removeClassName("hover")}};scouts.prototype.openTaskInfo=function(v,B){if(v){this.currentTask=v}if(this.currentTask<=0){return 1}if(B){this.taskSetup={}}this.currentView="map";var F=this.data.tasks[this.currentTask];if(!F){return 1}var t=0;var s=0;var d=0;var n="";n+='<div class="img_badge scouts_badge '+F.type+'"></div>';n+='<div style="background-color:#C3A75E; border-top-left-radius:5px; border-top-right-radius:5px;">';n+='  <div class="energy">';n+='    <div class="desc">'+t_scouts_task_overview_energy+"</div>";n+='    <div class="symbol"></div>';n+='    <div class="amount">'+F.energy+"</div>";n+="  </div>";n+="</div>";n+='<div style="background-color:#dabe74; border-bottom-left-radius:5px; border-bottom-right-radius:5px;">';n+='  <div class="scouts">';n+='    <div class="desc">'+t_scouts_task_overview_scouts+"</div>";n+='    <div class="flexit">';var h=1;for(var D=1;D<=F.scouts;D++){var E=F.energy;var z=1;var b=t_scouts_task_overview_click_scout;if(F.data&&F.data.scouts&&F.data.scouts[D]){var m=this.data.scouts[F.data.scouts[D]];if(m.traits.buff.skill==F.type){if(m.traits.buff.type=="energy"){z+=m.traits.buff.amount}if(m.traits.buff.type=="duration"){h+=m.traits.buff.amount}}if(m.traits.debuff.skill==F.type){if(m.traits.debuff.type=="energy"){z+=m.traits.debuff.amount}if(m.traits.debuff.type=="duration"){h+=m.traits.debuff.amount}}}E=Math.ceil(E*z);var w="scouts.hoverTaskScouts("+D+")";if(F.startdate>0){w=""}n+='<div class="slot link" onclick="'+w+'" onmouseover="showDiv(\'scouts_task'+this.currentTask+"_scout_"+D+"_tt')\" onmouseout=\"hideDiv('scouts_task"+this.currentTask+"_scout_"+D+"_tt')\">";if(F.data&&F.data.scouts&&F.data.scouts[D]){var C=this.data.config.scout_levels[m.level].energy;var c=((m.energy*100)/C);var l=(((m.energy-E)*100)/C);n+='<div class="img">'+this.buildScoutImg(m.img)+"</div>";n+='<div class="level">'+m.level+"</div>";n+='<div class="energybar">';if(F.startdate==0){n+='  <div class="inner" style="width:'+c+'%"></div>'}n+='<div class="inner2" style="width:'+l+'%"></div>';n+="</div>";n+='<div class="name">'+m.name+"</div>";if(F.startdate==0){n+='<div class="energy">';n+='    <div class="symbol"></div>';var G="";if(E>m.energy){G="important";t++}n+='    <div class="amount '+G+'">-'+E+"</div>";n+="</div>"}b=scouts.scoutsTT(m.id)}else{t++;n+='<div class="drawplus"></div>'}n+='  <div id="scouts_task'+this.currentTask+"_scout_"+D+'_tt" class="ttbox">'+b+"</div>";n+="</div>"}n+="    </div>";n+="  </div>";w="scouts.clickTaskSupportSlot()";if(F.startdate>0){w=""}var u="";var b=t_scouts_task_overview_click_item;var e="";var r=t_scouts_task_overview_item;if(F.type=="charity"){r=t_scouts_task_overview_pid}n+='  <div class="support">';n+='    <div class="desc">'+r+"</div>";n+='    <div id="scouts_task'+this.currentTask+'_selection" class="selection"></div>';n+='    <div class="slot link right" onclick="'+w+'" onmouseover="showDiv(\'scouts_task'+this.currentTask+"_support_tt')\" onmouseout=\"hideDiv('scouts_task"+this.currentTask+"_support_tt')\">";if(F.type=="charity"){b=t_scouts_task_overview_click_pid;if(F.data&&F.data.pid){n+='<div class="img supportimg scouts_item'+F.data.pid+'"></div>';for(var A in F.need){n+='<div class="amount">'+F.need[A]+"x</div>"}b=produkt_name[F.data.pid]}else{for(var A in F.need){n+='<div class="scouts_category '+A+'"></div>';n+='<div class="amount">'+F.need[A]+"x</div>"}e="empty";d++}}else{if(F.data&&F.data.itemid){b=this.itemTT(this.data.items[F.data.itemid].type,F.data.itemid);n+='<div class="img supportimg scouts_item_'+this.data.items[F.data.itemid].type+'"></div>'}else{s++;n+='<div class="drawplus"></div>';e="empty"}}n+='      <div id="scouts_task'+this.currentTask+'_support_tt" class="ttbox '+e+'">'+b+"</div>";n+="    </div>";n+="  </div>";n+='  <div class="clear"></div>';n+="</div>";n+='<div class="footer">';e="";var w="scouts.startTask()";if(t>0||s>0||d>0){e="off";w=""}if(F.startdate==0){var u="";var a=Math.round(F.duration*h);if(h!=1){var q="color:green";if(h>1){q="color:red"}u=' <span style="font-weight:bold; '+q+'">('+t_incl+" "+Math.round((h-1)*100)+"%)</span>"}if(this.data.config.constants.tutorial_task_time>0&&(!this.data.data.stats||!this.data.data.stats.tasks_started)){a=this.data.config.constants.tutorial_task_time;u=""}n+="<div><b>"+t_scouts_task_info_duration+"</b>:&nbsp;"+formatTime(a)+u+"</div>";if(t>0){n+='<div class="failed">'+t_scouts_task_overview_failed_scout+"</div>"}if(s>0){n+='<div class="failed">'+t_scouts_task_overview_failed_item+"</div>"}if(d>0){n+='<div class="failed">'+t_scouts_task_overview_failed_pid+"</div>"}n+='<button class="button_new link '+e+'" onclick="'+w+'">'+t_scouts_task_start_button+"</button>"}else{if(F.remain<=0){n+='<button class="button_new link" onclick="scouts.finishTask()">'+t_scouts_task_finish_button+"</button>"}else{n+="<div><b>"+t_map_stall_booster_resttime+'</b>&nbsp;<span id="scouts_taskinfo'+this.currentTask+'_timer"></span></div>';n+='<div id="scouts_taskinfo'+this.currentTask+'_speedup" class="coinsbutton_flex link" onclick="scouts.speedupTaskCommit()" style="margin-top:5px;"></div>'}}n+="</div>";n+='<div class="mini_close link" onclick="scouts.closeTaskInfo()"></div>';n+='<div id="scouts_taskinfo_scroller_left" class="scroller left link" onclick="scouts.taskInfoNavi(-1)"></div>';n+='<div id="scouts_taskinfo_scroller_right" class="scroller right link" onclick="scouts.taskInfoNavi(1)"></div>';$("scouts_taskinfo_main").innerHTML=n;showDiv("scouts_taskinfo");this.taskInfoNavi(0)};scouts.prototype.taskInfoNavi=function(a){var d=0;var b=0;var c=0;for(var e in this.data.tasks){c++;if(e<this.currentTask){d=e}if(!b&&e>this.currentTask){b=e}}hideDiv("scouts_taskinfo_scroller_left");hideDiv("scouts_taskinfo_scroller_right");if(c>1&&d>0){showDiv("scouts_taskinfo_scroller_left")}if(c>1&&b>0){showDiv("scouts_taskinfo_scroller_right")}if(a!=0){e=0;if(a<0&&d>0){e=d}if(a>0&&b>0){e=b}if(e>0){this.closeTaskInfo();this.openTaskInfo(e,1)}}};scouts.prototype.hoverTaskScouts=function(l){var b=this.data.tasks[this.currentTask];var h=[];if(b.data&&b.data.scouts){for(var c in b.data.scouts){h.push(parseInt(b.data.scouts[c]))}}var e=0;for(var c in this.data.config.scout_slots){if(!this.data.data.scout_slots[c].scoutid){continue}if(in_array(parseInt(this.data.data.scout_slots[c].scoutid),h)){continue}var a=this.data.scouts[this.data.data.scout_slots[c].scoutid];var d="";if(parseInt(a.taskid)==0&&a.skills[b.type]){d="scouts.clickTaskScout("+l+", "+a.id+")";if(parseInt(a.energy)<parseInt(b.energy)){$("scouts_scoutslot"+c+"_energy_inner").addClassName("failed");$("scouts_scoutslot"+c+"_bubble").innerHTML=t_scouts_scout_less_energy;showDiv("scouts_scoutslot"+c+"_bubble");d="scouts.currentScoutSlot="+c+"; scouts.feedScoutCommit()"}$("scouts_scoutslot"+c).addClassName("highlight");e++}$("scouts_scoutslot"+c).onclick=new Function(d)}if(!e){this.showTutorialChar("no_scouts",t_scouts_task_overview_failed_scouts)}};scouts.prototype.clickTaskScout=function(c,a){if(!this.data.tasks[this.currentTask].data){this.data.tasks[this.currentTask].data={}}if(!this.data.tasks[this.currentTask].data.scouts){this.data.tasks[this.currentTask].data.scouts={}}this.data.tasks[this.currentTask].data.scouts[c]=a;this.currentTaskSlot=c;this.currentTaskScoutId=a;var b=this.currentTask;this.closeTaskInfo(1);this.openTaskInfo(b)};scouts.prototype.clickTaskSupportSlot=function(){this.hideTutorialChar();this.buildScoutSlots();if(this.data.tasks[this.currentTask].type=="charity"){this.buildProductSelection()}else{this.buildShop()}};scouts.prototype.setTaskSupportSlot=function(a){hideDiv("globalbox");hideDiv("globaltransp");if(!this.data.tasks[this.currentTask].data){this.data.tasks[this.currentTask].data={}}this.data.tasks[this.currentTask].data.itemid=a;var b=this.currentTask;this.closeTaskInfo(1);this.openTaskInfo(b)};scouts.prototype.speedupTaskCommit=function(e){if(!e){e=this.currentTask}var b=this.data.tasks[e];var a=Math.ceil(b.remain/this.data.config.constants.task_speedup_seconds2coin);var c='<div id="scouts_commit">'+t_scouts_task_speedup_desc.replace("%COINS%",a)+"</div>";var d="scouts.speedupTask("+e+")";globalcommitbox(t_scouts_task_speedup_head,c,d)};scouts.prototype.closeTaskInfo=function(a){if(!a&&parseInt(this.data.tasks[this.currentTask].startdate)==0){this.data.tasks[this.currentTask].data={}}this.currentTask=0;hideDiv("scouts_taskinfo");this.hideTutorialChar();this.buildScoutSlots()};scouts.prototype.buildScoutSlots=function(){var a="";for(var b in this.data.config.scout_slots){a+='<div id="scouts_scoutslot'+b+'" class="slot" onmouseover="showDiv(\'scouts_scoutslot'+b+"_tt')\" onmouseout=\"hideDiv('scouts_scoutslot"+b+"_tt')\">";a+='  <div id="scouts_scoutslot'+b+'_add" class="add"></div>';a+='  <div id="scouts_scoutslot'+b+'_info" class="info">';a+='    <div id="scouts_scoutslot'+b+'_img" class="img"></div>';a+='    <div id="scouts_scoutslot'+b+'_energy" class="energy">';a+='      <div id="scouts_scoutslot'+b+'_energy_inner" class="inner"></div>';a+="    </div>";a+='    <div id="scouts_scoutslot'+b+'_level" class="level"></div>';a+="  </div>";a+='  <div id="scouts_scoutslot'+b+'_block" class="block"></div>';a+='  <div id="scouts_scoutslot'+b+'_block2" class="block2"></div>';a+='  <div id="scouts_scoutslot'+b+'_tt" class="ttbox"></div>';a+='  <div id="scouts_scoutslot'+b+'_bubble" class="bubble"></div>';a+='  <div id="scouts_scoutslot'+b+'_busy" class="busy"></div>';a+='  <div id="scouts_scoutslot'+b+'_free" class="free">';a+='    <div id="scouts_scoutslot'+b+'_free_count" class="count"></div>';a+="  </div>";a+="</div>"}a+='<div class="clear"></div>';$("scouts_scoutslots").innerHTML=a;for(var b in this.data.config.scout_slots){this.updateScoutSlot(b)}};scouts.prototype.updateScoutSlot=function(t){hideDiv("scouts_scoutslot"+t+"_add");hideDiv("scouts_scoutslot"+t+"_info");hideDiv("scouts_scoutslot"+t+"_block");hideDiv("scouts_scoutslot"+t+"_block2");hideDiv("scouts_scoutslot"+t+"_busy");hideDiv("scouts_scoutslot"+t+"_free");var v="scouts.buildScoutsList("+t+")";var m="";if(this.data.data.scout_slots[t]&&this.data.data.scout_slots[t].buy_time){if(this.data.data.scout_slots[t].scoutid){var e=this.data.scouts[this.data.data.scout_slots[t].scoutid];$("scouts_scoutslot"+t+"_img").innerHTML=this.buildScoutImg(e.img);var l=((e.energy*100)/e.energy_max);$("scouts_scoutslot"+t+"_energy_inner").style.width=l+"%";$("scouts_scoutslot"+t+"_level").innerHTML=e.level;m+=this.scoutsTT(e.id);if(e.taskid>0){showDiv("scouts_scoutslot"+t+"_busy")}var d=0;for(var r in e.skills){d++}var q=(e.level-1)-(d-this.data.config.constants.startskills);$("scouts_scoutslot"+t+"_free_count").innerHTML=q;if(q>0){showDiv("scouts_scoutslot"+t+"_free")}v="scouts.scoutInfo("+t+")";showDiv("scouts_scoutslot"+t+"_info")}else{showDiv("scouts_scoutslot"+t+"_add");m=t_scouts_scoutslots_add_tt}}else{var b="";v="scouts.buyScoutSlotCommit("+t+")";if(this.data.config.scout_slots[t].money||this.data.config.scout_slots[t].coins){var u="";var s="";if(this.data.config.scout_slots[t].money>0){var a=formatPrice(this.data.config.scout_slots[t].money);if(parseInt(this.data.config.scout_slots[t].money)>parseInt(user_bar)){s="important";v="";b=2}}if(this.data.config.scout_slots[t].coins>0){var w=this.data.config.scout_slots[t].coins;var h="";var n=specialbonus.findBonus({key1:"scouts",key2:"buyscoutslot"});if(n&&n.buyscoutslot){w=Math.ceil(w*(1-n.buyscoutslot));h="color:green; font-weight:bold;";u=specialbonus.htmlBonusLine(n.buyscoutslot)}var a=formatNumber(w)+"&nbsp;"+t_coins;if(parseInt(w)>parseInt(user_coins)){s="important";v="";b=2}}m='<div class="'+s+'" style="margin-bottom:5px;">'+t_scouts_scoutslots_buy_tt.replace("%COST%",'<span style=" '+h+'">'+a+"</span>")+"</div>"}var c="";if(this.data.config.scout_slots[t].quest&&this.data.config.scout_slots[t].quest>0&&this.data.config.scout_slots[t].quest>this.data.highestquest){m+='<div class="important">'+t_scouts_requires_quest.replace("%COUNT%",this.data.config.scout_slots[t].quest)+"</div>";v="";b=2}showDiv("scouts_scoutslot"+t+"_block"+b)}$("scouts_scoutslot"+t).onclick=new Function(v);$("scouts_scoutslot"+t+"_tt").innerHTML=m;$("scouts_scoutslot"+t+"_tt").removeClassName("right");if(t>7){$("scouts_scoutslot"+t+"_tt").addClassName("right")}};scouts.prototype.buyScoutSlotCommit=function(l){var d=0;if(this.data.scouts){for(var b in this.data.scouts){if(this.data.scouts[b].status==2){d++}}}var n="";if(this.data.config.scout_slots[l].money>0){var a=formatPrice(this.data.config.scout_slots[l].money)}if(this.data.config.scout_slots[l].coins>0){var q=this.data.config.scout_slots[l].coins;var e="";var h=specialbonus.findBonus({key1:"scouts",key2:"buyscoutslot"});if(h&&h.buyscoutslot){q=Math.ceil(q*(1-h.buyscoutslot));e="color:green; font-weight:bold;";n=specialbonus.htmlBonusLine(h.buyscoutslot)}var a='<span style="'+e+'">'+formatNumber(q)+"&nbsp;"+t_coins+"</span>"}var c='<div id="scouts_commit">'+t_scouts_buyscoutslot_body.replace("%COST%","<b>"+a+"</b>")+"</div>";if(n!=""){c+=n}if(!d){c+='<div style="background-color:#C3A75E; border-radius:5px; padding:10px; margin-top:10px;">'+t_scouts_buy_scoutslot_no_scout+"</div>"}var m="scouts.buyScoutSlot("+l+")";globalcommitbox(t_scouts_buyscoutslot_head,c,m)};scouts.prototype.buildScoutsList=function(h){if(h<0){this.currentScoutSlot=0}else{if(h){this.currentScoutSlot=h}else{h=this.currentScoutSlot}}var e=[];for(var c in this.data.scouts){if(this.data.scouts[c].status==2){e.push(this.data.scouts[c])}}var b='<div id="scouts_scoutslist">';b+='  <div class="desc">'+t_scouts_scoutslist_desc+"</div>";b+='  <div class="slots">';var d=0;for(var c in this.data.config.scout_list){b+='<div class="slot">';if(this.data.config.scout_list[c].level&&this.data.config.scout_list[c].level>this.data.data.level){b+='<div class="block"></div>';b+='<div class="levelinfo important">'+t_scouts_requires_level.replace("%COUNT%",this.data.config.scout_list[c].level)+"</div>"}else{if(e[d]&&e[d].id){b+='<div class="info">';b+='  <div class="img">'+this.buildScoutImg(e[d].img)+"</div>";b+='  <div class="name">'+e[d].name+"</div>";b+='  <div class="level">'+e[d].level+"</div>";b+="</div>";b+='<div class="skills">';b+='  <div style="margin-bottom:5px;">'+t_scouts_skills+"</div>";b+='  <div class="flexit">';for(var a in e[d].skills){b+='<div class="skill scouts_badge '+a+'" onmouseover="showDiv(\'scouts_scoutslist_slot'+c+"_skill_"+a+"_tt')\" onmouseout=\"hideDiv('scouts_scoutslist_slot"+c+"_skill_"+a+"_tt')\">";b+='  <div id="scouts_scoutslist_slot'+c+"_skill_"+a+'_tt" class="ttbox">'+t_scouts_skill_name[a]+"</div>";b+="</div>"}b+="  </div>";b+="</div>";b+='<div class="traits">';b+='  <div style="margin-bottom:5px;">'+t_scouts_traits+"</div>";if(e[d].traits){if(e[d].traits.buff){b+='<div class="buff"">'+this.buildTrait(e[d].traits.buff)+"</div>"}if(e[d].traits.debuff){b+='<div class="debuff">'+this.buildTrait(e[d].traits.debuff)+"</div>"}}b+="</div>";if(this.data.data.stats&&this.data.data.stats.scouts_accepted){b+='<div class="reroll link" onclick="scouts.rerollScoutCommit('+e[d].id+')" onmouseover="showDiv(\'scouts_scoutlist_slot'+c+"_reroll_tt')\" onmouseout=\"hideDiv('scouts_scoutlist_slot"+c+"_reroll_tt')\">";b+='  <div id="scouts_scoutlist_slot'+c+'_reroll_tt" class="ttbox">'+t_scouts_scoutlist_reroll+"</div>";b+="</div>"}if(this.currentScoutSlot>0){b+='<div class="button_new link" onclick="scouts.acceptScoutCommit('+e[d].id+')">'+t_scouts_scoutlist_accept+"</div>"}else{b+='<div style="height:20px;">&nbsp;</div>'}if(this.data.data.stats&&this.data.data.stats.scouts_accepted){b+='<div class="button_new link" onclick="scouts.denyScoutCommit('+e[d].id+')">'+t_scouts_scoutlist_deny+"</div>"}}else{b+='<div class="levelinfo">'+t_scouts_requires_popularity+"</div>"}}b+="</div>";d++}b+='    <div class="clear"></div>';b+="  </div>";b+="</div>";globalBoxFlex(t_scouts_scoutslist_head,b,0,0,1);$("globalbox").style.top="40px";$("globalbox").style.marginLeft="-320px"};scouts.prototype.buildTrait=function(e){var a="";if(e.skill){a=t_scouts_skill_name[e.skill]}var d=0;if(e.amount){d=Math.round(e.amount*100)}if(d>0){d="+"+d}var c=getRandom(1000000,9999999);var b="";b+='<div class="col1 skill scouts_badge '+e.skill+'" onmouseover="showDiv(\'scouts_scoutslist_slot_trait_'+c+"_tt')\" onmouseout=\"hideDiv('scouts_scoutslist_slot_trait_"+c+"_tt')\">";b+='  <div id="scouts_scoutslist_slot_trait_'+c+'_tt" class="ttbox">'+t_scouts_skill_name[e.skill]+"</div>";b+="</div>";b+='<div class="col2">'+d+"%</div>";b+='<div class="col3">'+t_scouts_trait_name[e.type].replace("%PERCENT%","").replace("%NAME%","<b>"+a+"</b>")+"</div>";b+='<div class="clear"></div>';return b};scouts.prototype.rerollScoutCommit=function(h){var e=this.data.config.constants.scoutlist_reroll+"&nbsp;"+t_coins;var c='<div style="width:350px;">'+t_scouts_scoutlist_reroll+"</div>";var a=t_scouts_scoutlist_reroll_body.replace("%COST%","<b>"+e+"</b>");var d="scouts.rerollScout("+h+")";var b="scouts.buildScoutsList()";globalcommitbox(c,a,d,b)};scouts.prototype.acceptScoutCommit=function(h){var c=this.data.scouts[h].name;var d='<div style="width:350px;">'+t_scouts_scoutlist_accept+"</div>";var a='<div id="scouts_commit">';a+='  <div class="img">';a+=this.buildScoutImg(this.data.scouts[h].img);a+='    <div class="bubble">'+t_scouts_scoutlist_shout["accept"+getRandom(1,4)]+"</div>";a+="  </div>";a+="  <div>"+t_scouts_scoutlist_accept_body.replace("%NAME%","<b>"+c+"</b>")+"</div>";a+="</div>";var e="scouts.acceptScout("+h+")";var b="scouts.buildScoutsList()";globalcommitbox(d,a,e,b);$("globalbox_content").style.overflow="visible"};scouts.prototype.denyScoutCommit=function(h){var c=this.data.scouts[h].name;var d='<div style="width:350px;">'+t_scouts_scoutlist_deny+"</div>";var a='<div id="scouts_commit">';a+='  <div class="img">';a+=this.buildScoutImg(this.data.scouts[h].img);a+='    <div class="bubble">'+t_scouts_scoutlist_shout["deny"+getRandom(1,4)]+"</div>";a+="  </div>";a+="  <div>"+t_scouts_scoutlist_deny_body.replace("%NAME%","<b>"+c+"</b>")+"</div>";a+="</div>";var e="scouts.denyScout("+h+")";var b="scouts.buildScoutsList()";globalcommitbox(d,a,e,b);$("globalbox_content").style.overflow="visible"};scouts.prototype.scoutInfo=function(c){this.currentScoutSlot=c;var w=this.data.data.scout_slots[c].scoutid;var n=this.data.scouts[w];var q="";q+='<div class="header">';q+='  <div class="img">'+this.buildScoutImg(n.img)+"</div>";q+='  <div class="info">';q+='    <div class="name">'+n.name+"</div>";var a="";var B=0;if(this.data.config.scout_levels[(n.level+1)]){var h=parseInt(this.data.config.scout_levels[n.level].points);var z=parseInt(this.data.config.scout_levels[(n.level+1)].points);var s=(z-h);var t=(parseInt(n.points)-h);B=((t*100)/s);var t=0;var A=0;if(n.points){A=n.points}var t=(this.data.config.scout_levels[(n.level+1)].points-A);a+="<div>"+t_scouts_skill_points_remain.replace("%AMOUNT%",t)+"</div>"}else{B=100;a+="<div>"+t_reached_maxlevel+"</div>"}a+='<div style="margin-top:10px;">';a+='  <div style="font-weight:bold;">'+t_scouts_skill_current_level+"</div>";a+='<div class="energy">';a+='  <div class="symbol" style="transform:scale(0.5); margin:-5px; margin-left:-7px; background-position:-26px 0px; width:24px;"></div>';a+="  <div>"+this.data.config.scout_levels[n.level].energy+"</div>";a+='  <div class="clear"></div>';a+="</div>";if(this.data.config.scout_levels[n.level].popularity_bonus){a+="<div>"+t_scouts_bonus.popularity_bonus.replace("%PERCENT%",Math.round(this.data.config.scout_levels[n.level].popularity_bonus*100))+"</div>"}if(this.data.config.scout_levels[(n.level+1)]){a+='<div style="font-weight:bold; margin-top:5px;">'+t_scouts_skill_next_level+"</div>";a+='<div class="energy">';a+='  <div class="symbol" style="transform:scale(0.5); margin:-5px; margin-left:-7px; background-position:-26px 0px; width:24px;"></div>';a+="  <div>"+this.data.config.scout_levels[(n.level+1)].energy+"</div>";a+='  <div class="clear"></div>';a+="</div>";if(this.data.config.scout_levels[(n.level+1)].popularity_bonus){a+="<div>"+t_scouts_bonus.popularity_bonus.replace("%PERCENT%",Math.round(this.data.config.scout_levels[(n.level+1)].popularity_bonus*100))+"</div>"}}a+="</div>";if(n.bonus){q+='<div class="bonus" onmouseover="showDiv(\'scouts_scoutinfo_food_bonus\')" onmouseout="hideDiv(\'scouts_scoutinfo_food_bonus\')">';q+='  <div id="scouts_scoutinfo_food_bonus" class="ttbox">';q+='    <div style="font-weight:bold;">'+t_scouts_filled_with_food+"</div>";for(var e in n.bonus){q+='<div style="margin-top:5px;">'+t_scouts_bonus[e].replace("%PERCENT%",Math.round(n.bonus[e]*100)).replace("%NAME%",t_scouts_points)+"</div>"}q+='    <div style="margin-top:5px; font-style:italic;">'+t_scouts_filled_with_food_info+"</div>";q+="  </div>";q+="</div>"}q+='    <div class="level" onmouseover="showDiv(\'scouts_scoutinfo_level_tt\')" onmouseout="hideDiv(\'scouts_scoutinfo_level_tt\')">';q+='      <div class="amount">'+n.level+"</div>";q+='      <div class="bar">';q+='        <div class="inner" style="width:'+B+'%"></div>';q+="      </div>";q+='      <div class="clear"></div>';q+='      <div id="scouts_scoutinfo_level_tt" class="ttbox">'+a+"</div>";q+="    </div>";var B=((n.energy*100)/this.data.config.scout_levels[n.level].energy);q+='    <div class="energy">';q+='      <div class="symbol"></div>';q+='      <div class="bar">';q+='        <div class="inner" style="width:'+B+'%"></div>';q+='        <div class="amount">'+n.energy+"/"+this.data.config.scout_levels[n.level].energy+"</div>";q+="      </div>";q+='      <div class="clear"></div>';if(B<100){var C="scouts.feedScoutCommit()";var d="";var u="";if(n.taskid>0){C="";d="off";u="onmouseover=\"showDiv('scouts_scoutinfo_feedbutton_tt')\" onmouseout=\"hideDiv('scouts_scoutinfo_feedbutton_tt')\""}q+='<div class="feed button_new link '+d+'" onclick="'+C+'" '+u+">"+t_scouts_scout_feed_head+"</div>";if(n.taskid>0){q+='<div id="scouts_scoutinfo_feedbutton_tt" class="ttbox">'+t_scouts_scout_feed_button_info+"</div>"}}q+="    </div>";q+="  </div>";q+='  <div class="clear"></div>';q+="</div>";q+='<div class="traits">';if(n.traits){if(n.traits.buff){q+='<div class="buff">'+this.buildTrait(n.traits.buff)+"</div>"}if(n.traits.debuff){q+='<div class="debuff">'+this.buildTrait(n.traits.debuff)+"</div>"}}q+='  <div class="clear"></div>';q+="</div>";var l=0;for(var m in n.skills){l++}var D=(this.data.config.constants.startskills+(n.level-1));var r=(D-l);q+='<div class="skills">';if(r>0){q+='<div class="free" onmouseover="showDiv(\'scouts_scoutinfo_free_tt\')" onmouseout="hideDiv(\'scouts_scoutinfo_free_tt\')">';q+='  <div class="number">'+r+"</div>";q+='  <div id="scouts_scoutinfo_free_tt" class="ttbox">'+t_scouts_scoutinfo_free_desc+"</div>";q+="</div>"}for(var m in n.skills){q+=this.scoutInfoSkillBar(n,m)}var v="";for(var m in this.data.config.skills){if(n.skills[m]){continue}v+=this.scoutInfoSkillBar(n,m,r)}if(v!=""){q+='<div class="inactive">'+v+"</div>"}var a='<div style="font-weight:bold; margin-bottom:2px;">'+t_scouts_retire_scout_info+"</div>";if(this.data.config.retire_reward.powerup){for(var w in this.data.config.retire_reward.powerup){var b=windmillarray[w][5][3]}a+='<div style="margin-bottom:2px;">'+b+"%&nbsp;"+t_pointsboost_unit+"</div>"}if(this.data.config.retire_reward.popularity){a+='<div style="margin-bottom:5px;">'+this.data.config.retire_reward.popularity+"&nbsp;"+t_scouts_popularity+"</div>"}var d="";var C="scouts.retireScoutCommit("+n.id+")";var u="";if(this.data.config.scout_levels[(n.level+1)]||n.taskid>0){C="";d="off";u="onmouseover=\"showDiv('scouts_scout"+n.id+"_retired_tt')\" onmouseout=\"hideDiv('scouts_scout"+n.id+"_retired_tt')\"";if(this.data.config.scout_levels[(n.level+1)]){a+='<div class="important" style="margin-top:5px;">'+t_scouts_retire_scout_failed_level+"</div>"}if(n.taskid>0){a+='<div class="important" style="margin-top:5px;">'+t_scouts_retire_scout_failed_task+"</div>"}}q+='  <div class="retired" '+u+">";q+='    <div class="button_new link '+d+'" onclick="'+C+'">'+t_scouts_retire_scout_head+"</div>";q+='    <div id="scouts_scout'+n.id+'_retired_tt" class="ttbox">'+a+"</div>";q+="  </div>";q+="</div>";q+='<div id="scouts_scoutinfo_scroller_left" class="scroller left link" onclick="scouts.scoutInfoNavi(-1)"></div>';q+='<div id="scouts_scoutinfo_scroller_right" class="scroller right link" onclick="scouts.scoutInfoNavi(1)"></div>';q+='<div class="mini_close link" onclick="scouts.closeScoutInfo()"></div>';$("scouts_scoutinfo_main").innerHTML=q;showDiv("scouts_scoutinfo");this.scoutInfoNavi(0);$("scouts_scoutslot"+c).addClassName("highlight");if(!this.data.data.tutorial.scoutinfo){this.showTutorial("scoutinfo")}};scouts.prototype.closeScoutInfo=function(a){$("scouts_scoutslot"+this.currentScoutSlot).removeClassName("highlight");hideDiv("scouts_scoutinfo");this.currentScoutSlot=0};scouts.prototype.scoutInfoNavi=function(a){$("scouts_scoutslot"+this.currentScoutSlot).removeClassName("highlight");var c=0;var b=0;for(var d in this.data.data.scout_slots){if(!this.data.data.scout_slots[d].scoutid){continue}if(d<this.currentScoutSlot){c=d}if(!b&&d>this.currentScoutSlot){b=d}}hideDiv("scouts_scoutinfo_scroller_left");hideDiv("scouts_scoutinfo_scroller_right");if(c>0){showDiv("scouts_scoutinfo_scroller_left")}if(b>0){showDiv("scouts_scoutinfo_scroller_right")}if(a!=0){if(a<0&&c>0){d=c}if(a>0&&b>0){d=b}this.scoutInfo(d)}};scouts.prototype.scoutInfoSkillBar=function(q,u,t){var a=1;var c=0;var w="";var z="";if(q.skills[u]){a=q.skills[u].level;var b=this.data.config.scout_skill_levels[a].points;if(this.data.config.scout_skill_levels[parseInt(a+1)]){var e=this.data.config.scout_skill_levels[parseInt(a+1)].points;var v=(e-b);var d=(q.skills[u].points-b);c=((d*100)/v)}else{c=100}}else{w="off";c=100}var s="";var d=0;if(this.data.config.scout_skill_levels[(a+1)]){var r=0;if(q.skills[u]&&q.skills[u].points){r=q.skills[u].points}var d=(this.data.config.scout_skill_levels[(a+1)].points-r);s+='<div style="margin-bottom:10px;">'+t_scouts_skill_points_remain.replace("%AMOUNT%",d)+"</div>"}else{s+='<div style="margin-bottom:10px;">'+t_reached_maxlevel+"</div>"}var n=["points","money","scoutspoints"];var l="";for(var h=0;h<n.length;h++){if(!this.data.config.scout_skill_levels[a][n[h]+"_bonus"]){continue}l+="<div>"+t_scouts_bonus[n[h]+"_bonus"].replace("%PERCENT%",Math.round(this.data.config.scout_skill_levels[a][n[h]+"_bonus"]*100)).replace("%NAME%",t_scouts_points)+"</div>"}if(l!=""){s+='<div style="font-weight:bold;">'+t_scouts_skill_current_level+"</div>";s+=l}if(this.data.config.scout_skill_levels[(a+1)]){var l="";for(var h=0;h<n.length;h++){if(!this.data.config.scout_skill_levels[(a+1)][n[h]+"_bonus"]){continue}l+="<div>"+t_scouts_bonus[n[h]+"_bonus"].replace("%PERCENT%",Math.round(this.data.config.scout_skill_levels[(a+1)][n[h]+"_bonus"]*100)).replace("%NAME%",t_scouts_points)+"</div>"}if(l!=""){s+='<div style="font-weight:bold; margin-top:10px;">'+t_scouts_skill_next_level+"</div>";s+=l}}var z="onmouseover=\"showDiv('scoutinfo"+q.id+"_skill_"+u+"_tt')\" onmouseout=\"hideDiv('scoutinfo"+q.id+"_skill_"+u+"_tt')\"";if(!q.skills[u]){z=""}var m='<div class="line" '+z+">";m+='  <div class="col badge scouts_badge '+u+'"></div>';m+='  <div class="col name">'+t_scouts_skill_name[u]+"</div>";if(q.skills[u]){m+='<div class="col level">'+a+"</div>"}else{m+='<div class="col locked"></div>'}m+='  <div class="col bar">';m+='    <div class="inner '+w+'" style="width:'+c+'%"></div>';m+="  </div>";if(t>0){m+='<div class="col button_new link" onclick="scouts.addSkillCommit(\''+u+"')\" onmouseover=\"showDiv('scouts_scoutinfo_skill_"+u+"_add_tt')\" onmouseout=\"hideDiv('scouts_scoutinfo_skill_"+u+"_add_tt')\">";m+='  <div id="scouts_scoutinfo_skill_'+u+'_add_tt" class="ttbox">'+t_scouts_skill_add_head+"</div>";m+="</div>"}m+='  <div class="clear"></div>';m+='  <div id="scoutinfo'+q.id+"_skill_"+u+'_tt" class="ttbox bottom">'+s+"</div>";m+="</div>";return m};scouts.prototype.addSkillCommit=function(b){var c=t_scouts_skill_name[b];var h=this.data.data.scout_slots[this.currentScoutSlot].scoutid;var a=this.data.scouts[h];var d='<div id="scouts_commit" style="min-width:350px;">';d+='  <div class="scouts_badge '+b+'" style="width:100px; height:100px; margin:0 auto; margin-bottom:10px;"></div>';d+="  <div>"+t_scouts_skill_add_body.replace("%NAME%","<b>"+c+"</b>")+"</div>";d+='  <div style="background-color:#C3A75E; border-radius:5px; padding:10px; margin-top:10px;">'+t_scouts_skill_add_desc.replace("%NAME1%","<b>"+c+"</b>").replace("%NAME2%","<b>"+a.name+"</b>")+"</div>";d+="</div>";var e="scouts.addSkill('"+b+"')";globalcommitbox(t_scouts_skill_add_head,d,e)};scouts.prototype.feedScoutCommit=function(){var a=this.data.data.scout_slots[this.currentScoutSlot].scoutid;var m=this.data.scouts[a];var n=this.data.config.scout_levels[m.level].energy;var b=Math.min(100,((m.energy*100)/n));var q="scouts.feedScout()";var l=0;var h=0;if(this.feedProduct>0){var c=parseInt(checkRackItem(this.feedProduct));if(c>0){h=this.feedProduct}}if(!h){for(var e in this.data.config.products){var c=parseInt(checkRackItem(e));if(c<=0){continue}if(!h){h=e}l++}}if(h<=0){q=""}else{if(!this.feedProduct){this.feedProduct=h}}var d="";d+='<div id="scouts_feed">';d+='  <div class="img">'+this.buildScoutImg(m.img)+'<div class="level">'+m.level+"</div></div>";d+='  <div class="energy">';d+='    <div class="bar">';d+='      <div id="scouts_feed_bar_inner" class="inner"></div>';d+='      <div class="inner2" style="width:'+b+'%"></div>';d+="    </div>";d+='    <div class="amount"><span id="scouts_feed_current">'+m.energy+"</span>/"+n+"</div>";d+="  </div>";d+='  <div style="margin-top:15px; margin-bottom:5px;">'+t_scouts_feed_desc.replace("%NAME%","<b>"+m.name+"</b>")+"</div>";d+='  <div class="product">';if(h==0){d+='<div class="important">'+t_scouts_feed_no_products+"</div>"}else{var c=parseInt(checkRackItem(h));d+="<div>"+shredder_product+"</div>";d+='<div class="current links" onclick="scouts.expandFeedScout()" onmouseover="scouts.hoverProductTTFeedScout('+h+')" onmouseout="scouts.hoverProductTTFeedScout('+h+')">';d+='  <div class="col1 kp'+h+'"></div>';d+='  <div class="col2">'+produkt_name[h]+"</div>";d+='  <div class="col3"></div>';d+='  <div class="col4">'+this.data.config.products[h].energy+"</div>";d+='  <div class="clear"></div>';d+="</div>";d+='<div id="scouts_feed_selector" class="selector link" onclick="scouts.expandFeedScout()">';d+="</div>";d+='<div class="clear"></div>';d+='<div id="scouts_scout_feed_list" class="list">';for(var e in this.data.config.products){if(parseInt(checkRackItem(e))<=0){continue}d+='<div class="line" onclick="scouts.clickFeedScout('+e+')" onmouseover="scouts.hoverProductTTFeedScout('+e+')" onmouseout="scouts.hoverProductTTFeedScout('+e+')">';d+='  <div class="col1 kp'+e+'"></div>';d+='  <div class="col2">'+produkt_name[e]+"</div>";d+='  <div class="col3"></div>';d+='  <div class="col4">'+this.data.config.products[e].energy+"</div>";d+='  <div class="clear"></div>';d+="</div>"}d+="</div>";d+='<div style="margin-top:5px;">'+shredder_amount+"</div>";d+='<div class="amount">';d+='  <input id="scouts_feed_amount" type="number" onkeyup="scouts.checkFeedScout()" onchange="scouts.checkFeedScout()">';d+="  <div>"+t_inner_stock+"&nbsp;"+c+"</div>";d+="</div>"}d+='    <div id="scouts_feed_button" class="button_new link" onclick="'+q+'">'+t_scouts_scout_feed+"</div>";d+='    <div id="scouts_feed_product_tt" class="ttbox"></div>';d+="  </div>";if(h==0){d+="<div class=\"button_new link\" onclick=\"hideDiv('globalbox'); hideDiv('globaltransp'); scouts.setView('production');\">"+t_scouts_goto_production+"</div>"}d+="</div>";globalBoxFlex(t_scouts_scout_feed_head,d,0,0,1);hideDiv("globalbox_char");this.checkFeedScout();if($("scouts_feed_amount")){$("scouts_feed_amount").focus()}};scouts.prototype.hoverProductTTFeedScout=function(a){if($("scouts_feed_product_tt").style.display=="block"){hideDiv("scouts_feed_product_tt")}else{var b=this.productTT(a);$("scouts_feed_product_tt").innerHTML=b;if(b!=""){showDiv("scouts_feed_product_tt")}}};scouts.prototype.productTTFeedScout=function(a){var c=this.data.config.products[a];var b="";if(c.points_bonus){b+='<div class="line">'+t_scouts_bonus.points_bonus.replace("%PERCENT%",Math.round(c.points_bonus*100))+"</div>"}if(c.money_bonus){b+='<div class="line">'+t_scouts_bonus.money_bonus.replace("%PERCENT%",Math.round(c.money_bonus*100))+"</div>"}if(c.scoutspoints_bonus){b+='<div class="line">'+t_scouts_bonus.scoutspoints_bonus.replace("%PERCENT%",Math.round(c.scoutspoints_bonus*100)).replace("%NAME%",t_scouts_points)+"</div>"}if(c.popularity_bonus){b+='<div class="line">'+t_scouts_bonus.popularity_bonus.replace("%PERCENT%",Math.round(c.popularity_bonus*100))+"</div>"}if(c.xp_bonus){b+='<div class="line">'+t_fishing_general_bonus.replace("%PERCENT%",Math.round(c.scoutspoints_bonus*100))+"</div>"}if(c.skillxp_bonus){b+='<div class="line">'+t_fishing_general_bonus.replace("%PERCENT%",Math.round(c.scoutspoints_bonus*100))+"</div>"}return b};scouts.prototype.clickFeedScout=function(a){this.feedProduct=a;this.feedScoutCommit()};scouts.prototype.expandFeedScout=function(){if($("scouts_scout_feed_list").style.display=="block"){hideDiv("scouts_scout_feed_list");$("scouts_feed_selector").style.backgroundImage="url("+imgpath+"market/sel_open.gif)"}else{showDiv("scouts_scout_feed_list");$("scouts_feed_selector").style.backgroundImage="url("+imgpath+"market/sel_close.gif)"}};scouts.prototype.checkFeedScout=function(){$("scouts_feed_button").addClassName("off");if(!this.feedProduct||!$("scouts_feed_amount")){return 1}var a=this.data.data.scout_slots[this.currentScoutSlot].scoutid;var h=this.data.scouts[a];var m=this.data.config.scout_levels[h.level].energy;var e=this.feedProduct;var c=checkRackItem(e);var d=$("scouts_feed_amount").value;d=parseInt(d);if(isNaN(d)){d=0}else{if(d<0){d=0}}if(parseInt(d)>parseInt(c)){d=c}var l=(parseInt(h.energy)+(parseInt(d)*parseInt(this.data.config.products[this.feedProduct].energy)));var b=0;if(d>0){b=Math.min((l*100)/m)}$("scouts_feed_bar_inner").style.width=b+"%";$("scouts_feed_amount").value=d;var n=Math.min(l,m);if(d>0){n='<span class="add">'+n+"</span>"}$("scouts_feed_current").innerHTML=n;if(this.feedProduct>0&&d>0){$("scouts_feed_button").removeClassName("off")}};scouts.prototype.retireScoutCommit=function(h){var e=0;for(var c in this.data.scouts){e++}if(e==1){var b='<div id="scouts_commit">'+t_scouts_last_scout_standing+"</div>";globalcommitbox(t_scouts_retire_scout_head,b,"");return 1}var a=this.data.scouts[h];var d="scouts.retireScout("+h+")";var b='<div id="scouts_commit">';b+='  <div class="img">'+scouts.buildScoutImg(a.img);b+='    <div class="level">'+a.level+"</div>";b+="  </div>";b+='  <div class="desc">'+t_scouts_retire_scout_desc.replace("%NAME%","<b>"+a.name+"</b>")+"</div>";b+="<div>";globalcommitbox(t_scouts_retire_scout_head,b,d)};scouts.prototype.scoutsTT=function(b){var a=this.data.scouts[b];var e='<div id="scoutinfo">';e+='  <div class="name">'+a.name+"</div>";e+='  <div class="en">';e+='    <div class="symbol"></div>';e+='    <div class="amount">'+formatNumber(a.energy)+"/"+formatNumber(this.data.config.scout_levels[a.level].energy)+"</div>";e+='    <div class="clear"></div>';e+="  </div>";e+='  <div class="skills">';for(var d in a.skills){e+='<div class="line">';e+='  <div class="col1 scouts_badge '+d+'"></div>';e+='  <div class="col3 level">'+a.skills[d].level+"</div>";e+='  <div class="col2">';e+="    <div>"+t_scouts_skill_name[d]+"</div>";var h=["buff","debuff"];for(var c=0;c<h.length;c++){if(a.traits&&a.traits[h[c]]&&a.traits[h[c]].skill==d){var l="";if(a.traits[h[c]].amount>0){l="+"}e+='<div class="'+[h[c]]+'">'+l+Math.round(a.traits[h[c]].amount*100)+"% "+t_scouts_trait_name[a.traits[h[c]].type]+"</div>"}}e+="  </div>";e+='  <div class="clear"></div>';e+="</div>"}e+="  </div>";if(a.taskid>0){e+='<div style="margin-top:10px; font-style:italic;">'+t_scouts_scout_busy+"</div>"}e+="</div>";return e};scouts.prototype.buildProductSelection=function(){if($("scouts_task"+this.currentTask+"_selection").style.display=="block"){hideDiv("scouts_task"+this.currentTask+"_selection");return 1}var c=this.data.tasks[this.currentTask];for(category in c.need){var e=c.need[category]}var d="";for(var b in this.data.config.products){if(this.data.config.products[b].category!=category){continue}var l=parseInt(checkRackItem(b));var a="";var h="scouts.clickProductSelection("+b+")";if(parseInt(e)>parseInt(l)){a="off2";h=""}d+='<div class="slot link '+a+'" onclick="'+h+'" onmouseover="showDiv(\'scouts_productselection_'+b+"_tt')\" onmouseout=\"hideDiv('scouts_productselection_"+b+"_tt')\">";d+='  <div class="img scouts_item'+b+'"></div>';d+='<div class="amount2">'+l+"</div>";d+='  <div id="scouts_productselection_'+b+'_tt" class="ttbox">';d+=this.productTT(b);if(l==0){d+='<div class="important" style="margin-top:10px;">'+product_notavailable_info+"</div>"}d+="  </div>";d+="</div>"}d+='<div class="clear"></div>';$("scouts_task"+this.currentTask+"_selection").innerHTML=d;showDiv("scouts_task"+this.currentTask+"_selection")};scouts.prototype.clickProductSelection=function(a){if(!this.data.tasks[this.currentTask].data){this.data.tasks[this.currentTask].data={}}this.data.tasks[this.currentTask].data.pid=a;var b=this.currentTask;this.closeTaskInfo(1);this.openTaskInfo(b)};scouts.prototype.buildBook=function(){var a="";a+='<div class="transp"></div>';a+='<div class="book">';a+='  <div id="scouts_book_side_left" class="page left"></div>';a+='  <div id="scouts_book_side_right" class="page right"></div>';a+='  <div id="scouts_book_navi_left" class="navi left link" onclick="scouts.setBookPage(-2)"></div>';a+='  <div id="scouts_book_navi_right" class="navi right link" onclick="scouts.setBookPage(+2)"></div>';a+='  <div class="mini_close link" onclick="scouts.closeBook()"></div>';a+="</div>";$("scouts_book").innerHTML=a;showDiv("scouts_book");this.setBookPage()};scouts.prototype.getBookMaxPages=function(){var a=0;for(var b in this.data.config.animals){a++}return Math.ceil(a/2)};scouts.prototype.setBookPage=function(b){if(b){this.currentBookPage+=b}if(this.currentBookPage<1){this.currentBookPage=1}var a=this.getBookMaxPages();if(this.currentBookPage>=a){this.currentBookPage=(a-1)}showDiv("scouts_book_navi_left");showDiv("scouts_book_navi_right");if(this.currentBookPage==1){hideDiv("scouts_book_navi_left")}if(this.currentBookPage==(a-1)){hideDiv("scouts_book_navi_right")}this.buildBookPage("left",this.currentBookPage);this.buildBookPage("right",(this.currentBookPage+1))};scouts.prototype.buildBookPage=function(s,r){var q={};for(var d in this.data.config.animals){if(!q[this.data.config.animals[d].category]){q[this.data.config.animals[d].category]={}}q[this.data.config.animals[d].category][d]=this.data.config.animals[d]}var l="";var v=(r+(r-1));var w=(v+1);var m=0;var n=1;for(var c in q){for(var d in q[c]){m++;if(m>=v&&m<=w){var b=0;var a=this.data.config.animals[d].name;if(!this.data.data||!this.data.data.stats||!this.data.data.stats["animal_"+d]){b=1;a=t_fishing_unknown_fish}var u="";if(n==1){u="spacer"}l+='<div class="line '+u+'">';l+='  <div class="name">'+a+"</div>";if(b){l+='<div class="unknown">?</div>'}else{var e=0;if(this.data.data.stats&&this.data.data.stats["animal_"+d]){e=this.data.data.stats["animal_"+d]}l+='<div class="img scouts_animal_'+d+'">';for(var h=1;h<=4;h++){if(h<=e){continue}l+='<div class="tile tile'+h+'">';l+='  <div class="img scouts_animal_'+d+'"></div>';l+="</div>"}l+="</div>"}l+="</div>";n++}}}var t=this.getBookMaxPages();if(r<=t){l+='<div class="pager">'+r+"/"+t+"</div>"}$("scouts_book_side_"+s).innerHTML=l};scouts.prototype.closeBook=function(){hideDiv("scouts_book")};scouts.prototype.setFilter=function(a){var c=[];if(in_array(a,this.filters)){for(var b=0;b<this.filters.length;b++){if(this.filters[b]==a){continue}c.push(this.filters[b])}this.filters=c}else{this.filters.push(a)}this.buildShop()};scouts.prototype.buildShop=function(){var e='<div id="scouts_shop">';e+='  <div class="side stock">';e+='    <div class="head">'+t_scouts_shop_stock+"</div>";e+='    <div class="desc">'+t_scouts_shop_stock_desc+"</div>";var b=["durability","valid"];e+='    <div class="filter">';for(var c=0;c<b.length;c++){var r="";if(in_array(b[c],this.filters)){r="checked"}e+='<input id="scouts_shop_filter_'+b[c]+'" type="checkbox" '+r+" onclick=\"scouts.setFilter('"+b[c]+"')\">";e+="<div>"+t_scouts_shop_filter_name[b[c]]+"</div>"}e+="    </div>";e+='    <div class="slots">';if(this.data.items){var l=[];for(var a in this.data.items){if(in_array("valid",this.filters)){if(this.data.items[a].stock==0){continue}if((this.currentTask>0&&this.currentView=="map"&&this.data.tasks[this.currentTask])){if(!in_array(this.data.tasks[this.currentTask].type,this.data.config.items[this.data.items[a].type].skills)){continue}}}l.push(this.data.items[a])}if(in_array("durability",this.filters)){l.sort(function(v,t){var w=parseInt(v.durability);var u=parseInt(t.durability);if(w<u){return -1}if(w>u){return 1}return 0})}for(var c=0;c<l.length;c++){var s=l[c];if(!s.type){continue}var m="";var n="scouts.shopHoverItem(1, '"+s.type+"', "+s.id+");";var d="scouts.shopHoverItem(0, '"+s.type+"', "+s.id+");";var q="";if(this.currentTask>0&&this.currentView=="map"&&this.data.tasks[this.currentTask]){q="";if(in_array(this.data.tasks[this.currentTask].type,this.data.config.items[s.type].skills)){q="scouts.setTaskSupportSlot("+s.id+")"}else{m="off"}}if(s.stock==0){m="off";n+=" showDiv('scouts_shop_item"+s.id+"_stock_tt');";d+=" hideDiv('scouts_shop_item"+s.id+"_stock_tt');";q=""}e+='<div class="slot link" onclick="'+q+'" onmouseover="'+n+'" onmouseout="'+d+'">';e+='  <div class="img scouts_item_'+s.type+" "+m+'"></div>';e+='  <div class="durability">'+s.durability+"</div>";e+='  <div id="scouts_shop_item'+s.id+'_stock_tt" class="ttbox notavailable">'+t_scouts_shop_not_available+"</div>";e+="</div>"}}e+="    </div>";e+="  </div>";e+='  <div class="side merchant">';e+='    <div class="head">'+t_scouts_shop_merchant+"</div>";e+='    <div class="desc">'+t_scouts_shop_merchant_desc+"</div>";e+='    <div class="slots">';if(this.currentTask>0&&this.currentView=="map"&&this.data.tasks[this.currentTask]){e+='<div class="matched">';e+='  <div class="scouts_badge '+this.data.tasks[this.currentTask].type+'"></div>';e+="  <div>"+t_scouts_shop_category_match+"</div>";for(var c in this.data.config.items){if(!in_array(this.data.tasks[this.currentTask].type,this.data.config.items[c].skills)){continue}e+=this.showShopItem(c,h);h++}e+='  <div class="clear"></div>';e+="</div>"}var h=1;for(var c in this.data.config.items){if(this.currentTask>0&&this.currentView=="map"&&this.data.tasks[this.currentTask]&&in_array(this.data.tasks[this.currentTask].type,this.data.config.items[c].skills)){continue}e+=this.showShopItem(c,h);h++}e+='      <div class="clear"></div>';e+="    </div>";e+='    <div id="scouts_shop_item_tt" class="ttbox"></div>';e+="  </div>";e+='  <div class="clear"></div>';e+="</div>";globalBoxFlex("",e,0,0,1);$("globalbox").style.top="40px";if(!this.data.data.tutorial||!this.data.data.tutorial.shop){}};scouts.prototype.showShopItem=function(b,d){var n=this.data.config.items[b];var q="scouts.shopBuyCommit('"+b+"')";var m="";if(d>4){m="bottom"}var l="";if(n.money){if(parseInt(n.money)>parseInt(user_bar)){l="important";q=""}var a=formatPrice(n.money)}if(n.coins){var r=n.coins;var e="";var h=specialbonus.findBonus({key1:"scouts",key2:"buyshopitem"});if(h&&h.buyshopitem){r=Math.ceil(r*(1-h.buyshopitem));e="color:green; font-weight:bold;"}if(parseInt(r)>parseInt(user_coins)){l="important";q=""}var a='<span style="'+e+'">'+r+"&nbsp;"+t_coins+"</span>"}var c="";c+='<div class="slot link" onclick="'+q+'" onmouseover="scouts.shopHoverItem(1, \''+b+"')\" onmouseout=\"scouts.shopHoverItem(0, '"+b+"')\">";c+='  <div id="scouts_itemshop_item'+b+'_img" class="img scouts_item_'+b+'"></div>';c+='  <div class="price '+l+'">'+a+"</div>";c+="</div>";return c};scouts.prototype.shopHoverItem=function(a,b,c){$("scouts_shop_item_tt").removeClassName("left");if(a==1){if(c>0){$("scouts_shop_item_tt").addClassName("left")}$("scouts_itemshop_item"+b+"_img").addClassName("hover");$("scouts_shop_item_tt").innerHTML=this.itemTT(b,c);showDiv("scouts_shop_item_tt")}else{$("scouts_itemshop_item"+b+"_img").removeClassName("hover");hideDiv("scouts_shop_item_tt")}};scouts.prototype.shopBuyCommit=function(d){var b='<div id="scouts_itemshop_commit">';b+='<div class="slot">';b+='  <div class="img scouts_item_'+d+'"></div>';b+="</div>";b+='<div class="name">'+this.data.config.items[d].name+"</div>";if(this.data.config.items[d].money&&this.data.config.items[d].money>0){b+="<div>"+t_scouts_shop_buy_body.replace("%COST%",formatPrice(this.data.config.items[d].money))+"</div>"}if(this.data.config.items[d].coins&&this.data.config.items[d].coins>0){var a=this.data.config.items[d].coins;var l="";var h="";var c=specialbonus.findBonus({key1:"scouts",key2:"buyshopitem"});if(c&&c.buyshopitem){a=Math.ceil(a*(1-c.buyshopitem));l="color:green; font-weight:bold;";h=specialbonus.htmlBonusLine(c.buyshopitem)}b+="<div>"+t_scouts_shop_buy_body.replace("%COST%",'<span style="'+l+'">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";if(h!=""){b+=h}}var e="scouts.shopBuy('"+d+"')";globalcommitbox(t_scouts_shop_buy_head,b,e,"scouts.buildShop()")};scouts.prototype.buildProduction=function(){var a="";a+='  <div id="scouts_pharmacist" class="link" onmouseover="showDiv(\'scouts_pharmacist_tt\')" onmouseout="hideDiv(\'scouts_pharmacist_tt\')">';a+='    <div id="scouts_pharmacist_timer"></div>';a+='    <div id="scouts_pharmacist_tt" class="ttbox">';a+="      <div>"+t_scouts_pharmacist_buy_head+'</div><div class="bonusinfo">'+t_scouts_pharmacist_info+"</div>";a+="    </div>";a+='    <div class="scouts_pharmacist"></div>';a+='    <div id="scouts_pharmacist_unlocked" class="unlocked"></div>';a+="  </div>";a+='<div id="scouts_slots" class="slots">';for(var b=1;b<=4;b++){a+=production.buildSlot("scouts",b)}a+='  <div class="clear"></div>';a+="</div>";a+='<div class="scroller left link" onclick="scouts.setView(\'map\')" onmouseover="showDiv(\'scouts_scroller_production_tt\')" onmouseout="hideDiv(\'scouts_scroller_production_tt\')">';a+='  <div id="scouts_scroller_production_tt" class="ttbox">'+t_scouts_goto_map+"</div>";a+="</div>";$("scouts_production").innerHTML=a};scouts.prototype.updateProductionSlot=function(b,a){production.updateSlot("scouts",b,a,this.data)};scouts.prototype.buyProductionSlotCommit=function(a){production.buySlotCommit("scouts",a,this.data.data.slots[a])};scouts.prototype.getCurrentProductionPosition=function(a){return production.currentQueueSlot("scouts",a)};scouts.prototype.buyPharmacistCommit=function(a){production.buyQueueCommit("scouts",a)};scouts.prototype.productionSelectionCommit=function(b){var d="scouts.startProduction("+b+")";var c="scouts.productionSelection()";var a='<div id="scouts_production_selection_commit">';a+='  <div class="img tt'+b+'"></div>';a+='  <div class="name">'+produkt_name[b]+"</div>";if(this.data.config.products[b].money&&this.data.config.products[b].money>0){var e=formatPrice(this.data.config.products[b].money)}if(this.data.config.products[b].coins&&this.data.config.products[b].coins>0){var e=this.data.config.products[b].coins+"&nbsp;"+t_coins}a+="  <div>"+cityadcost+e+"</div>";a+="</div>";globalcommitbox(t_start_production,a,d,c)};scouts.prototype.setProductionSelectionFilter=function(a){this.productionSelectionFilter=a;this.productionSelectionPage=1;this.productionSelection()};scouts.prototype.productionSelection=function(c){if(!c){c=this.productionSlot}else{this.productionSlot=c}var v=((this.productionSelectionPage-1)*4)+1;var b=(this.productionSelectionPage*4);var e=0;var m='<div id="scouts_production_selection">';var n=["sandwich","cookie","muffin","chocolate","none"];m+='<div class="filters">';for(var w=0;w<n.length;w++){var d="";if(this.productionSelectionFilter==n[w]){d="active"}m+='<div class="filter link '+d+'" onclick="scouts.setProductionSelectionFilter(\''+n[w]+"')\" onmouseover=\"showDiv('scouts_production_selection_filter_"+n[w]+"_tt')\" onmouseout=\"hideDiv('scouts_production_selection_filter_"+n[w]+"_tt')\">";m+='  <div class="img '+n[w]+'"></div>';if(n[w]=="none"){m+='<div class="none sandwich"></div>';m+='<div class="none cookie"></div>';m+='<div class="none muffin"></div>';m+='<div class="none chocolate"></div>'}m+='  <div id="scouts_production_selection_filter_'+n[w]+'_tt" class="ttbox">'+t_scouts_production_selection_filter[n[w]]+"</div>";m+="</div>"}m+="</div>";var l=0;if(specialbonus){l=specialbonus.findBonus({key1:"scouts",key2:"harvest"})}for(var t in this.data.data.sorted){var r=t.replace("p","");if(this.productionSelectionFilter!="none"&&this.productionSelectionFilter!=this.data.config.products[r].category){continue}e++;if(e>=v&&e<=b){var s=0;var u="scouts.productionSelectionCommit("+r+")";if(this.data.config.products[r].level&&this.data.config.products[r].level>this.data.data.level){u="";s=1}if(this.data.config.products[r].needs){for(var w in this.data.config.products[r].needs){var h=checkRackItem(w);if(this.data.config.products[r].needs[w]>h){u=""}}}var A="";var z="";if(this.data.config.products[r].money&&this.data.config.products[r].money>0){if(this.data.config.products[r].money>user_bar){A="important";u=""}z=formatPrice(this.data.config.products[r].money)}if(this.data.config.products[r].coins&&this.data.config.products[r].coins>0){if(this.data.config.products[r].coins>user_coins){A="important";u=""}z=this.data.config.products[r].coins+"&nbsp;"+t_coins}m+='<div class="slot" onclick="'+u+'">';m+='  <div class="img tt'+r+'"></div>';m+='  <div class="info">';var h=this.data.config.products[r].amount;var q="";var d="";if(l&&l.harvest){h+=l.harvest;q='<div style="color:green; font-weight:normal;">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+l.harvest)+")</div>";d="specialbonus"}m+='    <div class="name line '+d+'">'+h+"x "+produkt_name[r]+q+"</div>";if(this.data.config.products[r].category){m+='<div class="type">'+t_scouts_product_category[this.data.config.products[r].category]+"</div>"}m+='<div class="energy">';m+='  <div class="icon"></div>';m+='  <div class="amount">'+this.data.config.products[r].energy+"</div>";m+='  <div class="clear"></div>';m+="</div>";if(this.data.config.products[r].xp_bonus){m+='<div class="line">'+t_scouts_bonus.xp_bonus.replace("%PERCENT%",Math.round(this.data.config.products[r].xp_bonus*100))+"</div>"}if(this.data.config.products[r].skillxp_bonus){m+='<div class="line">'+t_scouts_bonus.skillxp_bonus.replace("%PERCENT%",Math.round(this.data.config.products[r].skillxp_bonus*100))+"</div>"}if(this.data.config.products[r].money_bonus){m+='<div class="line">'+t_scouts_bonus.money_bonus.replace("%PERCENT%",Math.round(this.data.config.products[r].money_bonus*100))+"</div>"}if(this.data.config.products[r].points_bonus){m+='<div class="line">'+t_scouts_bonus.points_bonus.replace("%PERCENT%",Math.round(this.data.config.products[r].points_bonus*100))+"</div>"}if(this.data.config.products[r].scoutspoints_bonus){m+='<div class="line">'+t_scouts_bonus.scoutspoints_bonus.replace("%PERCENT%",Math.round(this.data.config.products[r].scoutspoints_bonus*100)).replace("%NAME%",t_scouts_points)+"</div>"}if(this.data.config.products[r].popularity_bonus){m+='<div class="line">'+t_scouts_bonus.popularity_bonus.replace("%PERCENT%",Math.round(this.data.config.products[r].popularity_bonus*100))+"</div>"}if(s){m+='<div class="important">'+t_scouts_requires_level.replace("%COUNT%",this.data.config.products[r].level)+"</div>"}else{m+='  <div class="clear"></div>';m+="</div>"}if(!s){var a=this.data.config.products[r].duration;var q="";if(this.data.questbonus&&this.data.questbonus.bonus_productiontime&&this.data.questbonus.bonus_productiontime>0){a=Math.ceil(a*(1-this.data.questbonus.bonus_productiontime));q='<span style="color:green">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(this.data.questbonus.bonus_productiontime*100))+")</span>"}m+='<div class="needs">';m+='  <div class="intro">'+t_needs+":</div>";m+='  <div class="intro_block">';m+="     <div>"+formatTime(a)+" "+q+"</div>";m+='     <div class="cost '+A+'">'+z+"</div>";m+="  </div>";m+='  <div class="clear"></div>';for(var w in this.data.config.products[r].needs){var h=checkRackItem(w);var d="";if(this.data.config.products[r].needs[w]>h){d="important"}m+='<div class="product '+d+'" onmouseover="showDiv(\'scouts_productionselection_pid'+r+"_"+w+"')\" onmouseout=\"hideDiv('scouts_productionselection_pid"+r+"_"+w+"')\">";m+='  <div class="l'+w+'" style="border-radius:5px;"></div>';m+='  <div style="font-weight:bold;">'+this.data.config.products[r].needs[w]+"x</div>";m+='  <div id="scouts_productionselection_pid'+r+"_"+w+'" class="ttbox">'+produkt_name[w]+"</div>";m+="</div>"}}m+="</div>";if(s){m+='<div class="locked"></div>'}m+="</div>"}}m+='  <div class="clear"></div>';m+='  <div id="scouts_production_selection_navi_up" onclick="scouts.productionSelectionNavi(-1, '+e+')"></div>';m+='  <div id="scouts_production_selection_navi_down" onclick="scouts.productionSelectionNavi(1, '+e+')"></div>';m+="</div>";globalBoxFlex(t_choose_to_produce,m,0,0,1);$("globalbox").style.top="40px";this.productionSelectionNavi(0,e)};scouts.prototype.productionSelectionNavi=function(b,c){var a=parseInt(Math.ceil(c/4));this.productionSelectionPage+=b;if(this.productionSelectionPage<1){this.productionSelectionPage=1}if(this.productionSelectionPage>a){this.productionSelectionPage=a}if(b){this.productionSelection()}hideDiv("scouts_production_selection_navi_up");hideDiv("scouts_production_selection_navi_down");if(this.productionSelectionPage>1){showDiv("scouts_production_selection_navi_up")}if(this.productionSelectionPage<a){showDiv("scouts_production_selection_navi_down")}};scouts.prototype.showQuest=function(){htmlQuestBox("scouts");this.timerUpdate()};scouts.prototype.questEntryCommit=function(c){for(var h in this.data.quest.products){if(h==c){var d=this.data.quest.products[c];if(this.data.quest.data&&this.data.quest.data[c]){var d=(d-this.data.quest.data[c])}break}}var a=checkRackItem(c);var b="kp"+c;if(a>d){a=d}var e={pid:c};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(e),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("scouts.checkQuestEntry("+c+", "+d+")");$("dialog_entryline_number").onkeyup=new Function("scouts.checkQuestEntry("+c+", "+d+")");this.checkQuestEntry(c,d)};scouts.prototype.checkQuestEntry=function(a,c){var e=checkRackItem(a);var b="product";var d={type:b,stockamount:e,rest:c,click:"scouts.questEntry("+a+")"};checkEntryLine(d)};scouts.prototype.showStats=function(){var a='<div id="scouts_stats">';a+='  <div class="select_line">';a+='    <select id="scouts_stats_select" onchange="scouts.stats()">';for(var b=0;b<this.stats_options.length;b++){if(this.stats_options[b]==""){a+='<option value="0">---</option>';continue}var c="";if(this.stats_select==this.stats_options[b]){c="selected"}a+='<option value="'+this.stats_options[b]+'" '+c+">"+t_scouts_stats[this.stats_options[b]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_scouts_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select],this.stats_select,"scouts");a+="</div>";globalBoxFlex("",a,0,0,1)};scouts.prototype.timer=function(){if(this.data){if(this.data.data&&this.data.data.queue_remain){this.data.data.queue_remain--}if($("scouts")){for(var c=1;c<=4;c++){var b=this.getCurrentProductionPosition(c);this.updateProductionSlot(c,b)}if(this.data.tasks){for(var a in this.data.tasks){this.data.tasks[a].remain--}}}if(this.data.quest&&this.data.quest.remain){this.data.quest.remain--}if(this.data.data){this.data.data.newtasks_remain--}this.timerUpdate()}};scouts.prototype.timerUpdate=function(){production.buildOuterProductionLine("scouts");production.updateQueue("scouts");for(var e=1;e<=4;e++){if($("scouts_pharmacist_slots"+e)){$("scouts_pharmacist_slots"+e).removeClassName("right")}var d=this.getCurrentProductionPosition(e);if(this.data&&this.data.production&&this.data.production[e]){this.data.production[e]["gone"]++;if(this.data.production[e][d]){this.data.production[e][d].remain--}}if(this.data&&this.data.data&&this.data.data.slots&&this.data.data.slots[e]&&this.data.data.slots[e].rent_remain){this.data.data.slots[e].rent_remain--;if(!this.data.data.slots[e].rent_remain){this.data.data.slots[e].rent_remain--}if(this.data.data.slots[e].rent_remain>0&&$("scouts_pharmacist_slots"+e)){$("scouts_pharmacist_slots"+e).addClassName("right")}}}if(this.data.tasks){for(var b in this.data.tasks){hideDiv("scouts_task"+b+"_timer");hideDiv("scouts_task"+b+"_speedup");hideDiv("scouts_task"+b+"_ready");if(this.data.tasks[b].startdate>0&&$("scouts_task"+b+"_timer")){showDiv("scouts_task"+b+"_timer");if(this.data.tasks[b].remain>0){$("scouts_task"+b+"_timer").innerHTML=formatTime(this.data.tasks[b].remain);if($("scouts_taskinfo"+b+"_timer")&&parseInt(this.currentTask)==parseInt(b)){$("scouts_taskinfo"+b+"_timer").innerHTML=formatTime(this.data.tasks[b].remain)}showDiv("scouts_task"+b+"_speedup");if($("scouts_taskinfo"+b+"_speedup")&&parseInt(this.currentTask)==parseInt(b)){var a=Math.ceil(this.data.tasks[b].remain/this.data.config.constants.task_speedup_seconds2coin);$("scouts_taskinfo"+b+"_speedup").innerHTML=t_scouts_task_speedup_button.replace("%COINS%",a)}}else{$("scouts_task"+b+"_timer").innerHTML=statusProductionComplete;showDiv("scouts_task"+b+"_ready")}}}}if(this.data.quest&&!this.data.quest.end){if(this.data.quest.remain>0){showDiv("scouts_quest_timer");hideDiv("scouts_quest_data");if($("scouts_quest_timer")){$("scouts_quest_timer").innerHTML=formatTime(this.data.quest.remain)}}else{hideDiv("scouts_quest_timer");showDiv("scouts_quest_data")}}if($("scouts_newtasks_timer")&&this.data.data){if(this.data.data.newtasks_remain>0){$("scouts_newtasks_timer").innerHTML=formatTime(this.data.data.newtasks_remain)}else{var c=(86400+this.data.data.newtasks_remain);$("scouts_newtasks_timer").innerHTML=formatTime(c)}}};scouts.prototype.showTutorial=function(a){if(this.data.data.tutorial&&this.data.data.tutorial[a]){return 1}this.tutorialStep=0;showDiv("scouts_tutorial");this.nextTutorialStep(a)};scouts.prototype.nextTutorialStep=function(b){this.tutorialStep++;if(!t_scouts_tutorial_text[b]||!t_scouts_tutorial_text[b][this.tutorialStep]){this.closeTutorial();return 1}var d="scouts.nextTutorialStep('"+b+"')";var c=t_continue;if(!t_scouts_tutorial_text[b][(this.tutorialStep+1)]){d="scouts.closeTutorial(); scouts.setTutorialStep('"+b+"');";c=t_vineyard_tutorial_text_finish}var e=t_scouts_tutorial_text[b][this.tutorialStep];e=e.replace("%USERNAME%","<b>"+username+"</b>");var a="";a+=e;a+='<div id="scouts_tutorial_footer" class="footer"><button class="button_new link" onclick="'+d+'">'+c+"</button></div>";$("scouts_tutorial_bubble").innerHTML=a;this.manipulateTutorial(b,this.tutorialStep)};scouts.prototype.manipulateResetTutorial=function(){if($("scouts_tutorial")){$("scouts_tutorial").className="tutorial"}if($("scouts_scoutslot1")){$("scouts_scoutslot1").removeClassName("tutorial_hightlight").removeClassName("pulse")}showDiv("scouts_tutorial_footer");if($("scouts_task2")){$("scouts_task2").removeClassName("tutorial_hightlight").removeClassName("pulse")}if($("scouts_popularitymeter")){$("scouts_popularitymeter").removeClassName("tutorial_hightlight").removeClassName("pulse")}};scouts.prototype.manipulateTutorial=function(a,c){this.manipulateResetTutorial();if(a=="start"&&c==2){$("scouts_tutorial").addClassName("right");$("scouts_scoutslot1").addClassName("tutorial_hightlight").addClassName("pulse");hideDiv("scouts_tutorial_footer")}if(a=="newscout"&&c==2){$("scouts_tutorial").addClassName("right");$("scouts_task2").addClassName("tutorial_hightlight").addClassName("pulse");$("scouts_task2").onmouseover=new Function();var b=$("scouts_task2").getAttribute("onclick");$("scouts_task2").onclick=new Function(b+"; scouts.closeTutorial();");hideDiv("scouts_tutorial_footer")}if(a=="finished"&&c==1){$("scouts_tutorial").addClassName("right");$("scouts_popularitymeter").addClassName("tutorial_hightlight").addClassName("pulse")}};scouts.prototype.setTutorialStep=function(a){this.setTutorial(a)};scouts.prototype.closeTutorial=function(){this.manipulateResetTutorial();hideDiv("scouts_tutorial")};scouts.prototype.itemTT=function(b,e){var d=this.data.config.items[b];var c=d.durability;if(e>0&&this.data.items[e]){c=this.data.items[e].durability+"/"+d.durability}var a="";a+='<div class="scouts_iteminfo">';a+='  <div class="name">'+d.name+"</div>";if(d.durability){a+='<div class="dur">'+t_megafield_vehicle_durability+c+"</div>"}a+='  <div class="desc2 line">'+t_scouts_item_used_to+"</div>";a+='  <div class="skills">';for(var b=0;b<d.skills.length;b++){a+='<div class="skill">';a+='  <div class="img scouts_badge '+d.skills[b]+'"></div>';a+='  <div class="name">'+t_scouts_skill_name[d.skills[b]]+"</div>";a+='  <div class="clear"></div>';a+="</div>"}a+="  </div>";a+='  <div class="line desc2">'+t_scouts_item_bonus+"</div>";if(d.points_bonus){a+='<div class="line">'+t_scouts_bonus.points_bonus.replace("%PERCENT%",Math.round(d.points_bonus*100))+"</div>"}if(d.money_bonus){a+='<div class="line">'+t_scouts_bonus.money_bonus.replace("%PERCENT%",Math.round(d.points_bonus*100))+"</div>"}if(d.scoutspoints_bonus){a+='<div class="line">'+t_scouts_bonus.scoutspoints_bonus.replace("%PERCENT%",Math.round(d.points_bonus*100)).replace("%NAME%",t_scouts_points)+"</div>"}if(d.skill_bonus){a+='<div class="skills">';for(var b in d.skill_bonus){a+='<div class="skill">';a+='  <div class="img scouts_badge '+b+'"></div>';a+='  <div class="name desc">+'+Math.round(d.skill_bonus[b]*100)+"% "+t_scouts_skillxp+"</div>";a+='  <div class="clear"></div>';a+="</div>"}a+="</div>"}a+="</div>";return a};scouts.prototype.productTT=function(a){var c=this.data.config.products[a];var b='<div id="scouts_productinfo">';b+='  <div class="name">'+produkt_name[a]+"</div>";b+='  <div class="energy2">';b+='    <div class="icon"></div>';b+='    <div class="count">'+c.energy+"</div>";b+='    <div class="clear"></div>';b+="  </div>";if(c.xp_bonus||c.skillxp){b+='<div class="head">'+t_scouts_product_bonus_feed+"</div>";if(c.xp_bonus){b+='<div class="line">'+t_scouts_bonus.xp_bonus.replace("%PERCENT%",Math.round(c.xp_bonus*100))+"</div>"}if(c.skillxp_bonus){b+='<div class="line">'+t_scouts_bonus.skillxp_bonus.replace("%PERCENT%",Math.round(c.skillxp_bonus*100))+"</div>"}}if(c.money_bonus||c.points_bonus||c.scoutspoints_bonus||c.popularity_bonus){b+='<div class="head">'+t_scouts_product_bonus_sale+"</div>";if(c.money_bonus){b+='<div class="line">'+t_scouts_bonus.money_bonus.replace("%PERCENT%",Math.round(c.money_bonus*100))+"</div>"}if(c.points_bonus){b+='<div class="line">'+t_scouts_bonus.points_bonus.replace("%PERCENT%",Math.round(c.points_bonus*100))+"</div>"}if(c.scoutspoints_bonus){b+='<div class="line">'+t_scouts_bonus.scoutspoints_bonus.replace("%PERCENT%",Math.round(c.scoutspoints_bonus*100)).replace("%NAME%",t_scouts_points)+"</div>"}if(c.popularity_bonus){b+='<div class="line">'+t_scouts_bonus.popularity_bonus.replace("%PERCENT%",Math.round(c.popularity_bonus*100))+"</div>"}}b+="</div>";return b};scouts.prototype.buildScoutImg=function(d){var c='<div class="scout_portrait">';for(var b in d){if(b=="skin"){continue}var a="part "+b+" "+b+d[b];if(b=="shape"){a+=" skin"+d.skin}c+='<div class="'+a+'"></div>'}c+="</div>";return c};scouts.prototype.showTutorialChar=function(a,b){$("scouts_tutorial_char").className="tutorial_char "+a;$("scouts_tutorial_char_bubble").innerHTML=b;showDiv("scouts_tutorial_char")};scouts.prototype.hideTutorialChar=function(){hideDiv("scouts_tutorial_char")};scouts.prototype.help=function(){openFarmersMarketHowTo("scouts",1);this.helpNavi()};scouts.prototype.helpNavi=function(c){var b=["general","tasks"];if(!c){c="general"}for(var a=0;a<b.length;a++){$("scouts_help_navi_tab_"+b[a]).removeClassName("active");hideDiv("scouts_help_"+b[a])}$("scouts_help_navi_tab_"+c).addClassName("active");showDiv("scouts_help_"+c)};scouts.prototype.close=function(){scouts.closeTutorial();hideDiv("transp");hideDiv("farmersmarket_pos11_inner")};var Scriptaculous={Version:"1.9.0",require:function(b){return;try{document.write('<script type="text/javascript" src="'+b+'"><\/script>')}catch(c){var a=document.createElement("script");a.type="text/javascript";a.src=b;document.getElementsByTagName("head")[0].appendChild(a)}},REQUIRED_PROTOTYPE:"1.6.0.3",load:function(){function a(c){var d=c.replace(/_.*|\./g,"");d=parseInt(d+"0".times(4-d.length));return c.indexOf("_")>-1?d-1:d}if((typeof Prototype=="undefined")||(typeof Element=="undefined")||(typeof Element.Methods=="undefined")||(a(Prototype.Version)<a(Scriptaculous.REQUIRED_PROTOTYPE))){throw ("script.aculo.us requires the Prototype JavaScript framework >= "+Scriptaculous.REQUIRED_PROTOTYPE)}var b=/scriptaculous\.js(\?.*)?$/;$$("script[src]").findAll(function(c){return c.src.match(b)}).each(function(d){var e=d.src.replace(b,""),c=d.src.match(/\?.*load=([a-z,]*)/);(c?c[1]:"builder,effects,dragdrop,controls,slider,sound").split(",").each(function(h){Scriptaculous.require(e+h+".js")})})}};Scriptaculous.load();String.prototype.parseColor=function(){var a="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(",");var b=0;do{a+=parseInt(c[b]).toColorPart()}while(++b<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var b=1;b<4;b++){a+=(this.charAt(b)+this.charAt(b)).toLowerCase()}}if(this.length==7){a=this.toLowerCase()}}}return(a.length==7?a:(arguments[0]||this))};Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return(b.nodeType==3?b.nodeValue:(b.hasChildNodes()?Element.collectTextNodes(b):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return(c.nodeType==3?c.nodeValue:((c.hasChildNodes()&&!Element.hasClassName(c,b))?Element.collectTextNodesIgnoreClass(c,b):""))}).flatten().join("")};Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:(b/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(b){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return(-Math.cos(a*Math.PI)/2)+0.5},reverse:function(a){return 1-a},flicker:function(a){var a=((-Math.cos(a*Math.PI)/4)+0.75)+Math.random()/4;return a>1?1:a},wobble:function(a){return(-Math.cos(a*Math.PI*(9*a))/2)+0.5},pulse:function(b,a){return(-Math.cos((b*((a||5)-0.5)*2)*Math.PI)/2)+0.5},spring:function(a){return 1-(Math.cos(a*4.5*Math.PI)*Math.exp(-a*6))},none:function(a){return 0},full:function(a){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE){b+=";zoom:1"}a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(d){a.insertBefore(new Element("span",{style:b}).update(d==" "?String.fromCharCode(160):d),c)});Element.remove(c)}})},multiple:function(b,c){var e;if(((typeof b=="object")||Object.isFunction(b))&&(b.length)){e=b}else{e=$(b).childNodes}var a=Object.extend({speed:0.1,delay:0},arguments[2]||{});var d=a.delay;$A(e).each(function(l,h){new c(l,Object.extend(a,{delay:h*a.speed+d}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(b,c,a){b=$(b);c=(c||"appear").toLowerCase();return Effect[Effect.PAIRS[c][b.visible()?1:0]](b,Object.extend({queue:{position:"end",scope:(b.id||"global"),limit:1}},a||{}))}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(b){var c=new Date().getTime();var a=Object.isString(b.options.queue)?b.options.queue:b.options.queue.position;switch(a){case"front":this.effects.findAll(function(d){return d.state=="idle"}).each(function(d){d.startOn+=b.finishOn;d.finishOn+=b.finishOn});break;case"with-last":c=this.effects.pluck("startOn").max()||c;break;case"end":c=this.effects.pluck("finishOn").max()||c;break}b.startOn+=c;b.finishOn+=c;if(!b.options.queue.limit||(this.effects.length<b.options.queue.limit)){this.effects.push(b)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var c=new Date().getTime();for(var b=0,a=this.effects.length;b<a;b++){this.effects[b]&&this.effects[b].loop(c)}}});Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a)){return a}return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===false){a.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function b(d,c){if(d.options[c+"Internal"]){d.options[c+"Internal"](d)}if(d.options[c]){d.options[c](d)}}return function(c){if(this.state==="idle"){this.state="running";b(this,"beforeSetup");if(this.setup){this.setup()}b(this,"afterSetup")}if(this.state==="running"){c=(this.options.transition(c)*this.fromToDelta)+this.options.from;this.position=c;b(this,"beforeUpdate");if(this.update){this.update(c)}b(this,"afterUpdate")}}})();this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(c){if(c>=this.startOn){if(c>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return}var b=(c-this.startOn)/this.totalTime,a=(b*this.totalFrames).round();if(a>this.currentFrame){this.render(b);this.currentFrame=a}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(a){if(this.options[a+"Internal"]){this.options[a+"Internal"](this)}if(this.options[a]){this.options[a](this)}},inspect:function(){var a=$H();for(property in this){if(!Object.isFunction(this[property])){a.set(property,this[property])}}return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(a){this.effects=a||[];this.start(arguments[1])},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");if(b.finish){b.finish(a)}b.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(c,h,e){c=Object.isString(c)?$(c):c;var b=$A(arguments),d=b.last(),a=b.length==5?b[3]:null;this.method=Object.isFunction(d)?d.bind(c):Object.isFunction(c[d])?c[d].bind(c):function(l){c[d]=l};this.start(Object.extend({from:h,to:e},a||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var a=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(a)},update:function(a){this.element.setOpacity(a)}});Effect.Move=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(a)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(b,a,c){return new Effect.Move(b,Object.extend({x:c,y:a},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(b,c){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:c},arguments[2]||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(a){var b=(this.options.scaleFrom/100)+(this.factor*a);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}this.setDimensions(this.dims[0]*b,this.dims[1]*b)},finish:function(a){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(a,e){var h={};if(this.options.scaleX){h.width=e.round()+"px"}if(this.options.scaleY){h.height=a.round()+"px"}if(this.options.scaleFromCenter){var c=(a-this.dims[0])/2;var b=(e-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){h.top=this.originalTop-c+"px"}if(this.options.scaleX){h.left=this.originalLeft-b+"px"}}else{if(this.options.scaleY){h.top=-c+"px"}if(this.options.scaleX){h.left=-b+"px"}}}this.element.setStyle(h)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(a)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+((this._base[d]+(this._delta[d]*a)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(c){var b=arguments[1]||{},a=document.viewport.getScrollOffsets(),d=$(c).cumulativeOffset();if(b.offset){d[1]+=b.offset}return new Effect.Tween(null,a.top,d[1],b,function(e){scrollTo(a.left,e.round())})};Effect.Fade=function(c){c=$(c);var a=c.getInlineOpacity();var b=Object.extend({from:c.getOpacity()||1,to:0,afterFinishInternal:function(d){if(d.options.to!=0){return}d.element.hide().setStyle({opacity:a})}},arguments[1]||{});return new Effect.Opacity(c,b)};Effect.Appear=function(b){b=$(b);var a=Object.extend({from:(b.getStyle("display")=="none"?0:b.getOpacity()||0),to:1,afterFinishInternal:function(c){c.element.forceRerendering()},beforeSetup:function(c){c.element.setOpacity(c.options.from).show()}},arguments[1]||{});return new Effect.Opacity(b,a)};Effect.Puff=function(b){b=$(b);var a={opacity:b.getInlineOpacity(),position:b.getStyle("position"),top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};return new Effect.Parallel([new Effect.Scale(b,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(c){Position.absolutize(c.effects[0].element)},afterFinishInternal:function(c){c.effects[0].element.hide().setStyle(a)}},arguments[1]||{}))};Effect.BlindUp=function(a){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(b){b=$(b);var a=b.getDimensions();return new Effect.Scale(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){c.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(b){b=$(b);var a=b.getInlineOpacity();return new Effect.Appear(b,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(c){new Effect.Scale(c.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(d){d.element.makePositioned().makeClipping()},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned().setStyle({opacity:a})}})}},arguments[1]||{}))};Effect.DropOut=function(b){b=$(b);var a={top:b.getStyle("top"),left:b.getStyle("left"),opacity:b.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(b,{x:0,y:100,sync:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(c){c.effects[0].element.makePositioned()},afterFinishInternal:function(c){c.effects[0].element.hide().undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.Shake=function(d){d=$(d);var b=Object.extend({distance:20,duration:0.5},arguments[1]||{});var e=parseFloat(b.distance);var c=parseFloat(b.duration)/10;var a={top:d.getStyle("top"),left:d.getStyle("left")};return new Effect.Move(d,{x:e,y:0,duration:c,afterFinishInternal:function(h){new Effect.Move(h.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(l){new Effect.Move(l.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(m){new Effect.Move(m.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(n){new Effect.Move(n.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(q){new Effect.Move(q.element,{x:-e,y:0,duration:c,afterFinishInternal:function(r){r.element.undoPositioned().setStyle(a)}})}})}})}})}})}})};Effect.SlideDown=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.SlideUp=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};Effect.Grow=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var l=c.getDimensions();var m,h;var e,d;switch(b.direction){case"top-left":m=h=e=d=0;break;case"top-right":m=l.width;h=d=0;e=-l.width;break;case"bottom-left":m=e=0;h=l.height;d=-l.height;break;case"bottom-right":m=l.width;h=l.height;e=-l.width;d=-l.height;break;case"center":m=l.width/2;h=l.height/2;e=-l.width/2;d=-l.height/2;break}return new Effect.Move(c,{x:m,y:h,duration:0.01,beforeSetup:function(n){n.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(n){new Effect.Parallel([new Effect.Opacity(n.element,{sync:true,to:1,from:0,transition:b.opacityTransition}),new Effect.Move(n.element,{x:e,y:d,sync:true,transition:b.moveTransition}),new Effect.Scale(n.element,100,{scaleMode:{originalHeight:l.height,originalWidth:l.width},sync:true,scaleFrom:window.opera?1:0,transition:b.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(q){q.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(q){q.effects[0].element.undoClipping().undoPositioned().setStyle(a)}},b))}})};Effect.Shrink=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var h=c.getDimensions();var e,d;switch(b.direction){case"top-left":e=d=0;break;case"top-right":e=h.width;d=0;break;case"bottom-left":e=0;d=h.height;break;case"bottom-right":e=h.width;d=h.height;break;case"center":e=h.width/2;d=h.height/2;break}return new Effect.Parallel([new Effect.Opacity(c,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(c,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(c,{x:e,y:d,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(l){l.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(l){l.effects[0].element.hide().undoClipping().undoPositioned().setStyle(a)}},b))};Effect.Pulsate=function(c){c=$(c);var b=arguments[1]||{},a=c.getInlineOpacity(),e=b.transition||Effect.Transitions.linear,d=function(h){return 1-e((-Math.cos((h*(b.pulses||5)*2)*Math.PI)/2)+0.5)};return new Effect.Opacity(c,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(h){h.element.setStyle({opacity:a})}},b),{transition:d}))};Effect.Fold=function(b){b=$(b);var a={top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};b.makeClipping();return new Effect.Scale(b,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(c){new Effect.Scale(b,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(d){d.element.hide().undoClipping().setStyle(a)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(c){this.element=$(c);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(a.style)){this.style=$H(a.style)}else{if(a.style.include(":")){this.style=a.style.parseStyle()}else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var b=this.element.getStyles();this.style=this.style.reject(function(d){return d.value==b[d.key]});a.afterFinishInternal=function(d){d.element.addClassName(d.options.style);d.transforms.each(function(e){d.element.style[e.style]=""})}}}this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b)){b="#ffffff"}b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(l){var h=l[0],e=l[1],d=null;if(e.parseColor("#zzzzzz")!="#zzzzzz"){e=e.parseColor();d="color"}else{if(h=="opacity"){e=parseFloat(e);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(e)){var c=e.match(/^([\+\-]?[0-9\.]+)(.*)$/);e=parseFloat(c[1]);d=(c.length==3)?c[2]:null}}}var b=this.element.getStyle(h);return{style:h.camelize(),originalValue:d=="color"?a(b):parseFloat(b||0),targetValue:d=="color"?a(e):e,unit:d}}.bind(this)).reject(function(b){return((b.originalValue==b.targetValue)||(b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))))})},update:function(a){var d={},b,c=this.transforms.length;while(c--){d[(b=this.transforms[c]).style]=b.unit=="color"?"#"+(Math.round(b.originalValue[0]+(b.targetValue[0]-b.originalValue[0])*a)).toColorPart()+(Math.round(b.originalValue[1]+(b.targetValue[1]-b.originalValue[1])*a)).toColorPart()+(Math.round(b.originalValue[2]+(b.targetValue[2]-b.originalValue[2])*a)).toColorPart():(b.originalValue+(b.targetValue-b.originalValue)*a).toFixed(3)+(b.unit===null?"":b.unit)}this.element.setStyle(d,true)}});Effect.Transform=Class.create({initialize:function(a){this.tracks=[];this.options=arguments[1]||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var d=a.get("ids"),c=a.get("effect"),b=a.get("options");var e=[$(d)||$$(d)].flatten();return e.map(function(h){return new c(h,Object.extend({sync:true},b))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var b,a=$H();if(Prototype.Browser.WebKit){b=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';b=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){if(b[c]){a.set(c,b[c])}});if(Prototype.Browser.IE&&this.include("opacity")){a.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return a};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(b){var a=document.defaultView.getComputedStyle($(b),null);return Element.CSS_PROPERTIES.inject({},function(c,d){c[d]=a[d];return c})}}else{Element.getStyles=function(b){b=$(b);var a=b.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(d,e){d[e]=a[e];return d});if(!c.opacity){c.opacity=b.getOpacity()}return c}}Effect.Methods={morph:function(a,b){a=$(a);new Effect.Morph(a,Object.extend({style:b},arguments[2]||{}));return a},visualEffect:function(c,e,b){c=$(c);var d=e.dasherize().camelize(),a=d.charAt(0).toUpperCase()+d.substring(1);new Effect[a](c,b);return c},highlight:function(b,a){b=$(b);new Effect.Highlight(b,a);return b}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(c,b){c=$(c);Effect[a.charAt(0).toUpperCase()+a.substring(1)](c,b);return c}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(b,c,a){b=$(b);this.element=b;this.update=$(c);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight})}Effect.Appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){new Effect.Fade(e,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(a){if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&a.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(b){var a=Event.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}Event.stop(b)},onClick:function(b){var a=Event.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(h){if(this.options.updateElement){this.options.updateElement(h);return}var d="";if(this.options.select){var a=$(h).select("."+this.options.select)||[];if(a.length>0){d=Element.collectTextNodes(a[0],this.options.select)}}else{d=Element.collectTextNodesIgnoreClass(h,"informal")}var c=this.getTokenBounds();if(c[0]!=-1){var e=this.element.value.substr(0,c[0]);var b=this.element.value.substr(c[0]).match(/^\s+/);if(b){e+=b[0]}this.element.value=e+d+this.element.value.substr(c[1])}else{this.element.value=d}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,h)}},updateChoices:function(c){if(!this.changed&&this.hasFocus){this.update.innerHTML=c;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var e=this.element.value;if(e.strip().empty()){return[-1,0]}var h=arguments.callee.getFirstDifferencePos(e,this.oldElementValue);var n=(h==this.oldElementValue.length?1:0);var d=-1,c=e.length;var m;for(var b=0,a=this.options.tokens.length;b<a;++b){m=e.lastIndexOf(this.options.tokens[b],h+n-1);if(m>d){d=m}m=e.indexOf(this.options.tokens[b],h+n);if(-1!=m&&m<c){c=m}}return(this.tokenBounds=[d+1,c])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(c,a){var d=Math.min(c.length,a.length);for(var b=0;b<d;++b){if(c[b]!=a[b]){return b}}return d};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(c,d,b,a){this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var d=[];var c=[];var m=b.getToken();var l=0;for(var e=0;e<b.options.array.length&&d.length<b.options.choices;e++){var h=b.options.array[e];var n=b.options.ignoreCase?h.toLowerCase().indexOf(m.toLowerCase()):h.indexOf(m);while(n!=-1){if(n==0&&h.length!=m.length){d.push("<li><strong>"+h.substr(0,m.length)+"</strong>"+h.substr(m.length)+"</li>");break}else{if(m.length>=b.options.partialChars&&b.options.partialSearch&&n!=-1){if(b.options.fullSearch||/\s/.test(h.substr(n-1,1))){c.push("<li>"+h.substr(0,n)+"<strong>"+h.substr(n,m.length)+"</strong>"+h.substr(n+m.length)+"</li>");break}}}n=b.options.ignoreCase?h.toLowerCase().indexOf(m.toLowerCase(),n+1):h.indexOf(m,n+1)}}if(c.length){d=d.concat(c.slice(0,b.options.choices-d.length))}return"<ul>"+d.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(c,b,a){this.url=b;this.element=c=$(c);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(a);Object.extend(this.options,a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey){return}if(Event.KEY_ESC==a.keyCode){this.handleFormCancellation(a)}else{if(Event.KEY_RETURN==a.keyCode){this.handleFormSubmission(a)}}},createControl:function(l,c,b){var e=this.options[l+"Control"];var h=this.options[l+"Text"];if("button"==e){var a=document.createElement("input");a.type="submit";a.value=h;a.className="editor_"+l+"_button";if("cancel"==l){a.onclick=this._boundCancelHandler}this._form.appendChild(a);this._controls[l]=a}else{if("link"==e){var d=document.createElement("a");d.href="#";d.appendChild(document.createTextNode(h));d.onclick="cancel"==l?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+l+"_link";if(b){d.className+=" "+b}this._form.appendChild(d);this._controls[l]=d}}},createEditField:function(){var c=(this.options.loadTextURL?this.options.loadingText:this.getText());var b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var a=this.options.size||this.options.cols||0;if(0<a){b.size=a}}else{b=document.createElement("textarea");b.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);b.cols=this.options.cols||40}b.name=this.options.paramName;b.value=c;b.className="editor_field";if(this.options.submitOnBlur){b.onblur=this._boundSubmitHandler}this._controls.editor=b;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var b=this;function a(d,e){var c=b.options["text"+d+"Controls"];if(!c||e===false){return}b._form.appendChild(document.createTextNode(c))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(a){Event.stop(a)}},enterHover:function(a){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){this.wrapUp();if(a){Event.stop(a)}},handleFormSubmission:function(d){var b=this._form;var c=$F(this._controls.editor);this.prepareSubmission();var h=this.options.callback(b,c)||"";if(Object.isString(h)){h=h.toQueryParams()}h.editorId=this.element.id;if(this.options.htmlResponse){var a=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(a,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,a)}else{var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:h,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,a)}if(d){Event.stop(d)}},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(c){this._form.removeClassName(this.options.loadingClassName);var b=c.responseText;if(this.options.stripLoadedTextTags){b=b.stripTags()}this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a){$(this._controls.editor)["focus"==a?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;if(!this.options.externalControlOnly){this.element.observe(b.key,a)}if(this.options.externalControl){this.options.externalControl.observe(b.key,a)}}.bind(this))},removeForm:function(){if(!this._form){return}this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(b,a){if("function"==typeof this.options[b]){this.options[b](this,a)}},unregisterListeners:function(){$H(this._listeners).each(function(a){if(!this.options.externalControlOnly){this.element.stopObserving(a.key,a.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(a.key,a.value)}}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,c,b,a){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(c,b,a)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw ("Server returned an invalid collection representation.")}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(b){this._controls.editor.disabled=true;var a=this._controls.editor.firstChild;if(!a){a=document.createElement("option");a.value="";this._controls.editor.appendChild(a);a.selected=true}a.update((b||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(d){return d[0]==b}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(e,d){c=document.createElement("option");c.value=e[0];c.selected=a?e[0]==b:0==d;c.appendChild(document.createTextNode(e[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){if(!a){return}function b(c,d){if(c in a||d===undefined){return}a[c]=d}b("cancelControl",(a.cancelLink?"link":(a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined)));b("okControl",(a.okLink?"link":(a.okButton?"button":a.okLink==a.okButton==false?false:undefined)));b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(b,a){new Effect.Highlight(a,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;if(a._effect){a._effect.cancel()}},onFailure:function(b,a){alert("Error communication with the server: "+b.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(b,a,c){this.delay=a||0.5;this.element=$(b);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});if(!Control){var Control={}}Control.Slider=Class.create({initialize:function(d,a,b){var c=this;if(Object.isArray(d)){this.handles=d.collect(function(h){return $(h)})}else{this.handles=[$(d)]}this.track=$(a);this.options=b||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(l,e){e=c.handles.length-1-e;c.setValue(parseFloat((Object.isArray(c.options.sliderValue)?c.options.sliderValue[e]:c.options.sliderValue)||c.range.start),e);l.makePositioned().observe("mousedown",c.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max()){return(this.allowedValues.max())}if(a<=this.allowedValues.min()){return(this.allowedValues.min())}var c=Math.abs(this.allowedValues[0]-a);var b=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);if(e<=c){b=d;c=e}});return b}if(a>this.range.end){return this.range.end}if(a<this.range.start){return this.range.start}return a},setValue:function(b,a){if(!this.active){this.activeHandleIdx=a||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}a=a||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((a>0)&&(b<this.values[a-1])){b=this.values[a-1]}if((a<(this.handles.length-1))&&(b>this.values[a+1])){b=this.values[a+1]}}b=this.getNearestValue(b);this.values[a]=b;this.value=this.values[0];this.handles[a].style[this.isVertical()?"top":"left"]=this.translateToPx(b);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(b,a){this.setValue(this.values[a||this.activeHandleIdx||0]+b,a||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(a-this.range.start))+"px"},translateToValue:function(a){return((a/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(b){var a=this.values.sortBy(Prototype.K);b=b||0;return $R(a[b],a[b+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var a=this;if(this.spans){$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(b,a){if(this.isVertical()){b.style.top=this.translateToPx(a.start);b.style.height=this.translateToPx(a.end-a.start+this.range.start)}else{b.style.left=this.translateToPx(a.start);b.style.width=this.translateToPx(a.end-a.start+this.range.start)}},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(c){if(Event.isLeftClick(c)){if(!this.disabled){this.active=true;var d=Event.element(c);var e=[Event.pointerX(c),Event.pointerY(c)];var a=d;if(a==this.track){var b=this.track.cumulativeOffset();this.event=c;this.setValue(this.translateToValue((this.isVertical()?e[1]-b[1]:e[0]-b[0])-(this.handleLength/2)));var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}else{while((this.handles.indexOf(d)==-1)&&d.parentNode){d=d.parentNode}if(this.handles.indexOf(d)!=-1){this.activeHandle=d;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var b=this.activeHandle.cumulativeOffset();this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}}}Event.stop(c)}},update:function(a){if(this.active){if(!this.dragging){this.dragging=true}this.draw(a);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(a)}},draw:function(b){var c=[Event.pointerX(b),Event.pointerY(b)];var a=this.track.cumulativeOffset();c[0]-=this.offsetX+a[0];c[1]-=this.offsetY+a[1];this.event=b;this.setValue(this.translateToValue(this.isVertical()?c[1]:c[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.active=false;this.dragging=false},finishDrag:function(a,b){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}});if(Object.isUndefined(Effect)){throw ("dragdrop.js requires including script.aculo.us' effects.js library")}var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(b){return b.element==$(a)})},add:function(b){b=$(b);var a=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(a.containment){a._containers=[];var c=a.containment;if(Object.isArray(c)){c.each(function(d){a._containers.push($(d))})}else{a._containers.push($(c))}}if(a.accept){a.accept=[a.accept].flatten()}Element.makePositioned(b);a.element=b;this.drops.push(a)},findDeepestChild:function(a){deepest=a[0];for(i=1;i<a.length;++i){if(Element.isParent(a[i].element,deepest.element)){deepest=a[i]}}return deepest},isContained:function(b,a){var c;if(a.tree){c=b.treeNode}else{c=b.parentNode}return a._containers.detect(function(d){return c==d})},isAffected:function(a,c,b){return((b.element!=c)&&((!b._containers)||this.isContained(c,b))&&((!b.accept)||(Element.classNames(c).detect(function(d){return b.accept.include(d)})))&&Position.within(b.element,a[0],a[1]))},deactivate:function(a){if(a.hoverclass){Element.removeClassName(a.element,a.hoverclass)}this.last_active=null},activate:function(a){if(a.hoverclass){Element.addClassName(a.element,a.hoverclass)}this.last_active=a},show:function(a,c){if(!this.drops.length){return}var b,d=[];this.drops.each(function(e){if(Droppables.isAffected(a,c,e)){d.push(e)}});if(d.length>0){b=Droppables.findDeepestChild(d)}if(this.last_active&&this.last_active!=b){this.deactivate(this.last_active)}if(b){Position.within(b.element,a[0],a[1]);if(b.onHover){b.onHover(c,b.element,Position.overlap(b.overlap,b.element))}if(b!=this.last_active){Droppables.activate(b)}}},fire:function(b,a){if(!this.last_active){return}Position.prepare();if(this.isAffected([Event.pointerX(b),Event.pointerY(b)],a,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(a,this.last_active.element,b);return true}}},reset:function(){if(this.last_active){this.deactivate(this.last_active)}}};var Draggables={drags:[],observers:[],register:function(a){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)}this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(b){return b==a});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)}},activate:function(a){if(a.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay)}else{window.focus();this.activeDraggable=a}},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(!this.activeDraggable){return}var b=[Event.pointerX(a),Event.pointerY(a)];if(this._lastPointer&&(this._lastPointer.inspect()==b.inspect())){return}this._lastPointer=b;this.activeDraggable.updateDrag(a,b)},endDrag:function(a){if(this._timeout){clearTimeout(this._timeout);this._timeout=null}if(!this.activeDraggable){return}this._lastPointer=null;this.activeDraggable.endDrag(a);this.activeDraggable=null},keyPress:function(a){if(this.activeDraggable){this.activeDraggable.keyPress(a)}},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b.element==a});this._cacheObserverCallbacks()},notify:function(b,a,c){if(this[b+"Count"]>0){this.observers.each(function(d){if(d[b]){d[b](b,a,c)}})}if(a.options[b]){a.options[b](a,c)}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(b){return b[a]}).length})}};var Draggable=Class.create({initialize:function(b){var c={handle:false,reverteffect:function(h,e,d){var l=Math.sqrt(Math.abs(e^2)+Math.abs(d^2))*0.02;new Effect.Move(h,{x:-d,y:-e,duration:l,queue:{scope:"_draggable",position:"end"}})},endeffect:function(e){var d=Object.isNumber(e._opacity)?e._opacity:1;new Effect.Opacity(e,{duration:0.2,from:0.7,to:d,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[e]=false}})},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect)){Object.extend(c,{starteffect:function(d){d._opacity=Element.getOpacity(d);Draggable._dragging[d]=true;new Effect.Opacity(d,{duration:0.2,from:d._opacity,to:0.7})}})}var a=Object.extend(c,arguments[1]||{});this.element=$(b);if(a.handle&&Object.isString(a.handle)){this.handle=this.element.down("."+a.handle,0)}if(!this.handle){this.handle=$(a.handle)}if(!this.handle){this.handle=this.element}if(a.scroll&&!a.scroll.scrollTo&&!a.scroll.outerHTML){a.scroll=$(a.scroll);this._isScrollChild=Element.childOf(this.element,a.scroll)}Element.makePositioned(this.element);this.options=a;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")])},initDrag:function(a){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return}if(Event.isLeftClick(a)){var c=Event.element(a);if((tag_name=c.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return}var b=[Event.pointerX(a),Event.pointerY(a)];var d=this.element.cumulativeOffset();this.offset=[0,1].map(function(e){return(b[e]-d[e])});Draggables.activate(this);Event.stop(a)}},startDrag:function(b){this.dragging=true;if(!this.delta){this.delta=this.currentDelta()}if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this._originallyAbsolute=(this.element.getStyle("position")=="absolute");if(!this._originallyAbsolute){Position.absolutize(this.element)}this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.scroll){if(this.options.scroll==window){var a=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=a.left;this.originalScrollTop=a.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}}Draggables.notify("onStart",this,b);if(this.options.starteffect){this.options.starteffect(this.element)}},updateDrag:function(event,pointer){if(!this.dragging){this.startDrag(event)}if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element)}Draggables.notify("onDrag",this,event);this.draw(pointer);if(this.options.change){this.options.change(this)}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height]}}else{p=Position.page(this.options.scroll).toArray();p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight)}var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)}if(pointer[1]<(p[1]+this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)}if(pointer[0]>(p[2]-this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)}if(pointer[1]>(p[3]-this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)}this.startScrolling(speed)}if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(event)},finishDrag:function(b,h){this.dragging=false;if(this.options.quiet){Position.prepare();var e=[Event.pointerX(b),Event.pointerY(b)];Droppables.show(e,this.element)}if(this.options.ghosting){if(!this._originallyAbsolute){Position.relativize(this.element)}delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null}var l=false;if(h){l=Droppables.fire(b,this.element);if(!l){l=false}}if(l&&this.options.onDropped){this.options.onDropped(this.element)}Draggables.notify("onEnd",this,b);var a=this.options.revert;if(a&&Object.isFunction(a)){a=a(this.element)}var c=this.currentDelta();if(a&&this.options.reverteffect){if(l==0||a!="failure"){this.options.reverteffect(this.element,c[1]-this.delta[1],c[0]-this.delta[0])}}else{this.delta=c}if(this.options.zindex){this.element.style.zIndex=this.originalZ}if(this.options.endeffect){this.options.endeffect(this.element)}Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){if(a.keyCode!=Event.KEY_ESC){return}this.finishDrag(a,false);Event.stop(a)},endDrag:function(a){if(!this.dragging){return}this.stopScrolling();this.finishDrag(a,true);Event.stop(a)},draw:function(a){var l=this.element.cumulativeOffset();if(this.options.ghosting){var c=Position.realOffset(this.element);l[0]+=c[0]-Position.deltaX;l[1]+=c[1]-Position.deltaY}var h=this.currentDelta();l[0]-=h[0];l[1]-=h[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){l[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;l[1]-=this.options.scroll.scrollTop-this.originalScrollTop}var e=[0,1].map(function(d){return(a[d]-l[d]-this.offset[d])}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){e=this.options.snap(e[0],e[1],this)}else{if(Object.isArray(this.options.snap)){e=e.map(function(d,m){return(d/this.options.snap[m]).round()*this.options.snap[m]}.bind(this))}else{e=e.map(function(d){return(d/this.options.snap).round()*this.options.snap}.bind(this))}}}var b=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){b.left=e[0]+"px"}if((!this.options.constraint)||(this.options.constraint=="vertical")){b.top=e[1]+"px"}if(b.visibility=="hidden"){b.visibility=""}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null}},startScrolling:function(a){if(!(a[0]||a[1])){return}this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0}this.draw(Draggables._lastScrollPointer)}if(this.options.change){this.options.change(this)}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight}else{W=body.offsetWidth;H=body.offsetHeight}}}return{top:T,left:L,width:W,height:H}}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(b,a){this.element=$(b);this.observer=a;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element)}}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){while(a.tagName.toUpperCase()!="BODY"){if(a.id&&Sortable.sortables[a.id]){return a}a=a.parentNode}},options:function(a){a=Sortable._findRootElement($(a));if(!a){return}return Sortable.sortables[a.id]},destroy:function(a){a=$(a);var b=Sortable.sortables[a.id];if(b){Draggables.removeObserver(b.element);b.droppables.each(function(c){Droppables.remove(c)});b.draggables.invoke("destroy");delete Sortable.sortables[b.element.id]}},create:function(c){c=$(c);var b=Object.extend({element:c,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:c,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(c);var a={revert:true,quiet:b.quiet,scroll:b.scroll,scrollSpeed:b.scrollSpeed,scrollSensitivity:b.scrollSensitivity,delay:b.delay,ghosting:b.ghosting,constraint:b.constraint,handle:b.handle};if(b.starteffect){a.starteffect=b.starteffect}if(b.reverteffect){a.reverteffect=b.reverteffect}else{if(b.ghosting){a.reverteffect=function(h){h.style.top=0;h.style.left=0}}}if(b.endeffect){a.endeffect=b.endeffect}if(b.zindex){a.zindex=b.zindex}var d={overlap:b.overlap,containment:b.containment,tree:b.tree,hoverclass:b.hoverclass,onHover:Sortable.onHover};var e={onHover:Sortable.onEmptyHover,overlap:b.overlap,containment:b.containment,hoverclass:b.hoverclass};Element.cleanWhitespace(c);b.draggables=[];b.droppables=[];if(b.dropOnEmpty||b.tree){Droppables.add(c,e);b.droppables.push(c)}(b.elements||this.findElements(c,b)||[]).each(function(m,h){var l=b.handles?$(b.handles[h]):(b.handle?$(m).select("."+b.handle)[0]:m);b.draggables.push(new Draggable(m,Object.extend(a,{handle:l})));Droppables.add(m,d);if(b.tree){m.treeNode=c}b.droppables.push(m)});if(b.tree){(Sortable.findTreeElements(c,b)||[]).each(function(h){Droppables.add(h,e);h.treeNode=c;b.droppables.push(h)})}this.sortables[c.identify()]=b;Draggables.addObserver(new SortableObserver(c,b.onUpdate))},findElements:function(b,a){return Element.findChildren(b,a.only,a.tree?true:false,a.tag)},findTreeElements:function(b,a){return Element.findChildren(b,a.only,a.tree?true:false,a.treeTag)},onHover:function(e,d,a){if(Element.isParent(d,e)){return}if(a>0.33&&a<0.66&&Sortable.options(d).tree){return}else{if(a>0.5){Sortable.mark(d,"before");if(d.previousSibling!=e){var b=e.parentNode;e.style.visibility="hidden";d.parentNode.insertBefore(e,d);if(d.parentNode!=b){Sortable.options(b).onChange(e)}Sortable.options(d.parentNode).onChange(e)}}else{Sortable.mark(d,"after");var c=d.nextSibling||null;if(c!=e){var b=e.parentNode;e.style.visibility="hidden";d.parentNode.insertBefore(e,c);if(d.parentNode!=b){Sortable.options(b).onChange(e)}Sortable.options(d.parentNode).onChange(e)}}}},onEmptyHover:function(e,l,m){var n=e.parentNode;var a=Sortable.options(l);if(!Element.isParent(l,e)){var h;var c=Sortable.findElements(l,{tag:a.tag,only:a.only});var b=null;if(c){var d=Element.offsetSize(l,a.overlap)*(1-m);for(h=0;h<c.length;h+=1){if(d-Element.offsetSize(c[h],a.overlap)>=0){d-=Element.offsetSize(c[h],a.overlap)}else{if(d-(Element.offsetSize(c[h],a.overlap)/2)>=0){b=h+1<c.length?c[h+1]:null;break}else{b=c[h];break}}}}l.insertBefore(e,b);Sortable.options(n).onChange(e);a.onChange(e)}},unmark:function(){if(Sortable._marker){Sortable._marker.hide()}},mark:function(b,a){var d=Sortable.options(b.parentNode);if(d&&!d.ghosting){return}if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker)}var c=b.cumulativeOffset();Sortable._marker.setStyle({left:c[0]+"px",top:c[1]+"px"});if(a=="after"){if(d.overlap=="horizontal"){Sortable._marker.setStyle({left:(c[0]+b.clientWidth)+"px"})}else{Sortable._marker.setStyle({top:(c[1]+b.clientHeight)+"px"})}}Sortable._marker.show()},_tree:function(e,b,h){var d=Sortable.findElements(e,b)||[];for(var c=0;c<d.length;++c){var a=d[c].id.match(b.format);if(!a){continue}var l={id:encodeURIComponent(a?a[1]:null),element:e,parent:h,children:[],position:h.children.length,container:$(d[c]).down(b.treeTag)};if(l.container){this._tree(l.container,b,l)}h.children.push(l)}return h},tree:function(d){d=$(d);var c=this.options(d);var b=Object.extend({tag:c.tag,treeTag:c.treeTag,only:c.only,name:d.id,format:c.format},arguments[1]||{});var a={id:null,parent:null,children:[],container:d,position:0};return Sortable._tree(d,b,a)},_constructIndex:function(b){var a="";do{if(b.id){a="["+b.position+"]"+a}}while((b=b.parent)!=null);return a},sequence:function(b){b=$(b);var a=Object.extend(this.options(b),arguments[1]||{});return $(this.findElements(b,a)||[]).map(function(c){return c.id.match(a.format)?c.id.match(a.format)[1]:""})},setSequence:function(b,c){b=$(b);var a=Object.extend(this.options(b),arguments[2]||{});var d={};this.findElements(b,a).each(function(e){if(e.id.match(a.format)){d[e.id.match(a.format)[1]]=[e,e.parentNode]}e.parentNode.removeChild(e)});c.each(function(e){var h=d[e];if(h){h[1].appendChild(h[0]);delete d[e]}})},serialize:function(c){c=$(c);var b=Object.extend(Sortable.options(c),arguments[1]||{});var a=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:c.id);if(b.tree){return Sortable.tree(c,arguments[1]).children.map(function(d){return[a+Sortable._constructIndex(d)+"[id]="+encodeURIComponent(d.id)].concat(d.children.map(arguments.callee))}).flatten().join("&")}else{return Sortable.sequence(c,arguments[1]).map(function(d){return a+"[]="+encodeURIComponent(d)}).join("&")}}};Element.isParent=function(b,a){if(!b.parentNode||b==a){return false}if(b.parentNode==a){return true}return Element.isParent(b.parentNode,a)};Element.findChildren=function(d,b,a,c){if(!d.hasChildNodes()){return null}c=c.toUpperCase();if(b){b=[b].flatten()}var e=[];$A(d.childNodes).each(function(l){if(l.tagName&&l.tagName.toUpperCase()==c&&(!b||(Element.classNames(l).detect(function(m){return b.include(m)})))){e.push(l)}if(a){var h=Element.findChildren(l,b,a,c);if(h){e.push(h)}}});return(e.length>0?e.flatten():[])};Element.offsetSize=function(a,b){return a["offset"+((b=="vertical"||b=="height")?"Height":"Width")]};var seasonpass=function(){this.state={};this.naviTabs=["pass","tasks"];this.navi="pass";this.step_width=0;this.line_width=0;this.line_scroll_speed=25;this.curLeft;this.curXPos;this.curDown=false;this.tutorialStep=1};seasonpass.prototype.finishTutorial=function(){seasonpass.action("seasonpass_finish_tutorial")};seasonpass.prototype.finishPass=function(){seasonpass.action("seasonpass_finish_pass")};seasonpass.prototype.claimReward=function(b,a){seasonpass.action("seasonpass_claim_reward",{step:b,type:a})};seasonpass.prototype.buyPremium=function(){seasonpass.action("seasonpass_buy_premium")};seasonpass.prototype.init=function(){seasonpass.action("seasonpass_init")};seasonpass.prototype.action=function(a,b){ajaxAction("farm",a,b,seasonpass.response)};seasonpass.prototype.response=function(b,a,c){seasonpass.data=b;seasonpass.setCurrentState();seasonpass.build();seasonpass.buildLink();setTimer("seasonpass");if(a=="seasonpass_init"&&!+seasonpass.data.data.tutorial){seasonpass.tutorial()}};seasonpass.prototype.build=function(){var m=parseInt(this.state.currentpoints-this.data.config.steps[this.data.data.name][this.state.currentstep].points);var s=parseInt(this.state.stepsdiff[this.state.currentstep]);var n=((m*100)/s);var e="";e+='<div class="border"></div>';e+='<div id="seasonpass_head" class="head">';e+='  <div class="icon seasonpassitem"></div>';e+="  <div>"+t_seasonpass_name+"</div>";e+="</div>";if(this.data.config.steps[this.data.data.name][(parseInt(this.state.currentstep)+1)]){e+="<div class=\"points\" onmouseover=\"$('seasonpass_points_tt').style.display='flex';\" onmouseout=\"hideDiv('seasonpass_points_tt')\">";e+='  <div class="currentstep flex-center-all">';e+='    <div class="count">'+this.state.currentstep+"</div>";e+="  </div>";e+='  <div class="pbar">';e+='    <div class="pbar_inner" style="width:'+n+'%"></div>';e+='    <div class="status">';e+='      <div><span class="current">'+formatNumber(m)+"</span>/"+formatNumber(s)+"</div>";e+='      <div class="seasonpassitem"></div>';e+="    </div>";e+="  </div>";e+='  <div id="seasonpass_points_tt" class="ttbox">';e+="   <div>"+t_seasonpass_points_left.replace("%COUNT%",'</div><div style="font-weight:bold;">'+formatNumber(parseInt(s)-parseInt(m))+'</div><div class="seasonpassitem"></div>')+"</div>";e+="  </div>";e+="</div>"}else{e+='<div class="points">';e+='  <div class="finished flex-center-all">';e+="    <div>"+t_seasonpass_finished+"</div>";e+="  </div>";e+="</div>"}var t="";if(!+this.data.data.buydate){t="not-bought"}e+='<div id="seasonpass_navi" class="navi"></div>';e+='<div id="seasonpass_pass" class="page pass">';e+='  <div class="cols">';e+='    <div class="col1">';e+='      <div class="pass is-free">';e+='        <div class="label">'+t_seasonpass_type_free+"</div>";e+="      </div>";e+='      <div class="pass is-premium '+t+'">';if(!+this.data.data.buydate){e+='<div class="link coinsbutton_flex buy" onclick="seasonpass.buyPremiumCommit()">'+t_seasonpass_button_buy_premium+"</div>"}else{e+='<div class="label">'+t_seasonpass_type_premium+"</div>"}e+="      </div>";e+="    </div>";e+='    <div id="seasonpass_line_scroller" class="col2">';e+='      <div class="line" style="width:calc(var(--seasonpass-step-width) * '+(this.state.stepscount-1)+')">';e+='        <div id="seasonpass_bar" class="bar">';e+='          <div class="inner" style="width:'+this.line_width+'px"></div>';e+="        </div>";e+='        <div class="steps">';var q=this.data.config.steps[this.data.data.name];for(var c in q){var t="";if(parseInt(this.state.currentpoints)>=parseInt(q[c].points)){t="reached"}if(parseInt(this.state.currentstep)<parseInt(c)){t+=" off"}e+='<div id="seasonpass_step'+c+'" class="step '+t+'" style="--seasonpass-step-count:'+c+'">';var h=["free","premium"];for(var b=0;b<h.length;b++){if(!q[c][h[b]]){continue}var l="";e+='<div id="seasonpass_step'+c+"_bubble_"+h[b]+'" class="bubble '+h[b]+'" onmouseover="showDiv(\'seasonpass_bubble_'+c+"_"+h[b]+"_tt')\" onmouseout=\"hideDiv('seasonpass_bubble_"+c+"_"+h[b]+"_tt')\">";e+='  <div class="reward">';var v="seasonpass.claimReward("+c+", '"+h[b]+"')";if(h[b]=="premium"){if(!+this.data.data.buydate){v="seasonpass.buyPremiumCommit()"}}if(q[c][h[b]].greenhouseroom){l+="<div>"+t_seasonpass_greenhouse_room+"</div>";e+='<div class="greenhouseroom greenhouseroom'+q[c][h[b]].greenhouseroom+'"></div>'}if(q[c][h[b]].gift){l+="<div>"+t_pan_item+"</div>";for(var a=0;a<q[c][h[b]].gift.length;a++){e+='<div class="giftid giftid'+q[c][h[b]].gift+'"></div>'}}if(q[c][h[b]]["package"]){for(var u in q[c][h[b]]["package"]){l+="<div>"+t_pets_package_item_name+"</div>";e+='<div class="package pets_package'+u+'">';e+='  <div class="amount">'+q[c][h[b]]["package"][u]+"x</div>";e+="</div>"}}if(q[c][h[b]].farmdeco){for(var u in q[c][h[b]].farmdeco){l+="<div>"+t_farmdeco_item_name+"</div>";l+='<div class="scene farmdeco">';l+='  <div class="scalebox">';l+='    <div class="back"></div>';l+='    <div class="img farmdeco_'+u+'"></div>';l+="  </div>";l+="</div>";e+='<div class="farmdeco farmdeco_'+u+'">';e+='  <div class="amount">'+q[c][h[b]].farmdeco[u]+"x</div>";e+="</div>"}}if(q[c][h[b]].greenhouse){for(var u in q[c][h[b]].greenhouse){l+="<div>"+t_greenhouse_item_name+"</div>";l+='<div class="scene greenhouse is-'+greenhouseproducts[u].category+" is-"+greenhouseproducts[u].type+'">';l+='  <div class="scalebox">';l+='    <div class="back"></div>';if(greenhouseproducts[u].type=="pot"){l+='<div class="pot greenhouse_product '+u+'"></div>'}else{l+='<div class="pot"></div>';l+='<div class="plant greenhouse_product '+u+'"></div>'}l+="  </div>";l+="</div>";l+="<div>"+greenhouseproducts[u].name+"</div>";e+='<div class="greenhouse">';e+='  <div class="back big '+greenhouseproducts[u].type+"-"+greenhouseproducts[u].category+'"></div>';e+='  <div class="img greenhouse_product '+u+" is-"+greenhouseproducts[u].type+'"></div>';e+='  <div class="amount">'+q[c][h[b]].greenhouse[u]+"x</div>";e+="</div>"}}if(q[c][h[b]].paymentitemcollectionitem){l+="<div>"+t_paymentitem_collection_item_name+"</div>";e+='<div class="paymentitem_collection_item">';e+='  <div class="amount">'+q[c][h[b]].paymentitemcollectionitem+"x</div>";e+="</div>"}if(q[c][h[b]].premium){l+="<div>"+t_premium_days_name+"</div>";e+='<div class="premiumdays">';e+='  <div class="amount">'+q[c][h[b]].premium+"x</div>";e+="</div>"}if(q[c][h[b]].product){for(var d in q[c][h[b]].product){l+="<div>"+produkt_name[d]+"</div>";e+='<div class="product">';e+='  <div class="label e'+d+'"></div>';e+='  <div class="amount">'+q[c][h[b]].product[d]+"x</div>";e+="</div>"}}if(q[c][h[b]].friendpoints){l+="<div>"+t_friendpoints_name+"</div>";e+='<div class="friendpoints">';e+='  <div class="amount">'+formatNumber(q[c][h[b]].friendpoints)+"x</div>";e+="</div>"}if(q[c][h[b]].powerup){l+="<div>"+t_pointsboost_unit+"</div>";for(var d in q[c][h[b]].powerup){e+='<div class="powerup powerup_rackitem_back4">';e+='  <div class="percent">'+windmillarray[d][5][3]+"%</div>";e+='  <div class="amount2">'+q[c][h[b]].powerup[d]+"</div>";e+="</div>"}}e+="  </div>";if(!+this.data.data.buydate&&h[b]=="premium"){e+='<div class="blocked"></div>'}if(this.state.currentpoints>=q[c].points){if(this.data.data.rewards&&this.data.data.rewards[c]&&this.data.data.rewards[c][h[b]]){e+='<div class="ready"></div>'}else{e+='<div class="button_new link" onclick="'+v+'">'+t_seasonpass_button_claim+"</div>"}}var r="";if(h[b]=="premium"){r="bottom"}e+='  <div id="seasonpass_bubble_'+c+"_"+h[b]+'_tt" class="ttbox '+r+'">'+l+"</div>";e+="</div>"}e+="</div>"}e+="        </div>";e+="      </div>";e+="    </div>";e+="  </div>";e+="</div>";e+='<div id="seasonpass_tasks" class="page tasks"></div>';e+='<div class="timeline">';e+='  <div id="seasonpass_timeline_marker" class="marker"></div>';e+='  <div class="timer">'+t_seasonpass_timer+':&nbsp;<span id="seasonpass_timer"></span></div>';e+="</div>";e+='<div class="info_link" onmouseover="showDiv(\'seasonpass_info_link_tt\')" onmouseout="hideDiv(\'seasonpass_info_link_tt\')">';e+='  <div id="seasonpass_info_link_tt" class="ttbox">';e+='    <div class="name">'+t_seasonpass_name+"&nbsp;"+this.data.data.name.replace("season","")+"</div>";e+="    <ul>";e+="      <li>"+t_seasonpass_help1+"</li>";e+="      <li>"+t_seasonpass_help2+"</li>";e+="      <li>"+t_seasonpass_help3+"</li>";e+="      <li>"+t_seasonpass_help4+"</li>";e+="      <li>"+t_seasonpass_help5.replace("%COUNT%",this.data.config.constants.max_daily_tasks)+"</li>";e+="      <li>"+t_seasonpass_help6.replace("%BONUS%",Math.round(this.data.config.constants.premium_points_bonus*100))+"</li>";e+="      <li>"+t_seasonpass_help7.replace("%DURATION%",formatTime(this.data.config.constants.task_duration))+"</li>";e+="    </ul>";e+="  </div>";e+="</div>";e+='<div id="seasonpass_tutorial" class="tutorial">';e+='  <div class="transp"></div>';e+='  <div id="seasonpass_tutorial_char" class="char"></div>';e+='  <div id="seasonpass_tutorial_bubble" class="bubble"></div>';e+="</div>";e+='<div class="mini_close link" onclick="seasonpass.close()"></div>';$("seasonpass_main").innerHTML=e;$("seasonpass").style.display="flex";$("seasonpass").addClassName(this.data.config.types[this.data.data.name].theme);var t="is-free";if(+this.data.data.buydate>0){t="is-premium"}$("seasonpass").addClassName(t);$("seasonpass_line_scroller").addEventListener("mousemove",function(A){if(!this.curDown){return 1}A.preventDefault();var z=A.pageX-$("seasonpass_line_scroller").offsetLeft;var w=(z-this.curXPos);$("seasonpass_line_scroller").scrollLeft=this.curLeft-w});$("seasonpass_line_scroller").addEventListener("mousedown",function(w){this.curXPos=w.pageX-$("seasonpass_line_scroller").offsetLeft;this.curLeft=$("seasonpass_line_scroller").scrollLeft;this.curDown=true;$("seasonpass_line_scroller").addClassName("dragging")});$("seasonpass_line_scroller").addEventListener("mouseup",function(w){this.curDown=false;$("seasonpass_line_scroller").removeClassName("dragging")});$("seasonpass_line_scroller").addEventListener("mouseleave",function(w){this.curDown=false;$("seasonpass_line_scroller").removeClassName("dragging")});this.scrollToPosition();this.buildTasks();this.buildNavi();this.timerUpdate()};seasonpass.prototype.buildNavi=function(){var c="";for(var b=0;b<this.naviTabs.length;b++){var a="";if(this.naviTabs[b]==this.navi){a="active"}c+='<div id="seasonpass_navi_tab_'+this.naviTabs[b]+'" class="tab is-'+this.naviTabs[b]+" "+a+' link" onclick="seasonpass.clickNavi(\''+this.naviTabs[b]+"')\">"+t_seasonpass_navi_tab[this.naviTabs[b]]+"</div>";hideDiv("seasonpass_"+this.naviTabs[b])}$("seasonpass_navi").innerHTML=c;showDiv("seasonpass_"+this.navi)};seasonpass.prototype.clickNavi=function(a){this.navi=a;this.buildNavi()};seasonpass.prototype.buildTasks=function(){var b="";var q="";if(this.data.data.finishable){b+='<div class="finishable">';b+='  <div class="coinsbutton_flex link finish" onclick="seasonpass.finishPassCommit()">'+t_seasonpass_button_finish_pass+"</div>";b+="</div>";q="short"}b+='<div id="seasonpass_tasks_list" class="list '+q+'">';for(var n=1;n<=2;n++){var l="";var h=JSON.parse(JSON.stringify(this.data.data.tasks));if(n==2){b+='<div class="done">'+t_seasonpass_tasks_done+"</div>";l="done";h=JSON.parse(JSON.stringify(this.data.data.tasksDone))}for(var a=0;a<h.length;a++){var s=h[a];var m=parseInt(s.data.count);var c=t_seasonpass_task_desc[s.type].replace("%COUNT%",'<span class="marked2">'+m+"</span>").replace("%CITYNAME2%",cityname2);b+='<div id="seasonpass_task'+l+a+'" class="task">';var q="";if(s.type.indexOf("forestry")>-1){q="forestry"}else{if(s.type.indexOf("foodworld")>-1){q="foodworld"}}if(s.data.pid){if(q=="forestry"){b+='<div class="pid icon '+q+'">';if(s.data.pid<=10){b+='<div class="fsmall f_symbol'+s.data.pid+'"></div>'}else{b+='<div class="fbig fbig'+s.data.pid+'"></div>'}b+="</div>";c=c.replace("%FNAME%",'<span class="marked2">'+produkt_name_forestry[s.data.pid]+"</span>")}else{b+='<div class="pid tt'+s.data.pid+'"></div>';c=c.replace("%NAME%",'<span class="marked2">'+produkt_name[s.data.pid]+"</span>")}}else{b+='<div class="icon '+s.type+" "+q+'"></div>'}var e=0;var d=0;if(s.data.done){e=Math.min(m,parseInt(s.data.done));d=((e*100)/m)}var r=s.data.points;var q="";if(n==1&&+this.data.data.buydate>0&&this.data.config.constants.premium_points_bonus){r=Math.ceil(r*(1+this.data.config.constants.premium_points_bonus));q="bonus"}b+='  <div class="info">';b+='      <div class="desc">'+c+"</div>";b+="  </div>";b+='  <div class="info2">';b+='    <div class="tbar">';b+='      <div class="tbar_inner" style="width:'+d+'%"></div>';b+='      <div class="current">'+e+"/"+m+"</div>";b+="    </div>";b+='    <div id="seasonpass_task'+l+a+'_timer"></div>';b+="  </div>";b+='  <div class="reward flex-center-left">';b+='    <div class="amount '+q+'">+'+formatNumber(r)+"</div>";b+='    <div class="seasonpassitem"></div>';b+="  </div>";if(n==2){b+='<div class="ready"></div>'}b+="</div>"}}b+="</div>";if(+this.data.data.buydate){b+='<div class="bonus_info">'+t_seasonpass_points_bonus_info.replace("%BONUS%","<span>"+Math.round(this.data.config.constants.premium_points_bonus*100)+"%</span>")+"</div>"}$("seasonpass_tasks").innerHTML=b};seasonpass.prototype.buyPremiumCommit=function(){var d="";var a=parseInt(this.data.config.constants.cost);if(user_coins<a){d="color:red;"}var b='<div id="seasonpass_commit">';b+='  <div class="premiumpass flex-center-all">';b+="    <div>"+t_seasonpass_buy_premium_head+"</div>";b+="  </div>";b+="  <div>"+t_seasonpass_buy_premium_desc.replace("%COST%",'<span style="font-size:12px; font-weight:bold; '+d+'">'+formatNumber(this.data.config.constants.cost)+"&nbsp;"+t_coins+"</span>")+"</div>";if(this.data.config.constants.premium_points_bonus>0){b+='<div class="bonus">'+t_seasonpass_buy_premium_bonus.replace("%BONUS%",Math.round(this.data.config.constants.premium_points_bonus*100))+"</div>"}b+="</div>";var c="seasonpass.buyPremium()";if(d!=""){globalcommitbox("",b,0,0,1)}else{globalcommitbox("",b,c)}};seasonpass.prototype.finishPassCommit=function(){var b=0;for(var d in this.data.config.steps[this.data.data.name]){b=this.data.config.steps[this.data.data.name][d].points}var l=0;if(this.data.data.points){l=parseInt(this.data.data.points)}var e=(parseInt(b)-l);var a=Math.ceil(e/this.data.config.constants.finish_coin_points);var c='<div id="seasonpass_commit">';c+="  <div>"+t_seasonpass_finish_pass_desc.replace("%COST%","<b>"+formatNumber(a)+"&nbsp;"+t_coins+"</b>")+"</div>";c+="</div>";var h="seasonpass.finishPass()";globalcommitbox(t_seasonpass_finish_pass_head,c,h)};seasonpass.prototype.setCurrentState=function(){this.state={currentpoints:0,currentstep:0,stepscount:0,stepsmax:0,stepsdiff:{},unclaimed:0};this.step_width=this.data.config.constants.step_width;if(this.data.data&&this.data.data.points){this.state.currentpoints=parseInt(this.data.data.points)}var l=0;var a=this.data.config.steps[this.data.data.name];for(var d in a){if(this.state.currentpoints>=parseInt(a[d].points)){var c=["free","premium"];if(!+this.data.data.buydate){c=["free"]}for(var b=0;b<c.length;b++){if(!this.data.config.steps[this.data.data.name][d][c[b]]){continue}if(!this.data.data.rewards||!this.data.data.rewards[d]||!this.data.data.rewards[d][c[b]]){this.state.unclaimed++}}if(a[(parseInt(d)+1)]){var m=(a[(parseInt(d)+1)].points-a[d].points);this.state.stepsdiff[d]=m;var h=(this.step_width/m);var e=Math.min(m,(this.state.currentpoints-a[d].points));l+=(e*h)}this.state.currentstep=d}this.state.stepsmax=a[d].points;this.state.stepscount++}this.line_width=l};seasonpass.prototype.scrollToPosition=function(){var c=(Math.ceil(seasonpass.line_width/this.step_width)-1);if(c>0){var a=0;var e=200;for(var b=1;b<=c;b++){this.scrollIt(a,e);a+=this.step_width;e+=this.line_scroll_speed}}};seasonpass.prototype.scrollIt=function(a,b){setTimeout(function(){$("seasonpass_line_scroller").scrollLeft=a},b)};seasonpass.prototype.buildLink=function(){if(!$("seasonpass_link")){return 1}this.setCurrentState();var a="";a+='<div class="current">'+this.state.currentstep+"</div>";if(this.state.unclaimed>0){a+='<div class="unclaimed">'+this.state.unclaimed+"</div>"}a+='<div id="seasonpass_link_tt" class="ttbox">';a+='  <div style="font-weight:bold;">'+t_seasonpass_name+"</div>";a+="</div>";$("seasonpass_link").innerHTML=a;$("seasonpass_link").style.display="flex";$("seasonpass_link").addClassName(this.data.config.types[this.data.data.name].theme);if(+this.data.data.buydate>0){$("seasonpass_link").addClassName("premium")}$("seasonpass_link").removeClassName("is-new");if(+this.data.data.teaser<=0){$("seasonpass_link").addClassName("is-new")}};seasonpass.prototype.flyer=function(b){if(!$("seasonpass_link")){return 1}if($("seasonpass_link_flyer")){$("seasonpass_link_flyer").remove()}var a='<div id="seasonpass_link_flyer" class="'+this.data.config.types[this.data.data.name].theme+'">';a+='  <div class="seasonpassitem"></div>';a+='  <div style="margin-left:2px;">+'+formatNumber(b)+"</div>";a+="</div>";$("seasonpass_link").insert(a);setTimeout(function(){if($("seasonpass_link_flyer")){$("seasonpass_link_flyer").addClassName("move")}},1000)};seasonpass.prototype.tutorial=function(){for(var b in this.data.config.steps[this.data.data.name]){if(b>1){$("seasonpass_step"+b).addClassName("off")}if($("seasonpass_step"+b+"_bubble_free")){$("seasonpass_step"+b+"_bubble_free").removeClassName("marked")}if($("seasonpass_step"+b+"_bubble_premium")){$("seasonpass_step"+b+"_bubble_premium").removeClassName("marked")}}$("seasonpass_head").removeClassName("marked");$("seasonpass_navi_tab_tasks").removeClassName("marked");$("seasonpass_tasks_list").removeClassName("marked");if(!t_seasonpass_tutorial_text[this.tutorialStep]){this.closeTutorial();return 1}showDiv("seasonpass_tutorial");$("seasonpass_head").addClassName("marked");var d=t_continue;var c="seasonpass.nextTutorialStep()";if(!t_seasonpass_tutorial_text[(this.tutorialStep+1)]){d=t_vineyard_tutorial_text_finish;c="seasonpass.finishTutorial()"}var a=t_seasonpass_tutorial_text[this.tutorialStep].replace("%NAME%","<b>"+username+"</b>").replace("%COUNT%",this.data.config.constants.max_daily_tasks).replace("%DURATION%",formatTime(this.data.config.constants.task_duration));a+='<div class="footer">';a+='  <button class="button_new link" onclick="'+c+'">'+d+"</button>";a+="</div>";if(this.tutorialStep==2){for(var b in this.data.config.steps[this.data.data.name]){if($("seasonpass_step"+b+"_bubble_free")){$("seasonpass_step"+b).removeClassName("off");$("seasonpass_step"+b+"_bubble_free").addClassName("marked")}}}if(this.tutorialStep==3){for(var b in this.data.config.steps[this.data.data.name]){if($("seasonpass_step"+b)){$("seasonpass_step"+b).removeClassName("off")}if($("seasonpass_step"+b+"_bubble_premium")){$("seasonpass_step"+b+"_bubble_premium").addClassName("marked")}}}if(this.tutorialStep==4){$("seasonpass_navi_tab_tasks").addClassName("marked")}if(this.tutorialStep==5){this.clickNavi("tasks");$("seasonpass_tasks_list").addClassName("marked")}if(this.tutorialStep==6){seasonpass.clickNavi("pass")}$("seasonpass_tutorial_bubble").innerHTML=a};seasonpass.prototype.nextTutorialStep=function(){this.tutorialStep++;this.tutorial()};seasonpass.prototype.closeTutorial=function(){hideDiv("seasonpass_tutorial")};seasonpass.prototype.timer=function(){if(this.data&&this.data.data){this.data.data.remain--;if(this.data.data.tasks){for(var a=0;a<this.data.data.tasks.length;a++){this.data.data.tasks[a].remain--}}}this.timerUpdate()};seasonpass.prototype.timerUpdate=function(){if($("seasonpass_timer")){var c=((this.data.data.remain*100)/(this.data.config.types[this.data.data.name].end-this.data.config.types[this.data.data.name].start));var a="";if(c>=50){a="right"}$("seasonpass_timer").innerHTML=formatTime(this.data.data.remain);$("seasonpass_timeline_marker").style.width=(100-c)+"%";$("seasonpass_timeline_marker").removeClassName("right");if(c>=50){$("seasonpass_timeline_marker").addClassName("right")}}if($("seasonpass_timer")){$("seasonpass_timer").innerHTML=formatTime(this.data.data.remain)}if(this.data&&this.data.data&&this.data.data.tasks&&this.data.data.tasks.length){for(var b=0;b<this.data.data.tasks.length;b++){hideDiv("seasonpass_task"+b);if(this.data.data.tasks[b].remain>0){$("seasonpass_task"+b).style.display="flex";$("seasonpass_task"+b+"_timer").innerHTML=formatTime(this.data.data.tasks[b].remain)}}}};seasonpass.prototype.close=function(){hideDiv("seasonpass")};var shop_id=1;var shop_bar=0;var shop_coins=0;var shop_cart={};var shop_products=[];var shop_side=1;var shop_block=0;var shop_sort="v";function shopAction(h,a,b){if(shop_block==1){return false}var e="";if(a){shop_id=a}if(h=="shopfire"){var d="";for(var c in shop_cart){d+=c+","+shop_cart[c]+";"}if(d==""){return false}d=d.substring(0,(d.length-1));e+="&cart="+encodeURIComponent(d);shop_block=1;hideDiv("shop_cart_sum_button");shop_cart={};$("shop_cart").innerHTML="";$("shop_cart_sum").innerHTML=formatPrice(0)}showGlobalWait(h);var l=createAjaxRequestObj();l.open("GET","ajax/city.php?rid="+rid+"&shopid="+shop_id+"&mode="+h+e,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.onreadystatechange=function(){shopActionResponse(l,h,b)};l.send(null)}function shopActionResponse(c,d,b){var a=_chkRequest(c);if(a!=0){hideGlobalWait();shop_block=0;if(a[0]==0){shopBuild();globalerrorbox(a[1])}else{if(a[1].products){shop_products=a[1].products}if(a[1].bar){shop_bar=a[1].bar}if(a[1].coins){shop_coins=a[1].coins}if(a[1].tutorial){tutorial=a[1].tutorial}if(d=="shopinit"){shop_side=1;if(a[1].first==1){globalerrorbox(t_shopfirststep)}if(tutorial==5){$("t_step1").className="nope";$("t_step2").className="highlight_tutorial_step";showTutorial("8_1",1)}if(b){shopDialog("amount",b)}}if(d=="shopfire"){shop_cart={};if(tutorial==6){closeShop();showTutorial(9,1);return false}}shopBuild()}}}function shopBuild(){$("shop").className="shop_back"+shop_id;$("shop_intro").className="shop_intro"+shop_id;$("shop_intro").innerHTML=t_shop_intro[shop_id];$("shop_products").className="shop_products"+shop_id;$("shop_cart_sum").className="shop_cart_sum"+shop_id;$("shoparrow_left").className="link shoparrow_left"+shop_id;$("shoparrow_right").className="link shoparrow_right"+shop_id;$("shop_cart").className="shop_cart"+shop_id;$("shop_cart_sum_button").className="link shop_cart_sum_button"+shop_id;if(shop_id==2){n=15;shop_sort="z";hideDiv("shop_categories");var c=["z"];var m=shop_products}else{var n=18;if(shop_sort=="z"){shop_sort="v"}showDiv("shop_categories");if(shop_sort=="v"){var c=["v"];$("shop_category_v").removeClassName("shop_category_v");$("shop_category_v").addClassName("shop_category_v_active");$("shop_category_fl").addClassName("shop_category_fl");$("shop_category_fl").removeClassName("shop_category_fl_active");$("shop_category_hr").addClassName("shop_category_hr");$("shop_category_hr").removeClassName("shop_category_hr_active")}if(shop_sort=="hr"){var c=["hr"];$("shop_category_v").addClassName("shop_category_v");$("shop_category_v").removeClassName("shop_category_v_active");$("shop_category_fl").addClassName("shop_category_fl");$("shop_category_fl").removeClassName("shop_category_fl_active");$("shop_category_hr").removeClassName("shop_category_hr");$("shop_category_hr").addClassName("shop_category_hr_active")}else{if(shop_sort=="fl"){var c=["fl"];$("shop_category_v").addClassName("shop_category_v");$("shop_category_v").removeClassName("shop_category_v_active");$("shop_category_fl").removeClassName("shop_category_fl");$("shop_category_fl").addClassName("shop_category_fl_active");$("shop_category_hr").addClassName("shop_category_hr");$("shop_category_hr").removeClassName("shop_category_hr_active")}}var m=[];for(var b=1;b<=shop_products.length;b++){if(in_array(produkt_category[shop_products[(b-1)].pid],c)){m.push(shop_products[(b-1)])}}}var s=1;if(shop_side>1){s=((shop_side-1)*n)+1}var t=(shop_side*n);var e="";var l=1;for(var b=1;b<=m.length;b++){if(in_array(produkt_category[m[(b-1)].pid],c)){if(l>=s&&l<=t){addclass="";if(shop_cart[m[(b-1)].pid]){addclass="shop_item_inactive"}e+='<div class="'+addclass+" shop_item"+shop_id+" link s"+m[(b-1)].pid+"\" onclick=\"shopDialog('amount', "+m[(b-1)].pid+')" onmouseover="showDiv(\'shop_item'+m[(b-1)].pid+"_tt')\" onmouseout=\"hideDiv('shop_item"+m[(b-1)].pid+"_tt')\">";e+='  <div id="shop_item'+m[(b-1)].pid+'_tt" class="shop_item_tt'+shop_id+' ttbox">';e+='    <div class="bold">'+produkt_name[m[(b-1)].pid]+"</div>";var r="";if(m[(b-1)].coins>0){if(m[(b-1)].coins>shop_coins){r="important"}e+='<div class="'+r+'">'+m[(b-1)].coins+"&nbsp;"+t_coins+"</div>"}else{if(m[(b-1)].price>shop_bar){r="important"}e+='<div class="'+r+'">'+formatPrice(m[(b-1)].price)+"</div>"}e+="    <div>"+t_felder+"&nbsp;"+m[(b-1)].fields+"</div>";e+='    <div class="bonusinfo">'+t_addcart+"</div>";e+="  </div>";e+='  <div id="shop_item_amount'+m[(b-1)].pid+'" class="shop_item_amount"></div>';e+="</div>"}l++}}$("shop_products").innerHTML=e;var h=0;var a=0;e="";for(var d in shop_cart){if($("shop_item_amount"+d)){showDiv("shop_item_amount"+d);$("shop_item_amount"+d).innerHTML=shop_cart[d]}e+='<div class="shop_cart_item">';e+='  <div class="link s'+d+"\" onclick=\"shopDialog('amount', "+d+')"></div>';e+='  <div class="shop_cart_item_del link" onclick="shopRemoveCart('+d+')"></div>';e+="</div>";for(var b=0;b<shop_products.length;b++){if(shop_products[b].pid==d){if(shop_products[b].coins>0){a+=(shop_cart[d]*shop_products[b].coins)}else{h+=(shop_cart[d]*shop_products[b].price)}break}}}$("shop_cart").innerHTML=e;var q=formatPrice(h);if(a>0){q+="<br>"+a+"&nbsp;"+t_coins}$("shop_cart_sum").innerHTML=q;if(h>0||a>0){showDiv("shop_cart_sum_button")}else{hideDiv("shop_cart_sum_button")}if(h>0||a>0){if(tutorial==5){$("t_step1").className="nope";$("t_step2").className="nope";$("t_step3").className="highlight_tutorial_step"}}else{if(tutorial==5){$("t_step1").className="nope";$("t_step2").className="highlight_tutorial_step";$("t_step3").className="nope"}}n=Math.ceil(m.length/n);hideDiv("shoparrow_left");hideDiv("shoparrow_right");if(shop_side>1){showDiv("shoparrow_left")}if(shop_side<n){showDiv("shoparrow_right")}hideDiv("shop_category_v");hideDiv("shop_category_fl");hideDiv("shop_category_hr");if(parseInt(currentuserlevel)>=parseInt(farmersmarket_access_level)){showDiv("shop_category_v");showDiv("shop_category_fl");showDiv("shop_category_hr")}if(tutorial==5||tutorial==6){hideDiv("shop_close")}else{showDiv("shop_close")}showDiv("transp3");showDiv("shop")}function setShopCategory(a){shop_sort=a;shop_side=1;shopBuild()}function shopDialog(e,d){var l="";var c="";var n="";if(e=="amount"){var h=0;for(var a in shop_cart){if(d!=a){h++}}var m=12;if(shop_id==2){m=6}if(h>=m){globalerrorbox(t_cartfull);return false}else{l=t_cartbuyhead;for(var a=0;a<shop_products.length;a++){if(shop_products[a].pid==d){var b=1;if(shop_cart[d]){b=shop_cart[d]}c+='<div class="shopdialog_line" style="margin-bottom:10px;">';c+='  <div class="tt'+shop_products[a].pid+'" style="width:50px; margin:0 auto;"></div>';c+='  <div class="bold">'+produkt_name[shop_products[a].pid]+"</div>";if(shop_products[a].coins>0){c+="<div>"+shop_products[a].coins+"&nbsp;"+t_coins+"</div>"}else{c+="<div>"+formatPrice(shop_products[a].price)+"</div>"}c+="</div>";c+='<div class="shopdialog_line">'+t_cartquestion+"</div>";c+='<div id="shopdialog_amount_back" class="shopdialog_line">';c+='  <input type="number" maxlength="7" id="shopdialog_amount" value="'+b+'" onchange="calcShopdialogPrice('+shop_products[a].pid+')" onkeyup="calcShopdialogPrice('+shop_products[a].pid+')">&nbsp;';c+='  <button type="button" class="button_new link" onclick="shopAddCart('+shop_products[a].pid+')">'+t_cartbutton+"</button>";c+="</div>";c+="<div>"+farmcartsum+'&nbsp;<span id="shopdialog_calc"></span></div>';break}}}}globalcommitbox(l,c,n);if($("shopdialog_amount")){$("shopdialog_amount").select();calcShopdialogPrice(d)}}function shopAddCart(a){var b=$("shopdialog_amount").value;b=parseInt(b);if(b<0){return false}shop_cart[a]=parseInt(b);hideDiv("globaltransp");hideDiv("globalbox");shopBuild()}function shopRemoveCart(a){if(shop_cart[a]){delete shop_cart[a]}shopBuild()}function calcShopdialogPrice(a){if(!$("shopdialog_amount")){return false}var d=0;var e=0;for(var c=0;c<shop_products.length;c++){if(shop_products[c].pid==a){e=shop_products[c].price;var b=$("shopdialog_amount").value;b=parseInt(b);d=(b*e);if(isNaN(d)){d=0}if(shop_products[c].coins>0){$("shopdialog_calc").innerHTML=d+"&nbsp;"+t_coins}else{$("shopdialog_calc").innerHTML=formatPrice(d)}break}}}function shopFillForm(a){if(!city||city!=1){mapGo2Location("city",1)}shopAction("shopinit",1,a)}function closeShop(){shop_cart={};shop_block=0;hideDiv("transp3");hideDiv("shop")}var specialbonus=function(){this.data={};this.config={};this.groups={}};specialbonus.prototype.init=function(){setTimer("specialbonus")};specialbonus.prototype.build=function(){this.getGroups();var d="";for(var n in this.groups){d+='<div class="group group_'+n+'">';d+='  <div class="back"></div>';if(t_feature_name[n]){d+='  <div class="title">'+t_feature_name[n]+"</div>"}var h=0;for(var b in this.groups[n]){h++}var l="";for(var b in this.groups[n]){for(var c=0;c<this.groups[n][b].length;c++){var a=this.data[this.groups[n][b][c]].id;if(n=="butterflies"&&a==42){continue}var q=this.getName(a);q=q.replace("<b>",'<span class="bonus">').replace("</b>","</span>");var e=this.data[this.groups[n][b][c]].remain;var m="";if(h==1){m="oneliner"}l+='<div class="line">';l+='  <div class="head '+m+'">'+q+"</div>";if(h>1){l+='<div id="specialbonus_group_line_'+a+'_timer" class="timer">'+formatTime(e)+"</div>"}l+='  <div class="clear"></div>';l+="</div>"}}if(h==1){d+='<div class="title_timer">'+formatTime(e)+"</div>"}d+=l;d+="</div>"}if($("specialbonus_link_tt")){$("specialbonus_link_tt").innerHTML=d}};specialbonus.prototype.getGroups=function(){var c={};for(var b=0;b<this.data.length;b++){for(var a in this.data[b]){if(this.data[b].remain<=0){continue}if(in_array(a,["id","start","end","remain","paymentitem_collection"])){continue}if(!c[a]){c[a]={}}if(!c[a][this.data[b].end]){c[a][this.data[b].end]=[]}c[a][this.data[b].end].push(b)}}this.groups=c};specialbonus.prototype.timer=function(){hideDiv("specialbonus_link");if($("visitor_view")&&$("visitor_view").style.display=="block"){return 1}if(train&&train.widescreen==1){return 1}var b=0;if(this.data.length){for(var a=0;a<this.data.length;a++){this.data[a].remain--;if(this.data[a].remain>0){b++}}}if(b>0){showDiv("specialbonus_link");this.build()}return 1};specialbonus.prototype.getName=function(h){var e=this.config[h];var c="";for(var d in e){if(!t_specialbonus_text[d]){continue}for(bonus in e[d]){if(!t_specialbonus_text[d][bonus]){continue}var c=t_specialbonus_text[d][bonus];if(in_array(bonus,["harvest"])){c=c.replace("%BONUS%",e[d][bonus]).replace("%AMOUNT%",e[d][bonus])}else{c=c.replace("%BONUS%",Math.round(e[d][bonus]*100)).replace("%AMOUNT%",Math.round(e[d][bonus]*100)).replace("%PERCENT%",Math.round(e[d][bonus]*100))}}}if(c==""&&e){if(e.pets){if(e.pets.production_harvest){c=str_replace("%BONUS%",e.pets.production_harvest,t_specialbonus_pets_production_harvest)}if(e.pets.packagediscount){c=str_replace("%PERCENT%",(e.pets.packagediscount*100),t_specialbonus_pets_packagediscount);if(e.pets.type=="coins"){c=c.replace("%NAME%",t_coins,c)}}}if(e.guild&&e.guild.products_reduction_animal){c=str_replace("%BONUS%",(e.guild.products_reduction_animal*100),t_specialbonus_guild_products_reduction_animal)}if(e.blackfriday&&e.paymentitem_collection){c=t_specialbonus_farmis_paymentitem_collection}if(e.rentslots&&e.rentslots.discount){c=str_replace("%PERCENT%",(e.rentslots.discount*100),t_specialbonus_rentslots_discount)}if(e.consumer){c=str_replace("%BONUS%",(e.consumer.money*100),t_specialbonus_consumer_money)}if(e.products&&e.products.harvest&&e.products.group){var b="";if(e.products.group=="ex"){b=t_exotic_plants}if(e.products.group=="hr"){b=t_herb_plants}if(e.products.group=="alpin"){b=t_alpin_plants}if(e.products.group=="water"){b=t_water_plants}if(e.products.group=="spice"){b=t_spice_plants}c=str_replace("%GROUP%",b,t_specialbonus_products_harvest_group);c=str_replace("%AMOUNT%",e.products.harvest,c)}}if(e.consumer){c+='<div class="bonusinfo">';for(var a=0;a<e.consumer.types.length;a++){if(a>0){c+=", "}c+=t_specialbonus_consumer_money_types[e.consumer.types[a]]}c+="</div>"}if(e.production&&e.production.buildings){c+='<div class="bonusinfo">';for(var a=0;a<e.production.buildings.length;a++){if(a>0){c+=", "}c+=buildinginfos[0][e.production.buildings[a]][10]}c+="</div>"}return c};specialbonus.prototype.findBonus=function(b){if(specialbonus.data&&specialbonus.data.length){for(var a=0;a<specialbonus.data.length;a++){if(specialbonus.data[a].remain<=0){continue}if(specialbonus.data[a][b.key1]&&specialbonus.data[a][b.key1][b.key2]){return specialbonus.data[a][b.key1]}}}return 0};specialbonus.prototype.htmlBonusLine=function(b,c){var a="center";if(c){a=""}return'<div class="specialbonus_bonus_line '+a+'">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(b*100))+")</div>"};var specialoffer=function(){this.config={};this.data={}};specialoffer.prototype.buy=function(){this.action("specialoffer_buy")};specialoffer.prototype.daily=function(){this.action("specialoffer_daily")};specialoffer.prototype.action=function(a,b){ajaxAction("main",a,b,specialoffer.response)};specialoffer.prototype.response=function(d,c,e){if(c=="specialoffer_buy"){hideDiv("specialoffer_link");hideDiv("specialoffer_new");globalcommitbox(t_specialoffer_success_head.replace("%NAME%",t_specialoffer_head[specialoffer.config.theme]),t_specialoffer_success_body);$("globalbox_headline").addClassName("short");if(events&&events.data&&events.data.length){var b=[];for(var a=0;a<events.data.length;a++){if(!events.data[a].name){continue}if(events.data[a].name!="specialoffer"){b.push(events.data[a])}}events.data=b}if(specialoffer.data.today){specialoffer.data.today=0}if(eventgarden&&$("eventgarden")&&$("eventgarden").style.display=="block"){eventgarden.init()}if(d.house){architect_current_item=d.house;setFarmhouse(d.house)}}};specialoffer.prototype.init=function(b){if(parseInt(currentuserlevel)<2){return 1}this.newDesign(b);return 1;var a='<div id="specialoffer" class="'+this.config.key+" theme_"+this.config.theme+'">';if(this.config.theme){if(in_array(this.config.theme,["xmas","winter"])){a+='<div class="snowflake"></div>';a+='<div class="snowflake2"></div>'}if(this.config.theme=="halloween"){a+='<div class="ufodeco"></div>'}if(this.config.theme=="waterbattle"){a+='<div class="waterbomb"></div>'}if(this.config.theme=="birthday"){a+='<div class="birthdaydeco"></div>'}if(this.config.theme=="summer"){a+='<div class="icedeco"></div>'}}a+='  <div id="specialoffer_img"></div>';a+='  <div id="specialoffer_content">';var h=1;for(var d in this.config.content){if(d=="decoration"){a+='<div id="specialoffer_item'+h+'" class="specialoffer_item">';for(j=0;j<this.config.content[d].length;j++){a+='<div class="item item'+this.config.content[d][j]+'" style="float:left; margin-right:5px;"></div>';a+='<div style="float:left; width:100px;">'+str_replace("%NAME%",produkt_name[this.config.content[d][j]],t_specialoffer_item.deco)+"</div>";h++}a+='  <div class="clear"></div>';a+="</div>"}if(d=="housedesign"){a+='<div id="specialoffer_item'+h+'" class="specialoffer_item">';a+='  <div class="headquarter_design'+this.config.content[d]+'_preview" style="float:left; margin-right:5px; width:50px; height:50px; background-size:100%;"></div>';a+='  <div style="float:left; width:100px;">'+t_farmhouse_name[this.config.content[d]]+"<br>"+t_farmhouse_style+"</div>";a+='  <div class="clear"></div>';a+="</div>";h++}if(d=="farmhouse"){for(j=0;j<this.config.content[d].length;j++){a+='<div id="specialoffer_item'+h+'" class="specialoffer_item">';a+='	<div class="farmhouse'+this.config.content[d][j]+'" style="float:left; margin-right:5px;"></div>';a+='	<div style="float:left; width:100px;">'+t_specialoffer_item["farmhouse"+this.config.content[d][j]]+"</div>";a+='  <div class="clear"></div>';a+="</div>";h++}}if(in_array(d,["acai","chocolate","ice","candy","water","gift","brezels"])){a+='<div id="specialoffer_item'+h+'" class="specialoffer_item">';a+='  <div class="olympia_'+d+'_berry_mini" style="float:left; margin-right:5px;"></div>';a+='  <div style="float:left; width:100px;">'+str_replace("%AMOUNT%",formatNumber(this.config.content[d]),t_specialoffer_item[d])+"</div>";a+='  <div class="clear"></div>';a+="</div>";h++}if(d=="ammo"){for(var e in this.config.content[d]){a+='<div id="specialoffer_item'+h+'" class="specialoffer_item">';a+='  <div class="ammo'+e+'" style="float:left; margin-right:5px; width:50px; height:50px;"></div>';a+='  <div style="float:left; width:100px;">'+formatNumber(this.config.content[d][e])+"x "+t_specialoffer_item[d]+"</div>";a+='  <div class="clear"></div>';a+="</div>";h++}}if(d=="tinkergame"){for(var e in this.config.content[d]){a+='<div id="specialoffer_item'+h+'" class="specialoffer_item short">';a+='  <div class="tinkergame item'+e+'"></div>';a+='  <div style="float:left; width:45px; margin-top:15px;">x'+this.config.content[d][e]+"</div>";a+='  <div class="clear"></div>';a+="</div>";h++}}if(d=="balls"){a+='<div id="specialoffer_item'+h+'" class="specialoffer_item">';a+='  <div class="mastermind balls"></div>';a+='  <div style="float:left; width:45px; margin-top:15px;">x'+this.config.content[d]+"</div>";a+='  <div class="clear"></div>';a+="</div>";h++}}a+='    <div class="clear"></div>';a+="  </div>";a+='  <div class="link coinsbutton_flex" onclick="specialoffer.buyCommit()">'+str_replace("%COINS%",this.config.coins,t_buy_offer)+"</div>";a+='  <div id="specialoffer_timer"></div>';if(this.config.discount){a+='<div class="discount bonus_star pulse">';a+='  <div class="inner">'+this.config.discount+"% "+t_specialbonus_pets_packagediscount_info+"</div>";a+="</div>"}a+="</div>";var c=0;if(b){c="specialoffer.daily()"}globalBoxFlex(t_specialoffer_head[this.config.theme],a,0,c,1);$("globalbox").style.top=65+"px";if(h==6){$("specialoffer_item3").addClassName("short");$("specialoffer_item4").addClassName("short");$("specialoffer_item5").addClassName("short")}};specialoffer.prototype.newDesign=function(b){var e="";e+='<div class="back"></div>';e+='<div class="border"></div>';e+='<div class="deco"></div>';e+='<div class="deco2"></div>';e+='<div class="deco3"></div>';e+='<div class="effects">';if(in_array(this.config.theme,["halloween"])){e+='<div class="clouds1"></div>';e+='<div class="clouds2"></div>';e+='<div class="ufo"></div>'}if(in_array(this.config.theme,["birthday","easter"])){for(var d=1;d<=3;d++){e+='<div class="flower_flight set set'+d+'">';for(var c=1;c<=3;c++){for(var a=1;a<=3;a++){e+='<div class="flower'+a+'"></div>'}}e+="  </div>"}}e+="</div>";e+=this.showFarmhouseBonus(this.config.content.housedesign);e+='<div class="house">';e+='  <div class="house_inner"></div>';e+="</div>";e+='<div class="headline">'+t_specialoffer_head[this.config.theme]+"</div>";e+='<div class="slots">';if(this.config.content.eventitems){for(var d in this.config.content.eventitems){e+='<div class="slot" onmouseover="showDiv(\'specialoffer_eventitem_'+d+"_tt')\" onmouseout=\"hideDiv('specialoffer_eventitem_"+d+"_tt')\">";e+='  <div class="item eventitem item'+d+'"></div>';e+='  <div class="amount">'+formatNumber(this.config.content.eventitems[d])+"x</div>";e+='  <div id="specialoffer_eventitem_'+d+'_tt" class="ttbox">';e+='    <div class="desc">'+t_specialoffer_slot_eventitem+"</div>";e+='    <div class="name">'+t_eventgarden_eventitem[d]+"</div>";e+="  </div>";e+="</div>"}}if(this.config.content.eventgarden){for(var d in this.config.content.eventgarden){e+='<div class="slot" onmouseover="showDiv(\'specialoffer_eventgarden_product_'+d+"_tt')\" onmouseout=\"hideDiv('specialoffer_eventgarden_product_"+d+"_tt')\">";e+='  <div class="img eventgarden_product '+d+'"></div>';e+='  <div class="amount">'+this.config.content.eventgarden[d]+"x</div>";e+='  <div id="specialoffer_eventgarden_product_'+d+'_tt" class="ttbox">';e+='    <div class="desc">'+t_specialoffer_slot_eventgarden_product+"</div>";e+='    <div class="name">'+eventgarden.data.config.products[d].name+"</div>";e+="  </div>";e+="</div>"}}if(this.config.content.ammo){for(var d in this.config.content.ammo){e+='<div class="slot" onmouseover="showDiv(\'specialoffer_ammo'+d+"_tt')\" onmouseout=\"hideDiv('specialoffer_ammo"+d+"_tt')\">";e+='  <div class="ammo'+d+'"></div>';e+='  <div class="amount">'+this.config.content.ammo[d]+"x</div>";e+='  <div id="specialoffer_ammo'+d+'_tt" class="ttbox">'+t_specialoffer_item.ammo+"</div>";e+="</div>"}}if(this.config.content.farmhouse){for(var d=0;d<this.config.content.farmhouse.length;d++){e+='<div class="slot" onmouseover="showDiv(\'specialoffer_farmhouse_item_'+this.config.content.farmhouse[d]+"_tt')\" onmouseout=\"hideDiv('specialoffer_farmhouse_item_"+this.config.content.farmhouse[d]+"_tt')\">";e+='  <div class="farmhouse_item farmhouse_item'+this.config.content.farmhouse[d]+'"></div>';e+='  <div id="specialoffer_farmhouse_item_'+this.config.content.farmhouse[d]+'_tt" class="ttbox">';e+="    <div>"+t_farmhouse_item+"</div>";e+='    <div style="font-style:italic;">('+t_farmhouse_category[farmhouseitems_config[this.config.content.farmhouse[d]][0]]+")</div>";e+="  </div>";e+="</div>"}}e+="</div>";e+='<div class="buybutton">';e+='  <div class="link coinsbutton_flex" onclick="specialoffer.buyCommit()">'+str_replace("%COINS%",this.config.coins,t_buy_offer)+"</div>";e+="</div>";e+='<div id="specialoffer_timer"></div>';e+='<div class="banner">';e+='  <div class="text3">'+t_specialoffer_banner_text.toUpperCase()+"</div>";e+="</div>";if(this.config.discount){var l='<span class="col1">'+this.config.discount+'%</span> <span class="col2">'+t_specialbonus_pets_packagediscount_info.toUpperCase()+"</span>";e+='<div class="discount bonus_star pulse">';e+='  <div class="inner">'+l+"</div>";e+="</div>"}var h="hideDiv('specialoffer_new');";if(b){h+=" specialoffer.daily()"}e+='<div class="mini_close link" onclick="'+h+'"></div>';$("specialoffer_new_content").innerHTML=e;showDiv("specialoffer_new");$("specialoffer_new").addClassName(this.config.key).addClassName(this.config.theme);$("specialoffer_new_content").addClassName("bounce")};specialoffer.prototype.showFarmhouseBonus=function(b){var a="";if(!farmhouse_style_config[b]||!farmhouse_style_config[b].bonus){return a}a+='<div class="bonus">';a+='  <div class="icon"></div>';a+='  <div class="desc">'+this.getFarmhouseBonusDesc(b)+"</div>";a+='  <div class="clear"></div>';a+="</div>";return a};specialoffer.prototype.getFarmhouseBonusDesc=function(b){var a=farmhouse_style_config[b].bonus.token;var c=t_farmhouse_bonus_info[a.toLowerCase()];var d=farmhouse_style_config[b].bonus;if(d.points){c=c.replace("%PERCENT%",(d.points*100))}if(d.cooldown){c=c.replace("%PERCENT%",(d.cooldown*100)).replace("%COOLDOWN%",(d.cooldown*100))}if(d.waterreduction){c=c.replace("%PERCENT%",(d.waterreduction*100))}if(d.harvest){c=c.replace("%HARVEST%",(d.harvest*100))}if(d.discount){c=c.replace("%PERCENT%",(d.discount*100))}return c};specialoffer.prototype.buyCommit=function(){var b=t_specialoffer_head[this.config.theme];if(t_specialoffer_head[this.config.key]){b=t_specialoffer_head[this.config.key]}var a=str_replace("%COINS%",this.config.coins,t_specialoffer_body.replace("%NAME%",b));globalcommitbox(b,a,"specialoffer.buy()")};specialoffer.prototype.timer=function(){this.data.remain--;if(this.data.remain>0){if($("specialoffer_timer")){$("specialoffer_timer").innerHTML=t_offer_ends+"&nbsp;"+formatTime(this.data.remain)}}else{if($("specialoffer_timer")){hideDiv("globaltransp");hideDiv("globalbox");hideDiv("specialoffer_link")}}};var spicehouse=function(){this.data={};this.farm=10;this.currentView="room1";this.stats_options=["points","customers_served"];this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.currentPid=0;this.setup={};this.setupProducts={};this.tutorialType="";this.tutorialStep=1;this.position=0;this.ready={oven:{},mill:{}}};spicehouse.prototype.speedupCustomer=function(a){spicehouse.action("spicehouse_speedup_customer",{slot:a})};spicehouse.prototype.denyCustomer=function(a){spicehouse.action("spicehouse_deny_customer",{slot:a})};spicehouse.prototype.buyMillBooster=function(){spicehouse.action("spicehouse_buy_millbooster")};spicehouse.prototype.setTutorial=function(){spicehouse.action("spicehouse_settutorial",{type:spicehouse.tutorialType})};spicehouse.prototype.stats=function(){if($("spicehouse_stats_select")){if($("spicehouse_stats_select").value==0){return 1}spicehouse.stats_select=$("spicehouse_stats_select").value}if(spicehouse.stats_cache_delay[spicehouse.stats_select]<=0||!spicehouse.stats_cache[this.stats_select]){spicehouse.action("spicehouse_stats",{type:spicehouse.stats_select})}else{spicehouse.showStats(spicehouse.stats_select)}};spicehouse.prototype.clearMill=function(a){spicehouse.action("spicehouse_clear_mill",{slot:a})};spicehouse.prototype.harvestMill=function(a){spicehouse.action("spicehouse_harvest_mill",{slot:a})};spicehouse.prototype.setMill=function(b){var a=+$("spicehouse_products_entry").value;spicehouse.action("spicehouse_set_millslot",{slot:b,pid:this.currentPid,amount:a})};spicehouse.prototype.rentMill=function(a){spicehouse.action("spicehouse_rent_mill",{slot:a})};spicehouse.prototype.upgradeMillSlot=function(a){spicehouse.action("spicehouse_upgrade_millslot",{slot:a})};spicehouse.prototype.rentOvenLine=function(a){spicehouse.action("spicehouse_rent_ovenline",{line:a})};spicehouse.prototype.speedupOven=function(){spicehouse.action("spicehouse_speedup_oven")};spicehouse.prototype.openOven=function(){spicehouse.action("spicehouse_open_oven")};spicehouse.prototype.startOven=function(b){var a=JSON.stringify(this.setup);spicehouse.action("spicehouse_start_oven",{setup:a})};spicehouse.prototype.upgradeOvenLine=function(a){spicehouse.action("spicehouse_upgrade_ovenline",{line:a})};spicehouse.prototype.buyCustomerSlot=function(a){spicehouse.action("spicehouse_buy_customerslot",{slot:a})};spicehouse.prototype.acceptCustomer=function(a){spicehouse.action("spicehouse_accept_customer",{slot:a})};spicehouse.prototype.buyAddLevel=function(){spicehouse.action("spicehouse_buy_add_level")};spicehouse.prototype.addLevel=function(){spicehouse.action("spicehouse_add_level",{amount:$("spicehouse_dialog_leveladd_insert").value})};spicehouse.prototype.init=function(){spicehouse.action("spicehouse_init")};spicehouse.prototype.action=function(a,b){ajaxAction("farm",a,b,spicehouse.response)};spicehouse.prototype.response=function(e,d,h){if(in_array(d,["spicehouse_settutorial"])){return 1}if(in_array(d,["spicehouse_init","spicehouse_open_oven"])){spicehouse.setup={}}spicehouse.ready={oven:{},mill:{}};spicehouse.build();if(e.stats){spicehouse.stats_cache_delay[spicehouse.stats_select]=30;if(!spicehouse.stats_cache[spicehouse.stats_select]){spicehouse.stats_cache[spicehouse.stats_select]={}}spicehouse.stats_cache[spicehouse.stats_select]=e.stats;spicehouse.showStats()}if(d=="spicehouse_open_oven"&&e&&e.setup){spicehouse.setup=e.setup;spicehouse.buildRoom1()}if(d=="spicehouse_speedup_customer"){spicehouse.buildRoom1()}if(in_array(d,["spicehouse_accept_customer"])){spicehouse.moveCustomer(h.slot)}if(d=="spicehouse_kick_customer"){spicehouse.kickCustomer(h.slot)}if(e&&in_array(d,["spicehouse_open_oven","spicehouse_set_millslot","spicehouse_harvest_mill","spicehouse_clear_mill"])){var c=0;for(var a in e){if(!produkt_name[a]){continue}c++}if(!c){return 1}var b='<div id="spicehouse_commit">';b+="  <div>"+t_spicehouse_harvest_result_desc+"</div>";b+='  <div class="oven_result">';for(var a in e){if(a=="money"){b+="<div>"+formatPrice(e.money)+"</div>"}else{if(a=="points"){b+="<div>"+formatNumber(e.points)+"</div>"}else{if(a=="spicehouse_points"){b+='<div style="display:flex; justify-content:center; align-items:center;">';b+='  <div class="spicehouse_points" style="width:20px; height:20px;"></div>';b+="  <div>"+formatNumber(e.spicehouse_points)+"&nbsp;"+t_spicehouse_points+"</div>";b+="</div>"}else{b+='<div class="line_p flex-center-all">';b+='  <div class="kp'+a+'"></div>';b+='  <div class="amount"><span>'+formatNumber(e[a])+"x</span>&nbsp;"+produkt_name[a]+"</div>";b+="</div>"}}}}b+="  </div>";b+="</div>";globalcommitbox(t_spicehouse_harvest_result_head,b,0,0,1)}};spicehouse.prototype.build=function(){var a="";a+='<div id="spicehouse_view" class="view map">';a+='  <div id="spicehouse_room1" class="room1"></div>';a+='  <div id="spicehouse_room2" class="room2"></div>';a+="</div>";a+='<div id="spicehouse_customers" class="customers flex-center-all"></div>';a+=htmlLevelBar("spicehouse");a+=htmlCountBar("spicehouse");a+='<div id="spicehouse_stats_link" class="link" onclick="spicehouse.stats()" onmouseover="showDiv(\'spicehouse_stats_link_tt\')" onmouseout="hideDiv(\'spicehouse_stats_link_tt\')">';a+='  <div id="spicehouse_stats_link_tt" class="ttbox">'+t_foodcontest_stats_button+"</div>";a+="</div>";a+='<div class="help helpbutton_blue link" onclick="spicehouse.help()"></div>';a+='<div class="mini_close link" onclick="spicehouse.close()"></div>';$("spicehouse_main").innerHTML=a;$("spicehouse_levelbar_number").innerHTML=this.data.data.level;$("spicehouse_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var b=t_reached_maxlevel;hideDiv("spicehouse_levelbar_plus")}else{var b=t_spicehouse_level_line.replace("%NAME%",t_spicehouse_points).replace("%AMOUNT%",this.data.data.level_rest);$("spicehouse_levelbar_plus").onclick=new Function("spicehouse.addLevelCommit()");$("spicehouse_levelbar_plus_tt").innerHTML=t_spicehouse_leveladd_tt.replace("%NAME%",t_spicehouse_points)}$("spicehouse_levelbar_tt").innerHTML=b;$("spicehouse_countbar_inner").innerHTML='<div class="spicehouse_points"></div><div>'+formatNumber(this.data.data.count)+"</div><br>";$("spicehouse_countbar_plus_tt").innerHTML=t_spicehouse_levelitem_buy.replace("%NAME%",t_spicehouse_points);$("spicehouse_countbar_plus").onclick=new Function("spicehouse.buyAddLevelCommit()");this.buildRoom1();this.buildRoom2();this.buildCustomers();this.setView(this.currentView);$("spicehouse").style.display="flex";$("spicehouse_main").addClassName("bounce");this.timerUpdate()};spicehouse.prototype.setView=function(a){this.currentView=a;$("spicehouse_view").className="view "+a;if(a=="room2"){this.startTutorial("ismills")}};spicehouse.prototype.addLevelCommit=function(){var b=t_spicehouse_dialog_leveladd_head.replace("%NAME%",t_spicehouse_points);var a=htmlLevelAddDialog("spicehouse");globalcommitbox(b,a,0,0,1);$("spicehouse_dialog_leveladd_insert").focus()};spicehouse.prototype.addLevelCheck=function(){var a=$("spicehouse_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>spicehouse.data.data.count){a=spicehouse.data.data.count}$("spicehouse_dialog_leveladd_insert").value=a};spicehouse.prototype.buyAddLevelCommit=function(a){var h=t_spicehouse_levelitem_buy.replace("%NAME%",t_spicehouse_points);var c=spicehouse.data.data.exchangeamount;var n="";var l="";var e=specialbonus.findBonus({key1:"spicehouse",key2:"buypoints"});if(e){n=specialbonus.htmlBonusLine(e.buypoints);l="specialbonus_bonus_value";c=Math.ceil(c*(1+e.buypoints))}var b=t_spicehouse_levelitem_buy_dialog.replace("%COINS%",spicehouse.data.data.exchangecoins).replace("%AMOUNT%",'<span class="'+l+'">'+c+"</span>").replace("%NAME%",t_spicehouse_points);if(!a){var d='<div class="link coinsbutton_flex" onclick="spicehouse.buyAddLevelCommit(1)" style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}globalcommitbox(h,d,0,0,1)}else{var d='<div style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}var m="spicehouse.buyAddLevel()";globalcommitbox(h,d,m)}};spicehouse.prototype.buildCustomers=function(){var e="";for(var b in this.data.config.customers){var m=this.data.config.customers[b];var h="";var d="";var r="spicehouse.clickCustomer("+b+")";var l=0;if(this.data.data.customers_slots&&this.data.data.customers_slots[b]&&this.data.data.customers_slots[b].buydate){r="";if(this.data.data.customers&&this.data.data.customers[b]){l=this.data.data.customers[b].id;h=this.customerTT(b);var n=this.isCustomerReady(b)}}else{if(m.money||m.coins||m.spicehouse_points){var q="";d="unlocked";if(m.money){if(+m.money>+user_bar){d="locked";q="important";r=""}var a=formatPrice(m.money)}if(m.coins){if(+m.coins>+user_coins){d="locked";q="important";r=""}var a=formatNumber(m.coins)+" "+t_coins}if(m.spicehouse_points){if(+m.spicehouse_points>+this.data.data.count){d="locked";q="important";r=""}var a=formatNumber(m.spicehouse_points)+" "+t_spicehouse_points}h+='<div class="'+q+'">'+t_spicehouse_buy_customerslot.replace("%COST%",a)+"</div>"}if(m.level&&+m.level>+this.data.data.level){d="locked";h+='<div class="important">'+t_spicehouse_requires_level.replace("%COUNT%",m.level)+"</div>";r=""}if(m.quest&&+m.quest>+this.data.quest.questid){d="locked";h+='<div class="important">'+t_spicehouse_requires_quest.replace("%COUNT%",m.quest)+"</div>";r=""}}var q="";if(b>=4){q="right"}if(!l){q+=" free"}e+='<div id="spicehouse_customer'+b+'" class="customer link '+q+'" onclick="'+r+'" onmouseover="showDiv(\'spicehouse_customer'+b+"_tt')\" onmouseout=\"hideDiv('spicehouse_customer"+b+"_tt')\">";if(l>0){e+='<div id="spicehouse_char'+b+'" class="char char'+this.data.data.customers[b].img+'">'+this.buildCustomerImg(b)+"</div>";if(this.isCustomerReady(b)){e+='<div id="spicehouse_char'+b+'_ready" class="ready"></div>'}}else{e+='<div id="spicehouse_customer'+b+'_timer" class="customer_timer">';e+='  <div id="spicehouse_customer'+b+'_timer_timer"></div>';e+='  <div class="production_slot_speedup link" onclick="spicehouse.speedupCustomerCommit('+b+')" onmouseover="showDiv(\'spicehouse_customer'+b+"_speedup_tt')\" onmouseout=\"hideDiv('spicehouse_customer"+b+"_speedup_tt')\">";e+='    <div id="spicehouse_customer'+b+'_speedup_tt" class="ttbox">'+t_spicehouse_speedup_customer_button+"</div>";e+="  </div>";e+="</div>"}if(d!=""){e+='<div class="'+d+'"></div>'}if(h!=""){e+='<div id="spicehouse_customer'+b+'_tt" class="ttbox">'+h+"</div>"}e+="</div>"}$("spicehouse_customers").innerHTML=e};spicehouse.prototype.isCustomerReady=function(e){var c=1;for(var b in this.data.data.customers[e].data){var a=this.data.data.customers[e].data[b];var d=checkRackItem(b,this.farm);if(+a>+d){c=0}}return c};spicehouse.prototype.clickCustomer=function(a){if(this.data.data.customers&&this.data.data.customers[a]){if(this.data.data.customers[a].remain<=0){return 1}if(!this.isCustomerReady(a)){return 1}this.kickCustomer(a);setTimeout(function(){spicehouse.acceptCustomer(a)},1250)}else{spicehouse.buyCustomerSlotCommit(a)}};spicehouse.prototype.buyCustomerSlotCommit=function(d){if(this.data.config.customers[d].money&&this.data.config.customers[d].money>0){var c=formatPrice(this.data.config.customers[d].money)}if(this.data.config.customers[d].coins&&this.data.config.customers[d].coins>0){var c=formatNumber(this.data.config.customers[d].coins)+"&nbsp;"+t_coins}if(this.data.config.customers[d].spicehouse_points&&this.data.config.customers[d].spicehouse_points>0){var c=formatNumber(this.data.config.customers[d].spicehouse_points)+"&nbsp;"+t_spicehouse_points}var a='<div id="spicehouse_commit">';a+="  <div>"+t_spicehouse_buy_customerslot_desc.replace("%COST%",'<span class="cost">'+c+"</span>")+"</div>";a+="</div>";var b="spicehouse.buyCustomerSlot("+d+")";globalcommitbox(t_spicehouse_buy_customerslot_head,a,b)};spicehouse.prototype.moveCustomer=function(a){if(!$("spicehouse_char"+a)){return 1}$("spicehouse_char"+a).addClassName("move");setTimeout(function(){$("spicehouse_char"+a).removeClassName("move")},1000);hideDiv("spicehouse_char"+a+"_ready");if(spicehouse.isCustomerReady(a)){setTimeout(function(){showDiv("spicehouse_char"+a+"_ready")},1500)}};spicehouse.prototype.kickCustomer=function(a){$("spicehouse_char"+a).addClassName("grow");$("spicehouse_customer"+a).onmouseover=new Function();setTimeout(function(){hideDiv("spicehouse_customer"+a+"_tt");$("spicehouse_char"+a).removeClassName("grow")},250);hideDiv("spicehouse_char"+a+"_ready");setTimeout(function(){$("spicehouse_char"+a).addClassName("move")},1000)};spicehouse.prototype.customerTT=function(n){var c='<div id="spicehouse_customer_info">';var l=1;var a=0;for(var d in this.data.data.customers[n].data){var h=this.data.data.customers[n].data[d];var e=checkRackItem(d,this.farm);var q="";if(in_array(d,this.data.data.validproducts.spice)&&map_transfer_rest[this.farm].spice&&!in_array(d,this.data.config.constants.oven_additional_products)){e-=map_transfer_rest[this.farm].spice;q="*";a++}var m="";if(+h>+e){m="important";l=0}c+='<div class="line '+m+'">';c+='  <div class="kp'+d+'"></div>';c+='  <div class="name">'+produkt_name[d]+"</div>";c+='  <div class="amount">'+Math.max(0,e)+q+"/"+h+"</div>";c+="</div>"}if(a>0){c+='<div style="font-style:italic;">'+t_spicehouse_oven_product_reserve_info.replace("%COUNT%",map_transfer_rest[this.farm].spice)+"</div>"}c+='  <div class="reward">';c+='    <div class="head">'+t_help_new_reward+"</div>";for(var b in this.data.data.customers[n].reward){if(b=="money"){c+="<div>"+formatPrice(this.data.data.customers[n].reward[b])+"</div>"}if(b=="points"){c+="<div>"+formatNumber(this.data.data.customers[n].reward[b])+"&nbsp;"+t_points+"</div>"}if(b=="spicehouse_points"){c+="<div>"+formatNumber(this.data.data.customers[n].reward[b])+"&nbsp;"+t_spicehouse_points+"</div>"}}c+="  </div>";c+='  <div class="button_new link denied" onclick="spicehouse.denyCustomerCommit('+n+')">'+t_spicehouse_deny_customer_button+"</div>";m="off";if(l==1){m=""}c+='  <div class="button_new link '+m+'" onclick="spicehouse.clickCustomer('+n+')">'+t_spicehouse_button_customer+"</div>";c+="</div>";return c};spicehouse.prototype.buildCustomerImg=function(c){var a=this.data.data.customers[c].img;var b='<div class="img">';b+='  <div class="customer_body body'+a.body+"_"+a.color+'"></div>';b+='  <div class="customer_face face'+a.face+"_"+a.color+'"></div>';b+='  <div class="customer_eyes eyes'+a.eyes+'"></div>';b+='  <div class="customer_nose nose'+a.nose+'"></div>';b+='  <div class="customer_mouth mouth'+a.mouth+'"></div>';b+='  <div class="customer_hair hair'+a.hair+'"></div>';b+="</div>";return b};spicehouse.prototype.denyCustomerCommit=function(c){var a='<div id="spicehouse_commit">';a+="  <div>"+t_spicehouse_deny_customer_desc.replace("%TIME%",'<span class="cost">'+formatTime(this.data.config.constants.customer_cooldown)+"</span>")+"</div>";a+="</div>";var b="spicehouse.denyCustomer("+c+")";globalcommitbox(t_spicehouse_deny_customer_head,a,b)};spicehouse.prototype.speedupCustomerCommit=function(h){var b="";var a=Math.ceil(this.data.data.customers_slots[h].remain/this.data.config.constants.customer_speedup_cost);if(+a>+user_coins){b="important"}var e=a+"&nbsp;"+t_coins;var c='<div id="spicehouse_commit">';c+="  <div>"+t_spicehouse_speedup_customer_desc.replace("%COST%",'<span class="cost '+b+'">'+e+"</span>")+"</div>";c+="</div>";var d="spicehouse.speedupCustomer("+h+")";globalcommitbox(t_spicehouse_speedup_customer_head,c,d);if(b!=""){hideDiv("globalbox_button1")}};spicehouse.prototype.buildRoom1=function(){if(this.data.data.oven){this.setup=this.data.data.oven.data}for(var r in this.data.config.oven_levels){}var b='<div id="spicehouse_oven" class="oven">';b+='  <div class="timer">';b+='    <div class="timer_bar">';b+='      <div id="spicehouse_timer_bar_inner" class="timer_bar_inner"></div>';b+="    </div>";b+='    <div id="spicehouse_oven_timer" class="counter"></div>';b+='    <div id="spicehouse_oven_button_speedup" class="production_slot_speedup link" onclick="spicehouse.speedupOvenCommit()" onmouseover="showDiv(\'spicehouse_oven_button_speedup_tt\')" onmouseout="hideDiv(\'spicehouse_oven_button_speedup_tt\')">';b+='      <div id="spicehouse_oven_button_speedup_tt" class="ttbox">'+t_spicehouse_oven_speedup_head+"</div>";b+="    </div>";b+="  </div>";b+='  <div class="lines">';for(var s in this.data.config.oven){if(!this.data.config.oven[s].slots){continue}var q="";var n="";var e="";if(+this.data.config.oven[s].level>+this.data.data.level){n="is-locked";e='<div class="important">'+t_spicehouse_level_required.replace("%LEVEL%",this.data.config.oven[s].level)+"</div>"}else{if(this.data.config.oven[s].rent){if(!this.data.data.oven_slots[s].buydate||this.data.data.oven_slots[s].remain<=0){n="is-unlocked";e+="<div>"+t_spicehouse_oven_slot_rent.replace("%COST%",this.data.config.oven[s].rent.coins+"&nbsp;"+t_coins).replace("%TIME%",formatTime(this.data.config.oven[s].rent.duration))+"</div>";if(!this.data.data.oven){q="spicehouse.rentOvenLineCommit("+s+")"}}}}b+='<div id="spicehouse_oven_line'+s+'" class="line '+n+'">';var d=0;if(this.setup[s]){for(var a in this.setup[s]){if(!this.setup[s][a].pid){continue}d+=this.setup[s][a].amount}}var h=this.getOvenLineMaxCapacity(s);var c=((d*100)/h);b+='<div class="slots link flex-center-all" onclick="'+q+'" onmouseover="showDiv(\'spicehouse_oven_line'+s+"_tt')\" onmouseout=\"hideDiv('spicehouse_oven_line"+s+"_tt')\">";for(var m=1;m<=this.data.config.oven[s].slots;m++){var l="";var q="spicehouse.clickOvenSlot("+s+", "+m+")";if(this.setup[s]&&this.setup[s][m]&&this.setup[s][m].pid){q=""}if(this.data.data.oven){q=""}if(q!=""&&c>=100){l="off";q=""}b+='<div class="slot link '+l+'" onclick="'+q+'">';if(q!=""){b+='<div class="drawplus"></div>'}else{if(this.setup[s]&&this.setup[s][m]&&this.setup[s][m].pid){b+='<div class="pid tt'+this.setup[s][m].pid+'"></div>';b+='<div class="amount flex-center-all"><div style="padding:2px;">'+this.setup[s][m].amount+"</div></div>";if(q==""&&!this.data.data.oven){b+='<div class="remove link close_mini_white" onclick="spicehouse.removeSetup('+s+", "+m+')"></div>'}}}b+="</div>"}if(n!=""){b+='<div class="'+n.replace("is-","")+'"></div>'}if(this.data.config.oven[s].rent){b+='<div id="spicehouse_oven_line'+s+'_renttimer" class="renttimer"></div>'}if(e!=""){b+='<div id="spicehouse_oven_line'+s+'_tt" class="ttbox">'+e+"</div>"}b+="</div>";b+='  <div class="slot_info">';b+='    <div class="oven_bar" onmouseover="showDiv(\'spicehouse_oven'+s+"_bar_tt')\" onmouseout=\"hideDiv('spicehouse_oven"+s+"_bar_tt')\">";b+='      <div class="oven_bar_inner" style="height:'+c+'%"></div>';b+='      <div id="spicehouse_oven'+s+'_bar_tt" class="ttbox">';b+="        <div>"+t_spicehouse_oven_slot_capacity+"</div>";b+='        <div style="font-weight:bold; font-size:12px;">'+d+"/"+h+"</div>";b+="      </div>";b+="    </div>";b+='    <div class="oven_bar_level">'+this.data.data.oven_slots[s].level+"</div>";if(n==""&&!this.data.data.oven&&+this.data.data.oven_slots[s].level<+r){b+='<div class="oven_bar_upgrade link" onclick="spicehouse.upgradeOvenLineCommit('+s+')" onmouseover="showDiv(\'spicehouse_oven_line'+s+"_upgrade_tt')\" onmouseout=\"hideDiv('spicehouse_oven_line"+s+"_upgrade_tt')\">";b+='  <div class="img"></div>';b+='  <div id="spicehouse_oven_line'+s+'_upgrade_tt" class="ttbox">'+t_spicehouse_oven_line_upgrade_head+"</div>";b+="</div>"}b+="  </div>";b+="</div>"}b+="  </div>";b+="</div>";b+='<div id="spicehouse_oven_controls" class="controls link" onclick="spicehouse.clickOvenControls()" onmouseover="showDiv(\'spicehouse_oven_controls_tt\')" onmouseout="hideDiv(\'spicehouse_oven_controls_tt\')">';b+='  <div id="spicehouse_oven_controls_tt" class="ttbox"></div>';b+="</div>";b+='<div id="spicehouse_room1_scroller" class="scroller right" onclick="spicehouse.setView(\'room2\')" onmouseover="showDiv(\'spicehouse_view_room1_scroller_tt\')" onmouseout="hideDiv(\'spicehouse_view_room1_scroller_tt\')">';b+='  <div id="spicehouse_view_room1_scroller_tt" class="ttbox">'+t_spicehouse_goto_room2+"</div>";b+="</div>";$("spicehouse_room1").innerHTML=b;this.startTutorial("isoven")};spicehouse.prototype.clickOvenControls=function(){if(!this.data.data.oven){if(!this.checkOvenSetup()){return 1}this.startOvenCommit()}else{if(this.data.data.oven.remain>0){this.openOvenCommit()}else{this.openOven()}}};spicehouse.prototype.openOvenCommit=function(){var a='<div id="spicehouse_commit">';a+="<div>"+t_spicehouse_open_oven_cancel+"</div>";a+="</div>";var b="spicehouse.openOven()";globalcommitbox(t_spicehouse_open_oven_head,a,b)};spicehouse.prototype.clickOvenSlot=function(a,b){this.clickSlot("oven",a,b)};spicehouse.prototype.setSetup=function(a,d){var b=this.currentPid;var c=+$("spicehouse_products_entry").value;if(!this.setup[a]){this.setup[a]={}}this.setup[a][d]={pid:b,amount:c};this.currentPid=0;hideDiv("globaltransp");hideDiv("globalbox");this.buildRoom1();this.timerUpdate()};spicehouse.prototype.removeSetup=function(a,b){delete this.setup[a][b];this.buildRoom1()};spicehouse.prototype.upgradeOvenLineCommit=function(a){this.upgradeCapacity("oven",a)};spicehouse.prototype.rentOvenLineCommit=function(b){var a="";if(+this.data.config.oven[b].rent.coins>user_coins){a="important"}var e=this.data.config.oven[b].rent.coins+"&nbsp;"+t_coins;var c='<div id="spicehouse_commit">';c+="<div>"+t_spicehouse_oven_line_rent_desc.replace("%COST%",'<span class="cost '+a+'">'+e+"</span>").replace("%TIME%",'<span class="cost">'+formatTime(this.data.config.oven[b].rent.duration)+"</span>")+"</div>";c+="</div>";var d="spicehouse.rentOvenLine("+b+")";globalcommitbox(t_spicehouse_oven_line_rent_head,c,d);if(a!=""){hideDiv("globalbox_button1")}};spicehouse.prototype.getOvenLineMaxCapacity=function(a){return this.data.config.oven_levels[this.data.data.oven_slots[a].level].capacity};spicehouse.prototype.startOvenCommit=function(){var a="";if(+this.data.config.constants.oven_start_money>+user_bar){a="important"}var e=formatPrice(this.data.config.constants.oven_start_money);var d=this.data.config.constants.oven_duration;var b='<div id="spicehouse_commit">';b+="  <div>"+t_spicehouse_start_oven_desc.replace("%COST%",'<span class="cost '+a+'">'+e+"</span>")+"</div>";b+='  <div class="duration">';b+="    <div>"+t_spicehouse_oven_duration+":</div>";b+='    <div class="time">'+formatTime(d)+"</div>";b+="  </div>";b+="</div>";var c="spicehouse.startOven()";globalcommitbox(t_spicehouse_start_oven_head,b,c);if(a!=""){hideDiv("globalbox_button1")}};spicehouse.prototype.checkOvenSetup=function(){this.setupProducts={};var b=0;for(var a in this.setup){for(var c in this.setup[a]){if(!this.setup[a][c].pid){continue}b++;if(!this.setupProducts[this.setup[a][c].pid]){this.setupProducts[this.setup[a][c].pid]=0}this.setupProducts[this.setup[a][c].pid]+=this.setup[a][c].amount}}if(b>0){return 1}return 0};spicehouse.prototype.speedupOvenCommit=function(){var a=Math.ceil(this.data.data.oven.remain/this.data.config.constants.oven_speedup_time);var b="";if(+a>+user_coins){b="important"}var e=formatNumber(a)+"&nbsp;"+t_coins;var c='<div id="spicehouse_commit">';c+="  <div>"+t_spicehouse_oven_speedup_desc.replace("%COST%",'<span class="cost '+b+'">'+e+"</span>")+"</div>";c+="</div>";var d="spicehouse.speedupOven()";globalcommitbox(t_spicehouse_oven_speedup_head,c,d);if(b!=""){hideDiv("globalbox_button1")}};spicehouse.prototype.buildRoom2=function(){var b='<div class="mills flex-center-all">';for(var l in this.data.config.mill){if(!this.data.config.mill[l].level){continue}var n="spicehouse.clickMillSlot("+l+")";var m="";var e="";if(+this.data.config.mill[l].level>+this.data.data.level){m="is-locked";e='<div class="important">'+t_spicehouse_level_required.replace("%LEVEL%",this.data.config.mill[l].level)+"</div>";n=""}else{if(this.data.config.mill[l].rent){if(!this.data.data.mill_slots[l].buydate||this.data.data.mill_slots[l].remain<=0){m="is-unlocked";e+="<div>"+t_spicehouse_mill_rent.replace("%COST%",this.data.config.mill[l].rent.coins+"&nbsp;"+t_coins).replace("%TIME%",formatTime(this.data.config.mill[l].rent.duration))+"</div>";n="spicehouse.rentMillCommit("+l+")"}}}b+='  <div id="spicehouse_mill'+l+'" class="mill mill'+l+" "+m+'">';b+='    <div class="back"></div>';b+='    <div class="input">';b+='      <div id="spicehouse_mill'+l+'_input_slot" class="slot link" onclick="'+n+'" onmouseover="showDiv(\'spicehouse_mill_slot'+l+"_tt')\" onmouseout=\"hideDiv('spicehouse_mill_slot"+l+"_tt')\">";if(this.data.data.mill_slots[l].pid){b+='<div id="spicehouse_mill'+l+'_remove" class="remove link close_mini_white" onclick="spicehouse.clearMill('+l+')"></div>'}var h=this.data.config.mill_levels[this.data.data.mill_slots[l].level].capacity;var c=0;if(this.data.data.mill_slots[l].pid){c=this.data.data.mill_slots[l].amount;b+='<div class="pid tt'+this.data.data.mill_slots[l].pid+'"></div>';b+='<div id="spicehouse_mill'+l+'_input_amount" class="amount">'+c+"</div>";e='<div style="font-weight:bold; margin-bottom:5px;">'+produkt_name[this.data.data.mill_slots[l].pid]+"</div>"}else{b+='<div class="drawplus"></div>'}if(m==""){e+="<div>"+t_spicehouse_mill_fill_product_input+"</div>"}var d=((c*100)/h);if(m!=""){b+='<div class="'+m.replace("is-","")+'"></div>'}b+="      </div>";b+='      <div id="spicehouse_mill_slot'+l+'_tt" class="ttbox">'+e+"</div>";b+='      <div class="mill_bar" onmouseover="showDiv(\'spicehouse_mill_slot'+l+"_bar_tt')\" onmouseout=\"hideDiv('spicehouse_mill_slot"+l+"_bar_tt')\">";b+='        <div id="spicehouse_mill'+l+'_input_bar" class="mill_bar_inner" style="width:'+d+'%;"></div>';b+='        <div id="spicehouse_mill_slot'+l+'_bar_tt" class="ttbox">';b+="          <div>"+t_spicehouse_mill_capacity+"</div>";b+='          <div style="font-weight:bold; font-size:12px;">'+c+"/"+h+"</div>";b+="        </div>";b+='        <div class="mill_bar_level">'+this.data.data.mill_slots[l].level+"</div>";b+="      </div>";if(m==""&&this.data.config.mill_levels[(+this.data.data.mill_slots[l].level+1)]){b+='<div class="mill_bar_upgrade link" onclick="spicehouse.upgradeMillSlotCommit('+l+')" onmouseover="showDiv(\'spicehouse_mill_slot'+l+"_upgrade_tt')\" onmouseout=\"hideDiv('spicehouse_mill_slot"+l+"_upgrade_tt')\">";b+='  <div class="img"></div>';b+='  <div id="spicehouse_mill_slot'+l+'_upgrade_tt" class="ttbox">'+t_spicehouse_mill_slot_upgrade_head+"</div>";b+="</div>"}b+="    </div>";b+='    <div class="output link" onclick="spicehouse.harvestMillSlotCommit('+l+')">';b+='      <div id="spicehouse_mill'+l+'_output_slot" class="slot" onmouseover="showDiv(\'spicehouse_mill'+l+"_output_tt')\" onmouseout=\"hideDiv('spicehouse_mill"+l+"_output_tt')\">";e="";if(this.data.data.mill_slots[l].pid){var a=0;b+='<div class="pid tt'+this.data.config.products[this.data.data.mill_slots[l].pid].transform+'"></div>';b+='<div id="spicehouse_mill'+l+'_output_amount" class="amount">'+a+"</div>";b+='<div id="spicehouse_mill'+l+'_output_diff" class="diff">0</div>';e='<div style="font-weight:bold; margin-bottom:5px;">'+produkt_name[this.data.config.products[this.data.data.mill_slots[l].pid].transform]+"</div>"}e+="<div>"+t_spicehouse_mill_fill_product_output+"</div>";b+="      </div>";b+='      <div id="spicehouse_mill'+l+'_output_tt" class="ttbox">'+e+"</div>";b+="    </div>";b+='    <div id="spicehouse_mill_slot'+l+'_renttimer" class="renttimer"></div>';b+="  </div>"}b+="</div>";b+='<div class="scroller left" onclick="spicehouse.setView(\'room1\')" onmouseover="showDiv(\'spicehouse_view_room2_scroller_tt\')" onmouseout="hideDiv(\'spicehouse_view_room2_scroller_tt\')">';b+='  <div id="spicehouse_view_room2_scroller_tt" class="ttbox">'+t_spicehouse_goto_room1+"</div>";b+="</div>";b+='<div class="millbooster production_slot_speedup link" onclick="spicehouse.buyMillBoosterCommit()" onmouseover="showDiv(\'spicehouse_mill_booster_tt\')" onmouseout="hideDiv(\'spicehouse_mill_booster_tt\')">';b+='  <div id="spicehouse_mill_booster_tt_timer" class="timer"></div>';b+='  <div id="spicehouse_mill_booster_tt" class="ttbox">';b+='    <div style="font-weight:bold; margin-bottom:5px;">'+t_spicehouse_mill_buy_booster_head+"</div>";b+="    <div>"+t_spicehouse_mill_buy_booster_head2.replace("%PERCENT%",Math.round(this.data.config.constants.mill_booster.percent*100))+"</div>";b+="  </div>";b+="</div>";$("spicehouse_room2").innerHTML=b;for(var l in this.data.config.mill){if(!this.data.config.mill[l].level){continue}if($("spicehouse_mill"+l+"_remove")){$("spicehouse_mill"+l+"_remove").observe("click",function(q){q.preventDefault();q.stopPropagation();return 1})}}};spicehouse.prototype.clickMillSlot=function(a){if($("spicehouse_mill"+a).hasClassName("is-locked")||$("spicehouse_mill"+a).hasClassName("is-unlocked")){return 1}this.clickSlot("mill",0,a)};spicehouse.prototype.upgradeMillSlotCommit=function(a){this.upgradeCapacity("mill",a)};spicehouse.prototype.harvestMillSlotCommit=function(a){if(!this.data.data.mill_slots[a].pid||!this.data.data.mill_slots[a].output||this.data.data.mill_slots[a].output<=0){return 1}this.harvestMill(a)};spicehouse.prototype.getMillSlotMaxCapacity=function(a){return this.data.config.mill_levels[this.data.data.mill_slots[a].level].capacity};spicehouse.prototype.rentMillCommit=function(e){var a="";if(+this.data.config.mill[e].rent.coins>+user_coins){a="important"}var d=this.data.config.mill[e].rent.coins+"&nbsp;"+t_coins;var b='<div id="spicehouse_commit">';b+="<div>"+t_spicehouse_mill_rent_desc.replace("%COST%",'<span class="cost '+a+'">'+d+"</span>").replace("%TIME%",'<span class="cost">'+formatTime(this.data.config.mill[e].rent.duration)+"</span>")+"</div>";b+="</div>";var c="spicehouse.rentMill("+e+")";globalcommitbox(t_spicehouse_mill_rent_head,b,c);if(a!=""){hideDiv("globalbox_button1")}};spicehouse.prototype.buyMillBoosterCommit=function(){if(this.data.data.mill_booster_remain>0){return 1}var a="";if(+this.data.config.constants.mill_booster.coins>+user_coins){a="important"}var d='<span class="cost '+a+'">'+this.data.config.constants.mill_booster.coins+"&nbsp;"+t_coins+"</span>";var b='<div id="spicehouse_commit">';b+="  <div>"+t_spicehouse_mill_buy_booster_desc.replace("%PERCENT%",Math.round(this.data.config.constants.mill_booster.percent*100)).replace("%TIME%",formatTime(this.data.config.constants.mill_booster.duration)).replace("%COINS%",d)+"</div>";b+="</div>";var c="spicehouse.buyMillBooster()";globalcommitbox(t_spicehouse_mill_buy_booster_head,b,c);if(a!=""){hideDiv("globalbox_button1")}};spicehouse.prototype.clickSlot=function(d,h,c){var s=0;var A=[];var e=0;if(d=="oven"){var r=[];if(this.setup[h]){for(var w in this.setup[h]){if(!this.setup[h][w].pid){continue}r.push(this.setup[h][w].pid);s+=this.setup[h][w].amount}}var B=JSON.parse(JSON.stringify(this.data.data.validproducts.spice));for(var w=0;w<B.length;w++){var q=B[w];var b=checkRackItem(q,this.farm);if(this.setupProducts[q]){b-=this.setupProducts[q]}if(!b||in_array(q,r)){continue}if(!e){e=q}A.push(q)}var v=this.getOvenLineMaxCapacity(h);var t="spicehouse.setSetup("+h+", "+c+")";var z=t_spicehouse_oven_product_entry_desc;var u=t_spicehouse_oven_product_no_capacity}if(d=="mill"){var r=[];if(this.data.data.mill_slots[c].pid){var b=checkRackItem(this.data.data.mill_slots[c].pid,this.farm);if(b){A.push(this.data.data.mill_slots[c].pid)}s=this.data.data.mill_slots[c].amount;if(!e){e=this.data.data.mill_slots[c].pid}}else{for(var w=0;w<this.data.data.validproducts.spicedried.length;w++){var q=this.data.data.validproducts.spicedried[w];var b=checkRackItem(q,this.farm);if(!b){continue}if(!e){e=q}A.push(q)}}var v=this.getMillSlotMaxCapacity(c);var t="spicehouse.setMill("+c+")";var z=t_spicehouse_mill_product_entry_desc;var u=t_spicehouse_mill_product_no_capacity}if(this.currentPid>0&&!in_array(this.currentPid,r)&&in_array(this.currentPid,A)){e=this.currentPid}else{this.currentPid=e}var a=Math.min(100,((s*100)/v));var l='<div id="spicehouse_commit">';l+="  <div>"+z+":</div>";l+='  <div class="bar">';l+='    <div id="spicehouse_products_bar_inner2" class="bar_inner2"></div>';l+='    <div class="bar_inner" style="width:'+a+'%"></div>';l+='    <div class="amount"><span id="spicehouse_products_bar_current">'+s+"</span>/"+v+"</div>";l+="  </div>";if(!e){l+='<div class="info important">'+t_spicehouse_oven_product_no_products+"</div>"}else{if(+a>=100){l+='<div class="info important">'+u+"</div>"}else{var b=checkRackItem(e,this.farm);if(this.setupProducts[e]){b-=this.setupProducts[e]}var n=0;var m="";if(in_array(this.currentPid,this.data.data.validproducts.spice)&&map_transfer_rest[this.farm].spice&&!in_array(this.currentPid,this.data.config.constants.oven_additional_products)){n=map_transfer_rest[this.farm].spice;m="*"}l+='<div class="product">';l+='  <div style="margin-bottom:5px;">'+t_help_new_product+":</div>";l+='  <div class="current link" onclick="spicehouse.expandOvenProductsList()">';l+='    <div class="line">';l+='      <div class="col1 kp'+e+'"></div>';l+='      <div class="col2">'+produkt_name[e]+"</div>";l+="    </div>";l+="  </div>";l+='  <div id="spicehouse_selector" class="selector link" onclick="spicehouse.expandOvenProductsList()"></div>';l+='  <div class="clear"></div>';l+='  <div class="entry">';l+='    <input id="spicehouse_products_entry" type="number" value="1" onchange="spicehouse.checkProductsEntry(\''+d+"', "+h+", "+c+", "+v+')" onkeyup="spicehouse.checkProductsEntry(\''+d+"', "+h+", "+c+", "+v+')"></input>';l+='    <div class="stock">'+t_inner_stock+"&nbsp;"+formatNumber(b)+m+"</div>";l+='    <div id="spicehouse_products_button" class="button_new link" onclick="'+t+'">'+t_spicehouse_oven_product_entry_button+"</div>";l+='    <div class="clear"></div>';l+="  </div>";if(d=="oven"){l+='<div class="info">'+t_spicehouse_oven_product_entry_info+"</div>"}if(n>0){l+='<div class="info2">'+t_spicehouse_oven_product_reserve_info.replace("%COUNT%","<b>"+n+"</b>")+"</div>"}l+="</div>";l+='<div id="spicehouse_products_list" class="list">';for(var w=0;w<A.length;w++){var q=A[w];l+='<div class="line link" onclick="spicehouse.selectProduct(\''+d+"', "+h+", "+c+", "+q+')">';l+='  <div class="col1 kp'+q+'"></div>';l+='  <div class="col2">'+produkt_name[q]+"</div>";l+="</div>"}l+="</div>"}}l+="</div>";globalcommitbox(t_spicehouse_oven_product_entry_head,l,0,0,1);hideDiv("globalbox_char");$("globalbox").style.marginLeft="-200px";this.checkProductsEntry(d,h,c,v)};spicehouse.prototype.selectProduct=function(c,a,d,b){this.currentPid=b;this.clickSlot(c,a,d)};spicehouse.prototype.checkProductsEntry=function(l,q,n,m){if(!$("spicehouse_products_entry")){return 1}var h=0;if(l=="oven"){if(this.setup[q]){for(var b in this.setup[q]){if(!this.setup[q][b].pid){continue}h+=this.setup[q][b].amount}}}if(l=="mill"){if(this.data.data.mill_slots[n].amount){h=this.data.data.mill_slots[n].amount}}var a=(m-h);var d=+checkRackItem(this.currentPid,this.farm);if(l=="oven"&&this.setupProducts[this.currentPid]){d-=this.setupProducts[this.currentPid]}if(in_array(this.currentPid,this.data.data.validproducts.spice)&&map_transfer_rest[this.farm].spice&&!in_array(this.currentPid,this.data.config.constants.oven_additional_products)){d-=map_transfer_rest[this.farm].spice}var c=+$("spicehouse_products_entry").value;if(c>d){c=d}if(c>a){c=a}if(c<0){c=0}$("spicehouse_products_entry").value=c;var e=(((c+h)*100)/m);$("spicehouse_products_bar_inner2").style.width=e+"%";$("spicehouse_products_bar_current").innerHTML=(c+h);$("spicehouse_products_button").removeClassName("off");if(c<1||c>d){$("spicehouse_products_button").addClassName("off")}};spicehouse.prototype.expandOvenProductsList=function(){$("spicehouse_selector").removeClassName("closed");if($("spicehouse_products_list").style.display=="block"){hideDiv("spicehouse_products_list")}else{showDiv("spicehouse_products_list");$("spicehouse_selector").addClassName("closed")}};spicehouse.prototype.upgradeCapacity=function(n,e){if(n=="oven"){var q=t_spicehouse_oven_line_upgrade_head;var m=t_spicehouse_oven_line_upgrade_desc;var t="spicehouse.upgradeOvenLine("+e+")";var d=+this.data.data.oven_slots[e].level;var b=(d+1);var a=this.data.config.oven_levels[b];var s=(+a.capacity-+this.data.config.oven_levels[d].capacity)}if(n=="mill"){var q=t_spicehouse_mill_slot_upgrade_head;var m=t_spicehouse_mill_slot_upgrade_desc;var t="spicehouse.upgradeMillSlot("+e+")";var d=+this.data.data.mill_slots[e].level;var b=(d+1);var a=this.data.config.mill_levels[b];var s=(+a.capacity-+this.data.config.mill_levels[d].capacity)}var l=0;if(a.money&&a.money>0){if(+a.money>+user_bar){l++}var c=formatPrice(a.money)}else{if(a.coins&&a.coins>0){if(+a.coins>+user_coins){l++}var c=formatNumber(a.coins)+"&nbsp;"+t_coins}else{if(a.spicehouse_points&&a.spicehouse_points>0){if(+a.spicehouse_points>+this.data.data.count){l++}var c=formatNumber(a.spicehouse_points)+"&nbsp;"+t_spicehouse_points}}}var r="";if(l>0){r="important"}var h='<div id="spicehouse_commit">';h+='  <div class="upgrade">'+t_spicehouse_oven_line_upgrade_capacity.replace("%COUNT%","<span>"+s+"</span>")+"</div>";h+="  <div>"+m.replace("%COST%",'<span class="cost '+r+'">'+c+"</span>")+"</div>";h+="</div>";globalcommitbox(q,h,t);if(l>0){hideDiv("globalbox_button1")}};spicehouse.prototype.showStats=function(){var a='<div id="spicehouse_stats">';a+='  <div class="select_line">';a+='    <select id="spicehouse_stats_select" onchange="spicehouse.stats()">';for(var b=0;b<this.stats_options.length;b++){if(this.stats_options[b]==""){a+='<option value="0">---</option>';continue}var c="";if(this.stats_select==this.stats_options[b]){c="selected"}a+='<option value="'+this.stats_options[b]+'" '+c+">"+t_spicehouse_stats[this.stats_options[b]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_spicehouse_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select],this.stats_select,"spicehouse");a+="</div>";globalBoxFlex("",a,0,0,1)};spicehouse.prototype.startTutorial=function(a){if(this.data.data.tutorial&&this.data.data.tutorial[a]){return 1}this.tutorialType=a;this.tutorialStep=1;spicehouse.showTutorial(1);spicehouse.setTutorialVisited();if(!this.data.data.tutorial){this.data.data.tutorial={}}this.data.data.tutorial[a]=1};spicehouse.prototype.nextTutorialStep=function(){this.tutorialStep++;this.showTutorial()};spicehouse.prototype.setTutorialVisited=function(){if(this.data.data.tutorial&&this.data.data.tutorial[this.tutorialType]){return 1}this.setTutorial()};spicehouse.prototype.showTutorial=function(h){var c=this.tutorialType+"_"+this.tutorialStep;if($("spicehouse_oven_line1")){$("spicehouse_oven_line1").removeClassName("tutorial_marked").removeClassName("pulse")}if($("spicehouse_oven_controls")){$("spicehouse_oven_controls").removeClassName("tutorial_marked").removeClassName("pulse")}if($("spicehouse_mill1_input_slot")){$("spicehouse_mill1_input_slot").removeClassName("tutorial_marked").removeClassName("pulse")}if($("spicehouse_mill1_output_slot")){$("spicehouse_mill1_output_slot").removeClassName("tutorial_marked").removeClassName("pulse")}if($("spicehouse_room1_scroller")){$("spicehouse_room1_scroller").removeClassName("tutorial_marked").removeClassName("pulse")}if($("spicehouse_customers")){$("spicehouse_customers").removeClassName("tutorial_marked")}if($("spicehouse_customer1")){$("spicehouse_customer1").removeClassName("pulse")}showDiv("spicehouse_customer2");showDiv("spicehouse_customer3");showDiv("spicehouse_customer4");showDiv("spicehouse_customer5");if(!t_spicehouse_tutorial_text[c]){this.closeTutorial();return 1}var e=t_spicehouse_tutorial_text[c];e=e.replace("%USERNAME%","<b>"+username+"</b>");var d=0;if(t_spicehouse_tutorial_text[this.tutorialType+"_"+(this.tutorialStep+1)]){d=1}var a="on";if(h==1){a="off"}var b="";b+='<div class="textt">'+e+"</div>";if(d==1){b+='<div class="next button_new link" onclick="spicehouse.nextTutorialStep()">'+t_continue+"</div>"}else{if(this.tutorialType=="isoven"){b+='<div class="next button_new link" onclick="spicehouse.setView(\'room2\')">'+t_continue+"</div>"}else{b+='<div class="button_yes link" onclick="spicehouse.setView(\'room1\'); spicehouse.closeTutorial()"></div>'}}$("spicehouse_tutorial_bubble").innerHTML=b;showDiv("spicehouse_tutorial");if(this.tutorialType=="isoven"){if(this.tutorialStep==2){$("spicehouse_oven_line1").addClassName("tutorial_marked").addClassName("pulse")}if(this.tutorialStep==3){$("spicehouse_oven_controls").addClassName("tutorial_marked").addClassName("pulse")}if(this.tutorialStep==4){$("spicehouse_oven_controls").addClassName("tutorial_marked").addClassName("pulse")}if(this.tutorialStep==5){$("spicehouse_room1_scroller").addClassName("tutorial_marked").addClassName("pulse")}}if(this.tutorialType=="ismills"){if(this.tutorialStep==2){$("spicehouse_mill1_input_slot").addClassName("tutorial_marked").addClassName("pulse")}if(this.tutorialStep==3){$("spicehouse_mill1_output_slot").addClassName("tutorial_marked").addClassName("pulse")}if(this.tutorialStep==4){$("spicehouse_customers").addClassName("tutorial_marked");$("spicehouse_customer1").addClassName("pulse");hideDiv("spicehouse_customer2");hideDiv("spicehouse_customer3");hideDiv("spicehouse_customer4");hideDiv("spicehouse_customer5")}}setTimeout(function(){if($("spicehouse_oven_line1")){$("spicehouse_oven_line1").removeClassName("pulse")}if($("spicehouse_oven_controls")){$("spicehouse_oven_controls").removeClassName("pulse")}if($("spicehouse_mill1_input_slot")){$("spicehouse_mill1_input_slot").removeClassName("pulse")}if($("spicehouse_mill1_output_slot")){$("spicehouse_mill1_output_slot").removeClassName("pulse")}if($("spicehouse_room1_scroller")){$("spicehouse_room1_scroller").removeClassName("pulse")}if($("spicehouse_customer1")){$("spicehouse_customer1").removeClassName("pulse")}},1000);if(h==1){setTimeout(function(){if($("spicehouse_tutorial_char")){$("spicehouse_tutorial_char").className="char "+spicehouse.tutorialType}},500)}};spicehouse.prototype.closeTutorial=function(){if($("spicehouse_oven_line1")){$("spicehouse_oven_line1").removeClassName("tutorial_marked")}if($("spicehouse_oven_controls")){$("spicehouse_oven_controls").removeClassName("tutorial_marked")}if($("spicehouse_mill1_input_slot")){$("spicehouse_mill1_input_slot").removeClassName("tutorial_marked")}if($("spicehouse_mill1_output_slot")){$("spicehouse_mill1_output_slot").removeClassName("tutorial_marked")}if($("spicehouse_room1_scroller")){$("spicehouse_room1_scroller").removeClassName("tutorial_marked")}if($("spicehouse_customers")){$("spicehouse_customers").removeClassName("tutorial_marked")}if($("spicehouse_customer1")){$("spicehouse_customer1").removeClassName("pulse")}showDiv("spicehouse_customer2");showDiv("spicehouse_customer3");showDiv("spicehouse_customer4");showDiv("spicehouse_customer5");if(!$("spicehouse_tutorial")){return 1}if($("spicehouse_tutorial_char")){$("spicehouse_tutorial_char").removeClassName("isoven").removeClassName("ismills")}setTimeout(function(){hideDiv("spicehouse_tutorial")},200)};spicehouse.prototype.help=function(){showDiv("spicehouse_help");if(this.data.data.achievements){for(var a=0;a<this.data.data.achievements.length;a++){showDiv("spicehouse_help_achievement_"+this.data.data.achievements[a]+"_ready")}}};spicehouse.prototype.helpNavi=function(c){var b=2;if(!this.data.config.achievements){b=1}for(var a=1;a<=b;a++){$("spicehouse_help_navi_tab"+a).removeClassName("active");hideDiv("spicehouse_help_page"+a)}$("spicehouse_help_navi_tab"+c).addClassName("active");showDiv("spicehouse_help_page"+c)};spicehouse.prototype.helpClose=function(){hideDiv("spicehouse_help")};spicehouse.prototype.timer=function(){if(this.data.data.customers_slots){for(var b in this.data.data.customers_slots){this.data.data.customers_slots[b].remain--}}for(var a in this.data.data.oven_slots){if(this.data.config.oven[a].rent&&this.data.data.oven_slots[a].buydate){this.data.data.oven_slots[a].remain--}}if(this.data.data.oven){this.data.data.oven.remain--}for(var b in this.data.data.mill_slots){if(this.data.config.mill[b].rent&&this.data.data.mill_slots[b].buydate){this.data.data.mill_slots[b].remain--}}this.data.data.mill_booster_remain--;this.data.data.time++;this.timerUpdate()};spicehouse.prototype.timerUpdate=function(){if(this.data.data.customers_slots){for(var q in this.data.data.customers_slots){if(!$("spicehouse_customer"+q+"_timer")){continue}hideDiv("spicehouse_customer"+q+"_timer");if(this.data.data.customers_slots[q].remain>0){showDiv("spicehouse_customer"+q+"_timer");$("spicehouse_customer"+q+"_timer_timer").innerHTML=formatTime(this.data.data.customers_slots[q].remain)}}}for(var u in this.data.data.oven_slots){hideDiv("spicehouse_oven_line"+u+"_renttimer");if(this.data.config.oven[u].rent&&this.data.data.oven_slots[u].buydate){if(this.data.data.oven_slots[u].remain>0){showDiv("spicehouse_oven_line"+u+"_renttimer");if($("spicehouse_oven_line"+u+"_renttimer")){$("spicehouse_oven_line"+u+"_renttimer").innerHTML=t_pony_rentresttime+":&nbsp;"+formatTime(this.data.data.oven_slots[u].remain)}}if(this.data.data.oven_slots[u].remain==-1){this.buildRoom1()}}}if($("spicehouse_oven")){hideDiv("spicehouse_oven_timer");hideDiv("spicehouse_oven_button_speedup");$("spicehouse_oven").removeClassName("closed");$("spicehouse_oven_controls").removeClassName("closed")}var m=0;if(this.data.data.oven){loop1:for(var u in this.data.data.oven.data){for(var q in this.data.data.oven.data[u]){this.ready.oven.pid=this.data.config.products[this.data.data.oven.data[u][q].pid].transform;break loop1}}if($("spicehouse_oven")){$("spicehouse_oven").addClassName("closed");$("spicehouse_oven_controls").addClassName("closed");showDiv("spicehouse_oven_timer")}if(this.data.data.oven.remain>0){if($("spicehouse_oven")){showDiv("spicehouse_oven_button_speedup");$("spicehouse_oven_timer").innerHTML=formatTime(this.data.data.oven.remain);$("spicehouse_oven_controls_tt").innerHTML=t_spicehouse_open_oven_head+'<div style="margin-top:5px;">'+t_spicehouse_open_oven_cancel+"</div>"}}else{if($("spicehouse_oven")){$("spicehouse_oven_controls_tt").innerHTML=t_spicehouse_open_oven_head;$("spicehouse_oven_timer").innerHTML=statusProductionComplete}this.ready.oven.ready=1}this.ready.oven.remain=this.data.data.oven.remain;m=((this.data.config.constants.oven_duration-this.data.data.oven.remain)*100)/this.data.config.constants.oven_duration}else{if($("spicehouse_oven")){var s="";if(!this.checkOvenSetup()){s='<div class="important" style="margin-top:5px;">'+t_spicehouse_start_oven_noproducts+"</div>"}$("spicehouse_oven_controls_tt").innerHTML=t_spicehouse_start_oven_head+s}}if($("spicehouse_oven")){$("spicehouse_timer_bar_inner").style.width=Math.min(100,m)+"%"}if(this.data.data.mill_slots){for(var q in this.data.data.mill_slots){if(this.data.data.mill_slots[q]&&this.data.data.mill_slots[q].pid){this.calcMillOutput(q);var n=this.data.config.mill_levels[this.data.data.mill_slots[q].level].capacity;var l=this.data.data.mill_slots[q].amount;var m=((l*100)/n);if(!this.data.data.mill_slots[q].output){this.data.data.mill_slots[q].output=0}if($("spicehouse_mill"+q)){$("spicehouse_mill"+q+"_input_amount").innerHTML=this.data.data.mill_slots[q].amount;$("spicehouse_mill"+q+"_input_bar").style.width=m+"%";$("spicehouse_mill"+q+"_output_amount").innerHTML=this.data.data.mill_slots[q].output}if(!this.data.data.mill_slots[q].amount&&this.data.data.mill_slots[q].output>0){this.ready.mill.ready=1}}hideDiv("spicehouse_mill_slot"+q+"_renttimer");if(this.data.config.mill[q].rent&&this.data.data.mill_slots[q].buydate){if(this.data.data.mill_slots[q].remain>0){if($("spicehouse_mill"+q)){showDiv("spicehouse_mill_slot"+q+"_renttimer");if($("spicehouse_mill_slot"+q+"_renttimer")){$("spicehouse_mill_slot"+q+"_renttimer").innerHTML=t_pony_rentresttime+":<br>"+formatTime(this.data.data.mill_slots[q].remain)}}}if(this.data.data.mill_slots[q].remain==-1){this.buildRoom2()}}}}if($("spicehouse_mill_booster_tt")){hideDiv("spicehouse_mill_booster_tt_timer");if(this.data.data.mill_booster_remain>0){showDiv("spicehouse_mill_booster_tt_timer");$("spicehouse_mill_booster_tt_timer").innerHTML=formatTime(this.data.data.mill_booster_remain)}}this.getSpicehousePosition();if($("farm10_pos"+this.position)){if(this.ready.oven.pid||this.ready.mill.pid){var r="";if(this.ready.oven.pid){var e=this.ready.oven.pid;var h=this.ready.oven.remain}else{if(this.ready.mill.pid){var e=this.ready.mill.pid;if(this.ready.mill.ready){var h=0}else{var h=this.ready.mill.remain}}}if(h<=0){var a=statusProductionComplete;r=""}else{var a=formatTime(h);r="running"}var d='<div id="farm10_pos'+this.position+'_production" class="spicehouse_production '+r+'"></div>';d+='<div id="farm_production_timer10_'+this.position+'" class="farm_production_timer">';d+='  <div class="kp'+e+'" style="float:left; margin-right:5px;"></div>';d+='  <div id="farm_production_timer10_'+this.position+'_timer" style="float:left;">'+a+"</div>";d+='  <div class="clear"></div>';d+="<div>";if(!$("farm10_pos"+this.position+"_production")){$("farm10_pos"+this.position).insert(d)}if($("farm_production_timer10_"+this.position+"_timer")){$("farm_production_timer10_"+this.position+"_timer").innerHTML=a}}else{if($("farm10_pos"+this.position+"_production")){$("farm10_pos"+this.position+"_production").remove()}if($("farm_production_timer10_"+this.position+"_timer")){$("farm_production_timer10_"+this.position+"_timer").innerHTML=""}}}var t=0;for(var c=0;c<farm_checker.length;c++){if(farm_checker[c].farm==this.farm&&farm_checker[c].position==this.position){if(!this.ready.oven.ready&&!this.ready.mill.ready){farm_checker[c]={}}else{t++}}}if(!t){var b=0;if(this.ready.oven.ready){var b={pid:this.ready.oven.pid,farm:this.farm,position:this.position}}if(this.ready.mill.ready){var b={pid:this.ready.mill.pid,farm:this.farm,position:this.position}}if(b){farm_checker.push(b)}}};spicehouse.prototype.getSpicehousePosition=function(){if(farms_data.farms[this.farm]){for(var a in farms_data.farms[this.farm]){if(farms_data.farms[this.farm][a].buildingid!=24){continue}this.position=farms_data.farms[this.farm][a].position;break}}};spicehouse.prototype.calcMillOutput=function(h){hideDiv("spicehouse_mill"+h+"_output_diff");if(+this.data.data.mill_slots[h].amount<=0){return 1}var b=this.data.data.mill_slots[h].pid;var d=+this.data.config.products[b].duration;if(+this.data.data.time>=+this.data.data.mill_booster&&+this.data.data.time<=(+this.data.data.mill_booster+ +this.data.config.constants.mill_booster.duration)){d=Math.ceil(d*(1-this.data.config.constants.mill_booster.percent))}var c=(this.data.data.time-this.data.data.mill_slots[h].start);var a=+Math.floor(c/d);if(a>this.data.data.mill_slots[h].amount_original){a=this.data.data.mill_slots[h].amount_original}var e=(d-(c%d));if(this.data.data.mill_slots[h].amount<=0){e=0}if($("spicehouse_mill"+h+"_output_diff")){showDiv("spicehouse_mill"+h+"_output_diff");$("spicehouse_mill"+h+"_output_diff").innerHTML=formatTime(e)}if(!this.ready.mill.pid||this.ready.mill.remain>e){this.ready.mill={pid:this.data.config.products[b].transform,remain:e}}if(!this.data.data.mill_slots[h].output){this.data.data.mill_slots[h].output=0}if(a>0&&a>this.data.data.mill_slots[h].output){this.data.data.mill_slots[h].output=a;this.data.data.mill_slots[h].amount=(this.data.data.mill_slots[h].amount_original-a)}};spicehouse.prototype.pointsFlyer=function(c){if(+c==0){return 1}if($("spicehouse_points_flyer")){$("spicehouse_points_flyer").remove()}var b="";if(+c>0){b="+"}var a='<div id="spicehouse_points_flyer" class="line">';a+='  <div class="spicehouse_points"></div>';a+="  <div>"+b+c+"</div>";a+="</div>";$("spicehouse_main").insert(a);setTimeout(function(){if($("spicehouse_points_flyer")){$("spicehouse_points_flyer").addClassName("move")}},1000)};spicehouse.prototype.close=function(){this.setup={};mapGo2Location("farm",this.farm)};var stall=function(){this.data={};this.runtime=0;this.currentPosition=1;this.currentSlot=0;this.fillProduct=0;this.fillAmount=0;this.stats_cache={};this.stats_cache_delay={};this.stats_select="farmis";this.milestonesDecoBlock=0;this.milestonesDecoClick=0;this.informerRead={}};stall.prototype.cheater=function(a){if(!devserver){return 1}var b=0;if(a=="points"){b=$("stall_cheat_set_points").value}if(a=="create"){b=$("stall_cheat_farmi_amount").value}if(a=="interval"){b=$("stall_cheat_interval").value}stall.action("stall_cheater",{position:this.currentPosition,type:a,value:b})};stall.prototype.autofillCancel=function(a){stall.action("stall_cancel_autofill",{position:this.currentPosition,slot:a})};stall.prototype.stats=function(){if($("stall_stats_select")){stall.stats_select=$("stall_stats_select").value}if(stall.stats_cache_delay[stall.stats_select]<=0||!stall.stats_cache[this.stats_select]){stall.action("stall_stats",{type:stall.stats_select})}else{stall.showStats(stall.stats_select)}};stall.prototype.getReward=function(){stall.action("stall_get_reward",{position:this.currentPosition})};stall.prototype.buyBooster=function(a){stall.action("stall_buy_booster",{position:this.currentPosition,booster:a})};stall.prototype.buy=function(a){this.currentPosition=a;stall.action("stall_buy",{position:a})};stall.prototype.forecast=function(){stall.action("stall_forecast",{position:this.currentPosition})};stall.prototype.buySlot=function(a,b){stall.action("stall_buy_slot",{position:a,slot:b})};stall.prototype.fillSlot=function(){if(this.currentPosition>0&&this.currentSlot>0&&this.fillProduct>0&&this.fillAmount>0){stall.action("stall_fill_slot",{position:this.currentPosition,slot:this.currentSlot,pid:this.fillProduct,amount:this.fillAmount})}};stall.prototype.refillSlot=function(){if(this.currentPosition>0&&this.currentSlot>0&&this.fillProduct>0&&this.fillAmount>0){stall.action("stall_refill_slot",{position:this.currentPosition,slot:this.currentSlot,amount:this.fillAmount})}};stall.prototype.clearSlot=function(a,b){stall.action("stall_clear_slot",{position:a,slot:b})};stall.prototype.buyAutofill=function(a,c){var b=$("map_stall_autofill_slot_number").value;if(b<=0){return 1}stall.action("stall_buy_autofill",{position:a,slot:c,limit:b})};stall.prototype.init=function(a){stall.action("stall_init")};stall.prototype.action=function(a,b){ajaxAction("farm",a,b,stall.response)};stall.prototype.response=function(b,a,c){if($("map_stall_overview_link_alert")){$("map_stall_overview_link_alert").remove();$("map_stall_overview_link_alert_tt").remove()}stall.build();if(in_array(a,["stall_buy","stall_init","stall_buy_slot","stall_fill_slot","stall_refill_slot","stall_clear_slot","stall_get_reward","stall_buy_autofill","stall_cancel_autofill","stall_buy_booster","stall_cheater"])){stall.open(stall.currentPosition)}if(in_array(a,["stall_buy_booster"])){stall.buildBooster(c.position)}if(in_array(a,["stall_get_reward"])&&b.reward){stall.buildRewards(b.reward,1)}if(in_array(a,["stall_forecast"])){stall.buildWishlist()}if(in_array(a,["stall_buy_autofill"])){stall.autofillSlotCommit(stall.currentPosition,stall.currentSlot)}if(b.stats){stall.stats_cache_delay[stall.stats_select]=30;if(!stall.stats_cache[stall.stats_select]){stall.stats_cache[stall.stats_select]={}}stall.stats_cache[stall.stats_select]=b.stats;stall.showStats()}};stall.prototype.checkStallStatus=function(a){var b={blocked:0,failed:0};if(this.data.data&&this.data.data[a]){if(this.data.config.position[a].rent&&this.data.data[a].rent_remain&&this.data.data[a].rent_remain<=0){b.blocked=1}}else{b.blocked=1}if(this.data.config.position[a].premium&&!premium){b.failed=1}if(this.data.config.position[a].level&&currentuserlevel<this.data.config.position[a].level){b.failed=1}if(a>1&&!this.data.data[(a-1)]){b.failed=1}return b};stall.prototype.build=function(){var e="";for(var a in this.data.config.position){var d=this.checkStallStatus(a);var c=d.blocked;var b=d.failed;var l="stall.overview("+a+")";if(c==1){l="stall.buyCommit("+a+")"}if(b==1){l=""}e+='<div id="map_stall'+a+'" class="stall pos'+a+' link" onclick="'+l+'" onmouseover="showDiv(\'map_stall'+a+"_tt')\" onmouseout=\"hideDiv('map_stall"+a+"_tt')\">";if(this.data.config.position[a].premium){e+='<div class="icon_premium"></div>'}var h='<div class="name">'+t_map_stall+"&nbsp;"+a+"</div>";if(c==1){e+='<div class="unlocked"></div>';if(this.data.config.position[a].money&&this.data.config.position[a].money>0){h+='<div class="cost">'+t_map_stall_buy.replace("%COST%",formatPrice(this.data.config.position[a].money))+"</div>"}if(this.data.config.position[a].coins&&this.data.config.position[a].coins>0){h+='<div class="cost">'+t_map_stall_buy.replace("%COST%",this.data.config.position[a].coins+"&nbsp;"+t_coins)+"</div>"}if(this.data.config.position[a].rent){var m=t_map_stall_rent.replace("%COST%","<span>"+this.data.config.position[a].rent.coins+"&nbsp;"+t_coins+"</span>");h+='<div class="cost">'+m.replace("%DURATION%",formatTime(this.data.config.position[a].rent.duration))+"</div>"}}if(b==1){if(this.data.config.position[a].level&&currentuserlevel<this.data.config.position[a].level){h+='<div class="important levelinfo">'+minlevel_feature.replace("%LEVEL%",this.data.config.position[a].level)+"</div>"}if(this.data.config.position[a].premium&&!premium){h+='<div class="important premiuminfo">'+inforequirepremium+"</div>"}if(a>1&&!this.data.data[(a-1)]){h+='<div class="important premiuminfo">'+t_stall_required_stall.replace("%COUNT%",(a-1))+"</div>"}}else{if(this.data.config.position[a].premium){h+='<div class="premiuminfo">'+t_feature_premiuminfo+"</div>"}}e+='  <div id="map_stall'+a+'_rent_timer" class="timer">';e+='    <div id="map_stall'+a+'_rent_timer_time"></div>';e+="  </div>";e+='  <div id="map_stall'+a+'_tt" class="ttbox">';e+="    <div>"+h+"</div>";e+='    <div class="desc">'+t_map_stall_desc+"</div>";e+="  </div>";if(this.data.data[a]&&this.data.data[a].reward&&this.data.data[a].reward.money){e+='<div class="cash"></div>'}e+="</div>"}$("map_stalls").innerHTML=e};stall.prototype.open=function(c){this.currentPosition=c;this.informerRead[c]=1;var e=specialbonus.findBonus({key1:"stall",key2:"rentslot"});var b="";b+='<div id="stall_house" class="house house'+this.currentPosition+'"></div>';b+=htmlLevelBar("stall",0,1);b+='<div class="stats_link link main_button" onclick="stall.stats()" onmouseover="showDiv(\'map_stall_stats_link_tt\')" onmouseout="hideDiv(\'map_stall_stats_link_tt\')">';b+='  <div id="map_stall_stats_link_tt" class="ttbox">'+t_stats+"</div>";b+="</div>";b+='<div class="reward_link link main_button" onclick="stall.buildRewards()" onmouseover="showDiv(\'map_stall_reward_link_tt\')" onmouseout="hideDiv(\'map_stall_reward_link_tt\')">';b+='  <div id="map_stall_reward_link_tt" class="ttbox">'+t_vet_reward_head+"</div>";if(this.data.data[c].reward){b+='<div class="cash"></div>'}b+="</div>";b+='<div class="wishlist_link link main_button" onclick="stall.buildWishlist()" onmouseover="showDiv(\'map_stall_wishlist_link_tt\')" onmouseout="hideDiv(\'map_stall_wishlist_link_tt\')">';b+='  <div id="map_stall_wishlist_link_tt" class="ttbox">'+t_map_stall_wishlist+"</div>";b+="</div>";b+='<div class="booster_link link main_button" onclick="stall.buildBooster()" onmouseover="showDiv(\'map_stall_booster_link_tt\')" onmouseout="hideDiv(\'map_stall_booster_link_tt\')">';b+='  <div id="map_stall_booster_link_tt" class="ttbox">'+t_map_stall_buy_booster+"</div>";b+="</div>";b+='<div class="milestones_link link main_button" onclick="stall.milestones()" onmouseover="showDiv(\'map_stall_milestones_link_tt\')" onmouseout="hideDiv(\'map_stall_milestones_link_tt\')">';b+='  <div id="map_stall_milestones_link_tt" class="ttbox">'+t_map_stall_milestones+"</div>";b+="</div>";if(devserver==1){b+='<div class="farmilog_link link main_button" onclick="stall.farmilog()" onmouseover="showDiv(\'map_stall_farmilog_link_tt\')" onmouseout="hideDiv(\'map_stall_farmilog_link_tt\')">';b+='  <div id="map_stall_farmilog_link_tt" class="ttbox">'+t_map_stall_farmi_log+"</div>";b+="</div>";b+='<div class="refresh_link link" onclick="stall.init()" onmouseover="showDiv(\'map_stall_refresh_link_tt\')" onmouseout="hideDiv(\'map_stall_refresh_link_tt\')">';b+='  <div class="img"></div>';b+='  <div id="map_stall_refresh_link_tt" class="ttbox">'+t_cowracing_reload+"</div>";b+="</div>";b+='<div style="z-index:10; position:absolute; bottom:50px; left:10px;">';b+='  Punkte: <input id="stall_cheat_set_points" value="1" style="width:50px;" type="text">';b+="  <button onclick=\"stall.cheater('points')\">OK</button>";b+="</div>";b+='<div style="z-index:10; position:absolute; bottom:30px; left:10px;">';b+="  <button onclick=\"stall.cheater('booster')\">REMOVE BOOSTER</button>";b+="</div>";b+='<div style="z-index:10; position:absolute; bottom:50px; right:10px;">';b+='  <input id="stall_cheat_farmi_amount" value="1" style="width:20px;" type="text">';b+="  <button onclick=\"stall.cheater('create')\">CREATE FARMI</button>";b+="</div>";var q=this.data.config.interval;if(this.data.c&&this.data.c.interval){q=this.data.c.interval}b+='<div style="z-index:10; position:absolute; bottom:30px; right:10px;">';b+='  Interval: <input id="stall_cheat_interval" value="'+q+'" style="width:50px;">';b+="  <button onclick=\"stall.cheater('interval')\">OK</button>";b+="</div>";if(!this.data.c||(this.data.c.active&&this.data.c.active==1)){var r="#0f0"}else{var r="#f00"}b+='<div style="z-index:10; position:absolute; bottom:5px; right:10px; width:20px; height:20px; white-space:nowrap; background-color:'+r+';" onclick="stall.cheater(\'toogle\')">ON / OFF</div>'}b+='<div class="slots">';for(var n in this.data.config.stall_position[c]){var u="stall.buySlotCommit("+c+", "+n+")";var d="";var a="";if(n>1){if(this.data.data[c].level<this.data.config.stall_position[c][n].level){a="locked";d+='<div class="important">'+t_map_stall_unlock_slot.replace("%LEVEL%",this.data.config.stall_position[c][n].level)+"</div>";u=""}else{if(!this.data.data[c].slots||!this.data.data[c].slots[n]){a="unlocked";if(this.data.config.stall_position[c][n].money){d+="<div>"+t_map_stall_buy_slot.replace("%COST%",formatPrice(this.data.config.stall_position[c][n].money))+"</div>"}if(this.data.config.stall_position[c][n].coins){d+="<div>"+t_map_stall_buy_slot.replace("%COST%",this.data.config.stall_position[c][n].coins+"&nbsp;"+t_coins)+"</div>"}}if(this.data.config.stall_position[c][n].rent){if(!this.data.data[c].slots||!this.data.data[c].slots[n]||(this.data.data[c].slots&&this.data.data[c].slots[n]&&(!this.data.data[c].slots[n].rent_remain||this.data.data[c].slots[n].rent_remain<0))){var m="";var t="";var v=this.data.config.stall_position[c][n].rent.coins;if(e){m="bonus";t+='<div style="color:green;">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(e.rentslot*100))+")</div>";v=Math.ceil(v*(1-e.rentslot))}a="unlocked";var s=t_map_stall_rent_slot.replace("%DURATION%",formatTime(this.data.config.stall_position[c][n].rent.duration));d+="<div>"+s.replace("%COST%",'<span class="'+m+'">'+v+"&nbsp;"+t_coins+"</span>")+"</div>";if(t!=""){d+=t}}}}}if(a==""){if(this.data.data[c].slots&&this.data.data[c].slots[n]&&this.data.data[c].slots[n].pid){u="stall.clearSlotCommit("+c+", "+n+")";d+='<div style="font-weight:bold;">'+produkt_name[this.data.data[c].slots[n].pid]+"</div>";d+='<div style="margin-top:5px;">'+t_map_stall_click_slot_filled+"</div>"}else{u="stall.fillSlotCommit("+c+", "+n+")";d+="<div>"+t_map_stall_click_slot_insert+"</div>"}}b+='<div id="map_stall'+c+"_slot"+n+'" class="slot link">';b+='  <div class="clicker" onclick="'+u+'" onmouseover="showDiv(\'map_stall'+c+"_slot"+n+"_tt')\" onmouseout=\"hideDiv('map_stall"+c+"_slot"+n+"_tt')\">";var l="";if(n<5){l="top"}b+='    <div id="map_stall'+c+"_slot"+n+'_rent_timer" class="timer '+l+'">';b+='      <div id="map_stall'+c+"_slot"+n+'_rent_timer_time" class="showtime"></div>';b+="    </div>";if(this.data.data[c].slots&&this.data.data[c].slots[n]&&this.data.data[c].slots[n].pid){b+='<div id="map_stall'+c+"_slot"+n+'_pid" class="pid tt'+this.data.data[c].slots[n].pid+'">';if(this.data.data[c].wishlist.products&&in_array(this.data.data[c].slots[n].pid,this.data.data[c].wishlist.products)){b+='<div class="fav"></div>'}b+="</div>"}if(a!=""){b+='<div class="'+a+'"></div>'}b+='    <div id="map_stall'+c+"_slot"+n+'_tt" class="ttbox">'+d+"</div>";b+="  </div>";if(this.data.data[c].slots&&this.data.data[c].slots[n]&&this.data.data[c].slots[n].pid){var u="stall.refillSlotCommit("+c+", "+n+")";var h="onmouseover=\"showDiv('map_stall"+c+"_slot"+n+"_amount_tt')\" onmouseout=\"hideDiv('map_stall"+c+"_slot"+n+"_amount_tt')\"";if(a!=""){u="";h=""}b+='<div id="map_stall'+c+"_slot"+n+'_amount" class="amount" '+h+' onclick="'+u+'">';b+="  <div>"+this.data.data[c].slots[n].amount+"/"+this.data.config.level[c][this.data.data[c].level].fillsum+"</div>";b+='  <div id="map_stall'+c+"_slot"+n+'_amount_tt" class="ttbox">';b+='    <div style="font-weight:bold;">'+produkt_name[this.data.data[c].slots[n].pid]+"</div>";b+='    <div style="margin-top:5px;">'+t_map_stall_click_slot_filled2+"</div>";b+="  </div>";b+="</div>"}if((this.data.data[c].slots&&this.data.data[c].slots[n]&&this.data.data[c].slots[n].pid)||(this.data.data[c].autofill&&this.data.data[c].autofill[n]&&this.data.data[c].autofill[n].rent_remain>0)){b+='<div class="autofill" onclick="stall.autofillSlotCommit('+c+", "+n+')" onmouseover="showDiv(\'map_stall'+c+"_slot"+n+"_autofill_tt')\" onmouseout=\"hideDiv('map_stall"+c+"_slot"+n+"_autofill_tt')\">";var t="";if(this.data.data[c].autofill&&this.data.data[c].autofill[n]&&this.data.data[c].autofill[n].rent_remain>0){b+='<div class="ready"></div>';t+='<div id="map_stall'+c+"_slot"+n+'_autofill_tt_timer" class="timer2"></div>';if(this.data.data[c].autofill[n].limit<=0||this.data.data[c].autofill[n].limit==this.data.data[c].autofill[n].sum){b+='<div class="warning pulse">!</div>';if(this.data.data[c].autofill[n].limit<=0){t+='<div class="important" style="margin-top:10px;">'+t_map_stall_autofill_limit_null+"</div>"}else{t+='<div class="important" style="margin-top:10px;">'+t_map_stall_autofill_limit_reached+"</div>"}}}b+='  <div id="map_stall'+c+"_slot"+n+'_autofill_tt" class="ttbox">'+t_map_stall_autofill+t+"</div>";b+="</div>"}b+="</div>"}b+='  <div class="clear"></div>';b+="</div>";b+='<div class="mini_close link" style="z-index:4;" onclick="stall.close()"></div>';b+='<div class="helpbutton_blue link" style="z-index:4;" onclick="stall.help()"></div>';$("map_stall_inner").innerHTML=b;showDiv("map_stall");$("stall_levelbar_number").innerHTML=this.data.data[c].level;$("stall_levelbar_inner").style.width=this.data.data[c].levelData.percent+"%";if(this.data.data[c].levelData.rest>0){var b="<div>"+t_map_stall_level_info.replace("%POINTS%",this.data.data[c].levelData.rest)+"</div>";b+='<div style="margin-top:10px; font-style:italic;">'+t_map_stall_level_info2+"</div>";$("stall_levelbar_tt").innerHTML=b}else{$("stall_levelbar_tt").innerHTML=t_reached_maxlevel}this.timerUpdate()};stall.prototype.clearSlotCommit=function(b,d){var a="<div>"+t_map_stall_click_slot_clear_body+"</div>";a+='<div style="margin-top:10px;">'+t_map_stall_click_slot_clear_body2+"</div>";var c="stall.clearSlot("+b+", "+d+")";globalcommitbox(t_map_stall_click_slot_clear_head,a,c)};stall.prototype.autofillSlotCommit=function(d,m){var c=0;if(this.data.data[d].slots&&this.data.data[d].slots[m]&&this.data.data[d].slots[m].pid){c=this.data.data[d].slots[m].pid}if(c>0||(this.data.data[d].autofill&&this.data.data[d].autofill[m]&&this.data.data[d].autofill[m].rent_remain>0)){if(d>0){this.currentPosition=d}if(m>0){this.currentSlot=m}var n="";var r="";var s=this.data.config.autofill.coins;var l=specialbonus.findBonus({key1:"stall",key2:"autofill"});if(l){n="bonus";r+='<div style="color:green;">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(l.autofill*100))+")</div>";s=Math.ceil(s*(1-l.autofill))}var b=checkRackItem(this.data.data[d].slots[m].pid);var a=b;var h=0;if(this.data.data[d].autofill&&this.data.data[d].autofill[m]&&this.data.data[d].autofill[m].rent_remain>0){a=this.data.data[d].autofill[m].limit;h=1}if(!a){a=b}var e='<div id="map_stall_autofill_slot_commit">';if(c>0){e+='<div class="img tt'+c+'"></div>';e+='<div class="name">'+produkt_name[c]+"</div>"}e+='  <div class="intro">'+t_map_stall_autofill_intro.replace("%TIME%",formatTime(this.data.config.autofill.duration))+"</div>";if(h==1){e+='<div class="timer">'+t_pony_speedup_dialog_speedupresttime+'&nbsp;<span id="map_stall_autofill_slot_commit_timer"></span></div>';e+='<div class="button_new link" onclick="stall.autofillCancelCommit('+m+')" style="margin-top:5px;">'+t_map_stall_autofill_del_button+"</div>"}else{e+='<div class="cost">'+cityadcost+'<b><span class="'+n+'">'+s+"&nbsp;"+t_coins+"</span></b></div>";if(r!=""){e+=r}}e+='  <div class="info">'+t_map_stall_autofill_min+"</div>";var n="";if(!c){n="grayscale"}e+='  <div class="border '+n+'">';e+='    <input id="map_stall_autofill_slot_number" class="input" type="number" value="'+a+'" onchange="stall.autofillSlotCommitCheckAmount('+m+')" onkeyup="stall.autofillSlotCommitCheckAmount('+m+')">';e+='    <div class="stock">'+t_inner_stock+"&nbsp;"+formatNumber(b)+"</div>";e+='    <div class="clear"></div>';e+="  </div>";if(h==1){var n="";if(this.data.data[d].autofill[m].sum>=this.data.data[d].autofill[m].limit){n="important"}e+='<div class="used">'+t_map_stall_autofill_used+'<span class="'+n+'">'+formatNumber(this.data.data[d].autofill[m].sum)+"/"+formatNumber(this.data.data[d].autofill[m].limit)+"</span></div>";if(this.data.data[d].autofill[m].limit<=0){e+='<div class="important" style="margin-top:5px;">'+t_map_stall_autofill_limit_null+"</div>"}if(this.data.data[d].autofill[m].limit>0&&this.data.data[d].autofill[m].limit==this.data.data[d].autofill[m].sum){e+='<div class="important" style="margin-top:5px;">'+t_map_stall_autofill_limit_reached+"</div>"}if(!c){e+='<div class="important" style="margin-top:5px;">'+t_map_stall_autofill_no_product+"</div>"}}e+='  <div class="info2">'+t_map_stall_autofill_min2+"</div>";e+="</div>";var q="stall.buyAutofill("+d+", "+m+")";if(!c){globalcommitbox(t_map_stall_autofill,e,0,0,1)}else{globalcommitbox(t_map_stall_autofill,e,q)}this.autofillSlotCommitCheckAmount(m)}};stall.prototype.autofillCancelCommit=function(b){var a="stall.autofillCancel("+b+")";globalcommitbox(t_map_stall_autofill_del_button,t_map_stall_autofill_del_button_desc,a)};stall.prototype.autofillSlotCommitCheckAmount=function(b){var a=$("map_stall_autofill_slot_number").value;if(this.data.data[this.currentPosition].autofill&&this.data.data[this.currentPosition].autofill[b]){if(this.data.data[this.currentPosition].autofill[b].limit!=a){showDiv("globalbox_footer_buttons")}else{hideDiv("globalbox_footer_buttons")}}if(a>this.data.config.autofillmax){a=this.data.config.autofillmax}$("map_stall_autofill_slot_number").value=a};stall.prototype.fillSlotCommit=function(b,l){if(b>0){this.currentPosition=b;this.fillAmount=0}if(l>0){this.currentSlot=l}var h=[];for(var l in this.data.data[this.currentPosition].slots){if(this.data.data[this.currentPosition].slots[l].pid){h.push(this.data.data[this.currentPosition].slots[l].pid)}}if(!this.fillProduct||in_array(this.fillProduct,h)){for(i=0;i<this.data.products.length;i++){if(!in_array(this.data.products[i],h)){this.fillProduct=this.data.products[i];break}}}var c=checkRackItem(this.fillProduct);var d=this.fillAmount;if(this.fillAmount==0&&c>0){d=Math.min(c,this.data.config.level[this.currentPosition][this.data.data[this.currentPosition].level].fillsum)}var a='<div id="map_stall_fill_slot_commit">';a+='  <div class="dropdown">';var e=[];if(this.data.data[this.currentPosition].wishlist&&this.data.data[this.currentPosition].wishlist.products){e=this.data.data[this.currentPosition].wishlist.products}a+=htmlProductDropdown("stall",h,e);a+="  </div>";a+='  <div class="border">';a+='    <input id="map_stall_fill_slot_number" class="input" type="number" value="'+d+'" onchange="stall.fillSlotCommitCheckAmount()" onkeyup="stall.fillSlotCommitCheckAmount()">';a+='    <div class="stock">'+t_inner_stock+"&nbsp;"+formatNumber(c)+"</div>";a+='    <button class="button_new link" onclick="stall.fillSlot()">'+t_inner_feedsubmit+"</button>";a+='    <div class="clear"></div>';a+="  </div>";a+='  <div class="capacity">'+t_map_stall_slot_capacity+"&nbsp;"+formatNumber(this.data.config.level[this.currentPosition][this.data.data[this.currentPosition].level].fillsum)+"</div>";a+='  <div class="">'+t_map_stall_slot_only_one+"</div>";a+="</div>";globalBoxFlex(t_fuelstation_insert_dialog,a,0,0,1);this.fillSlotCommitCheckAmount()};stall.prototype.fillSlotCommitCheckAmount=function(){var b=checkRackItem(this.fillProduct);var c=$("map_stall_fill_slot_number").value;var a=this.data.config.level[this.currentPosition][this.data.data[this.currentPosition].level].fillsum;if(c>b){c=b}if(c>a){c=a}if(c<0){c=0}this.fillAmount=c;$("map_stall_fill_slot_number").value=c};stall.prototype.fillSlotCommitSetProduct=function(a){this.fillProduct=a;this.fillAmount=0;this.fillSlotCommit()};stall.prototype.refillSlotCommit=function(d,m){if(d>0){this.currentPosition=d}if(m>0){this.currentSlot=m}var c=this.data.data[d].slots[m].pid;var b=this.data.data[d].slots[m].amount;var h=checkRackItem(c);var l=this.data.config.level[this.currentPosition][this.data.data[this.currentPosition].level].fillsum;var a=(l-b);var n=l;if(h<a){n=(b+h)}this.fillProduct=c;this.fillAmount=n;var e='<div id="map_stall_fill_slot_commit">';e+='  <div class="img2 tt'+c+'"></div>';e+='  <div class="name2">'+produkt_name[c]+"</div>";e+='  <div style="float:left; margin-top:8px; width:85px; text-align:left;">'+t_map_stall_slot_capacity+"&nbsp;</div>";e+='  <div style="float:left; width:205px;" class="border">';e+='    <input id="map_stall_fill_slot_number" class="input" style="float:left;" type="number" value="'+n+'" onchange="stall.refillSlotCommitCheckAmount()" onkeyup="stall.refillSlotCommitCheckAmount()">';e+='  	 <div style="float:left; margin-top:2px; margin-left:5px;">/'+formatNumber(l)+"</div>";e+='    <button style="float:right;" class="button_new link" onclick="stall.refillSlot()">'+t_map_stall_refill_button+"</button>";e+='    <div class="clear"></div>';e+="  </div>";e+='  <div class="clear"></div>';e+='  <div class="stock" style="font-style:italic; margin:5px 0px 10px 0px;">'+t_inner_stock+"&nbsp;"+formatNumber(h)+"</div>";e+="</div>";globalBoxFlex(t_fuelstation_insert_dialog2,e,0,0,1)};stall.prototype.refillSlotCommitCheckAmount=function(){var b=checkRackItem(this.fillProduct);var c=$("map_stall_fill_slot_number").value;var a=this.data.config.level[this.currentPosition][this.data.data[this.currentPosition].level].fillsum;var e=this.data.data[this.currentPosition].slots[this.currentSlot].amount;var d=(c-e);if(d>0&&d>b){c=b}if(c>a){c=a}if(c<0){c=0}this.fillAmount=c;$("map_stall_fill_slot_number").value=c};stall.prototype.buyCommit=function(b){if(this.data.config.position[b].rent){var c=t_map_stall_rent_head}else{var c=t_map_stall_buy_head}var a="";if(this.data.config.position[b].money&&this.data.config.position[b].money>0){a+='<div class="cost">'+t_map_stall_buy.replace("%COST%",formatPrice(this.data.config.position[b].money))+"</div>"}if(this.data.config.position[b].coins&&this.data.config.position[b].coins>0){a+='<div class="cost">'+t_map_stall_buy.replace("%COST%",this.data.config.position[b].coins+"&nbsp;"+t_coins)+"</div>"}if(this.data.config.position[b].rent){var e=t_map_stall_rent.replace("%COST%",this.data.config.position[b].rent.coins+"&nbsp;"+t_coins);a+='<div class="cost">'+e.replace("%DURATION%",formatTime(this.data.config.position[b].rent.duration))+"</div>"}var d="stall.buy("+b+")";globalcommitbox(c,a,d)};stall.prototype.buySlotCommit=function(a,l){if(this.data.config.stall_position[a][l].rent){var e=t_map_stall_rent_slot_head}else{var e=t_map_stall_buy_slot_head}var r="stall.buySlot("+a+", "+l+")";var h="hideDiv('globaltransp'); hideDiv('globalbox');";var m="";var b="";if(this.data.config.stall_position[a][l].money&&this.data.config.stall_position[a][l].money>0){if(parseInt(this.data.config.stall_position[a][l].money)>parseInt(user_bar)){m="important"}b+='<div class="cost">'+t_map_stall_buy_slot.replace("%COST%",'<span class="'+m+'">'+formatPrice(this.data.config.stall_position[a][l].money)+"</span>")+"</div>"}if(this.data.config.stall_position[a][l].coins&&this.data.config.stall_position[a][l].coins>0){if(parseInt(this.data.config.stall_position[a][l].coins)>parseInt(user_coins)){m="important"}b+='<div class="cost">'+t_map_stall_buy_slot.replace("%COST%",'<span class="'+m+'">'+this.data.config.stall_position[a][l].coins+"&nbsp;"+t_coins+"</span>")+"</div>"}if(this.data.config.stall_position[a][l].rent){var d=specialbonus.findBonus({key1:"stall",key2:"rentslot"});var c="";var q="";var s=this.data.config.stall_position[a][l].rent.coins;if(d){c="color:green; font-weight:bold;";q+='<div style="color:green;">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(d.rentslot*100))+")</div>";s=Math.ceil(s*(1-d.rentslot))}if(parseInt(s)>parseInt(user_coins)){m="important"}var n=t_map_stall_rent_slot.replace("%COST%",'<span class="'+m+'" style="'+c+'">'+s+"&nbsp;"+t_coins+"</span>");b+='<div class="cost">'+n.replace("%DURATION%",formatTime(this.data.config.stall_position[a][l].rent.duration))+"</div>";if(q!=""){b+=q}}if(m!=""){r=""}globalcommitbox(e,b,r,h)};stall.prototype.buildBooster=function(){var h="";var m=0;var c="";var d=specialbonus.findBonus({key1:"stall",key2:"booster"});if(d){h+='<div style="color:green;">('+t_incl+"&nbsp;"+(d.booster*100)+"% "+t_specialbonus_vet_points_info+")</div>";m=d.booster;var c="bonus"}var b='<div id="map_stall_booster" class="house'+this.currentPosition+'">';for(var e in this.data.config.booster){var a=this.data.config.booster[e].coins;if(m>0){a=(a*(1-m))}b+='<div class="line link">';var l=t_map_stall_booster[e].replace("%TIME%",formatTime(this.data.config.booster[e].duration));b+='  <div class="img '+e+'"></div>';b+='  <div class="desc">';b+='    <div class="headline">'+t_map_stall_booster_headline[e]+"</div>";b+="    <div>"+l.replace("%PERCENT%",(this.data.config.booster[e].percent*100))+"</div>";b+="  </div>";b+='  <div class="cost '+c+'">'+a+"&nbsp;"+t_coins+"</div>";b+='  <div class="clear"></div>';b+='  <div id="map_stall_booster_'+e+'_button" class="button_new link" onclick="stall.buyBoosterCommit(\''+e+"')\">"+t_map_stall_buy_booster+"</div>";b+='  <div id="map_stall_booster_'+e+'_timer" class="timer">'+t_map_stall_booster_resttime+'&nbsp;<span id="map_stall_booster_'+e+'_timer_time"></span></div>';b+="</div>"}b+="</div>";if(h!=""){b+=h}globalBoxFlex(t_map_stall_buy_booster,b,0,0,1)};stall.prototype.buyBoosterCommit=function(d){var n=this.data.config.booster[d].coins;var h="";var l="";var c=specialbonus.findBonus({key1:"stall",key2:"booster"});if(c){h="bonus";l+='<div style="color:green; margin-top:5px;">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(c.booster*100))+")</div>";n=Math.ceil(n*(1-c.booster))}var a='<div id="map_stall_commit">';var b=t_map_stall_booster[d].replace("%TIME%",formatTime(this.data.config.booster[d].duration));a+='  <div class="desc">'+b.replace("%PERCENT%",(this.data.config.booster[d].percent*100))+"</div>";a+='  <div style="margin-top:10px;">'+cityadcost+'<span class="'+h+'">'+n+"&nbsp;"+t_coins+"</span></div>";if(l!=""){a+=l}a+="</div>";var m="stall.buyBooster('"+d+"')";var e="stall.buildBooster("+this.currentPosition+")";globalcommitbox(t_map_stall_buy_booster,a,m,e)};stall.prototype.showStats=function(){var a='<div id="stall_stats">';a+='  <div class="select_line">';a+='    <select id="stall_stats_select" onchange="stall.stats()">';var b=["farmis","bar"];for(var c=0;c<b.length;c++){var d="";if(this.stats_select==b[c]){d="selected"}a+='<option value="'+b[c]+'" '+d+">"+t_map_stall_stats[b[c]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_map_stall_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select]);a+="</div>";globalBoxFlex("",a,0,0,1)};stall.prototype.buildRewards=function(h,d){if(!h){h=this.data.data[this.currentPosition].reward}var a='<div id="map_stall_reward">';if(d){a+='<div class="intro">'+t_cowracing_pvp_race_igm_body3+"</div>"}else{a+='<div class="intro">'+t_pets_reward_list+"</div>"}a+='  <div class="list">';var e=0;for(var c in h){if(c=="money"){a+='<div class="line">';a+='  <div class="left megafield_money_icon"></div>';a+='  <div class="right">'+formatPrice(h.money)+"</div>";a+='  <div class="clear"></div>';a+="</div>";e++}if(c=="points"){a+='<div class="line">';a+='  <div class="left megafield_points_icon"></div>';a+='  <div class="right">'+formatNumber(h.points)+"&nbsp;"+t_points+"</div>";a+='  <div class="clear"></div>';a+="</div>";e++}if(c=="xp"){var l=formatNumber(h.xp)+"&nbsp;"+t_map_stall_points;if(this.data.data[this.currentPosition].levelData.maxed&&!devserver){l=t_reached_maxlevel}a+='<div class="line">';a+='  <div class="left stall_points_icon"></div>';a+='  <div class="right">'+l+"</div>";a+='  <div class="clear"></div>';a+="</div>";e++}}a+="  </div>";if(!d&&e>0){a+='<div class="button_new link" onclick="stall.getReward()">'+t_pony_crop_tt+"</div>"}a+="</div>";globalBoxFlex(t_vet_reward_head,a,0,0,1);if(d==1){var b='<div id="map_stall_reward_confetti" class="confetti"></div>';$("map_stall_reward").insert(b);setTimeout(function(){if($("map_stall_reward_confetti")){$("map_stall_reward_confetti").remove()}},1000)}};stall.prototype.buildWishlist=function(){var c='<div id="map_stall_wishlist">';c+='  <div class="intro">'+t_map_stall_wishlist_info+"</div>";c+='  <div class="list">';for(var a=0;a<this.data.data[this.currentPosition].wishlist.products.length;a++){var b=this.data.data[this.currentPosition].wishlist.products[a];c+='<div class="line">';c+='  <div class="left kp'+b+'"></div>';c+='  <div class="left2 ">'+produkt_name[b]+"</div>";c+='  <div class="clear"></div>';c+="</div>"}c+="  </div>";c+='  <div class="timer" id="map_stall_wishlist_timer">'+t_map_stall_wishlist_change+'<span id="map_stall_wishlist_timer_time"></span></div>';c+='  <div class="forecast">';if(this.data.data[this.currentPosition].wishlist.forecast){c+='<div class="intro">'+t_map_stall_wishlist_forecast_next+"</div>";c+='  <div class="list">';for(var a=0;a<this.data.data[this.currentPosition].wishlist.forecast.products.length;a++){var b=this.data.data[this.currentPosition].wishlist.forecast.products[a];c+='<div class="line">';c+='  <div class="left kp'+b+'"></div>';c+='  <div class="left2 ">'+produkt_name[b]+"</div>";c+='  <div class="clear"></div>';c+="</div>"}c+="  </div>"}else{var e="";var m="";var n=parseInt(this.data.config.forecast_coins);var d=specialbonus.findBonus({key1:"stall",key2:"forecast"});if(d){e="bonus";m+='<div style="color:green; margin:-5px 0px 5px 0px;">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(d.forecast*100))+")</div>";n=Math.ceil(n*(1-d.forecast))}var h="";if(n>parseInt(user_coins)){h="important"}c+='<div class="intro">'+t_map_stall_wishlist_forecast_info.replace("%COST%",'<span style="font-weight:bold;" class="'+h+" "+e+'">'+n+"&nbsp;"+t_coins+"</span>")+"</div>";if(m!=""){c+=m}var l="stall.wishlistCommit()";if(h!=""){l=""}c+='<div class="button_new link '+h+'" onclick="'+l+'">'+t_map_stall_wishlist_forecast_button+"</div>"}c+="  </div>";c+="</div>";globalBoxFlex(t_map_stall_wishlist,c,0,0,1)};stall.prototype.wishlistCommit=function(){var h="";var e="";var b=parseInt(this.data.config.forecast_coins);var c=specialbonus.findBonus({key1:"stall",key2:"forecast"});if(c){h="color:green;";e+='<div style="color:green;">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(c.forecast*100))+")</div>";b=Math.ceil(b*(1-c.forecast))}var a='<div style="width:250px;">'+t_map_stall_wishlist_forecast_info.replace("%COST%",'<b><span style="'+h+'">'+b+"&nbsp;"+t_coins+"</span></b>")+"</div>";if(e!=""){a+=e}var d="stall.forecast()";globalcommitbox(t_map_stall_wishlist_forecast_button,a,d)};stall.prototype.farmilog=function(){var a='<div id="map_stall_farmilog">';a+='  <div class="intro">'+t_map_stall_farmi_log_intro+"</div>";a+='  <div class="log">';if(this.data.data[this.currentPosition].farmi_log){for(var d=this.data.data[this.currentPosition].farmi_log.length;d>0;d--){var h=this.data.data[this.currentPosition].farmi_log[(d-1)];a+='<div class="line">';var e=0;for(var b in h.products){a+='<div class="col1 kp'+b+'"></div>';a+='<div class="col2">'+h.products[b]+"x&nbsp;"+produkt_name[b]+"</div>";e++;if(e%3==0){a+='<div class="clear"></div>'}}a+='  <div class="clear"></div>';for(var c in h.reward){a+='<div style="float:left; margin-right: 20px;">'+c+": "+h.reward[c]+"</div>"}a+='  <div class="clear"></div>';a+='  <div class="price">VALUE: '+formatPrice(h.value)+" / SUM: "+formatPrice(h.sum)+"</div>";if(h.time){a+='<div class="date">'+stall.formatDate(h.time)+"</div>"}a+='  <div class="clear"></div>';a+="</div>"}}a+="  </div>";a+="</div>";globalBoxFlex(t_map_stall_farmi_log,a,0,0,1)};stall.prototype.overview=function(b){openMap();if(this.data.data&&this.data.data[b]){this.currentPosition=b;this.init()}else{var a=this.checkStallStatus(b);if(!a.failed){setTimeout(function(){stall.buyCommit(b)},100)}}};stall.prototype.milestones=function(){var e=0;for(var b in this.data.config.milestones){if(e<this.data.config.milestones[b].count){e=this.data.config.milestones[b].count}}var d=0;for(var h in this.data.data){d+=parseInt(this.data.data[h].farmi_count)}var s=Math.min(100,(d*100)/e);var q=t_map_stall_milestones;var l='<div id="map_stall_milestones">';l+='<div class="desc">'+t_map_stall_milestones_desc+"</div>";l+='  <div class="bar">';l+='    <div class="front">';l+='      <div class="inner" style="height:'+s+'%"></div>';l+="    </div>";l+='    <div class="steps">';var m=0;for(var b in this.data.config.milestones){var n=(this.data.config.milestones[b].percent*100);var a=(this.data.config.milestones[b].count*100)/e;var r="left";if(b%2==0){r="right"}if(in_array(b,[1,2,5,6])){r+=" small"}if(this.data.config.milestones[b].count==e){r+=" top"}else{if((m+n)>=10){r+=" mid"}}l+='<div id="map_stall_milestones_step'+b+'" class="step '+r+'" style="bottom:'+a+'%">';l+='  <div class="counter">'+t_map_stall_milestones_farmis_need.replace("%COUNT%",formatNumber(this.data.config.milestones[b].count))+"</div>";l+='  <div class="bonus">'+t_map_stall_milestones_farmis_bonus.replace("%PERCENT%",n)+"</div>";m+=n;r="";if(d<this.data.config.milestones[b].count){r="grayscale"}l+='  <div class="star '+r+'">';l+='    <div class="percent">'+m+"%</div>";l+="  </div>";l+="</div>"}l+="    </div>";l+='    <div class="current">'+t_map_stall_milestones_farmis_current.replace("%COUNT%",formatNumber(d))+"</div>";l+="  </div>";l+='  <div class="deco">';for(var c=1;c<=12;c++){var t="";if(c==1){t="stall.milestonesEECelebrate()"}l+='<div id="map_stall_milestones_deco_farmi'+c+'" class="farmi hide" onclick="'+t+'"></div>'}l+="  </div>";l+="</div>";globalBoxFlex(q,l,0,0,1);$("globalbox").style.top="35px"};stall.prototype.timer=function(){for(var a in this.data.data){if(!this.data.config.position[a]){continue}if(this.data.config.position[a].rent){this.data.data[a].rent_remain--}if(this.data.data[a].booster){for(var c in this.data.data[a].booster){if(this.data.data[a].booster[c].start_time){this.data.data[a].booster[c].remain--}}}if(this.data.data[a].slots){for(var d in this.data.data[a].slots){if(this.data.config.stall_position[a][d].rent){this.data.data[a].slots[d].rent_remain--}}}if(this.data.data[a].autofill){for(var d in this.data.data[a].autofill){this.data.data[a].autofill[d].rent_remain--}}if(this.data.data[a].wishlist){this.data.data[a].wishlist.remain--}}for(var b in this.stats_cache_delay){this.stats_cache_delay[b]--}this.timerUpdate();this.informer();this.runtime++;if(this.runtime>0&&this.runtime%20==0){this.milestonesEEStart()}};stall.prototype.timerUpdate=function(){for(var a in this.data.data){if(!this.data.config.position[a]){continue}if(this.data.config.position[a].rent){if(this.data.data[a].rent_remain>0){showDiv("map_stall"+a+"_rent_timer");if($("map_stall"+a+"_rent_timer_time")){$("map_stall"+a+"_rent_timer_time").innerHTML=formatTime(this.data.data[a].rent_remain)}}else{hideDiv("map_stall"+a+"_rent_timer");if(this.data.data[a].rent_remain==-1){this.build()}}}if(a==this.currentPosition&&this.data.data[a].booster){var c="";for(var b in this.data.data[a].booster){if(this.data.data[a].booster[b].remain>0){if($("map_stall_booster_"+b+"_timer")){$("map_stall_booster_"+b+"_timer_time").innerHTML=formatTime(this.data.data[a].booster[b].remain);showDiv("map_stall_booster_"+b+"_timer");hideDiv("map_stall_booster_"+b+"_button")}c+='<div class="upgrade '+b+'"></div>'}else{hideDiv("map_stall_booster_"+b+"_timer");showDiv("map_stall_booster_"+b+"_button");if(this.data.data[a].booster[b].remain==-1&&$("map_stall_booster")){this.buildBooster(a)}}}if($("stall_house")){$("stall_house").innerHTML=c}}if(this.data.data[a].slots){for(var d in this.data.data[a].slots){if(this.data.config.stall_position[a][d].rent){if(this.data.data[a].slots[d].rent_remain>0){if($("map_stall"+a+"_slot"+d+"_rent_timer")){showDiv("map_stall"+a+"_slot"+d+"_rent_timer");$("map_stall"+a+"_slot"+d+"_rent_timer_time").innerHTML=formatTime(this.data.data[a].slots[d].rent_remain)}}else{if($("map_stall"+a+"_slot"+d+"_rent_timer")){hideDiv("map_stall"+a+"_slot"+d+"_rent_timer");if(this.data.data[a].slots[d].rent_remain==-1&&$("map_stall").style.display=="block"){this.data.data[a].slots[d].rent_remain--;this.open(a)}}}}}}if(this.data.data[a].autofill){for(var d in this.data.data[a].autofill){if($("map_stall"+a+"_slot"+d+"_autofill_tt_timer")&&this.data.data[a].autofill[d].rent_remain>0){$("map_stall"+a+"_slot"+d+"_autofill_tt_timer").innerHTML=t_pony_speedup_dialog_speedupresttime+"&nbsp;"+formatTime(this.data.data[a].autofill[d].rent_remain)}if($("map_stall_autofill_slot_commit_timer")&&a==this.currentPosition){if(d!=this.currentSlot){continue}if(this.data.data[a].autofill[d].rent_remain>0&&$("map_stall_autofill_slot_commit_timer")){$("map_stall_autofill_slot_commit_timer").innerHTML=formatTime(this.data.data[a].autofill[d].rent_remain)}else{if(this.data.data[a].autofill[d].rent_remain=-1){stall.autofillSlotCommit(this.currentPosition,this.currentSlot)}}}}}if($("map_stall_wishlist_timer")&&a==this.currentPosition&&this.data.data[a].wishlist){if(this.data.data[a].wishlist.remain>0){$("map_stall_wishlist_timer_time").innerHTML=formatTime(this.data.data[a].wishlist.remain)}}}};stall.prototype.informer=function(){for(var a in this.data.config.position){if($("map_stall_overview_link_alert"+a)){$("map_stall_overview_link_alert"+a).remove();$("map_stall_overview_link_alert_tt"+a).remove()}}if(this.data.data){for(var a in this.data.data){if(this.informerRead[a]){continue}var c="";if(!this.data.data[a].slots||!this.data.data[a].slots[1]){c+='<div class="line">'+t_map_stall_informer_empty+"</div>"}for(var d in this.data.data[a].slots){if(this.data.config.stall_position[a][d].rent&&this.data.data[a].slots[d].rent_time){if(this.data.data[a].slots[d].rent_remain<=0){if((this.data.data[a].slots[d].rent_remain*-1)>=172800){continue}if(this.data.data[a].slots[d].pid){c+='<div class="line">'+t_map_stall_informer_rentoutdated+"</div>"}continue}}if(!this.data.data[a].slots[d].pid){c+='<div class="line">'+t_map_stall_informer_empty+"</div>"}if(this.data.data[a].autofill&&this.data.data[a].autofill[d]){if(this.data.data[a].autofill[d].rent_remain<=0){if((this.data.data[a].autofill[d].rent_remain*-1)>=172800){}else{c+='<div class="line">'+t_map_stall_informer_outdated+"</div>"}}else{if(this.data.data[a].autofill[d].sum>=this.data.data[a].autofill[d].limit){if(this.data.data[a].autofill[d].sum==0){c+='<div class="line">'+t_map_stall_informer_nolimit+"</div>"}else{c+='<div class="line">'+t_map_stall_informer_limit+"</div>"}}}}}if(c!=""&&!$("map_stall_overview_link_alert"+a)&&$("map_stall_overview_link"+a)){var b='<div id="map_stall_overview_link_alert'+a+'" class="alert">!</div>';$("map_stall_overview_link"+a).insert(b);$("map_stall_overview_link_tt"+a).insert('<div id="map_stall_overview_link_alert_tt'+a+'" class="alerts important">'+c+"</div>")}}}};stall.prototype.pointsFlyer=function(c,a){if($("stall_points_flyer")){$("stall_points_flyer").remove()}var d=(a-c);var b='<div id="stall_points_flyer" class="pointsalert">+'+d+"</div>";setTimeout(function(){$("stall_levelbar").insert(b)},100);setTimeout(function(){if($("stall_points_flyer")){$("stall_points_flyer").addClassName("start")}},500);setTimeout(function(){if($("stall_points_flyer")){$("stall_points_flyer").remove()}},2000)};stall.prototype.milestonesEEStart=function(){if($("map_stall_milestones")){$("map_stall_milestones_deco_farmi1").removeClassName("hide").addClassName("show");setTimeout(function(){if(!stall.milestonesDecoBlock){$("map_stall_milestones_deco_farmi1").removeClassName("wink").removeClassName("show").addClassName("hide")}},2500)}};stall.prototype.milestonesEECelebrate=function(){this.milestonesDecoClick++;if(this.milestonesDecoBlock==1||this.milestonesDecoClick<2){return 0}this.milestonesDecoBlock=1;for(var a=2;a<=12;a++){$("map_stall_milestones_deco_farmi"+a).removeClassName("hide").addClassName("show")}setTimeout(function(){for(var b=1;b<=12;b++){$("map_stall_milestones_deco_farmi"+b).removeClassName("show").addClassName("hide")}},2500);setTimeout(function(){stall.milestonesDecoBlock=0;stall.milestonesDecoClick=0},3500)};stall.prototype.help=function(){mapHelpOpen();mapHelpNavi(5)};stall.prototype.close=function(){hideDiv("map_stall")};stall.prototype.formatDate=function(a){var l=new Date(a*1000);var e=l.getHours();if(e.toString().length==1){e="0"+e}var b=l.getMinutes();if(b.toString().length==1){b="0"+b}var c=l.getSeconds();if(c.toString().length==1){c="0"+c}return l.getDate()+"."+(l.getMonth()+1)+"."+l.getFullYear()+" "+e+":"+b+":"+c};var statscacher=function(){this.data={};this.type="";this.currentPage=1;this.userPos=0;this.cache={};this.cacheDelay=(5*60)};statscacher.prototype.searchPlayer=function(){var a=$("statscacher_search").value;if(a==""){return 1}statscacher.action("statscacher_search_player",{name:a})};statscacher.prototype.findPlayer=function(){statscacher.action("statscacher_find_player",{type:statscacher.type})};statscacher.prototype.getStats=function(a,b){statscacher.action("statscacher_get_stats",{type:a,page:b})};statscacher.prototype.action=function(a,b){ajaxAction("city",a,b,statscacher.response)};statscacher.prototype.response=function(b,a,c){if(a=="statscacher_search_player"){statscacher.showInfo(b);return 1}statscacher.data=b;if(statscacher.type==""){statscacher.type=statscacher.data.type}if(a=="statscacher_find_player"){statscacher.currentPage=statscacher.data.page}if(!statscacher.cache[statscacher.type]){statscacher.cache[statscacher.type]={}}statscacher.cache[statscacher.type][statscacher.data.page]=statscacher.data;statscacher.cache[statscacher.type][statscacher.data.page].timer=0;statscacher.build();if(a=="statscacher_find_player"){statscacher.scrollPositionPlayer()}};statscacher.prototype.init=function(){var a="";if(this.type!=""){a=this.type}this.getStats(a,this.currentPage);setTimer("statscacher")};statscacher.prototype.showInfo=function(d){var c='<div id="statscacher_infobox">';c+='  <div class="head">'+t_search_result+"</div>";if(d.player&&d.player.unr){for(var b in d.player){if(!t_statscacher_info_col[b]){continue}var e=d.player[b];if(in_array(b,["bar","money"])){e=formatPrice(e)}else{if(!in_array(b,["unr","uname","level"])){e=formatNumber(e)}}c+='<div class="line">';c+='  <div class="col1">'+t_statscacher_info_col[b]+"</div>";c+='  <div class="col2">'+e+"</div>";c+='  <div class="clear"></div>';c+="</div>"}}else{c+='<div class="important">'+t_statscacher_noplayer+"</div>"}c+='<div class="liner"></div>';if(d.guild&&d.guild.unr){for(var b in d.guild){if(!t_statscacher_info_col[b]){continue}var e=d.guild[b];if(in_array(b,["joincost"])){e=formatPrice(e)}else{if(in_array(b,["createguild"])){e=formatDate(e)}else{if(!in_array(b,["unr","guildname","guilddescription","createdate"])){e=formatNumber(e)}}}c+='<div class="line">';c+='  <div class="col1">'+t_statscacher_info_col[b]+"</div>";if(b=="guilddescription"){c+='<div class="clear"></div>'}c+='  <div class="col2 is'+b+'">'+e+"</div>";c+='  <div class="clear"></div>';c+="</div>"}c+='<div class="line">';c+='  <button type="button" class="link" onclick="statscacher.guildJoin('+d.guild.unr+')">'+t_stadt_stats_joinguild+"</button>";c+="</div>"}else{c+='<div class="important">'+t_statscacher_noguild+"</div>"}c+="</div>";var a="statscacher.init()";globalBoxFlex("",c,0,a,1)};statscacher.prototype.showStats=function(){if(this.cache&&this.cache[this.type]&&this.cache[this.type][this.currentPage]){if(this.cache[this.type][this.currentPage].timer<this.cacheDelay){this.data=this.cache[this.type][this.currentPage];this.build();return 1}}this.getStats(this.type,this.currentPage)};statscacher.prototype.build=function(){var a='<div id="statscacher_box">';a+='  <div id="statscacher_box_header" class="header"></div>';a+='  <div id="statscacher_box_list" class="list"></div>';a+='  <div id="statscacher_box_footer" class="footer"></div>';a+="</div>";globalBoxFlex("",a,0,0,1);$("globalbox").style.top="50px";hideDiv("transp3");this.buildHeader();this.buildList();this.buildFooter()};statscacher.prototype.buildHeader=function(){var c="";c+='<select id="statscacher_selection" onchange="statscacher.selectType()">';if(this.data.valid){for(var b=0;b<this.data.valid.length;b++){var d="";if(this.data.valid[b]==this.type){d="selected"}var a=this.data.valid[b];if(t_statscacher_option_name[this.data.valid[b]]){a=t_statscacher_option_name[this.data.valid[b]]}c+='<option value="'+this.data.valid[b]+'" '+d+">"+a+"</option>"}}c+="</select>";if(!in_array(this.type,["guilds","medals","buildings","animals","stock"])){c+='<div class="button_new link whoiam" onclick="statscacher.findPlayerLocal()">'+t_statscacher_find_player+"</div>"}c+='<div class="button_new link search" onclick="statscacher.searchPlayer()">'+t_statscacher_search_player+"</div>";c+='<input id="statscacher_search" type="text" placeholder="'+t_statscacher_search_text+'">';c+='<div class="info" onmouseover="showDiv(\'statscacher_header_info_tt\')" onmouseout="hideDiv(\'statscacher_header_info_tt\')">';c+="  <div>!</div>";c+='  <div id="statscacher_header_info_tt" class="ttbox">';c+="    <div>"+t_stats_cache_info+"</div>";c+='    <div style="margin-top:10px;">'+t_statschacher_inactives_info.replace("%COUNT%",this.data.inactivesyears)+"</div>";c+="  </div>";c+="</div>";c+='<div class="clear"></div>';$("statscacher_box_header").innerHTML=c};statscacher.prototype.buildList=function(){var l="";if(this.data.entries){var d=0;for(var h=0;h<this.data.entries.length;h++){if(this.data.entries[h].percent){this.data.entries[h].val=Math.floor(this.data.entries[h].percent)}var n="";var e=(((this.currentPage-1)*this.data.chunksize)+(h+1));var b='<div class="text">'+this.data.entries[h].uname+"</div>";if(this.data.entries[h].unr){if(player_unr==this.data.entries[h].unr){n="self";this.userPos=e}if(this.data.entries[h].schaufenster>0){b+='<div class="showgarden link" onclick="window.open(\''+http_host+"schaugarten/index.php?mode=view&user="+this.data.entries[h].unr+"')\"></div>"}if(this.data.entries[h].gold>0){b+='<div class="medal gold" title="'+this.data.entries[h].gold+'"></div>'}if(this.data.entries[h].silber>0){b+='<div class="medal silber" title="'+this.data.entries[h].silber+'"></div>'}if(this.data.entries[h].bronze>0){b+='<div class="medal bronze" title="'+this.data.entries[h].bronze+'"></div>'}b+='<div class="clear"></div>'}var c="";if(this.data.entries[h].guildid){if(player_guild==this.data.entries[h].guildid&&player_guildmemberstatus>0){n="self"}c='<button type="button" class="link" onclick="statscacher.guildJoin('+this.data.entries[h].guildid+')">'+t_stadt_stats_joinguild+"</button>"}if(parseInt(this.data.entries[h].val)!=parseInt(d)){e+="."}else{e="&nbsp;"}var m=0;if(this.data.entries[h].val){m=formatNumber(this.data.entries[h].val)}if(this.data.entries[h].percent){m+="%"}if(in_array(this.data.type,["bar","s_money"])){m=formatPrice(this.data.entries[h].val)}var a="";if(this.data.entries[h].level){a=this.data.entries[h].level}if(in_array(this.type,["animals","buildings","stock"])){this.data.entries[h].percent=Math.floor((parseInt(this.data.entries[h].val)*100)/parseInt(this.data.entries[0].val))}l+='<div class="line '+n+'">';l+='  <div class="rank">'+e+"</div>";l+='  <div class="name">'+b+"</div>";if(c!=""){l+='<div class="join">'+c+"</div>"}if(a!=""){l+='<div class="level">'+a+"</div>"}l+='  <div class="value is'+this.type+'">';if(this.data.entries[h].percent){l+='<div class="percent"><div class="percent_inner" style="width:'+this.data.entries[h].percent+'%"></div></div>'}l+="    <div>"+m+"</div>";l+="  </div>";l+='  <div class="clear"></div>';l+="</div>";if(in_array(this.type,["animals","buildings","stock"])){delete this.data.entries[h].percent}d=parseInt(this.data.entries[h].val)}}$("statscacher_box_list").innerHTML=l};statscacher.prototype.buildFooter=function(){var d="";if(this.currentPage==1){d="off"}var c="";var a=1;if(this.data.max){a=this.data.max}a=Math.ceil(a/this.data.chunksize);if(this.currentPage==a){c="off"}var b="";b+='<div class="arrow left link '+d+'" onclick="statscacher.listNavi(-1)"></div>';b+='<div class="arrow right link '+c+'" onclick="statscacher.listNavi(1)"></div>';$("statscacher_box_footer").innerHTML=b};statscacher.prototype.listNavi=function(b){if(b<0&&this.currentPage==1){return 0}var a=Math.ceil(this.data.max/this.data.chunksize);if(b>0&&this.currentPage==a){return 0}this.currentPage+=b;this.showStats(0)};statscacher.prototype.findPlayerLocal=function(){if(this.userPos>0){var a=Math.ceil(parseInt(this.userPos)/parseInt(this.data.chunksize));if(this.cache[this.type][a]){this.currentPage=a;this.showStats();this.scrollPositionPlayer();return 1}}this.findPlayer()};statscacher.prototype.scrollPositionPlayer=function(){var b=0;for(var a=0;a<this.cache[this.type][this.currentPage].entries.length;a++){b++;if(this.cache[this.type][this.currentPage].entries[a].unr==player_unr){break}}$("statscacher_box_list").scrollTop=((b-1)*17)};statscacher.prototype.selectType=function(){this.type=$("statscacher_selection").value;this.userPos=0;this.currentPage=1;this.showStats()};statscacher.prototype.guildJoin=function(a){hideDiv("globaltransp");hideDiv("globalbox");statsAction(0,0,a)};statscacher.prototype.goBack=function(){statscacher.getStats(statscacher.type,statscacher.currentPage)};statscacher.prototype.timer=function(){if(this.cache){for(var a in this.cache){for(var b in this.cache[a]){this.cache[a][b].timer++}}}};var statscacher=new statscacher();var sushibar=function(){this.data={};this.farm=8;this.currentView="bar";this.currentProduct=0;this.trainSetupActive=0;this.productionSlot=0;this.productionSelectionItemsPerPage=4;this.productionSelectionPage=1;this.productionSelectionFilter="none";this.stats_options=["points","farmis","food","earned","highest"];this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.tutorialType="";this.tutorialStep=1;this.runtime=0;this.checkTrainInterval=3600;this.checkTrainBlock=0;this.reward={};this.old={}};sushibar.prototype.finishEat=function(a){sushibar.action("sushibar_finisheat",{slot:a})};sushibar.prototype.setTutorial=function(){sushibar.action("sushibar_settutorial",{type:sushibar.tutorialType})};sushibar.prototype.finishFarmi=function(a){sushibar.action("sushibar_finishfarmi",{slot:a})};sushibar.prototype.checkTrain=function(){sushibar.old={farmis:sushibar.data.farmis,train:sushibar.data.data.train};sushibar.action("sushibar_checktrain")};sushibar.prototype.stats=function(){if($("sushibar_stats_select")){if($("sushibar_stats_select").value==0){return 1}sushibar.stats_select=$("sushibar_stats_select").value}if(sushibar.stats_cache_delay[sushibar.stats_select]<=0||!sushibar.stats_cache[this.stats_select]){sushibar.action("sushibar_stats",{type:sushibar.stats_select})}else{sushibar.showStats(sushibar.stats_select)}};sushibar.prototype.clearTrainSlot=function(a){sushibar.action("sushibar_cleartrainslot",{slot:a})};sushibar.prototype.buyTrainSlot=function(a){sushibar.action("sushibar_buytrainslot",{slot:a})};sushibar.prototype.setTrainSlot=function(b,a){sushibar.action("sushibar_settrainslot",{slot:b,pid:a})};sushibar.prototype.buyFarmiSlot=function(a){sushibar.action("sushibar_buyfarmislot",{slot:a})};sushibar.prototype.buyPharmacist=function(){sushibar.action("sushibar_buypharmacist")};sushibar.prototype.rememberPharmacist=function(){sushibar.action("sushibar_rememberpharmacist")};sushibar.prototype.startProduction=function(a){sushibar.action("sushibar_startproduction",{slot:sushibar.productionSlot,pid:a})};sushibar.prototype.speedupProduction=function(b,a){sushibar.action("sushibar_speedupproduction",{slot:b,coins:a})};sushibar.prototype.harvestProduction=function(b,a){sushibar.action("sushibar_harvestproduction",{slot:b,position:a})};sushibar.prototype.buyProductionSlot=function(a){sushibar.action("sushibar_buyproductionslot",{slot:a})};sushibar.prototype.buyAddLevel=function(){sushibar.action("sushibar_buy_add_level")};sushibar.prototype.addLevel=function(){sushibar.action("sushibar_add_level",{amount:$("sushibar_dialog_leveladd_insert").value})};sushibar.prototype.init=function(){sushibar.action("sushibar_init")};sushibar.prototype.action=function(a,b){ajaxAction("farm",a,b,sushibar.response)};sushibar.prototype.response=function(h,c,b){if(in_array(c,["sushibar_rememberpharmacist","sushibar_settutorial"])){return 1}if(in_array(c,["sushibar_speedupproduction"])){global_speedup_block=0}if(in_array(c,["sushibar_init"])){sushibar.currentView="bar";if($("sushibar_view")){$("sushibar_view").innerHTML=""}if(sushibar.data&&sushibar.data.data&&sushibar.data.data.tick){sushibar.runtime=sushibar.data.data.tick}}var d=1;if(in_array(c,["sushibar_checktrain"])){d=0;if(sushibar.currentView=="bar"){var a=[];if(sushibar.old.farmis){for(var l in sushibar.old.farmis){if(sushibar.old.farmis[l].img){a.push(sushibar.old.farmis[l].id)}}}var m=0;var n=0;for(var l in sushibar.data.farmis){if(!sushibar.data.farmis[l].id){continue}if(!in_array(sushibar.data.farmis[l].id,a)){m++}n++}if(n!=a.length||m>0){d=1}if(sushibar.old.train){var e=0;for(var l in sushibar.old.train){if(sushibar.old.train[l].pid&&!sushibar.data.data.train[l].pid){e++}if(!sushibar.old.train[l].pid&&sushibar.data.data.train[l].pid){e++}}if(e>0){d=1}}}}if(d==1){sushibar.build();if(!in_array(c,["sushibar_settrainslot"])){sushibar.currentProduct=0}}if(h.stats){sushibar.stats_cache_delay[sushibar.stats_select]=30;if(!sushibar.stats_cache[sushibar.stats_select]){sushibar.stats_cache[sushibar.stats_select]={}}sushibar.stats_cache[sushibar.stats_select]=h.stats;sushibar.showStats()}if(in_array(c,["sushibar_buyproductionslot","sushibar_startproduction","sushibar_speedupproduction","sushibar_harvestproduction","sushibar_buypharmacist","sushibar_rememberpharmacist"])){sushibar.setView("kitchen")}if(h.reward){sushibar.reward=h.reward;sushibar.showReward()}};sushibar.prototype.build=function(){this.farm=this.data.data.farm;var a='<div id="sushibar_view" class="view bar">';a+='  <div id="sushibar_bar" class="bar"></div>';a+='  <div id="sushibar_kitchen" class="kitchen"></div>';a+="</div>";a+=htmlLevelBar("sushibar");a+=htmlCountBar("sushibar");a+='<div class="stats_link link" onclick="sushibar.stats()" onmouseover="showDiv(\'sushibar_stats_link_tt\')" onmouseout="hideDiv(\'sushibar_stats_link_tt\')">';a+='  <div id="sushibar_stats_link_tt" class="ttbox">'+t_foodcontest_stats_button+"</div>";a+="</div>";a+='<div class="help helpbutton_blue link" onclick="sushibar.help()"></div>';a+='<div class="mini_close link" onclick="mapGo2Location(\'farm\', '+this.farm+');"></div>';$("sushibar_main").innerHTML=a;showDiv("sushibar");this.buildBar();this.buildKitchen();$("sushibar_levelbar_number").innerHTML=this.data.data.level;$("sushibar_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var b=t_reached_maxlevel;hideDiv("sushibar_levelbar_plus")}else{var b=str_replace("%AMOUNT%",this.data.data.level_rest,t_sushibar_level_line);$("sushibar_levelbar_plus").onclick=new Function("sushibar.addLevelCommit()");$("sushibar_levelbar_plus_tt").innerHTML=t_sushibar_leveladd_tt}$("sushibar_levelbar_tt").innerHTML=b;$("sushibar_countbar_inner").innerHTML='<div class="sushibar_points"></div><div>'+formatNumber(this.data.data.count)+"</div><br>";$("sushibar_countbar_plus_tt").innerHTML=t_sushibar_levelitem_buy;$("sushibar_countbar_plus").onclick=new Function("sushibar.buyAddLevelCommit()");this.timerUpdate();this.startTutorial("bar");this.checkTrainInterval=this.data.config.constants.autoupdate};sushibar.prototype.setView=function(a){if(a){this.currentView=a}$("sushibar_view").removeClassName("bar").removeClassName("kitchen").addClassName(this.currentView);this.startTutorial(this.currentView);if(this.data.data.queue&&this.data.data.queue.start&&this.data.data.queue_remain<0&&this.data.data.queue_remember&&this.currentView=="kitchen"){this.buyPharmacistCommit(1)}};sushibar.prototype.addLevelCommit=function(){var b=t_sushibar_dialog_leveladd_head;var a=htmlLevelAddDialog("sushibar");globalcommitbox(b,a,0,0,1);$("sushibar_dialog_leveladd_insert").focus()};sushibar.prototype.addLevelCheck=function(){var a=$("sushibar_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>sushibar.data.data.count){a=sushibar.data.data.count}$("sushibar_dialog_leveladd_insert").value=a};sushibar.prototype.buyAddLevelCommit=function(a){var h=t_sushibar_levelitem_buy;var c=sushibar.data.data.exchangeamount;var n="";var l="";var e=specialbonus.findBonus({key1:"sushibar",key2:"buypoints"});if(e){n=specialbonus.htmlBonusLine(e.buypoints);l="specialbonus_bonus_value";c=Math.ceil(c*(1+e.buypoints))}var b=t_sushibar_levelitem_buy_dialog.replace("%COINS%",sushibar.data.data.exchangecoins).replace("%AMOUNT%",'<span class="'+l+'">'+c+"</span>");if(!a){var d='<div class="link coinsbutton_flex" onclick="sushibar.buyAddLevelCommit(1)" style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}globalcommitbox(h,d,0,0,1)}else{var d='<div style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}var m="sushibar.buyAddLevel()";globalcommitbox(h,d,m)}};sushibar.prototype.buildBar=function(){var a="";a+='<div id="sushibar_train" class="train"></div>';a+='<div id="sushibar_farmis" class="farmis"></div>';a+='<div class="scroller right" onclick="sushibar.setView(\'kitchen\')" onmouseover="showDiv(\'sushibar_view_bar_scroller_tt\')" onmouseout="hideDiv(\'sushibar_view_bar_scroller_tt\')">';a+='  <div id="sushibar_view_bar_scroller_tt" class="ttbox">'+t_sushibar_goto_kitchen+"</div>";a+="</div>";$("sushibar_bar").innerHTML=a;this.buildFarmis();this.buildTrain()};sushibar.prototype.buildFarmis=function(){var a="";for(var b in this.data.config.farmi_slots){a+='<div id="sushibar_farmis_slot'+b+'" class="slot pos'+b+'">';a+='  <div id="sushibar_farmis_slot'+b+'_rent_timer" class="timer rent_timer" onmouseover="showDiv(\'sushibar_farmis_slot'+b+"_rent_timer_tt')\" onmouseout=\"hideDiv('sushibar_farmis_slot"+b+"_rent_timer_tt')\">";a+='    <div id="sushibar_farmis_slot'+b+'_rent_timer_time">'+t_pony_rentresttime.replace(":","")+"</div>";a+='    <div id="sushibar_farmis_slot'+b+'_rent_timer_tt" class="ttbox">'+t_pony_rentresttime.replace(":","")+"</div>";a+="  </div>";a+='  <div id="sushibar_farmis_slot'+b+'_next_farmi" class="next_timer"></div>';if(this.data.data.farmi_slots&&this.data.data.farmi_slots[b]&&this.data.data.farmi_slots[b].farmi){a+='<div id="sushibar_farmis_farmi'+b+'" class="farmi" onclick="sushibar.clickFarmi('+b+')" onmouseover="sushibar.hoverFarmi('+b+', 1)" onmouseout="sushibar.hoverFarmi('+b+', 0)">';a+='  <div id="sushibar_farmis_farmi'+b+'_eat_timer" class="timer eat_timer" onmouseover="showDiv(\'sushibar_farmis_farmi'+b+"_eat_timer_tt')\" onmouseout=\"hideDiv('sushibar_farmis_farmi"+b+"_eat_timer_tt')\">";a+='    <div id="sushibar_farmis_farmi'+b+'_eat_timer_time" style="margin-left:-8px;"></div>';a+='    <div id="sushibar_farmis_farmi'+b+'_eat_timer_speedup" class="link production_slot_speedup" onclick="sushibar.finishEatCommit('+b+')" onmouseover="showDiv(\'sushibar_farmis_farmi'+b+"_eat_timer_speedup_tt')\" onmouseout=\"hideDiv('sushibar_farmis_farmi"+b+"_eat_timer_speedup_tt')\">";a+='      <div id="sushibar_farmis_farmi'+b+'_eat_timer_speedup_tt" class="ttbox">'+t_sushibar_eattime_speedup+"</div>";a+="    </div>";a+='    <div id="sushibar_farmis_farmi'+b+'_eat_timer_tt" class="ttbox">'+t_sushibar_eat_timer+"</div>";a+="  </div>";a+='  <div id="sushibar_farmis_farmi'+b+'_tt" class="ttbox"></div>';a+='  <div id="sushibar_farmis_farmi'+b+'_ready" class="megafield_product_ready"></div>';a+="</div>"}a+='  <div id="sushibar_farmis_slot'+b+'_lock"></div>';a+='  <div id="sushibar_farmis_slot'+b+'_tt" class="ttbox"></div>';a+="</div>"}$("sushibar_farmis").innerHTML=a;for(var b in this.data.config.farmi_slots){this.updateFarmi(b)}};sushibar.prototype.updateFarmi=function(b){var c="";var r="sushibar.buyFarmiSlotCommit("+b+")";var d="";var m="";var e="";if(this.data.data.farmi_slots[b].rent_duration){if(this.data.data.farmi_slots[b].rent_remain>0){}else{this.data.data.farmi_slots[b].block=1}}if(this.data.data.farmi_slots&&this.data.data.farmi_slots[b]&&this.data.data.farmi_slots[b].block){var q="";e="unlocked";if(this.data.config.farmi_slots[b].money>0){var a=formatPrice(this.data.config.farmi_slots[b].money);if(this.data.config.farmi_slots[b].money>user_bar){r="";m="warning"}}if(this.data.config.farmi_slots[b].coins>0){var s=this.data.config.farmi_slots[b].coins;var l="";var h=specialbonus.findBonus({key1:"sushibar",key2:"buysushibarslot"});if(h){q=specialbonus.htmlBonusLine(h.buysushibarslot);l="specialbonus_bonus_value";s=Math.ceil(s*(1-h.buysushibarslot))}var a='<span class="'+l+'">'+s+"&nbsp;"+t_coins+"</span>";if(s>user_coins){r="";m="warning"}}var n=t_sushibar_farmis_slot_buy_desc;if(this.data.config.farmi_slots[b].rent_duration){n=t_sushibar_farmis_slot_rent_desc.replace("%TIME%",formatTime(this.data.config.farmi_slots[b].rent_duration))}d='<div class="'+m+'">'+n.replace("%COST%",a)+"</div>";if(q!=""){d+='<div style="margin-top:5px;">'+q+"</div>"}}else{r=""}if(this.data.config.farmi_slots[b].level&&this.data.config.farmi_slots[b].level>this.data.data.level){e="locked";r="";d+='<div style="margin-top:5px;" class="warning">'+t_sushibar_requires_level.replace("%COUNT%",this.data.config.farmi_slots[b].level)+"</div>"}if(this.data.data.farmi_slots&&this.data.data.farmi_slots[b]&&this.data.data.farmi_slots[b].farmi&&!this.data.data.farmi_slots[b].block){d="";r=""}var q="";if(d!=""){$("sushibar_farmis_slot"+b).onmouseover=new Function("showDiv('sushibar_farmis_slot"+b+"_tt')");$("sushibar_farmis_slot"+b).onmouseout=new Function("hideDiv('sushibar_farmis_slot"+b+"_tt')")}$("sushibar_farmis_slot"+b).onclick=new Function(r);if(in_array(b,[4,5,9,10])){$("sushibar_farmis_slot"+b).addClassName("right")}if(in_array(b,[1,2,3,4,5])){$("sushibar_farmis_slot"+b).addClassName("bottom")}$("sushibar_farmis_slot"+b+"_tt").innerHTML=d;hideDiv("sushibar_farmis_slot"+b+"_lock");if(e!=""){showDiv("sushibar_farmis_slot"+b+"_lock");$("sushibar_farmis_slot"+b+"_lock").className=e}hideDiv("sushibar_farmis_farmi"+b+"_ready");if(this.data.data.farmi_slots[b]&&this.data.data.farmi_slots[b].farmi){var m="idle";if(this.checkFarmiStatus(b)==1){m="ready";showDiv("sushibar_farmis_farmi"+b+"_ready")}$("sushibar_farmis_farmi"+b).className="farmi "+m+" img"+this.data.farmis[b].img}};sushibar.prototype.hoverFarmi=function(n,c){for(var d in this.data.config.farmi_slots){hideDiv("sushibar_farmis_farmi"+d+"_tt")}if(c==1){if(this.data.farmis&&this.data.farmis[n]){var a=this.data.farmis[n];var e="";e+='<div class="categories">';var m=1;for(var b in a.data.need){var h=0;if(a.data.have&&a.data.have[b]){h=a.data.have[b]}var l=a.data.need[b];if(h<l){m=0}e+='<div class="col">';e+='  <div class="category '+b+'"></div>';e+='  <div class="amount">'+h+"/"+l+"</div>";e+="</div>"}$("sushibar_farmis_farmi"+n+"_tt").innerHTML=e;showDiv("sushibar_farmis_farmi"+n+"_tt");$("sushibar_farmis_farmi"+n).addClassName("hover")}}else{hideDiv("sushibar_farmis_farmi"+n+"_tt");$("sushibar_farmis_farmi"+n).removeClassName("hover")}};sushibar.prototype.clickFarmi=function(a){if(!this.checkFarmiStatus(a)){return 1}if(this.data.farmis[a].eat&&this.data.farmis[a].eat.remain>0){return 1}this.finishFarmi(a)};sushibar.prototype.checkFarmiStatus=function(e){var d=this.data.farmis[e];var b=1;for(var c in d.data.need){var a=d.data.need[c];if(!d.data.have||!d.data.have[c]||d.data.have[c]<a){b=0;break}}return b};sushibar.prototype.finishEatCommit=function(h){if(!this.data.farmis[h].eat||this.data.farmis[h].eat.remain<=0){return 1}var d="sushibar.finishEat("+h+")";var e=(Math.ceil(this.data.farmis[h].eat.remain/this.data.config.constants.speedupeat.time)*this.data.config.constants.speedupeat.coins);var b="";if(e>user_coins){d="return 1";b="important"}e=formatNumber(e)+"&nbsp;"+t_coins;var c=t_sushibar_eattime_speedup;var a='<div style="width:350px;">'+t_sushibar_eattime_speedup_body.replace("%COST%",'<span style="font-weight:bold;" class="'+b+'">'+e+"</span>")+"</div>";globalcommitbox(c,a,d);if(b!=""){hideDiv("globalbox_button1")}};sushibar.prototype.buildTrain=function(){var c="";c+='<div class="line"></div>';for(var b in this.data.data.train){var r="sushibar.clickTrainSlot("+b+")";var e="";var d="";if(this.data.data.train[b].pid){d+='<div class="category '+this.data.config.products[this.data.data.train[b].pid].category+'"></div>';d+='<div class="name">'+produkt_name[this.data.data.train[b].pid]+"</div>";d+='<div class="clear"></div>';d+='<div class="sushibar_item'+this.data.data.train[b].pid+'"></div>'}if((this.data.config.train_slots[b].money||this.data.config.train_slots[b].coins)&&!this.data.data.train[b].buy_time){r="sushibar.buyTrainSlotCommit("+b+")";e="unlocked";var n="";var q="";if(this.data.config.train_slots[b].money&&this.data.config.train_slots[b].money>0){if(parseInt(this.data.config.train_slots[b].money)>parseInt(user_bar)){n="important";r=""}var a=formatPrice(this.data.config.train_slots[b].money)}if(this.data.config.train_slots[b].coins&&this.data.config.train_slots[b].coins>0){var s=this.data.config.train_slots[b].coins;var m="";if(parseInt(s)>parseInt(user_coins)){n="important";r=""}var h=specialbonus.findBonus({key1:"sushibar",key2:"buytrainslot"});if(h){q=specialbonus.htmlBonusLine(h.buytrainslot);m="specialbonus_bonus_value";s=Math.ceil(s*(1-h.buytrainslot))}var a='<span class="'+m+'">'+s+"&nbsp;"+t_coins+"</span>"}d+='<div class="'+n+'">'+t_sushibar_buy_trainslot_desc.replace("%COST%",a)+"</div>";if(q!=""){d+='<div style="text-align:left; margin-top:5px;">'+q+"</div>"}}if(this.data.config.train_slots[b].level&&this.data.data.level<this.data.config.train_slots[b].level){r="";e="locked";d+='<div class="warning" style="margin-top:10px;">'+t_sushibar_requires_level.replace("%COUNT%",this.data.config.train_slots[b].level)+"</div>"}c+='<div id="sushibar_train_slot'+b+'" class="slot link" onclick="'+r+'" onmouseover="sushibar.hoverTrainSlot('+b+', 1)" onmouseout="sushibar.hoverTrainSlot('+b+', 0)">';c+='  <div id="sushibar_train_slot'+b+'_item" class="item">';if(this.data.data.train[b].pid){c+='<div id="sushibar_train_slot'+b+'_item_pid" class="topview pid product'+this.data.data.train[b].pid+'" onclick="sushibar.clearTrainSlotCommit('+b+')"></div>'}c+="  </div>";c+='  <div id="sushibar_train_slot'+b+'_preview" class="preview"></div>';if(e!=""){c+='<div id="sushibar_train_slot'+b+'_locked" class="'+e+'"></div>'}c+='  <div id="sushibar_train_slot'+b+'_tt" class="ttbox">'+d+"</div>";c+="</div>"}$("sushibar_train").innerHTML=c;for(var b in this.data.data.train){var l=this.data.data.train[b].pos;$("sushibar_train_slot"+b).className="slot move pos"+l}setTimeout(function(){sushibar.moveTrain(1)},100)};sushibar.prototype.moveTrain=function(c){var n=36;for(var e in this.data.data.train){var r="move";if(c>0){this.data.data.train[e].pos++;if(this.data.data.train[e].pos>n){if(this.data.data.train[e].pos>n){this.data.data.train[e].pos=1}r=""}}var m=this.data.data.train[e].pos;if($("sushibar_train_slot"+e)){$("sushibar_train_slot"+e).className="slot "+r+" pos"+m}if(this.data.data.train[e].pid&&this.data.config.slot_farmi_match[m]){var l=this.data.data.train[e].pid;var a=this.data.config.slot_farmi_match[m];var h=0;if(this.data.config.farmi_slots[a].rent_duration&&this.data.data.farmi_slots[a].buy_time&&this.data.data.farmi_slots[a].rent_remain<=0){h=1}if(this.data.farmis[a]&&this.checkFarmiCart(this.data.farmis[a],l)==1&&!h){delete this.data.data.train[e].pid;if($("sushibar_train_slot"+e+"_item_pid")){$("sushibar_train_slot"+e+"_item_pid").addClassName("fadeout")}this.cleanupTrailSlot(e);var b=this.data.config.products[l].category;var q=this.data.config.products[l].eattime;if(!this.data.farmis[a].data.have){this.data.farmis[a].data.have={}}if(!this.data.farmis[a].data.have[b]){this.data.farmis[a].data.have[b]=0}this.data.farmis[a].data.have[b]++;var d={pid:l};if(!this.data.farmis[a].log){this.data.farmis[a].log=[]}this.data.farmis[a].log.push(d);this.data.farmis[a].eat={start:1,pid:l,duration:q,remain:q}}}}};sushibar.prototype.cleanupTrailSlot=function(a){setTimeout(function(){if($("sushibar_train_slot"+a+"_item")){$("sushibar_train_slot"+a+"_item").innerHTML=""}},250)};sushibar.prototype.checkFarmiCart=function(h,b){var e=this.data.config.products[b].category;var d=1;for(var a in h.data.need){var c=h.data.need[a];if(h.eat&&h.eat.remain>0){return 3}if(!h.data.have||!h.data.have[a]||h.data.have[a]<c){d=0;if(a!=e){continue}return 1}}if(d==1){return 2}return 0};sushibar.prototype.hoverTrainSlot=function(c,b){if(b==1){showDiv("sushibar_train_slot"+c+"_tt");if(in_array(this.data.data.train[c].pos,[1,2,3,4,5,6,31,32,33,34,35,36])){$("sushibar_train_slot"+c+"_tt").addClassName("right")}if(!this.currentProduct&&!this.data.data.train[c].pid&&!$("sushibar_train_slot"+c+"_locked")){$("sushibar_train_slot"+c+"_tt").innerHTML=t_sushibar_trainslot_empty}if($("sushibar_train_slot"+c+"_item_pid")){$("sushibar_train_slot"+c+"_item_pid").addClassName("active")}if(!this.currentProduct||this.data.data.train[c].pid||$("sushibar_train_slot"+c+"_locked")){return 1}$("sushibar_train_slot"+c+"_tt").innerHTML=t_sushibar_trainslot_insert;var a="product"+this.currentProduct+" topview";if(produkt_category[this.currentProduct]!="sushi"){a="forbidden";$("sushibar_train_slot"+c+"_tt").innerHTML=t_sushibar_trainslot_invalid}$("sushibar_train_slot"+c+"_preview").addClassName(a)}else{hideDiv("sushibar_train_slot"+c+"_tt");$("sushibar_train_slot"+c+"_tt").removeClassName("right");$("sushibar_train_slot"+c+"_preview").removeClassName("product"+this.currentProduct).removeClassName("forbidden");if($("sushibar_train_slot"+c+"_item_pid")){$("sushibar_train_slot"+c+"_item_pid").removeClassName("active")}}};sushibar.prototype.clickTrainSlot=function(a){if(!this.currentProduct||this.data.data.train[a].pid||produkt_category[this.currentProduct]!="sushi"){return 1}this.setTrainSlot(a,this.currentProduct)};sushibar.prototype.clickRackItem=function(a){this.currentProduct=a};sushibar.prototype.buyTrainSlotCommit=function(m){if(this.data.config.train_slots[m].money&&this.data.config.train_slots[m].money>0){var l=formatPrice(this.data.config.train_slots[m].money)}if(this.data.config.train_slots[m].coins&&this.data.config.train_slots[m].coins>0){var b=this.data.config.train_slots[m].coins;var h="";var c="";var d=specialbonus.findBonus({key1:"sushibar",key2:"buytrainslot"});if(d){h=specialbonus.htmlBonusLine(d.buytrainslot);c="specialbonus_bonus_value";b=Math.ceil(b*(1-d.buytrainslot))}var l='<span class="'+c+'">'+b+"&nbsp;"+t_coins+"</span>"}var a=t_sushibar_buy_trainslot_desc.replace("%COST%",l);if(h!=""){a+='<div style="margin-top:5px;">'+h+"</div>"}var e="sushibar.buyTrainSlot("+m+")";globalcommitbox(t_sushibar_buy_trainslot_head,a,e)};sushibar.prototype.buyFarmiSlotCommit=function(e){var n="";if(this.data.config.farmi_slots[e].money){var a=formatPrice(this.data.config.farmi_slots[e].money)}if(this.data.config.farmi_slots[e].coins){var q=this.data.config.farmi_slots[e].coins;var h="";var c=specialbonus.findBonus({key1:"sushibar",key2:"buysushibarslot"});if(c){n=specialbonus.htmlBonusLine(c.buysushibarslot);h="specialbonus_bonus_value";q=Math.ceil(q*(1-c.buysushibarslot))}var a='<span class="'+h+'">'+q+"&nbsp;"+t_coins+"</span>"}var d=t_sushibar_farmis_slot_buy_head;if(this.data.config.farmi_slots[e].rent_duration){d=t_sushibar_farmis_slot_rent_head}var l=t_sushibar_farmis_slot_buy_desc;if(this.data.config.farmi_slots[e].rent_duration){l=t_sushibar_farmis_slot_rent_desc}var b='<div style="width:350px;">'+l.replace("%COST%","<b>"+a+"</b>")+"</div>";if(this.data.config.farmi_slots[e].rent_duration){b=b.replace("%TIME%",formatTime(this.data.config.farmi_slots[e].rent_duration))}if(n!=""){b+='<div style="margin-top:5px;">'+n+"</div>"}var m="sushibar.buyFarmiSlot("+e+")";globalcommitbox(d,b,m)};sushibar.prototype.clearTrainSlotCommit=function(e){var b=this.data.data.train[e].pid;var c=t_sushibar_clear_trainslot_head;var a='<div style="width:300px;">'+t_sushibar_clear_trainslot_desc.replace("%NAME%","<b>"+produkt_name[b]+"</b>")+"</div>";var d="sushibar.clearTrainSlot("+e+")";globalcommitbox(c,a,d)};sushibar.prototype.buildKitchen=function(){var a="";a+='<div class="trainani"></div>';a+='<div id="sushibar_pharmacist" class="link" onmouseover="showDiv(\'sushibar_pharmacist_tt\')" onmouseout="hideDiv(\'sushibar_pharmacist_tt\')">';a+='  <div id="sushibar_pharmacist_timer"></div>';a+='  <div id="sushibar_pharmacist_tt" class="ttbox">';a+="    <div>"+t_sushibar_pharmacist_buy_head+'</div><div class="bonusinfo">'+t_sushibar_pharmacist_info+"</div>";a+="  </div>";a+='  <div class="sushibar_pharmacist"></div>';a+='  <div id="sushibar_pharmacist_unlocked" class="unlocked"></div>';a+="</div>";a+='<div id="sushibar_slots" class="slots">';for(var b=1;b<=4;b++){a+=production.buildSlot("sushibar",b)}a+='  <div class="clear"></div>';a+="</div>";a+='<div class="scroller left" onclick="sushibar.setView(\'bar\')" onmouseover="showDiv(\'sushibar_view_kitchen_scroller_tt\')" onmouseout="hideDiv(\'sushibar_view_kitchen_scroller_tt\')">';a+='  <div id="sushibar_view_kitchen_scroller_tt" class="ttbox">'+t_sushibar_goto_bar+"</div>";a+="</div>";$("sushibar_kitchen").innerHTML=a};sushibar.prototype.updateProductionSlot=function(b,a){production.updateSlot("sushibar",b,a,this.data)};sushibar.prototype.buyProductionSlotCommit=function(a){production.buySlotCommit("sushibar",a,this.data.data.slots[a])};sushibar.prototype.getCurrentProductionPosition=function(a){return production.currentQueueSlot("sushibar",a)};sushibar.prototype.buyPharmacistCommit=function(a){production.buyQueueCommit("sushibar",a)};sushibar.prototype.setProductionSelectionFilter=function(a){this.productionSelectionFilter=a;this.productionSelectionPage=1;this.productionSelection()};sushibar.prototype.productionSelection=function(c){if(!c){c=this.productionSlot}else{this.productionSlot=c}var D=this.data.config.products;var A=((this.productionSelectionPage-1)*this.productionSelectionItemsPerPage)+1;var b=(this.productionSelectionPage*this.productionSelectionItemsPerPage);var l=0;var n='<div id="sushibar_production_selection">';var E=[];for(var t in D){D[t].pid=t;E.push(D[t])}E.sort(function(G,r){return G.level-r.level});var q=[];for(var u=0;u<E.length;u++){var z=E[u].category;if(!in_array(z,q)){q.push(z)}}q.push("none");n+='<div class="filters">';for(var B=0;B<q.length;B++){var e="";if(this.productionSelectionFilter==q[B]){e="active"}n+='<div class="filter link '+e+'" onclick="sushibar.setProductionSelectionFilter(\''+q[B]+"')\" onmouseover=\"showDiv('sushibar_production_selection_filter_"+q[B]+"_tt')\" onmouseout=\"hideDiv('sushibar_production_selection_filter_"+q[B]+"_tt')\">";n+='  <div class="img category '+q[B]+'"></div>';n+='  <div id="sushibar_production_selection_filter_'+q[B]+'_tt" class="ttbox">'+t_sushibar_production_selection_filter[q[B]]+"</div>";n+="</div>"}n+="</div>";var m=0;if(specialbonus){m=specialbonus.findBonus({key1:"sushibar",key2:"harvest"})}var d="";for(var u=0;u<E.length;u++){var t=E[u].pid;if(this.productionSelectionFilter!="none"&&this.productionSelectionFilter!=this.data.config.products[t].category){continue}l++;if(l>=A&&l<=b){var v=0;var w="sushibar.productionSelectionCommit("+t+")";if(this.data.config.products[t].level&&this.data.config.products[t].level>this.data.data.level){w="";v=1}if(this.data.config.products[t].needs){for(var B in this.data.config.products[t].needs){var h=checkRackItem(B,this.farm);if(this.data.config.products[t].needs[B]>h){w=""}var z=produkt_category[B];if(map_transfer_rest[this.farm]&&map_transfer_rest[this.farm][z]&&(h-this.data.config.products[t].needs[B])<map_transfer_rest[this.farm][z]){w=""}}}var F="";var C="";if(this.data.config.products[t].money&&this.data.config.products[t].money>0){if(this.data.config.products[t].money>user_bar){F="important";w=""}C=formatPrice(this.data.config.products[t].money)}if(this.data.config.products[t].coins&&this.data.config.products[t].coins>0){if(this.data.config.products[t].coins>user_coins){F="important";w=""}C=this.data.config.products[t].coins+"&nbsp;"+t_coins}n+='<div class="slot" onclick="'+w+'">';n+='  <div class="category '+this.data.config.products[t].category+'"></div>';n+='  <div class="img tt'+t+'"></div>';n+='  <div class="info">';var h=this.data.config.products[t].amount;var s="";var e="";if(m&&m.harvest){h+=m.harvest;s='<div style="color:green; font-weight:normal;">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+m.harvest)+")</div>";e="specialbonus"}n+='    <div class="name line '+e+'">'+h+"x "+produkt_name[t]+s+"</div>";if(v){n+='<div class="important">'+t_sushibar_requires_level.replace("%COUNT%",this.data.config.products[t].level)+"</div>"}else{n+='<div class="points line">'+t_points+": "+this.data.config.products[t].points+"</div>";n+='<div class="eattime line">'+t_sushibar_eattime+" "+formatTime(this.data.config.products[t].eattime)+"</div>"}n+="  </div>";if(!v){var a=this.data.config.products[t].duration;n+='<div class="needs">';n+='  <div class="intro">'+t_needs+":</div>";n+='  <div class="intro_block">';n+="     <div>"+formatTime(a)+" "+s+"</div>";n+='     <div class="cost '+F+'">'+C+"</div>";n+="  </div>";n+='  <div class="clear"></div>';for(var B in this.data.config.products[t].needs){var h=checkRackItem(B,this.farm);var e="";var s="";if(this.data.config.products[t].needs[B]>h){e="important"}var z=produkt_category[B];if(map_transfer_rest[this.farm]&&map_transfer_rest[this.farm][z]){s="*";d=s+"&nbsp;"+t_farmtransfer_rest_warning2.replace("%COUNT%",map_transfer_rest[this.farm][z]);if((h-this.data.config.products[t].needs[B])<map_transfer_rest[this.farm][z]){e="important"}}n+='<div class="product '+e+'" onmouseover="showDiv(\'sushibar_productionselection_pid'+t+"_"+B+"')\" onmouseout=\"hideDiv('sushibar_productionselection_pid"+t+"_"+B+"')\">";n+='  <div class="l'+B+'" style="border-radius:5px;"></div>';n+='  <div style="font-weight:bold;">'+this.data.config.products[t].needs[B]+"x"+s+"</div>";n+='  <div id="sushibar_productionselection_pid'+t+"_"+B+'" class="ttbox">'+produkt_name[B]+"</div>";n+="</div>"}n+='    <div class="clear"></div>';n+="  </div>"}if(v){n+='<div class="locked"></div>'}n+="</div>"}}n+='  <div class="clear"></div>';n+='  <div id="sushibar_production_selection_navi_up" onclick="sushibar.productionSelectionNavi(-1, '+l+')"></div>';n+='  <div id="sushibar_production_selection_navi_down" onclick="sushibar.productionSelectionNavi(1, '+l+')"></div>';if(d!=""){n+='<div style="font-style:italic; margin-top:0px; text-align:left;">'+d+"</div>"}n+="</div>";globalBoxFlex(t_choose_to_produce,n,0,0,1);$("globalbox").style.top="40px";this.productionSelectionNavi(0,l);if(d!=""){$("sushibar_production_selection").addClassName("restinfo")}};sushibar.prototype.productionSelectionNavi=function(b,c){var a=parseInt(Math.ceil(c/this.productionSelectionItemsPerPage));this.productionSelectionPage+=b;if(this.productionSelectionPage<1){this.productionSelectionPage=1}if(this.productionSelectionPage>a){this.productionSelectionPage=a}if(b){this.productionSelection()}hideDiv("sushibar_production_selection_navi_up");hideDiv("sushibar_production_selection_navi_down");if(this.productionSelectionPage>1){showDiv("sushibar_production_selection_navi_up")}if(this.productionSelectionPage<a){showDiv("sushibar_production_selection_navi_down")}};sushibar.prototype.productionSelectionCommit=function(b){var d="sushibar.startProduction("+b+")";var c="sushibar.productionSelection()";var a='<div id="sushibar_production_selection_commit">';a+='  <div class="img tt'+b+'"></div>';a+='  <div class="name">'+produkt_name[b]+"</div>";if(this.data.config.products[b].money&&this.data.config.products[b].money>0){var e=formatPrice(this.data.config.products[b].money)}if(this.data.config.products[b].coins&&this.data.config.products[b].coins>0){var e=this.data.config.products[b].coins+"&nbsp;"+t_coins}a+="  <div>"+cityadcost+e+"</div>";a+="</div>";globalcommitbox(t_start_production,a,d,c)};sushibar.prototype.showReward=function(){var d=t_sushibar_harvest_reward_head;var c='<div id="sushibar_reward">';c+='  <div class="reward">';c+='    <div class="desc">'+t_sushibar_harvest_reward_body+"</div>";if(this.reward.points){c+="<div>"+formatNumber(this.reward.points)+"&nbsp;"+t_points+"</div>"}if(this.reward.money){c+="<div>"+formatPrice(this.reward.money)+"</div>"}if(this.reward.sushibar_points){c+="<div>"+formatNumber(this.reward.sushibar_points)+"&nbsp;"+t_sushibar_points+"</div>"}c+="  </div>";c+='  <div class="desc">'+t_sushibar_harvest_reward_served+"</div>";c+='  <div class="list">';if(this.reward.log){for(var b=0;b<this.reward.log.length;b++){var a=this.reward.log[b].pid;var e=this.data.config.products[a].category;c+='<div class="line">';c+='  <div class="category '+e+'"></div>';c+='  <div class="name">'+produkt_name[a]+"</div>";c+="</div>"}}c+="  </div>";c+="  <div class=\"button_yes link\" onclick=\"hideDiv('globaltransp'); hideDiv('globalbox')\"></div>";c+="</div>";globalBoxFlex(d,c)};sushibar.prototype.startTutorial=function(a){if(this.data.data.tutorial&&this.data.data.tutorial[a]){return 1}this.tutorialType=a;this.tutorialStep=1;sushibar.showTutorial(1);sushibar.setTutorialVisited()};sushibar.prototype.nextTutorialStep=function(){this.tutorialStep++;this.showTutorial()};sushibar.prototype.setTutorialVisited=function(){if(this.data.data.tutorial&&this.data.data.tutorial[this.tutorialType]){return 1}this.setTutorial()};sushibar.prototype.showTutorial=function(n){var l=this.tutorialType+"_"+this.tutorialStep;if(!t_sushibar_tutorial_text[l]){this.closeTutorial();return 1}var e=[];for(var b in this.data.config.products){var a=this.data.config.products[b].category;if(!in_array(a,e)){e.push(a)}}var m=t_sushibar_tutorial_text[l];m=m.replace("%PLAYERNAME%","<b>"+username+"</b>");m=m.replace("%CATEGORYCOUNT%",e.length);var d=0;if(t_sushibar_tutorial_text[this.tutorialType+"_"+(this.tutorialStep+1)]){d=1}var h="on";if(n==1){h="off"}var c="";c+='<div class="textt">'+m+"</div>";if(d==1){c+='<div class="next button_new link" onclick="sushibar.nextTutorialStep()">'+t_continue+"</div>"}else{c+='<div class="button_yes link" onclick="sushibar.closeTutorial()"></div>'}$("sushibar_tutorial_bubble").innerHTML=c;showDiv("sushibar_tutorial");if(n==1){setTimeout(function(){if($("sushibar_tutorial_char")){$("sushibar_tutorial_char").className="char "+sushibar.tutorialType}},200)}};sushibar.prototype.closeTutorial=function(){if(!$("sushibar_tutorial")){return 1}if($("sushibar_tutorial_char")){$("sushibar_tutorial_char").removeClassName("on").addClassName("off")}setTimeout(function(){hideDiv("sushibar_tutorial")},200)};sushibar.prototype.showStats=function(){var a='<div id="sushibar_stats">';a+='  <div class="select_line">';a+='    <select id="sushibar_stats_select" onchange="sushibar.stats()">';for(var b=0;b<this.stats_options.length;b++){if(this.stats_options[b]==""){a+='<option value="0">---</option>';continue}var c="";if(this.stats_select==this.stats_options[b]){c="selected"}a+='<option value="'+this.stats_options[b]+'" '+c+">"+t_sushibar_stats[this.stats_options[b]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_sushibar_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select],this.stats_select,"sushibar");a+="</div>";globalBoxFlex("",a,0,0,1)};sushibar.prototype.help=function(){showDiv("sushibar_help");if(this.data.achievements){for(var a=0;a<this.data.achievements.length;a++){showDiv("sushibar_help_achievement_"+this.data.achievements[a]+"_ready")}}};sushibar.prototype.helpNavi=function(c){var b=2;if(!this.data.config.achievements){b=1}for(var a=1;a<=b;a++){$("sushibar_help_navi_tab"+a).removeClassName("active");hideDiv("sushibar_help_page"+a)}$("sushibar_help_navi_tab"+c).addClassName("active");showDiv("sushibar_help_page"+c)};sushibar.prototype.helpClose=function(){hideDiv("sushibar_help")};sushibar.prototype.timer=function(){this.runtime++;if(this.runtime%this.checkTrainInterval==0&&$("sushibar")&&$("sushibar").style.display=="block"&&!this.checkTrainBlock){this.checkTrain();this.checkTrainBlock=1}if(this.runtime%this.checkTrainInterval!=0){this.checkTrainBlock=0}if(this.data&&this.data.data){if(this.data.data.queue_remain){this.data.data.queue_remain--}if($("sushibar")){for(var c=1;c<=4;c++){var b=this.getCurrentProductionPosition(c);this.updateProductionSlot(c,b)}}for(var a in this.data.data.farmi_slots){if(this.data.data.farmi_slots[a].rent_duration){this.data.data.farmi_slots[a].rent_remain--}if(this.data.data.farmi_slots[a].lastfarmi){this.data.data.farmi_slots[a].lastfarmi_remain--}}if(this.data.farmis){for(var a in this.data.farmis){if(this.data.farmis[a].eat){this.data.farmis[a].eat.remain--}}}this.data.data.tick++;this.moveTrain(1)}for(var a in this.stats_cache_delay){this.stats_cache_delay[a]--}this.timerUpdate()};sushibar.prototype.timerUpdate=function(){production.buildOuterProductionLine("sushibar");production.updateQueue("sushibar");for(var c=1;c<=4;c++){if($("sushibar_pharmacist_slots"+c)){$("sushibar_pharmacist_slots"+c).removeClassName("right")}var b=this.getCurrentProductionPosition(c);if(this.data&&this.data.production&&this.data.production[c]){this.data.production[c]["gone"]++;if(this.data.production[c][b]){this.data.production[c][b].remain--}}if(this.data&&this.data.data&&this.data.data.slots&&this.data.data.slots[c]&&this.data.data.slots[c].rent_remain){this.data.data.slots[c].rent_remain--;if(!this.data.data.slots[c].rent_remain){this.data.data.slots[c].rent_remain--}if(this.data.data.slots[c].rent_remain>0&&$("sushibar_pharmacist_slots"+c)){$("sushibar_pharmacist_slots"+c).addClassName("right")}}}for(var a in this.data.data.farmi_slots){if($("sushibar_farmis_slot"+a+"_rent_timer")){hideDiv("sushibar_farmis_slot"+a+"_rent_timer");if(this.data.data.farmi_slots[a].rent_remain&&this.data.data.farmi_slots[a].rent_remain>0){showDiv("sushibar_farmis_slot"+a+"_rent_timer");$("sushibar_farmis_slot"+a+"_rent_timer_time").innerHTML=formatTime(this.data.data.farmi_slots[a].rent_remain)}else{if(this.data.data.farmi_slots[a].rent_remain==0){this.updateFarmi(a)}}}if($("sushibar_farmis_slot"+a+"_next_farmi")&&this.data.data.farmi_slots[a].lastfarmi){hideDiv("sushibar_farmis_slot"+a+"_next_farmi");if(this.data.data.farmi_slots[a].lastfarmi_remain>0){$("sushibar_farmis_slot"+a+"_next_farmi").innerHTML=formatTime(this.data.data.farmi_slots[a].lastfarmi_remain);showDiv("sushibar_farmis_slot"+a+"_next_farmi")}}}if(this.data.farmis){for(var a in this.data.farmis){if(!$("sushibar_farmis_farmi"+a+"_eat_timer")){continue}hideDiv("sushibar_farmis_farmi"+a+"_eat_timer");hideDiv("sushibar_farmis_farmi"+a+"_eat_timer_speedup");hideDiv("sushibar_farmis_farmi"+a+"_ready");$("sushibar_farmis_farmi"+a).addClassName("idle").removeClassName("eat").removeClassName("ready");if(this.data.farmis[a].eat&&this.data.farmis[a].eat.remain>0){showDiv("sushibar_farmis_farmi"+a+"_eat_timer");showDiv("sushibar_farmis_farmi"+a+"_eat_timer_speedup");$("sushibar_farmis_farmi"+a+"_eat_timer_time").innerHTML=formatTime(this.data.farmis[a].eat.remain);$("sushibar_farmis_farmi"+a).removeClassName("idle").addClassName("eat")}else{if(this.checkFarmiStatus(a)==1){$("sushibar_farmis_farmi"+a).removeClassName("idle").addClassName("ready");showDiv("sushibar_farmis_farmi"+a+"_ready")}}}}};sushibar.prototype.sortProductsAppear=function(e){var b=[];var c=[];for(var a in e){if(produkt_category[a]=="water"){b.push({pid:a,level:produkt_quests[5][a]})}if(sushibar_config_helper_products&&produkt_category[a]=="sushi"){c.push({pid:a,level:sushibar_config_helper_products[a].level})}}b=b.sort(function(l,h){return l.level-h.level});c=c.sort(function(l,h){return l.level-h.level});e={};if(b&&b.length){for(var d=0;d<b.length;d++){e["a_"+b[d].pid]=1}}if(c&&c.length){for(var d=0;d<c.length;d++){e["a_"+c[d].pid]=1}}return e};document.addEventListener("visibilitychange",function(){if(document.hidden==false&&$("sushibar")&&$("sushibar").style.display=="block"){sushibar.buildTrain()}});var teaser=function(){this.data={};this.key={}};teaser.prototype.ignore=function(){teaser.action("teaser_ignore",{key:this.key})};teaser.prototype.action=function(a,b){ajaxAction("main",a,b,teaser.response)};teaser.prototype.response=function(b,a,c){teaser.data=b;teaser.build()};teaser.prototype.build=function(){showDiv("teaser_links");$$("#teaser_links .item").each(function(b){hideDiv(b.id)});for(var a in this.data){showDiv("teaser_link_"+a)}};teaser.prototype.show=function(a){this.key=a;if(!$("teaser_box_bubbles_"+this.key)){return 1}showDiv("teaser_box");$("teaser_box").className=this.key;$$("#teaser_box .bubbles").each(function(b){hideDiv(b.id)});showDiv("teaser_box_bubbles_"+this.key)};teaser.prototype.hide=function(){if($("teaser_box_ignore_checkbox").checked==true){this.ignore()}hideDiv("teaser_box")};var teaser=new teaser();var tilegame=function(){this.data={};this.line=[];this.tilesX=3};tilegame.prototype.init=function(){tilegame.action("tilegame_init")};tilegame.prototype.action=function(a,b){ajaxAction("farm",a,b,tilegame.response)};tilegame.prototype.response=function(b,a,c){tilegame.data=b;tilegame.build()};tilegame.prototype.build=function(){var a="";a+='<div class="head">'+t_tilegame_name+"</div>";a+='<div class="desc">'+t_tilegame_desc+"</div>";a+='<div id="tilegame_game" class="game"></div>';a+='<div class="helpbutton_blue link" onclick="tilegame.help();"></div>';a+='<div class="mini_close link" onclick="tilegame.close();"></div>';$("tilegame_inner").innerHTML=a;showDiv("tilegame");$("tilegame_inner").addClassName("bounce");this.buildGame();setTimer("tilegame");this.timerUpdate()};tilegame.prototype.buildGame=function(){var h=this.tilesX;var c="";c+='<div class="transp"></div>';for(var b=1;b<=3;b++){c+='<div class="layer layer'+b+'">';c+='  <div class="tiles">';for(var e=1;e<=(h*h);e++){var a=this.iscovered(b,e);var d="";if(this.data.data.layout[b]&&this.data.data.layout[b][e]){d="tilegame.clickTile("+b+", "+e+")"}c+='<div class="tile tile'+b+"_"+e+'" onclick="'+d+'">';if(d!=""){c+='<div class="img img'+this.data.data.layout[b][e]+'"></div>';if(b>1&&!a){c+='<div class="transp"></div>'}}c+="</div>"}c+='    <div class="clear"></div>';c+="  </div>";c+="</div>";h++}c+='<div id="tilegame_line" class="line"></div>';$("tilegame_game").innerHTML=c;this.buildLine()};tilegame.prototype.buildLine=function(){var b="";for(var a=1;a<=6;a++){b+='<div class="tile">';if(this.line[(a-1)]){b+='<div class="img img'+this.line[(a-1)].img+'"></div>'}b+="</div>"}b+="</div>";$("tilegame_line").innerHTML=b};tilegame.prototype.clickTile=function(c,d){var b={layer:c,tile:d,img:this.data.data.layout[c][d]};this.line.push(b);delete this.data.data.layout[c][d];this.buildGame()};tilegame.prototype.iscovered=function(b,d){if(b==1||!(this.data.data.layout[b]&&this.data.data.layout[b][d])){return 0}var c=(this.tilesX+(b-2));console.log("iscovered layer",b,"tile",d,"length",c);var a=[]};tilegame.prototype.help=function(){};tilegame.prototype.timer=function(){};tilegame.prototype.timerUpdate=function(){};tilegame.prototype.close=function(){hideDiv("tilegame")};var timeline=function(){this.data={};this.startYear=2009;this.startMonth=10;this.countMonths=202;this.registerYear=0;this.registerMonth=0};timeline.prototype.open=function(){var b=t_timeline_name;var a="";a+='<div id="timeline">';a+='  <div class="desc">'+t_timeline_desc+"</div>";a+='  <div class="fix">';a+='    <div id="timeline_line" class="line"></div>';a+="  </div>";a+='  <div class="capsule"></div>';a+="</div>";globalBoxFlex(b,a,0,0,1);this.build();$("globalbox").style.top="50px"};timeline.prototype.build=function(){var e=0;var b={};for(var c in this.data){if(!b[this.data[c].year]){b[this.data[c].year]={}}b[this.data[c].year][this.data[c].month]=this.data[c];e++}var n=1;var l=this.startYear;var h=this.startMonth;var d="";for(var c=this.startMonth;c<=this.countMonths;c++){var q="";if(h==1){l++;q="year"}var a=0;if((n==1||n==e)&&b[l]&&b[l][h]){a=1}var r="";if(this.registerYear==l&&this.registerMonth==h){var m="";if(n%2!=0){m="down"}if(a==1){m="down main"}if(h==1){m+=" year"}r+='<div class="you '+m+'" onmouseover="showDiv(\'timeline_you_tt\')" onmouseout="hideDiv(\'timeline_you_tt\')">';r+="  <div>"+t_you.toUpperCase()+"</div>";r+='  <div id="timeline_you_tt" class="info ttbox">'+t_timeline_register.replace("%DATE%",this.registerDate)+"</div>";r+="</div>"}if(a==1){d+='<div class="highlight">';d+='  <div class="hyear">'+l+"</div>";d+='  <div class="hmonth">'+t_months[h]+"</div>";d+='  <div class="hinfo">'+b[l][h].info+"</div>";d+='<div class="star star_five2"></div>';d+=r;d+="</div>";n++}else{if(h!=1&&b[l]&&b[l][h]&&b[l][h].star){q+=" empty"}d+='<div class="section '+q+'">';if(h==1){m="";if(b[l]&&b[l][h]&&b[l][h].star&&n%2!=0){m="down"}d+='<div class="count '+m+'">'+l+"</div>"}if(b[l]&&b[l][h]){if(n%2==0){q=" down"}if(b[l][h].star){d+='<div class="star star_five2 '+q+'"></div>'}d+='<div class="pointer '+q+'">';d+='  <div id="timeline_section_bubble'+l+"_"+h+'" class="bubble update'+n+'" onmouseover="whyWhyShowBubble('+l+", "+h+')" onmouseout="whyWhyHideBubble('+l+", "+h+')"></div>';d+='  <div id="timeline_section_info'+l+"_"+h+'" class="info ttbox">'+b[l][h].info+"</div>";d+="</div>";n++}d+=r;d+="</div>"}h=(c%12)+1}d+='<div class="clear"></div>';$("timeline_line").innerHTML=d};timeline.prototype.showBubble=function(b,a){if(!$("timeline_section_bubble"+b+"_"+a)){return 1}$("timeline_section_bubble"+b+"_"+a).addClassName("full");showDiv("timeline_section_info"+b+"_"+a)};timeline.prototype.hideBubble=function(b,a){if(!$("timeline_section_bubble"+b+"_"+a)){return 1}$("timeline_section_bubble"+b+"_"+a).removeClassName("full");hideDiv("timeline_section_info"+b+"_"+a)};function whyWhyOpen(){timeline.open()}function whyWhyShowBubble(b,a){timeline.showBubble(b,a)}function whyWhyHideBubble(b,a){timeline.hideBubble(b,a)}var tinkergame=function(){this.data={};this.finderData={};this.partyClick=0;this.farmhouseBonus={}};tinkergame.prototype.exchangePrize=function(a){tinkergame.action("tinkergame_exchangeprize",{prize:a})};tinkergame.prototype.buyItem=function(b,a){tinkergame.action("tinkergame_buyitem",{item:b,coins:a})};tinkergame.prototype.init=function(){tinkergame.action("tinkergame_init")};tinkergame.prototype.action=function(a,b){ajaxAction("farm",a,b,tinkergame.response)};tinkergame.prototype.response=function(d,c,h){var e={};if(tinkergame.data.data&&tinkergame.data.data.items){var e=tinkergame.data.data.items}tinkergame.data=d;tinkergame.open();if(tinkergame.data.reward&&tinkergame.data.reward.products){var b='<div style="margin-bottom:5px;">'+t_specialoffer_message+"</div>";for(var a in tinkergame.data.reward.products){amount=tinkergame.data.reward.products[a];b+='<div style="margin-top:5px;">'+htmlProductBody(a,amount)+"</div>"}globalcommitbox(t_tinkergame_exchange_head,b,0,0,1)}};tinkergame.prototype.finder=function(){var a='<div id="tinkergame_finder">';for(var b=0;b<this.finderData.length;b++){a+='<div class="item item'+this.finderData[b].item+'"></div>';a+='<div class="amount">'+this.finderData[b].amount+"x</div>"}a+='  <div class="clear"></div>';a+="</div>";globalcommitbox(t_cropaction_found,a,"off")};tinkergame.prototype.open=function(){var u="";this.farmhouseBonus=checkFarmhouseBonus(this.data.config.token);if(this.farmhouseBonus&&this.farmhouseBonus.discount){u="isbonus"}var l="";l+='<div class="title">'+t_tinkergame_name+"</div>";l+='<div class="items">';for(var e in this.data.config.items){var m=0;if(this.data.data.items&&this.data.data.items[e]){m=this.data.data.items[e]}l+='<div id="tinkergame_slot'+e+'" class="slot slot'+e+'">';l+='  <div class="img item'+e+'">';l+="  </div>";l+='  <div class="plus link" onclick="tinkergame.buyItemCommit('+e+')" onmouseover="showDiv(\'tinkergame_item_slots_slot'+e+"_plus_tt')\" onmouseout=\"hideDiv('tinkergame_item_slots_slot"+e+"_plus_tt')\">";l+='    <div class="plus_plus">+</div>';l+='    <div id="tinkergame_item_slots_slot'+e+'_plus_tt" class="ttbox">'+t_tinkergame_buyitem_head.replace("%NAME%",t_tinkergame_item_name[e])+"</div>";l+="  </div>";l+='  <div id="tinkergame_slot'+e+'_amount" class="amount">'+m+"</div>";l+="</div>"}l+="</div>";l+='<div class="prizes '+u+'">';for(var b in this.data.config.sort){var e=this.data.config.sort[b];if(!this.data.config.prizes[e]){continue}var q=0;for(var w in this.data.config.prizes[e].need){q++}var t="";var n="";if(this.data.config.prizes[e].reward.farmhouse){t=t_farmhouse_item}if(this.data.config.prizes[e].reward.giftid){t=this.data.config.prizes[e].reward.name;n='<div class="type">'+t_pan_item+"</div>"}if(this.data.config.prizes[e].reward.powerup){var b=this.data.config.prizes[e].reward.powerup;t=formulas[0][b][2];n='<div class="type">'+t_type_powerup+"</div>";if(formulas[0][b][5][0]&&formulas[0][b][5][0][0]){n+="<div>"+powerup_bonustext1.replace("%AMOUNT%",formulas[0][b][5][0][1]).replace("%PRODUCT%",produkt_name[formulas[0][b][5][0][0]])+"</div>"}else{n+="<div>"+t_pointsboost.replace("%PERCENT%",formulas[0][b][5][3])+"</div>"}}if(this.data.config.prizes[e].reward.products){t=t_reward_products}if(this.data.config.prizes[e].daily){t+="*"}var a=0;var u="";if(!this.data.config.prizes[e].daily&&!this.data.config.prizes[e].infinite&&this.data.data.reward&&this.data.data.reward[e]){u+=" off";a=1}if(this.data.config.prizes[e].daily&&this.data.data.reward&&this.data.data.reward[e]&&this.data.data.reward[e]>=this.data.today){a=1}l+='<div class="prize '+u+'">';l+='  <div class="headline">'+t+"</div>";l+='  <div class="desc">'+n+"</div>";l+='  <div class="img">'+this.htmlReward(e)+"</div>";l+='  <div class="info">';var h=0;var s=0;var v="tinkergame.exchangePrizeCommit("+e+")";for(var w in this.data.config.prizes[e].need){s++;var m=this.data.config.prizes[e].need[w];if(!m){continue}var c=m;if(this.farmhouseBonus&&this.farmhouseBonus.discount){c=Math.ceil(c*(1-this.farmhouseBonus.discount))}u="";var r=0;if(this.data.data.items&&this.data.data.items[w]){r=this.data.data.items[w]}if(parseInt(r)<parseInt(c)){u="missed";h++;v=""}addclass2="";if(s%3==0){addclass2="right"}l+='<div class="line"><div class="item_img">'+this.htmlItem(e,w,m,u,addclass2)+"</div>";var d=1;if(q>3&&s%2!=0){d=0}if(d==1){l+='<div class="clear"></div>'}l+="</div>"}l+='    <div class="clear"></div>';l+="  </div>";u="";if(h>0){u="grayscale"}var d=1;if(a){d=0}if(this.data.config.prizes[e].daily&&a==1){l+='<div class="info2">'+t_tinkergame_daily_already+"</div>";d=0}if(this.data.config.prizes[e].prev&&(!this.data.data.reward||!this.data.data.reward[this.data.config.prizes[e].prev])){l+='<div class="info2 missing">'+t_tinkergame_prev_info.replace("%NAME%",'<span class="name">'+this.data.config.prizes[this.data.config.prizes[e].prev].reward.name+"</span>")+"</div>";d=0}if(this.data.config.prizes[e].reward.powerup){var b=this.data.config.prizes[e].reward.powerup;if(currentuserlevel<formulas[0][b][1]){l+='<div class="info2 missing">'+minlevel_feature.replace("%LEVEL%",formulas[0][b][1])+"</div>";d=0}}if(d==1){l+='<div class="button_new link '+u+'" onclick="'+v+'">'+t_tinkergame_exchange_button+"</div>"}if(!this.data.config.prizes[e].infinite&&!this.data.config.prizes[e].daily&&this.data.data.reward&&this.data.data.reward[e]){l+='<div class="ready"></div>'}l+="</div>"}l+="</div>";l+=events.buildTimeline("tinkergame");if(this.farmhouseBonus&&this.farmhouseBonus.discount){l+='<div style="color:green; text-align:center; margin-top:5px;">('+t_farmhouse_bonus_incl.replace("%PERCENT%",(this.farmhouseBonus.discount*100))+")</div>"}l+='<div class="dailyinfo">* '+t_tinkergame_daily_info+"</div>";l+='<div class="mini_close link" onclick="tinkergame.close()"></div>';l+='<div class="help helpbutton_blue link" onclick="tinkergame.help()"></div>';$("tinkergame_main").innerHTML=l;showDiv("tinkergame");this.timerUpdate()};tinkergame.prototype.exchangePrizeCommit=function(c){var b='<div id="tinkergame_exchangeprize_commit">';b+=this.htmlReward(c);b+='<div class="against"></div>';b+='<div class="need">';var h=0;for(var e in this.data.config.prizes[c].need){var a=this.data.config.prizes[c].need[e];if(!a){continue}b+=this.htmlItem(c,e,a);h++;if(h%3==0){b+='<div class="clear"></div>'}}b+='  <div class="clear"></div>';b+="</div>";var d="tinkergame.exchangePrize("+c+")";globalcommitbox(t_tinkergame_exchange_head,b,d)};tinkergame.prototype.htmlReward=function(c){var e="";var l="";var d="";if(this.data.config.prizes[c].reward.giftid){l="background:url("+imgpath+"gifts/"+this.data.config.prizes[c].reward.giftid+".gif)";d="giftid"}if(this.data.config.prizes[c].reward.farmhouse){var a=this.data.config.prizes[c].reward.farmhouse;if(a==315){a="_316"}else{if(a==316){a="_315"}else{a+="_"}}l="background:url("+imgpath+"farmhouse/previews/"+a.replace("_","")+"_1.png)";d="farmhouse"}if(this.data.config.prizes[c].reward.powerup){var h=this.data.config.prizes[c].reward.powerup;d="powerup";if(formulas[0][h][5][3]>0){d+=" points"}else{e='<div class="pid tt'+formulas[0][h][5][0][0]+'"></div>'}}if(this.data.config.prizes[c].reward.products){d="products"}var b='<div class="product '+d+'" style="'+l+'">';b+=e;b+="</div>";return b};tinkergame.prototype.htmlItem=function(e,h,d,a,c){if(this.farmhouseBonus&&this.farmhouseBonus.discount){if(a==""){a="bonus"}d=Math.ceil(d*(1-this.farmhouseBonus.discount))}var b="";b+='<div class="item item'+h+'" onmouseover="showDiv(\'tinkergame_prize'+e+"_item"+h+"_tt')\" onmouseout=\"hideDiv('tinkergame_prize"+e+"_item"+h+"_tt')\">";b+='  <div id="tinkergame_prize'+e+"_item"+h+'_tt" class="ttbox '+c+'">'+t_tinkergame_item_name[h]+"</div>";b+="</div>";b+='<div class="amount '+a+'">'+d+"x</div>";return b};tinkergame.prototype.buyItemCommit=function(e){var d='<div id="tinkergame_buyitem_commit">';for(var a in this.data.config.items[e].packages){var b="";var h="tinkergame.buyItem("+e+", "+a+")";var c=this.data.config.items[e].packages[a];if(parseInt(a)>parseInt(user_coins)){b="off";h=""}d+='<div class="coinsbutton_flex link '+b+'" onclick="'+h+'">';d+="  <div>"+t_tinkergame_buyitem_line.replace("%COUNT%",c).replace("%COINS%",a).replace("%NAME%",t_tinkergame_item_name[e])+"</div>";d+="</div>"}d+="</div>";globalcommitbox(t_tinkergame_buyitem_head.replace("%NAME%",t_tinkergame_item_name[e]),d,0,0,1)};tinkergame.prototype.timer=function(){this.data.data.remain--;this.data.data.remain_exchange--;this.timerUpdate()};tinkergame.prototype.timerUpdate=function(){if($("tinkergame_timer")){if(this.data.data.remain>0){$("tinkergame_timer").innerHTML=t_event_resttime+":&nbsp;<b>"+formatTime(this.data.data.remain)+"</b>"}else{$("tinkergame_timer").innerHTML=t_tinkergame_exchange_resttime+":&nbsp;<b>"+formatTime(this.data.data.remain_exchange)+"</b>"}}events.timerTimeline("tinkergame")};tinkergame.prototype.help=function(){var m={};for(var e in eventgarden.data.config.products){for(var c in eventgarden.data.config.products[e].drop){var b=c.replace("tinkergame_item","");if(!m[b]){m[b]=[]}m[b].push(e)}}var d='<div id="tinkergame_help">';d+="  <div>"+t_tinkergame_help1.replace("%NAME1%",t_tinkergame_item_name[1]).replace("%NAME2%",t_tinkergame_item_name[2]).replace("%NAME3%",t_tinkergame_item_name[3])+"</div>";var l="";for(var h in this.data.config.products){d+='<div class="slot">';d+='  <div class="img">';d+='    <div class="item item'+h+'"></div>';d+="  </div>";d+='  <div class="list">';for(var e=0;e<m[h].length;e++){d+='<div class="line">';d+='  <div class="pid eventgarden_product '+m[h][e]+'"></div>';d+='  <div class="name">'+eventgarden.data.config.products[m[h][e]].name+"</div>";d+='  <div class="clear"></div>';d+="</div>"}d+="  </div>";d+="</div>";l=h}d+='  <div style="margin-bottom:15px;">'+t_tinkergame_help3+"</div>";d+="  <div>"+t_tinkergame_help4.replace("%TIME%","<b>"+this.data.config.exchangeenddate+"</b>")+"</div>";d+="</div>";globalBoxFlex(t_tinkergame_name,d,0,0,1);$("globalbox").style.top="100px"};tinkergame.prototype.flyer=function(d){var b="";for(var a in d){var c=d[a];if(c>0){c="+"+c}b+='<div class="line">';b+='  <div class="img item item'+a+'"></div>';b+='  <div class="amount">'+c+"x</div>";b+='  <div class="clear"></div>';b+="</div>"}events.flyer({id:"tinkergame_link",name:"tinkergame",html:b,idle:"idle",move:"up"})};tinkergame.prototype.party=function(){this.partyClick++;if(!this.partyClick||this.partyClick%3!=0){return 1}$("tinkergame_main").addClassName("rotate");setTimeout(function(){$("tinkergame_main").removeClassName("rotate")},1100);var b="";for(var a=1;a<=15;a++){var d=getRandom(-200,500);var c=getRandom(-200,700);b+='<div id="tinkergame_confetti'+a+'" class="confetti" style="top:'+d+"px; left:"+c+'px;"></div>'}$("tinkergame").insert(b);setTimeout(function(){for(var e=1;e<=15;e++){$("tinkergame_confetti"+e).remove()}},1000)};tinkergame.prototype.close=function(){hideDiv("tinkergame")};var train=function(){this.data={};this.reward=0;this.destroyed=0;this.plan={};this.currentStation=0;this.currentWagonPos=0;this.currentShopFilter="";this.currentWagonEntryPid=0;this.currentRefillPid=0;this.blockedRoutes=[];this.blockedRouteTiles=[];this.researchTab="trains";this.researchScrollPosition=0;this.stats_options=["points","traders_visited","tiles_traveled","trader_completed"];this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.tutorialType="";this.tutorialStep=1;this.widescreen=0;this.rememberDivs=[];this.starterpackAutoOpen=0;this.allProducts={};this.loaded={}};train.prototype.buyStarterpack=function(){train.action("train_buy_startpack")};train.prototype.removeGridSpecial=function(a){train.action("train_remove_grid_special",{tile:a})};train.prototype.setTutorial=function(){train.action("train_settutorial",{type:train.tutorialType})};train.prototype.resetResearch=function(){train.action("train_reset_research")};train.prototype.upgradeResearch=function(a,b){train.action("train_upgrade_research",{type:a,id:b})};train.prototype.stats=function(){if($("train_stats_select")){if($("train_stats_select").value==0){return 1}train.stats_select=$("train_stats_select").value}if(train.stats_cache_delay[train.stats_select]<=0||!train.stats_cache[this.stats_select]){train.action("train_stats",{type:train.stats_select})}else{train.showStats(train.stats_select)}};train.prototype.deleteShopItem=function(b,a){train.action("train_delete_shop_item",{id:b,noplan:a})};train.prototype.trainRefill=function(d,e,c){var a=this.currentRefillPid;var b=$("train_products_entry").value;train.action("train_refill",{type:d,id:e,pid:a,amount:b,noplan:c})};train.prototype.unlock=function(d,a,c){var b=$("train_unlock_entry").value;train.action("train_unlock",{slot:d,tool:a,amount:b,type:c})};train.prototype.speedupTraderWaiting=function(a){train.action("train_speedup_trader_waiting",{trader:a})};train.prototype.buyTool=function(b,a){train.action("train_buy_tool",{name:b,coins:a})};train.prototype.savePlan=function(){train.action("train_save_plan",{plan:JSON.stringify(train.plan)})};train.prototype.speedupStationSlot=function(a,b){train.action("train_speedup_station_slot",{station:a,slot:b})};train.prototype.claimStationSlot=function(a,b){train.action("train_claim_station_slot",{station:a,slot:b})};train.prototype.buyShopItem=function(a,c,b){train.action("train_buy_shop_item",{name:a,station:c,noplan:b})};train.prototype.buyStationSlot=function(a,b){train.action("train_buy_station_slot",{station:a,slot:b})};train.prototype.saveGrid=function(){var a={};for(var b in trainGrid.grid){if(!trainGrid.grid[b].name){continue}a[b]=trainGrid.grid[b]}train.action("train_save_grid",{save:JSON.stringify(a)})};train.prototype.buyAddLevel=function(){train.action("train_buy_add_level")};train.prototype.addLevel=function(){train.action("train_add_level",{amount:$("train_dialog_leveladd_insert").value})};train.prototype.buy=function(){train.action("train_buy")};train.prototype.init=function(){train.action("train_init")};train.prototype.action=function(a,b){if($("train_map")){trainGrid.saveTrainMapLeft=$("train_map").style.left;trainGrid.saveTrainMapTop=$("train_map").style.top;if($("train_routesview")){trainGrid.saveRouteView=$("train_routesview").className}}ajaxAction("farm",a,b,train.response)};train.prototype.response=function(c,b,d){if(in_array(b,["train_settutorial"])){return 1}if(c.reward){train.reward=c.reward}if(c.destroyed){train.destroyed=c.destroyed}if(c.stats){train.stats_cache_delay[train.stats_select]=30;if(!train.stats_cache[train.stats_select]){train.stats_cache[train.stats_select]={}}train.stats_cache[train.stats_select]=c.stats;train.showStats()}if(in_array(b,["train_buy"])){closeMap();train_has_building=1;train_quicknavi=1}if(in_array(b,["train_save_plan"])){train.closePlan();train.plan={}}train.build();train_quicknavi=1;speedLinks();if(in_array(b,["train_upgrade_research","train_reset_research"])){train.openResearch();if(b=="train_upgrade_research"){train.scrollToResearch(d.type,d.id)}}if(in_array(b,["train_buy_tool"])){train.openTools()}if(in_array(b,["train_buy_station_slot"])){train.openStation(d.station)}if(in_array(b,["train_unlock"])){if(d.type=="trader"){train.openTrader(d.slot)}if(d.type=="station"){train.openStation(d.slot)}}if(in_array(b,["train_buy_shop_item","train_refill","train_delete_shop_item"])){var a=0;if(d.noplan){a=d.noplan}if(train.plan.station){if(train.currentShopFilter=="wagon"){train.openShop(train.currentShopFilter,a)}else{train.showPlan()}}else{train.openShop(train.currentShopFilter,a)}}if(train.reward){train.showReward()}};train.prototype.build=function(){this.blockedRoutes=[];if(this.data.data.plans){for(var l in this.data.data.plans){for(var h in this.data.data.plans[l]){for(b=0;b<this.data.data.plans[l][h].routes.length;b++){var a=this.data.data.plans[l][h].routes[b];this.blockedRoutes.push(a)}}}}var c="";c+='<div id="train_map" class="map">';c+='  <div id="train_zoomer" class="zoomer">';c+='    <div class="back"></div>';c+='    <div id="train_grid" class="grid" onmouseout="trainGrid.hoverTile(0, 0)"></div>';c+="  </div>";c+="</div>";c+='<div id="train_zoom" class="zoom">';c+='  <div class="p link" onclick="trainGrid.setZoom(-1)"><span>+</span></div>';c+='  <div class="m link" onclick="trainGrid.setZoom(1)"><span>-</span></div>';c+='  <div class="ws link" onclick="train.setWidescreen()"></div>';for(var b in this.data.config.station){c+='<div class="marker station link" onclick="trainGrid.moveTo('+this.data.config.station[b].init+')">S'+b+"</div>"}c+="</div>";c+='<div id="train_cross" class="cross off">';c+='  <div class="arrow up link" onclick="trainGrid.moveMapClicker(\'up\')"></div>';c+='  <div class="arrow left link" onclick="trainGrid.moveMapClicker(\'left\')"></div>';c+='  <div class="arrow right link" onclick="trainGrid.moveMapClicker(\'right\')"></div>';c+='  <div class="arrow down link" onclick="trainGrid.moveMapClicker(\'down\')"></div>';c+='  <div class="expander link" onclick="train.expandCross()"><div class="arrow2"></div></div>';c+="</div>";c+='<div id="train_routesview" class="routesview"></div>';c+='<div id="train_trackstock" class="trackstock"></div>';c+='<div id="train_plan_breadcrump" class="breadcrump"></div>';c+='<div id="train_cart" class="cart"></div>';c+='<div id="train_save" class="save"></div>';var n=["shop","wagons"];for(var b=0;b<n.length;b++){c+='<div id="train_'+n[b]+'">';c+='  <div class="transp"></div>';c+='  <div class="boxit">';c+='    <div style="position:relative;">';c+='      <div class="globalbox_scale globalbox_scale_t">';c+='        <div class="globalbox_scale globalbox_scale_l">';c+='          <div class="globalbox_scale globalbox_scale_r">';c+='            <div class="globalbox_scale globalbox_scale_b">';c+='              <div id="train_'+n[b]+'_main" class="main"></div>';c+="            </div>";c+="          </div>";c+="        </div>";c+="      </div>";c+='      <div class="globalbox_edge globalbox_edge_tl"></div>';c+='      <div class="globalbox_edge globalbox_edge_tr"></div>';c+='      <div class="globalbox_edge globalbox_edge_bl"></div>';c+='      <div class="globalbox_edge globalbox_edge_br"></div>';c+="    </div>";c+="  </div>";c+="</div>"}var e=["shop","tools","research","stats"];c+='<div id="train-main-buttons" class="main-buttons">';for(var b=0;b<e.length;b++){if(e[b]=="shop"){var m="train.openShop('all', 1)"}if(e[b]=="research"){var m="train.openResearch()"}if(e[b]=="tools"){var m="train.openTools()"}if(e[b]=="stats"){var m="train.stats()"}c+='<div id="train_main_button_'+e[b]+'" class="main-button '+e[b]+' link" onclick="'+m+'" onmouseover="showDiv(\'train_main_button_'+e[b]+"_tt')\" onmouseout=\"hideDiv('train_main_button_"+e[b]+"_tt')\">";c+='  <div id="train_main_button_'+e[b]+'_tt" class="ttbox">';c+='    <div class="name">'+t_train_main_button_head[e[b]]+"</div>";if(t_train_main_button_desc[e[b]]){c+='<div class="desc">'+t_train_main_button_desc[e[b]]+"</div>"}c+="  </div>";c+="</div>"}c+="</div>";c+='<div id="train_starterpack_link" class="link" onclick="train.starterPack(1)" onmouseover="showDiv(\'train_starterpack_link_tt\')" onmouseout="hideDiv(\'train_starterpack_link_tt\')">';c+='  <div id="train_starterpack_link_timer" class="timer"></div>';c+='  <div id="train_starterpack_link_tt" class="ttbox">'+t_train_starterpack_head+"</div>";c+="</div>";c+='<div class="help helpbutton_blue link" onclick="train.helpOpen(\'grid\')"></div>';c+=htmlLevelBar("train");c+=htmlCountBar("train");c+='<div id="train_starterpack">';c+='  <div class="transp"></div>';c+='  <div id="train_starterpack_inner" class="content"></div>';c+="</div>";c+='<div id="train_tutorial">';c+='  <div class="transp"></div>';c+='  <div id="train_tutorial_char" class="char"></div>';c+='  <div id="train_tutorial_bubble" class="bubble"></div>';c+="</div>";$("train").innerHTML=c;showDiv("train");trainGrid.init();this.timerUpdate();$("train_levelbar_number").innerHTML=this.data.data.level;$("train_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var d=t_reached_maxlevel;hideDiv("train_levelbar_plus")}else{var d=t_train_level_line.replace("%NAME%",t_train_points).replace("%AMOUNT%",this.data.data.level_rest);$("train_levelbar_plus").onclick=new Function("train.addLevelCommit()");$("train_levelbar_plus_tt").innerHTML=t_train_leveladd_tt.replace("%NAME%",t_train_points)}$("train_levelbar_tt").innerHTML=d;$("train_countbar_inner").innerHTML='<div class="train_points"></div><div>'+formatNumber(this.data.data.count)+"</div><br>";$("train_countbar_plus_tt").innerHTML=t_train_levelitem_buy.replace("%NAME%",t_train_points);$("train_countbar_plus").onclick=new Function("train.buyAddLevelCommit()");$("train_map").style.left=trainGrid.saveTrainMapLeft;$("train_map").style.top=trainGrid.saveTrainMapTop;if(trainGrid.saveRouteView!=""){$("train_routesview").className=trainGrid.saveRouteView}this.startTutorial("start");this.starterPack()};train.prototype.expandCross=function(){if($("train_cross").hasClassName("off")){$("train_cross").removeClassName("off")}else{$("train_cross").addClassName("off")}};train.prototype.addLevelCommit=function(){var b=t_train_dialog_leveladd_head.replace("%NAME%",t_train_points);var a=htmlLevelAddDialog("train");globalcommitbox(b,a,0,0,1);$("train_dialog_leveladd_insert").focus()};train.prototype.addLevelCheck=function(){var a=$("train_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>train.data.data.count){a=train.data.data.count}$("train_dialog_leveladd_insert").value=a};train.prototype.buyAddLevelCommit=function(a){var h=t_train_levelitem_buy.replace("%NAME%",t_train_points);var c=train.data.data.exchangeamount;var n="";var l="";var e=specialbonus.findBonus({key1:"train",key2:"buypoints"});if(e){n=specialbonus.htmlBonusLine(e.buypoints);l="specialbonus_bonus_value";c=Math.ceil(c*(1+e.buypoints))}var b=t_train_levelitem_buy_dialog.replace("%COINS%",train.data.data.exchangecoins).replace("%AMOUNT%",'<span class="'+l+'">'+c+"</span>").replace("%NAME%",t_train_points);if(!a){var d='<div class="link coinsbutton_flex" onclick="train.buyAddLevelCommit(1)" style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}globalcommitbox(h,d,0,0,1)}else{var d='<div style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}var m="train.buyAddLevel()";globalcommitbox(h,d,m)}};train.prototype.startRouting=function(){if($("train_grid_transp").style.display=="block"){this.closeRouting()}else{trainGrid.currentItem="";trainGrid.setMode("");$("traingrid_trackstock_start").addClassName("active");showDiv("train_grid_transp");for(var b in this.data.config.station){$("train_grid_tile"+this.data.config.station[b].init).addClassName("is-top").addClassName("pulse")}if($("train_guide")){$("train_guide").remove()}var a="";a+='<div id="train_guide" class="guide">';a+='  <div class="char"></div>';a+='  <div id="train_guide_bubble" class="bubble"><span>'+t_train_trackstock_start_bubble+'</span><div class="arrow"></div></div>';a+="</div>";$("train_trackstock").insert(a)}};train.prototype.closeRouting=function(){$("traingrid_trackstock_start").removeClassName("active");if($("train_guide")){$("train_guide").remove()}hideDiv("train_grid_transp");for(var a in this.data.config.station){$("train_grid_tile"+this.data.config.station[a].init).removeClassName("is-top").removeClassName("pulse")}};train.prototype.startPlan=function(b,d){hideDiv("globalbox");hideDiv("globaltransp");this.plan.step=1;this.plan.station=b;this.plan.slot=d;this.plan.routes=[];var c=this.data.config.station[b].starter[d];for(var a in trainGrid.routes){if(trainGrid.routes[a].start!=c){continue}this.plan.routes.push(a)}this.showPlan()};train.prototype.showPlan=function(){if(this.plan.step<=0){this.plan.step=1}this.buildBreadcrump();if(this.plan.step==1){this.openShop("train")}else{if(this.plan.step==2){this.closeShop();trainGrid.buildRoutesView()}else{if(this.plan.step==3){trainGrid.buildRoutesView();this.closeShop();this.openWagons()}else{if(this.plan.step==4){this.closeShop();this.closeWagons()}}}}};train.prototype.backPlanStep=function(){this.closeShop();if(this.plan.step==3){this.cancelWagons()}else{this.plan.step--;this.showPlan()}};train.prototype.nextPlanStep=function(){this.plan.step++;this.showPlan()};train.prototype.cancelPlan=function(){hideDiv("train_wagons");this.plan={};trainGrid.build();this.closeShop();this.closePlan()};train.prototype.closePlan=function(){hideDiv("train_plan_breadcrump")};train.prototype.buildBreadcrump=function(){var d='<div class="head">'+t_train_plan_head+': <span class="step">'+this.plan.step+"/4 "+t_train_plan_step_head[this.plan.step]+"</span></div>";d+='  <div id="train_plan_route" class="route"></div>';d+='  <div class="crump-stats">';d+="   <div>"+t_train_plan_duration+': <span id="train_plan_stats_duration"></span>&nbsp;('+t_train_plan_duration_info+")</div>";var e=["energy","durability"];for(var c=0;c<e.length;c++){d+='<div style="display:flex; justify-content:left; align-items:center; gap:5px;">';d+='  <div class="icon icon-'+e[c]+'"></div>';d+="  <div>"+t_train_item_stats[e[c]]+":</div>";d+='  <div id="train_plan_stats_'+e[c]+'"></div>';d+="</div>"}d+="  </div>";d+='<div class="train-line">';var a=0;var b="";if(this.plan.train){a=this.data.config.trains[this.data.data.trains[this.plan.train].name].wagons;b="img train_train "+this.data.data.trains[this.plan.train].name}d+='  <div class="main '+b+'" onmouseover="showDiv(\'train_plan_train-line_main_tt\')" onmouseout="hideDiv(\'train_plan_train-line_main_tt\')">';if(b!=""){d+='<div id="train_plan_train-line_main_tt" class="ttbox">'+this.trainTT(this.data.data.trains[this.plan.train].name,this.plan.train)+"</div>"}d+="  </div>";for(var c=1;c<=a;c++){var b="";if(this.plan.wagons&&this.plan.wagons[c]){b="img train_train "+this.data.data.trains[this.plan.wagons[c].id].name}d+='<div class="wagon '+b+'" onmouseover="train.hoverBreadcrumpWagon('+c+', 1)" onmouseout="train.hoverBreadcrumpWagon('+c+', 0)">';if(b!=""){d+='<div id="train_plan_train-line_wagon'+c+'_tt" class="ttbox"></div>'}d+="</div>"}d+="</div>";d+='<div class="col2">';d+='<div class="buttons">';if(in_array(this.plan.step,[2,3,4])){d+='<div id="train_plan_back_button" class="button_new link" onclick="train.backPlanStep()">'+t_train_plan_back_button+"</div>"}if(in_array(this.plan.step,[2,3])){d+='<div id="train_plan_continue_button" class="button_new link" onclick="train.nextPlanStep()">'+t_train_plan_continue_button+"</div>"}if(in_array(this.plan.step,[4])){d+='<div id="train_plan_go_button" class="button_new link" onclick="train.savePlan()">'+t_train_plan_save_button+"</div>"}d+='  <div class="button_new link" onclick="train.cancelPlan()">'+t_train_plan_cancel_button+"</div>";d+="</div>";d+="</div>";var b="";if(this.data.data.tutorial.plan){b="off"}d+='<div class="guide '+b+'">';d+='  <div class="char"></div>';d+='  <div id="train_guide_bubble" class="bubble"><span>'+t_train_plan_guide_step[this.plan.step]+'</span><div class="arrow"></div></div>';d+="</div>";$("train_plan_breadcrump").innerHTML=d;showDiv("train_plan_breadcrump");this.buildBreadcrumpRoute()};train.prototype.hoverBreadcrumpWagon=function(b,a){if(!this.plan.wagons||!this.plan.wagons[b]){return 1}hideDiv("train_plan_train-line_wagon"+b+"_tt");if(a==1){$("train_plan_train-line_wagon"+b+"_tt").innerHTML=this.trainTT(this.data.data.trains[this.plan.wagons[b].id].name,this.plan.wagons[b].id);showDiv("train_plan_train-line_wagon"+b+"_tt")}};train.prototype.buildBreadcrumpRoute=function(){var s={};if(this.plan.routes){for(var e=0;e<this.plan.routes.length;e++){var a=trainGrid.routes[this.plan.routes[e]];s[a.start]={name:this.plan.routes[e],end:a.end};s[a.end]={name:this.plan.routes[e],end:a.start}}}var c=0;var t=0;var q=0;var l="";l+='<div class="marker station"><span>S'+this.plan.station+"</span></div>";var b=this.data.config.station[this.plan.station].starter[this.plan.slot];this.plan.trader=[];if(s[b]){do{var u=s[b].end;var v=this.searchEndpointTrader(u);if(!v){break}if(in_array(v,this.plan.trader)){break}this.plan.trader.push(v);c+=trainGrid.routes[s[b].name].duration;t+=trainGrid.routes[s[b].name].durability;q+=trainGrid.routes[s[b].name].energy;l+='<div class="arrow"></div>';l+='<div class="marker trader" onmouseover="showDiv(\'train_plan_route_trader'+v+"')\" onmouseout=\"hideDiv('train_plan_route_trader"+v+"')\">";l+="  <div>T"+v+"</div>";l+='  <div id="train_plan_route_trader'+v+'" class="ttbox">'+trainGrid.traderTT(v,1)+"</div>";l+="</div>";for(var d in this.data.config.trader[v].starter){var m=this.data.config.trader[v].starter[d];if(m==u||!s[m]){continue}b=m;break}}while(s[b])}if(this.plan.train&&this.data.data.research&&this.data.data.research.trains&&this.data.data.research.trains[this.data.data.trains[this.plan.train].name]){var n=1-(this.data.data.research.trains[this.data.data.trains[this.plan.train].name].level*this.data.config.research.trains.timebonus);c=Math.round(c*n)}c=(c*2);this.plan.stats={};this.plan.stats.duration=c;this.plan.stats.durability=t;this.plan.stats.energy=q;$("train_plan_stats_duration").innerHTML=formatTime(c);$("train_plan_stats_durability").innerHTML=formatNumber(t);$("train_plan_stats_energy").innerHTML=formatNumber(q);$("train_plan_route").innerHTML=l;if(this.plan.train){var h=0;if(t>this.data.data.trains[this.plan.train].durability){$("train_plan_stats_durability").addClassName("failed");h++}if(q>this.data.data.trains[this.plan.train].energy){$("train_plan_stats_energy").addClassName("failed");h++}if(h>0){if($("train_plan_continue_button")){$("train_plan_continue_button").addClassName("off")}$("train_guide_bubble").innerHTML=t_train_plan_error_energy}}};train.prototype.searchEndpointTrader=function(a){var b=0;if(trainGrid.traderTiles[a]){b=trainGrid.traderTiles[a].trader}return b};train.prototype.clickRouteTile=function(c){if(this.plan.routes){var a=0;var d=0;for(var b in trainGrid.routes){if(in_array(c,trainGrid.routes[b].tiles)&&$("traingrid_route_selector_"+b)&&$("traingrid_route_selector_"+b).disabled==false){if(in_array(b,this.blockedRoutes)){return 1}if($("traingrid_route_selector_"+b).checked==true){$("traingrid_route_selector_"+b).checked=false}else{$("traingrid_route_selector_"+b).checked=true}break}}}trainGrid.selectPlanRoute()};train.prototype.openShop=function(b,l){if(!this.currentStation){this.currentStation=1}this.currentShopFilter=b;var h=t_train_main_button_head.shop+" "+t_train_station_name.replace("%COUNT%",this.currentStation);if(l!=1){h=t_train_plan_step_head[this.plan.step]}var e='<div class="head">'+h+"</div>";e+='<div class="col col1">';e+='  <div class="sub">'+t_train_shop_col1_head+"</div>";e+='  <div class="list">';if(this.data.data.trains){for(var a in this.data.data.trains){if(b!="all"&&this.data.config.trains[this.data.data.trains[a].name].category!=b){continue}if(this.data.data.trains[a].station!=this.currentStation){continue}e+=this.buildShopSlot(this.data.data.trains[a].name,a,l)}}e+="  </div>";e+="</div>";e+='<div class="col col2">';e+='  <div class="sub">'+t_train_shop_col2_head+"</div>";e+='  <div class="list">';for(var d in this.data.config.trains){if(b!="all"&&this.data.config.trains[d].category!=b){continue}e+=this.buildShopSlot(d,0,l)}e+="  </div>";e+="</div>";e+='<div class="clear"></div>';e+='<div id="train_shop_tt" class="ttbox"></div>';e+='<div class="mini_close link" onclick="train.closeShop()"></div>';if(l==1){e+='<div class="navi">';for(var d in this.data.config.station){var m="";if(this.currentStation==d){m="active"}var n="train.clickNaviShop("+l+", "+d+")";if(!this.data.data.stations_unlock[d]||!this.data.data.stations_unlock[d].unlocked){n=""}e+='<div class="tab '+m+' link" onclick="'+n+'">';e+='  <div class="marker station">S'+d+"</div>";if(n==""){e+='<div class="locked"></div>'}e+="</div>"}e+="</div>";e+='<div class="filters">';var c=["all","train","wagon"];for(var d=0;d<c.length;d++){var m="";if(this.currentShopFilter==c[d]){m="active"}e+='<div class="filter '+m+' link" onclick="train.clickShopFilter(\''+c[d]+"', "+l+')" onmouseover="showDiv(\'train_shop_filter_'+c[d]+"_tt')\" onmouseout=\"hideDiv('train_shop_filter_"+c[d]+"_tt')\">";e+='  <div class="icon is-'+c[d]+'"></div>';e+='  <div id="train_shop_filter_'+c[d]+'_tt" class="ttbox">'+t_train_shop_filter_name[c[d]]+"</div>";e+="</div>"}e+="</div>"}$("train_shop_main").innerHTML=e;$("train_shop").removeClassName("noplan");if(l==1){$("train_shop").addClassName("noplan")}showDiv("train_shop");hideDiv("globalbox");hideDiv("globaltransp");hideDiv("train_wagons")};train.prototype.clickShopFilter=function(a,b){this.openShop(a,b)};train.prototype.clickNaviShop=function(b,a){this.currentStation=a;this.openShop(this.currentShopFilter,b)};train.prototype.hoverShopSlot=function(b,c,a){hideDiv("train_shop_tt");$("train_shop_tt").removeClassName("right");if(a==1){$("train_shop_tt").innerHTML=this.trainTT(b,c);showDiv("train_shop_tt");if(c>0){$("train_shop_tt").addClassName("right")}}};train.prototype.buildShopSlot=function(c,a,r){var v="train.selectShopItem("+a+")";var s="";var u="";if(!a){v="train.buyShopItemCommit('"+c+"', "+r+")";if(+this.data.config.trains[c].level>+this.data.data.level){v=""}s="is-dealer"}else{var m=1;if(this.data.data.trains[a].plan>0){m=0}if(this.plan.wagons){for(var b in this.plan.wagons){if(this.plan.wagons[b].id==a){m=0}}}if(this.plan.station&&this.data.data.trains[a].durability<this.plan.stats.durability){m=0;u+="<div>"+t_train_shop_no_durability+"</div>"}if(this.plan.station&&this.data.config.trains[this.data.data.trains[a].name].category=="train"&&this.data.data.trains[a].energy<this.plan.stats.energy){m=0;u+="<div>"+t_train_shop_no_energy+"</div>"}if(!m){if(u==""){u="<div>"+t_train_shop_busy+"</div>"}v="";s="off"}}var d="";d+='<div class="line '+s+'" onmouseover="train.hoverShopSlot(\''+c+"', "+a+', 1)" onmouseout="train.hoverShopSlot(\''+c+"', "+a+', 0)">';d+='  <div class="img train_train '+c+'"></div>';d+='  <div class="content">';if(!a&&v==""){d+="<div>";d+='  <div class="locked"></div>';d+='  <div class="failed">'+t_train_requires_level.replace("%COUNT%",this.data.config.trains[c].level)+"</div>";d+="</div>"}else{d+="<div>";d+='  <div class="name">'+this.data.config.trains[c].name+"</div>";if(this.data.config.trains[c].products){d+='<div class="products flex-center-all">';for(var b=0;b<this.data.config.trains[c].products.length;b++){d+='<div class="icon cmenue_'+this.data.config.trains[c].products[b]+'"></div>'}d+="</div>"}if(!a){var q="";if(this.data.config.trains[c].money){cost=formatPrice(this.data.config.trains[c].money);if(+this.data.config.trains[c].money>+user_bar){q="failed"}}if(this.data.config.trains[c].coins){cost=formatNumber(this.data.config.trains[c].coins)+"&nbsp;"+t_coins;if(+this.data.config.trains[c].coins>+user_coins){q="failed"}}if(this.data.config.trains[c].train_points){cost=formatNumber(this.data.config.trains[c].train_points)+"&nbsp;"+t_train_points;if(+this.data.config.trains[c].train_points>+this.data.data.count){q="failed"}}d+='<div class="'+q+'">'+cost+"</div>";d+='<div class="button_new '+q+' link" onclick="'+v+'">'+t_train_shop_buy_button+"</div>"}else{var t=["energy","durability"];for(var b=0;b<t.length;b++){if(!this.data.config.trains[c][t[b]]){continue}var h=this.data.data.trains[a][t[b]];var l=this.data.config.trains[c][t[b]];if(t[b]=="energy"){l=this.data.data.trains[a].maxenergy}var e=((h*100)/l);d+='<div class="bar-line is-'+t[b]+'">';d+='  <div class="icon icon-'+t[b]+'"></div>';var m=1;if(t[b]=="durability"&&this.data.config.trains[c].indestructible){d+='<div style="margin:0 10px;">'+t_train_item_stats.indestructible+"</div>";m=0}if(m==1){d+='<div class="bar">';d+='  <div class="bar_inner" style="width:'+e+'%">';d+="  </div>";d+='  <div class="counter">'+formatNumber(h)+"/"+formatNumber(l)+"</div>";d+="</div>";var n="";if(+h>=+l){n="off"}d+='<div class="bar-btn '+n+'" onclick="train.currentRefillPid=0; train.refillTrainCommit('+a+", '"+t[b]+"', "+r+');" onmouseover="showDiv(\'train_shop_id'+a+"_btn_"+t[b]+"_tt')\" onmouseout=\"hideDiv('train_shop_id"+a+"_btn_"+t[b]+"_tt')\">";d+='  <div id="train_shop_id'+a+"_btn_"+t[b]+'_tt" class="ttbox">'+t_train_shop_btn_refill[t[b]]+"</div>";d+="</div>"}d+="</div>"}if(r==1){d+='<div class="remove link" onclick="train.deleteShopItemCommit('+a+", "+r+')" onmouseover="showDiv(\'train_shop_item'+a+"_remove_tt')\" onmouseout=\"hideDiv('train_shop_item"+a+"_remove_tt')\">";d+='  <div id="train_shop_item'+a+'_remove_tt" class="ttbox">'+t_train_shop_btn_remove+"</div>";d+="</div>"}if(s==""){if(!r){d+='<div class="button_new link" onclick="'+v+'">'+t_train_shop_select_button+"</div>"}}else{d+='<div class="onduty">'+u+"</div>"}}d+="</div>"}d+="  </div>";d+="</div>";return d};train.prototype.deleteShopItemCommit=function(h,d){var b=this.data.config.trains[this.data.data.trains[h].name].name;var c=t_train_shop_remove_head.replace("%NAME%",b);var a='<div class="train_buy_commit">';a+="  <div>"+t_train_shop_remove_desc.replace("%NAME%",b)+"</div>";a+="</div>";var e="train.deleteShopItem("+h+", "+d+")";globalcommitbox(c,a,e)};train.prototype.refillTrainCommit=function(r,e,c){var A=this.data.data.trains[r].name;var s=this.data.data.trains[r][e];var u=this.data.config.trains[A][e];if(e=="energy"){var u=this.data.data.trains[r].maxenergy}var b=((s*100)/u);var t="train.trainRefill('"+e+"', "+r+", "+c+")";var z="";var h="";var w=[];if(e=="durability"){for(var q in this.data.config.tools){if(!this.data.data.tools||!this.data.data.tools[q]){continue}if(h==""){h=q}w.push(q)}if(this.currentRefillPid!=""&&in_array(this.currentRefillPid,w)){h=this.currentRefillPid}if(this.currentRefillPid==""||!this.currentRefillPid){this.currentRefillPid=h}var d=this.data.data.tools[h];var a=this.data.config.tools[h].name;var l="train_tool tool_"+h;var m=this.data.config.tools[h].repair;if(w.length){for(var v=0;v<w.length;v++){var q=w[v];if(q==h){continue}z+='<div class="line2 link" onclick="train.selectRefillProduct(\''+q+"', "+r+", '"+e+"', "+c+')">';z+='  <div class="col1 train_tool tool_'+q+'"></div>';z+='  <div class="col2" style="width:122px;">'+this.data.config.tools[q].name+"</div>";z+='  <div class="col3 flex-center-all">';z+='    <div class="icon icon-'+e+'"></div>';z+='    <div style="text-align:right;">'+formatNumber(this.data.config.tools[q].repair)+"</div>";z+="  </div>";z+="</div>"}}}else{if(e=="energy"){for(var q in this.data.data.validenergyproducts){var d=checkRackItem(q);if(d<=0){continue}if(h==""){h=q}w.push(q)}if(this.currentRefillPid!=""&&in_array(this.currentRefillPid,w)){h=this.currentRefillPid}if(this.currentRefillPid==""||!this.currentRefillPid){this.currentRefillPid=h}var d=checkRackItem(h);var a=produkt_name[h];var l="kp"+h;var m=this.data.data.validenergyproducts[h];if(w.length){for(var v=0;v<w.length;v++){var q=w[v];if(q==h){continue}z+='<div class="line2 link" onclick="train.selectRefillProduct(\''+q+"', "+r+", '"+e+"', "+c+')">';z+='  <div class="col1 kp'+q+'"></div>';z+='  <div class="col2">'+produkt_name[q]+"</div>";z+='  <div class="col3 flex-center-all">';z+='    <div class="icon icon-'+e+'"></div>';z+='    <div style="text-align:right;">'+formatNumber(this.data.data.validenergyproducts[q])+"</div>";z+="  </div>";z+="</div>"}}}}var n='<div id="train_commit">';n+='  <div class="capacity is-'+e+'">';n+='    <div style="margin-bottom:5px; font-weight:bold;">'+t_train_item_stats[e]+":</div>";n+='    <div class="flex-center-all"">';n+='      <div class="icon icon-'+e+'"></div>';n+='      <div class="bar">';n+='        <div id="train_wagon_barinner2" class="bar_inner bar_inner2"></div>';n+='        <div id="train_wagon_barinner" class="bar_inner" style="width:'+b+'%"></div>';n+="      </div>";n+="    </div>";n+='    <div style="margin-bottom:10px;"><span id="train_wagon_currentcapacity">'+formatNumber(s)+"</span>/"+formatNumber(u)+"</div>";n+="  </div>";n+='  <div class="product">';n+='    <div style="margin-bottom:5px; font-weight:bold;">'+t_help_new_product+":</div>";if(h!=""){n+='<div class="current link" onclick="train.expandRefillProductsList()">';n+='  <div class="line2">';n+='    <div class="col1 '+l+'"></div>';n+='    <div class="col2">'+a+"</div>";n+='    <div class="col3 flex-center-all">';n+='      <div class="icon icon-'+e+'"></div>';n+="      <div>"+m+"</div>";n+="    </div>";n+="  </div>";n+="</div>";n+='<div id="train_wagon_selector" class="selector link" onclick="train.expandWagonList()"></div>';n+='<div class="clear"></div>'}n+='    <div class="entry">';n+='      <input id="train_products_entry" type="number" onchange="train.checkRefillEntry(\''+e+"', "+r+')" onkeyup="train.checkRefillEntry(\''+e+"', "+r+')"></input>';n+='      <div class="stock">'+t_inner_stock+"&nbsp;"+formatNumber(d)+"</div>";n+='      <div id="train_products_button" class="button_new link" onclick="'+t+'">'+t_spicehouse_oven_product_entry_button+"</div>";n+='      <div class="clear"></div>';n+="    </div>";n+='    <div id="train_products_list" class="list2">'+z+"</div>";n+="  </div>";n+="</div>";globalcommitbox(t_train_shop_btn_refill[e],n,0,0,1);this.checkRefillEntry(e,r)};train.prototype.checkRefillEntry=function(m,b){var a=this.data.data.trains[b].name;var l=this.data.data.trains[b][m];var n=this.data.config.trains[a][m];var c=(n-l);if(m=="durability"){var e=this.data.data.tools[this.currentRefillPid];var q=this.data.config.tools[this.currentRefillPid].repair}if(m=="energy"){var e=checkRackItem(this.currentRefillPid);var q=this.data.data.validenergyproducts[this.currentRefillPid]}c=Math.ceil(c/q);var d=$("train_products_entry").value;d=parseInt(d);if(isNaN(d)||d<=0){d=1}if(+d>+e){d=e}if(+d>+c){d=c}$("train_products_entry").value=d;var h=Math.min(100,(((+l+(+d*+q))*100)/+n));$("train_wagon_barinner2").style.width=h+"%";$("train_wagon_currentcapacity").innerHTML=formatNumber(Math.min(n,(+l+(+d*+q))))};train.prototype.expandRefillProductsList=function(){$("train_wagon_selector").removeClassName("closed");if($("train_products_list").style.display=="block"){hideDiv("train_products_list")}else{showDiv("train_products_list");$("train_wagon_selector").addClassName("closed")}};train.prototype.selectRefillProduct=function(a,d,c,b){this.currentRefillPid=a;this.refillTrainCommit(d,c,b)};train.prototype.buyShopItemCommit=function(c,d){if(this.data.config.trains[c].money){cost=formatPrice(this.data.config.trains[c].money)}if(this.data.config.trains[c].coins){cost=formatNumber(this.data.config.trains[c].coins)+"&nbsp;"+t_coins}if(this.data.config.trains[c].train_points){cost=formatNumber(this.data.config.trains[c].train_points)+"&nbsp;"+t_train_points}var b=t_train_shop_buy_head.replace("%NAME%",this.data.config.trains[c].name);var a='<div class="train_buy_commit">';a+="  <div>"+t_train_shop_buy_desc.replace("%NAME%",this.data.config.trains[c].name).replace("%COST%",'<span class="train_buy_commit_cost">'+cost+"</span>").replace("%STATION%",this.currentStation)+"</div>";a+='  <div class="info">'+t_train_shop_buy_info.replace("%NAME%",this.data.config.trains[c].name).replace("%COUNT%",this.currentStation)+"</div>";a+="</div>";var e="train.buyShopItem('"+c+"', "+this.currentStation+", "+d+")";globalcommitbox(b,a,e)};train.prototype.selectShopItem=function(c){if(this.data.config.trains[this.data.data.trains[c].name].category=="train"){this.plan.train=c;if(this.plan.wagons){var a=this.data.config.trains[this.data.data.trains[c].name].wagons;for(var b in this.plan.wagons){if(b>a){delete this.plan.wagons[b]}}}this.nextPlanStep()}else{if(!this.plan.wagons){this.plan.wagons={}}this.plan.wagons[this.currentWagonPos]={id:c};this.showPlan()}};train.prototype.closeShop=function(){hideDiv("train_shop");if(this.plan.step==1){this.cancelPlan();this.openStation(this.currentStation)}};train.prototype.openStation=function(D){if(this.plan.station){return 1}if($("train_save").style.display=="block"){$("train_save").addClassName("pulse");setTimeout(function(){$("train_save").removeClassName("pulse")},1000);return 1}if($("train_cart").style.display=="block"){$("train_cart").addClassName("pulse");setTimeout(function(){$("train_cart").removeClassName("pulse")},1000);return 1}this.closeRouting();this.currentStation=D;var v=50;var r='<div id="train_station">';r+='  <div class="head">'+t_train_station_name.replace("%COUNT%",D)+"</div>";if(!train.data.data.stations_unlock[D]||!train.data.data.stations_unlock[D].unlocked){r+=this.htmlUnlockBlock(D,"station");v=150}else{for(var e in this.data.config.station_slots){r+='<div class="line">';r+='  <div class="count">';r+='    <div class="sub">'+t_train_station_slot_sub_head+"</div>";r+=e+"</div>";r+='  <div class="content">';if(this.data.config.station_slots[e].rent){r+='<div class="rentbanner"><div class="banner"><span>'+t_train_station_slot_rent_banner.toUpperCase()+"</span></div></div>"}var t=0;if(this.data.data.stations&&this.data.data.stations[D]&&this.data.data.stations[D][e]){t=1;if(this.data.config.station_slots[e].rent&&this.data.data.stations[D][e].remain<=0&&!(this.data.data.plans&&this.data.data.plans[D]&&this.data.data.plans[D][e])){t=0}}if(t==1){if(this.data.data.plans&&this.data.data.plans[D]&&this.data.data.plans[D][e]){var G="";if(e>=3){G="bottom"}r+='<div class="rewards" onmouseover="showDiv(\'train_station_slot'+e+"_rewards_tt')\" onmouseout=\"hideDiv('train_station_slot"+e+"_rewards_tt')\">";r+='  <div class="foodworld_star"></div>';r+='  <div id="train_station_slot'+e+'_rewards_tt" class="ttbox">';r+='    <div style="font-weight:bold;">'+forestry_quests_reward+"</div>";for(var C in this.data.data.plans[D][e]["reward"]){if(C=="money"){r+="<div>"+formatPrice(this.data.data.plans[D][e]["reward"][C])+"</div>"}else{if(C=="points"){r+="<div>"+formatNumber(this.data.data.plans[D][e]["reward"][C])+"&nbsp;"+t_points+"</div>"}else{if(C=="train_points"){r+="<div>"+formatNumber(this.data.data.plans[D][e]["reward"][C])+"&nbsp;"+t_train_points+"</div>"}else{if(C=="tools"){for(var B in this.data.data.plans[D][e]["reward"][C]){r+="<div>"+formatNumber(this.data.data.plans[D][e]["reward"][C][B])+"x&nbsp;"+this.data.config.tools[B].name+"</div>"}}else{continue}}}}}r+="  </div>";r+="</div>";var w=this.data.data.plans[D][e];r+='<div class="ontour">';r+='  <div class="train-route">';r+='    <div class="marker station"><span>S'+w.station+"</span></div>";for(var C=0;C<w.traders.length;C++){r+='<div class="arrow"></div>';r+='<div class="marker trader" onmouseover="showDiv(\'train_station_slot'+e+"_trader"+C+"_tt')\" onmouseout=\"hideDiv('train_station_slot"+e+"_trader"+C+"_tt')\">";r+="  <div>T"+w.traders[C]+"</div>";r+='  <div id="train_station_slot'+e+"_trader"+C+'_tt" class="ttbox '+G+'">'+trainGrid.traderTT(w.traders[C],2)+"</div>";r+="</div>"}r+="  </div>";r+='  <div id="train_station'+D+"_slot"+e+'_timer" class="timer">';r+='    <div style="display:flex; justify-content:center; align-items:center; gap:5px;">';r+="      <div>"+t_train_plan_duration+':&nbsp;<span id="train_station'+D+"_slot"+e+'_timer_text"></span></div>';r+='      <div class="speedupgardenbutton link" onclick="train.speedupStationSlotCommit('+e+')"></div>';r+="    </div>";r+="  </div>";r+='  <div class="train-show">';r+='    <div class="img train_train '+this.data.data.trains[w.train].name+'" onmouseover="showDiv(\'train_station'+D+"_slot"+e+"_train_tt')\" onmouseout=\"hideDiv('train_station"+D+"_slot"+e+"_train_tt')\">";r+='      <div id="train_station'+D+"_slot"+e+'_train_tt" class="ttbox">'+this.trainTT(this.data.data.trains[w.train].name,w.train,e)+"</div>";r+="    </div>";for(var m in w.wagons){var G="";if(m>=6){G="right"}r+='<div class="img train_train '+this.data.data.trains[w.wagons[m].id].name+'" onmouseover="showDiv(\'train_station'+D+"_slot"+e+"_wagon"+m+"_tt')\" onmouseout=\"hideDiv('train_station"+D+"_slot"+e+"_wagon"+m+"_tt')\">";r+='  <div id="train_station'+D+"_slot"+e+"_wagon"+m+'_tt" class="ttbox '+G+'">'+this.trainTT(this.data.data.trains[w.wagons[m].id].name,w.wagons[m].id,e)+"</div>";r+="</div>"}r+="  </div>";r+='  <div id="train_station'+D+"_slot"+e+'_claim" class="button_new claim link" onclick="train.claimStationSlot('+D+", "+e+')">'+t_train_station_slot_button_claim+"</div>";r+='  <div id="train_station'+D+"_slot"+e+'_rent_timer" class="timer renttimer"></div>';r+="</div>"}else{var l=this.data.config.station[this.currentStation].starter[e];var s=0;for(var C in trainGrid.routes){if(trainGrid.routes[C].start!=l){continue}if(!trainGrid.traderTiles[trainGrid.routes[C].end]){continue}var n=trainGrid.traderTiles[trainGrid.routes[C].end].trader;if(!this.data.data.traders_unlock[n]||!this.data.data.traders_unlock[n].unlocked){s=-2;break}else{if(this.data.data.traders[n].remain>0){s=-1;break}}s=1;break}r+='<div class="wrapper" style="">';if(s>0){var G="";if(e>=3){G="bottom"}r+='<div class="flex-center-all" style="gap:10px; margin-bottom:10px;">';r+='  <div class="marker station">S'+this.currentStation+"</div>";r+='  <div class="arrow"></div>';r+='  <div class="marker trader" onmouseover="showDiv(\'train_station_slot'+e+"_trader_tt')\" onmouseout=\"hideDiv('train_station_slot"+e+"_trader_tt')\">";r+="    <div>T"+n+"</div>";r+='    <div id="train_station_slot'+e+'_trader_tt" class="ttbox '+G+'">'+trainGrid.traderTT(n,3)+"</div>";r+="  </div>";r+="</div>";r+='<div class="button_new link" onclick="train.startPlan('+D+", "+e+')">'+t_train_station_slot_button_route+"</div>"}else{if(s<0){var G="";if(e>=4){G="bottom"}var a='<div class="marker trader" onmouseover="showDiv(\'train_station'+D+"_slot"+e+"_trader"+n+"_tt')\" onmouseout=\"hideDiv('train_station"+D+"_slot"+e+"_trader"+n+"_tt')\">";a+="  <div>T"+n+"</div>";a+='  <div id="train_station'+D+"_slot"+e+"_trader"+n+'_tt" class="ttbox '+G+'">'+trainGrid.traderTT(n,5)+"</div>";a+="</div>";var u=t_train_station_slot_trader_waiting;if(s==-2){u=t_train_station_slot_trader_locked}r+='<div class="failed flex-center-all">';r+="  <div>"+u.replace("%TRADER%","</div>"+a+"<div>")+"</div>";r+="</div>"}else{r+='<div class="failed">'+t_train_station_slot_none_route+"</div>"}}r+='  <div id="train_station'+D+"_slot"+e+'_rent_timer" class="timer renttimer"></div>';r+="</div>"}}else{var A="train.buyStationSlotCommit("+D+", "+e+")";if(this.data.config.station_slots[e].tools){var q=0;var d="";var c=1;for(var F in this.data.config.station_slots[e].tools[this.currentStation]){var G="";var z=0;if(this.data.data.tools&&this.data.data.tools[F]){z=this.data.data.tools[F]}if(+z<+this.data.config.station_slots[e].tools[this.currentStation][F]){G="failed";c=0}d+='<div class="slot" onmouseover="showDiv(\'train_station_line_tools_tool_'+F+"_tt')\" onmouseout=\"hideDiv('train_station_line_tools_tool_"+F+"_tt')\">";d+='  <div class="train_tool tool_'+F+'"></div>';d+='  <div class="amount '+G+'">'+this.data.config.station_slots[e].tools[this.currentStation][F]+"</div>";d+='  <div id="train_station_line_tools_tool_'+F+'_tt" class="ttbox">'+this.toolsTT(F)+"</div>";d+="</div>";q++}var h="";if(!c){h="off";A=""}var E='<div class="tools" style="--train-station-line-tools-count:'+q+'">'+d+"</div>";var b=t_train_station_slot_button_buy}if(this.data.config.station_slots[e].money){var h="";if(this.data.config.station_slots[e].money>user_bar){h="off";A=""}var b=t_train_station_slot_button_buy;var E=t_train_station_slot_buy.replace("%COST%",'<span class="'+h+'">'+formatPrice(this.data.config.station_slots[e].money)+"</span>")}if(this.data.config.station_slots[e].coins){var h="";if(this.data.config.station_slots[e].coins>user_coins){h="off";A=""}var b=t_train_station_slot_button_buy;var E=t_train_station_slot_buy.replace("%COST%",'<span class="'+h+'">'+this.data.config.station_slots[e].coins+"&nbsp;"+t_coins+"</span>")}if(this.data.config.station_slots[e].rent){var h="";if(this.data.config.station_slots[e].rent.coins>user_coins){h="failed";A=""}var b=t_train_station_slot_button_rent;var E=t_train_station_slot_rent.replace("%COST%",'<span class="'+h+'">'+this.data.config.station_slots[e].rent.coins+"&nbsp;"+t_coins+"</span>").replace("%DURATION%",formatTime(this.data.config.station_slots[e].rent.duration))}r+='<div class="wrapper" style="">';r+='  <div class="cost">'+E+"</div>";r+='  <div class="button_new link '+h+'" onclick="'+A+'">'+b+"</div>";r+="</div>"}r+="  </div>";r+="</div>"}}r+="</div>";globalBoxFlex("",r,0,0,1);$("globalbox").style.top=v+"px";this.setGlobalboxWidescreen();this.timerUpdate()};train.prototype.buyStationSlotCommit=function(c,m){if(this.data.config.station_slots[m].rent){var l=t_train_station_slot_rent_head;var e=t_train_station_slot_rent.replace("%COST%",'<span class="cost">'+this.data.config.station_slots[m].rent.coins+"&nbsp;"+t_coins+"</span>").replace("%DURATION%",formatTime(this.data.config.station_slots[m].rent.duration))}else{var l=t_train_station_slot_buy_head;if(this.data.config.station_slots[m].tools){var b='<div class="tools-list no-back">';for(var a in this.data.config.station_slots[m].tools[this.currentStation]){b+='<div class="slot">';b+='  <div class="train_tool tool_'+a+'"></div>';b+='  <div class="amount">'+this.data.config.station_slots[m].tools[this.currentStation][a]+"</div>";b+="</div>"}b+="</div>";var e=b+"<div>"+t_train_station_slot_buy_tools+"</div>"}else{if(this.data.config.station_slots[m].money){var b=formatPrice(this.data.config.station_slots[m].money)}if(this.data.config.station_slots[m].coins){var b=this.data.config.station_slots[m].coins+"&nbsp;"+t_coins}var e=t_train_station_slot_buy.replace("%COST%",'<span class="cost">'+b+"</span>")}}var d='<div id="train_commit">';d+="  <div>"+e+"</div>";d+="</div>";var n="train.buyStationSlot("+c+", "+m+")";var h="trainGrid.clickStation("+c+")";globalcommitbox(l,d,n,h)};train.prototype.speedupStationSlotCommit=function(e){var d=this.data.data.plans[this.currentStation][e].remain;var b=Math.ceil(d/this.data.config.constants.speedup_station_slot);var a='<div id="train_commit">';a+="  <div>"+t_train_station_slot_speedup_desc.replace("%COST%",'<span class="cost">'+formatNumber(b)+"&nbsp;"+t_coins+"</span>")+"</div>";a+="</div>";var c="train.speedupStationSlot("+this.currentStation+", "+e+")";globalcommitbox(t_train_station_slot_speedup_head,a,c)};train.prototype.openWagons=function(){var b=0;var c='<div class="head">'+t_train_wagons_head+"</div>";var n=this.data.data.trains[this.plan.train].name;c+='<div id="train_wagon_list_tt" class="ttbox"></div>';c+='<div class="list">';for(var e=1;e<=this.data.config.trains[n].wagons;e++){var m="";if(this.plan.wagons&&this.plan.wagons[e]&&this.data.config.trains[this.data.data.trains[this.plan.wagons[e].id].name].slots>6){m="big-line"}c+='<div class="line '+m+'">';c+='  <div class="count">';c+='    <div class="sub">'+t_train_wagons_sub_head+"</div>";c+=e+"</div>";c+='  <div class="content">';if(this.plan.wagons&&this.plan.wagons[e]){var a=this.getCurrentWagonCapacity(e);var h=this.data.data.trains[this.plan.wagons[e].id].name;c+='<div class="img train_train '+h+'" onmouseover="train.hoverWagonSlot(\''+h+"')\" onmouseout=\"hideDiv('train_wagon_list_tt')\"></div>";c+='<div class="load">';c+='  <div class="slots">';for(var l=1;l<=this.data.config.trains[h].slots;l++){c+='<div class="slot link" onclick="train.clickWagonSlot('+e+", "+l+', 1)">';if(this.plan.wagons[e].slots&&this.plan.wagons[e].slots[l]){c+='<div class="pid tt'+this.plan.wagons[e].slots[l].pid+'"></div>';c+='<div class="amount">'+this.plan.wagons[e].slots[l].amount+"</div>";c+='<div id="train_wagon'+e+"_slot"+l+'_remove" class="link close_mini_white" onclick="train.removeWagonSlot('+e+", "+l+');"></div>';b++}else{c+='<div class="drawplus"></div>'}c+="</div>"}c+='    <div class="clear"></div>';c+="  </div>";var d=((a.current*100)/a.max);c+='  <div class="capacity">';c+='    <div class="col">'+t_train_wagons_capacity+":</div>";c+='    <div class="col bar">';c+='      <div class="bar_inner" style="width:'+d+'%"></div>';c+="    </div>";c+='    <div class="col">'+formatNumber(a.current)+"/"+formatNumber(a.max)+"</div>";c+='    <div class="clear"></div>';c+="  </div>";c+="</div>";c+='<div class="clearbtn link" onclick="train.clearWagon('+e+')"></div>'}else{c+='<div class="wrapper" style="">';c+='  <div class="button_new link" onclick="train.currentWagonPos='+e+"; train.openShop('wagon')\">"+t_train_wagons_button_add+"</div>";c+="</div>"}c+="  </div>";c+="</div>"}c+="</div>";c+='<div class="mini_close link" onclick="train.cancelWagons()"></div>';$("train_wagons_main").innerHTML=c;showDiv("train_wagons");$("train_plan_continue_button").addClassName("off");if(b>0){$("train_plan_continue_button").removeClassName("off")}for(var e=1;e<=this.data.config.trains[n].wagons;e++){if(!this.plan.wagons||!this.plan.wagons[e]){continue}for(var l=1;l<=this.data.config.trains[h].slots;l++){if(!this.plan.wagons[e].slots||!this.plan.wagons[e].slots[l]){continue}$("train_wagon"+e+"_slot"+l+"_remove").observe("click",function(q){q.preventDefault();q.stopPropagation();return 1})}}};train.prototype.hoverWagonSlot=function(a){$("train_wagon_list_tt").innerHTML=this.trainTT(a);showDiv("train_wagon_list_tt")};train.prototype.getCurrentWagonCapacity=function(c){var a={};a.max=this.data.data.trains[this.plan.wagons[c].id].maxcapacity;a.current=0;if(this.plan.wagons[c]&&this.plan.wagons[c].slots){for(var b in this.plan.wagons[c].slots){a.current+=this.plan.wagons[c].slots[b].amount}}return a};train.prototype.removeWagonSlot=function(b,a){delete this.plan.wagons[b].slots[a];this.openWagons()};train.prototype.clickWagonSlot=function(m,h,H){if(H==1){this.currentWagonEntryPid=0}var b=this.getCurrentWagonCapacity(m);b.rest=b.max-b.current;var c=((b.current*100)/b.max);this.loaded={};var K=[];if(this.plan.wagons){for(var I in this.plan.wagons){if(!this.plan.wagons[I].slots){continue}for(var G in this.plan.wagons[I].slots){var A=this.plan.wagons[I].slots[G].pid;if(!this.loaded[A]){this.loaded[A]=0}this.loaded[A]+=this.plan.wagons[I].slots[G].amount;if(I==m&&h!=G){K.push(A)}}}}var L=[];var q=0;this.allProducts={};if(this.plan.trader){for(var I=0;I<this.plan.trader.length;I++){if(!this.data.data.traders||!this.data.data.traders[this.plan.trader[I]]){continue}for(var A in this.data.data.traders[this.plan.trader[I]].cart){if(!+A||!produkt_name[A]){continue}if(!this.allProducts[A]){this.allProducts[A]={have:0,need:0}}this.allProducts[A].have+=this.data.data.traders[this.plan.trader[I]].cart[A].have;this.allProducts[A].need+=this.data.data.traders[this.plan.trader[I]].cart[A].need;if(in_array(A,K)){continue}if(this.data.data.traders[this.plan.trader[I]].cart[A].have>=this.data.data.traders[this.plan.trader[I]].cart[A].need){continue}if(this.loaded[A]&&(this.data.data.traders[this.plan.trader[I]].cart[A].have+this.loaded[A])>=this.data.data.traders[this.plan.trader[I]].cart[A].need){continue}var F=produkt_category[A];if(!in_array(F,this.data.config.trains[this.data.data.trains[this.plan.wagons[m].id].name].products)){continue}var e=checkRackItem(A);if(this.loaded[A]){e-=this.loaded[A]}if(e<=0){continue}if(!q){q=A}if(!in_array(A,L)){L.push(+A)}}}}if(this.currentWagonEntryPid>0&&in_array(this.currentWagonEntryPid,L)){q=this.currentWagonEntryPid}else{this.currentWagonEntryPid=q}var r=0;if(H==1&&this.plan.wagons&&this.plan.wagons[m]&&this.plan.wagons[m].slots&&this.plan.wagons[m].slots[h]){q=this.plan.wagons[m].slots[h].pid;r=1}var E=0;if(this.allProducts[q]){E=this.allProducts[q].need}if(this.plan.wagons){for(var I in this.plan.wagons){if(!this.plan.wagons[I].slots){continue}for(var G in this.plan.wagons[I].slots){var A=this.plan.wagons[I].slots[G].pid;if(I==m&&h==G&&A==q){E=this.plan.wagons[I].slots[G].amount;this.loaded[A]-=this.plan.wagons[I].slots[G].amount}}}}var e=checkRackItem(q);if(this.loaded[q]){e-=this.loaded[q]}if(e<E){E=e}var s=this.data.data.trains[this.plan.wagons[m].id].name;var u='<div id="train_commit" style="width:500px;">';u+='  <div class="tinfo">';u+='    <div class="flex-center-all" style="margin-bottom:5px;">';u+='      <div class="train_train '+s+'"></div>';u+="      <div>";if(this.data.config.trains[s].products){u+='<div class="wproducts flex-center-all" style="justify-content:left;">';for(var G=0;G<this.data.config.trains[s].products.length;G++){u+='<div class="icon cmenue_'+this.data.config.trains[s].products[G]+'"></div>'}u+="</div>"}u+="      </div>";u+="    </div>";u+='    <div class="capacity flex-center-all">';u+='      <div style="font-weight:bold;">'+t_train_wagons_capacity+":</div>";u+='      <div class="bar" style="margin:0px 5px;">';u+='        <div id="train_wagon_barinner2" class="bar_inner bar_inner2"></div>';u+='        <div id="train_wagon_barinner" class="bar_inner" style="width:'+c+'%"></div>';u+="      </div>";u+='      <div><span id="train_wagon_currentcapacity">'+formatNumber(b.current)+"</span>/"+formatNumber(b.max)+"</div>";u+='      <div class="clear"></div>';u+="    </div>";u+="  </div>";var D="train.setWagonSlotProduct("+q+", "+m+", "+h+")";var B=0;u+='<div class="entry2">';if(!r&&b.rest<=0){u+='<div class="is-failed">'+t_train_wagons_no_capacity+"</div>";B=1}else{if(!q){u+='<div class="is-failed">'+t_train_wagons_no_product+"</div>";B=1}else{u+='<div class="tt'+q+'" style="top:0px; border-radius:5px;">';u+='  <div class="icon cmenue_'+produkt_category[q]+'"></div>';u+="</div>";u+="<div>";u+='  <input id="train_products_entry" type="number" value="'+E+'" onchange="train.checkWagonProductsEntry('+q+", "+m+", "+h+')" onkeyup="train.checkWagonProductsEntry('+q+", "+m+", "+h+')"></input>';u+='  <div style="margin-top:5px; text-align:left;">'+t_inner_stock+"&nbsp;"+formatNumber(e)+"</div>";u+="</div>";u+='<div id="train_products_button" class="button_new link" style="position:absolute; padding:10px; font-weight:bold; right:5px; top:auto;" onclick="'+D+'">'+t_spicehouse_oven_product_entry_button+"</div>"}}u+="</div>";u+='<div style="margin-bottom:5px;">'+t_train_wagons_products_overview+"</div>";u+='<div class="plist">';var a="";var z="";for(var A in this.allProducts){var C=this.allProducts[A].have;var M=((C*100)/this.allProducts[A].need);var J=0;if(this.loaded[A]){C+=this.loaded[A];J=((C*100)/this.allProducts[A].need)}var d=0;if(A==q){C+=E;d=((C*100)/this.allProducts[A].need)}var v="";if(!in_array(produkt_category[A],this.data.config.trains[this.data.data.trains[this.plan.wagons[m].id].name].products)){v="filter:grayscale(1); opacity:0.5;"}var t='<div class="pline" style="'+v+'">';t+='  <div class="l'+A+'" style="top:0px; border-radius:5px;">';t+='    <div class="icon cmenue_'+produkt_category[A]+'"></div>';t+="  </div>";t+='  <div class="">';t+='    <div style="margin-bottom:5px;">';t+='      <div style="float:left; text-align:left;">'+produkt_name[A]+"</div>";t+='      <div style="float:right; text-align:right;"><span id="train_wagon_slot_'+A+'_current">'+C+"</span>/"+this.allProducts[A].need+"</div>";t+='      <div class="clear"></div>';t+="    </div>";t+='    <div style="position:relative; width:315px; height:12px; background-color:black; border-radius:5px; overflow:hidden;">';t+='      <div id="train_wagon_slot_'+A+'_barcurrent" class="bar-color3" style="position:absolute; top:0px; left:0px; height:100%; width:'+d+'%;"></div>';t+='      <div class="bar-color2" style="position:absolute; top:0px; left:0px; height:100%; width:'+J+'%;"></div>';t+='      <div class="bar-color1" style="position:absolute; top:0px; left:0px; height:100%; width:'+M+'%;"></div>';t+="    </div>";t+="  </div>";if(!B&&in_array(A,L)&&!(A!=q&&C>=this.allProducts[A].need)){var D="train.prefillWagonSlotProduct("+A+", "+m+", "+h+")";t+='<div class="button_new link" style="width:100px;" onclick="'+D+'">'+t_train_shop_select_button+"</div>"}t+="</div>";if(v!=""){z+=t}else{a+=t}}u+=a+z;u+="</div>";u+='<div style="display:flex; justify-content:left; align-items:center; gap:10px; margin-top:5px;">';for(var I=1;I<=3;I++){u+='<div style="display:flex; justify-content:left; align-items:center; gap:5px;">';u+='  <div class="bar-info bar-color'+I+'"></div>';u+="  <div>"+t_train_wagon_slots_desc[I]+"</div>";u+="</div>"}u+="</div>";u+="</div>";globalBoxFlex(t_spicehouse_oven_product_entry_head,u,0,0,1);hideDiv("globalbox_footer");$("globalbox").style.top="65px";this.setGlobalboxWidescreen();if($("train_products_entry")){$("train_products_entry").focus()}this.checkWagonProductsEntry(q,m,h);return 1;var b=this.getCurrentWagonCapacity(m);var w=b.max-b.current;var c=((b.current*100)/b.max);var K=[];var E=1;if(w<=0){E=0}if(this.plan.wagons[m].slots){for(var I in this.plan.wagons[m].slots){if(+I==h){E=this.plan.wagons[m].slots[I].amount;continue}K.push(this.plan.wagons[m].slots[I].pid)}}var q=0;var L=[];var n=0;this.allProducts={};if(this.plan.trader){for(var I=0;I<this.plan.trader.length;I++){if(!this.data.data.traders||!this.data.data.traders[this.plan.trader[I]]){continue}for(var A in this.data.data.traders[this.plan.trader[I]].cart){if(!+A||!produkt_name[A]){continue}if(!this.allProducts[A]){this.allProducts[A]={have:0,need:0}}this.allProducts[A].have+=this.data.data.traders[this.plan.trader[I]].cart[A].have;this.allProducts[A].need+=this.data.data.traders[this.plan.trader[I]].cart[A].need;if(in_array(A,K)){continue}if(this.data.data.traders[this.plan.trader[I]].cart[A].have>=this.data.data.traders[this.plan.trader[I]].cart[A].need){continue}var F=produkt_category[A];if(!in_array(F,this.data.config.trains[this.data.data.trains[this.plan.wagons[m].id].name].products)){continue}var e=checkRackItem(A);if(e<=0){continue}if(!q){q=A}if(!in_array(A,L)){L.push(+A)}}}}if(this.currentWagonEntryPid>0&&in_array(this.currentWagonEntryPid,L)){q=this.currentWagonEntryPid}else{this.currentWagonEntryPid=q}var e=checkRackItem(q);if(E>e){E=e}var D="train.setWagonSlotProduct("+q+", "+m+", "+h+")";var u='<div id="train_commit">';var s=this.data.data.trains[this.plan.wagons[m].id].name;u+='<div class="train-info">';u+='  <div class="train_train '+s+'"></div>';u+='  <div style="font-weight:bold;">'+this.data.config.trains[s].name+"</div>";if(this.data.config.trains[s].products){u+='<div class="wproducts flex-center-all">';for(var G=0;G<this.data.config.trains[s].products.length;G++){u+='<div class="icon cmenue_'+this.data.config.trains[s].products[G]+'"></div>'}u+="</div>"}u+="</div>";u+='  <div class="capacity">';u+='    <div style="margin-bottom:5px; font-weight:bold;">'+t_train_wagons_capacity+":</div>";u+='    <div class="bar">';u+='      <div id="train_wagon_barinner2" class="bar_inner bar_inner2"></div>';u+='      <div id="train_wagon_barinner" class="bar_inner" style="width:'+c+'%"></div>';u+="    </div>";u+='    <div style="margin-bottom:10px;"><span id="train_wagon_currentcapacity">'+formatNumber(b.current)+"</span>/"+formatNumber(b.max)+"</div>";u+="  </div>";if(L.length){u+='<div class="product">';u+='  <div style="margin-bottom:5px; font-weight:bold;">'+t_help_new_product+":</div>";if(this.plan.wagons[m].slots&&this.plan.wagons[m].slots[h]){u+='<div class="pid tt'+this.plan.wagons[m].slots[h].pid+'"></div>';u+='<div style="font-weight:bold;">'+produkt_name[this.plan.wagons[m].slots[h].pid]+"</div>"}else{u+='<div class="current link" onclick="train.expandWagonList()">';u+='  <div class="line2">';u+='    <div class="col1 kp'+q+'"></div>';u+='    <div class="col2">'+produkt_name[q]+"</div>";u+="  </div>";u+="</div>";u+='<div id="train_wagon_selector" class="selector link" onclick="train.expandWagonList()"></div>';u+='<div class="clear"></div>'}var l="";if(w<=0){l="off"}u+='    <div class="entry">';u+='      <input id="train_products_entry" type="number" value="'+E+'" onchange="train.checkWagonProductsEntry('+q+", "+m+", "+h+')" onkeyup="train.checkWagonProductsEntry('+q+", "+m+", "+h+')"></input>';u+='      <div class="stock">'+t_inner_stock+"&nbsp;"+formatNumber(e)+"</div>";u+='      <div id="train_products_button" class="button_new '+l+' link" onclick="'+D+'">'+t_spicehouse_oven_product_entry_button+"</div>";u+='      <div class="clear"></div>';u+="    </div>";u+='    <div id="train_products_list" class="list2">';if(L.length){for(var I=0;I<L.length;I++){var A=L[I];u+='<div class="line2 link" onclick="train.selectWagonProduct('+A+", "+m+", "+h+')">';u+='  <div class="col1 kp'+A+'"></div>';u+='  <div class="col2">'+produkt_name[A]+"</div>";u+="</div>"}}u+="  </div>";u+='<div class="overview">';u+='  <div style="margin-bottom:5px;">'+t_train_wagons_products_overview+"</div>";u+='  <div class="products">';for(var A in this.allProducts){var l="link";var D="train.prefillWagonSlotProduct("+A+", "+m+", "+h+")";var F=produkt_category[A];if(!in_array(F,this.data.config.trains[this.data.data.trains[this.plan.wagons[m].id].name].products)||!in_array(A,L)){l="off";D=""}u+='<div style="position:relative;" onclick="'+D+'" onmouseover="showDiv(\'train_wagon_slot_product'+A+"_tt')\" onmouseout=\"hideDiv('train_wagon_slot_product"+A+"_tt')\">";u+='  <div class="l'+A+" "+l+'"></div>';u+="  <div>"+this.allProducts[A].have+"/"+this.allProducts[A].need+"</div>";u+='  <div id="train_wagon_slot_product'+A+'_tt" class="ttbox">'+produkt_name[A]+"</div>";u+='  <div class="icon cmenue_'+F+'"></div>';u+="</div>"}u+="  </div>";u+='  <div style="font-style:italic; margin-top:5px;">'+t_train_wagons_products_overview_click+"</div>";u+="</div>";u+="</div>"}else{u+="<div>"+t_train_wagons_no_product+"</div>"}u+="</div>";globalBoxFlex(t_spicehouse_oven_product_entry_head,u,0,0,1);hideDiv("globalbox_footer");$("globalbox").style.top="65px";$("globalbox").style.marginLeft="-200px";this.setGlobalboxWidescreen()};train.prototype.prefillWagonSlotProduct=function(a,c,b){if(!$("train_products_entry")||!this.allProducts[a]){return 1}this.selectWagonProduct(a,c,b);$("train_products_entry").value=(+this.allProducts[a].need-+this.allProducts[a].have);this.checkWagonProductsEntry(a,c,b)};train.prototype.setWagonSlotProduct=function(a,d,c){var b=+$("train_products_entry").value;if(!this.plan.wagons[d].slots){this.plan.wagons[d].slots={}}this.plan.wagons[d].slots[c]={pid:a,amount:b};hideDiv("globalbox");hideDiv("globaltransp");this.openWagons()};train.prototype.checkWagonProductsEntry=function(b,m,l){if(!$("train_products_entry")){return 1}var a=this.getCurrentWagonCapacity(m);if(this.plan.wagons[m].slots&&this.plan.wagons[m].slots[l]){a.current-=this.plan.wagons[m].slots[l].amount}a.rest=a.max-a.current;var e=0;var d=0;if(this.allProducts[b]){e=this.allProducts[b].have;d=this.allProducts[b].need}if(this.loaded[b]){e+=this.loaded[b]}d-=e;var c=+$("train_products_entry").value;var h=checkRackItem(b);if(this.loaded[b]){h-=this.loaded[b]}if(c>h){c=h}if(c>a.rest){c=a.rest}if(c>d){c=d}if(c<0){c=0}$("train_products_entry").value=c;$("train_wagon_currentcapacity").innerHTML=formatNumber(+a.current+c);$("train_wagon_barinner").style.width=((+a.current*100)/a.max)+"%";$("train_wagon_barinner2").style.width=(((+a.current+c)*100)/a.max)+"%";if($("train_wagon_slot_"+b+"_barcurrent")){$("train_wagon_slot_"+b+"_current").innerHTML=e+c;$("train_wagon_slot_"+b+"_barcurrent").style.width=((e+c)*100/this.allProducts[b].need)+"%"}$("train_products_button").removeClassName("off");if(c<=0){$("train_products_button").addClassName("off")}};train.prototype.selectWagonProduct=function(a,c,b){this.currentWagonEntryPid=a;this.clickWagonSlot(c,b)};train.prototype.expandWagonList=function(){$("train_wagon_selector").removeClassName("closed");if($("train_products_list").style.display=="block"){hideDiv("train_products_list")}else{showDiv("train_products_list");$("train_wagon_selector").addClassName("closed")}};train.prototype.clearWagon=function(a){delete this.plan.wagons[a];this.showPlan()};train.prototype.cancelWagons=function(){hideDiv("train_wagons");this.plan.step--;this.showPlan()};train.prototype.closeWagons=function(){hideDiv("train_wagons")};train.prototype.openTrader=function(d){var c='<div id="train_trader">';c+='  <div class="head">'+this.data.config.trader[d].name+"</div>";if(this.data.data.traders_unlock[d]&&this.data.data.traders_unlock[d].unlocked){c+='<div id="train_trader'+d+'_info_cart" class="cart">';c+='  <div class="name">'+t_train_trader_info_cart+"</div>";c+='    <div class="flex-center-all" style="flex-wrap:wrap; justify-content:left; gap:0px 20px;">';for(var a in this.data.data.traders[d].cart){var e=(this.data.data.traders[d].cart[a].have*100)/this.data.data.traders[d].cart[a].need;c+='<div class="line">';c+='  <div class="img l'+a+'"></div>';c+='  <div style="text-align:left;">';c+='    <div style="font-weight:bold;">'+produkt_name[a]+"</div>";c+='    <div class="bar">';c+='      <div class="bar_inner" style="width:'+e+'%"></div>';c+="    </div>";c+="    <div>"+formatNumber(this.data.data.traders[d].cart[a].have)+"/"+formatNumber(this.data.data.traders[d].cart[a].need)+"</div>";c+="  </div>";c+="</div>"}c+="  </div>";c+="</div>"}else{c+=this.htmlUnlockBlock(d,"trader")}if(this.data.data.traders[d]){c+='<div class="tools">';c+='  <div class="name">'+t_train_trader_info_tools+"</div>";c+='  <div class="desc">'+t_train_trader_info_tools_desc+"</div>";c+='<div class="slots">';for(var b in this.data.data.traders[d].tools){c+='<div class="slot" onmouseover="showDiv(\'train_trader'+d+"_tool_"+b+"_tt')\" onmouseout=\"hideDiv('train_trader"+d+"_tool_"+b+"_tt')\">";c+='  <div class="train_tool tool_'+b+'"></div>';c+='  <div class="amount">'+this.data.data.traders[d].tools[b]+"</div>";c+='  <div id="train_trader'+d+"_tool_"+b+'_tt" class="ttbox">'+this.toolsTT(b)+"</div>";c+="</div>"}c+="  </div>";c+="</div>"}c+='  <div id="train_trader'+d+'_info_timer" class="timer" style="margin-top:10px;"></div>';c+='  <div class="trader-char train_char">'+this.buildTraderChar(d)+"</div>";c+="</div>";globalBoxFlex("",c,0,0,1);$("globalbox").style.top="150px";this.setGlobalboxWidescreen();this.timerUpdate()};train.prototype.speedupTraderWaitingCommit=function(d){var b=Math.ceil(this.data.data.traders[d].remain/this.data.config.constants.trader_cart_waiting_speedup);var a='<div id="train_commit">';a+="  <div>"+t_train_trader_waiting_speedup_desc.replace("%COST%",'<span class="cost">'+b+"&nbsp;"+t_coins+"</span>")+"</div>";a+="</div>";var e="train.speedupTraderWaiting("+d+")";var c="train.openTrader("+d+")";globalcommitbox(t_train_trader_waiting_speedup_head,a,e,c)};train.prototype.buildTraderChar=function(d){var a=this.data.config.trader[d]["char"];var c="";for(var d in a){if(in_array(d,["skin"])){continue}if(in_array(d,["body","face"])){var b=d+a.skin+"_"+a[d]}else{var b=d+a[d]}c+='<div class="part '+b+'"></div>'}return c};train.prototype.unlockCommit=function(a,d,l){var n=this.data.config[l][a].unlock[d];var e=0;if(this.data.data[l+"s_unlock"][a]&&this.data.data[l+"s_unlock"][a][d]){e=this.data.data[l+"s_unlock"][a][d]}var h=((e*100)/n);var q="train.unlock("+a+", '"+d+"', '"+l+"')";if(l=="trader"){var m="train.openTrader("+a+")"}if(l=="station"){var m="train.openStation("+a+")"}var c=this.data.data.tools[d];var b='<div id="train_commit">';b+='  <div style="margin:-10px 0px 10px 0px;">'+t_train_unlock_info_entry_desc[l].replace("%NAME%",this.data.config.tools[d].name)+"</div>";b+='  <div class="info">';b+='    <div class="train_tool tool_'+d+'"></div>';b+='    <div class="bar">';b+='      <div id="train_unlock_barinner2" class="bar_inner2"></div>';b+='      <div id="train_unlock_barinner" class="bar_inner" style="width:'+h+'%"></div>';b+='      <div class="amount"><span id="train_unlock_current">'+formatNumber(e)+"</span>/"+formatNumber(n)+"</div>";b+="    </div>";b+="  </div>";b+='  <div class="entry">';b+='    <input id="train_unlock_entry" type="number" value="1" onchange="train.checkUnlockEntry('+a+", '"+d+"', '"+l+'\')" onkeyup="train.checkUnlockEntry('+a+", '"+d+"', '"+l+"')\"></input>";b+='    <div class="stock">'+t_train_info_instock+":&nbsp;"+formatNumber(c)+"</div>";b+='    <div class="button_new link" onclick="'+q+'">'+t_train_trader_info_unlock_button+"</div>";b+='    <div class="clear"></div>';b+="  </div>";b+="</div>";globalcommitbox(t_train_unlock_info_entry_head[l].replace("%NAME%",this.data.config.tools[d].name),b,0,m,1);this.checkUnlockEntry(a,d,l)};train.prototype.checkUnlockEntry=function(b,e,m){var n=this.data.config[m][b].unlock[e];var h=0;if(this.data.data[m+"s_unlock"][b]&&this.data.data[m+"s_unlock"][b][e]){h=this.data.data[m+"s_unlock"][b][e]}var l=((h*100)/n);var a=(n-h);var d=this.data.data.tools[e];var c=$("train_unlock_entry").value;c=parseInt(c);if(isNaN(c)||c<=0){c=1}$("train_unlock_barinner").style.width=l+"%";if(c>d){c=d}if(c>a){c=a}$("train_unlock_entry").value=c;l=(((h+c)*100)/n);$("train_unlock_barinner2").style.width=l+"%";$("train_unlock_current").innerHTML=(h+c)};train.prototype.htmlUnlockBlock=function(d,e){html='<div class="unlock">';html+='  <div class="name">'+t_train_unlock_info[e]+"</div>";html+='  <div class="desc">'+t_train_unlock_info_desc[e]+"</div>";html+='  <div class="slots">';for(var c in this.data.config[e][d].unlock){var m=0;if(this.data.data.tools&&this.data.data.tools[c]){m=this.data.data.tools[c]}var b="";if(m<=0){b="off"}var a=this.data.config[e][d].unlock[c];var l=0;if(this.data.data[e+"s_unlock"][d]&&this.data.data[e+"s_unlock"][d][c]){l=this.data.data[e+"s_unlock"][d][c]}var h=((l*100)/a);html+='<div class="slot">';html+='  <div class="back" onmouseover="showDiv(\'train_'+e+d+"_info_unlock_"+c+"_tt')\" onmouseout=\"hideDiv('train_"+e+d+"_info_unlock_"+c+"_tt')\">";html+='    <div class="train_tool tool_'+c+'"></div>';html+="  </div>";html+='  <div class="bar">';html+='    <div class="bar_inner" style="width:'+h+'%"></div>';html+='    <div class="amount">'+formatNumber(l)+"/"+formatNumber(a)+"</div>";html+="  </div>";html+='  <div class="instock">'+t_train_info_instock+":&nbsp;"+m+"</div>";html+='  <div id="train_'+e+d+"_info_unlock_"+c+'_tt" class="ttbox">'+this.toolsTT(c)+"</div>";if(+a>+l){html+='<div class="button_new link '+b+'" onclick="train.unlockCommit('+d+", '"+c+"', '"+e+"')\">"+t_train_trader_info_unlock_button+"</div>"}html+="</div>"}html+="  </div>";html+="</div>";return html};train.prototype.openResearch=function(){var b=this.researchPoints();var e=(+b.points-+b.used);var a="";if(!b.used){a="off"}var d='<div id="train_research">';d+='  <div class="head">'+t_train_main_button_head.research+"</div>";d+='  <div class="points">';d+="    <div>"+t_train_research_points_line.replace("%COUNT%",'<span class="count">'+formatNumber(e)+"</span>")+"</div>";d+='    <div class="helpbutton_blue link" onclick="train.helpOpen(\'research\')"></div>';d+='    <div class="button_new link '+a+'" onclick="train.resetResearchCommit()">'+t_train_research_reset_button+"</div>";d+="  </div>";d+=this.buildResearchNavi();d+='  <div id="train_research_scroll_list" class="list">';if(this.researchTab=="trains"){for(var c in this.data.config.trains){if(this.data.config.trains[c].category!="train"){continue}d+=this.buildResearchLine(this.researchTab,c,e)}}if(this.researchTab=="wagons"){for(var c in this.data.config.trains){if(this.data.config.trains[c].category!="wagon"){continue}d+=this.buildResearchLine(this.researchTab,c,e)}}if(this.researchTab=="trader"){for(var c in this.data.config.trader){d+=this.buildResearchLine(this.researchTab,c,e)}}d+="  </div>";d+="</div>";globalBoxFlex("",d,0,0,1);this.setGlobalboxWidescreen();this.buildResearchNavi()};train.prototype.buildResearchLine=function(l,b,c){var n=(+this.data.config.research.levels+ +this.data.config.research.overload);var h=0;if(this.data.data.research&&this.data.data.research[l]&&this.data.data.research[l][b]){h=this.data.data.research[l][b].level}var e='<div class="line line-'+l+'">';e+='  <div class="col1 flex-center-all">';if(in_array(l,["trains","wagons"])){e+='<div class="train_train '+b+'" onmouseover="showDiv(\'train_research_'+l+"_"+b+"_tt')\" onmouseout=\"hideDiv('train_research_"+l+"_"+b+"_tt')\">";e+='  <div id="train_research_'+l+"_"+b+'_tt" class="ttbox">'+this.trainTT(b)+"</div>";e+="</div>"}else{var r="";for(var d in this.data.config.trader){}if(+b==+d){r="bottom"}e+='<div class="trader-char train_char" onmouseover="showDiv(\'train_research_'+l+"_"+b+"_tt')\" onmouseout=\"hideDiv('train_research_"+l+"_"+b+"_tt')\">";e+="  <div>"+this.buildTraderChar(b)+"</div>";e+='  <div id="train_research_'+l+"_"+b+'_tt" class="ttbox '+r+'">'+trainGrid.traderTT(b,0,0,1)+"</div>";e+="</div>"}e+="  </div>";e+='  <div class="col2">';if(in_array(l,["trains","wagons"])){e+='<div class="name">'+this.data.config.trains[b].name+"</div>"}else{e+='<div class="flex-center-all" style="justify-content:left;">';e+='  <div class="marker trader">T'+b+"</div>";e+='  <div class="name">'+this.data.config.trader[b].name+"</div>";e+="</div>"}e+='    <div class="flex-center-all" style="justify-content:left;">';e+='      <div class="levels flex-center-all">';for(var d=1;d<=n;d++){var r="";if(d>this.data.config.research.levels){r+=" overload"}if(d<=h){r+=" active"}e+='<div class="level '+r+'"></div>'}e+="      </div>";var r="";if(c<=0){r="off"}if(h<n){e+='<div id="train_research_update_'+l+"_"+b+'" class="update flex-center-all link '+r+'" onclick="train.upgradeResearchCommit(\''+l+"', '"+b+"')\"><span>+</span></div>"}e+='      <div class="levels-count">'+formatNumber(h)+"/"+formatNumber(n)+"</div>";e+="    </div>";e+='    <div class="flex-center-all" style="align-items:baseline;">';e+='      <div class="bonus">';e+='        <div class="bold">'+t_train_research_current_name+"</div>";for(var d in this.data.config.research[l]){if(this.data.data.research&&this.data.data.research[l]&&this.data.data.research[l][b]){var q=(this.data.data.research[l][b].level*this.data.config.research[l][d])}else{var q=0}var s="+";if(in_array(d,["timebonus"])){s="-"}e+='<div class="bcol1">'+t_train_research_bonus[d]+"</div>";e+='<div class="bcol2">'+s+Math.round(q*100)+"%</div>";e+='<div class="clear"></div>'}e+="      </div>";var m=1;if(this.data.data.research&&this.data.data.research[l]&&this.data.data.research[l][b]){if(this.data.data.research[l][b].level>=(+this.data.config.research.levels+ +this.data.config.research.overload)){m=0}}if(m==1){var a=1;if(this.data.data.research&&this.data.data.research[l]&&this.data.data.research[l][b]){var a=(this.data.data.research[l][b].level+1)}e+='<div class="bonus">';e+='  <div class="bold">'+t_train_research_next_name+"</div>";for(var d in this.data.config.research[l]){var q=(a*this.data.config.research[l][d]);var s="+";if(in_array(d,["timebonus"])){s="-"}e+='<div class="bcol1">'+t_train_research_bonus[d]+"</div>";e+='<div class="bcol2">'+s+Math.round(q*100)+"%</div>";e+='<div class="clear"></div>'}e+="</div>"}e+="    </div>";e+="  </div>";e+="</div>";return e};train.prototype.buildResearchNavi=function(){var c='<div class="navi flex-center-all">';for(var b in this.data.config.research){if(in_array(b,["levels","overload"])){continue}var a="";if(this.researchTab==b){a="active"}c+='<div class="tab '+a+' link flex-center-all" onclick="train.clickResearchNavi(\''+b+"')\">";c+='  <div class="icon is-'+b+'"></div>';c+="</div>"}c+="</div>";return c};train.prototype.clickResearchNavi=function(a){this.researchTab=a;this.openResearch()};train.prototype.upgradeResearchCommit=function(d,m){train.researchScrollPosition=$("train_research_scroll_list").scrollTop;if(this.data.data.research&&this.data.data.research[d]&&this.data.data.research[d][m]&&this.data.data.research[d][m].level>=this.data.config.research.levels){var l=(this.data.data.research[d][m].level-this.data.config.research.levels);var c=this.data.config[d][m].name;var h=this.data.config.research_overload[(l+1)].points;var e="train.upgradeResearch('"+d+"', '"+m+"')";var b="train.openResearch()";var a='<div id="train_commit">';a+="  <div>"+t_train_research_overload_desc.replace("%NAME%",c).replace("%COST%",'<span class="cost">'+formatNumber(h)+"&nbsp;"+t_train_points+"</span>");a+="</div>";globalcommitbox(t_train_research_overload_head,a,e,b)}else{this.upgradeResearch(d,m)}if($("train_research_update_"+d+"_"+m)){$("train_research_update_"+d+"_"+m).addClassName("off")}};train.prototype.resetResearchCommit=function(){var d='<span class="cost">'+this.data.config.constants.research_reset_coins+"&nbsp;"+t_coins+"</span>";var c="train.resetResearch()";var b="train.openResearch()";var a='<div id="train_commit">';a+='  <div style="margin-bottom:10px;">'+t_train_research_reset_desc.replace("%COST%",d)+"</div>";a+='  <div style="margin-bottom:10px;">'+t_train_research_reset_info1+"</div>";a+='  <div class="hint">'+t_train_research_reset_info2+"</div>";a+="</div>";globalcommitbox(t_train_research_reset_head,a,c,b)};train.prototype.researchPoints=function(){var d=0;for(var b=1;b<=this.data.data.level;b++){d+=b}var c=0;if(this.data.data.research){for(var b in this.data.data.research){for(var a in this.data.data.research[b]){if(!this.data.data.research[b][a].level){continue}c+=this.data.data.research[b][a].level}}}return{points:d,used:c}};train.prototype.scrollToResearch=function(a,b){$("train_research_scroll_list").scrollTop=train.researchScrollPosition};train.prototype.openTools=function(){var d='<div id="train_tools">';d+='  <div class="head">'+t_train_main_button_head.tools+"</div>";d+='  <div class="desc">'+t_train_tools_desc+"</div>";d+='  <div class="tools">';var e=1;for(var b in this.data.config.tools){var c=0;if(this.data.data.tools&&this.data.data.tools[b]){c=this.data.data.tools[b]}var a="";if(in_array(e,[5])){a="right"}d+='<div class="tool" onmouseover="showDiv(\'train_tools_'+b+"_tt')\" onmouseout=\"hideDiv('train_tools_"+b+"_tt')\">";d+='  <div class="train_tool tool_'+b+'"></div>';d+='  <div class="amount"><span>'+c+"</span></div>";d+='  <div class="buy link" onclick="train.buyToolCommit(\''+b+"')\">+</div>";d+='  <div id="train_tools_'+b+'_tt" class="ttbox '+a+'">'+this.toolsTT(b)+"</div>";d+="</div>";e++}d+="  </div>";d+="</div>";globalBoxFlex("",d,0,0,1);this.setGlobalboxWidescreen()};train.prototype.buyToolCommit=function(b){var h=0;if(specialbonus){h=specialbonus.findBonus({key1:"train",key2:"buytools"})}var a=this.data.config.tools[b].name;var l="train.openTools()";var d='<div id="train_commit">';d+='  <div class="train_tool tool_'+b+'"></div>';d+='  <div class="name">'+a+"</div>";var e=1;for(var s in this.data.config.tools[b].buy){var c=this.data.config.tools[b].buy[s];var n="";if(h&&e>1){c=Math.ceil(c*(1+h.buytools));n="bonus"}var r="train.buyStockCommitCommit('"+b+"', "+s+", "+c+")";var m="";if(parseInt(s)>parseInt(user_coins)){m="off";r=""}var q=t_train_tools_buy_line.replace("%AMOUNT%",'<span class="'+n+'">'+c+"x</span>").replace("%NAME%","").replace("%COST%",formatNumber(s)+"&nbsp;"+t_coins).replace("?","");d+='<div class="buy coinsbutton_flex link '+m+'" onclick="'+r+'">'+q+"</div>";e++}if(h&&h.buytools){d+='<div class="bonus">('+t_fishing_general_bonus.replace("%PERCENT%",Math.round(h.buytools*100))+")</div>"}d+="</div>";globalBoxFlex(t_train_tools_buy_head.replace("%NAME%",a),d,0,l,1);this.setGlobalboxWidescreen()};train.prototype.buyStockCommitCommit=function(h,b,e){var d=this.data.config.tools[h].name;var l="train.buyTool('"+h+"', "+b+")";var c="train.buyToolCommit('"+h+"')";var a='<div id="train_commit">';a+="  <div>"+t_train_tools_buy_line.replace("%AMOUNT%",e).replace("%NAME%",d).replace("%COST%",'<span class="cost">'+formatNumber(b)+"&nbsp;"+t_coins+"</span>");a+="</div>";globalcommitbox(t_train_tools_buy_head.replace("%NAME%",d),a,l,c)};train.prototype.showStats=function(){var a='<div id="train_stats">';a+='  <div class="select_line">';a+='    <select id="train_stats_select" onchange="train.stats()">';for(var b=0;b<this.stats_options.length;b++){if(this.stats_options[b]==""){a+='<option value="0">---</option>';continue}var c="";if(this.stats_select==this.stats_options[b]){c="selected"}a+='<option value="'+this.stats_options[b]+'" '+c+">"+t_train_stats[this.stats_options[b]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_train_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select],this.stats_select,"train");a+="</div>";globalBoxFlex("",a,0,0,1);this.setGlobalboxWidescreen()};train.prototype.helpOpen=function(a){fhelp.init({type:"train",insert:"train",navi:["grid","general","trader","research","achievements"]});fhelp.open(a)};train.prototype.helpPage=function(d){var c="";if(d=="general"){c='<div class="line flex-center-left">';c+='  <div style="width:50px; height:50px">';c+='    <div style="width:100%; height:100%; border-radius:50px; background-color:#C3A75E;"></div>';c+='    <div class="train-starter" style="position:absolute; top:-13px; left:-15px; width:75px; height:75px; background-size:100%;"></div>';c+="  </div>";c+='  <div style="width:calc(100% - 50px);">';c+='    <div style="margin-bottom:10px;">'+t_train_help_text.general1+"</div>";c+='    <div style="margin-bottom:10px;">'+t_train_help_text.general2+"</div>";c+='    <div style="margin-bottom:10px;">'+t_train_help_text.general3+"</div>";c+='    <div class="tipp" style="margin-bottom:10px;">'+t_train_help_text.general4+"</div>";c+='    <div style="margin-bottom:10px;">'+t_train_help_text.general5+"</div>";c+='    <div class="tipp" style="margin-bottom:10px;">';c+="      <div>"+t_train_help_text.general7+"</div>";c+='      <div style="background-image:url('+imgpath+'train/multi_trader_ani.3.gif); width:310px; height:165px; background-size:100%; margin-top:5px; border-radius:5px;"></div>';c+="    </div>";c+='    <div class="tipp" style="margin-bottom:10px;">'+t_train_help_text.general6+"</div>";c+='    <div style="margin-bottom:10px;">'+t_train_help_text.general8+"</div>";c+='    <div class="line tipp">'+t_train_help_text.general9+"</div>";c+='    <div class="line tipp">'+t_train_help_text.general10+"</div>";c+='    <div class="line">'+t_train_help_text.general11+"</div>";c+='    <div class="line tipp">'+t_train_help_text.general12+"</div>";c+='    <div class="line">'+t_train_help_text.general13+"</div>";c+='    <div class="line tipp">'+t_train_help_text.general14+"</div>";c+="  </div>";c+="</div>"}if(d=="trader"){c+='<div class="line flex-center-left">';for(var b in this.data.config.trader){c+='<div class="trader-char train_char">'+this.buildTraderChar(b)+"</div>"}c+="</div>";c+='<div class="line">'+t_train_help_text.trader1+"</div>";c+='<div class="line" style="background-image:url('+imgpath+'train/route_example.png); width:380px; height:145px; background-size:100%;"></div>';c+='<div class="line tipp">'+t_train_help_text.trader2+"</div>";c+='<div class="line">'+t_train_help_text.trader3+"</div>";c+='<div class="line">'+t_train_help_text.trader4+"</div>";c+='<div class="line flex-center-left">';for(var a in this.data.config.tools){c+='<div class="train_tool tool_'+a+'" style="width:50px; height:48px;"></div>'}c+="</div>";c+='<div class="line">';c+='  <div class="line">'+t_train_help_text.trader5+"</div>";c+="  <ul>";c+="    <li>"+t_train_help_text.trader6+"</li>";c+="    <li>"+t_train_help_text.trader7+"</li>";c+="  </ul>";c+="</div>";c+='<div class="line tipp">'+t_train_help_text.trader8+"</div>";c+='<div class="line tipp">'+t_train_help_text.trader9.replace("%TIME%",formatTime(this.data.config.constants.trader_cart_waiting_time))+"</div>"}if(d=="grid"){c='<div class="line" style="background-image:url('+imgpath+'train/grid_example.png); width:380px; height:62px; background-size:100%;"></div>';c+='<div class="line">'+t_train_help_text.grid1+"</div>";c+='<div class="line flex-center-left">';c+='  <div class="line" style="background-image:url('+imgpath+'train/grid_example_station_trader.png); background-repeat:no-repeat; width:180px; height:180px; background-size:100%;"></div>';c+='  <div style="width:calc(100% - 180px);">';c+='    <div style="margin-bottom:10px;">'+t_train_help_text.grid2+"</div>";c+='    <div style="margin-bottom:10px;">'+t_train_help_text.grid4+"</div>";c+='    <div style="margin-bottom:10px;">'+t_train_help_text.grid3+"</div>";c+="    <div>"+t_train_help_text.grid5+"</div>";c+="  </div>";c+="</div>";c+='<div class="line tipp">'+t_train_help_text.grid6+"</div>";c+='<div class="line tipp">'+t_train_help_text.grid7+"</div>";c+='<div class="line tipp">'+t_train_help_text.grid8+"</div>";c+='<div class="line tipp">'+t_train_help_text.grid9+"</div>"}else{if(d=="research"){c='<div class="line flex-center-left">';c+='  <div class="main-button research" style="width:40px; height:40px; background-repeat:no-repeat;"></div>';c+='  <div style="width:calc(100% - 40px);">'+t_train_help_text.research1+"</div>";c+="</div>";c+='<div class="line">'+t_train_help_text.research2+"</div>";c+='<div class="line flex-center-left">';c+='  <div class="icon is-trains" style="width:40px; height:40px; background-size:100%;"></div>';c+='  <div class="icon is-wagons" style="width:40px; height:40px; background-size:100%;"></div>';c+='  <div class="icon is-trader" style="width:40px; height:40px; background-size:100%;"></div>';c+="</div>";c+='<div class="line">'+t_train_help_text.research3.replace("%MAX%",this.data.config.research.levels)+"</div>";c+='<div class="line tipp">'+t_train_help_text.research4.replace("%COUNT%",this.data.config.research.overload)+"</div>"}else{if(d=="achievements"){c=fhelp.buildAchievements(this.data.config.achievements,this.data.data.achievements)}}}return c};train.prototype.startTutorial=function(a){if(this.data.data.tutorial&&this.data.data.tutorial[a]){return 1}this.tutorialType=a;this.tutorialStep=1;train.showTutorial(1)};train.prototype.nextTutorialStep=function(){this.tutorialStep++;this.showTutorial()};train.prototype.setTutorialVisited=function(){if(this.data.data.tutorial&&this.data.data.tutorial[this.tutorialType]){return 1}if(!this.data.data.tutorial){this.data.data.tutorial={}}this.data.data.tutorial[this.tutorialType]=1;this.setTutorial()};train.prototype.showTutorial=function(){var b=this.tutorialType+"_"+this.tutorialStep;if($("train_grid_tile"+this.data.config.station[1].init)){$("train_grid_tile"+this.data.config.station[1].init).removeClassName("tutorial_marked").removeClassName("pulse")}if($("train_grid_tile"+this.data.config.trader[1].init)){$("train_grid_tile"+this.data.config.trader[1].init).removeClassName("tutorial_marked").removeClassName("pulse")}if($("train_trackstock")){$("train_trackstock").removeClassName("tutorial_marked").removeClassName("pulse")}if(!t_train_tutorial_text[b]){this.closeTutorial();return 1}var c=t_train_tutorial_text[b];c=c.replace("%USERNAME%","<b>"+username+"</b>");var a="";a+='<div class="textt">'+c+"</div>";if(t_train_tutorial_text[this.tutorialType+"_"+(this.tutorialStep+1)]){a+='<div class="next button_new link" onclick="train.nextTutorialStep()">'+t_continue+"</div>"}else{a+='<div class="button_yes link" onclick="train.setTutorialVisited(); train.closeTutorial()"></div>'}$("train_tutorial_bubble").innerHTML=a;showDiv("train_tutorial");if(this.tutorialType=="start"){if(this.tutorialStep==2){$("train_grid_tile"+this.data.config.station[1].init).addClassName("tutorial_marked").addClassName("pulse")}if(this.tutorialStep==3){$("train_grid_tile"+this.data.config.trader[1].init).addClassName("tutorial_marked").addClassName("pulse")}if(this.tutorialStep==4){$("train_trackstock").addClassName("tutorial_marked").addClassName("pulse")}}setTimeout(function(){if($("train_grid_tile"+train.data.config.station[1].init)){$("train_grid_tile"+train.data.config.station[1].init).removeClassName("pulse")}if($("train_trackstock")){$("train_trackstock").removeClassName("pulse")}},1000)};train.prototype.closeTutorial=function(){if($("train_grid_tile"+this.data.config.station[1].init)){$("train_grid_tile"+this.data.config.station[1].init).removeClassName("tutorial_marked").removeClassName("pulse")}if($("train_trackstock")){$("train_trackstock").removeClassName("tutorial_marked").removeClassName("pulse")}if(!$("train_tutorial")){return 1}setTimeout(function(){hideDiv("train_tutorial")},200)};train.prototype.timer=function(){if(!this.data.data){return 1}if(this.data.data.stations){for(var a in this.data.data.stations){for(var c in this.data.data.stations[a]){this.data.data.stations[a][c].remain--}}}if(this.data.data.traders){for(var a in this.data.data.traders){this.data.data.traders[a].remain--}}if(this.data.data.plans){for(var b in this.data.data.plans){for(var c in this.data.data.plans[b]){this.data.data.plans[b][c].remain--}}}this.data.data.starterpack.remain--;this.timerUpdate()};train.prototype.timerUpdate=function(){if(!$("train")||$("train").style.display!="block"||!this.data.data){return 1}if(this.data.data.stations){for(var n in this.data.data.stations){for(var m in this.data.data.stations[n]){if(!$("train_station"+n+"_slot"+m+"_rent_timer")||!this.data.config.station_slots[m].rent){continue}hideDiv("train_station"+n+"_slot"+m+"_rent_timer");var e="<div>"+t_pony_rentresttime+":&nbsp;"+formatTime(this.data.data.stations[n][m].remain)+"</div>";if(this.data.data.stations[n][m].remain>0){$("train_station"+n+"_slot"+m+"_rent_timer").innerHTML=e;showDiv("train_station"+n+"_slot"+m+"_rent_timer")}else{if(this.data.config.station_slots[m].rent&&this.data.data.plans&&this.data.data.plans[n]&&this.data.data.plans[n][m]){$("train_station"+n+"_slot"+m+"_rent_timer").innerHTML=t_events_timeline_timer_expired;showDiv("train_station"+n+"_slot"+m+"_rent_timer")}else{if(this.data.data.stations[n][m].remain==-1){this.data.data.stations[n][m].remain=-2;trainGrid.clickStation(n)}}}}}}if(this.data.data.traders){for(var d in this.data.data.traders){for(var b=1;b<=5;b++){hideDiv("traingrid_tile"+this.data.config.trader[d].init+"_forbidden");hideDiv("train_trader"+d+"_tt"+b+"_waiting_timer");showDiv("train_trader"+d+"_tt"+b+"_cart");showDiv("train_trader"+d+"_tt"+b+"_clicker");hideDiv("train_trader"+d+"_info_timer");showDiv("train_trader"+d+"_info_cart");if(this.data.data.traders[d].remain>0){if($("train_trader"+d+"_tt"+b+"_waiting_timer_time")){$("train_trader"+d+"_tt"+b+"_waiting_timer_time").innerHTML=t_train_trader_waiting_info.replace("%TIME%",'<span class="bold">'+formatTime(this.data.data.traders[d].remain)+"</span>")}if($("train_trader"+d+"_info_timer")){var l='<div style="display:flex; justify-content:center; align-items:center; gap:5px;">';l+="  <div>"+t_train_trader_waiting_info.replace("%TIME%",'<span class="bold">'+formatTime(this.data.data.traders[d].remain)+"</span>")+"</div>";l+='  <div class="speedupgardenbutton link" onclick="train.speedupTraderWaitingCommit('+d+')"></div>';l+="</div>";$("train_trader"+d+"_info_timer").innerHTML=l}showDiv("train_trader"+d+"_tt"+b+"_waiting_timer");hideDiv("train_trader"+d+"_tt"+b+"_cart");hideDiv("train_trader"+d+"_tt"+b+"_clicker");showDiv("train_trader"+d+"_info_timer");hideDiv("train_trader"+d+"_info_cart");showDiv("traingrid_tile"+this.data.config.trader[d].init+"_forbidden")}}}}if(this.data.data.plans){for(var n in this.data.data.plans){for(var m in this.data.data.plans[n]){hideDiv("train_station"+n+"_slot"+m+"_timer");hideDiv("train_station"+n+"_slot"+m+"_claim");if(this.data.data.plans[n][m].remain>0){if($("train_station"+n+"_slot"+m+"_timer_text")){$("train_station"+n+"_slot"+m+"_timer_text").innerHTML=formatTime(this.data.data.plans[n][m].remain)}showDiv("train_station"+n+"_slot"+m+"_timer")}else{if($("train_station"+n+"_slot"+m+"_claim")){showDiv("train_station"+n+"_slot"+m+"_claim")}showDiv("train_station"+n+"_slot"+m+"_claim")}var r=[];for(var d=0;d<this.data.data.plans[n][m].routes.length;d++){var q=this.data.data.plans[n][m].routes[d];if(!trainGrid.routes[q]||!trainGrid.routes[q].tiles){continue}for(var b=0;b<trainGrid.routes[q].tiles.length;b++){var h=trainGrid.routes[q].tiles[b];r.push(h)}}var c=this.data.data.plans[n][m].duration;if(this.data.data.plans[n][m].remain>0){c-=this.data.data.plans[n][m].remain}var s=(this.data.data.plans[n][m].duration/2);if(+c>+s){for(var d=r.length;d>0;d--){var h=r[(d-1)];var a=this.data.config.tracks[this.data.data.grid[h].name].duration;c-=a;if((c-s)<=0){this.buildTraveler(n,m,h);break}}}else{for(var d=0;d<r.length;d++){var h=r[d];var a=this.data.config.tracks[this.data.data.grid[h].name].duration;c-=a;if(c<=0){this.buildTraveler(n,m,h);break}}}}}}if(this.data.data.starterpack.remain>0){if(!this.data.data.starterpack.bought){showDiv("train_starterpack_link")}if($("train_starterpack_timer")){$("train_starterpack_timer").innerHTML=formatTime(this.data.data.starterpack.remain)}if($("train_starterpack_link_timer")){$("train_starterpack_link_timer").innerHTML=formatTime(this.data.data.starterpack.remain)}}else{hideDiv("train_starterpack_link")}};train.prototype.buildTraveler=function(b,d,c){if(this.data.data.plans[b][d].remain>0){traintt=formatTime(this.data.data.plans[b][d].remain)}else{traintt=statusProductionComplete}if($("train_travel_"+b+"_"+d)){$("train_travel_"+b+"_"+d).remove()}var a='<div id="train_travel_'+b+"_"+d+'" class="traveler flex-center-all link" onclick="trainGrid.clickStation('+b+')">';a+='  <div class="train_train '+this.data.data.trains[this.data.data.plans[b][d].train].name+'">';a+='    <div class="timer flex-center-all">'+traintt+"</div>";a+="  </div>";a+="</div>";$("train_grid_tile"+c).insert(a)};train.prototype.showReward=function(){var c="hideDiv('globaltransp'); hideDiv('globalbox')";if(this.destroyed&&this.destroyed.length){c="train.showDestroyed()"}html='<div id="train_commit">';html+='  <div class="desc">'+t_train_reward_body+"</div>";html+='  <div class="reward-list">';if(this.reward.points){html+='<div class="reward-line">'+formatNumber(this.reward.points)+"&nbsp;"+t_points+"</div>"}if(this.reward.money){html+='<div class="reward-line">'+formatPrice(this.reward.money)+"</div>"}if(this.reward.train_points){html+='<div class="reward-line">'+formatNumber(this.reward.train_points)+"&nbsp;"+t_train_points+"</div>"}html+="  </div>";if(this.reward.tools){html+='<div class="tools-list">';for(var b in this.reward.tools){html+='<div class="slot">';html+='  <div class="train_tool tool_'+b+'"></div>';html+='  <div class="amount">'+this.reward.tools[b]+"</div>";html+="</div>"}html+="</div>"}if(this.reward.products){html+='<div class="desc">'+t_train_reward_body2+"</div>";html+='<div class="products-list">';html+="  <div>";for(var a in this.reward.products){html+='<div class="reward-line">'+htmlProductBody(a,this.reward.products[a])+"</div>"}html+="  </div>";html+="</div>"}html+='  <div class="button_yes link" onclick="'+c+'"></div>';html+="</div>";globalBoxFlex(t_train_reward_head,html,0,c);this.setGlobalboxWidescreen();this.reward=0};train.prototype.showDestroyed=function(){html='<div id="train_commit">';html+='  <div class="desc">'+t_train_destroyed_body+"</div>";html+='    <div class="destroyed">';for(var a=0;a<this.destroyed.length;a++){html+='<div class="img train_train '+this.destroyed[a]+'" onmouseover="showDiv(\'train_commit_destroyed'+a+"_tt')\" onmouseout=\"hideDiv('train_commit_destroyed"+a+"_tt')\">";html+='  <div id="train_commit_destroyed'+a+'_tt" class="ttbox">'+this.trainTT(this.destroyed[a])+"</div>";html+="</div>"}html+="    </div>";html+="  <div class=\"button_yes link\" onclick=\"hideDiv('globaltransp'); hideDiv('globalbox')\"></div>";html+="</div>";globalBoxFlex(t_train_destroyed_head,html);this.setGlobalboxWidescreen()};train.prototype.trainTT=function(a,c,v){var w=this.data.config.trains[a];var m='<div id="traingrid_item_info">';m+='  <div class="name">'+w.name+"</div>";m+='  <div class="category">'+t_train_category_name[w.category]+"</div>";m+='  <div class="stats">';var e=["money","coins","train_points","wagons","slots","capacity","energy","durability"];for(var h=0;h<e.length;h++){var l=e[h];if(!w[l]){continue}if(c>0&&in_array(l,["money","coins","train_points"])){continue}var u="";var q="";if(in_array(l,["durability","energy"])){u="special"}if(l=="energy"||(l=="durability"&&!w.energy)){q="border-top: 5px solid white"}m+='<div class="stats-line '+u+'" style="'+q+'">';if(in_array(l,["durability","energy"])){m+='<div class="stats-col1 width-icon">';m+='  <div class="icon icon-'+l+'"></div>';m+="  <div>"+t_train_item_stats[l]+"</div>";m+="</div>"}else{m+='<div class="stats-col1">'+t_train_item_stats[l]+"</div>"}if(in_array(l,["money","coins","train_points"])){if(l=="money"){m+='<div class="stats-col2">'+formatPrice(w.money)+"</div>"}if(l=="coins"){m+='<div class="stats-col2">'+formatNumber(w.coins)+"&nbsp;"+t_coins+"</div>"}if(l=="train_points"){m+='<div class="stats-col2">'+formatNumber(w.train_points)+"&nbsp;"+t_train_points+"</div>"}}else{if(in_array(l,["durability","energy"])){var n="";if(c>0){n=formatNumber(this.data.data.trains[c][l])+"/"}var d=n+formatNumber(w[l]);if(l=="durability"&&this.data.config.trains[a].indestructible){d=t_train_item_stats.indestructible}m+='<div class="stats-col2">'+d+"</div>"}else{m+='<div class="stats-col2">'+formatNumber(w[l])+"</div>"}}m+='  <div class="clear"></div>';m+="</div>"}m+="  </div>";if(this.data.data.research&&this.data.data.research.trains&&this.data.data.research.trains[a]){m+='<div class="stats stats-research">';var s=(this.data.data.research.trains[a].level*this.data.config.research.trains.timebonus);m+='  <div class="stats-line">';m+='    <div class="stats-col1">'+t_train_item_stats.timebonus+"</div>";m+='    <div class="stats-col2">'+Math.round(s*100)+"%</div>";m+='    <div class="clear"></div>';m+="  </div>";m+="</div>"}if(w.products){m+='<div style="margin:5px 0px;">'+t_train_stats_products_head+"</div>";for(var l=0;l<w.products.length;l++){m+='<div class="cline">';m+='  <div class="icon cmenue_'+w.products[l]+'"></div>';m+="  <div>"+t_train_item_stats.products[w.products[l]]+"</div>";m+="</div>"}}if(c>0&&this.plan&&this.plan.wagons&&w.category=="wagon"){for(var h in this.plan.wagons){if(this.plan.wagons[h].id!=c){continue}m+='<div class="load">';m+="  <div>"+t_train_wagons_capacity+"</div>";for(var v in this.plan.wagons[h].slots){m+='<div class="slot">';m+='  <div class="pid l'+this.plan.wagons[h].slots[v].pid+'"></div>';m+='  <div class="amount">'+this.plan.wagons[h].slots[v].amount+"</div>";m+="</div>"}m+='  <div class="clear"></div>';m+="</div>"}}if(c>0){m+='<div class="stats stats-stats">';var r=["count_tracks","count_traders"];for(var h=0;h<r.length;h++){m+='  <div class="stats-line">';m+='    <div class="stats-col1">'+t_train_item_stats[r[h]]+"</div>";m+='    <div class="stats-col2">'+formatNumber(this.data.data.trains[c][r[h]])+"</div>";m+='    <div class="clear"></div>';m+="  </div>"}m+="</div>"}m+="</div>";return m};train.prototype.toolsTT=function(b){var d='<div id="traingrid_item_info">';d+='  <div class="name">'+this.data.config.tools[b].name+"</div>";d+='  <div class="stats">';for(var c in this.data.config.tools[b]){if(in_array(c,["name"])){continue}var e=formatNumber(this.data.config.tools[b][c]);if(c=="buy"){for(var a in this.data.config.tools[b][c]){e=a+"&nbsp;"+t_coins;break}}d+='<div class="stats-line">';d+='  <div class="stats-col1">'+t_train_item_stats[c]+"</div>";d+='  <div class="stats-col2">'+e+"</div>";d+='  <div class="clear"></div>';d+="</div>"}d+="  </div>";d+="</div>";return d};train.prototype.hoverMapTrain=function(b){if(!b){hideDiv("map_train_tt");return 1}var a="";if(train_constants_cost>user_bar){a="failed"}var c="";if(train_constants_minlevel>currentuserlevel){c+="<div>"+t_requirements.replace("%NAME%","<b>"+t_train_name+"</b>").replace("%LEVEL%",train_constants_minlevel)+"</div>"}else{if(!train_has_building){c+="<div>"+t_train_buy.replace("%NAME%","<b>"+t_train_name+"</b>").replace("%COST%",'<span class="'+a+'">'+formatPrice(train_constants_cost)+"</span>")+"</div>"}else{c="<div>"+t_train_name+"</div>"}}$("map_train_tt").innerHTML=c;showDiv("map_train_tt")};train.prototype.clickMapTrain=function(){if(train_constants_minlevel>currentuserlevel){return 1}if(train_has_building==1){mapGo2Location("train")}else{var b=t_train_buy_head.replace("%NAME%",t_train_name);var a='<div class="train_buy_commit">'+t_train_buy_desc.replace("%NAME%",t_train_name).replace("%COST%",'<span class="train_buy_commit_cost">'+formatPrice(train_constants_cost)+"</span>")+"</div>";var c="train.buy()";globalcommitbox(b,a,c)}};train.prototype.setWidescreen=function(){if($("train").hasClassName("widescreen")){this.closeWidescreen()}else{this.widescreen=1;$("train").addClassName("widescreen");hideDiv("rack_top_navi");hideDiv("rackItems");hideDiv("rackInfo");this.rememberDivs=[];if($("specialbonus_link")&&$("specialbonus_link").style.display=="block"){hideDiv("specialbonus_link");this.rememberDivs.push("specialbonus_link")}$("globalbox").addClassName("is-widescreen");$("globaltransp").addClassName("is-widescreen")}};train.prototype.closeWidescreen=function(){this.widescreen=0;$("train").removeClassName("widescreen");showDiv("rack_top_navi");showDiv("rackItems");showDiv("rackInfo");for(var a=0;a<this.rememberDivs.length;a++){showDiv(this.rememberDivs[a])}$("globalbox").removeClassName("is-widescreen");$("globaltransp").removeClassName("is-widescreen")};train.prototype.setGlobalboxWidescreen=function(){$("globalbox").removeClassName("is-widescreen");if(this.widescreen==1){$("globalbox").addClassName("is-widescreen");var a=$("globalbox").getWidth();a+=240;$("globalbox").style.marginLeft="-"+(a/2)+"px"}};train.prototype.close=function(){trainGrid.keyPressed=0;this.plan={};this.closeWidescreen();hideDiv("train")};train.prototype.starterPack=function(e){if(e){}else{if(this.starterpackAutoOpen==1){return 1}if(!this.data.data.tutorial||!this.data.data.tutorial.start){return 1}if(this.data.data.starterpack.bought||this.data.data.starterpack.remain<=0){return 1}}var b="<div>";b+='  <div class="head">'+t_train_starterpack_head+"</div>";b+='  <div class="desc">'+t_train_starterpack_desc+"</div>";b+='  <div class="rewards">';for(var d in this.data.config.starterpack.content){b+='<div class="line is-'+d+'">';for(var a in this.data.config.starterpack.content[d]){var c="";b+='<div class="slot" onmouseover="showDiv(\'train_starterpack_'+d+"_"+a+"_tt')\" onmouseout=\"hideDiv('train_starterpack_"+d+"_"+a+"_tt')\">";if(d=="stock"){b+='<div class="item item_'+a+'"></div>';c=trainGrid.itemTT(a)}if(d=="trains"){b+='<div class="item train_train '+a+'"></div>';c=this.trainTT(a)}if(d=="tools"){b+='<div class="item train_tool tool_'+a+'"></div>';c=this.toolsTT(a)}b+='  <div class="amount">'+this.data.config.starterpack.content[d][a]+"</div>";b+='  <div id="train_starterpack_'+d+"_"+a+'_tt" class="ttbox">'+c+"</div>";b+="</div>"}b+="</div>"}b+="  </div>";b+='  <div class="footer">';b+='    <div class="coinsbutton_flex link" onclick="train.starterPackCommit()">'+t_train_starterpack_button.replace("%COST%",this.data.config.starterpack.coins+"&nbsp;"+t_coins)+"</div>";b+='    <div class="timer">'+t_train_starterpack_timer.replace("%TIME%",'<span id="train_starterpack_timer"></span>')+"</div>";b+="  </div>";var h='<span class="col1">'+this.data.config.starterpack.discount+'%</span> <span class="col2">'+t_specialbonus_pets_packagediscount_info.toUpperCase()+"</span>";b+='<div class="discount bonus_star pulse">';b+='  <div class="inner">'+h+"</div>";b+="</div>";b+='  <div class="banner"><div>'+t_train_starterpack_buy_banner.toUpperCase()+"</div></div>";b+='  <div class="mini_close link" onclick="train.closeStarterPack()"></div>';b+="</div>";$("train_starterpack").style.display="flex";$("train_starterpack_inner").innerHTML=b};train.prototype.closeStarterPack=function(){this.starterpackAutoOpen=1;hideDiv("train_starterpack")};train.prototype.starterPackCommit=function(){var b=t_train_shop_remove_head.replace("%NAME%",name);var a='<div id="train_commit">';a+="  <div>"+t_train_starterpack_buy_desc.replace("%COST%",'<span class="cost">'+this.data.config.starterpack.coins+"&nbsp;"+t_coins+"</span>")+"</div>";a+="</div>";var c="train.closeStarterPack(); train.buyStarterpack()";globalcommitbox(t_train_starterpack_buy_head,a,c)};var train_dummy_parts={skin:3,body:10,face:6,hair:4,eyes:15,mouth:9,nose:8,hat:9};train.prototype.buildDummyChar=function(){if($("train_dummy_char")){$("train_dummy_char").remove();return 1}var b='<div id="train_dummy_char" class="train_char">';for(var a in train_dummy_parts){if(in_array(a,["skin"])){continue}b+='<div id="train_dummy_char_'+a+'"></div>'}b+='  <div class="controls">';for(var a in train_dummy_parts){b+='<div style="display:flex; justify-content:left; align-items:center; gap:5px;">';b+='  <div style="width:50px; text-align:right;">'+a+"</div>";b+='  <input type="number" min="1" max="'+train_dummy_parts[a]+'" style="height:25px;" value="1" id="train_dummychar'+a+'" onchange="train.editDummyChar()"  onkeyup="train.editDummyChar()">';b+="</div>"}b+='<input type="number" style="width:1px;">';b+="  </div>";b+="</div>";$("farm_main").insert(b);this.editDummyChar()};train.prototype.editDummyChar=function(){for(var a in train_dummy_parts){if(!$("train_dummy_char_"+a)){continue}var b=$("train_dummychar"+a).value;if(in_array(a,["body","face"])){b=$("train_dummycharskin").value+"_"+b}$("train_dummy_char_"+a).className="part "+a+b}};var trainGrid=function(){this.grid={};this.gridY=0;this.gridX=0;this.mode="";this.currentItem="";this.currentHoverTile=0;this.currentMoveTile=0;this.zoom=1;this.drawActive=0;this.starter=[];this.stationTiles={};this.stationInit={};this.traderTiles={};this.traderInit={};this.routes={};this.tmpStock={};this.currentGridItems={};this.mapDrawing=0;this.mapMover=0;this.keyPressed=0;this.trackStockFilter="tracks";this.trackStockRotate=1;this.trackStockMaxItems=9;this.trackStockMaxItemsWidescreen=13;this.trackStockPage=1;this.saveTrainMapLeft=0;this.saveTrainMapTop=0;this.saveRouteView=""};trainGrid.prototype.init=function(){this.gridY=train.data.config.constants.gridy;this.gridX=train.data.config.constants.gridx;this.mode="";this.currentItem="";this.mapDrawing=0;this.tmpStock=JSON.parse(JSON.stringify(train.data.data.stock));this.grid=JSON.parse(JSON.stringify(train.data.data.grid));this.getStarter();this.build();this.moveMap()};trainGrid.prototype.resetGridCommit=function(){var a='<div id="train_commit">';a+='  <div class="desc">'+t_train_reset_desc+"</div>";a+="</div>";var b="trainGrid.resetGrid()";globalcommitbox(t_train_reset_head,a,b)};trainGrid.prototype.resetGrid=function(){hideDiv("globalbox");hideDiv("globaltransp");this.grid=JSON.parse(JSON.stringify(train.data.data.grid));this.currentItem="";this.mode="";this.build()};trainGrid.prototype.setConnect=function(b,a){if(in_array(a,this.starter)){return 0}if(!train.data.config.tracks[this.grid[a].name]){return 0}if(this.grid[a]&&this.grid[a].n.length<2&&!in_array(a,this.starter)){this.grid[a].n.push(b);this.grid[b].n.push(a);return 1}return 0};trainGrid.prototype.build=function(){for(var C in this.grid){if(!train.data.config.tracks[this.grid[C].name]){continue}if(this.grid[C].n.length<2&&!in_array(C,this.starter)){var m=0;var z=this.connectedTiles(C);for(var v=0;v<z.length;v++){m=this.setConnect(C,z[v]);if(m==1){break}}}}this.checkRoutes();var l="";var C=1;this.currentGridItems={};for(var d=1;d<=this.gridY;d++){for(var e=1;e<=this.gridX;e++){var h=Math.ceil(C/this.gridX);l+='<div id="train_grid_tile'+C+'" class="tile tile'+C+'" onmouseover="trainGrid.hoverTile('+C+', 1)" onmouseout="trainGrid.hoverTile('+C+', 0)">';if(in_array(C,this.starter)){l+='<div id="train_grid_tile'+C+'_starter" class="starter"></div>'}if(in_array(C,train.data.config.blocker)){l+='<div id="train_grid_tile'+C+'_blocker" class="blocker"></div>'}if(this.stationInit[C]||this.traderInit[C]){var c="";if(h==this.gridY||(h+1)==this.gridY){c+=" bottom"}if(C%this.gridX==0){c+=" right"}var A="";if(this.stationInit[C]){var q=this.stationInit[C].station;var b="station";var D="station"+q;var t="trainGrid.clickStation("+q+")";var w="S"+q;var a=this.stationTT(q);if(+train.data.config.station[q].level>+train.data.data.level){t="";A="locked"}else{if(!train.data.data.stations_unlock[q]||!train.data.data.stations_unlock[q].unlocked){A="unlocked"}}}else{var q=this.traderInit[C].trader;var b="trader";var D="trader"+q;var t="trainGrid.clickTrader("+q+")";var w="T"+q;var a=this.traderTT(D.replace("trader",""),4,1);if(+train.data.config.trader[q].level>+train.data.data.level){t="";A="locked"}else{if(!train.data.data.traders_unlock[q]||!train.data.data.traders_unlock[q].unlocked){A="unlocked"}}}l+='<div class="item '+D+'"></div>';l+='<div class="marker '+b+'">'+w+"</div>";l+='<div class="clicker '+D+" "+c+' link" onclick="'+t+'" onmouseover="showDiv(\'traingrid_tile'+C+"_clicker_tt')\" onmouseout=\"hideDiv('traingrid_tile"+C+"_clicker_tt')\">";if(A!=""){l+='<div class="is-'+A+'"><div class="lock"></div></div>'}l+='  <div id="traingrid_tile'+C+'_forbidden" class="forbidden"></div>';l+='  <div id="traingrid_tile'+C+'_clicker_tt" class="ttbox">'+a+"</div>";l+="</div>"}if(train.data.config.special[C]){var D=train.data.config.special[C];l+='<div class="item item_'+D+'"></div>'}if(train.data.data.grid_specials[C]){var D=train.data.data.grid_specials[C].name;l+='<div class="item item_'+D+" item-randomized rotate"+train.data.data.grid_specials[C].rotate+'" onclick="trainGrid.removeGridSpecialCommit('+C+')"></div>'}if(this.grid&&this.grid[C]){var r="";var D=this.grid[C].name;if(train.data.config.tracks[D]){if(this.stationTiles[C]){if(this.stationTiles[C].station==1){r+="l"}if(this.stationTiles[C].station==2){r+="t"}if(this.stationTiles[C].station==3){r+="b"}if(this.stationTiles[C].station==4){r+="r"}}if(this.grid[C].n){for(var v=0;v<this.grid[C].n.length;v++){var s=+this.grid[C].n[v];if((s+this.gridX)==C){r+="t"}if((s-this.gridX)==C){r+="b"}if((s+1)==C){r+="l"}if((s-1)==C){r+="r"}}}if(r==""){r="l"}if(in_array(r,["lt","tl","bl","lb","rt","tr","br","rb"])){D+="-curve"}l+='<div id="train_grid_tile'+C+'_marked" class="marked dir-'+r+'"></div>';if(this.grid[C].n.length<2&&!in_array(C,this.starter)){l+='<div style="z-index:2; position:absolute; top:50%; left:50%; width:10px; height:10px; margin-top:-5px; margin-left:-5px; border-radius:10px; background-color:red; pointer-events:none;"></div>'}}else{if(!this.grid[C].parent){l+='<div class="deco-marker"></div>'}}if(!this.grid[C].parent){var u=1;if(this.grid[C].r){u=this.grid[C].r}l+='<div id="traingrid_tile'+C+'_item" class="item item_'+D+" dir-"+r+" rotate"+u+'"></div>';var B=D.replace("-curve","");if(!this.currentGridItems[B]){this.currentGridItems[B]=0}this.currentGridItems[B]++}}l+='  <div id="train_grid_tile'+C+'_hover" class="hover"></div>';l+="</div>";C++}l+='<div class="clear"></div>'}l+='<div id="train_grid_transp" class="transp"></div>';$("train_grid").innerHTML='<div class="back2">'+l+"</div>";this.markCompleteRoutes();if(!this.mapDrawing){this.mapDrawing=1;$("train_grid").addEventListener("mousedown",function(E){if(E.target&&E.target.id&&trainGrid.drawActive==0){trainGrid.drawActive=1;var n=E.target.id.replace("train_grid_tile","");trainGrid.currentMoveTile=n;trainGrid.clickTile(E,n);if(trainGrid.currentItem!=""&&train.data.config.decos[trainGrid.currentItem]){trainGrid.drawActive=0}}});$("train_grid").addEventListener("mouseup",function(n){trainGrid.drawActive=0});$("train_grid").addEventListener("mouseleave",function(n){trainGrid.drawActive=0});$("train_grid").addEventListener("mousemove",function(E){if(trainGrid.drawActive==1&&E.target&&E.target.id){var n=E.target.id.replace("train_grid_tile","");if(n==trainGrid.currentMoveTile){return 1}trainGrid.currentMoveTile=n;if(trainGrid.mode=="remove"&&!trainGrid.grid[n]){return 1}trainGrid.clickTile(E,n)}})}this.buildTrackStock();this.buildRoutesView();this.buildCart();this.setZoom(0);this.hideHeader()};trainGrid.prototype.getStarter=function(){this.stationInit={};this.traderInit={};this.starter=[];this.stationTiles={};this.traderTiles={};for(var b in train.data.config.station){this.stationInit[train.data.config.station[b].init]={station:b};var e=train.data.config.station[b].init;for(y=1;y<=train.data.config.station[b].y;y++){for(x=0;x<train.data.config.station[b].x;x++){var c=(e+x);train.data.config.blocker.push(c)}e+=this.gridX}for(var d in train.data.config.station[b].starter){if(+train.data.config.station[b].level>+train.data.data.level||(!train.data.data.stations[b]||!train.data.data.stations[b][d])){train.data.config.blocker.push(train.data.config.station[b].starter[d])}else{this.starter.push(train.data.config.station[b].starter[d]);this.stationTiles[train.data.config.station[b].starter[d]]={station:b,slot:d}}}}for(var b in train.data.config.trader){this.traderInit[train.data.config.trader[b].init]={trader:b};train.data.config.blocker.push(((train.data.config.trader[b].init-1)-this.gridX));train.data.config.blocker.push(((train.data.config.trader[b].init+1)-this.gridX));train.data.config.blocker.push(((train.data.config.trader[b].init-1)+this.gridX));train.data.config.blocker.push(((train.data.config.trader[b].init+1)+this.gridX));for(var d in train.data.config.trader[b].starter){if(+train.data.config.trader[b].level>+train.data.data.level){train.data.config.blocker.push(train.data.config.trader[b].starter[d])}else{if(!train.data.data.traders_unlock[b]||!train.data.data.traders_unlock[b].unlocked){train.data.config.blocker.push(train.data.config.trader[b].starter[d])}else{this.starter.push(train.data.config.trader[b].starter[d]);this.traderTiles[train.data.config.trader[b].starter[d]]={trader:b,slot:d}}}}}for(var e in train.data.config.special){var a=train.data.config.special[e];if(!train.data.config.decos[a]){continue}for(y=1;y<=train.data.config.decos[a].y;y++){for(x=0;x<train.data.config.decos[a].x;x++){var c=(+e+x);train.data.config.blocker.push(c)}e=(+e+this.gridX)}}for(var e in train.data.data.grid_specials){var a=train.data.data.grid_specials[e].name;if(!train.data.config.decos[a]){continue}for(y=1;y<=train.data.config.decos[a].y;y++){for(x=0;x<train.data.config.decos[a].x;x++){var c=(+e+x);train.data.config.blocker.push(c)}e=(+e+this.gridX)}}};trainGrid.prototype.hoverTile=function(e,c){if(e==this.currentHoverTile){return 1}if(this.keyPressed==1){return 1}if(train.plan.step==2){if(!this.grid[e]||!train.data.config.tracks[this.grid[e].name]){return 1}for(var d in this.routes){if(!in_array(e,this.routes[d].tiles)){continue}if(!this.routes[d].duration){continue}if(c==1){var h=1;var n=0;if(this.traderTiles[this.routes[d].end]){n=this.traderTiles[this.routes[d].end].trader}if(in_array(n,train.plan.trader)&&this.traderTiles[this.routes[d].start]){n=this.traderTiles[this.routes[d].start].trader}if(in_array(n,train.plan.trader)){h=0}if(h==1){this.hoverRoute(d,1)}}else{this.hoverRoute(d,0)}break}return 1}var m=[this.currentHoverTile];if(this.currentItem!=""){m=this.getTileTiles(this.currentHoverTile,this.currentItem)}if(this.currentHoverTile>0){for(var d=0;d<m.length;d++){$("train_grid_tile"+m[d]+"_hover").className="hover"}}this.currentHoverTile=e;if(this.mode=="remove"&&c==1){}if(this.currentItem==""){return 1}if(train.data.config.tracks[this.currentItem]){this.tmpGrid=JSON.parse(JSON.stringify(this.grid));var a=this.connectedTiles(e);if(a.length){this.tmpGrid=this.setTile(e,a,this.tmpGrid);this.checkRouteByTile(e,this.tmpGrid);if(this.tmpRoute.station.length>1){return 1}}}if(c==1){var m=this.getTileTiles(e,this.currentItem);if(train.data.config.tracks[this.currentItem]){var l=(train.data.config.tracks[this.currentItem].x*train.data.config.tracks[this.currentItem].y)}if(train.data.config.decos[this.currentItem]){var l=(train.data.config.decos[this.currentItem].x*train.data.config.decos[this.currentItem].y)}var b=1;if(m.length!=l){b=0}for(var d=0;d<m.length;d++){if((train.data.config.decos[this.currentItem]&&this.grid[m[d]])||in_array(m[d],train.data.config.blocker)||(train.data.config.decos[this.currentItem]&&in_array(m[d],this.starter))){b=0;break}}for(var d=0;d<m.length;d++){if(b==1){$("train_grid_tile"+m[d]+"_hover").removeClassName("invalid").addClassName("valid")}else{$("train_grid_tile"+m[d]+"_hover").removeClassName("valid").addClassName("invalid")}}if(train.data.config.decos[this.currentItem]&&$("train_grid_tile"+e+"_hover")){$("train_grid_tile"+e+"_hover").addClassName("item_"+this.currentItem).addClassName("is-main").addClassName("rotate"+this.trackStockRotate)}}};trainGrid.prototype.getTileTiles=function(c,a){if(train.data.config.tracks[a]){var m=train.data.config.tracks[a]}if(train.data.config.decos[a]){var m=train.data.config.decos[a]}if(m.x==1&&m.y==1){return[c]}var e=(this.gridX*this.gridY);var l=[];var b=+c;var q=Math.ceil(c/+this.gridX);for(var d=1;d<=m.y;d++){for(var h=0;h<m.x;h++){if(h>0){b++}if(b>e){continue}if(Math.ceil(b/+this.gridX)!=q){continue}l.push(b)}b=(+c+(d*+this.gridX));q=Math.ceil(b/+this.gridX)}return l};trainGrid.prototype.findRouteByTile=function(b){if(this.routes){for(var a in this.routes){if(in_array(b,this.routes[a].tiles)){return a}}}return 0};trainGrid.prototype.clickTile=function(m,n){if(train.plan.step==2&&this.grid[n]&&train.data.config.tracks[this.grid[n].name]&&$("train_grid_tile"+n+"_marked").hasClassName("active")){train.clickRouteTile(n);return 1}if(this.mode==""){return 1}if((m.which&&m.which==3)||(m.button&&m.button==2)){this.pressRight();m.preventDefault()}if(this.keyPressed==1){return 1}if(in_array(n,train.data.config.blocker)){return 1}if(!$("train_grid_tile"+n)){return 1}if(this.currentItem!=""){if(train.data.config.decos[trainGrid.currentItem]&&this.grid[n]){return 1}if(!this.grid[n]&&!$("train_grid_tile"+n+"_hover").hasClassName("valid")){return 1}if(this.grid[n]&&this.grid[n].name==this.currentItem){return 1}}var b=this.connectedTiles(n);if(this.mode=="remove"&&this.grid[n]){if(train.data.config.decos[this.grid[n].name]){if(this.grid[n].parent){var a=this.getTileTiles(this.grid[n].parent,this.grid[this.grid[n].parent].name)}else{var a=this.getTileTiles(n,this.grid[n].name)}for(var d=0;d<a.length;d++){delete this.grid[a[d]]}}if(in_array(n,train.blockedRouteTiles)){return 1}for(var d=0;d<b.length;d++){if(!in_array(n,this.grid[b[d]].n)){continue}var h=[];for(var c=0;c<this.grid[b[d]].n.length;c++){if(this.grid[b[d]].n[c]==n){continue}h.push(this.grid[b[d]].n[c])}this.grid[b[d]].n=h}delete this.grid[n]}if(this.currentItem!=""){if(this.grid[n]){if(in_array(n,train.blockedRouteTiles)){return 1}if(train.data.config.decos[this.grid[n].name]){return 1}if(this.currentItem!=this.grid[n].name){this.grid[n].name=this.currentItem;this.build()}return 1}this.grid=this.setTile(n,b,this.grid);var q=this.getTileTiles(n,this.currentItem);for(var d=0;d<q.length;d++){if(q[d]==n){continue}this.grid=this.setTile(q[d],0,this.grid,n)}if(train.data.config.tracks[this.currentItem]){this.checkRoutes();var q=this.tileNeighbors(n);q.push(n);for(var d=0;d<q.length;d++){if(!this.grid[q[d]]){continue}if(train.data.config.decos[this.grid[q[d]].name]){continue}this.buildTrackTile(q[d])}var l=this.grid[n].name.replace("-curve","");if(!this.currentGridItems[l]){this.currentGridItems[l]=0}this.currentGridItems[l]++;this.markCompleteRoutes();this.buildTrackStock();this.buildRoutesView();this.buildCart()}else{this.build()}}else{this.build()}};trainGrid.prototype.buildTrackTile=function(h){var c="";var b=this.grid[h].name;if(this.grid[h].n){if(this.stationTiles[h]){if(this.stationTiles[h].station==1){c+="l"}if(this.stationTiles[h].station==2){c+="t"}if(this.stationTiles[h].station==3){c+="b"}if(this.stationTiles[h].station==4){c+="r"}}for(var e=0;e<this.grid[h].n.length;e++){var l=+this.grid[h].n[e];if((l+this.gridX)==h){c+="t"}if((l-this.gridX)==h){c+="b"}if((l+1)==h){c+="l"}if((l-1)==h){c+="r"}}}if(c==""){c="l"}if(in_array(c,["lt","tl","bl","lb","rt","tr","br","rb"])){b+="-curve"}var a=1;var d="";if(in_array(h,this.starter)){d+='<div class="starter"></div>'}d+='<div id="train_grid_tile'+h+'_marked" class="marked dir-'+c+'"></div>';d+='<div id="traingrid_tile'+h+'_item" class="item item_'+b+" dir-"+c+" rotate"+a+'"></div>';d+='<div id="train_grid_tile'+h+'_hover" class="hover"></div>';d+='<div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:gray; pointer-events:none;">'+h+"</div>";$("train_grid_tile"+h).innerHTML=d};trainGrid.prototype.setTile=function(e,a,c,d){c[e]={name:this.currentItem,n:[]};if(train.data.config.decos[this.currentItem]&&this.trackStockRotate>1){c[e]["r"]=this.trackStockRotate}if(d){c[e].parent=d}else{if(a.length){for(var b=0;b<a.length;b++){if(!c[a[b]].n){c[a[b]].n=[]}if(c[a[b]].n.length<2&&c[e].n.length<2){if(this.stationTiles[e]&&this.stationTiles[a[b]]){continue}if(in_array(a[b],this.starter)&&this.grid[a[b]].n.length>0){continue}c[a[b]].n.push(+e);c[e].n.push(+a[b])}}}}return c};trainGrid.prototype.connectedTiles=function(d){var c=[];var a=this.tileNeighbors(d);if(a.length){for(var b=0;b<a.length;b++){if(this.grid&&this.grid[a[b]]&&train.data.config.tracks[this.grid[a[b]].name]){c.push(a[b])}}}return c};trainGrid.prototype.tileNeighbors=function(d){var b=[];var a=(+d-this.gridX);if(a>0){b.push(a)}a=(+d+this.gridX);if(a<=(this.gridX*this.gridY)){b.push(a)}a=(+d-1);var c=a%this.gridX;if(c>0&&c<this.gridX){b.push(a)}a=(+d+1);c=a%this.gridX;if(+d%this.gridX>0&&(c==0||c>+d%this.gridX)){b.push(a)}return b};trainGrid.prototype.clickStation=function(a){train.openStation(a)};trainGrid.prototype.clickTrader=function(a){if(+train.data.config.trader[a].userlevel>+currentuserlevel){return 1}train.openTrader(a)};trainGrid.prototype.stationTT=function(b){var a='<div id="traingrid_item_info">';a+='  <div class="name">'+t_train_station_name.replace("%COUNT%",b)+"</div>";if(+train.data.config.station[b].level>+train.data.data.level){a+='<div class="failed">'+t_train_requires_level.replace("%COUNT%",train.data.config.station[b].level)+"</div>"}else{if(!train.data.data.stations_unlock[b]||!train.data.data.stations_unlock[b].unlocked){a+=this.htmlUnlockTT(b,"station");a+='<div class="click">'+t_train_station_click_locked+"</div>"}else{a+='<div class="click">'+t_train_station_click+"</div>"}}a+="</div>";return a};trainGrid.prototype.traderTT=function(d,m,a,b){var h='<div id="traingrid_item_info" class="is-trader">';h+='  <div class="name">'+train.data.config.trader[d].name+"</div>";if(+train.data.config.trader[d].level<=+train.data.data.level){if(!train.data.data.traders_unlock[d]||!train.data.data.traders_unlock[d].unlocked){h+=this.htmlUnlockTT(d,"trader")}if(train.data.data.traders[d]&&!b){h+='<div id="train_trader'+d+"_tt"+m+'_cart" class="cart2">';for(var l in train.data.data.traders[d].cart){var n=((train.data.data.traders[d].cart[l].have*100)/train.data.data.traders[d].cart[l].need);h+='<div class="line3">';h+='  <div class="img l'+l+'"></div>';h+="  <div>";h+='    <div style="font-weight:bold;">'+produkt_name[l]+"</div>";h+='    <div class="bar">';h+='      <div class="bar_inner" style="width:'+n+'%"></div>';h+="    </div>";h+="    <div>"+formatNumber(train.data.data.traders[d].cart[l].have)+"/"+formatNumber(train.data.data.traders[d].cart[l].need)+"</div>";h+="  </div>";h+="</div>"}h+="</div>";h+='  <div class="trader-tools">';for(var c in train.data.data.traders[d].tools){h+='<div class="slot">';h+='  <div class="train_tool tool_'+c+'"></div>';h+='  <div class="amount">'+train.data.data.traders[d].tools[c]+"</div>";h+="</div>"}h+="  </div>"}}h+='  <div class="waiting-timer" id="train_trader'+d+"_tt"+m+'_waiting_timer">';h+='    <div id="train_trader'+d+"_tt"+m+'_waiting_timer_time"></div>';if(a==1){h+='<div class="click">'+t_train_trader_waiting_info_click+"</div>"}h+="  </div>";h+='  <div class="categories">';h+='    <div style="font-weight:bold; margin-bottom:5px;">'+t_train_trader_categories+"</div>";for(var c=0;c<train.data.config.trader[d].cart.categories.length;c++){h+='<div class="cline">';h+='  <div class="icon cmenue_'+train.data.config.trader[d].cart.categories[c]+'"></div>';h+="  <div>"+t_train_item_stats.products[train.data.config.trader[d].cart.categories[c]]+"</div>";h+="</div>"}h+="  </div>";var e=0;if(+train.data.config.trader[d].userlevel>+currentuserlevel){h+='<div class="failed" style="margin-top:5px;">'+error1005.replace("%LEVEL%",train.data.config.trader[d].userlevel)+"</div>";e=1}if(+train.data.config.trader[d].level<=+train.data.data.level){if(a==1&&!e){if(!train.data.data.traders_unlock[d]||!train.data.data.traders_unlock[d].unlocked){h+='<div id="train_trader'+d+"_tt"+m+'_clicker" class="click" style="margin-top:5px;">'+t_train_trader_unlock_click+"</div>"}else{h+='<div id="train_trader'+d+"_tt"+m+'_clicker" class="click" style="margin-top:5px;">'+t_train_trader_click+"</div>"}}}else{h+='<div class="failed" style="margin-top:5px;">'+t_train_requires_level.replace("%COUNT%",train.data.config.trader[d].level)+"</div>"}h+='  <div class="trader-char train_char">'+train.buildTraderChar(d)+"</div>";h+="</div>";return h};trainGrid.prototype.htmlUnlockTT=function(c,d){html='<div class="cart2 unlock">';html+='  <div class="unlocked"></div>';html+='  <div class="flex-center-all">';for(var b in train.data.config[d][c].unlock){var a=train.data.config[d][c].unlock[b];var e=0;if(train.data.data[d+"s_unlock"][c]&&train.data.data[d+"s_unlock"][c][b]){e=train.data.data[d+"s_unlock"][c][b]}html+="<div>";html+='  <div class="slot">';html+='    <div class="train_tool tool_'+b+'"></div>';html+="  </div>";html+='  <div style="text-align:center;">'+e+"/"+a+"</div>";html+="</div>"}html+="  </div>";html+="</div>";return html};trainGrid.prototype.removeGridSpecialCommit=function(d){if(!in_array(this.mode,["remove"])){return 1}var a=+train.data.config.constants.remove_special_coins*(+train.data.config.decos[train.data.data.grid_specials[d].name].x*+train.data.config.decos[train.data.data.grid_specials[d].name].y);var b='<div id="train_commit">';b+='  <div class="desc">'+t_train_grid_remove_special_desc.replace("%COST%",'<span class="cost">'+a+"&nbsp;"+t_coins+"</span>")+"</div>";b+='  <div class="hint">'+t_train_grid_remove_special_info+"</div>";b+="</div>";var c="train.removeGridSpecial("+d+")";globalcommitbox(t_train_grid_remove_special_head,b,c)};trainGrid.prototype.checkRoutes=function(){this.routes={};for(var c=0;c<this.starter.length;c++){var h=this.starter[c];if(!this.grid||!this.grid[h]||!this.grid[h].n){continue}var b="r"+h;this.routes[b]={start:h,tiles:[]};var e=[h];e=this.followRoute(b,h,e)}train.blockedRouteTiles=[];for(var c in this.routes){if(in_array(this.routes[c].end,this.starter)&&this.routes[c].tiles.length>1){if(this.stationTiles[this.routes[c].start]&&this.stationTiles[this.routes[c].end]){continue}if(+this.routes[c].start==+this.routes[c].end){continue}var d=0;for(var a=0;a<this.routes[c].tiles.length;a++){var b=this.grid[this.routes[c].tiles[a]].name;if(!train.data.config.tracks[b]){continue}d+=train.data.config.tracks[b].duration;if(in_array(c,train.blockedRoutes)&&!in_array(this.routes[c].tiles[a],train.blockedRouteTiles)){train.blockedRouteTiles.push(this.routes[c].tiles[a])}}this.routes[c].duration=d;this.routes[c].durability=Math.ceil(d/train.data.config.constants.train_durability_calc);this.routes[c].energy=Math.ceil(d/train.data.config.constants.train_energy_calc)}}};trainGrid.prototype.markCompleteRoutes=function(){for(var a in this.routes){if(this.routes[a].duration){$("train_grid_tile"+this.routes[a].start).addClassName("completed");$("train_grid_tile"+this.routes[a].end).addClassName("completed")}}if(train.blockedRouteTiles.length){for(var a=0;a<train.blockedRouteTiles.length;a++){$("train_grid_tile"+train.blockedRouteTiles[a]+"_marked").addClassName("blocked")}}};trainGrid.prototype.buildRoutesView=function(){var a={};if(train.data.data.plans){for(var e in train.data.data.plans){for(var d in train.data.data.plans[e]){for(var c=0;c<train.data.data.plans[e][d].routes.length;c++){a[train.data.data.plans[e][d].routes[c]]=train.data.data.plans[e][d].train}}}}var n=0;var l='<div class="head">'+t_train_routes_head+"</div>";l+='<div class="routes-list">';var s=[];for(var e in this.routes){if(!(this.routes[e].start&&this.routes[e].end)||!(this.stationTiles[this.routes[e].start]||this.traderTiles[this.routes[e].start])||!(this.stationTiles[this.routes[e].end]||this.traderTiles[this.routes[e].end])){continue}if(in_array(this.routes[e].start,s)||in_array(this.routes[e].end,s)){continue}s.push(this.routes[e].start);s.push(this.routes[e].end);var m=0;var h="";if(in_array(e,train.blockedRoutes)){m=1;var b=train.data.data.trains[a[e]].name;h='<div class="train_train '+b+'"></div>'}var q="";if(m==1){q="blocked"}l+='<div class="line '+q+'" onmouseover="trainGrid.hoverRoute(\''+e+"', 1)\" onmouseout=\"trainGrid.hoverRoute('"+e+"', 0)\">";if(train.plan.station){if(m==1){l+='<div style="width:20px;"><div class="locked"></div></div>'}else{var t="";if(this.routes[e].start==train.data.config.station[train.plan.station].starter[train.plan.slot]){t="checked disabled"}if(train.plan.routes&&in_array(e,train.plan.routes)){t+=" checked"}if(train.plan.step>2){t+=" disabled"}l+='<div class="link" style="width:20px;"><input id="traingrid_route_selector_'+e+'" '+t+' type="checkbox" onclick="trainGrid.selectPlanRoute()"></div>'}}if(this.stationTiles[this.routes[e].start]){l+='<div class="marker station">S'+this.stationTiles[this.routes[e].start].station+"</div>"}else{if(this.traderTiles[this.routes[e].start]){l+='<div class="marker trader">T'+this.traderTiles[this.routes[e].start].trader+"</div>"}}l+='<div class="arrow"></div>';if(this.stationTiles[this.routes[e].end]){l+='<div class="marker station">S'+this.stationTiles[this.routes[e].end].station+"</div>"}else{if(this.traderTiles[this.routes[e].end]){l+='<div class="marker trader">T'+this.traderTiles[this.routes[e].end].trader+"</div>"}}l+="  <div>"+formatTime(this.routes[e].duration)+"</div>";if(h!=""){l+=h}l+="</div>";n++}if(!n){l+='<div class="line none">'+t_train_routes_none+"</div>"}l+="</div>";l+='<div id="traingrid_routesview_tt" class="ttbox"></div>';l+='<div class="expander link" onclick="trainGrid.expandRoutesView()"><div class="arrow"></div></div>';$("train_routesview").innerHTML=l;if(train.plan.station){this.selectPlanRoute()}};trainGrid.prototype.selectPlanRoute=function(){train.plan.routes=[];for(var a in this.routes){if($("traingrid_route_selector_"+a)){this.hoverRoute(a,0)}if(!$("traingrid_route_selector_"+a)||$("traingrid_route_selector_"+a).checked!=true){continue}if(!in_array(a,train.plan.routes)){train.plan.routes.push(a)}this.hoverRoute(a,1)}train.buildBreadcrump()};trainGrid.prototype.expandRoutesView=function(){if($("train_routesview").hasClassName("off")){$("train_routesview").removeClassName("off")}else{$("train_routesview").addClassName("off")}};trainGrid.prototype.checkRouteByTile=function(d,c){this.tmpRoute={tiles:[d],station:[],trader:[]};if(this.stationTiles[d]){this.tmpRoute.station.push(this.stationTiles[d])}if(this.traderTiles[d]){this.tmpRoute.trader.push(this.traderTiles[d])}var a=c[d].n;for(var b=1;b<=a.length;b++){if(!c[d]){continue}this.followRouteByTile(a[(b-1)],c)}};trainGrid.prototype.followRouteByTile=function(d,c){this.tmpRoute.tiles.push(d);if(this.stationTiles[d]){this.tmpRoute.station.push(this.stationTiles[d])}if(this.traderTiles[d]){this.tmpRoute.trader.push(this.traderTiles[d])}if(this.tmpRoute.station.length&&this.tmpRoute.trader.length){return 1}if(!this.tmpRoute.station.length&&this.tmpRoute.trader.length>=2){return 1}var a=c[d].n;var e=0;for(var b=0;b<a.length;b++){if(in_array(a[b],this.tmpRoute.tiles)){continue}e=a[b]}if(!e){return 1}else{this.followRouteByTile(e,c)}return 1};trainGrid.prototype.followRoute=function(b,h,e){if(!this.grid[h]){return 0}this.routes[b].tiles.push(h);e.push(h);if(this.grid[h].n.length){var l=0;for(var c=0;c<this.grid[h].n.length;c++){var m=this.grid[h].n[c];if(!in_array(m,e)){l=m}var d=0;for(var a=0;a<this.routes[b].tiles.length;a++){if(in_array(this.routes[b].tiles[a],this.starter)){d++}}if(d>=2){l=0;break}}if(!l){this.routes[b].end=h;return 1}else{this.followRoute(b,l,e)}}return e};trainGrid.prototype.hoverRoute=function(b,a){if(train.plan.step==2&&in_array(b,train.plan.routes)){a=1}hideDiv("traingrid_routesview_tt");if(a==1){$("traingrid_routesview_tt").innerHTML=this.routeTT(b);showDiv("traingrid_routesview_tt")}for(var c=0;c<this.routes[b].tiles.length;c++){var d=this.routes[b].tiles[c];if(!$("train_grid_tile"+d+"_marked")){continue}if(a==1){$("train_grid_tile"+d+"_marked").addClassName("active")}else{$("train_grid_tile"+d+"_marked").removeClassName("active")}}};trainGrid.prototype.buildTrackStock=function(){var e=2;var d="";d+='<div id="traingrid_trackstock_start" class="start">';d+='  <div class="slot is-start link" onclick="train.startRouting()" onmouseover="showDiv(\'traingrid_trackstock_start_tt\')" onmouseout="hideDiv(\'traingrid_trackstock_start_tt\')">';d+='    <div class="back"></div>';d+='    <div class="item"></div>';d+='    <div id="traingrid_trackstock_start_tt" class="ttbox">'+t_train_trackstock_start+"</div>";d+="  </div>";d+="</div>";d+='<div class="always">';d+='  <div class="slot link" onclick="trainGrid.removeAllCommit()" onmouseover="showDiv(\'traingrid_trackstock_removeall_tt\')" onmouseout="hideDiv(\'traingrid_trackstock_removeall_tt\')">';d+='    <div class="back"></div>';d+='    <div class="item removeall"></div>';d+='    <div id="traingrid_trackstock_removeall_tt" class="ttbox">'+t_train_editor_removeall+"</div>";d+="  </div>";var r="";if(this.mode=="remove"){r="active"}d+='  <div class="slot link '+r+'" onclick="trainGrid.setMode(\'remove\')" onmouseover="showDiv(\'traingrid_trackstock_remove_tt\')" onmouseout="hideDiv(\'traingrid_trackstock_remove_tt\')">';d+='    <div class="back"></div>';d+='    <div class="item remove"></div>';d+='    <div id="traingrid_trackstock_remove_tt" class="ttbox">'+t_train_editor_remove+"</div>";d+="  </div>";d+="</div>";d+='<div class="selection">';for(var a in train.data.config.tracks){if(this.trackStockFilter!=""&&this.trackStockFilter!="tracks"){continue}d+=this.buildTrackItem(a,e);e++}var l=[];var m=this.trackStockMaxItems;if(train.widescreen==1){m=this.trackStockMaxItemsWidescreen}var n=((this.trackStockPage-1)*m)+1;var q=(m*this.trackStockPage);var s=0;var h=1;for(var a in train.data.config.decos){if(this.trackStockFilter!=""&&train.data.config.decos[a].category!=this.trackStockFilter){continue}s++;if(h>=n&&h<=q){l.push(a)}h++}var t=Math.ceil(s/m);var r="";if(this.trackStockPage==1){r="off"}if(s>m){d+='<div id="traingrid_trackstock_arrow_left" class="arrow link '+r+'" onclick="trainGrid.scrollTrackStock(-1, '+t+')"></div>'}for(var b=0;b<l.length;b++){d+=this.buildTrackItem(l[b],e);e++}if(s>m&&this.trackStockPage<t){d+='<div id="traingrid_trackstock_arrow_right" class="arrow right link" onclick="trainGrid.scrollTrackStock(1, '+t+')"></div>'}d+="</div>";var c=["tracks","landscape","building","landmark"];d+='<div class="navi">';for(var b=0;b<c.length;b++){var r="";if(this.trackStockFilter==c[b]){r="active"}d+='<div class="tab is-'+c[b]+" link "+r+'" onclick="trainGrid.setTrackStockNavi(\''+c[b]+"')\"></div>"}d+="</div>";$("train_trackstock").innerHTML=d;if($("traingrid_rotate_button")){$("traingrid_rotate_button").observe("click",function(u){trainGrid.rotateTrackItem();u.preventDefault();u.stopPropagation();return 1})}$("train_grid").removeClassName("is-editor");if(this.mode!=""){$("train_grid").addClassName("is-editor")}};trainGrid.prototype.scrollTrackStock=function(b,a){if(!$("traingrid_trackstock_arrow_left")){return 1}this.trackStockPage+=b;if(this.trackStockPage<=1){this.trackStockPage=1}if(this.trackStockPage>=a){this.trackStockPage=a}this.buildTrackStock()};trainGrid.prototype.setTrackStockNavi=function(a){if(a==this.trackStockFilter){return 1}this.trackStockPage=1;this.trackStockFilter=a;this.clickTrackItem("");this.buildTrackStock()};trainGrid.prototype.buildTrackItem=function(b,h){var a="";if(b==this.currentItem){a+="active"}if(h>=8){a+=" right"}var d=0;if(this.tmpStock[b]){d=+this.tmpStock[b]}if(this.currentGridItems[b]){d=(d-+this.currentGridItems[b])}var e="trainGrid.clickTrackItem('"+b+"')";if(train.data.config.tracks[b]&&train.data.config.tracks[b].level&&train.data.config.tracks[b].level>train.data.data.level){e=""}if(train.data.config.decos[b]&&train.data.config.decos[b].level&&train.data.config.decos[b].level>train.data.data.level){e=""}var c="";c+='<div class="slot link '+a+'" onclick="'+e+'" onmouseover="showDiv(\'traingrid_trackstock_'+b+"_tt')\" onmouseout=\"hideDiv('traingrid_trackstock_"+b+"_tt')\">";c+='  <div class="back"></div>';c+='  <div id="traingrid_trackstock_'+b+'" class="item item_'+b+'"></div>';c+='  <div id="traingrid_trackstock_'+b+'_tt" class="ttbox">'+this.itemTT(b)+"</div>";c+='  <div class="amount">'+d+"</div>";if(this.currentItem!=""&&train.data.config.decos[this.currentItem]&&b==this.currentItem){c+='<div id="traingrid_rotate_button" class="rotate links"><span id="traingrid_rotate_icon">&circlearrowright;</span></div>'}c+="</div>";return c};trainGrid.prototype.clickTrackItem=function(a){if(this.currentItem==a){a=""}this.currentItem=a;this.trackStockRotate=1;this.setMode()};trainGrid.prototype.rotateTrackItem=function(){this.trackStockRotate++;if(this.trackStockRotate>4){this.trackStockRotate=1}$("traingrid_rotate_icon").className="rotate"+this.trackStockRotate;$("traingrid_trackstock_"+this.currentItem).removeClassName("rotate1").removeClassName("rotate2").removeClassName("rotate3").removeClassName("rotate4").addClassName("rotate"+this.trackStockRotate)};trainGrid.prototype.removeAllCommit=function(){var a='<div id="train_commit">';a+='  <div class="desc">'+t_train_removeall_desc+"</div>";a+="</div>";var b="trainGrid.setMode('removeall')";globalcommitbox(t_train_removeall_head,a,b)};trainGrid.prototype.hideHeader=function(){var b=["train_levelbar","train-main-buttons","train_countbar"];for(var a=0;a<b.length;a++){if(this.mode!=""){$(b[a]).addClassName("hide-for-edit")}else{$(b[a]).removeClassName("hide-for-edit")}}if(this.mode!=""&&!$("train_routesview").hasClassName("off")){this.expandRoutesView()}};trainGrid.prototype.setMode=function(b){this.keyPressed=0;if(in_array(b,["removeall","remove"])&&b==this.mode){this.mode="";this.currentItem="";this.buildTrackStock();this.hideHeader();return 1}this.mode="";train.closeRouting();if(b=="removeall"){hideDiv("globalbox");hideDiv("globaltransp");for(var a in this.grid){if(train.blockedRouteTiles.length&&in_array(a,train.blockedRouteTiles)){continue}delete this.grid[a]}this.currentItem="";this.build();this.checkDiff();return 1}else{if(b=="remove"){this.mode="remove";this.currentItem=""}else{if(this.currentItem){this.mode="edit"}}}this.buildTrackStock();this.hideHeader()};trainGrid.prototype.buildCart=function(){var d=this.buildCartContent();var e=d.html;cost=d.cost;hideDiv("train_cart");hideDiv("train_save");if(e!=""){var b=0;var c='<div class="head">'+t_train_cart_name+"</div>";c+='<div class="list">'+e+"</div>";c+='<div class="result">';if(cost.money){var a="";if(+cost.money>+user_bar){a="failed";b++}c+='<div class="'+a+'">'+formatPrice(cost.money)+"</div>"}if(cost.coins){var a="";if(+cost.coins>+user_coins){a="failed";b++}c+='<div class="'+a+'">'+formatNumber(cost.coins)+"&nbsp;"+t_coins+"</div>"}var a="";if(b>0){a="off"}c+='  <div class="button_new link '+a+'" onclick="trainGrid.cartCommit()">'+t_train_cart_button+"</div>";c+='  <div class="button_new reset-btn link" onclick="trainGrid.resetGridCommit()">'+t_train_reset_button+"</div>";c+="</div>";showDiv("train_cart");$("train_cart").innerHTML=c}else{this.checkDiff()}};trainGrid.prototype.buildCartContent=function(){var c="";var l={money:0,coins:0};for(var b in this.currentGridItems){if(train.data.data.stock&&train.data.data.stock[b]){var h=(this.currentGridItems[b]-train.data.data.stock[b]);if(h<=0){continue}}else{var h=this.currentGridItems[b]}if(train.data.config.tracks[b]){var e=train.data.config.tracks[b]}if(train.data.config.decos[b]){var e=train.data.config.decos[b]}c+='<div class="line">';c+='  <div class="amount">'+h+"x</div>";c+='  <div class="slot">';c+='    <div class="item item_'+b+'"></div>';c+="  </div>";if(e.money){var d=(e.money*h);l.money+=d;c+='  <div class="cost">'+formatPrice(d)+"</div>"}if(e.coins){var a=(e.coins*h);l.coins+=a;c+='  <div class="cost">'+formatNumber(a)+"&nbsp;"+t_coins+"</div>"}c+="</div>"}return{html:c,cost:l}};trainGrid.prototype.cartCommit=function(){var b=this.buildCartContent();var d=b.cost;var a='<div id="train_commit">';a+='  <div class="desc">'+t_train_grid_save+"</div>";a+='  <div class="flexit">';a+='    <div class="list">'+b.html+"</div>";a+="  </div>";a+='  <div class="result">';a+='    <div style="margin-bottom:5px;">'+cityadcost+"</div>";if(d.money){a+='<div style="font-weight:bold; font-size:12px;">'+formatPrice(d.money)+"</div>"}if(d.coins){a+='<div style="font-weight:bold; font-size:12px;">'+formatNumber(d.coins)+"&nbsp;"+t_coins+"</div>"}a+="  </div>";a+="</div>";var c="train.saveGrid()";globalcommitbox(t_train_cart_button,a,c)};trainGrid.prototype.checkDiff=function(){var d=0;for(var c in train.data.data.grid){if(isNaN(c)){continue}if(!this.grid||!this.grid[c]){d++;break}if(this.grid&&this.grid[c]&&this.grid[c].name!=train.data.data.grid[c].name){d++;break}if(this.grid&&this.grid[c]){if(this.grid[c].n.length!=train.data.data.grid[c].n.length){d++}for(var b=0;b<this.grid[c].n.length;b++){if(+this.grid[c].n[b]!=+train.data.data.grid[c].n[b]){d++;break}}}if(d>0){break}}if(!d){for(var c in this.grid){if(isNaN(c)){continue}if(!train.data.data.grid[c]){d++}}}if(d>0){var a='<div class="head">'+t_train_save_name+"</div>";a+='  <div class="button_new link" onclick="train.saveGrid()">'+t_train_save_button+"</div>";a+='  <div class="button_new reset-btn link" onclick="trainGrid.resetGridCommit()">'+t_train_reset_button+"</div>";a+="</div>";$("train_save").innerHTML=a;showDiv("train_save")}};trainGrid.prototype.setZoom=function(c){var a=5;this.zoom+=c;if(this.zoom>=a){this.zoom=a}if(this.zoom<1){this.zoom=1}for(var b=1;b<=a;b++){$("train_map").removeClassName("zoom"+b)}$("train_map").addClassName("zoom"+this.zoom)};trainGrid.prototype.moveTo=function(l){this.zoom=0;this.setZoom(1);var b=100;var q=40;var n=40;var e=(720/2)-40;var d=(640/2)-40;var a=-($("train_map").offsetWidth-640);var h=-($("train_map").offsetHeight-640);var r=Math.max(0,Math.floor((l-1)/this.gridX));var m=+(((r*n)+b)-d);var c=+((((l-(r*n))*n)-n+q)-e);if((c*-1)>0){c=0}if((m*-1)>0){m=0}if((c*-1)<a){c=(a*-1)}if((m*-1)<h){m=(h*-1)}$("train_map").style.top=(m*-1)+"px";$("train_map").style.left=(c*-1)+"px"};trainGrid.prototype.moveMap=function(){if(this.mapMover==1){return 1}var d=$("train").getBoundingClientRect();var a=false;var c=0;var b=0;$("train").addEventListener("mousedown",function(h){c=h.clientX-d.x;b=h.clientY-d.y;a=true;if(h.which==3||h.button==2){trainGrid.pressRight()}h.preventDefault()});$("train").addEventListener("mouseup",function(h){a=false;trainGrid.releaseRight();h.preventDefault()});$("train").addEventListener("mouseleave",function(h){a=false;trainGrid.releaseRight();h.preventDefault()});$("train").addEventListener("mousemove",function(r){var n=1;if($("globaltransp").style.display=="block"||$("train_shop").style.display=="block"||$("train_starterpack").style.display=="flex"){n=0}if((trainGrid.mode==""||trainGrid.keyPressed==1)&&a&&n==1){r.preventDefault();var h=(r.clientX-d.x);var v=(r.clientY-d.y);var u=-(h-c);var t=-(v-b);var l=(+$("train_map").offsetLeft-u);var s=(+$("train_map").offsetTop-t);var m=-($("train_map").offsetWidth-640);var q=-($("train_map").offsetHeight-640);if(l<m){l=m}if(s<q){s=q}if(l>0){l=0}if(s>0){s=0}$("train_map").style.left=l+"px";$("train_map").style.top=s+"px";c=h;b=v}});$("train").addEventListener("contextmenu",function(h){if(in_array(trainGrid.mode,["edit","remove"])){event.preventDefault()}});this.mapMover=1;document.onkeydown=function(e){if(trainGrid.keyPressed==1){return 1}if(!$("train")||$("train").style.display!="block"){return 1}if(!in_array(trainGrid.mode,["edit","remove"])){return 1}if(e.keyCode==65){trainGrid.keyPressed=1;$("train").addClassName("cursor-move")}};document.onkeyup=function(e){if(!$("train")||$("train").style.display!="block"){return 1}if(!in_array(trainGrid.mode,["edit","remove"])){return 1}if(e.keyCode==65){trainGrid.keyPressed=0;$("train").removeClassName("cursor-move")}}};trainGrid.prototype.moveMapClicker=function(c){var a=120;var h=$("train_map").style.left;var e=$("train_map").style.top;h=+h.replace("px","");e=+e.replace("px","");if(c=="up"){e+=a}if(c=="down"){e-=a}if(c=="left"){h+=a}if(c=="right"){h-=a}var d=-($("train_map").offsetWidth-640);var b=-($("train_map").offsetHeight-640);if(h<d){h=d}if(e<b){e=b}if(h>0){h=0}if(e>0){e=0}$("train_map").style.left=h+"px";$("train_map").style.top=e+"px"};trainGrid.prototype.pressRight=function(){if(!$("train")||$("train").style.display!="block"){return 1}if(!in_array(trainGrid.mode,["edit","remove"])){return 1}trainGrid.keyPressed=1;$("train").addClassName("cursor-move")};trainGrid.prototype.releaseRight=function(){trainGrid.keyPressed=0;$("train").removeClassName("cursor-move")};trainGrid.prototype.itemTT=function(a,h){if(train.data.config.tracks[a]){var d=train.data.config.tracks[a]}if(train.data.config.decos[a]){var d=train.data.config.decos[a]}if(!d){return 1}var c='<div id="traingrid_item_info">';c+='  <div class="name">'+d.name+"</div>";c+='  <div class="category">'+t_train_deco_category_name[d.category]+"</div>";c+='  <div class="stats">';for(var b in d){if(in_array(b,["name","level","category","x","y"])){continue}if(h>0&&in_array(b,["money","coins","train_points"])){continue}c+='<div class="stats-line">';c+='  <div class="stats-col1">'+t_train_item_stats[b]+"</div>";if(in_array(b,["money","coins","train_points"])){if(d.money){c+='<div class="stats-col2">'+formatPrice(d.money)+"</div>"}if(d.coins){c+='<div class="stats-col2">'+formatNumber(d.coins)+"&nbsp;"+t_coins+"</div>"}if(d.train_points){c+='<div class="stats-col2">'+formatNumber(d.train_points)+"&nbsp;"+t_train_points+"</div>"}}else{if(in_array(b,["duration"])){c+='<div class="stats-col2">'+formatTime(d[b])+"</div>"}else{c+='<div class="stats-col2">'+formatNumber(d[b])+"</div>"}}c+='  <div class="clear"></div>';c+="</div>"}c+="  </div>";if(train.data.config.decos[a]){c+='  <div class="train_deco deco_'+a+'"></div>'}c+='  <div class="dim">';for(y=1;y<=d.y;y++){for(x=1;x<=d.x;x++){c+='<div class="pos"></div>'}c+='<div class="clear"></div>'}c+="  </div>";c+='  <div class="clear"></div>';if(d.level&&d.level>train.data.data.level){var e="";if(train.data.config.decos[a]){e="margin-top:5px;"}c+='<div class="failed" style="'+e+'">'+t_train_requires_level.replace("%COUNT%",d.level)+"</div>"}c+="</div>";return c};trainGrid.prototype.routeTT=function(d){var l='<div id="traingrid_item_info">';l+='  <div class="flex-center-all" style="justify-content:left;">';if(this.stationTiles[this.routes[d].start]){l+='<div class="marker station">S'+this.stationTiles[this.routes[d].start].station+"</div>"}if(this.traderTiles[this.routes[d].start]){l+='<div class="marker trader">T'+this.traderTiles[this.routes[d].start].trader+"</div>"}l+='    <div class="arrow"></div>';if(this.stationTiles[this.routes[d].end]){l+='<div class="marker station">S'+this.stationTiles[this.routes[d].end].station+"</div>"}if(this.traderTiles[this.routes[d].end]){l+='<div class="marker trader">T'+this.traderTiles[this.routes[d].end].trader+"</div>"}l+="  </div>";l+='  <div class="stats">';var c=["duration","tiles","energy","durability"];for(var h=0;h<c.length;h++){var b="";var e="";var n="";if(in_array(c[h],["durability","energy"])){b="width-icon";e="special";if(c[h]=="durability"){var m=formatNumber(Math.ceil(this.routes[d].durability))}if(c[h]=="energy"){var m=formatNumber(Math.ceil(this.routes[d].energy));n="border-top: 5px solid white"}}if(c[h]=="duration"){var m=formatTime(this.routes[d].duration)}if(c[h]=="tiles"){var m=formatNumber(this.routes[d].tiles.length)}l+='<div class="stats-line '+e+'" style="'+n+'">';l+='  <div class="stats-col1 '+b+'">';if(in_array(c[h],["energy","durability"])){l+='<div class="icon icon-'+c[h]+'"></div>'}l+="    <div>"+t_train_item_stats[c[h]]+"</div>";l+="  </div>";l+='  <div class="stats-col2">'+m+"</div>";l+='  <div class="clear"></div>';l+="</div>"}l+="  </div>";l+="</div>";return l};trainGrid.prototype.randomizeBlocker=function(){var l=[];for(e in train.data.config.station){for(var d in train.data.config.station[e].starter){l.push(train.data.config.station[e].starter[d])}var b=train.data.config.station[e].init;if(train.data.config.station[e].x>train.data.config.station[e].y){b=(b-1);if(train.data.config.station[e].init>train.data.config.station[e].starter[1]){b=(b-(2*this.gridX))}}else{b=(b-this.gridX);if(train.data.config.station[e].init>train.data.config.station[e].starter[1]){b=(b-2)}}for(var s=1;s<=(+train.data.config.station[e].y+2);s++){for(var t=0;t<(+train.data.config.station[e].x+2);t++){var n=(b+t);if(!in_array(n,l)){l.push(n)}}b+=this.gridX}}for(e in train.data.config.trader){var b=(+train.data.config.trader[e].init-2)-(2*this.gridX);for(var s=1;s<=5;s++){for(var t=0;t<5;t++){var n=(b+t);if(!in_array(n,l)){l.push(n)}}b+=this.gridX}}for(var b in train.data.config.special){var a=train.data.config.special[b];if(!train.data.config.decos[a]){continue}var b=((+b-1)-this.gridX);for(s=1;s<=(+train.data.config.decos[a].y+2);s++){for(t=0;t<(+train.data.config.decos[a].x+2);t++){var n=(+b+t);if(!in_array(n,l)){l.push(n)}}b=(+b+this.gridX)}}for(var e=0;e<l.length;e++){var h="<div style='pointer-events:none; z-index:10; position:absolute; top:0px; left:0px; width:100%; height:100%; color:red; font-weight:bold; font-size:30px; display:flex; justify-content:center; align-items:center;'><span>X</span></div>";$("train_grid_tile"+l[e]).insert(h)}var u=["mountain1","mountain2","mountain2","lake1","lake2","forest2","town2","forest1","forest1","forest1","forest1","forest1"];for(var e=0;e<u.length;e++){var r=[];var q=train.data.config.decos[u[e]].x;var m=train.data.config.decos[u[e]].y;do{var b=getRandom(1,(this.gridX*this.gridY));console.log("START",b);var c=1;var v=Math.ceil(b/this.gridX);for(var s=1;s<=m;s++){for(var t=0;t<q;t++){var n=(b+t);if(n>(this.gridX*this.gridY)){c=0}if(in_array(n,l)){c=0}if(Math.ceil(n/this.gridX)!=v){c=0}if(!c){break}r.push(n)}if(!c){break}b+=this.gridX;v=Math.ceil(b/this.gridX)}if(!c){r=[]}}while(!c);console.log(u[e],q,m,r);for(var d=0;d<r.length;d++){l.push(r[d]);var h="<div style='pointer-events:none; z-index:10; position:absolute; top:0px; left:0px; width:100%; height:100%; color:blue; font-weight:bold; font-size:30px; display:flex; justify-content:center; align-items:center;'><span>O</span></div>";$("train_grid_tile"+r[d]).insert(h)}}};var veggiesplash=function(){this.data={};this.currentTool=1};veggiesplash.prototype.hit=function(a,b){veggiesplash.action("veggiesplash_hit",{x:a,y:b,tool:this.currentTool})};veggiesplash.prototype.init=function(){veggiesplash.action("veggiesplash_init")};veggiesplash.prototype.action=function(a,b){ajaxAction("farm",a,b,veggiesplash.response)};veggiesplash.prototype.response=function(b,a,c){veggiesplash.data=b;veggiesplash.build();setTimer("veggiesplash");if(b.rewards){veggiesplash.showRewards(c.x,c.y,b.rewards)}};veggiesplash.prototype.build=function(){var b="";b+='<div class="items">';for(var a in this.data.config.items){b+='<div class="item">';if(this.data.data.found&&this.data.data.found[a]){b+='<div class="found"></div>'}b+="</div>"}b+='  <div class="clear"></div>';b+="</div>";b+='<div class="free_hits">'+t_minigame_ship_freehits+'<div class="count">'+Math.max(0,this.data.data.freehits)+"</div></div>";b+='<div class="hammer">'+t_minigame_ship_clusterbombcoins.replace("%COINS%",this.data.config.hammer)+"</div>";for(var a=1;a<=2;a++){var e="";if(this.currentTool==a){e="active"}b+='<div class="tool tool'+a+" "+e+' link" onclick="veggiesplash.changeTool('+a+')"></div>'}b+='<div class="tileset">';for(var c=1;c<=6;c++){for(var d=1;d<=6;d++){var e="";var n="";var l="veggiesplash.hitCommit("+d+", "+c+")";var m="veggiesplash.markTiles("+d+", "+c+")";var h="veggiesplash.unmarkTiles()";if(this.data.data.tileset[d]&&this.data.data.tileset[d][c]){l="";m="";h="";if(this.data.data.tileset[d][c]==-1){n="failed"}else{n="item"+this.data.data.tileset[d][c]}e="block"}b+='<div id="veggiesplash_tile_'+d+"_"+c+'" class="tile link '+e+'" onclick="'+l+'" onmouseover="'+m+'" onmouseout="'+h+'">';if(n!=""){b+='<div class="filled '+n+'"></div>'}b+="</div>"}}b+='  <div class="clear"></div>';b+="</div>";if(this.data.data.found&&this.data.data.found.all){b+='<div class="finished">';b+='  <div class="info">'+t_payment_pointsboost_info2.replace("%PERCENT%",this.data.config.allpercent)+"</div>";b+="</div>"}b+='<div id="veggiesplash_resttime" class="resttime"></div>';b+='<div class="helpbutton_blue link" onclick="veggiesplash.help()"></div>';b+='<div class="mini_close link" onclick="veggiesplash.close()"></div>';$("veggiesplash_main").innerHTML=b;showDiv("veggiesplash")};veggiesplash.prototype.markTiles=function(a,c){if(this.currentTool!=2){return 1}for(var b=-1;b<=1;b++){if(!b){continue}if($("veggiesplash_tile_"+(a+b)+"_"+c)&&(!this.data.data.tileset[(a+b)]||!this.data.data.tileset[(a+b)][c])){$("veggiesplash_tile_"+(a+b)+"_"+c).addClassName("mark")}if($("veggiesplash_tile_"+a+"_"+(c+b))&&(!this.data.data.tileset[a]||!this.data.data.tileset[a][(c+b)])){$("veggiesplash_tile_"+a+"_"+(c+b)).addClassName("mark")}}};veggiesplash.prototype.unmarkTiles=function(){for(var b=1;b<=6;b++){for(var a=1;a<=6;a++){$("veggiesplash_tile_"+a+"_"+b).removeClassName("mark")}}};veggiesplash.prototype.changeTool=function(a){this.currentTool=a;this.build()};veggiesplash.prototype.hitCommit=function(b,e){if(this.data.data.freehits<=0&&this.currentTool==1){var c=t_minigame_ship_coin;var a=t_minigame_ship_coin2.replace("1",this.data.config.single);var d="veggiesplash.hit("+b+", "+e+");";globalcommitbox(c,a,d)}else{this.hit(b,e)}};veggiesplash.prototype.showRewards=function(a,e,d){if(!d){return 1}var c="";for(var b=0;b<d.length;b++){if(d[b].failed){veggiesplash.flyer(a,e,d[b].pid,d[b].amount)}else{if(d[b].found){c+='<div style="width:300px;">'+t_minigame_ship_found2.replace("%PRODUCT%",produkt_name[this.data.config.items[d[b].item].pid])+"</div>";if(d[b].money){c+='<div style="margin-top:10px; font-weight:bold; margin-bottom:20px;">'+formatPrice(d[b].money)+"</div>"}if(d[b].giftid){c+='<div style="margin-top:10px;"><img src="'+imgpath+"gifts/"+d[b].giftid+'.gif"></div>'}}}}if(c!=""){c+='<button type="button" id="globalbox_button1" class="button_yes link" style="margin-bottom:-10px;" onclick="hideDiv(\'globalbox\'); hideDiv(\'globaltransp\');"></button>';globalcommitbox(t_minigame_ship_found,c,0,0,1)}};veggiesplash.prototype.flyer=function(a,h,b,d){if(!$("veggiesplash_tile_"+a+"_"+h)){return 1}var e="veggiesplash_tile_"+a+"_"+h+"_flyer";var c='<div id="'+e+'" class="veggiesplash_flyer">'+htmlProductBody(b,d)+"</div>";$("veggiesplash_tile_"+a+"_"+h).insert(c);setTimeout(function(){if($(e)){$(e).addClassName("fly")}},200);setTimeout(function(){if($(e)){$(e).remove()}},1200)};veggiesplash.prototype.timer=function(){if(this.data.data.remain_next){this.data.data.remain_next--;$("veggiesplash_resttime").innerHTML=t_mastermind_remain+"&nbsp;"+formatTime(this.data.data.remain_next)}};veggiesplash.prototype.help=function(){showDiv("veggiesplash_help")};veggiesplash.prototype.helpClose=function(){hideDiv("veggiesplash_help")};veggiesplash.prototype.close=function(){hideDiv("veggiesplash")};var vet_data={};var vet_animal_queue_select=0;var vet_position="left";var vet_selected_drugs={};var vet_stats_select="points";var vet_stats_cache={};var vet_stats_cache_delay={};var vet_production_select_page=1;var vet_production_select_filter_id=0;var vet_production_select_filter_pos=0;var vet_wait_checkrole=0;var vet_role_reward_block=0;function initVet(){var a="";a+='<div id="vet_back" class="vet_back_left">';a+='<div id="vet_pharmacist" class="link" onmouseover="showDiv(\'vet_pharmacist_tt\')" onmouseout="hideDiv(\'vet_pharmacist_tt\')">';a+='  <div id="vet_pharmacist_timer"></div>';a+='  <div id="vet_pharmacist_tt" class="ttbox"><div>'+t_pharmacist_buy_head+'</div><div class="bonusinfo">'+t_pharmacist_info+"</div></div>";a+='  <div class="vet_pharmacist"></div>';a+='  <div id="vet_pharmacist_unlocked" class="unlocked"></div>';a+="</div>";a+='  <div id="vet_production_slots" class="vet_production_slots_normal"></div>';a+='  <div id="vet_animal_slots"></div>';a+='  <div id="vet_animal_queue"></div>';a+='  <div id="vet_sroller" class="link megafield_carpool_right" onclick="moveVet()"></div>';a+="</div>";a+=htmlLevelBar("vet");a+=htmlCountBar("vet");a+='<div id="vet_stats" class="link" onclick="vetStats()"></div>';a+='<div id="vet_quest_button" class="link" onclick="vetQuests()"></div>';a+='<div id="vet_reward_button" class="link" onclick="vetReward()"></div>';a+='<div id="vet_help_button" class="helpbutton_blue link" onclick="openFarmersMarketHowTo(\'vet\', 1);"></div>';a+='<div id="vet_timerbar" class="main_timerbar">';a+='  <div id="vet_timerbar_innerbar" class="main_timerbar_innerbar"></div>';a+='  <div id="vet_timerbar_info" class="main_timerbar_info"></div>';a+="</div>";a+='<div id="vet_flyer"></div>';a+='<div id="vet_transp" class="transp"></div>';a+='<div id="vet_animal_record"></div>';a+='<div id="vet_stats_box"></div>';a+='<div class="mini_close link" onclick="closeVet()"></div>';$("farmersmarket_pos5_inner").innerHTML=a;showDiv("transp");showDiv("farmersmarket_pos5_inner");vet_position="left";updateVet()}function updateVet(){updateVetAnimalSlots();updateVetAnimalQueue();updateVetLevel();updateVetProductionSlot();timerVet()}function updateVetLevel(){$("vet_levelbar_number").innerHTML=vet_data.info.level;if(vet_data.info.next_level_points){var e=(vet_data.info.points-vet_data.info.current_level_points);var d=(vet_data.info.next_level_points-vet_data.info.current_level_points);var h=Math.floor((e*100)/d);$("vet_levelbar_inner").style.width=h+"%";var l=(vet_data.info.next_level_points-vet_data.info.points);$("vet_levelbar_tt").innerHTML=str_replace("%POINTS%",formatNumber(l),t_vet_level_tt)}else{$("vet_levelbar_tt").innerHTML=t_reached_maxlevel;$("vet_levelbar_inner").style.width="100%"}$("vet_levelbar_plus").onclick=new Function("vetDialog('add_level')");$("vet_levelbar_plus_tt").innerHTML=t_vet_leveladd_tt;$("vet_countbar_inner").innerHTML='<div style="float:left; margin:-4px 5px 0 0;" class="vet_leveladd_item"></div><div style="float:left;">'+vet_data.info.count+'</div><div class="clear"></div>';$("vet_countbar_plus").onclick=new Function("vetDialog('buy_addlevel')");$("vet_countbar_plus_tt").innerHTML=t_vet_levelitem_buy}function showVetMedicalRecord(h){if(vet_data.animals.slots&&vet_data.animals.slots[h]){var q=vet_data.animals.slots[h];var e=vet_data.animals.queue[q.id];var d="";d+='<div id="vet_medicalrecord_info'+h+'" class="vet_medicalrecord_info">'+t_vet_medicalrecord_clickdrug+"</div>";d+='<div style="position:absolute; top:85px; left:50%; width:340px; margin-left:-170px;">';for(var c=0;c<e.diseases.length;c++){var b=e.diseases[c].id;d+='<div class="vet_medicalrecord_line">';d+='  <div style="float:left; margin:9px 5px 0 0;">'+showDiseaseIcon(b,"medicalrecord",0,"big")+"</div>";d+='  <div style="position:absolute; top:5px; left:45px; background-color:#fff; border-radius:20px; height:17px; width:20px; text-align:center; padding-top:2px; font-weight:bold;">'+e.diseases[c].phase+"</div>";d+='  <div class="square_slot link" style="float:left; position:relative;" onclick="vetDrugSelect('+h+", "+b+')">';d+='  <div id="vet_medicalrecord_square'+h+"_"+b+'" style="position:absolute; top:11px; left:20px;"></div>';d+="  </div>";d+='  <div id="drugSelect'+h+"_"+b+'" class="drug_select">';for(var m in vet_data.drugs){if(in_array(b,vet_data.drugs[m].diseases)&&vet_data.drugs[m].level<=vet_data.info.level){var l="<div>"+produkt_name[m]+"</div>";l+="<div>"+t_heal_time+"&nbsp;"+formatTime(vet_data.drugs[m].times[b])+"</div>";var n="vetDiseaseSetDrug("+h+", "+b+", "+m+")";if(!(checkRackItem(m)>=e.diseases[c].phase)){}d+='<div style="float:left; position:relative; padding:5px; margin-right:10px;">';d+='  <div id="vet_animal_disease_option'+h+"_"+b+"_"+m+'" class="vet_animal_disease_option_drug tt'+m+' link" onclick="'+n+'" onmouseover="showDiv(vet_animal_disease_option_tt'+h+"_"+e.diseases[c].id+"_"+m+')" onmouseout="hideDiv(vet_animal_disease_option_tt'+h+"_"+e.diseases[c].id+"_"+m+')">';d+='    <div id="vet_animal_disease_option_tt'+h+"_"+b+"_"+m+'" class="vet_animal_disease_option_tt ttbox">'+l+"</div>";d+='    <div id="vet_animal_disease_option_select'+h+"_"+b+"_"+m+'" class="vet_animal_disease_option_drug_active"></div>';d+='    <div class="vet_animal_disease_option_phase">'+e.diseases[c].phase+"x</div>";d+="  </div>";d+="</div>"}}d+='    <div class="clear"></div>';d+="  </div>";d+='  <div class="clear"></div>';d+="</div>"}d+="</div>";d+='<div id="vet_medicalrecord_missing_products"></div>';d+='<div class="vet_medicalrecord_rewardblock">';d+='  <div style="float:left;"><img src="'+imgpath+'vet_role2_icon.png" style="width:40px; float:left;"><div style="float:left; margin:13px 0 0 3px; width:120px;" id="vet_medicalrecord_duration'+h+'" class="vet_medicalrecord_duration">'+formatTime(0)+'</div><div class="clear"></div></div>';d+='  <div style="float:left;"><div class="megafield_points_icon" style="float:left;"></div><div style="float:left; margin:13px 0 0 3px; width:120px;" class="vet_animal_queue_item_tt_reward_item" id="vet_medicalrecord_points">0&nbsp;'+t_points+'</div><div class="clear"></div></div>';d+='  <div style="float:left;"><img src="'+imgpath+'vet_patch50x50.png" style="width:40px; float:left;"><div style="float:left; margin:13px 0 0 3px; width:120px;" class="vet_animal_queue_item_tt_reward_item" id="vet_medicalrecord_vet_points">0&nbsp;'+t_vet_points+'</div><div class="clear"></div></div>';d+='  <div style="float:left;"><div class="megafield_money_icon" style="float:left;"></div><div style="float:left; margin:13px 0 0 3px; width:120px;" class="vet_animal_queue_item_tt_reward_item" id="vet_medicalrecord_money">'+formatPrice(0)+'</div><div class="clear"></div></div>';d+='  <div class="clear"></div>';d+="</div>";d+='<div class="vet_medicalrecord_reward_info">'+t_vet_medicalrecord_reward_info+"</div>";d+='<button id="vet_animal_disease_start'+h+'" class="button_new vet_animal_disease_start link" onclick="vetStartTreatment('+h+');">'+t_vet_medicalrecord_start+"</button>";d+='<button id="vet_animal_disease_end'+h+'" class="button_new vet_animal_disease_end link" onclick="vetEndTreatment('+h+');">'+t_vet_medicalrecord_harvest+"</button>";if(devserver==1){d+='<button id="vet_animal_disease_speedup'+h+'" class="button_new vet_animal_disease_speedup link" onclick="vetDialog(\'disease_speedup\', '+h+');">'+t_vet_medicalrecord_speedup+"</button>"}d+="<div class=\"link mini_close\" onclick=\"hideDiv('vet_animal_record'); hideDiv('vet_transp'); vet_selected_drugs={}\"></div>";$("vet_animal_record").innerHTML=d;showDiv("vet_transp");showDiv("vet_animal_record");controlVetMedicalRecord(h)}}function vetDrugSelect(h,d){if(vet_data.animals.slots&&vet_data.animals.slots[h]){var b=vet_data.animals.queue[vet_data.animals.slots[h].id];for(var c=0;c<b.diseases.length;c++){var e=b.diseases[c].id;if(e!=d){hideDiv("drugSelect"+h+"_"+e)}}}toogleDiv("drugSelect"+h+"_"+d)}function updateVetMedicalRecord(r,h){var c=0;var t=0;var u=0;var b=0;var z=vet_data.animals.slots[r];var q=vet_data.animals.queue[z.id];for(var e in h){var l=1;for(var d=0;d<q.diseases.length;d++){if(q.diseases[d].id==e){l=q.diseases[d].phase;break}}var v=h[e];c+=vet_data.drugs[v].times[e];b+=l*vet_data.drugs[v].reward[e].money;t+=l*vet_data.drugs[v].reward[e].points;u+=l*vet_data.drugs[v].reward[e].vet_points;showDiv("vet_animal_disease_option_select"+r+"_"+e+"_"+v);if($("vet_medicalrecord_square"+r+"_"+e)){$("vet_medicalrecord_square"+r+"_"+e).className="tt"+v}}if($("vet_medicalrecord_duration"+r)){if(c>0){var w="";if(vet_data.quest&&vet_data.quest.bonus_all&&vet_data.quest.bonus_all.treatment_reduce){w="&nbsp;(-"+vet_data.quest.bonus_all.treatment_reduce+"%)";c=Math.ceil(c-((c/100)*vet_data.quest.bonus_all.treatment_reduce))}$("vet_medicalrecord_duration"+r).innerHTML=formatTime(c)+w}else{$("vet_medicalrecord_duration"+r).innerHTML=formatTime(0)}var w="";if(vet_data.quest&&vet_data.quest.bonus_all&&vet_data.quest.bonus_all.pat_bandage){w="&nbsp;(+"+vet_data.quest.bonus_all.pat_bandage+"%)";u=Math.ceil(u*((100+vet_data.quest.bonus_all.pat_bandage)/100))}$("vet_medicalrecord_vet_points").innerHTML=formatNumber(u)+"&nbsp;"+t_vet_points+w;var w="";if(vet_data.quest&&vet_data.quest.bonus_all&&vet_data.quest.bonus_all.pat_money){w="&nbsp;(+"+vet_data.quest.bonus_all.pat_money+"%)";b=Math.ceil(b*((100+vet_data.quest.bonus_all.pat_money)/100))}$("vet_medicalrecord_money").innerHTML=formatPrice(b)+w;var w="";var m=0;if(vet_data.quest&&vet_data.quest.bonus_all&&vet_data.quest.bonus_all.pat_points){var m=vet_data.quest.bonus_all.pat_points;w="&nbsp;(+"+m+"%)"}if(specialbonus){var n=specialbonus.findBonus({key1:"vet",key2:"points"});if(n){w+='<br><span style="color:green;">(+'+(n.points*100)+"% "+t_specialbonus_vet_points_info+")</span>";m+=(n.points*100)}}t=Math.ceil(t*((100+m)/100));$("vet_medicalrecord_points").innerHTML=formatNumber(t)+"&nbsp;"+t_points+w}}function updateVetAnimalSlots(){var d="";for(var h=1;h<=3;h++){var e=0;if(vet_data.animals.slots&&vet_data.animals.slots[h]){e=vet_data.animals.slots[h]}d+='<div id="vet_animal_slot'+h+'" class="vet_animal_slot link">';if(e&&e.id&&vet_data.animals.queue[e.id]){var b=vet_data.animals.queue[e.id];d+='<div id="vet_animal_queue_animal_img'+h+'" onmouseover="showDiv(\'vet_animal_queue_animal_timer'+h+"')\" onmouseout=\"hideDiv('vet_animal_queue_animal_timer"+h+"')\"></div>";d+='<div id="vet_animal_queue_animal_timer'+h+'" class="ttbox vet_animal_queue_animal_timer"><div class="bonusinfo">'+t_vet_open_medicalrecord+"</div></div>";d+='<div id="vet_animal_queue_animal'+e.id+'_tt" class="vet_animal_queue_animal_tt ttbox">';if(b.reward.player_points){d+='<div class="vet_animal_queue_item_tt_reward_item">'+b.reward.player_points+"&nbsp;"+t_points+"</div>"}if(b.reward.vet_points){d+='<div class="vet_animal_queue_item_tt_reward_item">'+b.reward.vet_points+"&nbsp;"+t_vet_points+"</div>"}if(b.reward.money){d+='<div class="vet_animal_queue_item_tt_reward_item">'+formatPrice(b.reward.vet_points)+"</div>"}d+="</div>"}d+='  <div id="vet_animal_disease_healani'+h+'" class="vet_animal_disease_healani">';for(var c=1;c<=3;c++){d+='<div id="vet_heal_plus'+c+'" class="vet_heal_plus"></div>'}d+="  </div>";d+='  <div id="vet_animal_slot_block'+h+'" class="vet_animal_slot_block" style="left:50%; top:50%; margin-left:-40px; margin-top:-63px;" onmouseover="showDiv(\'vet_animal_slot_block'+h+"_tt')\" onmouseout=\"hideDiv('vet_animal_slot_block"+h+"_tt')\">";d+='    <div id="vet_animal_slot_block'+h+'_tt" class="vet_animal_slot_block_tt ttbox"></div>';d+="  </div>";d+='  <div id="vet_animal_slot_rent_timer'+h+'" class="vet_animal_slot_rent_timer"></div>';d+="</div>";d+='<div id="vet_animal_flyer'+h+'" class="vet_animal_flyer"></div>';d+='<div id="vet_animal_cashup'+h+'" class="vet_cashup link" onclick="vetEndTreatment('+h+');" onmouseover="showDiv(\'vet_animal_cashup'+h+"_tt')\" onmouseout=\"hideDiv('vet_animal_cashup"+h+"_tt')\">";d+='  <div id="vet_animal_cashup'+h+'_tt" class="ttbox vet_animal_cashup_tt">'+t_vet_medicalrecord_harvest+"</div>";d+="</div>"}$("vet_animal_slots").innerHTML=d;for(var h in vet_data.animals.slots){vetCheckDiseaseStart(h)}}function updateVetAnimalQueue(){var h=0;for(var u=1;u<=3;u++){var r=1;if(vet_data.animals.slots&&vet_data.animals.slots[u]&&(vet_data.animals.slots[u].id||vet_data.animals.slots[u].block)){r=0;h++}if(vet_animal_queue_select&&r==1){$("vet_animal_slot"+u).addClassName("vet_animal_slot_hover")}else{$("vet_animal_slot"+u).removeClassName("vet_animal_slot_hover")}}var m="";var q=0;for(var b in vet_data.animals.queue){var t=vet_data.animals.queue[b];if(t.status==0){var v="";if(vet_animal_queue_select==b){v="vet_animal_queue_active"}var d="left";var c="";if(!vet_animal_queue_select){c=t_vet_queue_tut1;if(h==3){c=t_vet_queue_tut3}}if(vet_animal_queue_select==b){c=t_vet_queue_tut2}var w="setVetAnimalQueueSelect("+b+")";if(h==3){w=""}m+='<div id="vet_animal_queue'+b+'" class="vet_animal_queue_item" onclick="'+w+'" onmouseover="showDiv(\'vet_animal_queue_item_tt'+b+"')\" onmouseout=\"hideDiv('vet_animal_queue_item_tt"+b+"')\">";m+='  <div class="'+v+'"></div>';var n="sick";if(t.verysick){n="verysick"}m+='  <div class="vet_animal_queue_animal_img'+t.animalid+"_"+n+'_queue"></div>';m+='  <div id="vet_animal_queue_item_tt'+b+'" class="vet_animal_queue_item_tt_'+d+' ttbox">';for(var l=0;l<t.diseases.length;l++){var e=0;var v="";for(var s in vet_data.drugs){if(in_array(t.diseases[l].id,vet_data.drugs[s].diseases)){if(checkRackItem(s)>=t.diseases[l].phase){e=1}}}if(!e){v="important"}m+='<div style="margin-bottom:2px; width:150px;">';m+='  <div class="vet_animal_disease vet_animal_disease'+t.diseases[l].id+'" style="float:left; margin-right:5px;"></div>';m+='  <div class="'+v+'" style="float:left; width:95px; margin-top:3px;">'+vet_data.diseases[t.diseases[l].id].name+" ("+t_vet_phase+"&nbsp;"+t.diseases[l].phase+")</div>";m+='  <div class="clear"></div>';m+="</div>"}m+='     <div class="vet_animal_queue_item_tt_reward">';if(t.reward.player_points){m+='<div class="vet_animal_queue_item_tt_reward_item">'+t.reward.player_points+"&nbsp;"+t_points+"</div>"}if(t.reward.vet_points){m+='<div class="vet_animal_queue_item_tt_reward_item">'+t.reward.vet_points+"&nbsp;"+t_vet_points+"</div>"}if(t.reward.money){m+='<div class="vet_animal_queue_item_tt_reward_item">'+formatPrice(t.reward.money)+"</div>"}m+='       <div class="clear"></div>';m+="     </div>";if(c!=""){m+='<div class="bonusinfo">'+c+"</div>"}m+="  </div>";m+='  <div id="vet_animal_queue_flyer'+b+'" class="vet_animal_queue_flyer"></div>';m+="</div>";q++}}$("vet_animal_queue").innerHTML=m}function updateVetProductionSlot(){var c="";for(var b=1;b<=4;b++){c+='<div id="vet_production_slot'+b+'" class="vet_production_slot vet_production_slot_normal">';c+='  <div id="vet_production_slot_flask'+b+'" class="flask_big" style="position:absolute; left:5px; display:none;"></div>';c+='  <div id="vet_production_slot_img'+b+'" class="vet_production_slot_img"></div>';c+='  <div id="vet_production_slot_info'+b+'" class="vet_production_slot_info"></div>';c+='  <div id="vet_production_slot_click'+b+'" class="link" style="position:absolute; left:0px; top:0px; width:100%; height:100%;"></div>';c+='  <div id="vet_pharmacist_slots'+b+'" class="vet_pharmacist_slots">';for(var a=1;a<=3;a++){c+='<div id="vet_pharmacist_slot'+b+"_"+a+'" class="link vet_pharmacist_slot" onmouseover="showDiv(\'vet_pharmacist_slot_tt'+b+"_"+a+"')\" onmouseout=\"hideDiv('vet_pharmacist_slot_tt"+b+"_"+a+"')\">";c+='  <div id="vet_pharmacist_slot_img'+b+"_"+a+'" class="vet_pharmacist_slot_img"></div>';c+='  <div id="vet_pharmacist_slot_status'+b+"_"+a+'" class="vet_pharmacist_slot_status"></div>';c+='  <div id="vet_pharmacist_slot_tt'+b+"_"+a+'" class="ttbox vet_pharmacist_slot_tt"></div>';c+="</div>"}c+="  </div>";c+='  <div id="vet_production_slot_speedup'+b+'" class="vet_production_slot_speedup speedupgardenbutton link" onclick="vetDialog(\'production_slot_speedup\', '+b+');" onmouseover="showDiv(\'vet_production_slot_speedup'+b+"_tt')\" onmouseout=\"hideDiv('vet_production_slot_speedup"+b+"_tt')\">";c+='    <div id="vet_production_slot_speedup'+b+'_tt" class="ttbox vet_production_slot_speedup_tt">'+building_speeduptext+"</div>";c+="  </div>";c+='  <div id="vet_production_slot_rent_timer'+b+'" class="vet_production_slot_rent_timer"></div>';c+='  <div id="vet_production_slot_block'+b+'" class="link vet_production_slot_block"></div>';c+="</div>"}$("vet_production_slots").innerHTML=c}function vetProductionSlot(l,d){if($("vet_production_slot"+l)){var n="vetDialog('production_select', "+l+", 1)";hideDiv("vet_production_slot_speedup"+l);hideDiv("vet_production_slot_img"+l);hideDiv("vet_production_slot_flask"+l);$("vet_production_slot_img"+l).className="vet_production_slot_img";$("vet_production_slot_info"+l).innerHTML=t_start_production;if(vet_data.production[l]&&vet_data.production[l][d]){var a=vet_data.production[l][d];n="";if(vet_data.info.queue_remain>0){for(var b=1;b<=3;b++){if(!vet_data.production[l][b]){n="vetDialog('production_select', "+l+", "+b+")";break}}}var m="";var e="";var c=parseInt(a.amount);if(specialbonus){var h=specialbonus.findBonus({key1:"vet",key2:"harvest"});if(h){c+=h.harvest;m='<div style="color:green;">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+h.harvest)+")</div>";e="color:green;"}}$("vet_production_slot_img"+l).addClassName("tt"+a.pid);$("vet_production_slot_info"+l).innerHTML='<div style="'+e+'"><b>'+c+"x&nbsp;"+produkt_name[a.pid]+"</b>"+m+"</div>";showDiv("vet_production_slot_img"+l);showDiv("vet_production_slot_flask"+l);if(a.remain&&a.remain>0){$("vet_production_slot_info"+l).innerHTML+="<div>"+formatTime(a.remain)+"</div>";showDiv("vet_production_slot_speedup"+l)}else{if(vet_data.production[l]["gone"]>=vet_data.production[l]["duration"]){n="vetHarvestProduction("+l+", "+d+")";$("vet_production_slot_info"+l).innerHTML+='<div style="position:absolute; bottom:0px;">'+click4products+"</div>"}}}$("vet_production_slot_click"+l).onclick=new Function(n)}}function checkVetProductionSlotBlock(m,b){if($("vet_production_slot"+m)){var e="";hideDiv("vet_production_slot_block"+m);if(vet_data.animals.slots2&&vet_data.animals.slots2[m]&&vet_data.animals.slots2[m].block){var c="";var h="";var d=specialbonus.findBonus({key1:"vet",key2:"rentslot"});if(d){h=specialbonus.htmlBonusLine(d.rentslot,1);c="specialbonus_bonus_value"}var l="";if(vet_data.production[m]&&vet_data.production[m][b]&&vet_data.production[m][b].pid){l='<div style="font-weight:bold;">'+vet_data.production[m][b].amount+"x&nbsp;"+produkt_name[vet_data.production[m][b].pid]+"</div>"}showDiv("vet_production_slot_block"+m);hideDiv("vet_production_slot_speedup"+m);if(vet_data.animals.slots2[m].rent_duration){var a=vet_data.animals.slots2[m].coins;if(d){a=Math.ceil(a*(1-d.rentslot))}var l=str_replace("%TIME%",formatTime(vet_data.animals.slots2[m].rent_duration),t_rent_slot);l=str_replace("%COINS%",'<span class="'+c+'">'+a+"&nbsp;"+t_coins+"</span>",l);e="vetDialog('rent_production_slot', "+m+")";hideDiv("vet_pharmacist_slots"+m);if(specialbonus){var d=specialbonus.findBonus({key1:"rentslots",key2:"discount"});if(d&&in_array("vet",d.types)){l+='<div id="vet_productionslot'+m+'_bonus_star" class="production_slot bonus_star pulse">';l+='  <div class="inner">';l+='    <div class="percent">'+(d.discount*100)+"%</div>";l+="    <div>"+t_specialbonus_pets_packagediscount_info+"</div>";l+="  </div>";l+="</div>"}}}else{if(vet_data.animals.slots2[m].money){var l=str_replace("%MONEY%",formatPrice(vet_data.animals.slots2[m].money),t_buy_slot)}if(vet_data.animals.slots2[m].coins){var a=vet_data.animals.slots2[m].coins;if(d){a=Math.ceil(a*(1-d.rentslot))}var l=str_replace("%MONEY%",'<span class="'+c+'">'+a+"&nbsp;"+t_coins+"</span>",t_buy_slot)}e="vetDialog('buy_production_slot', "+m+")";hideDiv("vet_pharmacist_slots"+m)}if(h!=""){l+=h}$("vet_production_slot_info"+m).innerHTML='<div style="position:absolute; bottom:0px;">'+l+"</div>"}if(e!=""){$("vet_production_slot_click"+m).onclick=new Function(e);$("vet_production_slot_block"+m).onclick=new Function(e)}}}function getVetCurrentProductionPos(d){var b=0;if(vet_data.production[d]){if(vet_data.production[d]["gone"]>=vet_data.production[d]["duration"]){for(var a=1;a<=3;a++){if(vet_data.production[d][a]){b=a}}}else{var c=0;for(var a=1;a<=3;a++){if(vet_data.production[d][a]){c+=parseInt(vet_data.production[d][a].duration);if(c>vet_data.production[d]["gone"]){b=a;break}}}}}return b}function timerVet(){if(vet_data.currenttime){vet_data.currenttime++}if(vet_data.animals){for(var d=1;d<=3;d++){var n=1;var t="setVetAnimalSlot("+d+")";if(vet_data.animals.slots&&vet_data.animals.slots[d]){if(vet_data.animals.slots[d].id){vet_data.animals.slots[d].remain--;n=0}if(vet_data.animals.slots[d].rent_duration){vet_data.animals.slots[d].rent_remain--}if($("vet_animal_slot"+d)){if($("vet_animal_queue_animal_img"+d)){$("vet_animal_queue_animal_img"+d).className="";if(vet_data.animals.slots[d].id){var B=vet_data.animals.queue[vet_data.animals.slots[d].id].animalid;var m="sick";if(vet_data.animals.queue[vet_data.animals.slots[d].id].verysick){m="verysick"}$("vet_animal_queue_animal_img"+d).className="vet_animal_queue_animal_img"+B+"_"+m}}hideDiv("vet_animal_slot_block"+d);if(vet_data.animals.slots[d].id){t="showVetMedicalRecord("+d+")"}if(vet_data.animals.slots[d].rent_duration){if(vet_data.animals.slots[d].rent_remain>0){if($("vet_animal_slot_rent_timer"+d)){$("vet_animal_slot_rent_timer"+d).innerHTML=formatTime(vet_data.animals.slots[d].rent_remain);showDiv("vet_animal_slot_rent_timer"+d)}}else{vet_data.animals.slots[d].block=1;if($("vet_animal_slot_rent_timer"+d)){hideDiv("vet_animal_slot_rent_timer"+d)}}}if(vet_data.animals.slots[d].block){n=0;showDiv("vet_animal_slot_block"+d);if(vet_data.animals.slots[d].rent_duration){var q=str_replace("%TIME%",formatTime(vet_data.animals.slots[d].rent_duration),t_vet_animal_slot_rent);q=str_replace("%COINS%",vet_data.animals.slots[d].coins+"&nbsp;"+t_coins,q);t="vetDialog('rent_animal_slot', "+d+")"}else{var q=str_replace("%MONEY%",formatPrice(vet_data.animals.slots[d].money),t_vet_animal_slot_buy);t="vetDialog('buy_animal_slot', "+d+")"}$("vet_animal_slot_block"+d+"_tt").innerHTML=q}}}if($("vet_animal_slot"+d)){$("vet_animal_slot"+d).onclick=new Function(t)}controlVetMedicalRecord(d)}for(var d=1;d<=4;d++){if(vet_data.animals.slots2&&vet_data.animals.slots2[d]){if(vet_data.animals.slots2[d].rent_duration){if(vet_data.animals.slots2[d].rent_remain>0){vet_data.animals.slots2[d].rent_remain--;if($("vet_production_slot_rent_timer"+d)){$("vet_production_slot_rent_timer"+d).innerHTML=formatTime(vet_data.animals.slots2[d].rent_remain);showDiv("vet_production_slot_rent_timer"+d)}}else{vet_data.animals.slots2[d].block=1;if($("vet_production_slot_rent_timer"+d)){hideDiv("vet_production_slot_rent_timer"+d)}}}}}if($("vet_pharmacist")){vet_data.info.queue_remain--;var v="vetDialog('buy_pharmacist')";if(vet_data.info.queue_remain>0){$("vet_pharmacist_timer").innerHTML=formatTime(vet_data.info.queue_remain);showDiv("vet_pharmacist_timer");hideDiv("vet_pharmacist_unlocked");v=""}else{hideDiv("vet_pharmacist_timer");showDiv("vet_pharmacist_unlocked")}var e=0;for(var z=1;z<=4;z++){var c=0;var h=0;for(var w=1;w<=3;w++){if(vet_data.production[z]&&vet_data.production[z][w]){h++}}if(vet_data.info.queue_remain<=0&&(!h||h<=1)){hideDiv("vet_pharmacist_slots"+z)}else{e++;showDiv("vet_pharmacist_slots"+z)}for(var w=1;w<=3;w++){if(vet_data.production[z]&&vet_data.production[z][w]){var s=getVetCurrentProductionPos(z);c+=parseInt(vet_data.production[z][w].duration);var u="harvest";var t="vetHarvestProduction("+z+", "+w+")";if(vet_data.production[z]["gone"]<c){u="next";var t=""}if(s==w&&vet_data.production[z]["gone"]<c){u="running";var t=""}$("vet_pharmacist_slot_img"+z+"_"+w).className="vet_pharmacist_slot_img tt"+vet_data.production[z][w].pid;$("vet_pharmacist_slot_status"+z+"_"+w).className="vet_pharmacist_slot_status "+u;var a=produkt_name[vet_data.production[z][w].pid]}else{if(vet_data.info.queue_remain>0){var t="vetDialog('production_select', "+z+", "+w+")";var a=t_pharmacist_free_slot}else{var t="";var a=t_pharmacist_free_slot_block}}$("vet_pharmacist_slot_tt"+z+"_"+w).innerHTML=a;$("vet_pharmacist_slot"+z+"_"+w).onclick=new Function(t)}}if(e>0){$("vet_production_slots").className="vet_production_slots_spacer";for(var A=1;A<=4;A++){$("vet_production_slot"+A).className="vet_production_slot vet_production_slot_spacer"}}else{$("vet_production_slots").className="vet_production_slots_normal"}$("vet_pharmacist").onclick=new Function(v)}if(vet_data.production){for(var d=1;d<=4;d++){if(vet_data.production[d]){vet_data.production[d]["gone"]++}var s=getVetCurrentProductionPos(d);if(vet_data.production[d]&&vet_data.production[d][s]){vet_data.production[d][s].remain--}for(var l=1;l<s;l++){vet_data.production[d][l].remain=0}vetProductionSlot(d,s);checkVetProductionSlotBlock(d,s)}production.buildOuterProductionLine("vet")}for(var r in vet_data.animals.queue){if($("vet_animal_queue_flyer"+r)){var C=getRandom(1,30);if(C==20){if($("vet_animal_queue_flyer"+r).style.display!="block"){var C=getRandom(1,vet_queue_animal_sound.length);showFeedback("vet_animal_queue_flyer"+r,vet_queue_animal_sound[(C-1)])}}if(C==10||C==30){new Effect.Shake("vet_animal_queue"+r,{duration:0.2,distance:4})}}}for(var A in vet_stats_cache_delay){vet_stats_cache_delay[A]--}}if(vet_data.info&&vet_data.info.role_remain){vet_data.info.role_remain--}if($("vet_timerbar")&&$("farmersmarket_pos5_inner").style.display=="block"){if(vet_data.info.role>0){showDiv("vet_timerbar");if(vet_data.info.role_remain>0){$("vet_timerbar_info").innerHTML=formatTime(vet_data.info.role_remain)+"&nbsp;|&nbsp;"+t_vet_role_name[vet_data.info.role]+"&nbsp;|&nbsp;"+t_vet_role_countinfo+"<b>"+vet_data.info.role_count+"/"+vet_data.info.role_count_max+"</b>";var b=100-((vet_data.info.role_remain*100)/vet_data.constants.role_duration);$("vet_timerbar_innerbar").style.width=b+"%";$("vet_timerbar")}else{$("vet_timerbar_info").innerHTML=t_vet_role_end;$("vet_timerbar_innerbar").style.width="100%";if(!vet_wait_checkrole&&!vet_role_reward_block){vetCheckRole()}}}else{hideDiv("vet_timerbar");if($("farmersmarket_pos5_inner").style.display=="block"&&!vet_role_reward_block){if(vet_position=="left"){vetDialog("selectrole")}}}}if(vet_data.quest){if(vet_data.quest.remain){vet_data.quest.remain--}checkVetQuestTimer()}}function checkVetQuestTimer(){if(vet_data.quest&&$("vet_questentry_info")){showDiv("vet_questentry_info");hideDiv("vet_questentry_warning");var a="";if(vet_data.quest.remain>0){hideDiv("vet_questentry_info");showDiv("vet_questentry_warning");$("vet_questentry_warning").innerHTML=formatTime(vet_data.quest.remain)}if(vet_data.quest.levelblock==1){hideDiv("vet_questentry_info");showDiv("vet_questentry_warning");$("vet_questentry_warning").innerHTML='<div style="margin-top:20px;" class="important">'+str_replace("%LEVEL%",vet_data.quest.level,t_vet_level_required)+"</div>"}}}function controlVetMedicalRecord(h){if(vet_data.animals.slots&&vet_data.animals.slots[h]&&vet_data.animals.slots[h].remain){var b=vet_data.animals.queue[vet_data.animals.slots[h].id].animalid;updateVetMedicalRecord(h,vet_data.animals.queue[vet_data.animals.slots[h].id].drugs);var c='<div class="bonusinfo">'+t_vet_open_medicalrecord+"</div>";if(vet_data.animals.slots[h].remain>0){var e="";var d=vet_data.animals.slots[h].remain;if(vet_data.quest&&vet_data.quest.bonus_all&&vet_data.quest.bonus_all.treatment_reduce){e="&nbsp;(-"+vet_data.quest.bonus_all.treatment_reduce+"%)"}showDiv("vet_medicalrecord_duration"+h);if($("vet_animal_disease_speedup"+h)){showDiv("vet_animal_disease_speedup"+h)}showDiv("vet_animal_disease_healani"+h);var a="sick";if(vet_data.animals.queue[vet_data.animals.slots[h].id].verysick){a="verysick"}if($("vet_animal_queue_animal_img"+h)){$("vet_animal_queue_animal_img"+h).className="vet_animal_queue_animal_img"+b+"_"+a}if($("vet_medicalrecord_duration"+h)){$("vet_medicalrecord_duration"+h).innerHTML=formatTime(d)+e}if($("vet_animal_queue_animal_timer"+h)){$("vet_animal_queue_animal_timer"+h).innerHTML=formatTime(vet_data.animals.slots[h].remain)+c}}else{showDiv("vet_animal_disease_end"+h);showDiv("vet_animal_cashup"+h);if($("vet_animal_disease_speedup"+h)){hideDiv("vet_animal_disease_speedup"+h)}hideDiv("vet_animal_disease_healani"+h);if($("vet_animal_queue_animal_img"+h)){$("vet_animal_queue_animal_img"+h).className="vet_animal_queue_animal_img"+b}if($("vet_medicalrecord_duration"+h)){$("vet_medicalrecord_duration"+h).innerHTML=formatTime(0)}if($("vet_animal_queue_animal_timer"+h)){$("vet_animal_queue_animal_timer"+h).innerHTML=statusProductionComplete+c}}}}function setVetAnimalQueueSelect(a){if(vet_animal_queue_select==a){vet_animal_queue_select=0}else{vet_animal_queue_select=a}updateVetAnimalQueue()}function setVetAnimalSlot(a){if(vet_animal_queue_select>0){farmAction("vet_setslot",1,1,a,vet_animal_queue_select);vet_animal_queue_select=0}}function vetDiseaseShowDrugs(b,a){if($("vet_animal_disease_option"+b+"_"+a).style.display=="block"){hideDiv("vet_animal_disease_option"+b+"_"+a)}else{showDiv("vet_animal_disease_option"+b+"_"+a)}}function vetDiseaseSetDrug(c,b,a){if(vet_data.animals.slots[c].remain){return false}if(vet_selected_drugs[c]&&vet_selected_drugs[c][b]&&vet_selected_drugs[c][b]==a){delete vet_selected_drugs[c][b]}else{if(!vet_selected_drugs[c]){vet_selected_drugs[c]={}}vet_selected_drugs[c][b]=a}showVetMedicalRecord(c);updateVetMedicalRecord(c,vet_selected_drugs[c]);vetCheckDiseaseStart(c)}function vetCheckDiseaseStart(u){var b=0;var z=vet_data.animals.slots[u];if(z.id){var t=vet_data.animals.queue[z.id];b=1;for(var d=0;d<t.diseases.length;d++){if(!vet_selected_drugs[u]||!vet_selected_drugs[u][t.diseases[d].id]){b=0}}var e={};for(var d=0;d<t.diseases.length;d++){if(!e[t.diseases[d].id]){e[t.diseases[d].id]=0}e[t.diseases[d].id]+=t.diseases[d].phase}var m={};if(vet_selected_drugs[u]){for(var q in vet_selected_drugs[u]){if(e[q]){var l=e[q]}if(!m[vet_selected_drugs[u][q]]){m[vet_selected_drugs[u][q]]=0}m[vet_selected_drugs[u][q]]+=l}}var c=0;var h="";for(var w in m){var r=m[w];var n=checkRackItem(w);if(!(n>=m[w])){if(n){r=(m[w]-n)}var v=str_replace("%PRODUCT%",produkt_name[w],windmill_missedproducts);h+='<div style="float:left; margin-right:5px;" class="kp'+w+'"></div>';h+='<div style="float:left;">'+str_replace("%AMOUNT%",r,v)+"</div>";h+='<div class="clear"></div>';c++}}if($("vet_medicalrecord_missing_products")){$("vet_medicalrecord_missing_products").innerHTML=h}}if(b==1&&!c){showDiv("vet_animal_disease_start"+u)}else{hideDiv("vet_animal_disease_start"+u)}}function vetSetProductionSelectFilter(c,b,a){vet_production_select_filter_id=b;vet_production_select_filter_pos=a;vet_production_select_page=1;vetDialog("production_select",c)}function vetDialog(c,t,S,P){if(c=="buy_pharmacist"){var r=vet_data.constants.queue_coins;var K=specialbonus.findBonus({key1:"vet",key2:"pharmacist"});if(K){r=Math.ceil(r*(1-K.pharmacist));d=specialbonus.htmlBonusLine(K.pharmacist);Q="specialbonus_bonus_value"}if(t==1){var u=t_pharmacist_buy_head2}else{var u=t_pharmacist_buy_head}var E=str_replace("%TIME%",formatTime(vet_data.constants.queue_duration),t_pharmacist_buy_body);var C='<div style="margin-bottom:10px;">'+t_pharmacist_info+"</div><div>"+str_replace("%COINS%",'<span class="'+Q+'">'+r+"</span>",E)+"</div>";if(d!=""){C+='<div style="margin-top:5px;">'+d+"</div>"}var L="farmAction('vet_buypharmacist', 1, 1)";var R=0;if(!vet_data.info.vet_pharmacist_remember_box){R="farmAction('vet_pharmacist_remember', 1, 1); hideDiv('globaltransp'); hideDiv('globalbox')"}globalcommitbox(u,C,L,R)}if(c=="buy_production_slot"){var r=vet_data.animals.slots2[t].coins;var d="";var Q="";var K=specialbonus.findBonus({key1:"vet",key2:"rentslot"});if(K){r=Math.ceil(r*(1-K.rentslot));d=specialbonus.htmlBonusLine(K.rentslot);Q="specialbonus_bonus_value"}var u="";var C=str_replace("%MONEY%",'<span class="'+Q+'">'+r+"&nbsp;"+t_coins+"</span>",slot_buy);if(d!=""){C+='<div style="margin-top:5px;">'+d+"</div>"}var L="farmAction('vet_buyproductionslot', 1, 1, "+t+")";globalcommitbox(u,C,L)}if(c=="rent_production_slot"){var r=vet_data.animals.slots2[t].coins;var d="";var Q="";var K=specialbonus.findBonus({key1:"vet",key2:"rentslot"});if(K){r=Math.ceil(r*(1-K.rentslot));d=specialbonus.htmlBonusLine(K.rentslot);Q="specialbonus_bonus_value"}var u="";var C=str_replace("%TIME%",formatTime(vet_data.animals.slots2[t].rent_duration),slot_rent);C=str_replace("%COINS%",'<span class="'+Q+'">'+r+"&nbsp;"+t_coins+"</span>",C);if(d!=""){C+='<div style="margin-top:5px;">'+d+"</div>"}var L="farmAction('vet_rentproductionslot', 1, 1, "+t+")";globalcommitbox(u,C,L)}if(c=="buy_animal_slot"){var u="";var C=$("vet_animal_slot_block"+t+"_tt").innerHTML;var L="farmAction('vet_buyanimalslot', 1, 1, "+t+")";globalcommitbox(u,C,L)}if(c=="rent_animal_slot"){var u="";var C=$("vet_animal_slot_block"+t+"_tt").innerHTML;var L="farmAction('vet_rentanimalslot', 1, 1, "+t+")";globalcommitbox(u,C,L)}if(c=="disease_speedup"){globalSpeedupBox("vet_disease_speedup",1,t)}if(c=="production_slot_speedup"){globalSpeedupBox("vet_production_slot_speedup",1,t)}if(c=="stats"){var F="";F+='<div id="vet_stats_select_line">';F+=' <select id="vet_stats_select" onchange="vetStats()">';var D=["points","treatments","orders","drugs"];for(var aa=0;aa<D.length;aa++){var d="";if(vet_stats_select==D[aa]){d="selected"}F+='<option value="'+D[aa]+'" '+d+">"+t_vet_stats[D[aa]]+"</option>"}F+=" </select>";F+="</div>";F+='<div class="headline">'+t_vet_stats_headlines[vet_stats_select]+"</div>";F+='<div class="vet_stats_list">';F+=htmlStatsContent(vet_stats_cache[vet_stats_select]);F+="<div class=\"mini_close link\" onclick=\"hideDiv('vet_stats_box'); hideDiv('vet_transp');\"></div>";$("vet_stats_box").innerHTML=F;showDiv("vet_transp");showDiv("vet_stats_box")}if(c=="production_select"){var v=((vet_production_select_page-1)*4);var af=(vet_production_select_page*4);var u=t_vet_production_select_head;var C="";C+='<div class="vet_production_selection">';C+='  <div id="vet_production_filter_icon" class="link vet_animal_disease vet_animal_disease'+vet_production_select_filter_id+'" onclick="toogleDiv(\'vet_production_filter_box\')" onmouseover="showDiv(\'vet_production_filter_icon_tt\')" onmouseout="hideDiv(\'vet_production_filter_icon_tt\')">';C+='    <div class="ttbox" id="vet_production_filter_icon_tt">'+t_vet_disease_filter+"</div>";C+="  </div>";C+='  <div id="vet_production_filter_box">';C+='    <div class="link vet_animal_disease_big vet_animal_disease0_big" onclick="vetSetProductionSelectFilter('+t+', 0, 0)" onmouseover="showDiv(\'vet_production_filter0\')" onmouseout="hideDiv(\'vet_production_filter0\')">';C+='      <div id="vet_production_filter0" class="ttbox vet_animal_disease_tt_right">'+t_vet_disease_filter_all+"</div>";C+="    </div>";var I=1;for(var Z in vet_data.diseases){C+='<div class="link" style="float:left;" onclick="vetSetProductionSelectFilter('+t+", "+Z+", "+I+')">';C+=showDiseaseIcon(Z,"filter",0,"big");C+="</div>";I++}C+="  </div>";var X=0;if(specialbonus){X=specialbonus.findBonus({key1:"vet",key2:"harvest"})}var V=0;for(var q in vet_data.drugs){var s=0;if(vet_production_select_filter_id>0){for(var aa=0;aa<vet_data.drugs[q].diseases.length;aa++){if(vet_production_select_filter_id==vet_data.drugs[q].diseases[aa]){s=1}}}else{if((V+1)>v&&(V+1)<=af){s=1}}if(s==1){var e="vetDialog('production_select_confirm',"+t+","+q+","+S+")";for(var aa in vet_data.drugs[q].needs){if(checkRackItem(aa)<vet_data.drugs[q].needs[aa]){e=""}}var U=0;if(vet_data.drugs[q].level>vet_data.info.level){e="";U=1}C+='<div class="vet_production_select_item link" onclick='+e+">";C+='  <div class="tt'+q+'" style="float:left; margin:5px; border-radius:5px;"></div>';C+='  <div style="float:left; text-align:left; margin-top:5px; width:140px;">';C+='    <div title="'+produkt_name[q]+'" style="font-weight:bold; margin-bottom:2px; overflow:hidden; white-space:nowrap;">';var d="";var Q="";var l=vet_data.drugs[q].amount;if(X&&X.harvest){l+=X.harvest;d='<div style="color:green; font-weight:normal;">('+t_specialbonus_incl_harvestbonus.replace("%BONUS%","+"+X.harvest)+")</div>";Q="specialbonus"}C+='      <div class="'+Q+'">'+l+"x&nbsp;"+produkt_name[q]+"</div>";if(d!=""){C+=d}C+="    </div>";C+='    <div style="margin-bottom:2px;">'+formatNumber(produkt_points[q])+"&nbsp;"+t_points+"</div>";C+='    <div style="margin-bottom:2px;">'+vet_data.drugs[q].vet_points+"&nbsp;"+t_vet_points+"</div>";if(U==1){C+='<div class="important">'+str_replace("%LEVEL%",vet_data.drugs[q].level,t_vet_level_required)+"</div>"}else{C+='<div style="margin:5px 0px 0px 0px; text-align:left; font-style:italic">'+production_require+"</div>";var d="";if(vet_data.quest&&vet_data.quest.bonus_all&&vet_data.quest.bonus_all.prod_time_reduce){d="&nbsp;(-"+vet_data.quest.bonus_all.prod_time_reduce+"%)"}C+='<div style="margin-bottom:2px;">'+formatTime(vet_data.drugs[q].duration)+d+"</div>";if(vet_data.drugs[q].money){C+="<div>"+formatPrice(vet_data.drugs[q].money)+"</div>"}if(vet_data.drugs[q].coins){C+="<div>"+vet_data.drugs[q].coins+"&nbsp;"+t_coins+"</div>"}C+='<div style="margin-top:2px;">';for(var aa in vet_data.drugs[q].needs){var Q="";if(checkRackItem(aa)<vet_data.drugs[q].needs[aa]){Q="important"}C+='<div style="margin-bottom:2px; width:140px;">';C+='  <div style="float:left; margin-right:5px;" class="kp'+aa+'"></div>';C+='  <div style="float:left; width:120px;" class="'+Q+'">'+vet_data.drugs[q].needs[aa]+"x&nbsp;"+produkt_name[aa]+"</div>";C+='  <div class="clear"></div>';C+="</div>"}C+="</div>"}C+="  </div>";C+='  <div class="clear"></div>';C+='  <div class="vet_production_select_item_diseases">';C+='    <div style="margin:0px 5px 2px 0px; text-align:left; width:55px; font-size:10px; font-style:italic; float:left;">'+t_vet_diseases_list+"</div>";for(var aa=0;aa<vet_data.drugs[q].diseases.length;aa++){var Z=vet_data.drugs[q].diseases[aa];C+=showDiseaseIcon(Z,"selection",q)}C+='    <div class="clear"></div>';C+="  </div>";C+="</div>"}V++}var B=Math.ceil(V/4);if(vet_production_select_page>1){C+="<div onclick=\"vet_production_select_page--; vetDialog('production_select', "+t+');" class="link vet_production_select_navi_up"></div>'}if(!vet_production_select_filter_id&&vet_production_select_page<B){C+="<div onclick=\"vet_production_select_page++; vetDialog('production_select', "+t+","+S+');" class="link vet_production_select_navi_down"></div>'}C+='  <div class="clear"></div>';C+="</div>"}if(c=="production_select_confirm"){var u=t_start_production;var C="";C+='<div class="tt'+S+'" style="margin:0 auto; border-radius:5px;"></div>';C+='<div style="margin-top:5px;">'+produkt_name[S]+"</div>";if(vet_data.drugs[S].money){C+='<div style="margin-top:5px;">'+cityadcost+formatPrice(vet_data.drugs[S].money)+"</div>"}if(vet_data.drugs[S].coins){C+='<div style="margin-top:5px;">'+cityadcost+vet_data.drugs[S].coins+"&nbsp;"+t_coins+"</div>"}var L="vetStartProduction("+t+","+S+","+P+")";var R="vetDialog('production_select',"+t+","+P+")";globalcommitbox(u,C,L,R)}if(c=="quests"){var ab=t_vet_quest_head;if(vet_data.quest.campaign==2){ab=t_vet_quest_head2}var u=str_replace("%QUEST%",vet_data.quest.quest_id,ab);if(vet_data.quest.need_bandage){var C=""}else{var C='<div style="margin-top:-10px; margin-bottom:10px;">'+t_vet_quest_body+"</div>"}C+='<div id="vet_questentry_info">';if(vet_data.quest.need_bandage){var A=0;if(vet_data.quest.data&&vet_data.quest.data.amount){A=vet_data.quest.data.amount}var Q="";var e="";if(A<vet_data.quest.need_bandage){e="vetDialog('quest_entry', 0)"}if(vet_data.info.count<=0){Q="important";e=""}var a=parseInt((A*100)/vet_data.quest.need_bandage)*2;C+='<div style="position:relative; margin-bottom:4px;" onmouseover="showDiv(\'vet_quest_bar_tt_bandage\')" onmouseout="hideDiv(\'vet_quest_bar_tt_bandage\')">';C+='  <div id="vet_quest_bar_tt_bandage" class="ttbox" style="top:17px; left:20px;">'+t_vet_points+"</div>";C+='  <div style="float:left; margin-right:4px;" class="vet_leveladd_item"></div>';C+='  <div style="float:left; margin-right:4px;" class="questboxbarout link" onclick="'+e+'">';C+='    <div class="questboxbarin" style="left:-'+(200-a)+'px"></div>';C+="  </div>";C+='  <div style="float:left;" class="'+Q+'">'+A+"/"+vet_data.quest.need_bandage+"</div>";C+='  <div class="clear"></div>';C+="</div>"}if(vet_data.quest.need){for(var N in vet_data.quest.need){A=0;if(vet_data.quest.data&&vet_data.quest.data[N]){A=vet_data.quest.data[N]}var Q="important";var e="";if(checkRackItem(N)>0){Q="";if(A<vet_data.quest.need[N]){e="vetDialog('quest_entry', "+N+")"}}var a=parseInt((A*100)/vet_data.quest.need[N])*2;C+='<div style="position:relative; margin-bottom:4px;" onmouseover="showDiv(\'vet_quest_bar_tt'+N+"')\" onmouseout=\"hideDiv('vet_quest_bar_tt"+N+"')\">";C+='  <div id="vet_quest_bar_tt'+N+'" class="ttbox" style="top:17px; left:20px;">'+produkt_name[N]+"</div>";C+='  <div style="float:left; margin-right:4px;" class="kp'+N+'"></div>';C+='  <div style="float:left; margin-right:4px;" class="questboxbarout link" onclick="'+e+'">';C+='    <div class="questboxbarin" style="left:-'+(200-a)+'px"></div>';C+="  </div>";C+='  <div style="float:left;" class="'+Q+'">'+A+"/"+vet_data.quest.need[N]+"</div>";C+='  <div class="clear"></div>';C+="</div>"}}C+='  <div style="margin-top:10px;">'+t_megafield_reward_basic+"</div>";C+='  <div style="position:relative; margin-top:5px; width:97%; background:#C3A75E; border-radius:5px; padding:4px;">';for(var ag in vet_data.quest.reward){if(vet_data.quest.reward[ag]>0){if(ag=="vet_points"){C+='<img src="'+imgpath+'vet_patch50x50.png" style="width:40px; float:left;"><div style="float:left; margin:13px 0 4px 4px;">'+vet_data.quest.reward[ag]+"&nbsp;"+t_vet_points+'</div><div class="clear"></div>'}if(ag=="player_points"){C+='<div class="megafield_points_icon" style="float:left;"></div><div style="float:left; margin:13px 0 4px 4px;">'+formatNumber(vet_data.quest.reward[ag])+"&nbsp;"+t_points+'</div><div class="clear"></div>'}if(ag=="money"){C+='<div class="megafield_money_icon" style="float:left;"></div><div style="float:left; margin:13px 0 4px 4px;">'+formatPrice(vet_data.quest.reward[ag])+'</div><div class="clear"></div>'}}}for(var J in vet_data.quest.bonus){C+="<div>"+str_replace("%PERCENT%",vet_data.quest.bonus[J],t_vet_quest_bonus[J])+"</div>"}C+="  </div>";C+="</div>";C+='<div id="vet_questentry_warning"></div>'}if(c=="quest_entry"){var N=t;if(vet_data.quest.need_bandage){var z=vet_data.quest.need_bandage;if(vet_data.quest.data&&vet_data.quest.data.amount){z=(z-vet_data.quest.data.amount)}var n="vet_leveladd_item";var B=vet_data.info.count;var N=0}if(vet_data.quest.need){for(var M in vet_data.quest.need){if(M==N){var z=vet_data.quest.need[N];if(vet_data.quest.data&&vet_data.quest.data[N]){var z=(z-vet_data.quest.data[N])}break}}var B=checkRackItem(N);var n="kp"+N}if(B>z){B=z}var b={pid:N};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(b),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("checkQuestEntry("+N+", "+z+")");$("dialog_entryline_number").onkeyup=new Function("checkQuestEntry("+N+", "+z+")");checkQuestEntry(N,z)}if(c=="add_level"){var u=t_vet_dialog_leveladd_head;var C=htmlLevelAddDialog("vet");globalcommitbox(u,C,0,0,1)}if(c=="buy_addlevel"||c=="buy_addlevel_confirm"){var r=vet_data.info.exchangecoins;var l=vet_data.info.exchangeamount;var d="";var Q="";var K=specialbonus.findBonus({key1:"vet",key2:"buypoints"});if(K){d=specialbonus.htmlBonusLine(K.buypoints);Q="specialbonus_bonus_value";l=Math.ceil(l*(1+K.buypoints))}var u=t_vet_levelitem_buy;var m=str_replace("%COINS%",r,t_vet_levelitem_buy_dialog);m=str_replace("%AMOUNT%",'<span class="'+Q+'">'+l+"</span>",m);if(c=="buy_addlevel"){var C='<div id="megafruit_buy_button" style="font-weight:bold; padding-top:16px; height:33px;" class="link" onclick="vetDialog(\'buy_addlevel_confirm\')">'+m+"</div>";if(d!=""){C+='<div style="margin-top:5px;">'+d+"</div>"}globalcommitbox(u,C,0,0,1)}else{var C=m;if(d!=""){C+='<div style="margin-top:5px;">'+d+"</div>"}var L="farmAction('vet_buyleveladd', 1, 1);";globalcommitbox(u,C,L)}}if(c=="production_select"||c=="quests"){globalBoxFlex(u,C,0,0,1);$("globalbox").style.top="50px";if(c=="quests"){checkVetQuestTimer()}}if(c=="selectrole"){var u=t_vet_role_select_head;var C='<div style="width:360px;">';C+='<div style="position:relative; margin-bottom:10px;">'+str_replace("%TIME%",formatTime(vet_data.constants.role_duration),t_vet_role_select_body)+"</div>";C+='<div style="position:relative; margin-bottom:10px;">';for(var aa in vet_data.role){var d="";var L="vetSetRole("+aa+")";if(vet_data.role[aa].level>vet_data.info.level){L="";d='<div class="important" style="margin-top:10px;">'+str_replace("%LEVEL%",vet_data.role[aa].level,t_vet_level_required)+"</div>"}C+='<div class="vet_role_select_item link" onclick="'+L+'">';C+='  <div class="vet_role_icon'+aa+'"></div>';C+="  <div>"+t_vet_role_name[aa]+d+"</div>";if(d==""){C+='  <div style="margin:10px 0px 5px 0px;">'+t_vet_role_count+"</div>";C+='  <div style="font-size:24px; font-weight:bold; color:#6C441D;">'+vet_data.info.role_counts[aa]+"</div>"}C+="</div>"}C+='  <div class="clear"></div>';C+="</div>";C+='<div style="position:relative;">'+str_replace("%TIME%",formatTime(vet_data.constants.role_duration),t_vet_role_info)+"</div>";C+="</div>";var R="goVetDrugScreen(); hideDiv('globalbox'); hideDiv('globaltransp')";globalBoxFlex(u,C,0,R,1)}if(c=="role_reward"||c=="show_reward"){if(c=="role_reward"){var ad=S;var W=P;var u=t_vet_reward_head2}if(c=="show_reward"){var ad=vet_data.info.reward_pool;var W=0;var u=t_vet_reward_head}var C='<div style="margin-bottom:10px; width:350px;">'+t_vet_reward_body+"</div>";C+='<div style="position:relative; margin-top:5px; width:97%; background:#C3A75E; border-radius:5px; padding:4px;">';var O=0;var G=0;var T=0;var w=0;for(var aa in ad){if(aa=="player_points"){O+=ad.player_points}if(aa=="vet_points"){G+=ad.vet_points}if(aa=="money"){T+=ad.money}if(aa=="package"){w=ad["package"]}}var ac=0;var H=0;var ae=0;if(!W){if(vet_data.quest&&vet_data.quest.bonus_all){if(vet_data.quest.bonus_all.pat_bandage){G=Math.ceil(G*((100+vet_data.quest.bonus_all.pat_bandage)/100))}if(vet_data.quest.bonus_all.pat_money){T=Math.ceil(T*((100+vet_data.quest.bonus_all.pat_money)/100))}if(vet_data.quest.bonus_all.pat_points){O=Math.ceil(O*((100+vet_data.quest.bonus_all.pat_points)/100))}}}if(c=="role_reward"){C+="<div>";C+='  <div style="float:left; width:155px; font-weight:bold; padding-left:45px; text-align:left;">'+t_megafield_reward_sum+"</div>";C+='  <div style="float:left; width:135px; font-weight:bold;">'+t_megafield_reward_bonus+"</div>";C+='  <div class="clear"></div>';C+="</div>"}C+='<div style="float:left; width:200px;">';C+='  <div class="megafield_points_icon" style="float:left;"></div>';C+='  <div style="float:left; margin:12px 25px 0 5px;">'+formatNumber(O)+"&nbsp;"+t_points+"</div>";C+='  <div class="clear"></div>';C+="</div>";C+='<div style="float:left; width:135px; margin:12px 0px;">';if(W.time_points){C+="+"+W.time_points}if(W.difficulty_points){C+="&nbsp;&nbsp;&nbsp;+"+W.difficulty_points}C+="</div>";C+='<div class="clear"></div>';C+='<div style="float:left; width:200px;">';C+='  <img src="'+imgpath+'vet_patch50x50.png" style="width:40px; float:left;">';C+='  <div style="float:left; margin:12px 25px 0 5px;">'+formatNumber(G)+"&nbsp;"+t_vet_points+"</div>";C+='  <div class="clear"></div>';C+="</div>";C+='<div style="float:left; width:135px; margin:12px 0px;">';if(W.time_bandage){C+="+"+W.time_bandage}if(W.difficulty_bandage){C+="&nbsp;&nbsp;&nbsp;+"+W.difficulty_bandage}C+="</div>";C+='<div class="clear"></div>';C+='<div style="float:left; width:200px;">';C+='  <div class="megafield_money_icon" style="float:left;"></div>';C+='  <div style="float:left; margin:12px 25px 0 5px;">'+formatPrice(T)+"</div>";C+='  <div class="clear"></div>';C+="</div>";C+='<div style="float:left; width:135px; margin:12px 0px;">';if(W.time_money){C+="+"+W.time_money}if(W.difficulty_money){C+="&nbsp;&nbsp;&nbsp;+"+W.difficulty_money}C+="</div>";C+='<div class="clear"></div>';C+="</div>";if(c=="show_reward"){C+='<div style="margin-top:10px; width:350px;">'+t_vet_medicalrecord_reward_info+"</div>"}var s=1;if(c=="role_reward"&&!w){s=0}if(s==1){pack_id=0;if(w>0){pack_id=w}else{for(var Y in pets.data.config.reward_packs.vet){if(pets.data.config.reward_packs.vet[Y].amount==vet_data.info.role){pack_id=pets.data.config.reward_packs.vet[Y]["package"]}}}if(pack_id>0){C+='<div style="position:relative; margin-top:10px; width:97%; background:#C3A75E; border-radius:5px; padding:4px;">';C+='  <div class="pets_package'+pack_id+'" style="width:50px; height:50px; background-size:100%; float:left;"></div>';var d="";if(c=="show_reward"){d="&nbsp;"+str_replace("%TYPE%",t_vet_role_name[vet_data.info.role],t_pets_reward_vet)}C+='  <div style="float:left; width:270px; margin-top:10px; text-align:left; margin-left:5px;">1x'+d+"</div>";C+='  <div class="clear"></div>';C+="</div>"}}if(c=="role_reward"){vet_data.info.role=1;vet_role_reward_block=1;if(vet_position=="right"){var L="vet_data.info.role=0; vet_role_reward_block=0; hideDiv('globaltransp'); hideDiv('globalbox');";var R=L}else{var L="vet_data.info.role=0; vet_role_reward_block=0;";var R=L}globalcommitbox(u,C,L,R)}else{globalcommitbox(u,C,0,0,1)}}}function goVetDrugScreen(){if(vet_position=="left"){moveVet()}}function vetCheckLevelAdd(){var a=$("vet_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>vet_data.info.count){a=vet_data.info.count}$("vet_dialog_leveladd_insert").value=a}function checkQuestEntry(a,c){if(vet_data.quest.need_bandage){var e=vet_data.info.count;var b="bandage"}if(vet_data.quest.need){var e=checkRackItem(a);var b="product"}var d={type:b,stockamount:e,rest:c,click:"vetQuestEntry("+a+")"};checkEntryLine(d)}function showDiseaseIcon(c,l,m,q){if(!q){var n=""}else{var n="_"+q}if(!m){m=0}var h="vet_animal_disease_tt";var b="left";var e="";if(l=="filter"){b="right"}if(l=="selection"){e="font-weight:bold;";h="vet_animal_disease_tt_bottom"}var a="";if(vet_data.diseases[c].level>vet_data.info.level){a="opacity:0.5;"}var d="";d+='<div style="margin-right:5px;" class="vet_animal_disease'+n+'" onmouseover="showDiv(\'vet_animal_disease_icon_'+l+"_tt"+m+"_"+c+"')\" onmouseout=\"hideDiv('vet_animal_disease_icon_"+l+"_tt"+m+"_"+c+"')\">";d+='  <div class="vet_animal_disease'+c+n+'" style="width:100%; height:100%; '+a+'"></div>';d+='  <div id="vet_animal_disease_icon_'+l+"_tt"+m+"_"+c+'" class="ttbox '+h+"_"+b+'">';d+='    <div style="'+e+' margin-bottom:2px;">'+vet_data.diseases[c].name+"</div>";if(l=="filter"&&vet_data.diseases_log[c]){d+='<div class="bonusinfo" style="min-width:100px;">'+str_replace("%AMOUNT%",vet_data.diseases_log[c],t_vet_disease_healed_sum)+"</div>"}if(l=="selection"){d+="<div>"+t_heal_time+"&nbsp;"+formatTime(vet_data.drugs[m].times[c])+"</div>"}d+="  </div>";d+="</div>";return d}function vetCheckRole(){vet_wait_checkrole=1;farmAction("vet_checkrole",1,1)}function vetSetRole(a){farmAction("vet_setrole",1,1,a)}function vetStartTreatment(a){farmAction("vet_starttreatment",1,1,a)}function vetEndTreatment(a){farmAction("vet_endtreatment",1,1,a)}function vetSpeedupTreatment(a){farmAction("vet_speeduptreatment",1,1,a)}function vetStartProduction(c,a,b){farmAction("vet_startproduction",1,1,c,a,b)}function vetHarvestProduction(b,a){farmAction("vet_harvestproduction",1,1,b,a)}function vetQuestEntry(a){var b=parseInt($("dialog_entryline_number").value);if(b>0){farmAction("vet_questentry",1,1,a,b)}}function vetStats(){if($("vet_stats_select")){vet_stats_select=$("vet_stats_select").value}if(vet_stats_cache_delay[vet_stats_select]<=0||!vet_stats_cache[vet_stats_select]){farmAction("vet_stats",1,1,vet_stats_select)}else{vetDialog("stats",vet_stats_select)}}function vetQuests(){vetDialog("quests")}function vetReward(){vetDialog("show_reward")}function moveVet(){if(vet_position=="left"){if(vet_data.info.queue_remain<0&&!vet_data.info.vet_pharmacist_remember_box){vetDialog("buy_pharmacist",1);vet_data.info.vet_pharmacist_remember_box=1}vet_position="right";$("vet_back").removeClassName("vet_back_left").addClassName("vet_back_right");$("vet_sroller").removeClassName("megafield_carpool_right").addClassName("megafield_carpool_left")}else{vet_position="left";$("vet_back").removeClassName("vet_back_right").addClassName("vet_back_left");$("vet_sroller").removeClassName("megafield_carpool_left").addClassName("megafield_carpool_right")}}function closeVet(){hideDiv("transp");hideDiv("farmersmarket_pos5_inner")}function handleVetHelp(b){for(var a=1;a<=4;a++){hideDiv("vet_help_page"+a);$("vet_help_category"+a).removeClassName("vet_help_categories_item_active");$("vet_help_category"+a).addClassName("vet_help_categories_item")}showDiv("vet_help_page"+b);$("vet_help_category"+b).removeClassName("vet_help_categories_item");$("vet_help_category"+b).addClassName("vet_help_categories_item_active")}function vetSetAnimalFlyer(h,e){var a="";var d=0;var c=0;var b=0;if(vet_data.quest&&vet_data.quest.bonus_all){if(e.vet_points&&vet_data.quest.bonus_all.pat_bandage){d=Math.ceil(e.vet_points*((100+vet_data.quest.bonus_all.pat_bandage)/100))}if(e.money&&vet_data.quest.bonus_all.pat_money){c=Math.ceil(e.money*((100+vet_data.quest.bonus_all.pat_money)/100))}if(e.player_points&&vet_data.quest.bonus_all.pat_points){b=Math.ceil(e.player_points*((100+vet_data.quest.bonus_all.pat_points)/100))}}if(b){a+='<div style="margin-bottom:2px;">'+formatNumber(b)+"&nbsp;"+t_points+"</div>"}if(d){a+='<div style="margin-bottom:2px;">'+formatNumber(d)+"&nbsp;"+t_vet_points+"</div>"}if(c){a+="<div>"+formatPrice(c)+"</div>"}$("vet_animal_flyer"+h).innerHTML=a;$("vet_animal_flyer"+h).addClassName("up");setTimeout(closeSetAnimalFlyer,3000)}function closeSetAnimalFlyer(){for(var a=1;a<=3;a++){$("vet_animal_flyer"+a).innerHTML="";$("vet_animal_flyer"+a).removeClassName("up")}}var vineyard=function(){this.data={};this.currentView="plants";this.currentPlantSlot=1;this.currentStockPage=1;this.currentStockSort="none";this.marketData={};this.marketCreateOfferId=0;this.marketFilter=0;this.marketSort="";this.marketSortDir="asc";this.stats_options=["points","quests","sold","sold2","unfill","vineyard_type1","vineyard_type2","vineyard_type3","vineyard_type4","vineyard_type5"];this.stats_cache={};this.stats_cache_delay={};this.stats_select="points";this.tutorialStep=0;this.barrelSelectionReminder=0;this.cheatEnabled=1;if(!devserver){this.cheatEnabled=0}};vineyard.prototype.setTutorial=function(a){vineyard.action("vineyard_set_tutorial",{type:a})};vineyard.prototype.cheat=function(a,c,b){vineyard.action("vineyard_cheat",{type:a,slot:c,id:b})};vineyard.prototype.buyWeatherTool=function(b,a){vineyard.action("vineyard_buy_weathertool",{slot:b,type:a})};vineyard.prototype.plantWintercut=function(b,a){vineyard.action("vineyard_plant_wintercut",{slot:b,id:a})};vineyard.prototype.harvest=function(b,a){vineyard.action("vineyard_plant_harvest",{slot:b,slot2:a})};vineyard.prototype.selectCare=function(c,b,a){vineyard.action("vineyard_plant_select_care",{slot:c,id:b,option:a})};vineyard.prototype.unfillBarrels=function(a){vineyard.action("vineyard_unfill_barrels_slot",{slot:a})};vineyard.prototype.stats=function(){if($("vineyard_stats_select")){if($("vineyard_stats_select").value==0){return 1}vineyard.stats_select=$("vineyard_stats_select").value}if(vineyard.stats_cache_delay[vineyard.stats_select]<=0||!vineyard.stats_cache[this.stats_select]){vineyard.action("vineyard_stats",{type:vineyard.stats_select})}else{vineyard.showStats(vineyard.stats_select)}};vineyard.prototype.questEntryStock=function(a){vineyard.action("vineyard_quest_entry_stock",{id:a,amount:parseInt($("dialog_entryline_number").value)})};vineyard.prototype.questEntry=function(a){vineyard.action("vineyard_quest_entry",{pid:a,amount:parseInt($("dialog_entryline_number").value)})};vineyard.prototype.createMarketOffer=function(c){var a=$("vineyard_market_create_offer_amount").value;var b=0;b=parseInt($("vineyard_market_create_offer_price1").value)*100;b+=parseInt($("vineyard_market_create_offer_price2").value);vineyard.action("vineyard_market_create_offer",{id:c,amount:a,price:b})};vineyard.prototype.buyMarketOffer=function(a){vineyard.action("vineyard_market_buy_offer",{id:a,amount:$("vineyard_market_buy_offer_amount").value})};vineyard.prototype.deleteMarketOffer=function(a){vineyard.action("vineyard_market_delete_offer",{id:a})};vineyard.prototype.initMarket=function(){vineyard.action("vineyard_market_init")};vineyard.prototype.expertSell=function(a){vineyard.action("vineyard_expert_sell",{id:a,amount:$("vineyard_expert_sell_amount").value})};vineyard.prototype.upgradeStock=function(){vineyard.action("vineyard_upgrade_stock")};vineyard.prototype.startSeason=function(a){vineyard.action("vineyard_start_season",{slot:a})};vineyard.prototype.removePlant=function(a){vineyard.action("vineyard_remove_plant",{slot:a})};vineyard.prototype.buyShopItem=function(a,c,b){vineyard.action("vineyard_buy_shop_item",{type:a,slot:c,id:b})};vineyard.prototype.clearBarrelsSlot=function(a){vineyard.action("vineyard_clear_barrels_slot",{slot:a})};vineyard.prototype.buyBarrelsSlot=function(a){vineyard.action("vineyard_buy_barrels_slot",{slot:a})};vineyard.prototype.buyPlantsSlot=function(a){vineyard.action("vineyard_buy_plants_slot",{slot:a})};vineyard.prototype.buyAddLevel=function(){vineyard.action("vineyard_buy_add_level")};vineyard.prototype.addLevel=function(){vineyard.action("vineyard_add_level",{amount:$("vineyard_dialog_leveladd_insert").value})};vineyard.prototype.init=function(){vineyard.action("vineyard_init")};vineyard.prototype.action=function(a,b){ajaxAction("farm",a,b,vineyard.response)};vineyard.prototype.response=function(c,b,d){if(b=="vineyard_set_tutorial"){return 1}if(b=="vineyard_buy_plants_slot"){vineyard.currentPlantSlot=d.slot}if(in_array(b,["vineyard_quest_entry","vineyard_quest_entry_stock"])){vineyard.showQuest()}vineyard.build();if(in_array(b,["vineyard_market_init","vineyard_market_delete_offer","vineyard_market_buy_offer","vineyard_market_create_offer"])){if(c.error){var a='<div id="vineyard_commit">'+t_vineyard_market_buy_offer_failed+"</div>";globalerrorbox(a)}vineyard.marketData=c;vineyard.buildMarket();if(b=="vineyard_market_init"&&vineyard.marketCreateOfferId>0){vineyard.createMarketOfferCommit(vineyard.marketCreateOfferId);vineyard.marketCreateOfferId=0}}if(c.reward){vineyard.showReward(c.reward,c.broken)}if(vineyard.currentView=="plants"&&b=="vineyard_buy_shop_item"){vineyard.showTutorial("firstplant")}if(c.stats){vineyard.stats_cache_delay[vineyard.stats_select]=30;if(!vineyard.stats_cache[vineyard.stats_select]){vineyard.stats_cache[vineyard.stats_select]={}}vineyard.stats_cache[vineyard.stats_select]=c.stats;vineyard.showStats()}if(b=="vineyard_buy_shop_item"&&vineyard.barrelSelectionReminder==1){vineyard.buildBarrelsSelection()}else{vineyard.barrelSelectionReminder=0}};vineyard.prototype.build=function(){var a='<div id="vineyard">';a+='  <div id="vineyard_view" class="view '+this.currentView+'"></div>';a+=htmlLevelBar("vineyard");a+=htmlCountBar("vineyard");a+='  <div class="stats_link link" onclick="vineyard.stats()" onmouseover="showDiv(\'vineyard_stats_link_tt\')" onmouseout="hideDiv(\'vineyard_stats_link_tt\')">';a+='    <div id="vineyard_stats_link_tt" class="ttbox">'+t_foodcontest_stats_button+"</div>";a+="  </div>";a+='  <div class="quest_link link" onclick="vineyard.showQuest()" onmouseover="showDiv(\'vineyard_quest_link_tt\')" onmouseout="hideDiv(\'vineyard_quest_link_tt\')">';a+='    <div id="vineyard_quest_link_tt" class="ttbox">'+t_vineyard_quest_link+"</div>";a+="  </div>";a+='  <div id="vineyard_tutorial" class="tutorial">';a+='    <div class="transp"></div>';a+='    <div id="vineyard_tutorial_npc" class="npc">';a+='      <div id="vineyard_tutorial_bubble" class="bubble"></div>';a+="    </div>";a+="  </div>";a+='  <div class="help helpbutton_blue link" onclick="vineyard.help()"></div>';a+='  <div class="mini_close link" onclick="vineyard.close()"></div>';a+="</div>";$("farmersmarket_pos10_inner").innerHTML=a;showDiv("transp");showDiv("farmersmarket_pos10_inner");this.buildView();this.setLevelInfos();this.timerUpdate()};vineyard.prototype.setLevelInfos=function(){$("vineyard_levelbar_number").innerHTML=this.data.data.level;$("vineyard_levelbar_inner").style.width=this.data.data.level_percent+"%";if(!this.data.data.level_rest){var a=t_reached_maxlevel;hideDiv("vineyard_levelbar_plus")}else{var a=str_replace("%AMOUNT%",this.data.data.level_rest,t_vineyard_level_line);$("vineyard_levelbar_plus").onclick=new Function("vineyard.addLevelCommit()");$("vineyard_levelbar_plus_tt").innerHTML=t_vineyard_leveladd_tt}$("vineyard_levelbar_tt").innerHTML=a;$("vineyard_countbar_inner").innerHTML='<div class="vineyard_points"></div><div>'+formatNumber(this.data.data.count)+"</div><br>";$("vineyard_countbar_plus_tt").innerHTML=t_vineyard_levelitem_buy;$("vineyard_countbar_plus").onclick=new Function("vineyard.buyAddLevelCommit()")};vineyard.prototype.addLevelCommit=function(){var b=t_vineyard_dialog_leveladd_head;var a=htmlLevelAddDialog("vineyard");globalcommitbox(b,a,0,0,1);$("vineyard_dialog_leveladd_insert").focus()};vineyard.prototype.addLevelCheck=function(){var a=$("vineyard_dialog_leveladd_insert").value;a=parseInt(a);if(isNaN(a)){a=0}if(a>vineyard.data.data.count){a=vineyard.data.data.count}$("vineyard_dialog_leveladd_insert").value=a};vineyard.prototype.buyAddLevelCommit=function(a){var h=t_vineyard_levelitem_buy;var c=vineyard.data.data.exchangeamount;var n="";var l="";var e=specialbonus.findBonus({key1:"vineyard",key2:"buypoints"});if(e){n=specialbonus.htmlBonusLine(e.buypoints);l="specialbonus_bonus_value";c=Math.ceil(c*(1+e.buypoints))}var b=t_vineyard_levelitem_buy_dialog.replace("%COINS%",vineyard.data.data.exchangecoins).replace("%AMOUNT%",'<span class="'+l+'">'+c+"</span>");if(!a){var d='<div class="link coinsbutton_flex" onclick="vineyard.buyAddLevelCommit(1)" style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}globalcommitbox(h,d,0,0,1)}else{var d='<div style="width:350px;">'+b+"</div>";if(n!=""){d+='<div style="margin-top:5px;">'+n+"</div>"}var m="vineyard.buyAddLevel()";globalcommitbox(h,d,m)}};vineyard.prototype.buildView=function(){var a="";a+='<div id="vineyard_plants" class="plants"></div>';a+='<div id="vineyard_barrels" class="barrels"></div>';a+='<div id="vineyard_stock" class="stock"></div>';$("vineyard_view").innerHTML=a;this.buildPlants();this.buildBarrels();this.buildStock();this.showTutorial(this.currentView)};vineyard.prototype.changeView=function(a){if(this.currentView==a){return 1}this.currentView=a;$("vineyard_view").className="view "+this.currentView;this.showTutorial(this.currentView)};vineyard.prototype.buildPlants=function(){var c="";c+='<div id="vineyard_plant_softer" class="softer"></div>';c+='<div id="vineyard_plant" class="plant"></div>';c+='<div id="vineyard_blocker" class="blocker">';c+='  <div class="transp"></div>';c+='  <div id="vineyard_blocker_info" class="info"></div>';c+='  <div id="vineyard_blocker_npc" class="npc"></div>';c+="</div>";c+='<div class="slots">';for(var m in this.data.config.slots_plants){var b=this.checkSlots("plants",m);var e="";if(this.data.data.plants[m]){var d=this.data.data.plants[m].type;e+='<div style="font-weight:bold; margin-bottom:5px;">'+this.data.config.plants[d].name+"</div>";e+="<div>"+t_vineyard_current_year.replace("%COUNT%",this.data.data.plants[m].year)+" | "+t_vineyard_season_name[this.data.data.plants[m].season]+" | "+t_vineyard_weather_name[this.data.data.plants[m].weather]+"</div>"}e+=b.tt;var h="";if(!b.locked){if(b.free==1){h="vineyard.buildPlantsSlot("+m+")"}else{if(b.buyable==1){h="vineyard.buyPlantsSlotCommit("+m+")"}}}var a="";if(m>7){a="right"}if(m>1){c+='<div class="connect"></div>'}var l="";if(e!=""){l="onmouseover=\"showDiv('vineyard_plants_slot"+m+"_tt')\" onmouseout=\"hideDiv('vineyard_plants_slot"+m+"_tt')\""}c+='<div id="vineyard_plants_slot'+m+'" class="slot link '+a+'" onclick="'+h+'" '+l+">";c+='  <div id="vineyard_plants_slot'+m+'_tt" class="ttbox">'+e+"</div>";if(this.data.data.plants[m]){c+='<div class="img vineyard_plant'+d+'"></div>'}else{if(b.locked==1){c+='<div class="locked"></div>'}else{if(b.unlocked==1){c+='<div class="unlocked"></div>'}}}c+="</div>"}c+='  <div class="clear"></div>';c+="</div>";c+='<div class="goto link" onclick="vineyard.changeView(\'barrels\')" onmouseover="showDiv(\'vineyard_plants_goto_tt\')" onmouseout="hideDiv(\'vineyard_plants_goto_tt\')">';c+='  <div id="vineyard_plants_goto_tt" class="ttbox">'+t_vineyard_goto_barrels+"</div>";c+="</div>";$("vineyard_plants").innerHTML=c;this.buildPlantsSlot(this.currentPlantSlot)};vineyard.prototype.buyPlantsSlotCommit=function(m){var h="";if(this.data.config.slots_plants[m].money){var l=formatPrice(this.data.config.slots_plants[m].money)}if(this.data.config.slots_plants[m].coins){var b=this.data.config.slots_plants[m].coins;var c="";var d=specialbonus.findBonus({key1:"vineyard",key2:"plantslot"});if(d){h=specialbonus.htmlBonusLine(d.plantslot,1);c=" specialbonus_bonus_value";b=Math.ceil(b*(1-d.plantslot))}var l='<span class="'+c+'">'+b+"&nbsp;"+t_coins+"</span>"}var a='<div id="vineyard_commit">'+t_vineyard_buy_plants_slot_body.replace("%COST%","<b>"+l+"</b>")+"</div>";if(h!=""){a+='<div style="margin-top:5px;">'+h+"</div>"}var e="vineyard.buyPlantsSlot("+m+")";globalcommitbox(t_vineyard_buy_plants_slot_head,a,e)};vineyard.prototype.buildPlantsSlot=function(c){$("vineyard_plants_slot"+this.currentPlantSlot).removeClassName("active");this.currentPlantSlot=c;$("vineyard_plants_slot"+this.currentPlantSlot).addClassName("active");hideDiv("vineyard_blocker");$("vineyard_plant_softer").className="softer";var l="";if(this.data.data.plants[c]){var E=this.data.data.plants[c];var A="";$("vineyard_plant_softer").className="softer season"+this.data.data.plants[c].season;if(this.data.data.plants[c].remain<=0){var D=parseInt(this.data.data.plants[c].season);var r=1;if(this.data.config.season[(D+1)]){r=(D+1)}var A="<div>";A+='  <div class="seasons">';A+='    <div class="season vineyard_season'+D+'"></div>';A+='    <div class="arrow"></div>';A+='    <div class="season vineyard_season'+r+'"></div>';A+="  </div>";A+='  <div class="head">'+t_vineyard_plant_seasonchange_head.replace("%NAME%",this.data.config.season[r].name)+"</div>";A+='  <div class="desc">'+t_vineyard_plant_seasonchange_desc+"</div>";A+='  <button class="button_new link" onclick="vineyard.startSeasonCommit('+c+')">'+t_vineyard_season_start_button+"</button>";A+="</div>"}if(E.season==4){if(E.harvested==0||E.wintercut==""){var A='<div class="winter">';A+='  <div class="season vineyard_season4"></div>';A+='  <div class="head">'+t_vineyard_plant_winter_head+"</div>"}if(E.harvested==0){A+='  <div class="desc">'+t_vineyard_plant_winter_harvest+"</div>";A+="</div>";A+='<button class="button_new link" onclick="vineyard.harvestBarrelsSelection('+c+')">'+t_vineyard_plant_winter_harvest_button+"</button>"}else{if(E.wintercut==""){A+='  <div class="desc">'+t_vineyard_plant_winter_cut+"</div>";for(var w in this.data.config.wintercut){var t="vineyard.plantWintercutCommit("+c+", '"+w+"')";var C=0;var d="";if(this.data.config.wintercut[w].money){if(this.data.config.wintercut[w].money>user_bar){t="";d="failed"}var z=formatPrice(this.data.config.wintercut[w].money)}if(this.data.config.wintercut[w].coins){if(this.data.config.wintercut[w].coins>user_coins){t="";d="failed"}var z=formatNumber(this.data.config.wintercut[w].coins)+"&nbsp;"+t_coins}if(this.data.config.wintercut[w].vineyard_points){if(this.data.config.wintercut[w].vineyard_points>this.data.data.count){t="";d="failed"}var z=formatNumber(this.data.config.wintercut[w].vineyard_points)+"&nbsp;"+t_vineyard_points}if(this.data.config.wintercut[w].level&&this.data.config.wintercut[w].level>this.data.data.level){t="";C=1;d="failed"}A+='<div class="slot link" onclick="'+t+'">';A+='  <div class="img '+w+'"></div>';A+='  <div class="infoblock">';A+='    <div class="title">'+t_vineyard_care_name[2][w]+"</div>";if(C==1){A+='<div class="failed">'+t_vineyard_level_required.replace("%LEVEL%",this.data.config.wintercut[w].level)+"</div>"}else{if(this.data.config.wintercut[w].quality_bonus){A+="<div>"+Math.round(this.data.config.wintercut[w].quality_bonus*100)+"%&nbsp;"+t_vineyard_plant_bonus.quality_bonus+"</div>"}if(this.data.config.wintercut[w].quantity_bonus){A+="<div>"+Math.round(this.data.config.wintercut[w].quantity_bonus*100)+"%&nbsp;"+t_vineyard_plant_bonus.quantity_bonus+"</div>"}}A+="  </div>";A+='  <div class="cost '+d+'">';if(C==1){A+='<div class="locked"></div>'}else{A+="<div>"+z+"</div>"}A+="  </div>";A+="</div>"}A+="</div>"}}}if(A!=""){showDiv("vineyard_blocker");$("vineyard_blocker_info").innerHTML=A}l+=this.buildTree(E);if(E.season!=4){l+='<div class="care_slots">';for(var w in this.data.config.care){var b=this.data.config.care[w];var t="vineyard.careSelection("+c+", "+w+")";var d="";if(!in_array(E.season,b.season)){d="off";t=""}if(b.limit&&this.data.data.plants[c].care&&this.data.data.plants[c].care[w]){d="off"}l+='<div class="care link" onclick="'+t+'" onmouseover="showDiv(\'vineyard_plant_slot'+c+"_care"+w+"_tt')\" onmouseout=\"hideDiv('vineyard_plant_slot"+c+"_care"+w+"_tt')\">";l+='  <div class="img care'+w+" "+d+'"></div>';if(E.care&&E.care[w]){if(E.care[w].remain>0){l+='<div id="vineyard_plant_slot'+c+"_care"+w+'_timer" class="timer">'+formatTime(E.care[w].remain)+"</div>"}}l+='  <div id="vineyard_plant_slot'+c+"_care"+w+'_tt" class="ttbox">';l+='    <div class="head">'+t_vineyard_plant_care_name[w]+"</div>";if(b.season.length<3){var q="";for(var v=0;v<b.season.length;v++){q+=t_vineyard_season_name[b.season[v]]+", "}l+='<div class="info">'+t_vineyard_season_info+"&nbsp;"+q.substr(0,(q.length-2))+"</div>"}if(b.limit&&in_array(this.data.data.plants[c].season,b.season)){d="";if(this.data.data.plants[c].care&&this.data.data.plants[c].care[w]){d="important"}l+='<div class="info '+d+'">'+t_vineyard_care_limit+"</div>"}l+="  </div>";l+="</div>"}l+="</div>"}var d="";var t="vineyard.harvestBarrelsSelection("+c+")";var a="<b>"+t_vineyard_harvest_title+"</b>";if(!this.data.config.season[E.season].harvest){var q="";for(var n in this.data.config.season){if(!this.data.config.season[n].harvest){continue}q+=t_vineyard_season_name[n]+", "}a+="<div>"+t_vineyard_season_info+"&nbsp;"+q.substr(0,(q.length-2))+"</div>";d="off";t=""}if(E.harvested>0){a+="";d="off";t=""}l+='<div class="harvest" onmouseover="showDiv(\'vineyard_plant_slot'+c+"_harvest_tt')\" onmouseout=\"hideDiv('vineyard_plant_slot"+c+"_harvest_tt')\">";l+='  <div class="button '+d+'" onclick="'+t+'"></div>';l+='  <div id="vineyard_plant_slot'+c+'_harvest_tt" class="ttbox">'+a+"</div>";l+="</div>";l+='<div class="header">';var B={type:E.type,quality:0};l+=this.buildBottle("plantinfo",B,1);l+='  <div class="year" onmouseover="showDiv(\'vineyard_plant_slot'+c+"_year_tt')\" onmouseout=\"hideDiv('vineyard_plant_slot"+c+"_year_tt')\">";l+="    <div>"+t_vineyard_current_year.replace("%COUNT%",E.year)+"</div>";l+='    <div id="vineyard_plant_slot'+c+'_year_tt" class="ttbox">';l+=this.buildAgeTable(E.type,E.year);l+="    </div>";l+="  </div>";l+='  <div class="season season'+E.season+'" onmouseover="showDiv(\'vineyard_plant_slot'+c+"_season_tt')\" onmouseout=\"hideDiv('vineyard_plant_slot"+c+"_season_tt')\">";l+='    <div class="icon vineyard_season'+E.season+'"></div>';l+='    <div id="vineyard_plant_slot'+c+'_season_tt" class="ttbox">'+this.data.config.season[E.season].name+"</div>";var e=t_vineyard_season_end;if(E.remain>0){e=formatTime(E.remain)}l+='    <div id="vineyard_plant_slot'+c+'_season_timer_time" class="timer">'+e+"</div>";if(devserver==1&&this.cheatEnabled==1){l+='<div class="cheatbutton1 link" onclick="vineyard.cheat(\'finishseason\', '+c+')"></div>';l+='<div class="cheatbutton2 link" onclick="vineyard.cheat(\'finishseasonnearby\', '+c+')"></div>'}l+="  </div>";if(this.data.config.weather[E.weather][E.season]){l+='  <div class="weather '+E.weather+'" onmouseover="showDiv(\'vineyard_plant_slot'+c+"_weather_tt')\" onmouseout=\"hideDiv('vineyard_plant_slot"+c+"_weather_tt')\">";l+='    <div class="icon2 vineyard_weather '+E.weather+'"></div>';l+='    <div id="vineyard_plant_slot'+c+'_weather_tt" class="ttbox">';l+='      <div class="head">'+t_vineyard_weather_name[E.weather]+"</div>";l+="      <div>"+t_vineyard_plant_weather_effect.replace("%TIME%",formatTime(this.data.config.constants.weather_cooldown))+"</div>";var u=0;if(this.data.config.weather[E.weather][E.season].quality){var q="";var d="";if(this.data.config.weather[E.weather][E.season].quality>0){q="+"}l+='<div class="icon vineyard_icon_quality"></div>';var m=this.data.config.weather[E.weather][E.season].quality;if(m<0&&E.weathertool>0){m+=((m*-1)*this.data.config.weather_tools[E.weathertool].bonus);d="green"}if(m<0){u++}l+='<div class="info '+d+'">'+q+(m/10)+"%&nbsp;"+t_vineyard_plant_bar.quality+"</div>";l+='<div class="clear"></div>'}if(this.data.config.weather[E.weather][E.season].quantity){var q="";var d="";if(this.data.config.weather[E.weather][E.season].quantity>0){q="+"}l+='<div class="icon vineyard_icon_quantity"></div>';var h=this.data.config.weather[E.weather][E.season].quantity;if(h<0&&E.weathertool>0){h+=((h*-1)*this.data.config.weather_tools[E.weathertool].bonus);d="green"}if(h<0){u++}l+='<div class="info '+d+'">'+q+(h/10)+"%&nbsp;"+t_vineyard_plant_bar.quantity+"</div>";l+='<div class="clear"></div>'}if(E.weathertool>0){l+='<div class="info2 green">'+t_vineyard_weathertool_info+"</div>"}l+="    </div>";l+="  </div>";if(u>0){l+='<div class="weathertool link" onclick="vineyard.buyWeatherToolCommit('+c+')" onmouseover="showDiv(\'weathertool_tt\')" onmouseout="hideDiv(\'weathertool_tt\')">';l+='  <div id="weathertool_tt" class="ttbox">'+t_vineyard_weathertool_head+"</div>";l+="</div>"}}l+='  <div class="mini_close remove link" onclick="vineyard.removePlantCommit('+c+')" onmouseover="showDiv(\'vineyard_plants_slot'+c+"_remove')\" onmouseout=\"hideDiv('vineyard_plants_slot"+c+"_remove')\">";l+='    <div id="vineyard_plants_slot'+c+'_remove" class="ttbox">'+t_vineyard_plant_remove_head+"</div>";l+="  </div>";l+='  <div class="clear"></div>';l+="</div>";l+='<div id="vineyard_plant_slot'+c+'_bars"></div>'}else{l+='<div id="vineyard_plants_addbutton'+c+'" class="addbutton" onclick="vineyard.openShop(\'plants\', '+c+')" onmouseover="showDiv(\'vineyard_plants_addbutton'+c+"_tt')\" onmouseout=\"hideDiv('vineyard_plants_addbutton"+c+"_tt')\">";l+='  <div id="vineyard_plants_addbutton'+c+'_tt" class="ttbox">'+t_vineyard_shop_plants+"</div>";l+="</div>"}$("vineyard_plant").innerHTML=l;this.buildPlantBars(c)};vineyard.prototype.buildAgeTable=function(d,c){var b="";for(var l in this.data.config.quanti_quali[d]){var h=l}b+='<div class="ttline topic">';b+='  <div class="ttyear">'+t_vineyard_current_year.replace("%COUNT%","")+"</div>";b+='  <div class="ttquality">'+t_vineyard_plant_bar.quality+"</div>";b+='  <div class="ttquantity">'+t_vineyard_plant_bar.quantity+"</div>";b+='  <div class="clear"></div>';b+="</div>";for(var l in this.data.config.quanti_quali[d]){var e="";if(l==h){e=" - x"}var a="";if(parseInt(c)==l||(parseInt(c)>parseInt(h)&&l==h)){a="hover"}b+='<div class="ttline '+a+'">';b+='  <div class="ttyear">'+l+e+"</div>";b+='  <div class="ttquality">'+formatNumber((this.data.config.quanti_quali[d][l].max_quality)/10)+"%</div>";b+='  <div class="ttquantity">'+formatNumber((this.data.config.quanti_quali[d][l].max_quantity)/10)+"%</div>";b+='  <div class="clear"></div>';b+="</div>"}b+='<div class="desc">'+t_vineyard_plant_quanti_quali_info+"</div>";return b};vineyard.prototype.showAgeTable=function(a,d){if(!a){for(var c in this.data.config.plants){hideDiv("vineyard_help_plants"+c+"_agetable")}return 1}var e="vineyard_help_plants"+d+"_agetable";var b=this.buildAgeTable(d);$(e).innerHTML=b;showDiv(e)};vineyard.prototype.buildTree=function(e){var n=this.data.config.season[e.season].duration;var q=100;if(e.remain&&e.remain>0){q=100-((e.remain*100)/n)}var b="long";var l=4;var c={"short":1,middle:2,"long":3};if(e.season==1){if(q<50){b="short"}else{if(q<75){b="middle"}else{if(q<90){b="long"}}}l=c[b];if(e.wintercut!=""&&c[b]<c[e.wintercut]){b=e.wintercut}}if(e.summercut!=""){b=e.summercut}var m="";if(e.season>2){m="red"}var h='<div class="plant_img">';h+='  <div class="transp"></div>';h+='  <div class="root '+b+'">';for(i=1;i<=6;i++){h+='<div class="branch branch'+i+'">';for(j=1;j<=3;j++){h+='<div class="arm arm'+j+" "+m+" leafSize"+l+'">';if(e.harvested==0){var d="vineyard_plant"+e.type;if(e.season==1){d="phase1";if(q>=50){d+=" grow2"}}if(e.season==2){d="phase2";if(q>=50){d+=" grow2"}}h+='<div class="grapes '+d+'"></div>'}for(k=1;k<=3;k++){if(c[b]<k){continue}var a=getRandom(1,3);h+='<div class="leafbox leafbox'+k+'">';h+='  <div class="leaf leaf'+k+" style"+a+'"></div>';h+="</div>"}h+="</div>"}h+="</div>"}h+="  </div>";h+="</div>";return h};vineyard.prototype.buildPlantBars=function(t){if(!$("vineyard_plant_slot"+t+"_bars")){return 1}var c=this.data.data.plants[t];var h=["quality","quantity"];var e="";for(var d=0;d<h.length;d++){var m=c[h[d]];var n=c.year;for(var r in this.data.config.quanti_quali[c.type]){var a=r}if(parseInt(n)>parseInt(a)){n=a}var q=this.data.config.quanti_quali[c.type][n]["max_"+h[d]];var s=(1000-q);var b=((s*100)/1000);var l=(m*100)/1000;e+='<div id="vineyard_plant_slot'+t+"_"+h[d]+'_bar" class="bar '+h[d]+'" onmouseover="showDiv(\'vineyard_plant_slot'+t+"_bar_"+h[d]+"_tt')\" onmouseout=\"hideDiv('vineyard_plant_slot"+t+"_bar_"+h[d]+"_tt')\">";e+='  <div class="bar_front">';e+='    <div class="bar_rest" style="height:'+b+'%"></div>';e+='    <div class="bar_inner" style="height:'+l+'%"></div>';e+="  </div>";e+='  <div class="icon_back">';e+='    <div class="icon vineyard_icon_'+h[d]+'"></div>';e+="  </div>";e+='  <div id="vineyard_plant_slot'+t+"_bar_"+h[d]+'_tt" class="ttbox">';e+='    <div style="font-weight:bold; margin-bottom:5px;">'+t_vineyard_plant_bar[h[d]]+"</div>";e+='    <div style="color:#6C441D; font-weight:bold; font-size:14px;"><span style="font-size:20px;">'+(m/10)+"</span>/"+formatNumber((q/10))+"%</div>";if(h[d]=="quantity"){e+='<div style="color:#6C441D;">(~'+this.calcBarrelBottles(m)+"&nbsp;"+t_vineyard_bottles+")</div>"}e+='    <div style="margin-top:10px; font-style:italic;">'+t_vineyard_bar_max_qual_quan_info.replace("%TYPE%",t_vineyard_plant_bar[h[d]]).replace("%PERCENT%",formatNumber((q/10)))+"</div>";e+="  </div>";e+="</div>"}$("vineyard_plant_slot"+t+"_bars").innerHTML=e};vineyard.prototype.plantWintercutCommit=function(e,b){if(this.data.config.wintercut[b].money){var d=formatPrice(this.data.config.wintercut[b].money)}if(this.data.config.wintercut[b].coins){var d=formatNumber(this.data.config.wintercut[b].coins)+"&nbsp;"+t_coins}if(this.data.config.wintercut[b].vineyard_points){var d=formatNumber(this.data.config.wintercut[b].vineyard_points)+"&nbsp;"+t_vineyard_points}var c="vineyard.plantWintercut("+e+", '"+b+"')";var a='<div id="vineyard_commit">';a+="  <div>"+t_vineyard_plant_wintercut_commit_body.replace("%COST%","<b>"+d+"</b>")+"</div>";a+="</div>";globalcommitbox(t_vineyard_plant_wintercut_commit_head,a,c)};vineyard.prototype.careSelection=function(b,t){if(this.data.data.plants[b].care&&this.data.data.plants[b].care[t]&&this.data.data.plants[b].care[t].remain>0){return 1}var d=t_vineyard_plant_care_name[t];var e='<div id="vineyard_commit" class="care_selection">';e+='  <div class="slots">';for(var s in this.data.config.care[t].slots){var a=this.data.config.care[t].slots[s];var n="vineyard.selectCareCommit("+b+", "+t+", '"+s+"')";var c="";var v="";if(a.money){if(a.money>user_bar){n="";c="failed"}var u=formatPrice(a.money)}if(a.coins){if(a.coins>user_coins){n="";c="failed"}var u=formatNumber(a.coins)+"&nbsp;"+t_coins}if(a.vineyard_points){if(a.vineyard_points>this.data.data.count){n="";c="failed"}var u=formatNumber(a.vineyard_points)+"&nbsp;"+t_vineyard_points}if(this.data.config.care[t].limit&&this.data.data.plants[b].care&&this.data.data.plants[b].care[t]){n="";v="failed"}var m=0;if(a.level&&a.level>this.data.data.level){n="";m=1}var A=this.calcWintercut(b,t,s);e+='<div class="slot slot'+s+"_"+t+' link" onclick="'+n+'">';e+='  <div class="img"></div>';var z="";if(t_vineyard_care_name[t]&&t_vineyard_care_name[t][s]){z=t_vineyard_care_name[t][s]}if(z!=""){e+='<div class="title">'+z+"</div>"}e+='  <div class="line">';var h=["quality","quantity"];for(k=0;k<h.length;k++){if(!a[h[k]]){continue}var q=A[h[k]];var l="+";var w="";if(q<=0){l="";w="failed"}e+='<div style="margin:0px 5px;">';e+='  <div class="icon vineyard_icon_'+h[k]+'"></div>';e+='  <div class="amount '+w+'">'+l+(q/10)+"%</div>";e+="</div>"}e+="  </div>";e+='  <div class="need">';e+='    <div style="margin-bottom:5px;">'+forestry_production_require+"</div>";if(a.duration){e+='<div class="duration">'+formatTime(a.duration)+"</div>"}e+='<div class="'+c+'">'+u+"</div>";if(m==1){e+='<div class="failed">'+t_vineyard_level_required.replace("%LEVEL%",a.level)+"</div>";e+='<div class="locked"></div>'}if(this.data.config.care[t].limit){e+='<div class="limit '+v+'">'+t_vineyard_care_limit+"</div>"}e+="  </div>";e+="</div>"}e+='    <div class="clear"></div>';e+="  </div>";var r=this.data.data.plants[b].wintercut;if(r!=""){e+='<div class="wintercut">';if(this.data.config.wintercut[r].quality_bonus){e+="<div>"+t_vineyard_plant_quanti_quali_info2.replace("%BONUS%",Math.round(this.data.config.wintercut[r].quality_bonus*100)+"%&nbsp;"+t_vineyard_plant_bonus.quality_bonus)+"</div>"}if(this.data.config.wintercut[r].quantity_bonus){e+="<div>"+t_vineyard_plant_quanti_quali_info2.replace("%BONUS%",Math.round(this.data.config.wintercut[r].quantity_bonus*100)+"%&nbsp;"+t_vineyard_plant_bonus.quantity_bonus)+"</div>"}e+="</div>"}e+="</div>";globalBoxFlex(d,e,0,0,1)};vineyard.prototype.selectCareCommit=function(b,z,v){var c=t_vineyard_plant_care_name[z];var C=this.data.data.plants[b];var a=this.data.config.care[z].slots[v];if(a.money){var A=formatPrice(a.money)}if(a.coins){var A=formatNumber(a.coins)+"&nbsp;"+t_coins}if(a.vineyard_points){var A=formatNumber(a.vineyard_points)+"&nbsp;"+t_vineyard_points}var E=this.calcWintercut(b,z,v);var l=C.year;for(var d in this.data.config.quanti_quali[C.type]){var B=d}if(parseInt(l)>parseInt(B)){l=B}var e='<div id="vineyard_commit" class="care_selection_commit">';e+='  <div class="line" style="display:flex; justify-content:center;">';var t="";var m=["quality","quantity"];for(var u=0;u<m.length;u++){if(!a[m[u]]){continue}var s=E[m[u]];var n="+";var D="";if(s<=0){n="";D="failed"}e+='<div style="margin:0px 15px;">';e+='  <div class="icon vineyard_icon_'+m[u]+'"></div>';e+='  <div class="amount '+D+'">'+n+(s/10)+"%</div>";e+="</div>";var q=C[m[u]];var w=this.data.config.quanti_quali[C.type][l]["max_"+m[u]];if(parseInt(q)>=parseInt(w)){t+='<div style="margin-top:5px;">'+t_vineyardquest_care_warning.replace("%PERCENT%",Math.round(w/10)).replace("%TYPE%",t_vineyard_plant_bar[m[u]])+"</div>"}}e+="  </div>";e+="  <div>"+t_vineyard_plant_care_buy_body.replace("%NAME%","<b>"+t_vineyard_plant_care_name[z]+"</b>").replace("%COST%","<b>"+A+"</b>")+"</div>";if(t!=""){e+='<div class="warning">'+t+'<div style="margin-top:5px;">'+t_vineyardquest_care_warning2+"</div></div>"}e+="</div>";var r="vineyard.selectCare("+b+", "+z+", '"+v+"')";var h="vineyard.careSelection("+b+", "+z+")";globalcommitbox(c,e,r,h)};vineyard.prototype.calcWintercut=function(h,b,a){var d=this.data.data.plants[h];var e=this.data.config.care[b].slots[a].quality;var c=this.data.config.care[b].slots[a].quantity;if(d.wintercut!=""){if(e!=0&&this.data.config.wintercut[d.wintercut].quality_bonus>0){if(e<0){e+=Math.round((e*-1)*this.data.config.wintercut[d.wintercut].quality_bonus)}else{e=Math.round(e*(1+this.data.config.wintercut[d.wintercut].quality_bonus))}}if(c!=0&&this.data.config.wintercut[d.wintercut].quantity_bonus>0){if(c<0){c+=Math.round((c*-1)*this.data.config.wintercut[d.wintercut].quantity_bonus)}else{c=Math.round(c*(1+this.data.config.wintercut[d.wintercut].quantity_bonus))}}}return{quality:e,quantity:c}};vineyard.prototype.harvestBarrelsSelection=function(a){this.changeView("barrels");this.buildBarrelsSelection()};vineyard.prototype.harvestBarrelCommit=function(d){var c=this.data.data.plants[this.currentPlantSlot];var b="vineyard.harvest("+this.currentPlantSlot+", "+d+")";var a='<div id="vineyard_commit" class="harvestbarrel">';a+='  <div class="img vineyard_plant'+c.type+'"></div>';a+='  <div style="width:200px; margin:0 auto; display:flex; justify-content:center;">';a+='    <div style="width:150px; margin-right:10px;">'+t_vineyard_plant_bar.quality+':&nbsp;<span class="highlight">'+(c.quality/10)+"%</span></div>";a+='    <div style="width:150px; margin-left:10px;">'+t_vineyard_plant_bar.quantity+':&nbsp;<span class="highlight">'+(c.quantity/10)+'%</span><div style="color:#6C441D;">('+this.calcBarrelBottles(c.quantity)+"&nbsp;"+t_vineyard_bottles+")</div></div>";a+="  </div>";a+='  <div style="padding-top: 10px; border-top:1px solid black; width:200px; margin:0 auto; margin-top:10px;">'+t_vineyard_harvest_body+"</div>";a+="</div>";globalcommitbox(t_vineyard_harvest_head.replace("%NAME%",this.data.config.plants[c.type].name),a,b)};vineyard.prototype.removePlantCommit=function(d){var b=this.data.config.plants[this.data.data.plants[d].type].name;var a='<div id="vineyard_commit">';a+="  <div>"+t_vineyard_plant_remove_body.replace("%NAME%","<b>"+b+"</b>")+"</div>";a+='  <div class="info">'+t_vineyard_plant_remove_info+"</div>";a+="</div>";var c="vineyard.removePlant("+d+")";globalcommitbox(t_vineyard_plant_remove_head,a,c)};vineyard.prototype.startSeasonCommit=function(a){this.startSeason(a)};vineyard.prototype.weatherSim=function(){for(slot in this.data.data.plants){if(!this.data.data.plants[slot].type){continue}this.data.data.plants[slot].lasttick++;var n=this.data.data.plants[slot];if(n.harvested>0||!this.data.config.weather[n.weather][n.season]){continue}var q=this.data.config.constants.weather_cooldown;var e=["quality","quantity"];if(this.data.data.plants[slot].lasttick%q==0){var d={};for(var c=0;c<e.length;c++){d[e[c]]="";if(this.data.config.weather[n.weather][n.season][e[c]]){var h=n.year;for(var m in this.data.config.quanti_quali[n.type]){var a=m}if(parseInt(h)>parseInt(a)){h=a}var l=this.data.config.quanti_quali[n.type][h]["max_"+e[c]];var b=parseInt(this.data.config.weather[n.weather][n.season][e[c]]);if(b<0&&parseInt(n.weathertool)>0){b+=((b*-1)*this.data.config.weather_tools[n.weathertool].bonus)}this.data.data.plants[slot][[e[c]]]=Math.max(0,parseInt(this.data.data.plants[slot][[e[c]]])+b);var r="";if(this.data.data.plants[slot][[e[c]]]>l){this.data.data.plants[slot][[e[c]]]=l}else{if(b>0){r="+"}d[e[c]]=r+(b/10)+"%"}}}this.buildPlantBars(slot);if(d.quality!=""){this.plantBarFlyer({id:"vineyard_plant_slot"+slot+"_quality_bar",type:"quality",html:d.quality,idle:"idle",move:"up",slot:slot})}if(d.quantity!=""){this.plantBarFlyer({id:"vineyard_plant_slot"+slot+"_quantity_bar",type:"quantity",html:d.quantity,idle:"idle",move:"up",slot:slot})}}}};vineyard.prototype.buyWeatherToolCommit=function(l){var c=t_vineyard_weathertool_head;var b='<div id="vineyard_commit" class="weathertool">';b+='  <div class="slots">';for(var d in this.data.config.weather_tools){var e="vineyard.buyWeatherToolCommitCommit("+l+", "+d+")";var a="";if(this.data.config.weather_tools[d].money&&this.data.config.weather_tools[d].money>0){var h=formatPrice(this.data.config.weather_tools[d].money);if(this.data.config.weather_tools[d].money>user_bar){e="";a="failed"}}if(this.data.config.weather_tools[d].coins&&this.data.config.weather_tools[d].coins>0){var h=this.data.config.weather_tools[d].coins+"&nbsp;"+t_coins;if(this.data.config.weather_tools[d].coins>user_coins){e="";a="failed"}}if(this.data.data.plants[l].weathertool==d){e=""}b+='<div class="slot link" onclick="'+e+'">';b+='  <div class="info">'+t_vineyard_weathertool_body.replace("%PERCENT%",Math.round(this.data.config.weather_tools[d].bonus*100))+"</div>";b+='  <div class="cost '+a+'">'+h+"</div>";b+='  <div class="clear"></div>';if(this.data.data.plants[l].weathertool==d){b+='<div class="ready megafield_product_ready"></div>'}b+="</div>"}b+="  </div>";b+="</div>";globalBoxFlex(c,b,0,0,1)};vineyard.prototype.buyWeatherToolCommitCommit=function(h,c){if(this.data.config.weather_tools[c].money&&this.data.config.weather_tools[c].money>0){var e=formatPrice(this.data.config.weather_tools[c].money)}if(this.data.config.weather_tools[c].coins&&this.data.config.weather_tools[c].coins>0){var e=this.data.config.weather_tools[c].coins+"&nbsp;"+t_coins}var b="<div>"+t_vineyard_weathertool_buyline.replace("%COST%","<b>"+e+"</b>")+"</div>";var d="vineyard.buyWeatherTool("+h+", "+c+")";var a="vineyard.buyWeatherToolCommit("+h+")";globalcommitbox(t_vineyard_weathertool_head,b,d,a)};vineyard.prototype.plantBarFlyer=function(d){var e="vineyard_plant_slot"+d.slot+"_"+d.type+"_flyer"+getRandom(100000,999999);var c="idle";var a="up";if(d.idle){c=d.idle}if(d.move){a=d.move}var b='<div id="'+e+'" class="event_flyer '+d.name+" "+c+'">'+d.html+"</div>";if($(d.id)){$(d.id).insert(b);setTimeout(function(){if($(e)){$(e).removeClassName(c).addClassName(a)}},200);setTimeout(function(){if($(e)){$(e).remove()}},1200)}};vineyard.prototype.buildBarrels=function(){var b="";b+='<div class="softer"></div>';b+='<div class="slots">';for(var e in this.data.config.slots_barrels){var d=this.checkSlots("barrels",e);var c="";c+=d.tt;var n="";if(!d.free&&d.buyable==1){n="vineyard.buyBarrelsSlotCommit("+e+")"}var h="";if(e%4==0){h="right"}var m="";if(c!=""||this.data.data.barrels[e]){m="onmouseover=\"showDiv('vineyard_barrels_slot"+e+"_tt')\" onmouseout=\"hideDiv('vineyard_barrels_slot"+e+"_tt')\""}b+='<div id="vineyard_barrels_slot'+e+'" class="slot link '+h+'" onclick="'+n+'" '+m+">";if(this.data.data.barrels[e]){var l=this.data.data.barrels[e];b+='<div class="img vineyard_barrel'+l.type+'"></div>';b+='<div id="vineyard_barrels_slot'+e+'_remove" class="mini_close link" onclick="vineyard.clearBarrelsSlotCommit('+e+')" onmouseover="showDiv(\'vineyard_barrels_slot'+e+"_remove_tt')\" onmouseout=\"hideDiv('vineyard_barrels_slot"+e+"_remove_tt')\">";b+='  <div id="vineyard_barrels_slot'+e+'_remove_tt" class="ttbox">'+t_vineyard_barrels_remove_head+"</div>";b+="</div>";c='<div class="head">'+this.data.config.barrels[l.type].name+"</div>";if(this.data.config.barrels[l.type].durability){c+='<div class="durability">';c+='  <div class="desc">'+t_vineyard_durability+":&nbsp;</div>";for(var a=1;a<=this.data.config.barrels[l.type].durability;a++){var h="";if(a>l.durability){h="off"}c+='<div class="bar '+h+'"></div>'}c+="</div>"}if(l.data&&l.data.type){b+='<div class="bar barrelbar">';b+='  <div class="overflow">';b+='    <div id="vineyard_barrels_slot'+e+'_bar_inner" class="bar_inner"></div>';b+="  </div>";b+="</div>";b+='<div id="vineyard_barrels_slot'+e+'_timer" class="timer"></div>';b+='<div id="vineyard_barrels_slot'+e+'_unfill" class="unfill" onclick="vineyard.unfillBarrelsCommit('+e+')" onmouseover="showDiv(\'vineyard_barrels_slot'+e+"_unfill_tt')\" onmouseout=\"hideDiv('vineyard_barrels_slot"+e+"_unfill_tt')\">";b+='  <div id="vineyard_barrels_slot'+e+'_unfill_tt" class="ttbox">'+t_vineyard_barrels_unfill_head+"</div>";b+="</div>";if(devserver==1&&this.cheatEnabled==1){b+='<div class="cheatbutton1 link" onclick="vineyard.cheat(\'finishbarrel\', '+e+')"></div>';b+='<div class="cheatbutton2 link" onclick="vineyard.cheat(\'stepupbarrel\', '+e+')"></div>'}c+='<div class="content">';c+='  <div class="desc">'+t_vineyard_barrel_content+":&nbsp;</div>";c+='  <div class="head">'+this.data.config.plants[l.data.type].name+"</div>";c+="  <div>"+t_vineyard_plant_quality+":&nbsp;"+(l.data.quality/10).toFixed(2)+"%</div>";c+="  <div>"+t_vineyard_bottles+":&nbsp;"+vineyard.calcBarrelBottles(l.data.amount)+"</div>";c+="</div>";c+='<div class="maturing">';c+='  <div class="desc">'+t_vineyard_barrel_maturing+":&nbsp;</div>";c+='  <div id="vineyard_barrels_slot'+e+'_tt_maturing" class="amount"></div>';c+='  <div id="vineyard_barrels_slot'+e+'_tt_maturing_info" class="info">'+t_vineyard_barrel_unfill_min_percent.replace("%PERCENT%",this.data.config.constants.barrel_unfill_min_percent)+"</div>";c+='  <div id="vineyard_barrels_slot'+e+'_tt_endquality" class="endquality"></div>';c+="</div>"}}if(!d.locked&&!d.unlocked&&!d.occupied){b+='<div id="vineyard_barrels_addbutton'+e+'" class="addbutton" onclick="vineyard.openShop(\'barrels\', '+e+')" onmouseover="showDiv(\'vineyard_barrels_addbutton'+e+"_tt')\" onmouseout=\"hideDiv('vineyard_barrels_addbutton"+e+"_tt')\">";b+='  <div id="vineyard_barrels_addbutton'+e+'_tt" class="ttbox '+h+'">'+t_vineyard_shop_barrels+"</div>";b+="</div>"}h="";if(e<5){h="top"}b+='  <div id="vineyard_barrels_slot'+e+'_tt" class="ttbox '+h+'">'+c+"</div>";if(d.locked==1){b+='<div class="locked"></div>'}else{if(d.unlocked==1){b+='<div class="unlocked"></div>'}}b+="</div>"}b+='  <div class="clear"></div>';b+="</div>";b+='<div id="vineyard_goto_plants" class="goto left link" onclick="vineyard.closeBuildBarrelsSelection(); vineyard.changeView(\'plants\')" onmouseover="showDiv(\'vineyard_barrels_goto_left_tt\')" onmouseout="hideDiv(\'vineyard_barrels_goto_left_tt\')">';b+='  <div id="vineyard_barrels_goto_left_tt" class="ttbox">'+t_vineyard_goto_plants+"</div>";b+="</div>";b+='<div class="goto right link" onclick="vineyard.changeView(\'stock\')" onmouseover="showDiv(\'vineyard_barrels_goto_right_tt\')" onmouseout="hideDiv(\'vineyard_barrels_goto_right_tt\')">';b+='  <div id="vineyard_barrels_goto_right_tt" class="ttbox">'+t_vineyard_goto_stock+"</div>";b+="</div>";b+='<div id="vineyard_barrels_selection_transp" class="transp" onclick="vineyard.closeBuildBarrelsSelection()"></div>';b+='<div id="vineyard_barrels_selection_npc" class="npc">';b+='  <div id="vineyard_barrels_selection_npc_bubble" class="bubble"></div>';b+="</div>";$("vineyard_barrels").innerHTML=b};vineyard.prototype.calcBarrelBottles=function(a){return(Math.round(Math.pow((a/10),0.8)*0.4)+1)};vineyard.prototype.calcBarrelMaturing=function(b){var a=100;if(this.data.data.barrels[b].data.remain>0){a=100-((this.data.data.barrels[b].data.remain*100)/this.data.config.barrels[this.data.data.barrels[b].type].time);a=Math.pow(a,0.5)*10;a=a.toFixed(2)}return a};vineyard.prototype.buyBarrelsSlotCommit=function(m){var h="";if(this.data.config.slots_barrels[m].money){var l=formatPrice(this.data.config.slots_barrels[m].money)}if(this.data.config.slots_barrels[m].coins){var b=this.data.config.slots_barrels[m].coins;var c="";var d=specialbonus.findBonus({key1:"vineyard",key2:"barrelslot"});if(d){h=specialbonus.htmlBonusLine(d.barrelslot,1);c=" specialbonus_bonus_value";b=Math.ceil(b*(1-d.barrelslot))}var l='<span class="'+c+'">'+b+"&nbsp;"+t_coins+"</span>"}var a='<div id="vineyard_commit">'+t_vineyard_buy_barrels_slot_body.replace("%COST%","<b>"+l+"</b>")+"</div>";if(h!=""){a+='<div style="margin-top:5px;">'+h+"</div>"}var e="vineyard.buyBarrelsSlot("+m+")";globalcommitbox(t_vineyard_buy_barrels_slot_head,a,e)};vineyard.prototype.clearBarrelsSlotCommit=function(c){var a='<div id="vineyard_commit">'+t_vineyard_barrels_remove_body+"</div>";var b="vineyard.clearBarrelsSlot("+c+")";globalcommitbox(t_vineyard_barrels_remove_head,a,b)};vineyard.prototype.unfillBarrelsCommit=function(m){var a=this.getStockCapacity();var c=this.data.data.barrels[m].data.amount;c=Math.round(Math.pow((c/10),0.8)*0.4)+1;var l=parseFloat(this.data.data.barrels[m].data.quality/10);var h=parseFloat(this.calcBarrelMaturing(m));l=l*(this.data.config.constants.quality_share_grapes*10);h=h*(this.data.config.constants.quality_share_barrel*10);l=Math.round((parseFloat(l)+parseFloat(h))/10);var e={type:this.data.data.barrels[m].data.type,quality:l};var b='<div id="vineyard_commit" class="unfill">';b+='  <div class="">'+t_vineyard_barrel_quality_sum+":</div>";b+='  <div class="quality">'+l+"%</div>";b+='  <div class="quality_add">'+t_vineyard_barrel_quality_sum_info.replace("%PERCENT1%",(this.data.config.constants.quality_share_grapes*100)).replace("%PERCENT2%",Math.round(this.data.config.constants.quality_share_barrel*100))+"</div>";b+="  <div></div>";b+='  <div class="show">';b+='    <div class="isbarrel vineyard_barrel'+this.data.data.barrels[m].type+'"></div>';b+='    <div class="arrow"></div>';b+='    <div class="isbottle">'+this.buildBottle("unfill",e,1)+"</div>";b+='    <div class="amount">'+c+"x</div>";b+="  </div>";if((a.current+c)>a.max){b+='<div class="failed">'+t_vineyard_barrels_unfill_failed+"</div>"}else{b+='  <div class="desc">'+t_vineyard_barrels_unfill_body.replace("%NAME%","<b>"+this.data.config.plants[e.type].name+"</b>")+"</div>";b+='  <div class="buttons">';b+='    <div class="button_yes link" onclick="vineyard.unfillBarrels('+m+')"></div>';b+="    <div class=\"button_no link\" onclick=\"hideDiv('globalbox'); hideDiv('globaltransp');\"></div>";b+="  </div>"}b+="</div>";var d="";globalBoxFlex(t_vineyard_barrels_unfill_head,b,d);$("globalbox").style.top=85+"px"};vineyard.prototype.buildBarrelsSelection=function(){this.barrelSelectionReminder=1;showDiv("vineyard_barrels_selection_transp");showDiv("vineyard_barrels_selection_npc");$("vineyard_goto_plants").addClassName("select");var c=0;for(var e in this.data.config.slots_barrels){if(this.data.data.barrels[e]){if(this.data.data.barrels[e].data&&this.data.data.barrels[e].data.type){continue}$("vineyard_barrels_slot"+e).addClassName("select pulse");var b="vineyard.harvestBarrelCommit("+e+")";$("vineyard_barrels_slot"+e).onclick=new Function(b);hideDiv("vineyard_barrels_slot"+e+"_remove");c++}else{var a=this.checkSlots("barrels",e);if(!a.locked&&!a.unlocked&&!a.occupied){$("vineyard_barrels_slot"+e).addClassName("select")}}}var d=t_vineyard_barrel_selection_tutorial_failed;if(c>0){d=t_vineyard_barrel_selection_tutorial_success}$("vineyard_barrels_selection_npc_bubble").innerHTML=d;setTimeout(function(){for(var h in vineyard.data.config.slots_barrels){if(vineyard.data.data.barrels[h]&&$("vineyard_barrels_slot"+h)){$("vineyard_barrels_slot"+h).removeClassName("pulse")}}},2000)};vineyard.prototype.closeBuildBarrelsSelection=function(){this.barrelSelectionReminder=0;this.buildBarrels();this.changeView("plants");hideDiv("vineyard_barrels_selection_transp");hideDiv("vineyard_barrels_selection_npc")};vineyard.prototype.buildStock=function(){var r=8;var h=(r*2);var w=0;var l=this.data.config.levels_stock[this.data.data.stock_level].max;for(var z in this.data.config.levels_stock){w=this.data.config.levels_stock[z].max}var n="";n+='<div class="softer"></div>';n+='<div class="subheader">';n+='  <div class="expertinfo_link" onclick="vineyard.expertInfo()" onmouseover="showDiv(\'vineyard_expertinfo_link_tt\')" onmouseout="hideDiv(\'vineyard_expertinfo_link_tt\')">';n+='    <div id="vineyard_expertinfo_link_tt" class="ttbox">'+t_vineyard_expert_name+"</div>";n+="  </div>";n+='  <div class="market_link" onclick="vineyard.initMarket()" onmouseover="showDiv(\'vineyard_market_link_tt\')" onmouseout="hideDiv(\'vineyard_market_link_tt\')">';n+='    <div id="vineyard_market_link_tt" class="ttbox">'+t_vineyard_market_name+"</div>";n+="  </div>";n+="</div>";n+='<div class="slots">';var e=0;var b=0;if(this.data.data.stock&&this.data.data.stock.length){var a=(this.currentStockPage*h);var v=(a-h)+1;var C=this.data.data.stock;if(this.currentStockSort!="none"){if(this.currentStockSort=="quality"){C=this.stockSortByQuality(this.data.data.stock)}if(this.currentStockSort=="type"){C=this.stockSortByType(this.data.data.stock)}}var d=0;for(var z=1;z<=C.length;z++){e++;var B=C[(z-1)];var q=this.getQuality(B.quality);b+=parseInt(B.amount);if(z<v||z>a){continue}d++;var c="";if(d%(r-1)==0||d%r==0){c="right"}if(d>(r)){c+=" bottom"}n+=this.buildBottle("stock",B,d,c)}}n+='  <div class="clear"></div>';var t=Math.ceil(e/h);n+='  <div id="vineyard_stock_navi_left" class="navi left link" onclick="vineyard.stockNavi(-1, '+t+')"></div>';n+='  <div id="vineyard_stock_navi_right" class="navi right link" onclick="vineyard.stockNavi(1, '+t+')"></div>';n+="</div>";n+='<div class="capacity main_countbar">';n+='  <div class="amount">'+b+"/"+l+"</div>";if(w>l){var u="vineyard.upgradeStockCommit()";var s=(parseInt(this.data.data.stock_level)+1);var D=this.data.config.levels_stock[s];var c="";if(D.money){if(D.money>user_bar){var u="";c="error"}var A='<span class="'+c+'">'+formatPrice(D.money)+"</span>"}if(D.coins){if(D.coins>user_coins){var u="";c="error"}var A='<span class="'+c+'">'+D.coins+"&nbsp;"+t_coins+"</span>"}if(D.vineyardpoints){if(D.vineyardpoints>this.data.data.count){var u="";c="error"}var A='<span class="'+c+'">'+formatNumber(D.vineyardpoints)+"&nbsp;"+t_vineyard_points+"</span>"}n+='<div class="upgrade plus link '+c+'" onclick="'+u+'" onmouseover="showDiv(\'vineyard_stock_upgrade_tt\')" onmouseout="hideDiv(\'vineyard_stock_upgrade_tt\')">';n+='  <div id="vineyard_stock_upgrade_tt" class="ttbox">';n+='    <div class="head">'+t_vineyard_stock_upgrade_head+"</div>";n+="    <div>"+t_vineyard_stock_level.replace("%LEVEL%",s)+"</div>";n+="    <div>"+t_vineyard_stock_capacity.replace("%COUNT%",this.data.config.levels_stock[s].max)+"</div>";n+="    <div>"+cityadcost+A+"</div>";n+="  </div>";n+="</div>"}n+="</div>";if(e>0){var m=["quality","type","none"];for(var z=0;z<m.length;z++){var c="";if(m[z]==this.currentStockSort){c="active"}n+='<div class="sort '+m[z]+" link "+c+'" onclick="vineyard.stockSort(\''+m[z]+"')\" onmouseover=\"showDiv('vineyard_stock_sort_"+m[z]+"_tt')\" onmouseout=\"hideDiv('vineyard_stock_sort_"+m[z]+"_tt')\">";n+='  <div id="vineyard_stock_sort_'+m[z]+'_tt" class="ttbox">'+t_vineyard_stock_sort[m[z]]+"</div>";n+="</div>"}}n+='<div id="vineyard_market" class="market">';n+='  <div class="transp"></div>';n+='  <div id="vineyard_market_inner" class="inner"></div>';n+="</div>";n+='<div class="goto left link" onclick="vineyard.changeView(\'barrels\')" onmouseover="showDiv(\'vineyard_stock_goto_tt\')" onmouseout="hideDiv(\'vineyard_stock_goto_tt\')">';n+='  <div id="vineyard_stock_goto_tt" class="ttbox">'+t_vineyard_goto_barrels+"</div>";n+="</div>";$("vineyard_stock").innerHTML=n;this.stockNavi(0,t)};vineyard.prototype.buildBottle=function(c,m,a,e){var h=0;if(m.quality){h=m.quality}var h=this.getQuality(m.quality);var l="onmouseover=\"showDiv('vineyard_"+c+"_slot"+a+"_tt')\" onmouseout=\"hideDiv('vineyard_"+c+"_slot"+a+"_tt')\"";var n="";if(c=="stock"){l='onmouseover="vineyard.hoverStockSlot('+a+', 1)" onmouseout="vineyard.hoverStockSlot('+a+', 0)"'}if(c=="questentry"){n="vineyard.questEntryStockCommitCommit("+m.id+")"}if(c=="questinfo"){l=""}var b="";b+='<div class="slot vineyard_bottle '+e+'" '+l+' onclick="'+n+'">';if(in_array(c,["plantinfo"])){b+='<div class="img vineyard_plant'+m.type+'"></div>'}else{b+='<div class="img type'+m.type+'"></div>'}if(!in_array(c,["plantinfo","expertinfo"])){b+='<div class="label '+h+'"></div>'}if(c=="stock"){b+='  <div id="vineyard_stock_slot'+a+'_btn_sell" class="btn link sell" onclick="vineyard.openExpert('+m.id+')" onmouseover="showDiv(\'vineyard_stock_slot'+a+"_btn_sell_tt')\" onmouseout=\"hideDiv('vineyard_stock_slot"+a+"_btn_sell_tt')\">";b+='    <div id="vineyard_stock_slot'+a+'_btn_sell_tt" class="ttbox">'+t_vineyard_stock_sell+"</div>";b+="  </div>";b+='  <div id="vineyard_stock_slot'+a+'_btn_market" class="btn link markett" onclick="vineyard.openMarketCreateOffer('+m.id+')" onmouseover="showDiv(\'vineyard_stock_slot'+a+"_btn_market_tt')\" onmouseout=\"hideDiv('vineyard_stock_slot"+a+"_btn_market_tt')\">";b+='    <div id="vineyard_stock_slot'+a+'_btn_market_tt" class="ttbox">'+t_vineyard_stock_market+"</div>";b+="  </div>"}if(in_array(c,["stock","questentry"])){b+='<div class="amount">'+m.amount+"</div>"}b+='  <div id="vineyard_'+c+"_slot"+a+'_tt" class="ttbox">';b+='    <div class="name">'+this.data.config.plants[m.type].name+"</div>";if(!in_array(c,["plantinfo","expertinfo"])){var d=this.getQuality(m.quality);b+='<div style="display:flex; justify-content:left;">';b+="  <div>"+t_vineyard_market_offer_quality+":&nbsp;"+m.quality+"%</div>";if(d!=""){b+='<div class="label '+d+'"></div>'}b+="</div>"}b+="  </div>";b+="</div>";return b};vineyard.prototype.stockNavi=function(b,a){if(b){this.currentStockPage+=b}if(this.currentStockPage>a){this.currentStockPage=a}if(this.currentStockPage<1){this.currentStockPage=1}hideDiv("vineyard_stock_navi_left");hideDiv("vineyard_stock_navi_right");if(this.currentStockPage>1){showDiv("vineyard_stock_navi_left")}if(this.currentStockPage<a){showDiv("vineyard_stock_navi_right")}if(b){this.buildStock()}};vineyard.prototype.stockSort=function(a){this.currentStockSort=a;this.buildStock()};vineyard.prototype.stockSortByQuality=function(e){var d={};for(var c=0;c<e.length;c++){if(!d[e[c].quality]){d[e[c].quality]=[]}d[e[c].quality].push(e[c])}var b=[];for(var c=250;c>=1;c--){if(!d[c]){continue}for(var a=0;a<d[c].length;a++){b.push(d[c][a])}}return b};vineyard.prototype.stockSortByType=function(d){d=this.stockSortByQuality(d);var c=[];for(var b=1;b<=20;b++){for(var a=0;a<d.length;a++){if(d[a].type==b){c.push(d[a])}}}return c};vineyard.prototype.hoverStockSlot=function(b,a){hideDiv("vineyard_stock_slot"+b+"_btn_sell");hideDiv("vineyard_stock_slot"+b+"_btn_market");hideDiv("vineyard_stock_slot"+b+"_tt");if(a==1){showDiv("vineyard_stock_slot"+b+"_btn_sell");showDiv("vineyard_stock_slot"+b+"_btn_market");showDiv("vineyard_stock_slot"+b+"_tt")}};vineyard.prototype.upgradeStockCommit=function(){var b=(parseInt(this.data.data.stock_level)+1);var d=this.data.config.levels_stock[b];if(d.money){var e=formatPrice(d.money)}if(d.coins){var e=d.coins+"&nbsp;"+t_coins}if(d.vineyardpoints){var e=d.vineyardpoints+"&nbsp;"+t_vineyard_points}var a="";a+='<div style="font-weight:bold;">'+t_vineyard_stock_level.replace("%LEVEL%",b)+"</div>";a+='<div style="margin-bottom:20px;">'+t_vineyard_stock_capacity.replace("%COUNT%",this.data.config.levels_stock[b].max)+"</div>";a+='<div id="vineyard_commit">'+t_vineyard_stock_upgrade_body.replace("%COST%","<b>"+e+"</b>")+"</div>";var c="vineyard.upgradeStock()";globalcommitbox(t_vineyard_stock_upgrade_head,a,c)};vineyard.prototype.getQuality=function(d){d=parseInt(d);var b="";for(var a in this.data.config.constants.labels){var c=this.data.config.constants.labels[a];if(d>=c){b=a}}return b};vineyard.prototype.getStockAmount=function(c,e){var b=0;if(this.data.data.stock&&this.data.data.stock.length){for(var a=0;a<this.data.data.stock.length;a++){var d=this.data.data.stock[a];if(d.type==c&&d.quality>=e){b+=parseInt(d.amount)}}}return b};vineyard.prototype.getStockCapacity=function(){var a={};a.max=this.data.config.levels_stock[this.data.data.stock_level].max;a.current=0;if(this.data.data.stock&&this.data.data.stock.length){for(var b=1;b<=this.data.data.stock.length;b++){var c=this.data.data.stock[(b-1)];a.current+=parseInt(c.amount)}}return a};vineyard.prototype.openExpert=function(h){for(var b=0;b<this.data.data.stock.length;b++){if(h!=this.data.data.stock[b].id){continue}var e=this.data.data.stock[b];var d=this.calcExpertPrice(e.type,e.quality);var c="vineyard.expertSell("+h+")";var a='<div id="vineyard_commit" class="expertsell">';a+=this.buildBottle("expertsell",e,1);a+="  <div>"+t_vineyard_expert_daily_price+"</div>";a+='  <div class="dailyprice"><span class="price">'+d+'</span>&nbsp;<span class="currency">'+t_vineyard_market_offer_price+"</span></div>";a+="  <div>"+t_vineyard_expert_daily_amount+"</div>";a+='  <div class="sellbox">';a+='    <div style="float:left;">'+t_market_new_amount+'&nbsp;<input id="vineyard_expert_sell_amount" type="number" value="1" onchange="vineyard.checkExpert('+h+')" onkeyup="vineyard.checkExpert('+h+')"></div>';a+='    <div class="stock" style="float:left; margin-top:2px;">&nbsp;'+t_inner_stock+"&nbsp;"+formatNumber(e.amount)+"</div>";a+='    <button class="button_new link" style="float:right;" onclick="'+c+'">'+t_vineyard_expert_sell_button+"</button>";a+='    <div class="clear"></div>';a+="  </div>";a+='  <div class="sum">'+t_vineyard_expert_sell_sum+'&nbsp;<span id="vineyard_expert_sell_sum"></span></div>';a+='  <div class="npc"></div>';a+="</div>";globalBoxFlex(t_vineyard_expert_name,a,c);this.checkExpert(h);$("vineyard_expert_sell_amount").focus();break}};vineyard.prototype.checkExpert=function(h){for(var a=0;a<this.data.data.stock.length;a++){if(h!=this.data.data.stock[a].id){continue}var d=this.data.data.stock[a];var c=this.calcExpertPrice(d.type,d.quality);var e=$("vineyard_expert_sell_amount").value;e=parseInt(e);if(e<1||isNaN(e)){e=1}if(e>parseInt(d.amount)){e=parseInt(d.amount)}$("vineyard_expert_sell_amount").value=e;var b=(c*e);$("vineyard_expert_sell_sum").innerHTML=formatPrice(b)}};vineyard.prototype.calcExpertPrice=function(a,c){var b=this.data.data.expert.products[a];b=b*(Math.pow(c,2)*0.0001)+b;if(this.data.data.expert.fav.type==a){b=b*this.data.config.constants.expert_base_multi}return Math.round(b)};vineyard.prototype.expertInfo=function(){var e={type:this.data.data.expert.fav.type,quality:0};var a='<div id="vineyard_commit" class="expertinfo">';a+="  <div>"+t_vineyard_expert_daily_special+"</div>";a+=this.buildBottle("expertinfo",e);a+="  <div>"+t_vineyard_expert_daily_prices+"</div>";a+='  <div class="prices">';for(var c in this.data.data.expert.products){var d=this.data.data.expert.products[c];var b="";if(this.data.data.expert.fav.type==c){d=Math.round(d*this.data.config.constants.expert_base_multi);b="fav"}a+='<div class="line">';a+='  <div class="name">'+this.data.config.plants[c].name+"</div>";a+='  <div class="price '+b+'">'+formatPrice(d)+"</div>";if(this.data.data.expert.fav.type==c){a+='<div class="star_five"></div>'}a+='  <div class="clear"></div>';a+="</div>"}a+="  </div>";a+='  <div class="npc"></div>';a+="</div>";globalBoxFlex(t_vineyard_expert_name,a,0,0,1)};vineyard.prototype.buildMarket=function(){var d='<div class="head">'+t_vineyard_market_name+"</div>";d+='<div class="offers">';d+='  <div class="line topic">';d+='    <div class="left name">';var e=t_vineyard_market_offer_name;if(this.marketFilter>0&&this.marketFilter<999){e=this.data.config.plants[this.marketFilter].name}d+='      <div class="desc">'+e+"</div>";d+='      <div id="vineyard_market_name_selection_expand" class="expand link down" onclick="toogleDiv(\'vineyard_market_name_selection\')"></div>';d+='      <div class="clear"></div>';d+='      <div id="vineyard_market_name_selection" class="selection">';d+='         <div class="line link" onclick="vineyard.filterMarketOffers(0)">'+t_vineyard_market_offer_name+"</div>";for(var c in this.data.config.plants){if(this.data.config.plants[c].level&&this.data.config.plants[c].level>this.data.data.level){continue}d+='<div class="line link" onclick="vineyard.filterMarketOffers('+c+')">'+this.data.config.plants[c].name+'&nbsp;(<span id="vineyard_market_offers_count_type'+c+'"></span>)</div>'}d+="      </div>";d+="    </div>";d+='    <div class="left quality topic2 link" onclick="vineyard.sortMarketOffers(\'quality\')">';d+='      <div class="col1" style="">'+t_vineyard_market_offer_quality+"</div>";var a="";if(this.marketSort=="quality"&&this.marketSortDir=="asc"){a="asc"}d+='      <div id="vineyard_market_offer_sort_arrow_quality" class="arrow '+a+' link"></div>';d+='      <div class="clear"></div>';d+="    </div>";d+='    <div class="left price topic2 link" onclick="vineyard.sortMarketOffers(\'price\')">';d+='      <div class="col1">'+t_vineyard_market_offer_price+"</div>";var a="";if(this.marketSort=="price"&&this.marketSortDir=="asc"){a="asc"}d+='      <div id="vineyard_market_offer_sort_arrow_price" class="arrow '+a+' link"></div>';d+='      <div class="clear"></div>';d+="    </div>";d+='    <div class="left amount topic2">'+t_vineyard_market_offer_amount+"</div>";d+='    <div class="left seller topic2">'+t_vineyard_market_offer_seller+"</div>";d+='    <div class="left buy topic2"></div>';d+='    <div class="clear"></div>';d+="  </div>";d+='  <div id="vineyard_market_offers" class="list"></div>';d+="</div>";d+='<div class="own">';d+="  <div>"+t_vineyard_market_max_offers+"&nbsp;"+this.marketData.self+"/"+this.data.config.constants.market_max_offers+"</div>";d+="</div>";var a="";var b="";if(this.marketFilter==999){a="active"}else{b="active"}d+='<div class="link btn btn_all '+b+"\" onclick=\"vineyard.marketFilter=0; vineyard.marketSort=''; vineyard.marketSortDir='asc'; vineyard.initMarket();\" onmouseover=\"showDiv('vineyard_market_filter_btn_all_tt')\" onmouseout=\"hideDiv('vineyard_market_filter_btn_all_tt')\">";d+='  <div id="vineyard_market_filter_btn_all_tt" class="ttbox">'+t_vineyard_market_filter_all+"</div>";d+="</div>";d+='<div class="link btn btn_self '+a+"\" onclick=\"vineyard.marketSort=''; vineyard.marketSortDir='asc'; vineyard.filterMarketOffers(999);\" onmouseover=\"showDiv('vineyard_market_filter_btn_self_tt')\" onmouseout=\"hideDiv('vineyard_market_filter_btn_self_tt')\">";d+='  <div id="vineyard_market_filter_btn_self_tt" class="ttbox">'+t_vineyard_market_filter_self+"</div>";d+="</div>";d+='<div class="mini_close link" onclick="vineyard.closeMarket()"></div>';$("vineyard_market_inner").innerHTML=d;showDiv("vineyard_market");this.buildMarketOffers(this.marketData.offers)};vineyard.prototype.buildMarketOffers=function(s){var e=0;var m=[];var h={};for(var a in s){if(!h[s[a].t]){h[s[a].t]=0}h[s[a].t]++;if(!s[a]||!s[a].p){continue}if(this.marketFilter==999&&typeof s[a].s=="undefined"){continue}if(this.marketFilter>0&&this.marketFilter!=999&&this.marketFilter!=s[a].t){continue}s[a].p=parseInt(s[a].p);s[a].q=parseInt(s[a].q);m.push(s[a]);e++}for(var b in this.data.config.plants){var n=0;if(h[b]){n=h[b]}if($("vineyard_market_offers_count_type"+b)){$("vineyard_market_offers_count_type"+b).innerHTML=n}}if(!e){$("vineyard_market_offers").innerHTML="";return 1}if(vineyard.marketSort!=""){m.sort(function(v,u){if(vineyard.marketSort=="quality"){if(v.q==u.q){return v.id-u.id}if(vineyard.marketSortDir=="desc"){return u.q-v.q}else{return v.q-u.q}}if(vineyard.marketSort=="price"){if(v.p==u.p){return v.id-u.id}if(vineyard.marketSortDir=="desc"){return u.p-v.p}else{return v.p-u.p}}})}else{m.sort(function(v,u){return u.id-v.id})}var c="";for(var b=0;b<m.length;b++){var r=m[b];var d=formatPrice(r.p/100);c+='<div class="line">';c+='  <div class="left name">'+this.data.config.plants[r.t].name+"</div>";c+='  <div class="left quality">'+r.q+"</div>";c+='  <div class="left price">'+d+"</div>";c+='  <div class="left amount">'+r.a+"</div>";c+='  <div class="left seller">'+this.marketData.names[r.unr]+"</div>";var l=t_market_buy_button;var q="cart";var t="vineyard.buyMarketOfferCommit("+r.id+")";if(r.s){l=t_vineyard_market_del_offer_tt;q="cross";t="vineyard.deleteMarketOfferCommit("+r.id+")"}c+='  <div class="left buy link '+q+'" onclick="'+t+'" onmouseover="showDiv(\'vineyard_market_offer_del_tt'+r.id+"')\" onmouseout=\"hideDiv('vineyard_market_offer_del_tt"+r.id+"')\">";c+='    <div id="vineyard_market_offer_del_tt'+r.id+'" class="ttbox">'+l+"</div>";c+="  </div>";c+='  <div class="clear"></div>';c+="</div>"}$("vineyard_market_offers").innerHTML=c};vineyard.prototype.sortMarketOffers=function(a){if(this.marketSort==a){if(this.marketSortDir=="asc"){this.marketSortDir="desc"}else{this.marketSortDir="asc"}}this.marketSort=a;this.buildMarket()};vineyard.prototype.filterMarketOffers=function(a){this.marketFilter=a;this.buildMarket()};vineyard.prototype.openMarketCreateOffer=function(a){this.marketCreateOfferId=a;this.initMarket()};vineyard.prototype.createMarketOfferCommit=function(l){if(this.marketData.self>=this.data.config.constants.market_max_offers){var e='<div id="vineyard_commit">'+t_vineyard_market_max_offer_reached.replace("%COUNT%",this.data.config.constants.market_max_offers)+"</div>";globalerrorbox(e);return 1}for(var d=0;d<this.data.data.stock.length;d++){if(l!=this.data.data.stock[d].id){continue}var h=this.data.data.stock[d]}var b="vineyard.checkCreateMarketOfferCommit("+l+")";var a='<div id="vineyard_commit" class="createmarketoffer">';a+=this.buildBottle("createmarketoffer",h);a+='  <div class="createbox">';a+='    <div class="amount_line">'+t_market_new_amount+'&nbsp;<input id="vineyard_market_create_offer_amount" value="1" type="number" onchange="'+b+'" onkeyup="'+b+'">&nbsp;'+t_inner_stock+"&nbsp;"+formatNumber(h.amount)+"</div>";a+='    <div class="price_line">'+t_market_new_price+'&nbsp;<input id="vineyard_market_create_offer_price1" type="number" onchange="'+b+'" onkeyup="'+b+'">,&nbsp;<input id="vineyard_market_create_offer_price2" type="number" maxlength="2" onchange="'+b+'" onkeyup="'+b+'">&nbsp;'+t_vineyard_market_offer_price+"</div>";a+='    <div class="fee">'+t_vineyard_market_fee.replace("%PERCENT%",Math.round(this.data.config.constants.market_fee*100))+':&nbsp;<span id="vineyard_market_create_offer_fee"></span></div>';a+='    <button id="vineyard_market_create_offer_button" class="button_new createoffer link">'+t_vineyard_market_create_offer+"</button>";a+="  </div>";a+="  <div>"+t_market_new_price_coins_min+'&nbsp;<span id="vineyard_market_create_offer_pricecontrol_min"></span></div>';a+="  <div>"+t_highest_price+':&nbsp;<span id="vineyard_market_create_offer_pricecontrol_max"></span></div>';a+="</div>";var c="vineyard.closeMarket(); hideDiv('globalbox'); hideDiv('globaltransp');";globalcommitbox(t_vineyard_market_create_offer,a,0,c,1);$("vineyard_market_create_offer_amount").focus();$("globalbox").style.top="45px";this.checkCreateMarketOfferCommit(l)};vineyard.prototype.checkCreateMarketOfferCommit=function(a){for(var b=0;b<this.data.data.stock.length;b++){if(a!=this.data.data.stock[b].id){continue}var r=this.data.data.stock[b];var d=0;var c=$("vineyard_market_create_offer_amount").value;c=parseInt(c);if(c<=0||isNaN(c)){c=1}if(c>parseInt(r.amount)){c=parseInt(r.amount)}$("vineyard_market_create_offer_amount").value=c;if(c<=0){d++}var n=$("vineyard_market_create_offer_price1").value;n=parseInt(n);if(n<0||isNaN(n)){n=0}$("vineyard_market_create_offer_price1").value=n;var e=(n*100);var n=$("vineyard_market_create_offer_price2").value;n=parseInt(n);if(n<0||n>99||isNaN(n)){n=0}e+=n;n=String(n);if(n.length==1){n="0"+n}$("vineyard_market_create_offer_price2").value=n;var h=this.getPriceControlMarket(r.type,r.quality);$("vineyard_market_create_offer_pricecontrol_min").removeClassName("failed").innerHTML=formatPrice(h.min);$("vineyard_market_create_offer_pricecontrol_max").removeClassName("failed").innerHTML=formatPrice(h.max);var m=(e/100);if(h.min>m){d++;$("vineyard_market_create_offer_pricecontrol_min").addClassName("failed")}if(h.max<m){d++;$("vineyard_market_create_offer_pricecontrol_max").addClassName("failed")}var l=Math.ceil((e*c)*this.data.config.constants.market_fee);$("vineyard_market_create_offer_fee").removeClassName("failed").innerHTML=formatPrice((l/100));if(user_bar<(l/100)){d++;$("vineyard_market_create_offer_fee").addClassName("failed")}var q="vineyard.createMarketOffer("+a+")";$("vineyard_market_create_offer_button").removeClassName("off");if(d>0){q="";$("vineyard_market_create_offer_button").addClassName("off")}$("vineyard_market_create_offer_button").onclick=new Function(q)}};vineyard.prototype.buyMarketOfferCommit=function(d){var c=this.marketData.offers[d];var b={type:c.t,quality:c.q};var a='<div id="vineyard_commit" class="buymarket">';a+=this.buildBottle("buymarket",b);a+="  <div>"+t_market_new_price+"</div>";a+='  <div class="price">'+formatPrice(c.p/100)+"</div>";a+='  <div class="buybox">';a+='    <div style="float:left;">'+t_market_new_amount+'&nbsp;<input id="vineyard_market_buy_offer_amount" value="1" type="number" onchange="vineyard.checkBuyMarketOfferCommit('+d+')" onkeyup="vineyard.checkBuyMarketOfferCommit('+d+')"></div>';a+='    <div class="stock" style="float:left; margin-top:3px;">&nbsp;'+t_vineyard_market_buy_amount+formatNumber(c.a)+"</div>";a+='    <button style="float:right;" id="vineyard_market_buy_offer_button" class="button_new link">'+t_vineyard_market_buy_offer+"</button>";a+='    <div class="clear"></div>';a+="  </div>";a+='  <div class="sum">'+t_market_buy_sum+'&nbsp;<span id="vineyard_market_buy_offer_cost"></span></div>';a+='  <div id="vineyard_market_buy_offer_error" class="failed"></div>';a+="</div>";globalcommitbox(t_vineyard_market_buy_offer,a,0,0,1);$("vineyard_market_buy_offer_amount").focus();this.checkBuyMarketOfferCommit(d)};vineyard.prototype.checkBuyMarketOfferCommit=function(l){var a=0;var e=this.marketData.offers[l];var b=this.getStockCapacity();var c=$("vineyard_market_buy_offer_amount").value;hideDiv("vineyard_market_buy_offer_error");c=parseInt(c);if(c<=0||isNaN(c)){c=1}if(c>parseInt(e.a)){c=parseInt(e.a)}$("vineyard_market_buy_offer_amount").value=c;var h=(e.p*c)/100;$("vineyard_market_buy_offer_cost").removeClassName("failed");if(h>user_bar){$("vineyard_market_buy_offer_cost").addClassName("failed");a++}$("vineyard_market_buy_offer_cost").innerHTML=formatPrice(h);if((parseInt(c)+parseInt(b.current))>parseInt(b.max)){$("vineyard_market_buy_offer_error").innerHTML=t_vineyard_market_max_capacity_reached;showDiv("vineyard_market_buy_offer_error");a++}var d="vineyard.buyMarketOffer("+l+")";$("vineyard_market_buy_offer_button").removeClassName("off");if(a>0){d="";$("vineyard_market_buy_offer_button").addClassName("off")}$("vineyard_market_buy_offer_button").onclick=new Function(d)};vineyard.prototype.deleteMarketOfferCommit=function(h){var a=this.getStockCapacity();var e=this.marketData.offers[h];if((parseInt(e.a)+parseInt(a.current))>parseInt(a.max)){var c='<div id="vineyard_commit">'+t_vineyard_market_max_capacity_reached+"</div>";globalerrorbox(c)}else{var b=t_vineyard_market_del_offer_tt;var c='<div style="width:350px;">'+t_vineyard_market_del_offer+"</div>";c+='<div style="background-color:#C3A75E; padding:10px; border-radius:5px; margin-top:10px;">'+t_vineyard_market_del_offer_info+"</div>";var d="vineyard.deleteMarketOffer("+h+")";globalcommitbox(b,c,d);$("globalbox").style.top="150px"}};vineyard.prototype.getPriceControlMarket=function(b,c){var a={};a.base=this.data.config.plants[b].price;a.price=a.base*(Math.pow(c,2)*0.0001)+a.base;a.min=Math.round(a.price*this.data.config.constants.market_price_min);a.max=Math.round(a.price*this.data.config.constants.market_price_max);return a};vineyard.prototype.closeMarket=function(){this.marketFilter=0;this.marketSort="";this.marketSortDir="asc";hideDiv("vineyard_market")};vineyard.prototype.openShop=function(q,u){if(q=="plants"){var r=t_vineyard_shop_plants;var h="vineyard_plant"}if(q=="barrels"){var r=t_vineyard_shop_barrels;var h="vineyard_barrel"}var e=this.data.config[q];var l='<div id="vineyard_shop" class="'+q+'">';l+='  <div class="slots">';var m=1;for(var a in e){var w="vineyard.buyShopItemCommit('"+q+"', "+u+", "+a+")";var t="";var v="";if(e[a].money&&e[a].money>0){if(e[a].money>user_bar){t="error";w=""}var b=formatPrice(e[a].money)}if(e[a].coins&&e[a].coins>0){var z=e[a].coins;var s="";if(z>user_coins){t="error";w=""}if(q=="barrels"){var n=specialbonus.findBonus({key1:"vineyard",key2:"barrels"});if(n){v=specialbonus.htmlBonusLine(n.barrels);s="specialbonus_bonus_value";z=Math.ceil(z*(1-n.barrels))}}var b='<span class="'+s+'">'+z+"&nbsp;"+t_coins+"</span>"}var s="";var d=0;if(e[a].level&&e[a].level>this.data.data.level){d=1;w="";s="islocked"}l+='<div class="slot" onclick="'+w+'" onmouseover="showDiv(\'vineyard_shop_item'+a+"_tt')\" onmouseout=\"hideDiv('vineyard_shop_item"+a+"_tt')\">";l+='  <div class="img '+h+a+" "+s+'"></div>';l+='  <div class="price '+t+'">';l+="    <div>"+b+"</div>";if(v!=""){l+='<div style="margin-top:5px;">'+v+"</div>"}l+="  </div>";if(d){l+='<div class="locked"></div>'}t="";if(m%4==0){t="right"}l+='  <div id="vineyard_shop_item'+a+'_tt" class="ttbox '+t+'">';l+='    <div class="name">'+e[a].name+"</div>";if(e[a].time){l+='<div class="timebonus">'+t_vineyard_barrel_duration.replace("%TIME%",formatTime(e[a].time))+"</div>"}if(e[a].points_multi){l+='<div class="multi">'+t_vineyard_plant_bonus.points_bonus+":&nbsp;"+Math.round(e[a].points_multi*100)+"%</div>"}if(e[a].vineyardpoints_multi){l+='<div class="multi">'+t_vineyard_plant_bonus.vineyardpoints_bonus+":&nbsp;"+Math.round(e[a].vineyardpoints_multi*100)+"%</div>"}if(e[a].durability){l+='<div class="durability">';l+='  <div class="desc">'+t_vineyard_durability+":&nbsp;</div>";for(var c=0;c<e[a].durability;c++){l+='<div class="bar"></div>'}l+="</div>"}if(d){l+='<div class="required">'+t_vineyard_level_required.replace("%LEVEL%",e[a].level)+"</div>"}else{}l+="  </div>";l+='  <div class="clear"></div>';l+="</div>";m++}l+='    <div class="clear"></div>';l+="  </div>";l+="</div>";globalBoxFlex(r,l,0,0,1)};vineyard.prototype.buyShopItemCommit=function(h,n,a){var q="";var s="";var c=this.data.config[h][a];var m=t_vineyard_shop_buy_item_head.replace("%NAME%",c.name);if(c.money){var b=formatPrice(c.money)}if(c.coins){var t=c.coins;if(h=="barrels"){var e=specialbonus.findBonus({key1:"vineyard",key2:"barrels"});if(e){s=specialbonus.htmlBonusLine(e.barrels);q="specialbonus_bonus_value";t=Math.ceil(t*(1-e.barrels))}}var b='<span class="'+q+'">'+t+"&nbsp;"+t_coins+"</span>"}var d='<div id="vineyard_commit">'+t_vineyard_shop_buy_item_body.replace("%NAME%","<b>"+c.name+"</b>").replace("%COST%","<b>"+b+"</b>")+"</div>";if(s!=""){d+='<div style="margin-top:5px;">'+s+"</div>"}var r="vineyard.buyShopItem('"+h+"', "+n+", "+a+")";var l="vineyard.openShop('"+h+"', "+n+")";globalcommitbox(m,d,r,l)};vineyard.prototype.showQuest=function(){htmlQuestBox("vineyard");this.timerUpdate()};vineyard.prototype.questEntryCommit=function(c){for(var h in this.data.quest.products){if(h==c){var d=this.data.quest.products[c];if(this.data.quest.data&&this.data.quest.data[c]){var d=(d-this.data.quest.data[c])}break}}var a=checkRackItem(c);var b="kp"+c;if(a>d){a=d}var e={pid:c};globalcommitbox(forestry_questentry_dialog_head,htmlEntryLine(e),0,0,1);$("dialog_entryline_number").focus();$("dialog_entryline_number").onchange=new Function("vineyard.checkQuestEntry("+c+", "+d+")");$("dialog_entryline_number").onkeyup=new Function("vineyard.checkQuestEntry("+c+", "+d+")");this.checkQuestEntry(c,d)};vineyard.prototype.checkQuestEntry=function(a,c){var e=checkRackItem(a);var b="product";var d={type:b,stockamount:e,rest:c,click:"vineyard.questEntry("+a+")"};checkEntryLine(d)};vineyard.prototype.questEntryStockCommit=function(e,m){var c='<div id="vineyard_commit" class="questentrystockcommit">';c+='  <div class="slots">';var d=0;var a=0;for(var b=1;b<=this.data.data.stock.length;b++){var n=this.data.data.stock[(b-1)];if(n.type!=e||n.quality<m){continue}d++;var l="";if(d%4==0||d%5==0){l="right"}if(d>5){l+=" bottom"}a=n.id;c+=this.buildBottle("questentry",n,b,l)}c+='    <div class="clear"></div>';c+="  </div>";c+="</div>";var h="vineyard.showQuest()";if(d>1){globalBoxFlex(t_vineyard_quest_entry_head,c,0,h,1)}else{if(a>0){this.questEntryStockCommitCommit(a)}}};vineyard.prototype.questEntryStockCommitCommit=function(e){var c='<div id="vineyard_commit">';c+='  <div class="questentry_amount">';for(var b=0;b<this.data.data.stock.length;b++){if(this.data.data.stock[b].id!=e){continue}var d=this.data.data.stock[b];var a="";c+=this.buildBottle("questentrycommit",d,a);break}c+='    <div class="clear"></div>';c+="    <div>"+t_forestry_questentry_dialog_info.replace("%AMOUNT%",'<span id="dialog_entryline_rest"></span>')+"</div>";c+='    <div style="position:relative; display:flex; justify-content:center; width:100%; height:35px; margin-bottom:5px;">';c+='      <div class="dialog_input_line">';c+='        <input id="dialog_entryline_number" class="dialog_input" type="number" onchange="vineyard.checkQuestEntryStockCommitCommit('+e+')" onkeyup="vineyard.checkQuestEntryStockCommitCommit('+e+')">';c+='        <button id="dialog_entryline_button" class="button_new link" onclick="">'+t_inner_feedsubmit+"</button>";c+="      </div>";c+="    </div>";c+="    <div>"+t_inner_stock+'&nbsp;<span id="dialog_entryline_stockamount"></span></div>';c+="  </div>";c+="</div>";globalcommitbox(t_vineyard_quest_entry_head2,c,0,0,1);this.checkQuestEntryStockCommitCommit(e);$("dialog_entryline_number").focus()};vineyard.prototype.checkQuestEntryStockCommitCommit=function(a,b){for(var d=0;d<this.data.data.stock.length;d++){if(this.data.data.stock[d].id!=a){continue}var n=this.data.data.stock[d];break}for(var d=0;d<this.data.quest.vineyard.length;d++){var m=this.data.quest.vineyard[d];if(m.type!=n.type){continue}var b=this.data.quest.vineyard[d].amount;if(this.data.quest.data&&this.data.quest.data.vineyard&&this.data.quest.data.vineyard[m.type]){var b=(b-this.data.quest.data.vineyard[m.type])}break}var l=n.amount;if(l>b){l=b}var e=n.amount;var h="vineyard";var c={type:h,stockamount:e,rest:b,click:"vineyard.questEntryStock("+a+")"};checkEntryLine(c)};vineyard.prototype.showStats=function(){var a='<div id="vineyard_stats">';a+='  <div class="select_line">';a+='    <select id="vineyard_stats_select" onchange="vineyard.stats()">';for(var b=0;b<this.stats_options.length;b++){if(this.stats_options[b]==""){a+='<option value="0">---</option>';continue}var c="";if(this.stats_select==this.stats_options[b]){c="selected"}a+='<option value="'+this.stats_options[b]+'" '+c+">"+t_vineyard_stats[this.stats_options[b]]+"</option>"}a+="    </select>";a+="  </div>";a+='  <div class="headline">'+t_vineyard_stats_headlines[this.stats_select]+"</div>";a+='  <div class="list">';a+=htmlStatsContent(this.stats_cache[this.stats_select],this.stats_select);a+="</div>";globalBoxFlex("",a,0,0,1)};vineyard.prototype.help=function(){openFarmersMarketHowTo("vineyard",1);this.helpNavi()};vineyard.prototype.helpNavi=function(c){var b=["general","barrels","stock","level","plants"];if(!c){c="general"}for(var a=0;a<b.length;a++){$("vineyard_help_navi_tab_"+b[a]).removeClassName("active");hideDiv("vineyard_help_"+b[a])}$("vineyard_help_navi_tab_"+c).addClassName("active");showDiv("vineyard_help_"+c)};vineyard.prototype.checkSlots=function(e,h){if(e=="plants"){var b=this.data.config.slots_plants[h]}if(e=="barrels"){var b=this.data.config.slots_barrels[h]}var c={free:0,occupied:0,locked:0,unlocked:0,buyable:1,tt:""};var a="";if(b.money||b.coins){if(b.money){var l="";if(b.money>user_bar){c.buyable=0;l="error"}a+="<div>"+reallocatanimals_cost+'&nbsp;<span class="'+l+'">'+formatPrice(b.money)+"</span></div>"}if(b.coins){var n=b.coins;var l="";var m="";if(n>user_coins){c.buyable=0;l="error"}if(e=="plants"){var d=specialbonus.findBonus({key1:"vineyard",key2:"plantslot"});if(d){m=specialbonus.htmlBonusLine(d.plantslot,1);l+=" specialbonus_bonus_value";n=Math.ceil(n*(1-d.plantslot))}}if(e=="barrels"){var d=specialbonus.findBonus({key1:"vineyard",key2:"barrelslot"});if(d){m=specialbonus.htmlBonusLine(d.barrelslot,1);l+=" specialbonus_bonus_value";n=Math.ceil(n*(1-d.barrelslot))}}a+="<div>"+reallocatanimals_cost+'&nbsp;<span class="'+l+'">'+formatNumber(n)+"&nbsp;"+t_coins+"</span></div>";if(m!=""){a+='<div style="margin-top:5px;">'+m+"</div>"}}if(!this.data.data["slots_"+e]||!this.data.data["slots_"+e][h]){c.unlocked=1}if(this.data.data["slots_"+e]&&this.data.data["slots_"+e][h]){c.free=1;c.buyable=0;a=""}}else{c.free=1}if(this.data.data[e][h]){c.occupied=1;c.buyable=0;a=""}if(b.quest&&parseInt(b.quest)>parseInt(this.data.data.lastquest)){c.locked=1;c.buyable=0;a+='<div class="important">'+t_vineyard_quest_required.replace("%QUEST%",this.data.config["slots_"+e][h].quest)+"</div>"}c.tt=a;return c};vineyard.prototype.close=function(){this.closeMarket();hideDiv("transp");hideDiv("farmersmarket_pos10_inner")};vineyard.prototype.showReward=function(l,e){var b='<div id="vineyard_commit" class="reward">';b+='  <div class="line">'+t_specialoffer_message+"</div>";for(var c in l){if(c=="money"){b+='<div class="line">'+formatPrice(l[c])+"</div>"}if(c=="points"){b+='<div class="line">'+formatNumber(l[c])+"&nbsp;"+t_points+"</div>"}if(c=="vineyardpoints"){b+='<div class="line">'+formatNumber(l[c])+"&nbsp;"+t_vineyard_points+"</div>"}if(c=="bottle"){var d=l.bottle;b+='<div class="bottles">';for(var a=1;a<=l[c].amount;a++){b+='<div id="vineyard_reward_bottle'+a+'" class="isbottle off">'+this.buildBottle("reward",d,a)+"</div>"}b+="</div>"}}if(e){b+='<div class="durability">';b+='  <div class="line">'+t_vineyard_broken_barrel.replace("%NAME%","<b>"+this.data.config.barrels[e].name+"</b>")+"</div>";b+='  <div class="img vineyard_barrel'+e+'"></div>';b+="</div>"}b+="  <div class=\"button_yes link\" onclick=\"hideDiv('globalbox'); hideDiv('globaltransp');\"></div>";b+="</div>";globalBoxFlex(t_vet_reward_head,b,0,0,1);$("globalbox").style.top="75px";if(l.bottle){var h=250;for(var a=1;a<=l.bottle.amount;a++){this.showRewardBottle(a,h);this.clearRewardBottle(a,h);h+=100}}};vineyard.prototype.showRewardBottle=function(a,b){setTimeout(function(){if($("vineyard_reward_bottle"+a)){$("vineyard_reward_bottle"+a).removeClassName("off").addClassName("active")}},b)};vineyard.prototype.clearRewardBottle=function(a,b){setTimeout(function(){if($("vineyard_reward_bottle"+a)){$("vineyard_reward_bottle"+a).removeClassName("active")}},(b+250))};vineyard.prototype.timer=function(){if(this.data&&this.data.data){for(var b in this.data.config.slots_plants){if(this.data.data.plants&&this.data.data.plants[b]){this.data.data.plants[b].remain--;if(this.data.data.plants[b].care){for(var a in this.data.data.plants[b].care){if(this.data.data.plants[b].care[a].start){this.data.data.plants[b].care[a].remain--}}}}}for(var b in this.data.config.slots_barrels){if(!this.data.data.barrels||!this.data.data.barrels[b]){continue}if(this.data.data.barrels[b].data&&this.data.data.barrels[b].data.type){this.data.data.barrels[b].data.remain--}}this.timerUpdate()}if(this.data.quest&&this.data.quest.remain){this.data.quest.remain--}for(var a in this.stats_cache_delay){this.stats_cache_delay[a]--}};vineyard.prototype.timerUpdate=function(){if(this.data&&this.data.data){for(var h in this.data.config.slots_plants){if(this.data.data.plants&&this.data.data.plants[h]&&$("vineyard_plant_slot"+h+"_season_timer_time")){showDiv("vineyard_plant_slot"+h+"_season_timer_time");if(this.data.data.plants[h].season==4){hideDiv("vineyard_plant_slot"+h+"_season_timer_time")}if(this.data.data.plants[h].remain>=0){$("vineyard_plant_slot"+h+"_season_timer_time").innerHTML=formatTime(this.data.data.plants[h].remain)}if(this.data.data.plants[h].remain==-1&&this.currentView=="plants"){this.buildPlants()}if(this.data.data.plants[h].care){for(var b in this.data.data.plants[h].care){hideDiv("vineyard_plant_slot"+h+"_care"+b+"_timer");if(!$("vineyard_plant_slot"+h+"_care"+b+"_timer")){continue}if(this.data.data.plants[h].care[b].remain>=0){showDiv("vineyard_plant_slot"+h+"_care"+b+"_timer");var a=formatTime(this.data.data.plants[h].care[b].remain);if(devserver==1&&this.cheatEnabled==1){a+='<div class="cheatbutton" onclick="vineyard.cheat(\'finishcare\', '+h+", "+b+')"></div>'}$("vineyard_plant_slot"+h+"_care"+b+"_timer").innerHTML=a}}}}}for(var h in this.data.config.slots_barrels){if(!this.data.data.barrels||!this.data.data.barrels[h]){continue}if(this.data.data.barrels[h].data&&this.data.data.barrels[h].data.type&&$("vineyard_barrels_slot"+h+"_timer")){var c=this.calcBarrelMaturing(h);$("vineyard_barrels_slot"+h+"_bar_inner").style.height=c+"%";if($("vineyard_barrels_slot"+h+"_tt_maturing")){$("vineyard_barrels_slot"+h+"_tt_maturing").innerHTML=c+"%";hideDiv("vineyard_barrels_slot"+h+"_tt_maturing_info");showDiv("vineyard_barrels_slot"+h+"_unfill");if(c<this.data.config.constants.barrel_unfill_min_percent){showDiv("vineyard_barrels_slot"+h+"_tt_maturing_info");hideDiv("vineyard_barrels_slot"+h+"_unfill")}}var e=parseFloat(this.data.data.barrels[h].data.quality/10);e=e*(this.data.config.constants.quality_share_grapes*10);c=c*(this.data.config.constants.quality_share_barrel*10);e=Math.round((parseFloat(e)+parseFloat(c))/10);$("vineyard_barrels_slot"+h+"_tt_endquality").innerHTML=t_vineyard_plant_endquality.replace("%PERCENT%",e);var d=formatTime(this.data.data.barrels[h].data.remain);if(this.data.data.barrels[h].data.remain<=0){d=statusProductionComplete}$("vineyard_barrels_slot"+h+"_timer").innerHTML=d}}this.weatherSim()}if(this.data.quest&&!this.data.quest.end){if(this.data.quest.remain>0){showDiv("vineyard_quest_timer");hideDiv("vineyard_quest_data");if($("vineyard_quest_timer")){$("vineyard_quest_timer").innerHTML=formatTime(this.data.quest.remain)}}else{hideDiv("vineyard_quest_timer");showDiv("vineyard_quest_data")}}};vineyard.prototype.showTutorial=function(a){if(this.data.data.tutorial&&this.data.data.tutorial[a]){return 1}this.tutorialStep=0;showDiv("vineyard_tutorial");this.nextTutorialStep(a)};vineyard.prototype.nextTutorialStep=function(b){this.tutorialStep++;if(!t_vineyard_tutorial_text[b]||!t_vineyard_tutorial_text[b][this.tutorialStep]){this.closeTutorial();return 1}var d="vineyard.nextTutorialStep('"+b+"')";var c=t_continue;if(!t_vineyard_tutorial_text[b][(this.tutorialStep+1)]){d="vineyard.closeTutorial(); vineyard.setTutorialStep('"+b+"');";c=t_vineyard_tutorial_text_finish}var e=t_vineyard_tutorial_text[b][this.tutorialStep];e=e.replace("%USERNAME%","<b>"+username+"</b>");e=e.replace("%BUTTON1%","<b>"+t_vineyard_stock_sell+"</b>").replace("%BUTTON2%","<b>"+t_vineyard_stock_market+"</b>");var a="";a+=e;if(b=="stock"&&this.tutorialStep==3){a+='<div class="bottle_preview"></div>'}a+='<div class="footer"><button class="button_new link" onclick="'+d+'">'+c+"</button></div>";$("vineyard_tutorial_bubble").innerHTML=a};vineyard.prototype.setTutorialStep=function(a){this.setTutorial(a)};vineyard.prototype.closeTutorial=function(){hideDiv("vineyard_tutorial")};var visitor=function(){this.data={};this.cache={};this.farm=1;this.currentTaskId=-1;this.taskData={};this.customerCount=12;this.toogleDivs=["farm_speedlinks","event_speedlinks","teaser_links","whatsup_link","specialbonus_link","questbarcontrol","quests_status_bar","cropbonus_symbol","reallocatebuilding_symbol","poweruptimes","carpentrybonus_symbol","regal_main_buttons","rackInfo","rackItems","rackBottom","farmdeco_builder","friends_link"];this.toogleDivsTmp=[];this.maxSpawnTiles=270;this.spawnzones={};this.spawnzones.chicken={1:[113,114,115,116,117,118,119,120,121,122,123],5:[130,131,132,133,134,135,136,137,138,139,140,141]};this.spawnzones.weed={1:[4,5,6,7,8,9,10,11,12,13,14,15],5:[23,33],6:[23,24,27,28,33,34],7:[24,25,26,27,28,29,30,31,32,237,238,239,240,241,242,243,244,245,246,247,248,249,250],8:[40,41,42,45,46,47,50,51,238,239,240,243,244,245,247,248,249]};this.spawnzones.repair={1:[114,116,118,120,122],5:[130,132,134,136,138,140]};this.tutorialStep=0};visitor.prototype.finishTaskUnfinished=function(){var a={friend:this.data.data.user.unr,id:"task"+this.currentTaskId,unfinished:1};hideDiv("visitor_task_reward_button");visitor.action("visitor_finish_task",a)};visitor.prototype.finishTask=function(){var a={friend:this.data.data.user.unr,id:"task"+this.currentTaskId};hideDiv("visitor_task_reward_button");visitor.action("visitor_finish_task",a)};visitor.prototype.init=function(a){if(!a){return 1}if(this.cache[a]){visitor.farm=1;visitor.data=this.cache[a];visitor.getCurrentTask();visitor.build();return 1}visitor.action("visitor_init",{unr:a})};visitor.prototype.action=function(a,b){ajaxAction("farm",a,b,visitor.response)};visitor.prototype.response=function(b,a,c){if(a=="visitor_finish_task"){friends.data=b}else{visitor.data=b}if(a=="visitor_init"){visitor.farm=1;visitor.cache[c.unr]=b;visitor.getCurrentTask()}visitor.build();if(a=="visitor_finish_task"){visitor.flyingHearts()}if(visitor.data.data.starttutorial){visitor.startTutorial()}};visitor.prototype.build=function(){if(!this.data||!this.data.data||!this.data.data.user){return 1}var a="";a+='<div id="visitor_list" class="vlist"></div>';a+='<div id="visitor_farm" class="vfarm"></div>';a+='<div id="visitor_speedlinks"></div>';a+='<div id="visitor_task_reward_button" class="link" onclick="visitor.finishTask()">'+t_friends_daily_tasks_button3+"</div>";a+='<div id="visitor_close" class="link" onclick="visitor.close()">'+t_visitor_farm_leave.replace("%NAME%","<b>"+this.data.data.user.uname+"</b>")+"</div>";a+='<div id="visitor_next" class="link" onclick="visitor.init()">'+t_friends_daily_tasks_friend_desc_next+"</div>";a+='<div id="visitor_tutorial" class="tutorial">';a+='  <div class="transp"></div>';a+='  <div id="visitor_tutorial_char" class="char"></div>';a+='  <div id="visitor_tutorial_bubble" class="bubble"></div>';a+="</div>";$("visitor_view").innerHTML=a;this.buildSpeedlinks();this.buildVisitorList();this.buildFarm();showDiv("visitor_view");setTimer("visitor");this.timerUpdate()};visitor.prototype.buildSpeedlinks=function(){var b="";for(var c in this.data.data.farms){var a="";if(this.farm==c){a="speedlink_farm_active"}b+='<div class="tab '+a+" link farm"+c+'" onclick="visitor.gotoFarm('+c+')">';b+='  <div class="number">'+c+"</div>";b+="</div>"}$("visitor_speedlinks").innerHTML=b};visitor.prototype.buildFarm=function(){var l=friends.getVisitedFriends();var h="";if(this.farm==1){var a=1;if(this.data.data.farmhouse){a=this.data.data.farmhouse}var s="window.open('schaugarten/index.php?mode=view&user="+this.data.data.user.unr+"')";if(!this.data.data.user.schaufenster){s=""}h+='<div class="link headquarter headquarter_design'+a+'" onclick="'+s+'">';h+='  <div class="ani ani1"></div>';h+='  <div class="ani ani2"></div>';h+='  <div class="ani ani3"></div>';h+="</div>";h+='<div class="customers">';var c=2;for(var e=1;e<=this.customerCount;e++){var s="visitor.clickTaskTarget("+e+")";if(in_array(this.data.data.user.unr,l)){s=""}h+='<div class="link pos pos'+e+'" onclick="'+s+'">';if(this.currentTaskId>-1&&friends.data.data.tasks[this.currentTaskId].name=="farmi"&&this.taskData.targets&&this.taskData.targets[1]&&this.taskData.targets[1][e]){h+='<div class="giesbert behind'+c+'"></div>'}h+='  <div id="visitor_farmi'+e+'" class="farmi farmi'+c+'"></div>';h+="</div>";c++;if(c>6){c=1}}h+="</div>"}for(var d in this.data.data.farms[this.farm]){var n=parseInt(this.data.data.farms[this.farm][d].buildingid);var b=parseInt(this.data.data.farms[this.farm][d].level);var q="bm"+n;if(!n&&this.data.data.farms[this.farm][d].block){q="bmb"+this.data.data.farms[this.farm][d].block}h+='<div id="vfarm'+this.farm+"_pos"+d+'" class="farm_pos" onmouseover="showDiv(\'vfarm'+this.farm+"_pos"+d+"_tt')\" onmouseout=\"hideDiv('vfarm"+this.farm+"_pos"+d+"_tt')\">";h+='  <div class="'+q+' farm_pos_back link"></div>';if(b>0){h+='<div class="stars">';for(var e=1;e<=b;e++){h+='<div class="icon_star"></div>'}h+="</div>"}if(n>0&&buildinginfos[0][n]){h+='<div id="vfarm'+this.farm+"_pos"+d+'_tt" class="ttbox farm_pos_tt">'+buildinginfos[0][n][10]+"</div>"}h+="</div>"}h+='<div id="vfarm_farmdeco'+this.farm+'" class="farm_farmdeco"></div>';h+='<div id="vfarm_taskzone'+this.farm+'" class="farm_taskzone">';for(var e=1;e<=this.maxSpawnTiles;e++){h+='<div id="vfarm_taskzone'+this.farm+"_pos"+e+'" class="pos">';h+="</div>"}h+="</div>";h+='<div id="visitor_scroller_left" class="scroller left link" onclick="visitor.naviFarms(-1)"></div>';h+='<div id="visitor_scroller_right" class="scroller right link" onclick="visitor.naviFarms(1)"></div>';$("visitor_farm").innerHTML=h;var r="";if(xmastime){r="_xmas"}$("visitor_farm").className="vfarm farm_back"+this.farm+r;this.buildFarmDeco();this.buildTask();this.checkTask();for(var m in this.data.data.farms){}showDiv("visitor_scroller_left");showDiv("visitor_scroller_right");if(this.farm==1){hideDiv("visitor_scroller_left")}if(this.farm==m){hideDiv("visitor_scroller_right")}};visitor.prototype.naviFarms=function(a){do{this.farm+=a}while(!this.data.data.farms[this.farm]);visitor.gotoFarm(this.farm)};visitor.prototype.buildFarmDeco=function(){farmdeco.buildFarmdecoSlots(this.farm,1)};visitor.prototype.gotoFarm=function(a){this.farm=a;this.buildSpeedlinks();this.buildFarm()};visitor.prototype.buildVisitorList=function(){var e=0;if(friends.data.data.points){e=friends.data.data.points}var t=friends.getVisitedFriends();var h="";h+='<div id="visitor_list_header" class="header">';h+='  <div id="visitor_list_points" class="points">';h+='    <div class="amount">';h+="      <div>"+formatNumber(e)+"</div>";h+='      <div class="friendpoints"></div>';h+="    </div>";h+="  </div>";h+='  <div class="task">';if(parseInt(this.currentTaskId)<0){h+='<div class="desc">'+t_friends_daily_tasks_desc_done+"</div>"}else{if(in_array(this.data.data.user.unr,t)){h+='<div class="desc">'+t_friends_daily_tasks_friend_desc_done+"</div>"}else{var a=friends.data.data.tasks[this.currentTaskId].name;var w=friends.data.config.tasks[a].count;var q=0;if(friends.data.data.tasks[this.currentTaskId].progress){q=friends.data.data.tasks[this.currentTaskId].progress}var r=((q*100)/w);var z="";var n=t_friends_daily_tasks_desc[a].replace("%COUNT%",w);if(friends.data.data.tasks[this.currentTaskId].animal){z="is_animal"+friends.data.data.tasks[this.currentTaskId].animal}if(a=="chicken"){n=n.replace("%NAME%",t_friends_daily_tasks_animal[friends.data.data.tasks[this.currentTaskId].animal])}h+='<div class="img friends_task_img_'+a+" "+z+'"></div>';h+='<div class="desc">'+n+"</div>";h+='<div id="visior_task_block1">';h+='  <div class="bar">';h+='    <div id="visitor_task_percent" class="inner" style="width:'+r+'%;"></div>';h+='    <div id="visitor_task_progress" class="progress">'+q+"/"+w+"</div>";h+="  </div>";h+='<div id="visitor_task_button1" class="button_new link" onclick="visitor.finishTaskCommit()">'+t_friends_daily_tasks_button2+"</div>";h+="</div>";h+='<div id="visior_task_block2">';h+='  <div id="visitor_task_button2" class="button_new link" onclick="visitor.finishTask()">'+t_friends_daily_tasks_button3+"</div>";h+="</div>"}}h+="  </div>";h+="</div>";h+='<div id="visitor_list_list" class="list">';var v={};if(friends.data&&friends.data.data&&friends.data.data.friends){var m=1;var u="";var s="";for(var d=0;d<friends.data.data.friends.length;d++){var l=friends.data.data.friends[d];if(player_unr==l.friend||!parseInt(l.status)){continue}var c=this.buildVisitorListLine(d,m,t);if(friends.data.data.favs&&in_array(l.friend,friends.data.data.favs)){u+=c}else{s+=c}v[l.friend]=m;m++}h+=u+s}h+="</div>";$("visitor_list").innerHTML=h;if(v&&v[this.data.data.user.unr]&&v[this.data.data.user.unr]>9){var b=(v[this.data.data.user.unr]-9);$("visitor_list_list").scrollTop=(b*32)}};visitor.prototype.buildVisitorListLine=function(h,l,b){var m=friends.data.data.friends[h];var c=m.uname;if(m.guild&&m.guild["short"]){c+="&nbsp;["+m.guild["short"]+"]"}var a="";var e="";if(m.friend==this.data.data.user.unr){a="active"}if(in_array(m.friend,b)){e="off"}var d="";d+='<div class="line '+a+' link" onclick="visitor.init('+m.friend+')">';d+='  <div class="col0">';if(friends.data.data.favs&&in_array(m.friend,friends.data.data.favs)){d+='<div class="fav link star_five"></div>'}d+="</div>";d+='  <div class="col1">'+c+"</div>";d+='  <div class="col2">';d+='    <div class="friendpoints '+e+'"></div>';d+="  </div>";if(friends.data.data.friends[h].tasks.points_given>=friends.data.config.daily_tasks){a="";if(l>=4){a="bottom"}d+='<div class="col3" onmouseover="showDiv(\'visitor_list_friend'+h+"_col3_tt')\" onmouseout=\"hideDiv('visitor_list_friend"+h+"_col3_tt')\">";d+='  <div id="visitor_list_friend'+h+'_col3_tt" class="ttbox '+a+'">'+t_friends_visitor_list_all_points_given.replace("%NAME%","<b>"+m.uname+"</b>")+"</div>";d+="</div>"}d+='  <div class="clear"></div>';d+="</div>";return d};visitor.prototype.getCurrentTask=function(){this.taskData={};this.currentTaskId=-1;for(var h=0;h<friends.data.data.tasks.length;h++){if(friends.data.data.tasks[h].finished){continue}this.currentTaskId=h;this.taskData.targets={};var a=friends.data.data.tasks[this.currentTaskId].name;if(a=="farmi"){var b=getRandom(1,this.customerCount);this.taskData.targets[1]={};this.taskData.targets[1][b]={}}else{var n=[];for(var l in this.data.data.farms){if(!in_array(l,friends.data.config.valid_farms)){continue}if(a=="chicken"&&in_array(l,[8])){continue}if(a=="repair"&&in_array(l,[5,8])){continue}if(a=="weed"&&in_array(l,[4])){continue}n.push(l)}for(var e=1;e<=friends.data.config.tasks[a].count;e++){if(a=="flyer"){if(l.length<friends.data.config.tasks[a].count){var d=n[getRandom(1,n.length)-1];if(!this.taskData.targets[d]){this.taskData.targets[d]={}}var m=0;do{var b=getRandom(1,3);m++;if(m>100){break}}while(this.taskData.targets[d][b]);this.taskData.targets[d][b]={}}else{var m=0;do{var l=n[getRandom(1,n.length)-1];m++;if(m>100){break}}while(this.taskData.targets[l]);this.taskData.targets[l]={1:[]}}}else{var l=n[getRandom(1,n.length)-1];var c=this.getSpawnZones(a,l);if(!this.taskData.targets[l]){this.taskData.targets[l]={}}m=0;do{var b=c[(getRandom(1,c.length)-1)];m++;if(m>100){break}}while(this.taskData.targets[l][b]);this.taskData.targets[l][b]={}}}}break}};visitor.prototype.getSpawnZones=function(b,d){var a=this.spawnzones[b][1];for(var c in this.spawnzones[b]){if(c>d){return a}if(d==c){return this.spawnzones[b][c]}a=this.spawnzones[b][c]}return a};visitor.prototype.buildTask=function(){if(this.currentTaskId==-1){return 1}if(friends.data&&friends.data.data&&friends.data.data.tasks){for(var e=0;e<friends.data.data.tasks.length;e++){if(friends.data.data.tasks[e].friend&&friends.data.data.tasks[e].friend==this.data.data.user.unr){return 1}}}var b=friends.data.data.tasks[this.currentTaskId].name;if(b=="farmi"){}else{if(this.taskData&&this.taskData.targets&&this.taskData.targets[this.farm]){for(var l in this.taskData.targets[this.farm]){if(!$("vfarm_taskzone"+this.farm+"_pos"+l)){continue}if(friends.data.config.tasks[b].multi){if(this.taskData.targets[this.farm][l].clicked&&parseInt(this.taskData.targets[this.farm][l].clicked)==parseInt(friends.data.config.tasks[b].multi)){continue}}else{if(this.taskData.targets[this.farm][l].clicked){continue}}if(b=="flyer"){var h=getRandom(50,500);var d='<div id="visitor_task_flyer'+this.farm+"_"+l+'" class="flyer link is_animal'+friends.data.data.tasks[this.currentTaskId].animal+'" style="top:'+h+'px;" onclick="visitor.clickTaskTarget('+l+')"></div>';$("visitor_farm").insert(d);$("visitor_task_flyer"+this.farm+"_"+l).style.animationDelay=getRandom(1,2500)+"ms";$("visitor_task_flyer"+this.farm+"_"+l).style.animationDuration=getRandom(8,15)+"s"}else{var a="";var h=getRandom(1,4);if(b=="chicken"){h=friends.data.data.tasks[this.currentTaskId].animal}a+="type"+h;h=getRandom(1,2);if(h==2){a+=" mirrored"}h=getRandom(1,4);if(b=="chicken"){a+=" rotate"+h}var c="";if(this.taskData.targets[this.farm][l].clicked){c="clicked"+this.taskData.targets[this.farm][l].clicked}var d='<div id="visitor_taskzone'+l+'" class="type link '+c+'" onclick="visitor.clickTaskTarget('+l+')">';d+='  <div id="visitor_taskzone'+l+'_img" class="img '+b+" "+a+'"></div>';d+="</div>";$("vfarm_taskzone"+this.farm+"_pos"+l).innerHTML=d}}}}};visitor.prototype.clickTaskTarget=function(d){var b=friends.data.data.tasks[this.currentTaskId].name;if(this.taskData.targets[this.farm]&&this.taskData.targets[this.farm][d]){if(!this.taskData.targets[this.farm][d].clicked){this.taskData.targets[this.farm][d].clicked=0}this.taskData.targets[this.farm][d].clicked++;var a=1;if(friends.data.config.tasks[b].multi&&friends.data.config.tasks[b].multi!=this.taskData.targets[this.farm][d].clicked){if(b=="farmi"&&$("visitor_farmi"+d)){$("visitor_farmi"+d).addClassName("clicked")}else{if($("visitor_taskzone"+d)){$("visitor_taskzone"+d).removeClassName("clicked"+(this.taskData.targets[this.farm][d].clicked-1)).addClassName("clicked"+this.taskData.targets[this.farm][d].clicked).addClassName("clicked");$("visitor_taskzone"+d+"_img").insert('<div id="visitor_taskzone'+d+'_clickeffect" class="clickeffect"></div>')}}this.taskzoneUnclicked(d);a=0}if(a){var c='<div id="vfarm_taskzone'+this.farm+"_pos"+d+'_confetti" class="smoke_ring"></div>';if(b=="farmi"&&$("visitor_farmi"+d)){$("visitor_farmi"+d).innerHTML=c;$("visitor_farmi"+d).className="farmi fake"}else{if(b=="flyer"){$("visitor_task_flyer"+this.farm+"_"+d).innerHTML=c;$("visitor_task_flyer"+this.farm+"_"+d).onclick=new Function();this.hideFlyer(this.farm,d)}else{if($("vfarm_taskzone"+this.farm+"_pos"+d)){$("vfarm_taskzone"+this.farm+"_pos"+d).innerHTML=c}}}this.hideConfetti(this.farm,d)}}this.checkTask()};visitor.prototype.taskzoneUnclicked=function(a){setTimeout(function(){if($("visitor_farmi"+a)){$("visitor_farmi"+a).removeClassName("clicked")}if($("visitor_taskzone"+a)){$("visitor_taskzone"+a).removeClassName("clicked")}},200);setTimeout(function(){if($("visitor_taskzone"+a+"_clickeffect")){$("visitor_taskzone"+a+"_clickeffect").remove()}},1150)};visitor.prototype.checkTask=function(){if(this.currentTaskId<0){return 1}var a=friends.data.data.tasks[this.currentTaskId].name;var m=friends.data.config.tasks[a].count;var n=0;showDiv("visitor_close");hideDiv("visitor_task_reward_button");for(var l in this.taskData.targets){for(var d in this.taskData.targets[l]){if(!this.taskData.targets[l][d].clicked){continue}if(friends.data.config.tasks[a].multi&&friends.data.config.tasks[a].multi!=this.taskData.targets[l][d].clicked){continue}n++}}if($("visitor_task_progress")){$("visitor_task_progress").innerHTML=n+"/"+m}if($("visitor_task_percent")){$("visitor_task_percent").style.width=((n*100)/m)+"%"}if(m==n){hideDiv("visior_task_block1");showDiv("visior_task_block2");if($("visitor_task_button2")){$("visitor_task_button2").addClassName("pulse")}$("visitor_task_reward_button").addClassName("pulse");hideDiv("visitor_close");showDiv("visitor_task_reward_button");setTimeout(function(){if($("visitor_task_button2")){$("visitor_task_button2").removeClassName("pulse")}if($("visitor_task_reward_button")){$("visitor_task_reward_button").removeClassName("pulse")}},2000)}hideDiv("visitor_next");var q=friends.getVisitedFriends();if(this.currentTaskId<0){}else{if(in_array(this.data.data.user.unr,q)){showDiv("visitor_close");hideDiv("visitor_task_reward_button");var e=0;var c={};if(friends.data&&friends.data.data&&friends.data.data.friends){for(var h=0;h<friends.data.data.friends.length;h++){c[friends.data.data.friends[h].friend]=h}}if(friends.data&&friends.data.data&&friends.data.data.favs){for(var h=0;h<friends.data.data.favs.length;h++){if(!c[friends.data.data.favs[h]]){continue}var b=c[friends.data.data.favs[h]];var l=friends.data.data.friends[b];if(player_unr==l.friend||!parseInt(l.status)||in_array(l.friend,q)){continue}e=l.friend;break}}if(!e&&friends.data&&friends.data.data&&friends.data.data.friends){for(var h=0;h<friends.data.data.friends.length;h++){var l=friends.data.data.friends[h];if(player_unr==l.friend||!parseInt(l.status)||in_array(l.friend,q)){continue}e=l.friend;break}}if(e>0){$("visitor_next").onclick=new Function("visitor.init("+e+")");showDiv("visitor_next")}}}};visitor.prototype.finishTaskCommit=function(){var d="visitor.finishTaskUnfinished()";var b=friends.data.config.task_finish_coins;var c="";if(b>user_coins){d="";c="important"}var e='<span class="'+c+'"><b>'+b+"&nbsp;"+t_coins+"</b></span>";var a='<div id="visitor_commit">'+t_friends_daily_finish_task_body.replace("%COST%",e)+"</div>";globalcommitbox(t_friends_daily_finish_task_head,a,d)};visitor.prototype.hideFlyer=function(a,b){if($("visitor_task_flyer"+a+"_"+b)){$("visitor_task_flyer"+a+"_"+b).addClassName("empty")}setTimeout(function(){if($("visitor_task_flyer"+a+"_"+b)){$("visitor_task_flyer"+a+"_"+b).remove()}},500)};visitor.prototype.hideConfetti=function(a,b){setTimeout(function(){if($("vfarm_taskzone"+a+"_pos"+b+"_confetti")){$("vfarm_taskzone"+a+"_pos"+b+"_confetti").remove()}},500)};visitor.prototype.flyingHearts=function(){var a='<div id="visitor_flyingheart" class="flyingheart friendpoints"></div>';$("visitor_view").insert(a);$("visitor_flyingheart").addClassName("go");setTimeout(function(){if($("visitor_list_points")){$("visitor_list_points").addClassName("pulse")}},1000);setTimeout(function(){if($("visitor_flyingheart")){$("visitor_flyingheart").remove()}},1250);setTimeout(function(){if($("visitor_list_points")){$("visitor_list_points").removeClassName("pulse")}},2000)};visitor.prototype.startTutorial=function(){this.data.data.starttutorial=0;this.tutorialStep=0;showDiv("visitor_tutorial");this.nextTutorialStep()};visitor.prototype.nextTutorialStep=function(){this.tutorialStep++;if(!t_visitor_tutorial_text[this.tutorialStep]){this.closeTutorial();return 1}var c="visitor.nextTutorialStep()";var b=t_continue;if(!t_visitor_tutorial_text[(this.tutorialStep+1)]){c="visitor.closeTutorial();";b=t_vineyard_tutorial_text_finish}var d=t_visitor_tutorial_text[this.tutorialStep];d=d.replace("%USERNAME%","<b>"+username+"</b>");this.resetTutorial();$("visitor_speedlinks").addClassName("disable");$("visitor_list_header").addClassName("disable");$("visitor_list_list").addClassName("disable");if(this.tutorialStep==2){$("visitor_speedlinks").addClassName("pulse");setTimeout(function(){if($("visitor_speedlinks")){$("visitor_speedlinks").removeClassName("pulse")}},1000)}if(this.tutorialStep==3){$("visitor_list_header").addClassName("pulse");setTimeout(function(){if($("visitor_list_header")){$("visitor_list_header").removeClassName("pulse")}},1000)}if(this.tutorialStep==4){$("visitor_list_list").addClassName("pulse");setTimeout(function(){if($("visitor_list_list")){$("visitor_list_list").removeClassName("pulse")}},1000)}var a=d;a+='<div id="visitor_tutorial_footer" class="footer"><button class="button_new link" onclick="'+c+'">'+b+"</button></div>";$("visitor_tutorial_bubble").innerHTML=a;$("visitor_tutorial").className="tutorial step"+this.tutorialStep};visitor.prototype.resetTutorial=function(){$("visitor_speedlinks").removeClassName("pulse").removeClassName("disable");$("visitor_list_header").removeClassName("pulse").removeClassName("disable");$("visitor_list_list").removeClassName("pulse").removeClassName("disable")};visitor.prototype.closeTutorial=function(){this.resetTutorial();hideDiv("visitor_tutorial")};visitor.prototype.timer=function(){this.timerUpdate()};visitor.prototype.timerUpdate=function(){if($("visitor_view").style.display=="block"){for(var a=0;a<this.toogleDivs.length;a++){if(!$(this.toogleDivs[a])||$(this.toogleDivs[a]).style.display!="block"){continue}hideDiv(this.toogleDivs[a]);this.toogleDivsTmp.push(this.toogleDivs[a])}}};visitor.prototype.close=function(b){for(var a=0;a<this.toogleDivsTmp.length;a++){showDiv(this.toogleDivsTmp[a])}hideDiv("visitor_view");if(!b){friends.build()}};var whatsup=function(){this.data={}};whatsup.prototype.build=function(){var e='<div class="head">'+t_whatsup_head+"</div>";for(var d=0;d<this.data.length;d++){var l=0;if(this.data[d].block&&this.data[d].block>0){l=this.data[d].block}var h="hideDiv('whatsup_link_tt');";if(this.data[d].type=="gifts"){h+="whatsup.openGiftshop()"}if(this.data[d].type=="farmhouse"){h+="whatsup.openCatalogue();"}if(this.data[d].type=="items"){h+="whatsup.openShop();"}if(this.data[d].type=="housedesign"){h+="whatsup.openArchitect();"}if(l>0){h=""}var a="";if(d==0){a="first"}e+='<div class="line '+a+'">';e+='  <div class="intro2">'+t_whatsup_intro[this.data[d].type]+"</div>";a="solo";if(this.data[d].items&&this.data[d].items.length){var c="";if(!this.data[d].backlist||!this.data[d].backlist.length){c="solo"}e+='<div class="newlist '+c+'">';e+='  <div class="intro">'+t_new.replace("!","")+":</div>";for(var b=0;b<this.data[d].items.length;b++){if(this.data[d].type=="gifts"){e+=this.buildGifts(d,b)}if(this.data[d].type=="farmhouse"){e+=this.buildFarmhouse(d,b)}if(this.data[d].type=="items"){e+=this.buildItems(d,b)}if(this.data[d].type=="housedesign"){e+=this.buildHousedesign(d,b)}}e+='  <div class="clear"></div>';e+="</div>";a=""}if(this.data[d].backlist&&this.data[d].backlist.length){e+='<div class="backlist '+a+'">';e+='  <div class="intro">'+t_whatsup_line_old_and_available.replace("!",":")+"</div>";for(var b=0;b<this.data[d].backlist.length;b++){if(this.data[d].type=="gifts"){e+=this.buildGifts(d,b,1)}if(this.data[d].type=="farmhouse"){e+=this.buildFarmhouse(d,b,1)}if(this.data[d].type=="items"){e+=this.buildItems(d,b,1)}if(this.data[d].type=="housedesign"){e+=this.buildHousedesign(d,b,1)}}e+='  <div class="clear"></div>';e+="</div>"}e+='  <div class="clear"></div>';if(!this.data[d].permanent){e+='<div class="timer">'+t_whatsup_line_remain+'<span id="whatsup_line_timer'+d+'"></span></div>'}if(!l){if(premium==1){e+='<div class="linker link" onclick="'+h+'"></div>'}}else{e+='<div class="blocked">'+minlevel_feature.replace("%LEVEL%",l)+"</div>"}e+="</div>"}$("whatsup_link_tt").innerHTML=e};whatsup.prototype.buildGifts=function(c,b,d){if(d){var e=this.data[c].backlist[b]}else{var e=this.data[c].items[b]}var a=e;if(presents_hack[e]){a=presents_hack[e]}return'<div class="item gift" style="background-image:url('+imgpath+"gifts/"+a+'.gif)"></div>'};whatsup.prototype.buildFarmhouse=function(b,a,c){if(c){var d=this.data[b].backlist[a]}else{var d=this.data[b].items[a]}return'<div class="item farmhouse" style="background-image:url('+imgpath+"farmhouse/thumbs/"+d+'.jpg)"></div>'};whatsup.prototype.buildItems=function(b,a,c){if(c){var d=this.data[b].backlist[a]}else{var d=this.data[b].items[a]}return'<div class="item items tt'+d+'"></div>'};whatsup.prototype.buildHousedesign=function(c,a,d){if(d){var e=this.data[c].backlist[a]}else{var e=this.data[c].items[a]}var b='<div class="item housedesign headquarter_design'+e+'_preview"></div>';return b};whatsup.prototype.openCatalogue=function(){if(!farm){mapGo2Location("farm",1)}initFarmhouse();initCatalogue()};whatsup.prototype.openGiftshop=function(){if(!city||city>1){mapGo2Location("city",1)}giftshop.init();setTimeout(function(){giftshop.navi("xmas")},750)};whatsup.prototype.openShop=function(){if(!city||city>1){mapGo2Location("city",1)}shopAction("shopinit",2)};whatsup.prototype.openArchitect=function(){if(!farm){mapGo2Location("farm",1)}farmAction("initarchitect",1,1)};whatsup.prototype.timer=function(){for(var a=0;a<this.data.length;a++){this.data[a].remain--;if($("whatsup_line_timer"+a)){$("whatsup_line_timer"+a).innerHTML=formatTime(this.data[a].remain)}}};setInterval(function(){postMessage("ping")},1000);function openCityXmasEventHelp(a){$("xmasgame_help_navi1").removeClassName("xmasgame_help_navi_active");$("xmasgame_help_navi2").removeClassName("xmasgame_help_navi_active");hideDiv("xmasgame_helpbox_side1");hideDiv("xmasgame_helpbox_side2");if(!a){a=1}$("xmasgame_help_navi"+a).addClassName("xmasgame_help_navi_active");showDiv("xmasgame_box_transp");showDiv("xmasgame_helpbox");showDiv("xmasgame_helpbox_side"+a);if($("xmasgame_help_eventresttime")){$("xmasgame_help_eventresttime").innerHTML=formatTime(xmasgame_eventremain)}if($("xmasgame_help_eventexchangeresttime")){$("xmasgame_help_eventexchangeresttime").innerHTML=formatTime(xmasgame_eventexchangeremain)}}function closeCityXmasEventHelp(){hideDiv("xmasgame_box_transp");hideDiv("xmasgame_helpbox")}function naviCityXmasEvent(a){if(!a){a=0}var b=["xmasevent_game","xmasevent_prizes"];for(var c=0;c<b.length;c++){$("xmasevent_navi_item"+c).removeClassName("xmasevent_navi_item"+c);$("xmasevent_navi_item"+c).removeClassName("xmasevent_navi_item"+c+"_active");if(c==a){showDiv(b[c]);$("xmasevent_navi_item"+c).addClassName("xmasevent_navi_item"+c+"_active")}else{hideDiv(b[c]);$("xmasevent_navi_item"+c).addClassName("xmasevent_navi_item"+c)}}$("xmasevent_city_main").className="xmasevent_city_main_back"+a}function doCityXmasEvent(d,a,b,c,h){if(!d){d="init"}var e="";if(a){e+="&pid="+a}if(b){e+="&amount="+b}if(h){e+="&prize="+h}if(c){e+="&type="+c}else{e+="&type=0"}var l=createAjaxRequestObj();l.open("GET","ajax/xmas.php?rid="+rid+"&action="+d+e,true);l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");l.onreadystatechange=function(){doCityXmasEventResponse(l,d)};l.send(null)}function doCityXmasEventResponse(e,c){var r=_chkRequest(e);if(r!=0){if(r[0]==0){globalerrorbox(r[1])}else{showDiv("xmasevent_city_main_transp");showDiv("xmasevent_city_main");if(r[1].game){xmasgame_data=r[1].game}if(r[1].products){xmasgame_products=r[1].products}if(r[1].prizes){xmasgame_prizes=r[1].prizes}if(r[1].stock){xmasgame_stock=r[1].stock}if(r[1].items){xmasgame_items=r[1].items}if(r[1].help){openCityXmasEventHelp()}if(r[1].transfer){if(r[1].transfer.powerup){var m='<div style="position:absolute; top:30px; left:25px; width:375px;">'+t_payment_pointsboost_info.replace("%AMOUNT%",1)+"</div>";openXmasGameBox("",m,"","",1)}if(r[1].transfer.points){var m='<div style="position:absolute; top:30px; left:25px;">'+str_replace("%POINTS%","<b>"+formatNumber(r[1].transfer.points)+"</b>",xmasgame_t_presentpoints)+"</div>";openXmasGameBox("",m,"","",1)}}if($("xmasgame_bar")){for(var h=1;h<=6;h++){if(h<=xmasgame_data.phase.phase){if(h>1&&$("xmasgame_plus"+(h-1))){showDiv("xmasgame_plus"+(h-1))}if($("xmasgame_candle"+h)){showDiv("xmasgame_candle"+h)}if($("xmasgame_product"+h)){$("xmasgame_product"+h).removeClassName("xmasgame_transp")}}else{if($("xmasgame_plus"+(h-1))){hideDiv("xmasgame_plus"+(h-1))}if($("xmasgame_candle"+h)){hideDiv("xmasgame_candle"+h)}if($("xmasgame_product"+h)){$("xmasgame_product"+h).addClassName("xmasgame_transp")}}}var q=(xmasgame_phasestart[(xmasgame_data.phase.phase+1)]-xmasgame_phasestart[xmasgame_data.phase.phase]);var a=xmasgame_phasestart[xmasgame_data.phase.phase];a+=((q/100)*xmasgame_data.phase.percent);$("xmasgame_bar").style.width=a+"px";if(xmasgame_data.phase.phase==6){$("xmasgame_bar").style.width="537px"}var m='<div class="xmasbox_add"></div>';m+='<div style="margin-bottom:5px;">'+xmasgame_t_current+"<br><b>"+formatNumber(xmasgame_data.sum)+"</b></div>";if(xmasgame_data.phase.phase<6){m+='<div style="padding-top:5px; border-top:1px solid #000; margin-top:5px;">'+xmasgame_t_nextphase+"</div>";m+="<div>";m+='  <div style="float:left; margin-right:5px;" class="xmasgame_product'+(xmasgame_data.phase.phase+1)+'"></div>';m+='  <div style="float:left; margin-top:5px;"><b>'+formatNumber(xmasgame_data.phase.remain)+"</b>&nbsp;("+formatNumber(xmasgame_data.sum)+"/"+formatNumber(xmasgame_data.phase.next)+")</div>";m+='  <div style="clear:both;"></div>';m+="</div>"}$("xmasgame_front_tt").innerHTML=m;if(xmasgame_data.phase.phase){m='<div style="margin-bottom:5px; padding-bottom:5px; border-bottom:1px solid #000;">'+xmasgame_t_button_finish+"</div>";m+='<div style="margin-bottom:5px;">'+xmasgame_t_button_finish2+"</div>";for(var h=1;h<=xmasgame_data.phase.phase;h++){m+='<div style="float:left; margin-right:5px;" class="xmasgame_product'+h+'"></div>'}m+='<div style="clear:both;"></div>';$("xmasgame_button_finish_tt").innerHTML=m;showDiv("xmasgame_button_finish");$("xmasgame_button_finish").onclick=new Function("finishCityXmasEvent()")}else{hideDiv("xmasgame_button_finish")}if(xmasgame_data.phase.phase>=6){hideDiv("xmasgame_button_entry")}else{showDiv("xmasgame_button_entry")}}if(c=="init"){naviCityXmasEvent()}if(c=="entry"||c=="getprize"||c=="exchange"||c=="missing"){updateMenu();updateRack()}for(var h=1;h<=6;h++){var n=0;if(xmasgame_stock[h]){n=xmasgame_stock[h]}$("xmasevent_stockitem"+h).innerHTML=n}for(var h in xmasgame_prizes){if(xmasgame_prizes[h]){if(xmasgame_prizes[h].closed==1&&xmasgame_prizes[h].type!="points"){hideDiv("xmasevent_prize_item"+h)}else{showDiv("xmasevent_prize_item"+h);var b=0;for(var d=0;d<xmasgame_prizes[h].req.length;d++){if(xmasgame_prizes[h].req[d]){var l=xmasgame_prizes[h].req[d][0];var n=xmasgame_prizes[h].req[d][1];if(!xmasgame_stock[l]||xmasgame_stock[l]<n){$("xmasevent_prize"+h+"_req"+d).addClassName("important");b++}else{$("xmasevent_prize"+h+"_req"+d).removeClassName("important")}}}if(b){hideDiv("xmasevent_prize_buybutton"+h);showDiv("xmasevent_prize_addbutton"+h)}else{showDiv("xmasevent_prize_buybutton"+h);hideDiv("xmasevent_prize_addbutton"+h)}if(xmasgame_prizes[h].closed==1&&xmasgame_prizes[h].type=="points"){hideDiv("xmasevent_prize_buybutton"+h);hideDiv("xmasevent_prize_addbutton"+h);showDiv("xmasevent_prize_24hinfo")}}}}}}}function entryCityXmasEvent(a){if(!a){a="v"}var m="";var h="";h+='<div id="xmasbox_entry_intro">'+xmasgame_t_entry_intro+"</div>";h+='<div id="xmasbox_entry_navi">';var s=["v","ex","alpin","e","o","fw","f","fl","water"];for(var d=0;d<s.length;d++){var r="xmasgamebox_navi";if(a==s[d]){r="xmasgamebox_navi_active"}h+='<div class="link '+r+'" onclick="entryCityXmasEvent(\''+s[d]+"')\">";h+='  <div id="cmenue_'+s[d]+'" class="xmasgame_categoryselect"></div>';h+="</div>"}h+='  <div style="clear:both;"></div>';h+="</div>";h+='<div id="xmasgame_setamount_box" class="xmasbox">';h+='  <div class="xmasbox_add"></div>';h+='  <div style="margin-bottom:4px;">';h+='    <div style="float:left;" id="xmasgame_setamount_img"></div>';h+='    <div style="float:left;" id="xmasgame_setamount_name"></div>';h+='    <div style="clear:both;"></div>';h+="  </div>";h+='  <div style="margin-bottom:4px; z-index:11; position: relative;">';h+="    "+xmasgame_t_setamount_amount+'&nbsp;<input type="number" size="10" maxlength="7" id="xmasgame_setamount_amount" onchange="chkAmountCityXmasEvent()" onkeyup="chkAmountCityXmasEvent()">';h+='    <button type="button" class="link" id="xmasgame_setamount_button">'+xmasgame_t_setamount_button+"</button>";h+="  </div>";h+="  <div>"+xmasgame_t_setamount_sum+'<span id="xmasgame_setamount_sum"></span></div>';h+='  <div id="xmasgame_setamount_box_close" class="close link" onclick="hideDiv(\'xmasgame_setamount_box\');"></div>';h+="</div>";h+='<div id="xmasbox_entry_products">';for(var n in xmasgame_products){if(xmasgame_products[n]){var l=0;for(var e in xmasgame_products[n]){if(((a=="fl"&&(xmasgame_products[n][e].category=="fl"||xmasgame_products[n][e].category=="fla"))||(a=="alpin"&&(xmasgame_products[n][e].category=="alpin"||xmasgame_products[n][e].category=="tea"))||(a=="water"&&(xmasgame_products[n][e].category=="sushi"||xmasgame_products[n][e].category=="water"))||xmasgame_products[n][e].category==a)&&xmasgame_products[n][e].name){l++;var r="xmasbox_entry_item_img tt"+e;if(n==1){r="xmasbox_entry_item_img2 f_symbol"+e}h+='<div class="xmasbox_entry_item link" onclick="$(\'xmasgame_setamount_amount\').value=1; setAmountCityXmasEvent('+n+","+e+')" onmouseover="showDiv(\'xmasbox_entry_item_tt'+e+"')\" onmouseout=\"hideDiv('xmasbox_entry_item_tt"+e+"')\">";h+='  <div class="xmasbox_entry_item_points">'+xmasgame_products[n][e].points+"</div>";h+='  <div class="'+r+'"></div>';h+='  <div class="xmasbox_entry_item_stock">'+xmasgame_products[n][e].stock+"</div>";var q="xmasbox_entry_item_tt";if(l%5==4||l%5==0){q="xmasbox_entry_item_tt2"}h+='  <div id="xmasbox_entry_item_tt'+e+'" class="xmasbox '+q+'">'+xmasgame_products[n][e].name+"</div>";h+="</div>"}}}}h+="  </div>";showDiv("xmasgame_box_top");var c="";var b="";openXmasGameBox(m,h,c,b)}function chkAmountCityXmasEvent(){if(xmasgame_products[xmasevent_entrybox_stock][xmasevent_entrybox_pid]){var b=parseInt($("xmasgame_setamount_amount").value);if($("xmasgame_setamount_amount").value!=""&&!Number(b)){$("xmasgame_setamount_amount").value=1;b=1}var a=parseInt(xmasgame_products[xmasevent_entrybox_stock][xmasevent_entrybox_pid].stock);if(b>a){$("xmasgame_setamount_amount").value=a;b=a}var c=Math.floor(b*xmasgame_products[xmasevent_entrybox_stock][xmasevent_entrybox_pid].points);if(!Number(c)){c=0}$("xmasgame_setamount_sum").innerHTML=c}}var xmasevent_entrybox_stock=0;var xmasevent_entrybox_pid=0;function setAmountCityXmasEvent(b,a){if(xmasgame_products[b][a]){xmasevent_entrybox_stock=b;xmasevent_entrybox_pid=a;chkAmountCityXmasEvent();showDiv("xmasgame_setamount_box");$("xmasgame_setamount_box").value=1;$("xmasgame_setamount_name").innerHTML=xmasgame_products[b][a].name;if(b==1){$("xmasgame_setamount_img").addClassName("f_m_symbol"+a)}else{$("xmasgame_setamount_img").addClassName("kp"+a)}$("xmasgame_setamount_button").onclick=new Function("fireEntryCityXmasEvent("+b+","+a+")")}}function fireEntryCityXmasEvent(c,a){if(xmasgame_products[c][a]){var b=$("xmasgame_setamount_amount").value;if(b>0&&b!=""&&Number(b)){hideDiv("xmasgame_setamount_box");closeXmasGameBox();doCityXmasEvent("entry",a,b,c)}}}function finishCityXmasEvent(){var c="";var b="";var e="hideDiv('xmasgame_box');hideDiv('xmasgame_box_transp');doCityXmasEvent('finish')";var d="hideDiv('xmasgame_box');hideDiv('xmasgame_box_transp');";b+='<div style="position:absolute; top:30px; left:25px;">';b+='  <div style="margin-bottom:10px;">'+xmasgame_t_boxcontent_products+"</div>";for(var a=1;a<=xmasgame_data.phase.phase;a++){b+='<div style="float:left; margin-right:5px;" class="xmasgame_product'+a+'"></div>'}b+="</div>";openXmasGameBox(c,b,e,d,1)}function getPrizeCityXmasEvent(m){var d="";var e="";e+='<div style="position:absolute; top:30px; left:25px;">';e+='  <div style="float:left; text-align:center; margin-top:5px; background-repeat:no-repeat; background-position:50% 50%; width:115px;" id="xmasevent_prize'+m+'"></div>';e+='  <div style="float:left; margin-left:10px; margin-top:5px; width:250px;">';e+='    <div style="margin-bottom:5px;">'+xmasgame_t_ask_getpresent+"<br><br>"+xmasgame_t_require+"</div>";for(var c=0;c<xmasgame_prizes[m].req.length;c++){if(xmasgame_prizes[m].req[c]){var a=xmasgame_prizes[m].req[c][0];var b=xmasgame_prizes[m].req[c][1];e+='<div style="float:left;" class="xmasgame_product'+a+'_mini"></div>';e+='<div style="float:left; margin-top:4px; margin-right:10px; font-weight:bold;">'+b+"x</div>"}}e+='    <div style="clear:both;"></div>';e+="  </div>";e+='  <div style="clear:both;"></div>';e+="</div>";var l="hideDiv('xmasgame_box');hideDiv('xmasgame_box_transp');doCityXmasEvent('getprize',0,0,0,"+m+")";var h="hideDiv('xmasgame_box');hideDiv('xmasgame_box_transp');";openXmasGameBox(d,e,l,h,1)}function closeCityXmasEvent(){hideDiv("xmasevent_city_main_transp");hideDiv("xmasevent_city_main")}function exchangeCityXmasEvent(a){var n=0;for(var b=0;b<xmasgame_prizes[a].req.length;b++){var d=xmasgame_prizes[a].req[b][0];var c=xmasgame_prizes[a].req[b][1];if(!xmasgame_stock[d]){n+=c*xmasgame_items[d].coins}if(xmasgame_stock[d]&&xmasgame_stock[d]<c){n+=(c-xmasgame_stock[d])*xmasgame_items[d].coins}}var h="";var e='<div style="position:absolute; top:35px; left:25px; width:380px;">';e+='<div style="position:absolute; left:50%; margin-left:-50px; top:-115px;" id="xmasevent_prize'+a+'"></div>';if(n>0){e+='<div class="link coinsbutton_flex" style="font-size:10px;" onclick="fireExchangeCityXmasEvent(0, '+a+", "+n+')">'+t_xmasgame_buy_missing_items.replace("%COINS%",n)+"</div>"}e+='<div style="width:100%; height:1px; margin:10px 0px; border-bottom:1px solid #A9A25B;"></div>';for(var b in xmasgame_items){var m="fireExchangeCityXmasEvent("+b+", "+a+");";var l="";if(xmasgame_items[b].block){m="show_page('coins',0);";l="important"}e+='<div style="position:relative; float:left; margin:0 14px 14px 14px; padding:4px;" class="link '+l+'" onclick="'+m+'">';e+='  <div class="xmasevent_prize_item_back"></div>';e+='  <div style="position:relative; float:left; z-index:11;" class="xmasgame_product'+b+'_mini"></div>';e+='  <div style="position:relative; float:left; z-index:11; font-weight:14px; font-weight:bold; margin-top:4px;">&nbsp;=&nbsp;'+xmasgame_items[b].coins+"&nbsp;"+t_coins+"</div>";e+='  <div style="clear:both;"></div>';e+="</div>"}e+='  <div style="clear:both;"></div>';e+="</div>";openXmasGameBox(h,e,"","",1)}function fireExchangeCityXmasEvent(h,a,q){if(h>0){var m=xmasgame_items[h].coins}if(q>0){var m=q}var l='<div style="position:absolute; left:50%; margin-left:-51px; top:-80px;" id="xmasevent_prize'+a+'"></div>';l+='<div style="position:absolute; top:30px; left:25px;">';l+='  <div style="margin:10px 0px;">'+str_replace("%COINS%",m+"&nbsp;"+t_coins,xmasgame_t_ask_buysnacks)+"</div>";var n="doCityXmasEvent('exchange',"+h+",0,0,0)";if(q>0){for(var d=0;d<xmasgame_prizes[a].req.length;d++){var b=0;var h=xmasgame_prizes[a].req[d][0];var e=xmasgame_prizes[a].req[d][1];if(!xmasgame_stock[h]){b=e}if(xmasgame_stock[h]&&xmasgame_stock[h]<e){b=(e-xmasgame_stock[h])}if(!b){continue}l+='<div style="float:left;" class="xmasgame_product'+h+'"></div>';l+='<div style="float:left; margin-right:5px; margin-top:15px;">'+b+"x&nbsp;</div>"}l+='<div class="clear"></div>';n="doCityXmasEvent('missing',"+a+",0,0,0)"}else{l+='<div style="text-align:center; margin-top:10px; background-repeat:no-repeat; background-position:50% 50%; width:380px;" class="xmasgame_product'+h+'"></div>'}l+="</div>";openXmasGameBox("",l,"hideDiv('xmasgame_box');hideDiv('xmasgame_box_transp');"+n,"hideDiv('xmasgame_box');hideDiv('xmasgame_box_transp');",1)}function openXmasGameBox(a,c,e,d,b){showDiv("xmasgame_box_transp");showDiv("xmasgame_box");hideDiv("xmasgame_box_yes");hideDiv("xmasgame_box_no");$("xmasgame_box").className="";if(e){showDiv("xmasgame_box_yes");$("xmasgame_box_yes").onclick=new Function(e)}if(d){showDiv("xmasgame_box_no");$("xmasgame_box_no").onclick=new Function(d)}if(b==1){$("xmasgame_box").className="xmasgame_box_mini";hideDiv("xmasgame_box_top")}else{$("xmasgame_box").className="xmasgame_box";showDiv("xmasgame_box_top")}$("xmasgame_box_headline").innerHTML=a;$("xmasgame_box_content").innerHTML=c}function timerXmasGame(){xmasgame_eventremain--;xmasgame_eventexchangeremain--;if($("xmasgame_help_eventresttime")){$("xmasgame_help_eventresttime").innerHTML=formatTime(xmasgame_eventremain)}if($("xmasgame_help_eventexchangeresttime")){$("xmasgame_help_eventexchangeresttime").innerHTML=formatTime(xmasgame_eventexchangeremain)}}function closeXmasGameBox(){hideDiv("xmasgame_box_transp");hideDiv("xmasgame_box")}var youthprotection=function(){this.spam={};this.spamCooldown=5};youthprotection.prototype.sendReport=function(a,b){if(this.spam[a]){return 0}this.action("youthprotection_report",{type:a,id:b});this.spam[a]=1};youthprotection.prototype.action=function(a,b){ajaxAction("farm",a,b,youthprotection.response)};youthprotection.prototype.response=function(b,a,c){if(a=="youthprotection_report"&&b.link){window.open(b.link,"_blank")}};youthprotection.prototype.report=function(a,b){if(!youthprotection_active){return 1}this.sendReport(a,b)};youthprotection.prototype.timer=function(){for(var a in this.spam){this.spam[a]++;if(this.spam[a]>=this.spamCooldown){delete this.spam[a]}}};